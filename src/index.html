<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monaco-Editor</title>

    <script src="https://edrys-labs.github.io/module/edrys.js"></script>

    <link
      rel="stylesheet"
      href="https://edrys-labs.github.io/module/vendor/water.min.css"
    />

    <style>
      body {
        padding: 0px;
        margin: 0px;
        max-width: unset;
      }

      #editor {
        min-height: 100vh;
        width: 100%;
      }

      #execute {
        position: fixed;
        bottom: 0;
        left: 10px;
        padding: 10px;
        z-index: 1000;
        color: white;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="editor"></div>
    <button id="execute" onclick="execute()">Execute</button>

    <script type="module">
      import * as monaco from 'monaco-editor'
      import { MonacoBinding } from 'y-monaco'

      var editor

      function execute() {
        Edrys.sendMessage(
          Edrys.module?.config?.runCommand || 'execute',
          editor.getValue()
        )
      }

      Edrys.onReady(() => {
        const yText = Edrys.getState('monaco-code', 'Text')
        const awareness = Edrys.getState('monaco-awareness', 'Awareness')

        editor = monaco.editor.create(document.getElementById('editor'), {
          value: Edrys?.module?.config?.value,
          language: Edrys?.module?.config?.language || 'cpp',
          theme:
            Edrys?.module?.config?.theme ||
            (window.matchMedia &&
            window.matchMedia('(prefers-color-scheme: dark)').matches
              ? 'vs-dark'
              : 'vs-light'),
          automaticLayout: true,
          scrollbar: {
            vertical: 'visible', // Always show vertical scrollbar
            horizontal: 'auto',
            useShadows: false,
            verticalHasArrows: false,
            horizontalHasArrows: false,
            alwaysConsumeMouseWheel: false,
          },
        })

        const monacoBinding = new MonacoBinding(
          yText,
          editor.getModel(),
          new Set([editor]),
          awareness
        )
      })
    </script>
  </body>
</html>
