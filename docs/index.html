<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Monaco-Editor</title>

    <meta name="description" content="Collaborative code editor module that can be connected to different edrys classrooms.<br/>For more information visit: <a href='https://github.com/edrys-labs/module-monaco-editor' target='_blank'>https://github.com/edrys-labs/module-monaco-editor</a>">

    <script type="module" src="freemarker2.2536cdc3.js"></script><link rel="stylesheet" href="freemarker2.8345ebc7.css"><script src="https://edrys-labs.github.io/module/edrys.js"></script>

    <link rel="stylesheet" href="index.3545055f.css">
    <link rel="stylesheet" href="https://edrys-labs.github.io/module/vendor/water.min.css">

    <style>body {
  max-width: unset;
  margin: 0;
  padding: 0;
}

#editor {
  width: 100%;
  max-width: 100%;
  min-height: 100vh;
  max-height: 100vh;
  overflow: hidden;
}

#reset {
  display: none;
}

#controls {
  z-index: 1000;
  color: #fff;
  cursor: pointer;
  border: none;
  padding: 10px;
  position: fixed;
  bottom: 0;
  left: 10px;
}
</style>
  </head>
  <body>
    <div id="editor"></div>
    <div id="controls">
      <button id="execute" onclick="execute()">Execute</button>
      <button id="reset" onclick="reset()">Reset</button>
    </div>

    <script type="module">
function $parcel$export(e, n, v, s) {
  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});
}

      var $parcel$global = globalThis;
    
var $parcel$modules = {};
var $parcel$inits = {};

var parcelRequire = $parcel$global["parcelRequire94c2"];

if (parcelRequire == null) {
  parcelRequire = function(id) {
    if (id in $parcel$modules) {
      return $parcel$modules[id].exports;
    }
    if (id in $parcel$inits) {
      var init = $parcel$inits[id];
      delete $parcel$inits[id];
      var module = {id: id, exports: {}};
      $parcel$modules[id] = module;
      init.call(module.exports, module, module.exports);
      return module.exports;
    }
    var err = new Error("Cannot find module '" + id + "'");
    err.code = 'MODULE_NOT_FOUND';
    throw err;
  };

  parcelRequire.register = function register(id, init) {
    $parcel$inits[id] = init;
  };

  $parcel$global["parcelRequire94c2"] = parcelRequire;
}

var parcelRegister = parcelRequire.register;
parcelRegister("frEKl", function(module, exports) {
module.exports = import("./abap.39fd7315.js").then(()=>parcelRequire('1UxV9'));

});

parcelRegister("1OMYJ", function(module, exports) {
module.exports = import("./apex.fb21bf05.js").then(()=>parcelRequire('2o8zk'));

});

parcelRegister("9vjPi", function(module, exports) {
module.exports = import("./azcli.cca10c94.js").then(()=>parcelRequire('8cNXv'));

});

parcelRegister("7n66P", function(module, exports) {
module.exports = import("./bat.5dec50ef.js").then(()=>parcelRequire('17Pnp'));

});

parcelRegister("6vx1Y", function(module, exports) {
module.exports = import("./bicep.1e40f9ef.js").then(()=>parcelRequire('2AGxt'));

});

parcelRegister("FGvpQ", function(module, exports) {
module.exports = import("./cameligo.7d47b5ca.js").then(()=>parcelRequire('54lA1'));

});

parcelRegister("1aksy", function(module, exports) {
module.exports = import("./clojure.37bea99a.js").then(()=>parcelRequire('eKdOH'));

});

parcelRegister("dVjQ2", function(module, exports) {
module.exports = import("./coffee.9a434265.js").then(()=>parcelRequire('7ku2K'));

});

parcelRegister("8DLiA", function(module, exports) {
module.exports = import("./cpp.9f570f81.js").then(()=>parcelRequire('3EsFJ'));

});

parcelRegister("i8a7C", function(module, exports) {
module.exports = import("./csharp.70b12bb3.js").then(()=>parcelRequire('gMine'));

});

parcelRegister("jLErf", function(module, exports) {
module.exports = import("./csp.0b9c17f4.js").then(()=>parcelRequire('jdNgO'));

});

parcelRegister("k7iZ7", function(module, exports) {
module.exports = import("./css.1aef462a.js").then(()=>parcelRequire('6MQut'));

});

parcelRegister("gYnsz", function(module, exports) {
module.exports = import("./cypher.38340394.js").then(()=>parcelRequire('3bx1D'));

});

parcelRegister("ejBfR", function(module, exports) {
module.exports = import("./dart.f042063c.js").then(()=>parcelRequire('qGhTA'));

});

parcelRegister("1pdE9", function(module, exports) {
module.exports = import("./dockerfile.d5933d8d.js").then(()=>parcelRequire('o0B29'));

});

parcelRegister("8JqGm", function(module, exports) {
module.exports = import("./ecl.c5d83d37.js").then(()=>parcelRequire('1vqOg'));

});

parcelRegister("eCWTD", function(module, exports) {
module.exports = import("./elixir.f68da187.js").then(()=>parcelRequire('crID8'));

});

parcelRegister("9VxLl", function(module, exports) {
module.exports = import("./flow9.1fce5d76.js").then(()=>parcelRequire('i2Iip'));

});

parcelRegister("hmwGW", function(module, exports) {
module.exports = import("./fsharp.019dc720.js").then(()=>parcelRequire('2SoAN'));

});

parcelRegister("eO6t4", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./freemarker2.22f98dac.js")
]).then(()=>parcelRequire('dmQqc'));

});
parcelRegister("78S7W", function(module, exports) {
"use strict";

var $drOOz = parcelRequire("drOOz");
module.exports = $drOOz(function(bundle) {
    return new Promise(function(resolve, reject) {
        // Don't insert the same link element twice (e.g. if it was already in the HTML)
        var existingLinks = document.getElementsByTagName('link');
        if ([].concat(existingLinks).some(function(link) {
            return link.href === bundle && link.rel.indexOf('stylesheet') > -1;
        })) {
            resolve();
            return;
        }
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = bundle;
        link.onerror = function(e) {
            link.onerror = link.onload = null;
            link.remove();
            reject(e);
        };
        link.onload = function() {
            link.onerror = link.onload = null;
            resolve();
        };
        document.getElementsByTagName('head')[0].appendChild(link);
    });
});

});
parcelRegister("drOOz", function(module, exports) {
"use strict";
var $9ca536af4281fa60$var$cachedBundles = {};
var $9ca536af4281fa60$var$cachedPreloads = {};
var $9ca536af4281fa60$var$cachedPrefetches = {};
function $9ca536af4281fa60$var$getCache(type) {
    switch(type){
        case 'preload':
            return $9ca536af4281fa60$var$cachedPreloads;
        case 'prefetch':
            return $9ca536af4281fa60$var$cachedPrefetches;
        default:
            return $9ca536af4281fa60$var$cachedBundles;
    }
}
module.exports = function(loader, type) {
    return function(bundle) {
        var cache = $9ca536af4281fa60$var$getCache(type);
        if (cache[bundle]) return cache[bundle];
        return cache[bundle] = loader.apply(null, arguments).catch(function(e) {
            delete cache[bundle];
            throw e;
        });
    };
};

});



parcelRegister("ihvHV", function(module, exports) {
module.exports = import("./go.4cd1abf3.js").then(()=>parcelRequire('4Jkxd'));

});

parcelRegister("2qvDC", function(module, exports) {
module.exports = import("./graphql.aab6b2ba.js").then(()=>parcelRequire('44ON1'));

});

parcelRegister("aFuPg", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./handlebars.97c9a0d4.js")
]).then(()=>parcelRequire('dpCef'));

});

parcelRegister("c8u14", function(module, exports) {
module.exports = import("./hcl.d0b1c634.js").then(()=>parcelRequire('bIuBx'));

});

parcelRegister("f98iC", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./html.061bfe85.js")
]).then(()=>parcelRequire('koAYE'));

});

parcelRegister("9Oaoe", function(module, exports) {
module.exports = import("./ini.3218fb4c.js").then(()=>parcelRequire('1JJF5'));

});

parcelRegister("R52Fp", function(module, exports) {
module.exports = import("./java.3c69a4eb.js").then(()=>parcelRequire('5sWOB'));

});

parcelRegister("k4b1A", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./typescript.2bc5f92b.js"),
    import("./javascript.8b1ca90e.js")
]).then(()=>parcelRequire('9naGx'));

});

parcelRegister("aFO3O", function(module, exports) {
module.exports = import("./julia.48c5d787.js").then(()=>parcelRequire('YFtUT'));

});

parcelRegister("hIJ87", function(module, exports) {
module.exports = import("./kotlin.d0e4e3f5.js").then(()=>parcelRequire('hLFGY'));

});

parcelRegister("f7hMd", function(module, exports) {
module.exports = import("./less.543af7bd.js").then(()=>parcelRequire('4pmMk'));

});

parcelRegister("lsdO9", function(module, exports) {
module.exports = import("./lexon.7edf44df.js").then(()=>parcelRequire('8LLHg'));

});

parcelRegister("fjbXu", function(module, exports) {
module.exports = import("./lua.2fbe1da4.js").then(()=>parcelRequire('2NpkF'));

});

parcelRegister("ejMTo", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./liquid.19ca70fc.js")
]).then(()=>parcelRequire('5dKK1'));

});

parcelRegister("famXw", function(module, exports) {
module.exports = import("./m3.d9b7c816.js").then(()=>parcelRequire('kRS9D'));

});

parcelRegister("kWQj6", function(module, exports) {
module.exports = import("./markdown.0c3a4727.js").then(()=>parcelRequire('bcjk6'));

});

parcelRegister("cwp0z", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./mdx.7aa39fdb.js")
]).then(()=>parcelRequire('jYBU5'));

});

parcelRegister("2bfmW", function(module, exports) {
module.exports = import("./mips.8cef7eca.js").then(()=>parcelRequire('1HtrO'));

});

parcelRegister("952eJ", function(module, exports) {
module.exports = import("./msdax.41db0b15.js").then(()=>parcelRequire('dWoEL'));

});

parcelRegister("i1kEH", function(module, exports) {
module.exports = import("./mysql.d7d7f83a.js").then(()=>parcelRequire('1hTxw'));

});

parcelRegister("kSYtJ", function(module, exports) {
module.exports = import("./objective-c.82daaeb2.js").then(()=>parcelRequire('6C3pB'));

});

parcelRegister("02rhT", function(module, exports) {
module.exports = import("./pascal.c5157b34.js").then(()=>parcelRequire('lCk9N'));

});

parcelRegister("8BA2O", function(module, exports) {
module.exports = import("./pascaligo.22771a63.js").then(()=>parcelRequire('faI3j'));

});

parcelRegister("c0GZv", function(module, exports) {
module.exports = import("./perl.1cb67d53.js").then(()=>parcelRequire('doIrs'));

});

parcelRegister("5nv7N", function(module, exports) {
module.exports = import("./pgsql.71f2a3a9.js").then(()=>parcelRequire('dA0iz'));

});

parcelRegister("Z9E90", function(module, exports) {
module.exports = import("./php.9aef913b.js").then(()=>parcelRequire('aH961'));

});

parcelRegister("7lIAy", function(module, exports) {
module.exports = import("./pla.88fa107a.js").then(()=>parcelRequire('gt9P5'));

});

parcelRegister("1m6gW", function(module, exports) {
module.exports = import("./postiats.87106e37.js").then(()=>parcelRequire('ds6yv'));

});

parcelRegister("83pzg", function(module, exports) {
module.exports = import("./powerquery.225f184f.js").then(()=>parcelRequire('5X58i'));

});

parcelRegister("iV5fB", function(module, exports) {
module.exports = import("./powershell.488f4b10.js").then(()=>parcelRequire('e6iaN'));

});

parcelRegister("5z1Kg", function(module, exports) {
module.exports = import("./protobuf.40f38372.js").then(()=>parcelRequire('krTOh'));

});

parcelRegister("Zy786", function(module, exports) {
module.exports = import("./pug.3f270460.js").then(()=>parcelRequire('g51rz'));

});

parcelRegister("jUtzh", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./python.15d5b77b.js")
]).then(()=>parcelRequire('7cfTk'));

});

parcelRegister("8HXMm", function(module, exports) {
module.exports = import("./qsharp.62ab6c9e.js").then(()=>parcelRequire('5BBoy'));

});

parcelRegister("eEIAy", function(module, exports) {
module.exports = import("./r.0c6c3f3f.js").then(()=>parcelRequire('ao2eK'));

});

parcelRegister("6OrKv", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./razor.bdfec4c9.js")
]).then(()=>parcelRequire('74SDM'));

});

parcelRegister("eGc08", function(module, exports) {
module.exports = import("./redis.36ac9607.js").then(()=>parcelRequire('jojKd'));

});

parcelRegister("88bCE", function(module, exports) {
module.exports = import("./redshift.357f45e9.js").then(()=>parcelRequire('arjyY'));

});

parcelRegister("4F3x8", function(module, exports) {
module.exports = import("./restructuredtext.c50252f2.js").then(()=>parcelRequire('gJuf3'));

});

parcelRegister("1qZZt", function(module, exports) {
module.exports = import("./ruby.b266a633.js").then(()=>parcelRequire('bq1Cz'));

});

parcelRegister("aqAKG", function(module, exports) {
module.exports = import("./rust.de169718.js").then(()=>parcelRequire('2Q9VK'));

});

parcelRegister("dSMC1", function(module, exports) {
module.exports = import("./sb.002848c0.js").then(()=>parcelRequire('7IpVC'));

});

parcelRegister("50Wit", function(module, exports) {
module.exports = import("./scala.7c457ead.js").then(()=>parcelRequire('e2QHe'));

});

parcelRegister("gi5kB", function(module, exports) {
module.exports = import("./scheme.bf57e022.js").then(()=>parcelRequire('3zH1I'));

});

parcelRegister("5Wosx", function(module, exports) {
module.exports = import("./scss.e916d799.js").then(()=>parcelRequire('j6kGx'));

});

parcelRegister("hq9Mo", function(module, exports) {
module.exports = import("./shell.fd289bae.js").then(()=>parcelRequire('6Pskm'));

});

parcelRegister("lXZHW", function(module, exports) {
module.exports = import("./solidity.d344de1e.js").then(()=>parcelRequire('iDB4m'));

});

parcelRegister("92BKv", function(module, exports) {
module.exports = import("./sophia.0618a297.js").then(()=>parcelRequire('7dFT3'));

});

parcelRegister("8GhjX", function(module, exports) {
module.exports = import("./sparql.42762e3f.js").then(()=>parcelRequire('kLspA'));

});

parcelRegister("lRud8", function(module, exports) {
module.exports = import("./sql.faadaa59.js").then(()=>parcelRequire('25pvS'));

});

parcelRegister("deU0K", function(module, exports) {
module.exports = import("./st.ddf161c1.js").then(()=>parcelRequire('66ZpJ'));

});

parcelRegister("jTma8", function(module, exports) {
module.exports = import("./swift.7b448798.js").then(()=>parcelRequire('hAVic'));

});

parcelRegister("kRHKl", function(module, exports) {
module.exports = import("./systemverilog.849ca518.js").then(()=>parcelRequire('87O85'));

});

parcelRegister("fzODu", function(module, exports) {
module.exports = import("./tcl.dedffb31.js").then(()=>parcelRequire('epSDg'));

});

parcelRegister("cac8S", function(module, exports) {
module.exports = import("./twig.e7d0b639.js").then(()=>parcelRequire('h2YvV'));

});

parcelRegister("4c0YH", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./typescript.2bc5f92b.js")
]).then(()=>parcelRequire('g5v8v'));

});

parcelRegister("7nqAw", function(module, exports) {
module.exports = import("./typespec.6ba1f2ee.js").then(()=>parcelRequire('l4ryy'));

});

parcelRegister("gK1XX", function(module, exports) {
module.exports = import("./vb.1a23f165.js").then(()=>parcelRequire('l0TFS'));

});

parcelRegister("3WPkL", function(module, exports) {
module.exports = import("./wgsl.635c090d.js").then(()=>parcelRequire('8uLYr'));

});

parcelRegister("9lIn6", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./xml.4a766a62.js")
]).then(()=>parcelRequire('fEFwS'));

});

parcelRegister("eqwbp", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./yaml.c00a89b4.js")
]).then(()=>parcelRequire('18RR9'));

});

parcelRegister("6EcFO", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./cssMode.4c31da8b.js")
]).then(()=>parcelRequire('5q283'));

});

parcelRegister("7hQ6w", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./htmlMode.4acd2ca7.js")
]).then(()=>parcelRequire('gbMUR'));

});

parcelRegister("57gYB", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./jsonMode.6015ac21.js")
]).then(()=>parcelRequire('86ZEt'));

});

parcelRegister("2RFCG", function(module, exports) {

$parcel$export(module.exports, "typescriptDefaults", () => $2160d1780f3fea88$export$5b7e032c201ff89d);

var $leKFq = parcelRequire("leKFq");
/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ var $2160d1780f3fea88$var$__defProp = Object.defineProperty;
var $2160d1780f3fea88$var$__getOwnPropDesc = Object.getOwnPropertyDescriptor;
var $2160d1780f3fea88$var$__getOwnPropNames = Object.getOwnPropertyNames;
var $2160d1780f3fea88$var$__hasOwnProp = Object.prototype.hasOwnProperty;
var $2160d1780f3fea88$var$__copyProps = (to, from, except, desc)=>{
    if (from && typeof from === "object" || typeof from === "function") {
        for (let key of $2160d1780f3fea88$var$__getOwnPropNames(from))if (!$2160d1780f3fea88$var$__hasOwnProp.call(to, key) && key !== except) $2160d1780f3fea88$var$__defProp(to, key, {
            get: ()=>from[key],
            enumerable: !(desc = $2160d1780f3fea88$var$__getOwnPropDesc(from, key)) || desc.enumerable
        });
    }
    return to;
};
var $2160d1780f3fea88$var$__reExport = (target, mod, secondTarget)=>($2160d1780f3fea88$var$__copyProps(target, mod, "default"), secondTarget && $2160d1780f3fea88$var$__copyProps(secondTarget, mod, "default"));
// src/language/typescript/lib/typescriptServicesMetadata.ts
var $2160d1780f3fea88$var$typescriptVersion = "5.4.5";
// src/fillers/monaco-editor-core.ts
var $2160d1780f3fea88$var$monaco_editor_core_exports = {};
$2160d1780f3fea88$var$__reExport($2160d1780f3fea88$var$monaco_editor_core_exports, $leKFq);
// src/language/typescript/monaco.contribution.ts
var $2160d1780f3fea88$export$2932e787d4bab445 = /* @__PURE__ */ ((ModuleKind2)=>{
    ModuleKind2[ModuleKind2["None"] = 0] = "None";
    ModuleKind2[ModuleKind2["CommonJS"] = 1] = "CommonJS";
    ModuleKind2[ModuleKind2["AMD"] = 2] = "AMD";
    ModuleKind2[ModuleKind2["UMD"] = 3] = "UMD";
    ModuleKind2[ModuleKind2["System"] = 4] = "System";
    ModuleKind2[ModuleKind2["ES2015"] = 5] = "ES2015";
    ModuleKind2[ModuleKind2["ESNext"] = 99] = "ESNext";
    return ModuleKind2;
})($2160d1780f3fea88$export$2932e787d4bab445 || {});
var $2160d1780f3fea88$export$23b47a46c244d065 = /* @__PURE__ */ ((JsxEmit2)=>{
    JsxEmit2[JsxEmit2["None"] = 0] = "None";
    JsxEmit2[JsxEmit2["Preserve"] = 1] = "Preserve";
    JsxEmit2[JsxEmit2["React"] = 2] = "React";
    JsxEmit2[JsxEmit2["ReactNative"] = 3] = "ReactNative";
    JsxEmit2[JsxEmit2["ReactJSX"] = 4] = "ReactJSX";
    JsxEmit2[JsxEmit2["ReactJSXDev"] = 5] = "ReactJSXDev";
    return JsxEmit2;
})($2160d1780f3fea88$export$23b47a46c244d065 || {});
var $2160d1780f3fea88$export$c28f76d17c23333a = /* @__PURE__ */ ((NewLineKind2)=>{
    NewLineKind2[NewLineKind2["CarriageReturnLineFeed"] = 0] = "CarriageReturnLineFeed";
    NewLineKind2[NewLineKind2["LineFeed"] = 1] = "LineFeed";
    return NewLineKind2;
})($2160d1780f3fea88$export$c28f76d17c23333a || {});
var $2160d1780f3fea88$export$36609ff6f261a579 = /* @__PURE__ */ ((ScriptTarget2)=>{
    ScriptTarget2[ScriptTarget2["ES3"] = 0] = "ES3";
    ScriptTarget2[ScriptTarget2["ES5"] = 1] = "ES5";
    ScriptTarget2[ScriptTarget2["ES2015"] = 2] = "ES2015";
    ScriptTarget2[ScriptTarget2["ES2016"] = 3] = "ES2016";
    ScriptTarget2[ScriptTarget2["ES2017"] = 4] = "ES2017";
    ScriptTarget2[ScriptTarget2["ES2018"] = 5] = "ES2018";
    ScriptTarget2[ScriptTarget2["ES2019"] = 6] = "ES2019";
    ScriptTarget2[ScriptTarget2["ES2020"] = 7] = "ES2020";
    ScriptTarget2[ScriptTarget2["ESNext"] = 99] = "ESNext";
    ScriptTarget2[ScriptTarget2["JSON"] = 100] = "JSON";
    ScriptTarget2[ScriptTarget2["Latest"] = 99 /* ESNext */ ] = "Latest";
    return ScriptTarget2;
})($2160d1780f3fea88$export$36609ff6f261a579 || {});
var $2160d1780f3fea88$export$2e45c31d6e8ee3d0 = /* @__PURE__ */ ((ModuleResolutionKind2)=>{
    ModuleResolutionKind2[ModuleResolutionKind2["Classic"] = 1] = "Classic";
    ModuleResolutionKind2[ModuleResolutionKind2["NodeJs"] = 2] = "NodeJs";
    return ModuleResolutionKind2;
})($2160d1780f3fea88$export$2e45c31d6e8ee3d0 || {});
var $2160d1780f3fea88$var$LanguageServiceDefaultsImpl = class {
    constructor(compilerOptions, diagnosticsOptions, workerOptions, inlayHintsOptions, modeConfiguration){
        this._onDidChange = new $2160d1780f3fea88$var$monaco_editor_core_exports.Emitter();
        this._onDidExtraLibsChange = new $2160d1780f3fea88$var$monaco_editor_core_exports.Emitter();
        this._extraLibs = /* @__PURE__ */ Object.create(null);
        this._removedExtraLibs = /* @__PURE__ */ Object.create(null);
        this._eagerModelSync = false;
        this.setCompilerOptions(compilerOptions);
        this.setDiagnosticsOptions(diagnosticsOptions);
        this.setWorkerOptions(workerOptions);
        this.setInlayHintsOptions(inlayHintsOptions);
        this.setModeConfiguration(modeConfiguration);
        this._onDidExtraLibsChangeTimeout = -1;
    }
    get onDidChange() {
        return this._onDidChange.event;
    }
    get onDidExtraLibsChange() {
        return this._onDidExtraLibsChange.event;
    }
    get modeConfiguration() {
        return this._modeConfiguration;
    }
    get workerOptions() {
        return this._workerOptions;
    }
    get inlayHintsOptions() {
        return this._inlayHintsOptions;
    }
    getExtraLibs() {
        return this._extraLibs;
    }
    addExtraLib(content, _filePath) {
        let filePath;
        if (typeof _filePath === "undefined") filePath = `ts:extralib-${Math.random().toString(36).substring(2, 15)}`;
        else filePath = _filePath;
        if (this._extraLibs[filePath] && this._extraLibs[filePath].content === content) return {
            dispose: ()=>{}
        };
        let myVersion = 1;
        if (this._removedExtraLibs[filePath]) myVersion = this._removedExtraLibs[filePath] + 1;
        if (this._extraLibs[filePath]) myVersion = this._extraLibs[filePath].version + 1;
        this._extraLibs[filePath] = {
            content: content,
            version: myVersion
        };
        this._fireOnDidExtraLibsChangeSoon();
        return {
            dispose: ()=>{
                let extraLib = this._extraLibs[filePath];
                if (!extraLib) return;
                if (extraLib.version !== myVersion) return;
                delete this._extraLibs[filePath];
                this._removedExtraLibs[filePath] = myVersion;
                this._fireOnDidExtraLibsChangeSoon();
            }
        };
    }
    setExtraLibs(libs) {
        for(const filePath in this._extraLibs)this._removedExtraLibs[filePath] = this._extraLibs[filePath].version;
        this._extraLibs = /* @__PURE__ */ Object.create(null);
        if (libs && libs.length > 0) for (const lib of libs){
            const filePath = lib.filePath || `ts:extralib-${Math.random().toString(36).substring(2, 15)}`;
            const content = lib.content;
            let myVersion = 1;
            if (this._removedExtraLibs[filePath]) myVersion = this._removedExtraLibs[filePath] + 1;
            this._extraLibs[filePath] = {
                content: content,
                version: myVersion
            };
        }
        this._fireOnDidExtraLibsChangeSoon();
    }
    _fireOnDidExtraLibsChangeSoon() {
        if (this._onDidExtraLibsChangeTimeout !== -1) return;
        this._onDidExtraLibsChangeTimeout = window.setTimeout(()=>{
            this._onDidExtraLibsChangeTimeout = -1;
            this._onDidExtraLibsChange.fire(void 0);
        }, 0);
    }
    getCompilerOptions() {
        return this._compilerOptions;
    }
    setCompilerOptions(options) {
        this._compilerOptions = options || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(void 0);
    }
    getDiagnosticsOptions() {
        return this._diagnosticsOptions;
    }
    setDiagnosticsOptions(options) {
        this._diagnosticsOptions = options || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(void 0);
    }
    setWorkerOptions(options) {
        this._workerOptions = options || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(void 0);
    }
    setInlayHintsOptions(options) {
        this._inlayHintsOptions = options || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(void 0);
    }
    setMaximumWorkerIdleTime(value) {}
    setEagerModelSync(value) {
        this._eagerModelSync = value;
    }
    getEagerModelSync() {
        return this._eagerModelSync;
    }
    setModeConfiguration(modeConfiguration) {
        this._modeConfiguration = modeConfiguration || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(void 0);
    }
};
var $2160d1780f3fea88$export$30d76bc34f51c345 = $2160d1780f3fea88$var$typescriptVersion;
var $2160d1780f3fea88$var$modeConfigurationDefault = {
    completionItems: true,
    hovers: true,
    documentSymbols: true,
    definitions: true,
    references: true,
    documentHighlights: true,
    rename: true,
    diagnostics: true,
    documentRangeFormattingEdits: true,
    signatureHelp: true,
    onTypeFormattingEdits: true,
    codeActions: true,
    inlayHints: true
};
var $2160d1780f3fea88$export$5b7e032c201ff89d = new $2160d1780f3fea88$var$LanguageServiceDefaultsImpl({
    allowNonTsExtensions: true,
    target: 99 /* Latest */ 
}, {
    noSemanticValidation: false,
    noSyntaxValidation: false,
    onlyVisible: false
}, {}, {}, $2160d1780f3fea88$var$modeConfigurationDefault);
var $2160d1780f3fea88$export$15c6eb181a3131d2 = new $2160d1780f3fea88$var$LanguageServiceDefaultsImpl({
    allowNonTsExtensions: true,
    allowJs: true,
    target: 99 /* Latest */ 
}, {
    noSemanticValidation: true,
    noSyntaxValidation: false,
    onlyVisible: false
}, {}, {}, $2160d1780f3fea88$var$modeConfigurationDefault);
var $2160d1780f3fea88$export$f4433c6b950b070e = ()=>{
    return $2160d1780f3fea88$var$getMode().then((mode)=>mode.getTypeScriptWorker());
};
var $2160d1780f3fea88$export$42142bcd5970f8e8 = ()=>{
    return $2160d1780f3fea88$var$getMode().then((mode)=>mode.getJavaScriptWorker());
};
$2160d1780f3fea88$var$monaco_editor_core_exports.languages.typescript = {
    ModuleKind: $2160d1780f3fea88$export$2932e787d4bab445,
    JsxEmit: $2160d1780f3fea88$export$23b47a46c244d065,
    NewLineKind: $2160d1780f3fea88$export$c28f76d17c23333a,
    ScriptTarget: $2160d1780f3fea88$export$36609ff6f261a579,
    ModuleResolutionKind: $2160d1780f3fea88$export$2e45c31d6e8ee3d0,
    typescriptVersion: $2160d1780f3fea88$export$30d76bc34f51c345,
    typescriptDefaults: $2160d1780f3fea88$export$5b7e032c201ff89d,
    javascriptDefaults: $2160d1780f3fea88$export$15c6eb181a3131d2,
    getTypeScriptWorker: $2160d1780f3fea88$export$f4433c6b950b070e,
    getJavaScriptWorker: $2160d1780f3fea88$export$42142bcd5970f8e8
};

function $2160d1780f3fea88$var$getMode() {
    var resolve, reject;
    return (parcelRequire("dp1Wo"));
}
$2160d1780f3fea88$var$monaco_editor_core_exports.languages.onLanguage("typescript", ()=>{
    return $2160d1780f3fea88$var$getMode().then((mode)=>mode.setupTypeScript($2160d1780f3fea88$export$5b7e032c201ff89d));
});
$2160d1780f3fea88$var$monaco_editor_core_exports.languages.onLanguage("javascript", ()=>{
    return $2160d1780f3fea88$var$getMode().then((mode)=>mode.setupJavaScript($2160d1780f3fea88$export$15c6eb181a3131d2));
});

});
parcelRegister("dp1Wo", function(module, exports) {

module.exports = Promise.all([
    (parcelRequire("78S7W"))(new URL("freemarker2.8345ebc7.css", import.meta.url).toString()),
    import("./freemarker2.2536cdc3.js"),
    import("./tsMode.73d1302c.js")
]).then(()=>parcelRequire('1IV1P'));

});


parcelRequire("leKFq");
/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/abap/abap.contribution.ts
/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ 
var $leKFq = parcelRequire("leKFq");
var $0eeba481b8e259d4$var$__defProp = Object.defineProperty;
var $0eeba481b8e259d4$var$__getOwnPropDesc = Object.getOwnPropertyDescriptor;
var $0eeba481b8e259d4$var$__getOwnPropNames = Object.getOwnPropertyNames;
var $0eeba481b8e259d4$var$__hasOwnProp = Object.prototype.hasOwnProperty;
var $0eeba481b8e259d4$var$__copyProps = (to, from, except, desc)=>{
    if (from && typeof from === "object" || typeof from === "function") {
        for (let key of $0eeba481b8e259d4$var$__getOwnPropNames(from))if (!$0eeba481b8e259d4$var$__hasOwnProp.call(to, key) && key !== except) $0eeba481b8e259d4$var$__defProp(to, key, {
            get: ()=>from[key],
            enumerable: !(desc = $0eeba481b8e259d4$var$__getOwnPropDesc(from, key)) || desc.enumerable
        });
    }
    return to;
};
var $0eeba481b8e259d4$var$__reExport = (target, mod, secondTarget)=>($0eeba481b8e259d4$var$__copyProps(target, mod, "default"), secondTarget && $0eeba481b8e259d4$var$__copyProps(secondTarget, mod, "default"));
// src/fillers/monaco-editor-core.ts
var $0eeba481b8e259d4$var$monaco_editor_core_exports = {};
$0eeba481b8e259d4$var$__reExport($0eeba481b8e259d4$var$monaco_editor_core_exports, $leKFq);
// src/basic-languages/_.contribution.ts
var $0eeba481b8e259d4$var$languageDefinitions = {};
var $0eeba481b8e259d4$var$lazyLanguageLoaders = {};
var $0eeba481b8e259d4$var$LazyLanguageLoader = class _LazyLanguageLoader {
    static getOrCreate(languageId) {
        if (!$0eeba481b8e259d4$var$lazyLanguageLoaders[languageId]) $0eeba481b8e259d4$var$lazyLanguageLoaders[languageId] = new _LazyLanguageLoader(languageId);
        return $0eeba481b8e259d4$var$lazyLanguageLoaders[languageId];
    }
    constructor(languageId){
        this._languageId = languageId;
        this._loadingTriggered = false;
        this._lazyLoadPromise = new Promise((resolve, reject)=>{
            this._lazyLoadPromiseResolve = resolve;
            this._lazyLoadPromiseReject = reject;
        });
    }
    load() {
        if (!this._loadingTriggered) {
            this._loadingTriggered = true;
            $0eeba481b8e259d4$var$languageDefinitions[this._languageId].loader().then((mod)=>this._lazyLoadPromiseResolve(mod), (err)=>this._lazyLoadPromiseReject(err));
        }
        return this._lazyLoadPromise;
    }
};
async function $0eeba481b8e259d4$export$f02cbd868e2f57cf(languageId) {
    await $0eeba481b8e259d4$var$LazyLanguageLoader.getOrCreate(languageId).load();
    const model = $0eeba481b8e259d4$var$monaco_editor_core_exports.editor.createModel("", languageId);
    model.dispose();
}
function $0eeba481b8e259d4$export$b5daeabefb05ee6b(def) {
    const languageId = def.id;
    $0eeba481b8e259d4$var$languageDefinitions[languageId] = def;
    $0eeba481b8e259d4$var$monaco_editor_core_exports.languages.register(def);
    const lazyLanguageLoader = $0eeba481b8e259d4$var$LazyLanguageLoader.getOrCreate(languageId);
    $0eeba481b8e259d4$var$monaco_editor_core_exports.languages.registerTokensProviderFactory(languageId, {
        create: async ()=>{
            const mod = await lazyLanguageLoader.load();
            return mod.language;
        }
    });
    $0eeba481b8e259d4$var$monaco_editor_core_exports.languages.onLanguageEncountered(languageId, async ()=>{
        const mod = await lazyLanguageLoader.load();
        $0eeba481b8e259d4$var$monaco_editor_core_exports.languages.setLanguageConfiguration(languageId, mod.conf);
    });
}



(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "abap",
    extensions: [
        ".abap"
    ],
    aliases: [
        "abap",
        "ABAP"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("frEKl"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/apex/apex.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "apex",
    extensions: [
        ".cls"
    ],
    aliases: [
        "Apex",
        "apex"
    ],
    mimetypes: [
        "text/x-apex-source",
        "text/x-apex"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("1OMYJ"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/azcli/azcli.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "azcli",
    extensions: [
        ".azcli"
    ],
    aliases: [
        "Azure CLI",
        "azcli"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("9vjPi"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/bat/bat.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "bat",
    extensions: [
        ".bat",
        ".cmd"
    ],
    aliases: [
        "Batch",
        "bat"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("7n66P"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/bicep/bicep.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "bicep",
    extensions: [
        ".bicep"
    ],
    aliases: [
        "Bicep"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("6vx1Y"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/cameligo/cameligo.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "cameligo",
    extensions: [
        ".mligo"
    ],
    aliases: [
        "Cameligo"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("FGvpQ"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/clojure/clojure.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "clojure",
    extensions: [
        ".clj",
        ".cljs",
        ".cljc",
        ".edn"
    ],
    aliases: [
        "clojure",
        "Clojure"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("1aksy"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/coffee/coffee.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "coffeescript",
    extensions: [
        ".coffee"
    ],
    aliases: [
        "CoffeeScript",
        "coffeescript",
        "coffee"
    ],
    mimetypes: [
        "text/x-coffeescript",
        "text/coffeescript"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("dVjQ2"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/cpp/cpp.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "c",
    extensions: [
        ".c",
        ".h"
    ],
    aliases: [
        "C",
        "c"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("8DLiA"));
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "cpp",
    extensions: [
        ".cpp",
        ".cc",
        ".cxx",
        ".hpp",
        ".hh",
        ".hxx"
    ],
    aliases: [
        "C++",
        "Cpp",
        "cpp"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("8DLiA"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/csharp/csharp.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "csharp",
    extensions: [
        ".cs",
        ".csx",
        ".cake"
    ],
    aliases: [
        "C#",
        "csharp"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("i8a7C"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/csp/csp.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "csp",
    extensions: [
        ".csp"
    ],
    aliases: [
        "CSP",
        "csp"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("jLErf"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/css/css.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "css",
    extensions: [
        ".css"
    ],
    aliases: [
        "CSS",
        "css"
    ],
    mimetypes: [
        "text/css"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("k7iZ7"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/cypher/cypher.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "cypher",
    extensions: [
        ".cypher",
        ".cyp"
    ],
    aliases: [
        "Cypher",
        "OpenCypher"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("gYnsz"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/dart/dart.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "dart",
    extensions: [
        ".dart"
    ],
    aliases: [
        "Dart",
        "dart"
    ],
    mimetypes: [
        "text/x-dart-source",
        "text/x-dart"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("ejBfR"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/dockerfile/dockerfile.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "dockerfile",
    extensions: [
        ".dockerfile"
    ],
    filenames: [
        "Dockerfile"
    ],
    aliases: [
        "Dockerfile"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("1pdE9"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/ecl/ecl.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "ecl",
    extensions: [
        ".ecl"
    ],
    aliases: [
        "ECL",
        "Ecl",
        "ecl"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("8JqGm"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/elixir/elixir.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "elixir",
    extensions: [
        ".ex",
        ".exs"
    ],
    aliases: [
        "Elixir",
        "elixir",
        "ex"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("eCWTD"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/flow9/flow9.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "flow9",
    extensions: [
        ".flow"
    ],
    aliases: [
        "Flow9",
        "Flow",
        "flow9",
        "flow"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("9VxLl"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/fsharp/fsharp.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "fsharp",
    extensions: [
        ".fs",
        ".fsi",
        ".ml",
        ".mli",
        ".fsx",
        ".fsscript"
    ],
    aliases: [
        "F#",
        "FSharp",
        "fsharp"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("hmwGW"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/freemarker2/freemarker2.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "freemarker2",
    extensions: [
        ".ftl",
        ".ftlh",
        ".ftlx"
    ],
    aliases: [
        "FreeMarker2",
        "Apache FreeMarker2"
    ],
    loader: ()=>{
        var resolve, reject, m;
        return (parcelRequire("eO6t4")).then((m)=>m.TagAutoInterpolationDollar);
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "freemarker2.tag-angle.interpolation-dollar",
    aliases: [
        "FreeMarker2 (Angle/Dollar)",
        "Apache FreeMarker2 (Angle/Dollar)"
    ],
    loader: ()=>{
        var resolve, reject, m;
        return (parcelRequire("eO6t4")).then((m)=>m.TagAngleInterpolationDollar);
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "freemarker2.tag-bracket.interpolation-dollar",
    aliases: [
        "FreeMarker2 (Bracket/Dollar)",
        "Apache FreeMarker2 (Bracket/Dollar)"
    ],
    loader: ()=>{
        var resolve, reject, m;
        return (parcelRequire("eO6t4")).then((m)=>m.TagBracketInterpolationDollar);
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "freemarker2.tag-angle.interpolation-bracket",
    aliases: [
        "FreeMarker2 (Angle/Bracket)",
        "Apache FreeMarker2 (Angle/Bracket)"
    ],
    loader: ()=>{
        var resolve, reject, m;
        return (parcelRequire("eO6t4")).then((m)=>m.TagAngleInterpolationBracket);
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "freemarker2.tag-bracket.interpolation-bracket",
    aliases: [
        "FreeMarker2 (Bracket/Bracket)",
        "Apache FreeMarker2 (Bracket/Bracket)"
    ],
    loader: ()=>{
        var resolve, reject, m;
        return (parcelRequire("eO6t4")).then((m)=>m.TagBracketInterpolationBracket);
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "freemarker2.tag-auto.interpolation-dollar",
    aliases: [
        "FreeMarker2 (Auto/Dollar)",
        "Apache FreeMarker2 (Auto/Dollar)"
    ],
    loader: ()=>{
        var resolve, reject, m;
        return (parcelRequire("eO6t4")).then((m)=>m.TagAutoInterpolationDollar);
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "freemarker2.tag-auto.interpolation-bracket",
    aliases: [
        "FreeMarker2 (Auto/Bracket)",
        "Apache FreeMarker2 (Auto/Bracket)"
    ],
    loader: ()=>{
        var resolve, reject, m;
        return (parcelRequire("eO6t4")).then((m)=>m.TagAutoInterpolationBracket);
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/go/go.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "go",
    extensions: [
        ".go"
    ],
    aliases: [
        "Go"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("ihvHV"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/graphql/graphql.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "graphql",
    extensions: [
        ".graphql",
        ".gql"
    ],
    aliases: [
        "GraphQL",
        "graphql",
        "gql"
    ],
    mimetypes: [
        "application/graphql"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("2qvDC"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/handlebars/handlebars.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "handlebars",
    extensions: [
        ".handlebars",
        ".hbs"
    ],
    aliases: [
        "Handlebars",
        "handlebars",
        "hbs"
    ],
    mimetypes: [
        "text/x-handlebars-template"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("aFuPg"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/hcl/hcl.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "hcl",
    extensions: [
        ".tf",
        ".tfvars",
        ".hcl"
    ],
    aliases: [
        "Terraform",
        "tf",
        "HCL",
        "hcl"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("c8u14"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/html/html.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "html",
    extensions: [
        ".html",
        ".htm",
        ".shtml",
        ".xhtml",
        ".mdoc",
        ".jsp",
        ".asp",
        ".aspx",
        ".jshtm"
    ],
    aliases: [
        "HTML",
        "htm",
        "html",
        "xhtml"
    ],
    mimetypes: [
        "text/html",
        "text/x-jshtm",
        "text/template",
        "text/ng-template"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("f98iC"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/ini/ini.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "ini",
    extensions: [
        ".ini",
        ".properties",
        ".gitconfig"
    ],
    filenames: [
        "config",
        ".gitattributes",
        ".gitconfig",
        ".editorconfig"
    ],
    aliases: [
        "Ini",
        "ini"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("9Oaoe"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/java/java.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "java",
    extensions: [
        ".java",
        ".jav"
    ],
    aliases: [
        "Java",
        "java"
    ],
    mimetypes: [
        "text/x-java-source",
        "text/x-java"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("R52Fp"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/javascript/javascript.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "javascript",
    extensions: [
        ".js",
        ".es6",
        ".jsx",
        ".mjs",
        ".cjs"
    ],
    firstLine: "^#!.*\\bnode",
    filenames: [
        "jakefile"
    ],
    aliases: [
        "JavaScript",
        "javascript",
        "js"
    ],
    mimetypes: [
        "text/javascript"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("k4b1A"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/julia/julia.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "julia",
    extensions: [
        ".jl"
    ],
    aliases: [
        "julia",
        "Julia"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("aFO3O"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/kotlin/kotlin.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "kotlin",
    extensions: [
        ".kt",
        ".kts"
    ],
    aliases: [
        "Kotlin",
        "kotlin"
    ],
    mimetypes: [
        "text/x-kotlin-source",
        "text/x-kotlin"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("hIJ87"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/less/less.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "less",
    extensions: [
        ".less"
    ],
    aliases: [
        "Less",
        "less"
    ],
    mimetypes: [
        "text/x-less",
        "text/less"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("f7hMd"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/lexon/lexon.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "lexon",
    extensions: [
        ".lex"
    ],
    aliases: [
        "Lexon"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("lsdO9"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/lua/lua.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "lua",
    extensions: [
        ".lua"
    ],
    aliases: [
        "Lua",
        "lua"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("fjbXu"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/liquid/liquid.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "liquid",
    extensions: [
        ".liquid",
        ".html.liquid"
    ],
    aliases: [
        "Liquid",
        "liquid"
    ],
    mimetypes: [
        "application/liquid"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("ejMTo"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/m3/m3.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "m3",
    extensions: [
        ".m3",
        ".i3",
        ".mg",
        ".ig"
    ],
    aliases: [
        "Modula-3",
        "Modula3",
        "modula3",
        "m3"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("famXw"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/markdown/markdown.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "markdown",
    extensions: [
        ".md",
        ".markdown",
        ".mdown",
        ".mkdn",
        ".mkd",
        ".mdwn",
        ".mdtxt",
        ".mdtext"
    ],
    aliases: [
        "Markdown",
        "markdown"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("kWQj6"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/mdx/mdx.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "mdx",
    extensions: [
        ".mdx"
    ],
    aliases: [
        "MDX",
        "mdx"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("cwp0z"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/mips/mips.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "mips",
    extensions: [
        ".s"
    ],
    aliases: [
        "MIPS",
        "MIPS-V"
    ],
    mimetypes: [
        "text/x-mips",
        "text/mips",
        "text/plaintext"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("2bfmW"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/msdax/msdax.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "msdax",
    extensions: [
        ".dax",
        ".msdax"
    ],
    aliases: [
        "DAX",
        "MSDAX"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("952eJ"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/mysql/mysql.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "mysql",
    extensions: [],
    aliases: [
        "MySQL",
        "mysql"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("i1kEH"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/objective-c/objective-c.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "objective-c",
    extensions: [
        ".m"
    ],
    aliases: [
        "Objective-C"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("kSYtJ"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/pascal/pascal.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "pascal",
    extensions: [
        ".pas",
        ".p",
        ".pp"
    ],
    aliases: [
        "Pascal",
        "pas"
    ],
    mimetypes: [
        "text/x-pascal-source",
        "text/x-pascal"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("02rhT"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/pascaligo/pascaligo.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "pascaligo",
    extensions: [
        ".ligo"
    ],
    aliases: [
        "Pascaligo",
        "ligo"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("8BA2O"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/perl/perl.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "perl",
    extensions: [
        ".pl",
        ".pm"
    ],
    aliases: [
        "Perl",
        "pl"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("c0GZv"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/pgsql/pgsql.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "pgsql",
    extensions: [],
    aliases: [
        "PostgreSQL",
        "postgres",
        "pg",
        "postgre"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("5nv7N"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/php/php.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "php",
    extensions: [
        ".php",
        ".php4",
        ".php5",
        ".phtml",
        ".ctp"
    ],
    aliases: [
        "PHP",
        "php"
    ],
    mimetypes: [
        "application/x-php"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("Z9E90"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/pla/pla.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "pla",
    extensions: [
        ".pla"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("7lIAy"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/postiats/postiats.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "postiats",
    extensions: [
        ".dats",
        ".sats",
        ".hats"
    ],
    aliases: [
        "ATS",
        "ATS/Postiats"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("1m6gW"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/powerquery/powerquery.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "powerquery",
    extensions: [
        ".pq",
        ".pqm"
    ],
    aliases: [
        "PQ",
        "M",
        "Power Query",
        "Power Query M"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("83pzg"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/powershell/powershell.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "powershell",
    extensions: [
        ".ps1",
        ".psm1",
        ".psd1"
    ],
    aliases: [
        "PowerShell",
        "powershell",
        "ps",
        "ps1"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("iV5fB"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/protobuf/protobuf.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "proto",
    extensions: [
        ".proto"
    ],
    aliases: [
        "protobuf",
        "Protocol Buffers"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("5z1Kg"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/pug/pug.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "pug",
    extensions: [
        ".jade",
        ".pug"
    ],
    aliases: [
        "Pug",
        "Jade",
        "jade"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("Zy786"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/python/python.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "python",
    extensions: [
        ".py",
        ".rpy",
        ".pyw",
        ".cpy",
        ".gyp",
        ".gypi"
    ],
    aliases: [
        "Python",
        "py"
    ],
    firstLine: "^#!/.*\\bpython[0-9.-]*\\b",
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("jUtzh"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/qsharp/qsharp.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "qsharp",
    extensions: [
        ".qs"
    ],
    aliases: [
        "Q#",
        "qsharp"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("8HXMm"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/r/r.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "r",
    extensions: [
        ".r",
        ".rhistory",
        ".rmd",
        ".rprofile",
        ".rt"
    ],
    aliases: [
        "R",
        "r"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("eEIAy"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/razor/razor.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "razor",
    extensions: [
        ".cshtml"
    ],
    aliases: [
        "Razor",
        "razor"
    ],
    mimetypes: [
        "text/x-cshtml"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("6OrKv"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/redis/redis.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "redis",
    extensions: [
        ".redis"
    ],
    aliases: [
        "redis"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("eGc08"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/redshift/redshift.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "redshift",
    extensions: [],
    aliases: [
        "Redshift",
        "redshift"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("88bCE"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/restructuredtext/restructuredtext.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "restructuredtext",
    extensions: [
        ".rst"
    ],
    aliases: [
        "reStructuredText",
        "restructuredtext"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("4F3x8"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/ruby/ruby.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "ruby",
    extensions: [
        ".rb",
        ".rbx",
        ".rjs",
        ".gemspec",
        ".pp"
    ],
    filenames: [
        "rakefile",
        "Gemfile"
    ],
    aliases: [
        "Ruby",
        "rb"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("1qZZt"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/rust/rust.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "rust",
    extensions: [
        ".rs",
        ".rlib"
    ],
    aliases: [
        "Rust",
        "rust"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("aqAKG"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/sb/sb.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "sb",
    extensions: [
        ".sb"
    ],
    aliases: [
        "Small Basic",
        "sb"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("dSMC1"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/scala/scala.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "scala",
    extensions: [
        ".scala",
        ".sc",
        ".sbt"
    ],
    aliases: [
        "Scala",
        "scala",
        "SBT",
        "Sbt",
        "sbt",
        "Dotty",
        "dotty"
    ],
    mimetypes: [
        "text/x-scala-source",
        "text/x-scala",
        "text/x-sbt",
        "text/x-dotty"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("50Wit"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/scheme/scheme.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "scheme",
    extensions: [
        ".scm",
        ".ss",
        ".sch",
        ".rkt"
    ],
    aliases: [
        "scheme",
        "Scheme"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("gi5kB"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/scss/scss.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "scss",
    extensions: [
        ".scss"
    ],
    aliases: [
        "Sass",
        "sass",
        "scss"
    ],
    mimetypes: [
        "text/x-scss",
        "text/scss"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("5Wosx"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/shell/shell.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "shell",
    extensions: [
        ".sh",
        ".bash"
    ],
    aliases: [
        "Shell",
        "sh"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("hq9Mo"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/solidity/solidity.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "sol",
    extensions: [
        ".sol"
    ],
    aliases: [
        "sol",
        "solidity",
        "Solidity"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("lXZHW"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/sophia/sophia.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "aes",
    extensions: [
        ".aes"
    ],
    aliases: [
        "aes",
        "sophia",
        "Sophia"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("92BKv"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/sparql/sparql.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "sparql",
    extensions: [
        ".rq"
    ],
    aliases: [
        "sparql",
        "SPARQL"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("8GhjX"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/sql/sql.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "sql",
    extensions: [
        ".sql"
    ],
    aliases: [
        "SQL"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("lRud8"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/st/st.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "st",
    extensions: [
        ".st",
        ".iecst",
        ".iecplc",
        ".lc3lib",
        ".TcPOU",
        ".TcDUT",
        ".TcGVL",
        ".TcIO"
    ],
    aliases: [
        "StructuredText",
        "scl",
        "stl"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("deU0K"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/swift/swift.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "swift",
    aliases: [
        "Swift",
        "swift"
    ],
    extensions: [
        ".swift"
    ],
    mimetypes: [
        "text/swift"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("jTma8"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/systemverilog/systemverilog.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "systemverilog",
    extensions: [
        ".sv",
        ".svh"
    ],
    aliases: [
        "SV",
        "sv",
        "SystemVerilog",
        "systemverilog"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("kRHKl"));
    }
});

(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "verilog",
    extensions: [
        ".v",
        ".vh"
    ],
    aliases: [
        "V",
        "v",
        "Verilog",
        "verilog"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("kRHKl"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/tcl/tcl.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "tcl",
    extensions: [
        ".tcl"
    ],
    aliases: [
        "tcl",
        "Tcl",
        "tcltk",
        "TclTk",
        "tcl/tk",
        "Tcl/Tk"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("fzODu"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/twig/twig.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "twig",
    extensions: [
        ".twig"
    ],
    aliases: [
        "Twig",
        "twig"
    ],
    mimetypes: [
        "text/x-twig"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("cac8S"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/typescript/typescript.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "typescript",
    extensions: [
        ".ts",
        ".tsx",
        ".cts",
        ".mts"
    ],
    aliases: [
        "TypeScript",
        "ts",
        "typescript"
    ],
    mimetypes: [
        "text/typescript"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("4c0YH"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/typespec/typespec.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "typespec",
    extensions: [
        ".tsp"
    ],
    aliases: [
        "TypeSpec"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("7nqAw"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/vb/vb.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "vb",
    extensions: [
        ".vb"
    ],
    aliases: [
        "Visual Basic",
        "vb"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("gK1XX"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/wgsl/wgsl.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "wgsl",
    extensions: [
        ".wgsl"
    ],
    aliases: [
        "WebGPU Shading Language",
        "WGSL",
        "wgsl"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("3WPkL"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/xml/xml.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "xml",
    extensions: [
        ".xml",
        ".xsd",
        ".dtd",
        ".ascx",
        ".csproj",
        ".config",
        ".props",
        ".targets",
        ".wxi",
        ".wxl",
        ".wxs",
        ".xaml",
        ".svg",
        ".svgz",
        ".opf",
        ".xslt",
        ".xsl"
    ],
    firstLine: "(\\<\\?xml.*)|(\\<svg)|(\\<\\!doctype\\s+svg)",
    aliases: [
        "XML",
        "xml"
    ],
    mimetypes: [
        "text/xml",
        "application/xml",
        "application/xaml+xml",
        "application/xml-dtd"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("9lIn6"));
    }
});


/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ // src/basic-languages/yaml/yaml.contribution.ts


(0, $0eeba481b8e259d4$export$b5daeabefb05ee6b)({
    id: "yaml",
    extensions: [
        ".yaml",
        ".yml"
    ],
    aliases: [
        "YAML",
        "yaml",
        "YML",
        "yml"
    ],
    mimetypes: [
        "application/x-yaml",
        "text/x-yaml"
    ],
    loader: ()=>{
        var resolve, reject;
        return (parcelRequire("eqwbp"));
    }
});





var $leKFq = parcelRequire("leKFq");
/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ var $f2734415f551a785$var$__defProp = Object.defineProperty;
var $f2734415f551a785$var$__getOwnPropDesc = Object.getOwnPropertyDescriptor;
var $f2734415f551a785$var$__getOwnPropNames = Object.getOwnPropertyNames;
var $f2734415f551a785$var$__hasOwnProp = Object.prototype.hasOwnProperty;
var $f2734415f551a785$var$__copyProps = (to, from, except, desc)=>{
    if (from && typeof from === "object" || typeof from === "function") {
        for (let key of $f2734415f551a785$var$__getOwnPropNames(from))if (!$f2734415f551a785$var$__hasOwnProp.call(to, key) && key !== except) $f2734415f551a785$var$__defProp(to, key, {
            get: ()=>from[key],
            enumerable: !(desc = $f2734415f551a785$var$__getOwnPropDesc(from, key)) || desc.enumerable
        });
    }
    return to;
};
var $f2734415f551a785$var$__reExport = (target, mod, secondTarget)=>($f2734415f551a785$var$__copyProps(target, mod, "default"), secondTarget && $f2734415f551a785$var$__copyProps(secondTarget, mod, "default"));
// src/fillers/monaco-editor-core.ts
var $f2734415f551a785$var$monaco_editor_core_exports = {};
$f2734415f551a785$var$__reExport($f2734415f551a785$var$monaco_editor_core_exports, $leKFq);
// src/language/css/monaco.contribution.ts
var $f2734415f551a785$var$LanguageServiceDefaultsImpl = class {
    constructor(languageId, options, modeConfiguration){
        this._onDidChange = new $f2734415f551a785$var$monaco_editor_core_exports.Emitter();
        this._languageId = languageId;
        this.setOptions(options);
        this.setModeConfiguration(modeConfiguration);
    }
    get onDidChange() {
        return this._onDidChange.event;
    }
    get languageId() {
        return this._languageId;
    }
    get modeConfiguration() {
        return this._modeConfiguration;
    }
    get diagnosticsOptions() {
        return this.options;
    }
    get options() {
        return this._options;
    }
    setOptions(options) {
        this._options = options || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(this);
    }
    setDiagnosticsOptions(options) {
        this.setOptions(options);
    }
    setModeConfiguration(modeConfiguration) {
        this._modeConfiguration = modeConfiguration || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(this);
    }
};
var $f2734415f551a785$var$optionsDefault = {
    validate: true,
    lint: {
        compatibleVendorPrefixes: "ignore",
        vendorPrefix: "warning",
        duplicateProperties: "warning",
        emptyRules: "warning",
        importStatement: "ignore",
        boxModel: "ignore",
        universalSelector: "ignore",
        zeroUnits: "ignore",
        fontFaceProperties: "warning",
        hexColorLength: "error",
        argumentsInColorFunction: "error",
        unknownProperties: "warning",
        ieHack: "ignore",
        unknownVendorSpecificProperties: "ignore",
        propertyIgnoredDueToDisplay: "warning",
        important: "ignore",
        float: "ignore",
        idSelector: "ignore"
    },
    data: {
        useDefaultDataProvider: true
    },
    format: {
        newlineBetweenSelectors: true,
        newlineBetweenRules: true,
        spaceAroundSelectorSeparator: false,
        braceStyle: "collapse",
        maxPreserveNewLines: void 0,
        preserveNewLines: true
    }
};
var $f2734415f551a785$var$modeConfigurationDefault = {
    completionItems: true,
    hovers: true,
    documentSymbols: true,
    definitions: true,
    references: true,
    documentHighlights: true,
    rename: true,
    colors: true,
    foldingRanges: true,
    diagnostics: true,
    selectionRanges: true,
    documentFormattingEdits: true,
    documentRangeFormattingEdits: true
};
var $f2734415f551a785$export$c2a404aa831e27bd = new $f2734415f551a785$var$LanguageServiceDefaultsImpl("css", $f2734415f551a785$var$optionsDefault, $f2734415f551a785$var$modeConfigurationDefault);
var $f2734415f551a785$export$54af320ade247add = new $f2734415f551a785$var$LanguageServiceDefaultsImpl("scss", $f2734415f551a785$var$optionsDefault, $f2734415f551a785$var$modeConfigurationDefault);
var $f2734415f551a785$export$c8aa2efd916a3011 = new $f2734415f551a785$var$LanguageServiceDefaultsImpl("less", $f2734415f551a785$var$optionsDefault, $f2734415f551a785$var$modeConfigurationDefault);
$f2734415f551a785$var$monaco_editor_core_exports.languages.css = {
    cssDefaults: $f2734415f551a785$export$c2a404aa831e27bd,
    lessDefaults: $f2734415f551a785$export$c8aa2efd916a3011,
    scssDefaults: $f2734415f551a785$export$54af320ade247add
};

function $f2734415f551a785$var$getMode() {
    var resolve, reject;
    return (parcelRequire("6EcFO"));
}
$f2734415f551a785$var$monaco_editor_core_exports.languages.onLanguage("less", ()=>{
    $f2734415f551a785$var$getMode().then((mode)=>mode.setupMode($f2734415f551a785$export$c8aa2efd916a3011));
});
$f2734415f551a785$var$monaco_editor_core_exports.languages.onLanguage("scss", ()=>{
    $f2734415f551a785$var$getMode().then((mode)=>mode.setupMode($f2734415f551a785$export$54af320ade247add));
});
$f2734415f551a785$var$monaco_editor_core_exports.languages.onLanguage("css", ()=>{
    $f2734415f551a785$var$getMode().then((mode)=>mode.setupMode($f2734415f551a785$export$c2a404aa831e27bd));
});



var $leKFq = parcelRequire("leKFq");
/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ var $9a77febeae1a49a9$var$__defProp = Object.defineProperty;
var $9a77febeae1a49a9$var$__getOwnPropDesc = Object.getOwnPropertyDescriptor;
var $9a77febeae1a49a9$var$__getOwnPropNames = Object.getOwnPropertyNames;
var $9a77febeae1a49a9$var$__hasOwnProp = Object.prototype.hasOwnProperty;
var $9a77febeae1a49a9$var$__copyProps = (to, from, except, desc)=>{
    if (from && typeof from === "object" || typeof from === "function") {
        for (let key of $9a77febeae1a49a9$var$__getOwnPropNames(from))if (!$9a77febeae1a49a9$var$__hasOwnProp.call(to, key) && key !== except) $9a77febeae1a49a9$var$__defProp(to, key, {
            get: ()=>from[key],
            enumerable: !(desc = $9a77febeae1a49a9$var$__getOwnPropDesc(from, key)) || desc.enumerable
        });
    }
    return to;
};
var $9a77febeae1a49a9$var$__reExport = (target, mod, secondTarget)=>($9a77febeae1a49a9$var$__copyProps(target, mod, "default"), secondTarget && $9a77febeae1a49a9$var$__copyProps(secondTarget, mod, "default"));
// src/fillers/monaco-editor-core.ts
var $9a77febeae1a49a9$var$monaco_editor_core_exports = {};
$9a77febeae1a49a9$var$__reExport($9a77febeae1a49a9$var$monaco_editor_core_exports, $leKFq);
// src/language/html/monaco.contribution.ts
var $9a77febeae1a49a9$var$LanguageServiceDefaultsImpl = class {
    constructor(languageId, options, modeConfiguration){
        this._onDidChange = new $9a77febeae1a49a9$var$monaco_editor_core_exports.Emitter();
        this._languageId = languageId;
        this.setOptions(options);
        this.setModeConfiguration(modeConfiguration);
    }
    get onDidChange() {
        return this._onDidChange.event;
    }
    get languageId() {
        return this._languageId;
    }
    get options() {
        return this._options;
    }
    get modeConfiguration() {
        return this._modeConfiguration;
    }
    setOptions(options) {
        this._options = options || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(this);
    }
    setModeConfiguration(modeConfiguration) {
        this._modeConfiguration = modeConfiguration || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(this);
    }
};
var $9a77febeae1a49a9$var$formatDefaults = {
    tabSize: 4,
    insertSpaces: false,
    wrapLineLength: 120,
    unformatted: 'default": "a, abbr, acronym, b, bdo, big, br, button, cite, code, dfn, em, i, img, input, kbd, label, map, object, q, samp, select, small, span, strong, sub, sup, textarea, tt, var',
    contentUnformatted: "pre",
    indentInnerHtml: false,
    preserveNewLines: true,
    maxPreserveNewLines: void 0,
    indentHandlebars: false,
    endWithNewline: false,
    extraLiners: "head, body, /html",
    wrapAttributes: "auto"
};
var $9a77febeae1a49a9$var$optionsDefault = {
    format: $9a77febeae1a49a9$var$formatDefaults,
    suggest: {},
    data: {
        useDefaultDataProvider: true
    }
};
function $9a77febeae1a49a9$var$getConfigurationDefault(languageId) {
    return {
        completionItems: true,
        hovers: true,
        documentSymbols: true,
        links: true,
        documentHighlights: true,
        rename: true,
        colors: true,
        foldingRanges: true,
        selectionRanges: true,
        diagnostics: languageId === $9a77febeae1a49a9$var$htmlLanguageId,
        // turned off for Razor and Handlebar
        documentFormattingEdits: languageId === $9a77febeae1a49a9$var$htmlLanguageId,
        // turned off for Razor and Handlebar
        documentRangeFormattingEdits: languageId === $9a77febeae1a49a9$var$htmlLanguageId
    };
}
var $9a77febeae1a49a9$var$htmlLanguageId = "html";
var $9a77febeae1a49a9$var$handlebarsLanguageId = "handlebars";
var $9a77febeae1a49a9$var$razorLanguageId = "razor";
var $9a77febeae1a49a9$export$5fef39c1049dc16a = $9a77febeae1a49a9$export$282c563ccf44ceb9($9a77febeae1a49a9$var$htmlLanguageId, $9a77febeae1a49a9$var$optionsDefault, $9a77febeae1a49a9$var$getConfigurationDefault($9a77febeae1a49a9$var$htmlLanguageId));
var $9a77febeae1a49a9$export$57db705433ed60e4 = $9a77febeae1a49a9$export$5fef39c1049dc16a.defaults;
var $9a77febeae1a49a9$export$7128923f244739ae = $9a77febeae1a49a9$export$282c563ccf44ceb9($9a77febeae1a49a9$var$handlebarsLanguageId, $9a77febeae1a49a9$var$optionsDefault, $9a77febeae1a49a9$var$getConfigurationDefault($9a77febeae1a49a9$var$handlebarsLanguageId));
var $9a77febeae1a49a9$export$d6789e1e299dadea = $9a77febeae1a49a9$export$7128923f244739ae.defaults;
var $9a77febeae1a49a9$export$c0c348172212aa68 = $9a77febeae1a49a9$export$282c563ccf44ceb9($9a77febeae1a49a9$var$razorLanguageId, $9a77febeae1a49a9$var$optionsDefault, $9a77febeae1a49a9$var$getConfigurationDefault($9a77febeae1a49a9$var$razorLanguageId));
var $9a77febeae1a49a9$export$ca427800aa66cf63 = $9a77febeae1a49a9$export$c0c348172212aa68.defaults;
$9a77febeae1a49a9$var$monaco_editor_core_exports.languages.html = {
    htmlDefaults: $9a77febeae1a49a9$export$57db705433ed60e4,
    razorDefaults: $9a77febeae1a49a9$export$ca427800aa66cf63,
    handlebarDefaults: $9a77febeae1a49a9$export$d6789e1e299dadea,
    htmlLanguageService: $9a77febeae1a49a9$export$5fef39c1049dc16a,
    handlebarLanguageService: $9a77febeae1a49a9$export$7128923f244739ae,
    razorLanguageService: $9a77febeae1a49a9$export$c0c348172212aa68,
    registerHTMLLanguageService: $9a77febeae1a49a9$export$282c563ccf44ceb9
};

function $9a77febeae1a49a9$var$getMode() {
    var resolve, reject;
    return (parcelRequire("7hQ6w"));
}
function $9a77febeae1a49a9$export$282c563ccf44ceb9(languageId, options = $9a77febeae1a49a9$var$optionsDefault, modeConfiguration = $9a77febeae1a49a9$var$getConfigurationDefault(languageId)) {
    const defaults = new $9a77febeae1a49a9$var$LanguageServiceDefaultsImpl(languageId, options, modeConfiguration);
    let mode;
    const onLanguageListener = $9a77febeae1a49a9$var$monaco_editor_core_exports.languages.onLanguage(languageId, async ()=>{
        mode = (await $9a77febeae1a49a9$var$getMode()).setupMode(defaults);
    });
    return {
        defaults: defaults,
        dispose () {
            onLanguageListener.dispose();
            mode?.dispose();
            mode = void 0;
        }
    };
}



var $leKFq = parcelRequire("leKFq");
/*!-----------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Version: 0.52.0(f6dc0eb8fce67e57f6036f4769d92c1666cdf546)
 * Released under the MIT license
 * https://github.com/microsoft/monaco-editor/blob/main/LICENSE.txt
 *-----------------------------------------------------------------------------*/ var $e338b09d9aea2590$var$__defProp = Object.defineProperty;
var $e338b09d9aea2590$var$__getOwnPropDesc = Object.getOwnPropertyDescriptor;
var $e338b09d9aea2590$var$__getOwnPropNames = Object.getOwnPropertyNames;
var $e338b09d9aea2590$var$__hasOwnProp = Object.prototype.hasOwnProperty;
var $e338b09d9aea2590$var$__copyProps = (to, from, except, desc)=>{
    if (from && typeof from === "object" || typeof from === "function") {
        for (let key of $e338b09d9aea2590$var$__getOwnPropNames(from))if (!$e338b09d9aea2590$var$__hasOwnProp.call(to, key) && key !== except) $e338b09d9aea2590$var$__defProp(to, key, {
            get: ()=>from[key],
            enumerable: !(desc = $e338b09d9aea2590$var$__getOwnPropDesc(from, key)) || desc.enumerable
        });
    }
    return to;
};
var $e338b09d9aea2590$var$__reExport = (target, mod, secondTarget)=>($e338b09d9aea2590$var$__copyProps(target, mod, "default"), secondTarget && $e338b09d9aea2590$var$__copyProps(secondTarget, mod, "default"));
// src/fillers/monaco-editor-core.ts
var $e338b09d9aea2590$var$monaco_editor_core_exports = {};
$e338b09d9aea2590$var$__reExport($e338b09d9aea2590$var$monaco_editor_core_exports, $leKFq);
// src/language/json/monaco.contribution.ts
var $e338b09d9aea2590$var$LanguageServiceDefaultsImpl = class {
    constructor(languageId, diagnosticsOptions, modeConfiguration){
        this._onDidChange = new $e338b09d9aea2590$var$monaco_editor_core_exports.Emitter();
        this._languageId = languageId;
        this.setDiagnosticsOptions(diagnosticsOptions);
        this.setModeConfiguration(modeConfiguration);
    }
    get onDidChange() {
        return this._onDidChange.event;
    }
    get languageId() {
        return this._languageId;
    }
    get modeConfiguration() {
        return this._modeConfiguration;
    }
    get diagnosticsOptions() {
        return this._diagnosticsOptions;
    }
    setDiagnosticsOptions(options) {
        this._diagnosticsOptions = options || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(this);
    }
    setModeConfiguration(modeConfiguration) {
        this._modeConfiguration = modeConfiguration || /* @__PURE__ */ Object.create(null);
        this._onDidChange.fire(this);
    }
};
var $e338b09d9aea2590$var$diagnosticDefault = {
    validate: true,
    allowComments: true,
    schemas: [],
    enableSchemaRequest: false,
    schemaRequest: "warning",
    schemaValidation: "warning",
    comments: "error",
    trailingCommas: "error"
};
var $e338b09d9aea2590$var$modeConfigurationDefault = {
    documentFormattingEdits: true,
    documentRangeFormattingEdits: true,
    completionItems: true,
    hovers: true,
    documentSymbols: true,
    tokens: true,
    colors: true,
    foldingRanges: true,
    diagnostics: true,
    selectionRanges: true
};
var $e338b09d9aea2590$export$f9a800bb9a97e438 = new $e338b09d9aea2590$var$LanguageServiceDefaultsImpl("json", $e338b09d9aea2590$var$diagnosticDefault, $e338b09d9aea2590$var$modeConfigurationDefault);
var $e338b09d9aea2590$export$1df3c82ba2084fe8 = ()=>$e338b09d9aea2590$var$getMode().then((mode)=>mode.getWorker());
$e338b09d9aea2590$var$monaco_editor_core_exports.languages.json = {
    jsonDefaults: $e338b09d9aea2590$export$f9a800bb9a97e438,
    getWorker: $e338b09d9aea2590$export$1df3c82ba2084fe8
};

function $e338b09d9aea2590$var$getMode() {
    var resolve, reject;
    return (parcelRequire("57gYB"));
}
$e338b09d9aea2590$var$monaco_editor_core_exports.languages.register({
    id: "json",
    extensions: [
        ".json",
        ".bowerrc",
        ".jshintrc",
        ".jscsrc",
        ".eslintrc",
        ".babelrc",
        ".har"
    ],
    aliases: [
        "JSON",
        "json"
    ],
    mimetypes: [
        "application/json"
    ]
});
$e338b09d9aea2590$var$monaco_editor_core_exports.languages.onLanguage("json", ()=>{
    $e338b09d9aea2590$var$getMode().then((mode)=>mode.setupMode($e338b09d9aea2590$export$f9a800bb9a97e438));
});


parcelRequire("2RFCG");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ parcelRequire("1uQAu");
parcelRequire("62QtC");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $awgRE = parcelRequire("awgRE");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $awgRE = parcelRequire("awgRE");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $445wM = parcelRequire("445wM");

var $ibKGQ = parcelRequire("ibKGQ");

var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");
parcelRequire("a6rxD");
class $d1fa78dc4a96b283$export$6d21753fe6637a85 extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'diffEditor.toggleCollapseUnchangedRegions',
            title: (0, $4dEdH.localize2)('toggleCollapseUnchangedRegions', 'Toggle Collapse Unchanged Regions'),
            icon: (0, $awgRE.Codicon).map,
            toggled: (0, $cxCeF.ContextKeyExpr).has('config.diffEditor.hideUnchangedRegions.enabled'),
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'),
            menu: {
                when: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'),
                id: (0, $g4v7E.MenuId).EditorTitle,
                order: 22,
                group: 'navigation'
            }
        });
    }
    run(accessor, ...args) {
        const configurationService = accessor.get((0, $35IZ9.IConfigurationService));
        const newValue = !configurationService.getValue('diffEditor.hideUnchangedRegions.enabled');
        configurationService.updateValue('diffEditor.hideUnchangedRegions.enabled', newValue);
    }
}
class $d1fa78dc4a96b283$export$eabdf28c9c7940fd extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'diffEditor.toggleShowMovedCodeBlocks',
            title: (0, $4dEdH.localize2)('toggleShowMovedCodeBlocks', 'Toggle Show Moved Code Blocks'),
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor')
        });
    }
    run(accessor, ...args) {
        const configurationService = accessor.get((0, $35IZ9.IConfigurationService));
        const newValue = !configurationService.getValue('diffEditor.experimental.showMoves');
        configurationService.updateValue('diffEditor.experimental.showMoves', newValue);
    }
}
class $d1fa78dc4a96b283$export$4a08c1c071365431 extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'diffEditor.toggleUseInlineViewWhenSpaceIsLimited',
            title: (0, $4dEdH.localize2)('toggleUseInlineViewWhenSpaceIsLimited', 'Toggle Use Inline View When Space Is Limited'),
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor')
        });
    }
    run(accessor, ...args) {
        const configurationService = accessor.get((0, $35IZ9.IConfigurationService));
        const newValue = !configurationService.getValue('diffEditor.useInlineViewWhenSpaceIsLimited');
        configurationService.updateValue('diffEditor.useInlineViewWhenSpaceIsLimited', newValue);
    }
}
const $d1fa78dc4a96b283$var$diffEditorCategory = (0, $4dEdH.localize2)('diffEditor', "Diff Editor");
class $d1fa78dc4a96b283$export$de6ddce2e02a4146 extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'diffEditor.switchSide',
            title: (0, $4dEdH.localize2)('switchSide', 'Switch Side'),
            icon: (0, $awgRE.Codicon).arrowSwap,
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'),
            f1: true,
            category: $d1fa78dc4a96b283$var$diffEditorCategory
        });
    }
    runEditorCommand(accessor, editor, arg) {
        const diffEditor = $d1fa78dc4a96b283$export$71e3025c429e80c8(accessor);
        if (diffEditor instanceof (0, $445wM.DiffEditorWidget)) {
            if (arg && arg.dryRun) return {
                destinationSelection: diffEditor.mapToOtherSide().destinationSelection
            };
            else diffEditor.switchSide();
        }
        return undefined;
    }
}
class $d1fa78dc4a96b283$export$55ee527417dbb2ee extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'diffEditor.exitCompareMove',
            title: (0, $4dEdH.localize2)('exitCompareMove', 'Exit Compare Move'),
            icon: (0, $awgRE.Codicon).close,
            precondition: (0, $ibKGQ.EditorContextKeys).comparingMovedCode,
            f1: false,
            category: $d1fa78dc4a96b283$var$diffEditorCategory,
            keybinding: {
                weight: 10000,
                primary: 9 /* KeyCode.Escape */ 
            }
        });
    }
    runEditorCommand(accessor, editor, ...args) {
        const diffEditor = $d1fa78dc4a96b283$export$71e3025c429e80c8(accessor);
        if (diffEditor instanceof (0, $445wM.DiffEditorWidget)) diffEditor.exitCompareMove();
    }
}
class $d1fa78dc4a96b283$export$f2fc9a16f215a209 extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'diffEditor.collapseAllUnchangedRegions',
            title: (0, $4dEdH.localize2)('collapseAllUnchangedRegions', 'Collapse All Unchanged Regions'),
            icon: (0, $awgRE.Codicon).fold,
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'),
            f1: true,
            category: $d1fa78dc4a96b283$var$diffEditorCategory
        });
    }
    runEditorCommand(accessor, editor, ...args) {
        const diffEditor = $d1fa78dc4a96b283$export$71e3025c429e80c8(accessor);
        if (diffEditor instanceof (0, $445wM.DiffEditorWidget)) diffEditor.collapseAllUnchangedRegions();
    }
}
class $d1fa78dc4a96b283$export$6234990522e48f24 extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'diffEditor.showAllUnchangedRegions',
            title: (0, $4dEdH.localize2)('showAllUnchangedRegions', 'Show All Unchanged Regions'),
            icon: (0, $awgRE.Codicon).unfold,
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'),
            f1: true,
            category: $d1fa78dc4a96b283$var$diffEditorCategory
        });
    }
    runEditorCommand(accessor, editor, ...args) {
        const diffEditor = $d1fa78dc4a96b283$export$71e3025c429e80c8(accessor);
        if (diffEditor instanceof (0, $445wM.DiffEditorWidget)) diffEditor.showAllUnchangedRegions();
    }
}
class $d1fa78dc4a96b283$export$f732eb3f9b9895ae extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'diffEditor.revert',
            title: (0, $4dEdH.localize2)('revert', 'Revert'),
            f1: false,
            category: $d1fa78dc4a96b283$var$diffEditorCategory
        });
    }
    run(accessor, arg) {
        const diffEditor = $d1fa78dc4a96b283$export$6307e2c33690172b(accessor, arg.originalUri, arg.modifiedUri);
        if (diffEditor instanceof (0, $445wM.DiffEditorWidget)) diffEditor.revertRangeMappings(arg.mapping.innerChanges ?? []);
        return undefined;
    }
}
const $d1fa78dc4a96b283$var$accessibleDiffViewerCategory = (0, $4dEdH.localize2)('accessibleDiffViewer', "Accessible Diff Viewer");
class $d1fa78dc4a96b283$export$781a03967564fc46 extends (0, $g4v7E.Action2) {
    static{
        this.id = 'editor.action.accessibleDiffViewer.next';
    }
    constructor(){
        super({
            id: $d1fa78dc4a96b283$export$781a03967564fc46.id,
            title: (0, $4dEdH.localize2)('editor.action.accessibleDiffViewer.next', 'Go to Next Difference'),
            category: $d1fa78dc4a96b283$var$accessibleDiffViewerCategory,
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'),
            keybinding: {
                primary: 65 /* KeyCode.F7 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            f1: true
        });
    }
    run(accessor) {
        const diffEditor = $d1fa78dc4a96b283$export$71e3025c429e80c8(accessor);
        diffEditor?.accessibleDiffViewerNext();
    }
}
class $d1fa78dc4a96b283$export$74c995f2a35de6e2 extends (0, $g4v7E.Action2) {
    static{
        this.id = 'editor.action.accessibleDiffViewer.prev';
    }
    constructor(){
        super({
            id: $d1fa78dc4a96b283$export$74c995f2a35de6e2.id,
            title: (0, $4dEdH.localize2)('editor.action.accessibleDiffViewer.prev', 'Go to Previous Difference'),
            category: $d1fa78dc4a96b283$var$accessibleDiffViewerCategory,
            precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'),
            keybinding: {
                primary: 1089 /* KeyCode.F7 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            f1: true
        });
    }
    run(accessor) {
        const diffEditor = $d1fa78dc4a96b283$export$71e3025c429e80c8(accessor);
        diffEditor?.accessibleDiffViewerPrev();
    }
}
function $d1fa78dc4a96b283$export$6307e2c33690172b(accessor, originalUri, modifiedUri) {
    const codeEditorService = accessor.get((0, $2Qfl0.ICodeEditorService));
    const diffEditors = codeEditorService.listDiffEditors();
    return diffEditors.find((diffEditor)=>{
        const modified = diffEditor.getModifiedEditor();
        const original = diffEditor.getOriginalEditor();
        return modified && modified.getModel()?.uri.toString() === modifiedUri.toString() && original && original.getModel()?.uri.toString() === originalUri.toString();
    }) || null;
}
function $d1fa78dc4a96b283$export$71e3025c429e80c8(accessor) {
    const codeEditorService = accessor.get((0, $2Qfl0.ICodeEditorService));
    const diffEditors = codeEditorService.listDiffEditors();
    const activeElement = (0, $bDzmQ.getActiveElement)();
    if (activeElement) for (const d of diffEditors){
        const container = d.getContainerDomNode();
        if ($d1fa78dc4a96b283$var$isElementOrParentOf(container, activeElement)) return d;
    }
    return null;
}
function $d1fa78dc4a96b283$var$isElementOrParentOf(elementOrParent, element) {
    let e = element;
    while(e){
        if (e === elementOrParent) return true;
        e = e.parentElement;
    }
    return false;
}



var $ibKGQ = parcelRequire("ibKGQ");

var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");
parcelRequire("a6rxD");
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$6d21753fe6637a85));
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$eabdf28c9c7940fd));
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$4a08c1c071365431));
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).EditorTitle, {
    command: {
        id: new (0, $d1fa78dc4a96b283$export$4a08c1c071365431)().desc.id,
        title: (0, $4dEdH.localize)('useInlineViewWhenSpaceIsLimited', "Use Inline View When Space Is Limited"),
        toggled: (0, $cxCeF.ContextKeyExpr).has('config.diffEditor.useInlineViewWhenSpaceIsLimited'),
        precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor')
    },
    order: 11,
    group: '1_diff',
    when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).diffEditorRenderSideBySideInlineBreakpointReached, (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'))
});
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).EditorTitle, {
    command: {
        id: new (0, $d1fa78dc4a96b283$export$eabdf28c9c7940fd)().desc.id,
        title: (0, $4dEdH.localize)('showMoves', "Show Moved Code Blocks"),
        icon: (0, $awgRE.Codicon).move,
        toggled: (0, $cxCeF.ContextKeyEqualsExpr).create('config.diffEditor.experimental.showMoves', true),
        precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor')
    },
    order: 10,
    group: '1_diff',
    when: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor')
});
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$f732eb3f9b9895ae));
for (const ctx of [
    {
        icon: (0, $awgRE.Codicon).arrowRight,
        key: (0, $ibKGQ.EditorContextKeys).diffEditorInlineMode.toNegated()
    },
    {
        icon: (0, $awgRE.Codicon).discard,
        key: (0, $ibKGQ.EditorContextKeys).diffEditorInlineMode
    }
]){
    (0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).DiffEditorHunkToolbar, {
        command: {
            id: new (0, $d1fa78dc4a96b283$export$f732eb3f9b9895ae)().desc.id,
            title: (0, $4dEdH.localize)('revertHunk', "Revert Block"),
            icon: ctx.icon
        },
        when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).diffEditorModifiedWritable, ctx.key),
        order: 5,
        group: 'primary'
    });
    (0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).DiffEditorSelectionToolbar, {
        command: {
            id: new (0, $d1fa78dc4a96b283$export$f732eb3f9b9895ae)().desc.id,
            title: (0, $4dEdH.localize)('revertSelection', "Revert Selection"),
            icon: ctx.icon
        },
        when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).diffEditorModifiedWritable, ctx.key),
        order: 5,
        group: 'primary'
    });
}
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$de6ddce2e02a4146));
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$55ee527417dbb2ee));
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$f2fc9a16f215a209));
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$6234990522e48f24));
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).EditorTitle, {
    command: {
        id: (0, $d1fa78dc4a96b283$export$781a03967564fc46).id,
        title: (0, $4dEdH.localize)('Open Accessible Diff Viewer', "Open Accessible Diff Viewer"),
        precondition: (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor')
    },
    order: 10,
    group: '2_diff',
    when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).accessibleDiffViewerVisible.negate(), (0, $cxCeF.ContextKeyExpr).has('isInDiffEditor'))
});
(0, $8tcMz.CommandsRegistry).registerCommandAlias('editor.action.diffReview.next', (0, $d1fa78dc4a96b283$export$781a03967564fc46).id);
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$781a03967564fc46));
(0, $8tcMz.CommandsRegistry).registerCommandAlias('editor.action.diffReview.prev', (0, $d1fa78dc4a96b283$export$74c995f2a35de6e2).id);
(0, $g4v7E.registerAction2)((0, $d1fa78dc4a96b283$export$74c995f2a35de6e2));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $aIbUW = parcelRequire("aIbUW");

var $iGmb0 = parcelRequire("iGmb0");

var $fuc8X = parcelRequire("fuc8X");


var $2iJTi = parcelRequire("2iJTi");

var $jzicX = parcelRequire("jzicX");

var $ibKGQ = parcelRequire("ibKGQ");

var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");
var $6984dc368ea0f346$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $6984dc368ea0f346$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $6984dc368ea0f346$var$SelectionAnchorController_1;
const $6984dc368ea0f346$export$3d83c0749714b612 = new (0, $cxCeF.RawContextKey)('selectionAnchorSet', false);
let $6984dc368ea0f346$var$SelectionAnchorController = class SelectionAnchorController {
    static{
        $6984dc368ea0f346$var$SelectionAnchorController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.selectionAnchorController';
    }
    static get(editor) {
        return editor.getContribution($6984dc368ea0f346$var$SelectionAnchorController_1.ID);
    }
    constructor(editor, contextKeyService){
        this.editor = editor;
        this.selectionAnchorSetContextKey = $6984dc368ea0f346$export$3d83c0749714b612.bindTo(contextKeyService);
        this.modelChangeListener = editor.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset());
    }
    setSelectionAnchor() {
        if (this.editor.hasModel()) {
            const position = this.editor.getPosition();
            this.editor.changeDecorations((accessor)=>{
                if (this.decorationId) accessor.removeDecoration(this.decorationId);
                this.decorationId = accessor.addDecoration((0, $jzicX.Selection).fromPositions(position, position), {
                    description: 'selection-anchor',
                    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
                    hoverMessage: new (0, $iGmb0.MarkdownString)().appendText((0, $4dEdH.localize)('selectionAnchor', "Selection Anchor")),
                    className: 'selection-anchor'
                });
            });
            this.selectionAnchorSetContextKey.set(!!this.decorationId);
            (0, $aIbUW.alert)((0, $4dEdH.localize)('anchorSet', "Anchor set at {0}:{1}", position.lineNumber, position.column));
        }
    }
    goToSelectionAnchor() {
        if (this.editor.hasModel() && this.decorationId) {
            const anchorPosition = this.editor.getModel().getDecorationRange(this.decorationId);
            if (anchorPosition) this.editor.setPosition(anchorPosition.getStartPosition());
        }
    }
    selectFromAnchorToCursor() {
        if (this.editor.hasModel() && this.decorationId) {
            const start = this.editor.getModel().getDecorationRange(this.decorationId);
            if (start) {
                const end = this.editor.getPosition();
                this.editor.setSelection((0, $jzicX.Selection).fromPositions(start.getStartPosition(), end));
                this.cancelSelectionAnchor();
            }
        }
    }
    cancelSelectionAnchor() {
        if (this.decorationId) {
            const decorationId = this.decorationId;
            this.editor.changeDecorations((accessor)=>{
                accessor.removeDecoration(decorationId);
                this.decorationId = undefined;
            });
            this.selectionAnchorSetContextKey.set(false);
        }
    }
    dispose() {
        this.cancelSelectionAnchor();
        this.modelChangeListener.dispose();
    }
};
$6984dc368ea0f346$var$SelectionAnchorController = $6984dc368ea0f346$var$SelectionAnchorController_1 = $6984dc368ea0f346$var$__decorate([
    $6984dc368ea0f346$var$__param(1, (0, $cxCeF.IContextKeyService))
], $6984dc368ea0f346$var$SelectionAnchorController);
class $6984dc368ea0f346$var$SetSelectionAnchor extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.setSelectionAnchor',
            label: (0, $4dEdH.localize)('setSelectionAnchor', "Set Selection Anchor"),
            alias: 'Set Selection Anchor',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2080 /* KeyCode.KeyB */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    async run(_accessor, editor) {
        $6984dc368ea0f346$var$SelectionAnchorController.get(editor)?.setSelectionAnchor();
    }
}
class $6984dc368ea0f346$var$GoToSelectionAnchor extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.goToSelectionAnchor',
            label: (0, $4dEdH.localize)('goToSelectionAnchor', "Go to Selection Anchor"),
            alias: 'Go to Selection Anchor',
            precondition: $6984dc368ea0f346$export$3d83c0749714b612
        });
    }
    async run(_accessor, editor) {
        $6984dc368ea0f346$var$SelectionAnchorController.get(editor)?.goToSelectionAnchor();
    }
}
class $6984dc368ea0f346$var$SelectFromAnchorToCursor extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.selectFromAnchorToCursor',
            label: (0, $4dEdH.localize)('selectFromAnchorToCursor', "Select from Anchor to Cursor"),
            alias: 'Select from Anchor to Cursor',
            precondition: $6984dc368ea0f346$export$3d83c0749714b612,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2089 /* KeyCode.KeyK */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    async run(_accessor, editor) {
        $6984dc368ea0f346$var$SelectionAnchorController.get(editor)?.selectFromAnchorToCursor();
    }
}
class $6984dc368ea0f346$var$CancelSelectionAnchor extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.cancelSelectionAnchor',
            label: (0, $4dEdH.localize)('cancelSelectionAnchor', "Cancel Selection Anchor"),
            alias: 'Cancel Selection Anchor',
            precondition: $6984dc368ea0f346$export$3d83c0749714b612,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 9 /* KeyCode.Escape */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    async run(_accessor, editor) {
        $6984dc368ea0f346$var$SelectionAnchorController.get(editor)?.cancelSelectionAnchor();
    }
}
(0, $2iJTi.registerEditorContribution)($6984dc368ea0f346$var$SelectionAnchorController.ID, $6984dc368ea0f346$var$SelectionAnchorController, 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorAction)($6984dc368ea0f346$var$SetSelectionAnchor);
(0, $2iJTi.registerEditorAction)($6984dc368ea0f346$var$GoToSelectionAnchor);
(0, $2iJTi.registerEditorAction)($6984dc368ea0f346$var$SelectFromAnchorToCursor);
(0, $2iJTi.registerEditorAction)($6984dc368ea0f346$var$CancelSelectionAnchor);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $9cWcn = parcelRequire("9cWcn");


var $2iJTi = parcelRequire("2iJTi");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $ibKGQ = parcelRequire("ibKGQ");

var $1Y4vr = parcelRequire("1Y4vr");

var $91ntV = parcelRequire("91ntV");

var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $gaWeX = parcelRequire("gaWeX");

var $azIPz = parcelRequire("azIPz");
const $339be9236a7ecfce$var$overviewRulerBracketMatchForeground = (0, $gaWeX.registerColor)('editorOverviewRuler.bracketMatchForeground', '#A0A0A0', $4dEdH.localize('overviewRulerBracketMatchForeground', 'Overview ruler marker color for matching brackets.'));
class $339be9236a7ecfce$var$JumpToBracketAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.jumpToBracket',
            label: $4dEdH.localize('smartSelect.jumpBracket', "Go to Bracket"),
            alias: 'Go to Bracket',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3165 /* KeyCode.Backslash */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        $339be9236a7ecfce$export$b2b226e5cffb93ca.get(editor)?.jumpToBracket();
    }
}
class $339be9236a7ecfce$var$SelectToBracketAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.selectToBracket',
            label: $4dEdH.localize('smartSelect.selectToBracket', "Select to Bracket"),
            alias: 'Select to Bracket',
            precondition: undefined,
            metadata: {
                description: $4dEdH.localize2('smartSelect.selectToBracketDescription', "Select the text inside and including the brackets or curly braces"),
                args: [
                    {
                        name: 'args',
                        schema: {
                            type: 'object',
                            properties: {
                                'selectBrackets': {
                                    type: 'boolean',
                                    default: true
                                }
                            }
                        }
                    }
                ]
            }
        });
    }
    run(accessor, editor, args) {
        let selectBrackets = true;
        if (args && args.selectBrackets === false) selectBrackets = false;
        $339be9236a7ecfce$export$b2b226e5cffb93ca.get(editor)?.selectToBracket(selectBrackets);
    }
}
class $339be9236a7ecfce$var$RemoveBracketsAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.removeBrackets',
            label: $4dEdH.localize('smartSelect.removeBrackets', "Remove Brackets"),
            alias: 'Remove Brackets',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2561 /* KeyCode.Backspace */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        $339be9236a7ecfce$export$b2b226e5cffb93ca.get(editor)?.removeBrackets(this.id);
    }
}
class $339be9236a7ecfce$var$BracketsData {
    constructor(position, brackets, options){
        this.position = position;
        this.brackets = brackets;
        this.options = options;
    }
}
class $339be9236a7ecfce$export$b2b226e5cffb93ca extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.bracketMatchingController';
    }
    static get(editor) {
        return editor.getContribution($339be9236a7ecfce$export$b2b226e5cffb93ca.ID);
    }
    constructor(editor){
        super();
        this._editor = editor;
        this._lastBracketsData = [];
        this._lastVersionId = 0;
        this._decorations = this._editor.createDecorationsCollection();
        this._updateBracketsSoon = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._updateBrackets(), 50));
        this._matchBrackets = this._editor.getOption(72 /* EditorOption.matchBrackets */ );
        this._updateBracketsSoon.schedule();
        this._register(editor.onDidChangeCursorPosition((e)=>{
            if (this._matchBrackets === 'never') // Early exit if nothing needs to be done!
            // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)
            return;
            this._updateBracketsSoon.schedule();
        }));
        this._register(editor.onDidChangeModelContent((e)=>{
            this._updateBracketsSoon.schedule();
        }));
        this._register(editor.onDidChangeModel((e)=>{
            this._lastBracketsData = [];
            this._updateBracketsSoon.schedule();
        }));
        this._register(editor.onDidChangeModelLanguageConfiguration((e)=>{
            this._lastBracketsData = [];
            this._updateBracketsSoon.schedule();
        }));
        this._register(editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(72 /* EditorOption.matchBrackets */ )) {
                this._matchBrackets = this._editor.getOption(72 /* EditorOption.matchBrackets */ );
                this._decorations.clear();
                this._lastBracketsData = [];
                this._lastVersionId = 0;
                this._updateBracketsSoon.schedule();
            }
        }));
        this._register(editor.onDidBlurEditorWidget(()=>{
            this._updateBracketsSoon.schedule();
        }));
        this._register(editor.onDidFocusEditorWidget(()=>{
            this._updateBracketsSoon.schedule();
        }));
    }
    jumpToBracket() {
        if (!this._editor.hasModel()) return;
        const model = this._editor.getModel();
        const newSelections = this._editor.getSelections().map((selection)=>{
            const position = selection.getStartPosition();
            // find matching brackets if position is on a bracket
            const brackets = model.bracketPairs.matchBracket(position);
            let newCursorPosition = null;
            if (brackets) {
                if (brackets[0].containsPosition(position) && !brackets[1].containsPosition(position)) newCursorPosition = brackets[1].getStartPosition();
                else if (brackets[1].containsPosition(position)) newCursorPosition = brackets[0].getStartPosition();
            } else {
                // find the enclosing brackets if the position isn't on a matching bracket
                const enclosingBrackets = model.bracketPairs.findEnclosingBrackets(position);
                if (enclosingBrackets) newCursorPosition = enclosingBrackets[1].getStartPosition();
                else {
                    // no enclosing brackets, try the very first next bracket
                    const nextBracket = model.bracketPairs.findNextBracket(position);
                    if (nextBracket && nextBracket.range) newCursorPosition = nextBracket.range.getStartPosition();
                }
            }
            if (newCursorPosition) return new (0, $jzicX.Selection)(newCursorPosition.lineNumber, newCursorPosition.column, newCursorPosition.lineNumber, newCursorPosition.column);
            return new (0, $jzicX.Selection)(position.lineNumber, position.column, position.lineNumber, position.column);
        });
        this._editor.setSelections(newSelections);
        this._editor.revealRange(newSelections[0]);
    }
    selectToBracket(selectBrackets) {
        if (!this._editor.hasModel()) return;
        const model = this._editor.getModel();
        const newSelections = [];
        this._editor.getSelections().forEach((selection)=>{
            const position = selection.getStartPosition();
            let brackets = model.bracketPairs.matchBracket(position);
            if (!brackets) {
                brackets = model.bracketPairs.findEnclosingBrackets(position);
                if (!brackets) {
                    const nextBracket = model.bracketPairs.findNextBracket(position);
                    if (nextBracket && nextBracket.range) brackets = model.bracketPairs.matchBracket(nextBracket.range.getStartPosition());
                }
            }
            let selectFrom = null;
            let selectTo = null;
            if (brackets) {
                brackets.sort((0, $d00il.Range).compareRangesUsingStarts);
                const [open, close] = brackets;
                selectFrom = selectBrackets ? open.getStartPosition() : open.getEndPosition();
                selectTo = selectBrackets ? close.getEndPosition() : close.getStartPosition();
                if (close.containsPosition(position)) {
                    // select backwards if the cursor was on the closing bracket
                    const tmp = selectFrom;
                    selectFrom = selectTo;
                    selectTo = tmp;
                }
            }
            if (selectFrom && selectTo) newSelections.push(new (0, $jzicX.Selection)(selectFrom.lineNumber, selectFrom.column, selectTo.lineNumber, selectTo.column));
        });
        if (newSelections.length > 0) {
            this._editor.setSelections(newSelections);
            this._editor.revealRange(newSelections[0]);
        }
    }
    removeBrackets(editSource) {
        if (!this._editor.hasModel()) return;
        const model = this._editor.getModel();
        this._editor.getSelections().forEach((selection)=>{
            const position = selection.getPosition();
            let brackets = model.bracketPairs.matchBracket(position);
            if (!brackets) brackets = model.bracketPairs.findEnclosingBrackets(position);
            if (brackets) {
                this._editor.pushUndoStop();
                this._editor.executeEdits(editSource, [
                    {
                        range: brackets[0],
                        text: ''
                    },
                    {
                        range: brackets[1],
                        text: ''
                    }
                ]);
                this._editor.pushUndoStop();
            }
        });
    }
    static{
        this._DECORATION_OPTIONS_WITH_OVERVIEW_RULER = (0, $91ntV.ModelDecorationOptions).register({
            description: 'bracket-match-overview',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            className: 'bracket-match',
            overviewRuler: {
                color: (0, $azIPz.themeColorFromId)($339be9236a7ecfce$var$overviewRulerBracketMatchForeground),
                position: (0, $1Y4vr.OverviewRulerLane).Center
            }
        });
    }
    static{
        this._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER = (0, $91ntV.ModelDecorationOptions).register({
            description: 'bracket-match-no-overview',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            className: 'bracket-match'
        });
    }
    _updateBrackets() {
        if (this._matchBrackets === 'never') return;
        this._recomputeBrackets();
        const newDecorations = [];
        let newDecorationsLen = 0;
        for (const bracketData of this._lastBracketsData){
            const brackets = bracketData.brackets;
            if (brackets) {
                newDecorations[newDecorationsLen++] = {
                    range: brackets[0],
                    options: bracketData.options
                };
                newDecorations[newDecorationsLen++] = {
                    range: brackets[1],
                    options: bracketData.options
                };
            }
        }
        this._decorations.set(newDecorations);
    }
    _recomputeBrackets() {
        if (!this._editor.hasModel() || !this._editor.hasWidgetFocus()) {
            // no model or no focus => no brackets!
            this._lastBracketsData = [];
            this._lastVersionId = 0;
            return;
        }
        const selections = this._editor.getSelections();
        if (selections.length > 100) {
            // no bracket matching for high numbers of selections
            this._lastBracketsData = [];
            this._lastVersionId = 0;
            return;
        }
        const model = this._editor.getModel();
        const versionId = model.getVersionId();
        let previousData = [];
        if (this._lastVersionId === versionId) // use the previous data only if the model is at the same version id
        previousData = this._lastBracketsData;
        const positions = [];
        let positionsLen = 0;
        for(let i = 0, len = selections.length; i < len; i++){
            const selection = selections[i];
            if (selection.isEmpty()) // will bracket match a cursor only if the selection is collapsed
            positions[positionsLen++] = selection.getStartPosition();
        }
        // sort positions for `previousData` cache hits
        if (positions.length > 1) positions.sort((0, $dcxQ7.Position).compare);
        const newData = [];
        let newDataLen = 0;
        let previousIndex = 0;
        const previousLen = previousData.length;
        for(let i = 0, len = positions.length; i < len; i++){
            const position = positions[i];
            while(previousIndex < previousLen && previousData[previousIndex].position.isBefore(position))previousIndex++;
            if (previousIndex < previousLen && previousData[previousIndex].position.equals(position)) newData[newDataLen++] = previousData[previousIndex];
            else {
                let brackets = model.bracketPairs.matchBracket(position, 20 /* give at most 20ms to compute */ );
                let options = $339be9236a7ecfce$export$b2b226e5cffb93ca._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;
                if (!brackets && this._matchBrackets === 'always') {
                    brackets = model.bracketPairs.findEnclosingBrackets(position, 20 /* give at most 20ms to compute */ );
                    options = $339be9236a7ecfce$export$b2b226e5cffb93ca._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER;
                }
                newData[newDataLen++] = new $339be9236a7ecfce$var$BracketsData(position, brackets, options);
            }
        }
        this._lastBracketsData = newData;
        this._lastVersionId = versionId;
    }
}
(0, $2iJTi.registerEditorContribution)($339be9236a7ecfce$export$b2b226e5cffb93ca.ID, $339be9236a7ecfce$export$b2b226e5cffb93ca, 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $2iJTi.registerEditorAction)($339be9236a7ecfce$var$SelectToBracketAction);
(0, $2iJTi.registerEditorAction)($339be9236a7ecfce$var$JumpToBracketAction);
(0, $2iJTi.registerEditorAction)($339be9236a7ecfce$var$RemoveBracketsAction);
// Go to menu
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).MenubarGoMenu, {
    group: '5_infile_nav',
    command: {
        id: 'editor.action.jumpToBracket',
        title: $4dEdH.localize({
            key: 'miGoToBracket',
            comment: [
                '&& denotes a mnemonic'
            ]
        }, "Go to &&Bracket")
    },
    order: 2
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");
class $ae27977d48ebb544$export$2acdcd460d66aef1 {
    constructor(selection, isMovingLeft){
        this._selection = selection;
        this._isMovingLeft = isMovingLeft;
    }
    getEditOperations(model, builder) {
        if (this._selection.startLineNumber !== this._selection.endLineNumber || this._selection.isEmpty()) return;
        const lineNumber = this._selection.startLineNumber;
        const startColumn = this._selection.startColumn;
        const endColumn = this._selection.endColumn;
        if (this._isMovingLeft && startColumn === 1) return;
        if (!this._isMovingLeft && endColumn === model.getLineMaxColumn(lineNumber)) return;
        if (this._isMovingLeft) {
            const rangeBefore = new (0, $d00il.Range)(lineNumber, startColumn - 1, lineNumber, startColumn);
            const charBefore = model.getValueInRange(rangeBefore);
            builder.addEditOperation(rangeBefore, null);
            builder.addEditOperation(new (0, $d00il.Range)(lineNumber, endColumn, lineNumber, endColumn), charBefore);
        } else {
            const rangeAfter = new (0, $d00il.Range)(lineNumber, endColumn, lineNumber, endColumn + 1);
            const charAfter = model.getValueInRange(rangeAfter);
            builder.addEditOperation(rangeAfter, null);
            builder.addEditOperation(new (0, $d00il.Range)(lineNumber, startColumn, lineNumber, startColumn), charAfter);
        }
    }
    computeCursorState(model, helper) {
        if (this._isMovingLeft) return new (0, $jzicX.Selection)(this._selection.startLineNumber, this._selection.startColumn - 1, this._selection.endLineNumber, this._selection.endColumn - 1);
        else return new (0, $jzicX.Selection)(this._selection.startLineNumber, this._selection.startColumn + 1, this._selection.endLineNumber, this._selection.endColumn + 1);
    }
}



var $4dEdH = parcelRequire("4dEdH");
class $950141e4798dea23$var$MoveCaretAction extends (0, $2iJTi.EditorAction) {
    constructor(left, opts){
        super(opts);
        this.left = left;
    }
    run(accessor, editor) {
        if (!editor.hasModel()) return;
        const commands = [];
        const selections = editor.getSelections();
        for (const selection of selections)commands.push(new (0, $ae27977d48ebb544$export$2acdcd460d66aef1)(selection, this.left));
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
class $950141e4798dea23$var$MoveCaretLeftAction extends $950141e4798dea23$var$MoveCaretAction {
    constructor(){
        super(true, {
            id: 'editor.action.moveCarretLeftAction',
            label: $4dEdH.localize('caret.moveLeft', "Move Selected Text Left"),
            alias: 'Move Selected Text Left',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
class $950141e4798dea23$var$MoveCaretRightAction extends $950141e4798dea23$var$MoveCaretAction {
    constructor(){
        super(false, {
            id: 'editor.action.moveCarretRightAction',
            label: $4dEdH.localize('caret.moveRight', "Move Selected Text Right"),
            alias: 'Move Selected Text Right',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
(0, $2iJTi.registerEditorAction)($950141e4798dea23$var$MoveCaretLeftAction);
(0, $2iJTi.registerEditorAction)($950141e4798dea23$var$MoveCaretRightAction);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $5TVJR = parcelRequire("5TVJR");

var $5t4Qs = parcelRequire("5t4Qs");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $4dEdH = parcelRequire("4dEdH");
class $284a81ad8288b798$var$TransposeLettersAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.transposeLetters',
            label: $4dEdH.localize('transposeLetters.label', "Transpose Letters"),
            alias: 'Transpose Letters',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 306 /* KeyCode.KeyT */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        if (!editor.hasModel()) return;
        const model = editor.getModel();
        const commands = [];
        const selections = editor.getSelections();
        for (const selection of selections){
            if (!selection.isEmpty()) continue;
            const lineNumber = selection.startLineNumber;
            const column = selection.startColumn;
            const lastColumn = model.getLineMaxColumn(lineNumber);
            if (lineNumber === 1 && (column === 1 || column === 2 && lastColumn === 2)) continue;
            // handle special case: when at end of line, transpose left two chars
            // otherwise, transpose left and right chars
            const endPosition = column === lastColumn ? selection.getPosition() : (0, $5t4Qs.MoveOperations).rightPosition(model, selection.getPosition().lineNumber, selection.getPosition().column);
            const middlePosition = (0, $5t4Qs.MoveOperations).leftPosition(model, endPosition);
            const beginPosition = (0, $5t4Qs.MoveOperations).leftPosition(model, middlePosition);
            const leftChar = model.getValueInRange((0, $d00il.Range).fromPositions(beginPosition, middlePosition));
            const rightChar = model.getValueInRange((0, $d00il.Range).fromPositions(middlePosition, endPosition));
            const replaceRange = (0, $d00il.Range).fromPositions(beginPosition, endPosition);
            commands.push(new (0, $5TVJR.ReplaceCommand)(replaceRange, rightChar + leftChar));
        }
        if (commands.length > 0) {
            editor.pushUndoStop();
            editor.executeCommands(this.id, commands);
            editor.pushUndoStop();
        }
    }
}
(0, $2iJTi.registerEditorAction)($284a81ad8288b798$var$TransposeLettersAction);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5yY14 = parcelRequire("5yY14");

var $bDzmQ = parcelRequire("bDzmQ");

var $lb0Ah = parcelRequire("lb0Ah");

var $al9cc = parcelRequire("al9cc");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $6CAkM = parcelRequire("6CAkM");
const $0805a875738ca87e$export$1c3aefb711c3a4cc = function() {
    // use `randomUUID` if possible
    if (typeof crypto === 'object' && typeof crypto.randomUUID === 'function') return crypto.randomUUID.bind(crypto);
    // use `randomValues` if possible
    let getRandomValues;
    if (typeof crypto === 'object' && typeof crypto.getRandomValues === 'function') getRandomValues = crypto.getRandomValues.bind(crypto);
    else getRandomValues = function(bucket) {
        for(let i = 0; i < bucket.length; i++)bucket[i] = Math.floor(Math.random() * 256);
        return bucket;
    };
    // prep-work
    const _data = new Uint8Array(16);
    const _hex = [];
    for(let i = 0; i < 256; i++)_hex.push(i.toString(16).padStart(2, '0'));
    return function generateUuid() {
        // get data
        getRandomValues(_data);
        // set version bits
        _data[6] = _data[6] & 0x0f | 0x40;
        _data[8] = _data[8] & 0x3f | 0x80;
        // print as string
        let i = 0;
        let result = '';
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += '-';
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += '-';
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += '-';
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += '-';
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        result += _hex[_data[i++]];
        return result;
    };
}();


function $72c3141703bedf97$export$188ede8a56a46789(stringOrPromise) {
    return {
        asString: async ()=>stringOrPromise,
        asFile: ()=>undefined,
        value: typeof stringOrPromise === 'string' ? stringOrPromise : undefined
    };
}
function $72c3141703bedf97$export$793ce34c11128c(fileName, uri, data) {
    const file = {
        id: (0, $0805a875738ca87e$export$1c3aefb711c3a4cc)(),
        name: fileName,
        uri: uri,
        data: data
    };
    return {
        asString: async ()=>'',
        asFile: ()=>file,
        value: undefined
    };
}
class $72c3141703bedf97$export$f4115e29f15ca54f {
    constructor(){
        this._entries = new Map();
    }
    get size() {
        let size = 0;
        for (const _ of this._entries)size++;
        return size;
    }
    has(mimeType) {
        return this._entries.has(this.toKey(mimeType));
    }
    matches(pattern) {
        const mimes = [
            ...this._entries.keys()
        ];
        if ((0, $6CAkM.Iterable).some(this, ([_, item])=>item.asFile())) mimes.push('files');
        return $72c3141703bedf97$var$matchesMimeType_normalized($72c3141703bedf97$var$normalizeMimeType(pattern), mimes);
    }
    get(mimeType) {
        return this._entries.get(this.toKey(mimeType))?.[0];
    }
    /**
     * Add a new entry to this data transfer.
     *
     * This does not replace existing entries for `mimeType`.
     */ append(mimeType, value) {
        const existing = this._entries.get(mimeType);
        if (existing) existing.push(value);
        else this._entries.set(this.toKey(mimeType), [
            value
        ]);
    }
    /**
     * Set the entry for a given mime type.
     *
     * This replaces all existing entries for `mimeType`.
     */ replace(mimeType, value) {
        this._entries.set(this.toKey(mimeType), [
            value
        ]);
    }
    /**
     * Remove all entries for `mimeType`.
     */ delete(mimeType) {
        this._entries.delete(this.toKey(mimeType));
    }
    /**
     * Iterate over all `[mime, item]` pairs in this data transfer.
     *
     * There may be multiple entries for each mime type.
     */ *[Symbol.iterator]() {
        for (const [mine, items] of this._entries)for (const item of items)yield [
            mine,
            item
        ];
    }
    toKey(mimeType) {
        return $72c3141703bedf97$var$normalizeMimeType(mimeType);
    }
}
function $72c3141703bedf97$var$normalizeMimeType(mimeType) {
    return mimeType.toLowerCase();
}
function $72c3141703bedf97$export$13f6505549b70d23(pattern, mimeTypes) {
    return $72c3141703bedf97$var$matchesMimeType_normalized($72c3141703bedf97$var$normalizeMimeType(pattern), mimeTypes.map($72c3141703bedf97$var$normalizeMimeType));
}
function $72c3141703bedf97$var$matchesMimeType_normalized(normalizedPattern, normalizedMimeTypes) {
    // Anything wildcard
    if (normalizedPattern === '*/*') return normalizedMimeTypes.length > 0;
    // Exact match
    if (normalizedMimeTypes.includes(normalizedPattern)) return true;
    // Wildcard, such as `image/*`
    const wildcard = normalizedPattern.match(/^([a-z]+)\/([a-z]+|\*)$/i);
    if (!wildcard) return false;
    const [_, type, subtype] = wildcard;
    if (subtype === '*') return normalizedMimeTypes.some((mime)=>mime.startsWith(type + '/'));
    return false;
}
const $72c3141703bedf97$export$2d8e542162051a3f = Object.freeze({
    // http://amundsen.com/hypermedia/urilist/
    create: (entries)=>{
        return (0, $kJ8UG.distinct)(entries.map((x)=>x.toString())).join('\r\n');
    },
    split: (str)=>{
        return str.split('\r\n');
    },
    parse: (str)=>{
        return $72c3141703bedf97$export$2d8e542162051a3f.split(str).filter((value)=>!value.startsWith('#'));
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ class $b9104f11117b1d0a$export$f06724c61e87d9db {
    static{
        this.sep = '.';
    }
    static{
        this.None = new $b9104f11117b1d0a$export$f06724c61e87d9db('@@none@@');
    }
    static{
        this.Empty = new $b9104f11117b1d0a$export$f06724c61e87d9db('');
    }
    constructor(value){
        this.value = value;
    }
    equals(other) {
        return this.value === other.value;
    }
    contains(other) {
        return this.equals(other) || this.value === '' || other.value.startsWith(this.value + $b9104f11117b1d0a$export$f06724c61e87d9db.sep);
    }
    intersects(other) {
        return this.contains(other) || other.contains(this);
    }
    append(...parts) {
        return new $b9104f11117b1d0a$export$f06724c61e87d9db((this.value ? [
            this.value,
            ...parts
        ] : parts).join($b9104f11117b1d0a$export$f06724c61e87d9db.sep));
    }
}



var $9cWcn = parcelRequire("9cWcn");

var $a1Nyr = parcelRequire("a1Nyr");

var $lb0Ah = parcelRequire("lb0Ah");


var $al9cc = parcelRequire("al9cc");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kltlu = parcelRequire("kltlu");


var $a1Nyr = parcelRequire("a1Nyr");

var $5OJ54 = parcelRequire("5OJ54");

var $TezJS = parcelRequire("TezJS");
const $409d1f9a6eb890df$export$bb285110b65af605 = {
    EDITORS: 'CodeEditors',
    FILES: 'CodeFiles'
};
class $409d1f9a6eb890df$var$DragAndDropContributionRegistry {
}
const $409d1f9a6eb890df$export$152f4bb29f8263d0 = {
    DragAndDropContribution: 'workbench.contributions.dragAndDrop'
};
(0, $TezJS.Registry).add($409d1f9a6eb890df$export$152f4bb29f8263d0.DragAndDropContribution, new $409d1f9a6eb890df$var$DragAndDropContributionRegistry());
class $409d1f9a6eb890df$export$146c7b2699ebcd2 {
    static{
        this.INSTANCE = new $409d1f9a6eb890df$export$146c7b2699ebcd2();
    }
    constructor(){
    // protect against external instantiation
    }
    static getInstance() {
        return $409d1f9a6eb890df$export$146c7b2699ebcd2.INSTANCE;
    }
    hasData(proto) {
        return proto && proto === this.proto;
    }
    getData(proto) {
        if (this.hasData(proto)) return this.data;
        return undefined;
    }
} //#endregion


function $d334260af69d4b41$export$c3526c00a45abf16(dataTransfer) {
    const vsDataTransfer = new (0, $72c3141703bedf97$export$f4115e29f15ca54f)();
    for (const item of dataTransfer.items){
        const type = item.type;
        if (item.kind === 'string') {
            const asStringValue = new Promise((resolve)=>item.getAsString(resolve));
            vsDataTransfer.append(type, (0, $72c3141703bedf97$export$188ede8a56a46789)(asStringValue));
        } else if (item.kind === 'file') {
            const file = item.getAsFile();
            if (file) vsDataTransfer.append(type, $d334260af69d4b41$var$createFileDataTransferItemFromFile(file));
        }
    }
    return vsDataTransfer;
}
function $d334260af69d4b41$var$createFileDataTransferItemFromFile(file) {
    const uri = file.path ? (0, $5OJ54.URI).parse(file.path) : undefined;
    return (0, $72c3141703bedf97$export$793ce34c11128c)(file.name, uri, async ()=>{
        return new Uint8Array(await file.arrayBuffer());
    });
}
const $d334260af69d4b41$var$INTERNAL_DND_MIME_TYPES = Object.freeze([
    (0, $409d1f9a6eb890df$export$bb285110b65af605).EDITORS,
    (0, $409d1f9a6eb890df$export$bb285110b65af605).FILES,
    (0, $kltlu.DataTransfers).RESOURCES,
    (0, $kltlu.DataTransfers).INTERNAL_URI_LIST
]);
function $d334260af69d4b41$export$8766d539024a36bd(sourceDataTransfer, overwriteUriList = false) {
    const vsDataTransfer = $d334260af69d4b41$export$c3526c00a45abf16(sourceDataTransfer);
    // Try to expose the internal uri-list type as the standard type
    const uriList = vsDataTransfer.get((0, $kltlu.DataTransfers).INTERNAL_URI_LIST);
    if (uriList) vsDataTransfer.replace((0, $a1Nyr.Mimes).uriList, uriList);
    else if (overwriteUriList || !vsDataTransfer.has((0, $a1Nyr.Mimes).uriList)) {
        // Otherwise, fallback to adding dragged resources to the uri list
        const editorData = [];
        for (const item of sourceDataTransfer.items){
            const file = item.getAsFile();
            if (file) {
                const path = file.path;
                try {
                    if (path) editorData.push((0, $5OJ54.URI).file(path).toString());
                    else editorData.push((0, $5OJ54.URI).parse(file.name, true).toString());
                } catch  {
                // Parsing failed. Leave out from list
                }
            }
        }
        if (editorData.length) vsDataTransfer.replace((0, $a1Nyr.Mimes).uriList, (0, $72c3141703bedf97$export$188ede8a56a46789)((0, $72c3141703bedf97$export$2d8e542162051a3f).create(editorData)));
    }
    for (const internal of $d334260af69d4b41$var$INTERNAL_DND_MIME_TYPES)vsDataTransfer.delete(internal);
    return vsDataTransfer;
}



var $d4p5R = parcelRequire("d4p5R");

var $d00il = parcelRequire("d00il");

var $kzNQX = parcelRequire("kzNQX");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");



var $9cWcn = parcelRequire("9cWcn");

var $a1Nyr = parcelRequire("a1Nyr");

var $8GPp8 = parcelRequire("8GPp8");

var $5Aea5 = parcelRequire("5Aea5");

var $5OJ54 = parcelRequire("5OJ54");

var $kzNQX = parcelRequire("kzNQX");

var $4J6fu = parcelRequire("4J6fu");

var $4dEdH = parcelRequire("4dEdH");

var $6c7bv = parcelRequire("6c7bv");
var $e022cc124da90514$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $e022cc124da90514$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $e022cc124da90514$var$SimplePasteAndDropProvider {
    async provideDocumentPasteEdits(_model, _ranges, dataTransfer, context, token) {
        const edit = await this.getEdit(dataTransfer, token);
        if (!edit) return undefined;
        return {
            edits: [
                {
                    insertText: edit.insertText,
                    title: edit.title,
                    kind: edit.kind,
                    handledMimeType: edit.handledMimeType,
                    yieldTo: edit.yieldTo
                }
            ],
            dispose () {}
        };
    }
    async provideDocumentDropEdits(_model, _position, dataTransfer, token) {
        const edit = await this.getEdit(dataTransfer, token);
        if (!edit) return;
        return {
            edits: [
                {
                    insertText: edit.insertText,
                    title: edit.title,
                    kind: edit.kind,
                    handledMimeType: edit.handledMimeType,
                    yieldTo: edit.yieldTo
                }
            ],
            dispose () {}
        };
    }
}
class $e022cc124da90514$export$6744a7017d142b99 extends $e022cc124da90514$var$SimplePasteAndDropProvider {
    constructor(){
        super(...arguments);
        this.kind = $e022cc124da90514$export$6744a7017d142b99.kind;
        this.dropMimeTypes = [
            (0, $a1Nyr.Mimes).text
        ];
        this.pasteMimeTypes = [
            (0, $a1Nyr.Mimes).text
        ];
    }
    static{
        this.id = 'text';
    }
    static{
        this.kind = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('text.plain');
    }
    async getEdit(dataTransfer, _token) {
        const textEntry = dataTransfer.get((0, $a1Nyr.Mimes).text);
        if (!textEntry) return;
        // Suppress if there's also a uriList entry.
        // Typically the uri-list contains the same text as the text entry so showing both is confusing.
        if (dataTransfer.has((0, $a1Nyr.Mimes).uriList)) return;
        const insertText = await textEntry.asString();
        return {
            handledMimeType: (0, $a1Nyr.Mimes).text,
            title: (0, $4dEdH.localize)('text.label', "Insert Plain Text"),
            insertText: insertText,
            kind: this.kind
        };
    }
}
class $e022cc124da90514$var$PathProvider extends $e022cc124da90514$var$SimplePasteAndDropProvider {
    constructor(){
        super(...arguments);
        this.kind = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('uri.absolute');
        this.dropMimeTypes = [
            (0, $a1Nyr.Mimes).uriList
        ];
        this.pasteMimeTypes = [
            (0, $a1Nyr.Mimes).uriList
        ];
    }
    async getEdit(dataTransfer, token) {
        const entries = await $e022cc124da90514$var$extractUriList(dataTransfer);
        if (!entries.length || token.isCancellationRequested) return;
        let uriCount = 0;
        const insertText = entries.map(({ uri: uri, originalText: originalText })=>{
            if (uri.scheme === (0, $8GPp8.Schemas).file) return uri.fsPath;
            else {
                uriCount++;
                return originalText;
            }
        }).join(' ');
        let label;
        if (uriCount > 0) // Dropping at least one generic uri (such as https) so use most generic label
        label = entries.length > 1 ? (0, $4dEdH.localize)('defaultDropProvider.uriList.uris', "Insert Uris") : (0, $4dEdH.localize)('defaultDropProvider.uriList.uri', "Insert Uri");
        else // All the paths are file paths
        label = entries.length > 1 ? (0, $4dEdH.localize)('defaultDropProvider.uriList.paths', "Insert Paths") : (0, $4dEdH.localize)('defaultDropProvider.uriList.path', "Insert Path");
        return {
            handledMimeType: (0, $a1Nyr.Mimes).uriList,
            insertText: insertText,
            title: label,
            kind: this.kind
        };
    }
}
let $e022cc124da90514$var$RelativePathProvider = class RelativePathProvider extends $e022cc124da90514$var$SimplePasteAndDropProvider {
    constructor(_workspaceContextService){
        super();
        this._workspaceContextService = _workspaceContextService;
        this.kind = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('uri.relative');
        this.dropMimeTypes = [
            (0, $a1Nyr.Mimes).uriList
        ];
        this.pasteMimeTypes = [
            (0, $a1Nyr.Mimes).uriList
        ];
    }
    async getEdit(dataTransfer, token) {
        const entries = await $e022cc124da90514$var$extractUriList(dataTransfer);
        if (!entries.length || token.isCancellationRequested) return;
        const relativeUris = (0, $kJ8UG.coalesce)(entries.map(({ uri: uri })=>{
            const root = this._workspaceContextService.getWorkspaceFolder(uri);
            return root ? (0, $5Aea5.relativePath)(root.uri, uri) : undefined;
        }));
        if (!relativeUris.length) return;
        return {
            handledMimeType: (0, $a1Nyr.Mimes).uriList,
            insertText: relativeUris.join(' '),
            title: entries.length > 1 ? (0, $4dEdH.localize)('defaultDropProvider.uriList.relativePaths', "Insert Relative Paths") : (0, $4dEdH.localize)('defaultDropProvider.uriList.relativePath', "Insert Relative Path"),
            kind: this.kind
        };
    }
};
$e022cc124da90514$var$RelativePathProvider = $e022cc124da90514$var$__decorate([
    $e022cc124da90514$var$__param(0, (0, $6c7bv.IWorkspaceContextService))
], $e022cc124da90514$var$RelativePathProvider);
class $e022cc124da90514$var$PasteHtmlProvider {
    constructor(){
        this.kind = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('html');
        this.pasteMimeTypes = [
            'text/html'
        ];
        this._yieldTo = [
            {
                mimeType: (0, $a1Nyr.Mimes).text
            }
        ];
    }
    async provideDocumentPasteEdits(_model, _ranges, dataTransfer, context, token) {
        if (context.triggerKind !== (0, $kzNQX.DocumentPasteTriggerKind).PasteAs && !context.only?.contains(this.kind)) return;
        const entry = dataTransfer.get('text/html');
        const htmlText = await entry?.asString();
        if (!htmlText || token.isCancellationRequested) return;
        return {
            dispose () {},
            edits: [
                {
                    insertText: htmlText,
                    yieldTo: this._yieldTo,
                    title: (0, $4dEdH.localize)('pasteHtmlLabel', 'Insert HTML'),
                    kind: this.kind
                }
            ]
        };
    }
}
async function $e022cc124da90514$var$extractUriList(dataTransfer) {
    const urlListEntry = dataTransfer.get((0, $a1Nyr.Mimes).uriList);
    if (!urlListEntry) return [];
    const strUriList = await urlListEntry.asString();
    const entries = [];
    for (const entry of (0, $72c3141703bedf97$export$2d8e542162051a3f).parse(strUriList))try {
        entries.push({
            uri: (0, $5OJ54.URI).parse(entry),
            originalText: entry
        });
    } catch  {
    // noop
    }
    return entries;
}
let $e022cc124da90514$export$e8c24bf4c5a3f458 = class DefaultDropProvidersFeature extends (0, $9cWcn.Disposable) {
    constructor(languageFeaturesService, workspaceContextService){
        super();
        this._register(languageFeaturesService.documentDropEditProvider.register('*', new $e022cc124da90514$export$6744a7017d142b99()));
        this._register(languageFeaturesService.documentDropEditProvider.register('*', new $e022cc124da90514$var$PathProvider()));
        this._register(languageFeaturesService.documentDropEditProvider.register('*', new $e022cc124da90514$var$RelativePathProvider(workspaceContextService)));
    }
};
$e022cc124da90514$export$e8c24bf4c5a3f458 = $e022cc124da90514$var$__decorate([
    $e022cc124da90514$var$__param(0, (0, $4J6fu.ILanguageFeaturesService)),
    $e022cc124da90514$var$__param(1, (0, $6c7bv.IWorkspaceContextService))
], $e022cc124da90514$export$e8c24bf4c5a3f458);
let $e022cc124da90514$export$32088b9ed51e56d2 = class DefaultPasteProvidersFeature extends (0, $9cWcn.Disposable) {
    constructor(languageFeaturesService, workspaceContextService){
        super();
        this._register(languageFeaturesService.documentPasteEditProvider.register('*', new $e022cc124da90514$export$6744a7017d142b99()));
        this._register(languageFeaturesService.documentPasteEditProvider.register('*', new $e022cc124da90514$var$PathProvider()));
        this._register(languageFeaturesService.documentPasteEditProvider.register('*', new $e022cc124da90514$var$RelativePathProvider(workspaceContextService)));
        this._register(languageFeaturesService.documentPasteEditProvider.register('*', new $e022cc124da90514$var$PasteHtmlProvider()));
    }
};
$e022cc124da90514$export$32088b9ed51e56d2 = $e022cc124da90514$var$__decorate([
    $e022cc124da90514$var$__param(0, (0, $4J6fu.ILanguageFeaturesService)),
    $e022cc124da90514$var$__param(1, (0, $6c7bv.IWorkspaceContextService))
], $e022cc124da90514$export$32088b9ed51e56d2);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $d4p5R = parcelRequire("d4p5R");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ class $464b8f1057bff784$export$2da42535f3a161df {
    constructor(){
        this.value = '';
        this.pos = 0;
    }
    static{
        this._table = {
            [36 /* CharCode.DollarSign */ ]: 0 /* TokenType.Dollar */ ,
            [58 /* CharCode.Colon */ ]: 1 /* TokenType.Colon */ ,
            [44 /* CharCode.Comma */ ]: 2 /* TokenType.Comma */ ,
            [123 /* CharCode.OpenCurlyBrace */ ]: 3 /* TokenType.CurlyOpen */ ,
            [125 /* CharCode.CloseCurlyBrace */ ]: 4 /* TokenType.CurlyClose */ ,
            [92 /* CharCode.Backslash */ ]: 5 /* TokenType.Backslash */ ,
            [47 /* CharCode.Slash */ ]: 6 /* TokenType.Forwardslash */ ,
            [124 /* CharCode.Pipe */ ]: 7 /* TokenType.Pipe */ ,
            [43 /* CharCode.Plus */ ]: 11 /* TokenType.Plus */ ,
            [45 /* CharCode.Dash */ ]: 12 /* TokenType.Dash */ ,
            [63 /* CharCode.QuestionMark */ ]: 13 /* TokenType.QuestionMark */ 
        };
    }
    static isDigitCharacter(ch) {
        return ch >= 48 /* CharCode.Digit0 */  && ch <= 57 /* CharCode.Digit9 */ ;
    }
    static isVariableCharacter(ch) {
        return ch === 95 /* CharCode.Underline */  || ch >= 97 /* CharCode.a */  && ch <= 122 /* CharCode.z */  || ch >= 65 /* CharCode.A */  && ch <= 90 /* CharCode.Z */ ;
    }
    text(value) {
        this.value = value;
        this.pos = 0;
    }
    tokenText(token) {
        return this.value.substr(token.pos, token.len);
    }
    next() {
        if (this.pos >= this.value.length) return {
            type: 14 /* TokenType.EOF */ ,
            pos: this.pos,
            len: 0
        };
        const pos = this.pos;
        let len = 0;
        let ch = this.value.charCodeAt(pos);
        let type;
        // static types
        type = $464b8f1057bff784$export$2da42535f3a161df._table[ch];
        if (typeof type === 'number') {
            this.pos += 1;
            return {
                type: type,
                pos: pos,
                len: 1
            };
        }
        // number
        if ($464b8f1057bff784$export$2da42535f3a161df.isDigitCharacter(ch)) {
            type = 8 /* TokenType.Int */ ;
            do {
                len += 1;
                ch = this.value.charCodeAt(pos + len);
            }while ($464b8f1057bff784$export$2da42535f3a161df.isDigitCharacter(ch));
            this.pos += len;
            return {
                type: type,
                pos: pos,
                len: len
            };
        }
        // variable name
        if ($464b8f1057bff784$export$2da42535f3a161df.isVariableCharacter(ch)) {
            type = 9 /* TokenType.VariableName */ ;
            do ch = this.value.charCodeAt(pos + ++len);
            while ($464b8f1057bff784$export$2da42535f3a161df.isVariableCharacter(ch) || $464b8f1057bff784$export$2da42535f3a161df.isDigitCharacter(ch));
            this.pos += len;
            return {
                type: type,
                pos: pos,
                len: len
            };
        }
        // format
        type = 10 /* TokenType.Format */ ;
        do {
            len += 1;
            ch = this.value.charCodeAt(pos + len);
        }while (!isNaN(ch) && typeof $464b8f1057bff784$export$2da42535f3a161df._table[ch] === 'undefined' // not static token
         && !$464b8f1057bff784$export$2da42535f3a161df.isDigitCharacter(ch) // not number
         && !$464b8f1057bff784$export$2da42535f3a161df.isVariableCharacter(ch) // not variable
        );
        this.pos += len;
        return {
            type: type,
            pos: pos,
            len: len
        };
    }
}
class $464b8f1057bff784$export$e98856a975cab58e {
    constructor(){
        this._children = [];
    }
    appendChild(child) {
        if (child instanceof $464b8f1057bff784$export$5f1af8db9871e1d6 && this._children[this._children.length - 1] instanceof $464b8f1057bff784$export$5f1af8db9871e1d6) // this and previous child are text -> merge them
        this._children[this._children.length - 1].value += child.value;
        else {
            // normal adoption of child
            child.parent = this;
            this._children.push(child);
        }
        return this;
    }
    replace(child, others) {
        const { parent: parent } = child;
        const idx = parent.children.indexOf(child);
        const newChildren = parent.children.slice(0);
        newChildren.splice(idx, 1, ...others);
        parent._children = newChildren;
        (function _fixParent(children, parent) {
            for (const child of children){
                child.parent = parent;
                _fixParent(child.children, child);
            }
        })(others, parent);
    }
    get children() {
        return this._children;
    }
    get rightMostDescendant() {
        if (this._children.length > 0) return this._children[this._children.length - 1].rightMostDescendant;
        return this;
    }
    get snippet() {
        let candidate = this;
        while(true){
            if (!candidate) return undefined;
            if (candidate instanceof $464b8f1057bff784$export$263a781ea79d9666) return candidate;
            candidate = candidate.parent;
        }
    }
    toString() {
        return this.children.reduce((prev, cur)=>prev + cur.toString(), '');
    }
    len() {
        return 0;
    }
}
class $464b8f1057bff784$export$5f1af8db9871e1d6 extends $464b8f1057bff784$export$e98856a975cab58e {
    constructor(value){
        super();
        this.value = value;
    }
    toString() {
        return this.value;
    }
    len() {
        return this.value.length;
    }
    clone() {
        return new $464b8f1057bff784$export$5f1af8db9871e1d6(this.value);
    }
}
class $464b8f1057bff784$export$bdd004e571fcb996 extends $464b8f1057bff784$export$e98856a975cab58e {
}
class $464b8f1057bff784$export$84712d0562a614b8 extends $464b8f1057bff784$export$bdd004e571fcb996 {
    static compareByIndex(a, b) {
        if (a.index === b.index) return 0;
        else if (a.isFinalTabstop) return 1;
        else if (b.isFinalTabstop) return -1;
        else if (a.index < b.index) return -1;
        else if (a.index > b.index) return 1;
        else return 0;
    }
    constructor(index){
        super();
        this.index = index;
    }
    get isFinalTabstop() {
        return this.index === 0;
    }
    get choice() {
        return this._children.length === 1 && this._children[0] instanceof $464b8f1057bff784$export$32a7462f6a06cbd5 ? this._children[0] : undefined;
    }
    clone() {
        const ret = new $464b8f1057bff784$export$84712d0562a614b8(this.index);
        if (this.transform) ret.transform = this.transform.clone();
        ret._children = this.children.map((child)=>child.clone());
        return ret;
    }
}
class $464b8f1057bff784$export$32a7462f6a06cbd5 extends $464b8f1057bff784$export$e98856a975cab58e {
    constructor(){
        super(...arguments);
        this.options = [];
    }
    appendChild(marker) {
        if (marker instanceof $464b8f1057bff784$export$5f1af8db9871e1d6) {
            marker.parent = this;
            this.options.push(marker);
        }
        return this;
    }
    toString() {
        return this.options[0].value;
    }
    len() {
        return this.options[0].len();
    }
    clone() {
        const ret = new $464b8f1057bff784$export$32a7462f6a06cbd5();
        this.options.forEach(ret.appendChild, ret);
        return ret;
    }
}
class $464b8f1057bff784$export$563a914cafbdc389 extends $464b8f1057bff784$export$e98856a975cab58e {
    constructor(){
        super(...arguments);
        this.regexp = new RegExp('');
    }
    resolve(value) {
        const _this = this;
        let didMatch = false;
        let ret = value.replace(this.regexp, function() {
            didMatch = true;
            return _this._replace(Array.prototype.slice.call(arguments, 0, -2));
        });
        // when the regex didn't match and when the transform has
        // else branches, then run those
        if (!didMatch && this._children.some((child)=>child instanceof $464b8f1057bff784$export$917965fbd9eed82f && Boolean(child.elseValue))) ret = this._replace([]);
        return ret;
    }
    _replace(groups) {
        let ret = '';
        for (const marker of this._children)if (marker instanceof $464b8f1057bff784$export$917965fbd9eed82f) {
            let value = groups[marker.index] || '';
            value = marker.resolve(value);
            ret += value;
        } else ret += marker.toString();
        return ret;
    }
    toString() {
        return '';
    }
    clone() {
        const ret = new $464b8f1057bff784$export$563a914cafbdc389();
        ret.regexp = new RegExp(this.regexp.source, '' + (this.regexp.ignoreCase ? 'i' : '') + (this.regexp.global ? 'g' : ''));
        ret._children = this.children.map((child)=>child.clone());
        return ret;
    }
}
class $464b8f1057bff784$export$917965fbd9eed82f extends $464b8f1057bff784$export$e98856a975cab58e {
    constructor(index, shorthandName, ifValue, elseValue){
        super();
        this.index = index;
        this.shorthandName = shorthandName;
        this.ifValue = ifValue;
        this.elseValue = elseValue;
    }
    resolve(value) {
        if (this.shorthandName === 'upcase') return !value ? '' : value.toLocaleUpperCase();
        else if (this.shorthandName === 'downcase') return !value ? '' : value.toLocaleLowerCase();
        else if (this.shorthandName === 'capitalize') return !value ? '' : value[0].toLocaleUpperCase() + value.substr(1);
        else if (this.shorthandName === 'pascalcase') return !value ? '' : this._toPascalCase(value);
        else if (this.shorthandName === 'camelcase') return !value ? '' : this._toCamelCase(value);
        else if (Boolean(value) && typeof this.ifValue === 'string') return this.ifValue;
        else if (!Boolean(value) && typeof this.elseValue === 'string') return this.elseValue;
        else return value || '';
    }
    _toPascalCase(value) {
        const match = value.match(/[a-z0-9]+/gi);
        if (!match) return value;
        return match.map((word)=>{
            return word.charAt(0).toUpperCase() + word.substr(1);
        }).join('');
    }
    _toCamelCase(value) {
        const match = value.match(/[a-z0-9]+/gi);
        if (!match) return value;
        return match.map((word, index)=>{
            if (index === 0) return word.charAt(0).toLowerCase() + word.substr(1);
            return word.charAt(0).toUpperCase() + word.substr(1);
        }).join('');
    }
    clone() {
        const ret = new $464b8f1057bff784$export$917965fbd9eed82f(this.index, this.shorthandName, this.ifValue, this.elseValue);
        return ret;
    }
}
class $464b8f1057bff784$export$c867a5c9595a1350 extends $464b8f1057bff784$export$bdd004e571fcb996 {
    constructor(name){
        super();
        this.name = name;
    }
    resolve(resolver) {
        let value = resolver.resolve(this);
        if (this.transform) value = this.transform.resolve(value || '');
        if (value !== undefined) {
            this._children = [
                new $464b8f1057bff784$export$5f1af8db9871e1d6(value)
            ];
            return true;
        }
        return false;
    }
    clone() {
        const ret = new $464b8f1057bff784$export$c867a5c9595a1350(this.name);
        if (this.transform) ret.transform = this.transform.clone();
        ret._children = this.children.map((child)=>child.clone());
        return ret;
    }
}
function $464b8f1057bff784$var$walk(marker, visitor) {
    const stack = [
        ...marker
    ];
    while(stack.length > 0){
        const marker = stack.shift();
        const recurse = visitor(marker);
        if (!recurse) break;
        stack.unshift(...marker.children);
    }
}
class $464b8f1057bff784$export$263a781ea79d9666 extends $464b8f1057bff784$export$e98856a975cab58e {
    get placeholderInfo() {
        if (!this._placeholders) {
            // fill in placeholders
            const all = [];
            let last;
            this.walk(function(candidate) {
                if (candidate instanceof $464b8f1057bff784$export$84712d0562a614b8) {
                    all.push(candidate);
                    last = !last || last.index < candidate.index ? candidate : last;
                }
                return true;
            });
            this._placeholders = {
                all: all,
                last: last
            };
        }
        return this._placeholders;
    }
    get placeholders() {
        const { all: all } = this.placeholderInfo;
        return all;
    }
    offset(marker) {
        let pos = 0;
        let found = false;
        this.walk((candidate)=>{
            if (candidate === marker) {
                found = true;
                return false;
            }
            pos += candidate.len();
            return true;
        });
        if (!found) return -1;
        return pos;
    }
    fullLen(marker) {
        let ret = 0;
        $464b8f1057bff784$var$walk([
            marker
        ], (marker)=>{
            ret += marker.len();
            return true;
        });
        return ret;
    }
    enclosingPlaceholders(placeholder) {
        const ret = [];
        let { parent: parent } = placeholder;
        while(parent){
            if (parent instanceof $464b8f1057bff784$export$84712d0562a614b8) ret.push(parent);
            parent = parent.parent;
        }
        return ret;
    }
    resolveVariables(resolver) {
        this.walk((candidate)=>{
            if (candidate instanceof $464b8f1057bff784$export$c867a5c9595a1350) {
                if (candidate.resolve(resolver)) this._placeholders = undefined;
            }
            return true;
        });
        return this;
    }
    appendChild(child) {
        this._placeholders = undefined;
        return super.appendChild(child);
    }
    replace(child, others) {
        this._placeholders = undefined;
        return super.replace(child, others);
    }
    clone() {
        const ret = new $464b8f1057bff784$export$263a781ea79d9666();
        this._children = this.children.map((child)=>child.clone());
        return ret;
    }
    walk(visitor) {
        $464b8f1057bff784$var$walk(this.children, visitor);
    }
}
class $464b8f1057bff784$export$e073bfe8583e8fbf {
    constructor(){
        this._scanner = new $464b8f1057bff784$export$2da42535f3a161df();
        this._token = {
            type: 14 /* TokenType.EOF */ ,
            pos: 0,
            len: 0
        };
    }
    static escape(value) {
        return value.replace(/\$|}|\\/g, '\\$&');
    }
    static guessNeedsClipboard(template) {
        return /\${?CLIPBOARD/.test(template);
    }
    parse(value, insertFinalTabstop, enforceFinalTabstop) {
        const snippet = new $464b8f1057bff784$export$263a781ea79d9666();
        this.parseFragment(value, snippet);
        this.ensureFinalTabstop(snippet, enforceFinalTabstop ?? false, insertFinalTabstop ?? false);
        return snippet;
    }
    parseFragment(value, snippet) {
        const offset = snippet.children.length;
        this._scanner.text(value);
        this._token = this._scanner.next();
        while(this._parse(snippet));
        // fill in values for placeholders. the first placeholder of an index
        // that has a value defines the value for all placeholders with that index
        const placeholderDefaultValues = new Map();
        const incompletePlaceholders = [];
        snippet.walk((marker)=>{
            if (marker instanceof $464b8f1057bff784$export$84712d0562a614b8) {
                if (marker.isFinalTabstop) placeholderDefaultValues.set(0, undefined);
                else if (!placeholderDefaultValues.has(marker.index) && marker.children.length > 0) placeholderDefaultValues.set(marker.index, marker.children);
                else incompletePlaceholders.push(marker);
            }
            return true;
        });
        const fillInIncompletePlaceholder = (placeholder, stack)=>{
            const defaultValues = placeholderDefaultValues.get(placeholder.index);
            if (!defaultValues) return;
            const clone = new $464b8f1057bff784$export$84712d0562a614b8(placeholder.index);
            clone.transform = placeholder.transform;
            for (const child of defaultValues){
                const newChild = child.clone();
                clone.appendChild(newChild);
                // "recurse" on children that are again placeholders
                if (newChild instanceof $464b8f1057bff784$export$84712d0562a614b8 && placeholderDefaultValues.has(newChild.index) && !stack.has(newChild.index)) {
                    stack.add(newChild.index);
                    fillInIncompletePlaceholder(newChild, stack);
                    stack.delete(newChild.index);
                }
            }
            snippet.replace(placeholder, [
                clone
            ]);
        };
        const stack = new Set();
        for (const placeholder of incompletePlaceholders)fillInIncompletePlaceholder(placeholder, stack);
        return snippet.children.slice(offset);
    }
    ensureFinalTabstop(snippet, enforceFinalTabstop, insertFinalTabstop) {
        if (enforceFinalTabstop || insertFinalTabstop && snippet.placeholders.length > 0) {
            const finalTabstop = snippet.placeholders.find((p)=>p.index === 0);
            if (!finalTabstop) // the snippet uses placeholders but has no
            // final tabstop defined -> insert at the end
            snippet.appendChild(new $464b8f1057bff784$export$84712d0562a614b8(0));
        }
    }
    _accept(type, value) {
        if (type === undefined || this._token.type === type) {
            const ret = !value ? true : this._scanner.tokenText(this._token);
            this._token = this._scanner.next();
            return ret;
        }
        return false;
    }
    _backTo(token) {
        this._scanner.pos = token.pos + token.len;
        this._token = token;
        return false;
    }
    _until(type) {
        const start = this._token;
        while(this._token.type !== type){
            if (this._token.type === 14 /* TokenType.EOF */ ) return false;
            else if (this._token.type === 5 /* TokenType.Backslash */ ) {
                const nextToken = this._scanner.next();
                if (nextToken.type !== 0 /* TokenType.Dollar */  && nextToken.type !== 4 /* TokenType.CurlyClose */  && nextToken.type !== 5 /* TokenType.Backslash */ ) return false;
            }
            this._token = this._scanner.next();
        }
        const value = this._scanner.value.substring(start.pos, this._token.pos).replace(/\\(\$|}|\\)/g, '$1');
        this._token = this._scanner.next();
        return value;
    }
    _parse(marker) {
        return this._parseEscaped(marker) || this._parseTabstopOrVariableName(marker) || this._parseComplexPlaceholder(marker) || this._parseComplexVariable(marker) || this._parseAnything(marker);
    }
    // \$, \\, \} -> just text
    _parseEscaped(marker) {
        let value;
        if (value = this._accept(5 /* TokenType.Backslash */ , true)) {
            // saw a backslash, append escaped token or that backslash
            value = this._accept(0 /* TokenType.Dollar */ , true) || this._accept(4 /* TokenType.CurlyClose */ , true) || this._accept(5 /* TokenType.Backslash */ , true) || value;
            marker.appendChild(new $464b8f1057bff784$export$5f1af8db9871e1d6(value));
            return true;
        }
        return false;
    }
    // $foo -> variable, $1 -> tabstop
    _parseTabstopOrVariableName(parent) {
        let value;
        const token = this._token;
        const match = this._accept(0 /* TokenType.Dollar */ ) && (value = this._accept(9 /* TokenType.VariableName */ , true) || this._accept(8 /* TokenType.Int */ , true));
        if (!match) return this._backTo(token);
        parent.appendChild(/^\d+$/.test(value) ? new $464b8f1057bff784$export$84712d0562a614b8(Number(value)) : new $464b8f1057bff784$export$c867a5c9595a1350(value));
        return true;
    }
    // ${1:<children>}, ${1} -> placeholder
    _parseComplexPlaceholder(parent) {
        let index;
        const token = this._token;
        const match = this._accept(0 /* TokenType.Dollar */ ) && this._accept(3 /* TokenType.CurlyOpen */ ) && (index = this._accept(8 /* TokenType.Int */ , true));
        if (!match) return this._backTo(token);
        const placeholder = new $464b8f1057bff784$export$84712d0562a614b8(Number(index));
        if (this._accept(1 /* TokenType.Colon */ )) // ${1:<children>}
        while(true){
            // ...} -> done
            if (this._accept(4 /* TokenType.CurlyClose */ )) {
                parent.appendChild(placeholder);
                return true;
            }
            if (this._parse(placeholder)) continue;
            // fallback
            parent.appendChild(new $464b8f1057bff784$export$5f1af8db9871e1d6('${' + index + ':'));
            placeholder.children.forEach(parent.appendChild, parent);
            return true;
        }
        else if (placeholder.index > 0 && this._accept(7 /* TokenType.Pipe */ )) {
            // ${1|one,two,three|}
            const choice = new $464b8f1057bff784$export$32a7462f6a06cbd5();
            while(true){
                if (this._parseChoiceElement(choice)) {
                    if (this._accept(2 /* TokenType.Comma */ )) continue;
                    if (this._accept(7 /* TokenType.Pipe */ )) {
                        placeholder.appendChild(choice);
                        if (this._accept(4 /* TokenType.CurlyClose */ )) {
                            // ..|} -> done
                            parent.appendChild(placeholder);
                            return true;
                        }
                    }
                }
                this._backTo(token);
                return false;
            }
        } else if (this._accept(6 /* TokenType.Forwardslash */ )) {
            // ${1/<regex>/<format>/<options>}
            if (this._parseTransform(placeholder)) {
                parent.appendChild(placeholder);
                return true;
            }
            this._backTo(token);
            return false;
        } else if (this._accept(4 /* TokenType.CurlyClose */ )) {
            // ${1}
            parent.appendChild(placeholder);
            return true;
        } else // ${1 <- missing curly or colon
        return this._backTo(token);
    }
    _parseChoiceElement(parent) {
        const token = this._token;
        const values = [];
        while(true){
            if (this._token.type === 2 /* TokenType.Comma */  || this._token.type === 7 /* TokenType.Pipe */ ) break;
            let value;
            if (value = this._accept(5 /* TokenType.Backslash */ , true)) // \, \|, or \\
            value = this._accept(2 /* TokenType.Comma */ , true) || this._accept(7 /* TokenType.Pipe */ , true) || this._accept(5 /* TokenType.Backslash */ , true) || value;
            else value = this._accept(undefined, true);
            if (!value) {
                // EOF
                this._backTo(token);
                return false;
            }
            values.push(value);
        }
        if (values.length === 0) {
            this._backTo(token);
            return false;
        }
        parent.appendChild(new $464b8f1057bff784$export$5f1af8db9871e1d6(values.join('')));
        return true;
    }
    // ${foo:<children>}, ${foo} -> variable
    _parseComplexVariable(parent) {
        let name;
        const token = this._token;
        const match = this._accept(0 /* TokenType.Dollar */ ) && this._accept(3 /* TokenType.CurlyOpen */ ) && (name = this._accept(9 /* TokenType.VariableName */ , true));
        if (!match) return this._backTo(token);
        const variable = new $464b8f1057bff784$export$c867a5c9595a1350(name);
        if (this._accept(1 /* TokenType.Colon */ )) // ${foo:<children>}
        while(true){
            // ...} -> done
            if (this._accept(4 /* TokenType.CurlyClose */ )) {
                parent.appendChild(variable);
                return true;
            }
            if (this._parse(variable)) continue;
            // fallback
            parent.appendChild(new $464b8f1057bff784$export$5f1af8db9871e1d6('${' + name + ':'));
            variable.children.forEach(parent.appendChild, parent);
            return true;
        }
        else if (this._accept(6 /* TokenType.Forwardslash */ )) {
            // ${foo/<regex>/<format>/<options>}
            if (this._parseTransform(variable)) {
                parent.appendChild(variable);
                return true;
            }
            this._backTo(token);
            return false;
        } else if (this._accept(4 /* TokenType.CurlyClose */ )) {
            // ${foo}
            parent.appendChild(variable);
            return true;
        } else // ${foo <- missing curly or colon
        return this._backTo(token);
    }
    _parseTransform(parent) {
        // ...<regex>/<format>/<options>}
        const transform = new $464b8f1057bff784$export$563a914cafbdc389();
        let regexValue = '';
        let regexOptions = '';
        // (1) /regex
        while(true){
            if (this._accept(6 /* TokenType.Forwardslash */ )) break;
            let escaped;
            if (escaped = this._accept(5 /* TokenType.Backslash */ , true)) {
                escaped = this._accept(6 /* TokenType.Forwardslash */ , true) || escaped;
                regexValue += escaped;
                continue;
            }
            if (this._token.type !== 14 /* TokenType.EOF */ ) {
                regexValue += this._accept(undefined, true);
                continue;
            }
            return false;
        }
        // (2) /format
        while(true){
            if (this._accept(6 /* TokenType.Forwardslash */ )) break;
            let escaped;
            if (escaped = this._accept(5 /* TokenType.Backslash */ , true)) {
                escaped = this._accept(5 /* TokenType.Backslash */ , true) || this._accept(6 /* TokenType.Forwardslash */ , true) || escaped;
                transform.appendChild(new $464b8f1057bff784$export$5f1af8db9871e1d6(escaped));
                continue;
            }
            if (this._parseFormatString(transform) || this._parseAnything(transform)) continue;
            return false;
        }
        // (3) /option
        while(true){
            if (this._accept(4 /* TokenType.CurlyClose */ )) break;
            if (this._token.type !== 14 /* TokenType.EOF */ ) {
                regexOptions += this._accept(undefined, true);
                continue;
            }
            return false;
        }
        try {
            transform.regexp = new RegExp(regexValue, regexOptions);
        } catch (e) {
            // invalid regexp
            return false;
        }
        parent.transform = transform;
        return true;
    }
    _parseFormatString(parent) {
        const token = this._token;
        if (!this._accept(0 /* TokenType.Dollar */ )) return false;
        let complex = false;
        if (this._accept(3 /* TokenType.CurlyOpen */ )) complex = true;
        const index = this._accept(8 /* TokenType.Int */ , true);
        if (!index) {
            this._backTo(token);
            return false;
        } else if (!complex) {
            // $1
            parent.appendChild(new $464b8f1057bff784$export$917965fbd9eed82f(Number(index)));
            return true;
        } else if (this._accept(4 /* TokenType.CurlyClose */ )) {
            // ${1}
            parent.appendChild(new $464b8f1057bff784$export$917965fbd9eed82f(Number(index)));
            return true;
        } else if (!this._accept(1 /* TokenType.Colon */ )) {
            this._backTo(token);
            return false;
        }
        if (this._accept(6 /* TokenType.Forwardslash */ )) {
            // ${1:/upcase}
            const shorthand = this._accept(9 /* TokenType.VariableName */ , true);
            if (!shorthand || !this._accept(4 /* TokenType.CurlyClose */ )) {
                this._backTo(token);
                return false;
            } else {
                parent.appendChild(new $464b8f1057bff784$export$917965fbd9eed82f(Number(index), shorthand));
                return true;
            }
        } else if (this._accept(11 /* TokenType.Plus */ )) {
            // ${1:+<if>}
            const ifValue = this._until(4 /* TokenType.CurlyClose */ );
            if (ifValue) {
                parent.appendChild(new $464b8f1057bff784$export$917965fbd9eed82f(Number(index), undefined, ifValue, undefined));
                return true;
            }
        } else if (this._accept(12 /* TokenType.Dash */ )) {
            // ${2:-<else>}
            const elseValue = this._until(4 /* TokenType.CurlyClose */ );
            if (elseValue) {
                parent.appendChild(new $464b8f1057bff784$export$917965fbd9eed82f(Number(index), undefined, undefined, elseValue));
                return true;
            }
        } else if (this._accept(13 /* TokenType.QuestionMark */ )) {
            // ${2:?<if>:<else>}
            const ifValue = this._until(1 /* TokenType.Colon */ );
            if (ifValue) {
                const elseValue = this._until(4 /* TokenType.CurlyClose */ );
                if (elseValue) {
                    parent.appendChild(new $464b8f1057bff784$export$917965fbd9eed82f(Number(index), undefined, ifValue, elseValue));
                    return true;
                }
            }
        } else {
            // ${1:<else>}
            const elseValue = this._until(4 /* TokenType.CurlyClose */ );
            if (elseValue) {
                parent.appendChild(new $464b8f1057bff784$export$917965fbd9eed82f(Number(index), undefined, undefined, elseValue));
                return true;
            }
        }
        this._backTo(token);
        return false;
    }
    _parseAnything(marker) {
        if (this._token.type !== 14 /* TokenType.EOF */ ) {
            marker.appendChild(new $464b8f1057bff784$export$5f1af8db9871e1d6(this._scanner.tokenText(this._token)));
            this._accept(undefined);
            return true;
        }
        return false;
    }
}


function $d30380705d7d29a5$export$32ae37d22c3ee706(uri, ranges, edit) {
    // If the edit insert text is empty, skip applying at each range
    if (typeof edit.insertText === 'string' ? edit.insertText === '' : edit.insertText.snippet === '') return {
        edits: edit.additionalEdit?.edits ?? []
    };
    return {
        edits: [
            ...ranges.map((range)=>new (0, $d4p5R.ResourceTextEdit)(uri, {
                    range: range,
                    text: typeof edit.insertText === 'string' ? (0, $464b8f1057bff784$export$e073bfe8583e8fbf).escape(edit.insertText) + '$0' : edit.insertText.snippet,
                    insertAsSnippet: true
                })),
            ...edit.additionalEdit?.edits ?? []
        ]
    };
}
function $d30380705d7d29a5$export$6e2fd12dccb2585(edits) {
    function yieldsTo(yTo, other) {
        if ('mimeType' in yTo) return yTo.mimeType === other.handledMimeType;
        return !!other.kind && yTo.kind.contains(other.kind);
    }
    // Build list of nodes each node yields to
    const yieldsToMap = new Map();
    for (const edit of edits){
        for (const yTo of edit.yieldTo ?? [])for (const other of edits){
            if (other === edit) continue;
            if (yieldsTo(yTo, other)) {
                let arr = yieldsToMap.get(edit);
                if (!arr) {
                    arr = [];
                    yieldsToMap.set(edit, arr);
                }
                arr.push(other);
            }
        }
    }
    if (!yieldsToMap.size) return Array.from(edits);
    // Topological sort
    const visited = new Set();
    const tempStack = [];
    function visit(nodes) {
        if (!nodes.length) return [];
        const node = nodes[0];
        if (tempStack.includes(node)) {
            console.warn('Yield to cycle detected', node);
            return nodes;
        }
        if (visited.has(node)) return visit(nodes.slice(1));
        let pre = [];
        const yTo = yieldsToMap.get(node);
        if (yTo) {
            tempStack.push(node);
            pre = visit(yTo);
            tempStack.pop();
        }
        visited.add(node);
        return [
            ...pre,
            node,
            ...visit(nodes.slice(1))
        ];
    }
    return visit(Array.from(edits));
}



var $lgoyH = parcelRequire("lgoyH");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $6bXyA = parcelRequire("6bXyA");

var $awgRE = parcelRequire("awgRE");

var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $5rADe = parcelRequire("5rADe");


var $d00il = parcelRequire("d00il");

var $91ntV = parcelRequire("91ntV");

var $fdGPu = parcelRequire("fdGPu");
var $a2685003e93fe7e1$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $a2685003e93fe7e1$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $a2685003e93fe7e1$var$inlineProgressDecoration = (0, $91ntV.ModelDecorationOptions).register({
    description: 'inline-progress-widget',
    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
    showIfCollapsed: true,
    after: {
        content: (0, $jcr1R.noBreakWhitespace),
        inlineClassName: 'inline-editor-progress-decoration',
        inlineClassNameAffectsLetterSpacing: true
    }
});
class $a2685003e93fe7e1$var$InlineProgressWidget extends (0, $9cWcn.Disposable) {
    static{
        this.baseId = 'editor.widget.inlineProgressWidget';
    }
    constructor(typeId, editor, range, title, delegate){
        super();
        this.typeId = typeId;
        this.editor = editor;
        this.range = range;
        this.delegate = delegate;
        this.allowEditorOverflow = false;
        this.suppressMouseDown = true;
        this.create(title);
        this.editor.addContentWidget(this);
        this.editor.layoutContentWidget(this);
    }
    create(title) {
        this.domNode = $bDzmQ.$('.inline-progress-widget');
        this.domNode.role = 'button';
        this.domNode.title = title;
        const iconElement = $bDzmQ.$('span.icon');
        this.domNode.append(iconElement);
        iconElement.classList.add(...(0, $5rADe.ThemeIcon).asClassNameArray((0, $awgRE.Codicon).loading), 'codicon-modifier-spin');
        const updateSize = ()=>{
            const lineHeight = this.editor.getOption(67 /* EditorOption.lineHeight */ );
            this.domNode.style.height = `${lineHeight}px`;
            this.domNode.style.width = `${Math.ceil(0.8 * lineHeight)}px`;
        };
        updateSize();
        this._register(this.editor.onDidChangeConfiguration((c)=>{
            if (c.hasChanged(52 /* EditorOption.fontSize */ ) || c.hasChanged(67 /* EditorOption.lineHeight */ )) updateSize();
        }));
        this._register($bDzmQ.addDisposableListener(this.domNode, $bDzmQ.EventType.CLICK, (e)=>{
            this.delegate.cancel();
        }));
    }
    getId() {
        return $a2685003e93fe7e1$var$InlineProgressWidget.baseId + '.' + this.typeId;
    }
    getDomNode() {
        return this.domNode;
    }
    getPosition() {
        return {
            position: {
                lineNumber: this.range.startLineNumber,
                column: this.range.startColumn
            },
            preference: [
                0 /* ContentWidgetPositionPreference.EXACT */ 
            ]
        };
    }
    dispose() {
        super.dispose();
        this.editor.removeContentWidget(this);
    }
}
let $a2685003e93fe7e1$export$8913023249b8bb0c = class InlineProgressManager extends (0, $9cWcn.Disposable) {
    constructor(id, _editor, _instantiationService){
        super();
        this.id = id;
        this._editor = _editor;
        this._instantiationService = _instantiationService;
        /** Delay before showing the progress widget */ this._showDelay = 500; // ms
        this._showPromise = this._register(new (0, $9cWcn.MutableDisposable)());
        this._currentWidget = this._register(new (0, $9cWcn.MutableDisposable)());
        this._operationIdPool = 0;
        this._currentDecorations = _editor.createDecorationsCollection();
    }
    dispose() {
        super.dispose();
        this._currentDecorations.clear();
    }
    async showWhile(position, title, promise, delegate, delayOverride) {
        const operationId = this._operationIdPool++;
        this._currentOperation = operationId;
        this.clear();
        this._showPromise.value = (0, $6bXyA.disposableTimeout)(()=>{
            const range = (0, $d00il.Range).fromPositions(position);
            const decorationIds = this._currentDecorations.set([
                {
                    range: range,
                    options: $a2685003e93fe7e1$var$inlineProgressDecoration
                }
            ]);
            if (decorationIds.length > 0) this._currentWidget.value = this._instantiationService.createInstance($a2685003e93fe7e1$var$InlineProgressWidget, this.id, this._editor, range, title, delegate);
        }, delayOverride ?? this._showDelay);
        try {
            return await promise;
        } finally{
            if (this._currentOperation === operationId) {
                this.clear();
                this._currentOperation = undefined;
            }
        }
    }
    clear() {
        this._showPromise.clear();
        this._currentDecorations.clear();
        this._currentWidget.clear();
    }
};
$a2685003e93fe7e1$export$8913023249b8bb0c = $a2685003e93fe7e1$var$__decorate([
    $a2685003e93fe7e1$var$__param(2, (0, $fdGPu.IInstantiationService))
], $a2685003e93fe7e1$export$8913023249b8bb0c);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5ae8v = parcelRequire("5ae8v");

var $aIbUW = parcelRequire("aIbUW");

var $5YaSO = parcelRequire("5YaSO");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");


var $2iJTi = parcelRequire("2iJTi");

var $d00il = parcelRequire("d00il");

var $1vDLP = parcelRequire("1vDLP");

var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $iAi3o = parcelRequire("iAi3o");

var $bDzmQ = parcelRequire("bDzmQ");
var $c4b598428fae736e$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c4b598428fae736e$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $c4b598428fae736e$var$MessageController_1;
let $c4b598428fae736e$export$8c2d6d477e341dce = class MessageController {
    static{
        $c4b598428fae736e$var$MessageController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.messageController';
    }
    static{
        this.MESSAGE_VISIBLE = new (0, $cxCeF.RawContextKey)('messageVisible', false, $4dEdH.localize('messageVisible', 'Whether the editor is currently showing an inline message'));
    }
    static get(editor) {
        return editor.getContribution($c4b598428fae736e$var$MessageController_1.ID);
    }
    constructor(editor, contextKeyService, _openerService){
        this._openerService = _openerService;
        this._messageWidget = new (0, $9cWcn.MutableDisposable)();
        this._messageListeners = new (0, $9cWcn.DisposableStore)();
        this._mouseOverMessage = false;
        this._editor = editor;
        this._visible = $c4b598428fae736e$var$MessageController_1.MESSAGE_VISIBLE.bindTo(contextKeyService);
    }
    dispose() {
        this._message?.dispose();
        this._messageListeners.dispose();
        this._messageWidget.dispose();
        this._visible.reset();
    }
    showMessage(message, position) {
        (0, $aIbUW.alert)((0, $iGmb0.isMarkdownString)(message) ? message.value : message);
        this._visible.set(true);
        this._messageWidget.clear();
        this._messageListeners.clear();
        this._message = (0, $iGmb0.isMarkdownString)(message) ? (0, $5ae8v.renderMarkdown)(message, {
            actionHandler: {
                callback: (url)=>{
                    this.closeMessage();
                    (0, $1vDLP.openLinkFromMarkdown)(this._openerService, url, (0, $iGmb0.isMarkdownString)(message) ? message.isTrusted : undefined);
                },
                disposables: this._messageListeners
            }
        }) : undefined;
        this._messageWidget.value = new $c4b598428fae736e$var$MessageWidget(this._editor, position, typeof message === 'string' ? message : this._message.element);
        // close on blur (debounced to allow to tab into the message), cursor, model change, dispose
        this._messageListeners.add((0, $5YaSO.Event).debounce(this._editor.onDidBlurEditorText, (last, event)=>event, 0)(()=>{
            if (this._mouseOverMessage) return; // override when mouse over message
            if (this._messageWidget.value && $bDzmQ.isAncestor($bDzmQ.getActiveElement(), this._messageWidget.value.getDomNode())) return; // override when focus is inside the message
            this.closeMessage();
        }));
        this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage()));
        this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage()));
        this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage()));
        this._messageListeners.add($bDzmQ.addDisposableListener(this._messageWidget.value.getDomNode(), $bDzmQ.EventType.MOUSE_ENTER, ()=>this._mouseOverMessage = true, true));
        this._messageListeners.add($bDzmQ.addDisposableListener(this._messageWidget.value.getDomNode(), $bDzmQ.EventType.MOUSE_LEAVE, ()=>this._mouseOverMessage = false, true));
        // close on mouse move
        let bounds;
        this._messageListeners.add(this._editor.onMouseMove((e)=>{
            // outside the text area
            if (!e.target.position) return;
            if (!bounds) // define bounding box around position and first mouse occurance
            bounds = new (0, $d00il.Range)(position.lineNumber - 3, 1, e.target.position.lineNumber + 3, 1);
            else if (!bounds.containsPosition(e.target.position)) // check if position is still in bounds
            this.closeMessage();
        }));
    }
    closeMessage() {
        this._visible.reset();
        this._messageListeners.clear();
        if (this._messageWidget.value) this._messageListeners.add($c4b598428fae736e$var$MessageWidget.fadeOut(this._messageWidget.value));
    }
};
$c4b598428fae736e$export$8c2d6d477e341dce = $c4b598428fae736e$var$MessageController_1 = $c4b598428fae736e$var$__decorate([
    $c4b598428fae736e$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $c4b598428fae736e$var$__param(2, (0, $iAi3o.IOpenerService))
], $c4b598428fae736e$export$8c2d6d477e341dce);
const $c4b598428fae736e$var$MessageCommand = (0, $2iJTi.EditorCommand).bindToContribution($c4b598428fae736e$export$8c2d6d477e341dce.get);
(0, $2iJTi.registerEditorCommand)(new $c4b598428fae736e$var$MessageCommand({
    id: 'leaveEditorMessage',
    precondition: $c4b598428fae736e$export$8c2d6d477e341dce.MESSAGE_VISIBLE,
    handler: (c)=>c.closeMessage(),
    kbOpts: {
        weight: 130,
        primary: 9 /* KeyCode.Escape */ 
    }
}));
class $c4b598428fae736e$var$MessageWidget {
    static fadeOut(messageWidget) {
        const dispose = ()=>{
            messageWidget.dispose();
            clearTimeout(handle);
            messageWidget.getDomNode().removeEventListener('animationend', dispose);
        };
        const handle = setTimeout(dispose, 110);
        messageWidget.getDomNode().addEventListener('animationend', dispose);
        messageWidget.getDomNode().classList.add('fadeOut');
        return {
            dispose: dispose
        };
    }
    constructor(editor, { lineNumber: lineNumber, column: column }, text){
        // Editor.IContentWidget.allowEditorOverflow
        this.allowEditorOverflow = true;
        this.suppressMouseDown = false;
        this._editor = editor;
        this._editor.revealLinesInCenterIfOutsideViewport(lineNumber, lineNumber, 0 /* ScrollType.Smooth */ );
        this._position = {
            lineNumber: lineNumber,
            column: column
        };
        this._domNode = document.createElement('div');
        this._domNode.classList.add('monaco-editor-overlaymessage');
        this._domNode.style.marginLeft = '-6px';
        const anchorTop = document.createElement('div');
        anchorTop.classList.add('anchor', 'top');
        this._domNode.appendChild(anchorTop);
        const message = document.createElement('div');
        if (typeof text === 'string') {
            message.classList.add('message');
            message.textContent = text;
        } else {
            text.classList.add('message');
            message.appendChild(text);
        }
        this._domNode.appendChild(message);
        const anchorBottom = document.createElement('div');
        anchorBottom.classList.add('anchor', 'below');
        this._domNode.appendChild(anchorBottom);
        this._editor.addContentWidget(this);
        this._domNode.classList.add('fadeIn');
    }
    dispose() {
        this._editor.removeContentWidget(this);
    }
    getId() {
        return 'messageoverlay';
    }
    getDomNode() {
        return this._domNode;
    }
    getPosition() {
        return {
            position: this._position,
            preference: [
                1 /* ContentWidgetPositionPreference.ABOVE */ ,
                2 /* ContentWidgetPositionPreference.BELOW */ 
            ],
            positionAffinity: 1 /* PositionAffinity.Right */ 
        };
    }
    afterRender(position) {
        this._domNode.classList.toggle('below', position === 2 /* ContentWidgetPositionPreference.BELOW */ );
    }
}
(0, $2iJTi.registerEditorContribution)($c4b598428fae736e$export$8c2d6d477e341dce.ID, $c4b598428fae736e$export$8c2d6d477e341dce, 4 /* EditorContributionInstantiation.Lazy */ );



var $4dEdH = parcelRequire("4dEdH");

var $8QSW4 = parcelRequire("8QSW4");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $4E7vx = parcelRequire("4E7vx");

var $3XkzC = parcelRequire("3XkzC");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $lWtRZ = parcelRequire("lWtRZ");

var $cVfMQ = parcelRequire("cVfMQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $bxBg7 = parcelRequire("bxBg7");

var $4dEdH = parcelRequire("4dEdH");
function $fe4e8839960fa4d7$var$exceptionToErrorMessage(exception, verbose) {
    if (verbose && (exception.stack || exception.stacktrace)) return $4dEdH.localize('stackTrace.format', "{0}: {1}", $fe4e8839960fa4d7$var$detectSystemErrorMessage(exception), $fe4e8839960fa4d7$var$stackToString(exception.stack) || $fe4e8839960fa4d7$var$stackToString(exception.stacktrace));
    return $fe4e8839960fa4d7$var$detectSystemErrorMessage(exception);
}
function $fe4e8839960fa4d7$var$stackToString(stack) {
    if (Array.isArray(stack)) return stack.join('\n');
    return stack;
}
function $fe4e8839960fa4d7$var$detectSystemErrorMessage(exception) {
    // Custom node.js error from us
    if (exception.code === 'ERR_UNC_HOST_NOT_ALLOWED') return `${exception.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`;
    // See https://nodejs.org/api/errors.html#errors_class_system_error
    if (typeof exception.code === 'string' && typeof exception.errno === 'number' && typeof exception.syscall === 'string') return $4dEdH.localize('nodeExceptionMessage', "A system error occurred ({0})", exception.message);
    return exception.message || $4dEdH.localize('error.defaultMessage', "An unknown error occurred. Please consult the log for more details.");
}
function $fe4e8839960fa4d7$export$95506c204c060a3(error = null, verbose = false) {
    if (!error) return $4dEdH.localize('error.defaultMessage', "An unknown error occurred. Please consult the log for more details.");
    if (Array.isArray(error)) {
        const errors = $kJ8UG.coalesce(error);
        const msg = $fe4e8839960fa4d7$export$95506c204c060a3(errors[0], verbose);
        if (errors.length > 1) return $4dEdH.localize('error.moreErrors', "{0} ({1} errors in total)", msg, errors.length);
        return msg;
    }
    if ($bxBg7.isString(error)) return error;
    if (error.detail) {
        const detail = error.detail;
        if (detail.error) return $fe4e8839960fa4d7$var$exceptionToErrorMessage(detail.error, verbose);
        if (detail.exception) return $fe4e8839960fa4d7$var$exceptionToErrorMessage(detail.exception, verbose);
    }
    if (error.stack) return $fe4e8839960fa4d7$var$exceptionToErrorMessage(error, verbose);
    if (error.message) return error.message;
    return $4dEdH.localize('error.defaultMessage', "An unknown error occurred. Please consult the log for more details.");
}



var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");


var $d4p5R = parcelRequire("d4p5R");


var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $d6K7e = parcelRequire("d6K7e");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $kCOKl = parcelRequire("kCOKl");
var $3e7ef88e407e6e66$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $3e7ef88e407e6e66$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $3e7ef88e407e6e66$var$PostEditWidget_1;
let $3e7ef88e407e6e66$var$PostEditWidget = class PostEditWidget extends (0, $9cWcn.Disposable) {
    static{
        $3e7ef88e407e6e66$var$PostEditWidget_1 = this;
    }
    static{
        this.baseId = 'editor.widget.postEditWidget';
    }
    constructor(typeId, editor, visibleContext, showCommand, range, edits, onSelectNewEdit, _contextMenuService, contextKeyService, _keybindingService){
        super();
        this.typeId = typeId;
        this.editor = editor;
        this.showCommand = showCommand;
        this.range = range;
        this.edits = edits;
        this.onSelectNewEdit = onSelectNewEdit;
        this._contextMenuService = _contextMenuService;
        this._keybindingService = _keybindingService;
        this.allowEditorOverflow = true;
        this.suppressMouseDown = true;
        this.create();
        this.visibleContext = visibleContext.bindTo(contextKeyService);
        this.visibleContext.set(true);
        this._register((0, $9cWcn.toDisposable)(()=>this.visibleContext.reset()));
        this.editor.addContentWidget(this);
        this.editor.layoutContentWidget(this);
        this._register((0, $9cWcn.toDisposable)(()=>this.editor.removeContentWidget(this)));
        this._register(this.editor.onDidChangeCursorPosition((e)=>{
            if (!range.containsPosition(e.position)) this.dispose();
        }));
        this._register((0, $5YaSO.Event).runAndSubscribe(_keybindingService.onDidUpdateKeybindings, ()=>{
            this._updateButtonTitle();
        }));
    }
    _updateButtonTitle() {
        const binding = this._keybindingService.lookupKeybinding(this.showCommand.id)?.getLabel();
        this.button.element.title = this.showCommand.label + (binding ? ` (${binding})` : '');
    }
    create() {
        this.domNode = $bDzmQ.$('.post-edit-widget');
        this.button = this._register(new (0, $lWtRZ.Button)(this.domNode, {
            supportIcons: true
        }));
        this.button.label = '$(insert)';
        this._register($bDzmQ.addDisposableListener(this.domNode, $bDzmQ.EventType.CLICK, ()=>this.showSelector()));
    }
    getId() {
        return $3e7ef88e407e6e66$var$PostEditWidget_1.baseId + '.' + this.typeId;
    }
    getDomNode() {
        return this.domNode;
    }
    getPosition() {
        return {
            position: this.range.getEndPosition(),
            preference: [
                2 /* ContentWidgetPositionPreference.BELOW */ 
            ]
        };
    }
    showSelector() {
        this._contextMenuService.showContextMenu({
            getAnchor: ()=>{
                const pos = $bDzmQ.getDomNodePagePosition(this.button.element);
                return {
                    x: pos.left + pos.width,
                    y: pos.top + pos.height
                };
            },
            getActions: ()=>{
                return this.edits.allEdits.map((edit, i)=>(0, $cVfMQ.toAction)({
                        id: '',
                        label: edit.title,
                        checked: i === this.edits.activeEditIndex,
                        run: ()=>{
                            if (i !== this.edits.activeEditIndex) return this.onSelectNewEdit(i);
                        }
                    }));
            }
        });
    }
};
$3e7ef88e407e6e66$var$PostEditWidget = $3e7ef88e407e6e66$var$PostEditWidget_1 = $3e7ef88e407e6e66$var$__decorate([
    $3e7ef88e407e6e66$var$__param(7, (0, $d6K7e.IContextMenuService)),
    $3e7ef88e407e6e66$var$__param(8, (0, $cxCeF.IContextKeyService)),
    $3e7ef88e407e6e66$var$__param(9, (0, $7IxGd.IKeybindingService))
], $3e7ef88e407e6e66$var$PostEditWidget);
let $3e7ef88e407e6e66$export$6814fa815658cc4e = class PostEditWidgetManager extends (0, $9cWcn.Disposable) {
    constructor(_id, _editor, _visibleContext, _showCommand, _instantiationService, _bulkEditService, _notificationService){
        super();
        this._id = _id;
        this._editor = _editor;
        this._visibleContext = _visibleContext;
        this._showCommand = _showCommand;
        this._instantiationService = _instantiationService;
        this._bulkEditService = _bulkEditService;
        this._notificationService = _notificationService;
        this._currentWidget = this._register(new (0, $9cWcn.MutableDisposable)());
        this._register((0, $5YaSO.Event).any(_editor.onDidChangeModel, _editor.onDidChangeModelContent)(()=>this.clear()));
    }
    async applyEditAndShowIfNeeded(ranges, edits, canShowWidget, resolve, token) {
        const model = this._editor.getModel();
        if (!model || !ranges.length) return;
        const edit = edits.allEdits.at(edits.activeEditIndex);
        if (!edit) return;
        const onDidSelectEdit = async (newEditIndex)=>{
            const model = this._editor.getModel();
            if (!model) return;
            await model.undo();
            this.applyEditAndShowIfNeeded(ranges, {
                activeEditIndex: newEditIndex,
                allEdits: edits.allEdits
            }, canShowWidget, resolve, token);
        };
        const handleError = (e, message)=>{
            if ((0, $gPkHZ.isCancellationError)(e)) return;
            this._notificationService.error(message);
            if (canShowWidget) this.show(ranges[0], edits, onDidSelectEdit);
        };
        let resolvedEdit;
        try {
            resolvedEdit = await resolve(edit, token);
        } catch (e) {
            return handleError(e, (0, $4dEdH.localize)('resolveError', "Error resolving edit '{0}':\n{1}", edit.title, (0, $fe4e8839960fa4d7$export$95506c204c060a3)(e)));
        }
        if (token.isCancellationRequested) return;
        const combinedWorkspaceEdit = (0, $d30380705d7d29a5$export$32ae37d22c3ee706)(model.uri, ranges, resolvedEdit);
        // Use a decoration to track edits around the trigger range
        const primaryRange = ranges[0];
        const editTrackingDecoration = model.deltaDecorations([], [
            {
                range: primaryRange,
                options: {
                    description: 'paste-line-suffix',
                    stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ 
                }
            }
        ]);
        this._editor.focus();
        let editResult;
        let editRange;
        try {
            editResult = await this._bulkEditService.apply(combinedWorkspaceEdit, {
                editor: this._editor,
                token: token
            });
            editRange = model.getDecorationRange(editTrackingDecoration[0]);
        } catch (e) {
            return handleError(e, (0, $4dEdH.localize)('applyError', "Error applying edit '{0}':\n{1}", edit.title, (0, $fe4e8839960fa4d7$export$95506c204c060a3)(e)));
        } finally{
            model.deltaDecorations(editTrackingDecoration, []);
        }
        if (token.isCancellationRequested) return;
        if (canShowWidget && editResult.isApplied && edits.allEdits.length > 1) this.show(editRange ?? primaryRange, edits, onDidSelectEdit);
    }
    show(range, edits, onDidSelectEdit) {
        this.clear();
        if (this._editor.hasModel()) this._currentWidget.value = this._instantiationService.createInstance($3e7ef88e407e6e66$var$PostEditWidget, this._id, this._editor, this._visibleContext, this._showCommand, range, edits, onDidSelectEdit);
    }
    clear() {
        this._currentWidget.clear();
    }
    tryShowSelector() {
        this._currentWidget.value?.showSelector();
    }
};
$3e7ef88e407e6e66$export$6814fa815658cc4e = $3e7ef88e407e6e66$var$__decorate([
    $3e7ef88e407e6e66$var$__param(4, (0, $fdGPu.IInstantiationService)),
    $3e7ef88e407e6e66$var$__param(5, (0, $d4p5R.IBulkEditService)),
    $3e7ef88e407e6e66$var$__param(6, (0, $kCOKl.INotificationService))
], $3e7ef88e407e6e66$export$6814fa815658cc4e);



var $gPkHZ = parcelRequire("gPkHZ");
var $a6fdbc9846d042ed$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $a6fdbc9846d042ed$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $a6fdbc9846d042ed$var$CopyPasteController_1;
const $a6fdbc9846d042ed$export$909be6e4634cecc7 = 'editor.changePasteType';
const $a6fdbc9846d042ed$export$b69af44cc2bc25b8 = new (0, $cxCeF.RawContextKey)('pasteWidgetVisible', false, (0, $4dEdH.localize)('pasteWidgetVisible', "Whether the paste widget is showing"));
const $a6fdbc9846d042ed$var$vscodeClipboardMime = 'application/vnd.code.copyMetadata';
let $a6fdbc9846d042ed$export$893fe501c8c7105b = class CopyPasteController extends (0, $9cWcn.Disposable) {
    static{
        $a6fdbc9846d042ed$var$CopyPasteController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.copyPasteActionController';
    }
    static get(editor) {
        return editor.getContribution($a6fdbc9846d042ed$var$CopyPasteController_1.ID);
    }
    constructor(editor, instantiationService, _bulkEditService, _clipboardService, _languageFeaturesService, _quickInputService, _progressService){
        super();
        this._bulkEditService = _bulkEditService;
        this._clipboardService = _clipboardService;
        this._languageFeaturesService = _languageFeaturesService;
        this._quickInputService = _quickInputService;
        this._progressService = _progressService;
        this._editor = editor;
        const container = editor.getContainerDomNode();
        this._register((0, $bDzmQ.addDisposableListener)(container, 'copy', (e)=>this.handleCopy(e)));
        this._register((0, $bDzmQ.addDisposableListener)(container, 'cut', (e)=>this.handleCopy(e)));
        this._register((0, $bDzmQ.addDisposableListener)(container, 'paste', (e)=>this.handlePaste(e), true));
        this._pasteProgressManager = this._register(new (0, $a2685003e93fe7e1$export$8913023249b8bb0c)('pasteIntoEditor', editor, instantiationService));
        this._postPasteWidgetManager = this._register(instantiationService.createInstance((0, $3e7ef88e407e6e66$export$6814fa815658cc4e), 'pasteIntoEditor', editor, $a6fdbc9846d042ed$export$b69af44cc2bc25b8, {
            id: $a6fdbc9846d042ed$export$909be6e4634cecc7,
            label: (0, $4dEdH.localize)('postPasteWidgetTitle', "Show paste options...")
        }));
    }
    changePasteType() {
        this._postPasteWidgetManager.tryShowSelector();
    }
    pasteAs(preferred) {
        this._editor.focus();
        try {
            this._pasteAsActionContext = {
                preferred: preferred
            };
            (0, $bDzmQ.getActiveDocument)().execCommand('paste');
        } finally{
            this._pasteAsActionContext = undefined;
        }
    }
    clearWidgets() {
        this._postPasteWidgetManager.clear();
    }
    isPasteAsEnabled() {
        return this._editor.getOption(85 /* EditorOption.pasteAs */ ).enabled;
    }
    async finishedPaste() {
        await this._currentPasteOperation;
    }
    handleCopy(e) {
        if (!this._editor.hasTextFocus()) return;
        // Explicitly clear the clipboard internal state.
        // This is needed because on web, the browser clipboard is faked out using an in-memory store.
        // This means the resources clipboard is not properly updated when copying from the editor.
        this._clipboardService.clearInternalState?.();
        if (!e.clipboardData || !this.isPasteAsEnabled()) return;
        const model = this._editor.getModel();
        const selections = this._editor.getSelections();
        if (!model || !selections?.length) return;
        const enableEmptySelectionClipboard = this._editor.getOption(37 /* EditorOption.emptySelectionClipboard */ );
        let ranges = selections;
        const wasFromEmptySelection = selections.length === 1 && selections[0].isEmpty();
        if (wasFromEmptySelection) {
            if (!enableEmptySelectionClipboard) return;
            ranges = [
                new (0, $d00il.Range)(ranges[0].startLineNumber, 1, ranges[0].startLineNumber, 1 + model.getLineLength(ranges[0].startLineNumber))
            ];
        }
        const toCopy = this._editor._getViewModel()?.getPlainTextToCopy(selections, enableEmptySelectionClipboard, $lb0Ah.isWindows);
        const multicursorText = Array.isArray(toCopy) ? toCopy : null;
        const defaultPastePayload = {
            multicursorText: multicursorText,
            pasteOnNewLine: wasFromEmptySelection,
            mode: null
        };
        const providers = this._languageFeaturesService.documentPasteEditProvider.ordered(model).filter((x)=>!!x.prepareDocumentPaste);
        if (!providers.length) {
            this.setCopyMetadata(e.clipboardData, {
                defaultPastePayload: defaultPastePayload
            });
            return;
        }
        const dataTransfer = (0, $d334260af69d4b41$export$c3526c00a45abf16)(e.clipboardData);
        const providerCopyMimeTypes = providers.flatMap((x)=>x.copyMimeTypes ?? []);
        // Save off a handle pointing to data that VS Code maintains.
        const handle = (0, $0805a875738ca87e$export$1c3aefb711c3a4cc)();
        this.setCopyMetadata(e.clipboardData, {
            id: handle,
            providerCopyMimeTypes: providerCopyMimeTypes,
            defaultPastePayload: defaultPastePayload
        });
        const promise = (0, $6bXyA.createCancelablePromise)(async (token)=>{
            const results = (0, $kJ8UG.coalesce)(await Promise.all(providers.map(async (provider)=>{
                try {
                    return await provider.prepareDocumentPaste(model, ranges, dataTransfer, token);
                } catch (err) {
                    console.error(err);
                    return undefined;
                }
            })));
            // Values from higher priority providers should overwrite values from lower priority ones.
            // Reverse the array to so that the calls to `replace` below will do this
            results.reverse();
            for (const result of results)for (const [mime, value] of result)dataTransfer.replace(mime, value);
            return dataTransfer;
        });
        $a6fdbc9846d042ed$var$CopyPasteController_1._currentCopyOperation?.dataTransferPromise.cancel();
        $a6fdbc9846d042ed$var$CopyPasteController_1._currentCopyOperation = {
            handle: handle,
            dataTransferPromise: promise
        };
    }
    async handlePaste(e) {
        if (!e.clipboardData || !this._editor.hasTextFocus()) return;
        (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this._editor)?.closeMessage();
        this._currentPasteOperation?.cancel();
        this._currentPasteOperation = undefined;
        const model = this._editor.getModel();
        const selections = this._editor.getSelections();
        if (!selections?.length || !model) return;
        if (this._editor.getOption(92 /* EditorOption.readOnly */ ) // Never enabled if editor is readonly.
         || !this.isPasteAsEnabled() && !this._pasteAsActionContext // Or feature disabled (but still enable if paste was explicitly requested)
        ) return;
        const metadata = this.fetchCopyMetadata(e);
        const dataTransfer = (0, $d334260af69d4b41$export$8766d539024a36bd)(e.clipboardData);
        dataTransfer.delete($a6fdbc9846d042ed$var$vscodeClipboardMime);
        const allPotentialMimeTypes = [
            ...e.clipboardData.types,
            ...metadata?.providerCopyMimeTypes ?? [],
            // TODO: always adds `uri-list` because this get set if there are resources in the system clipboard.
            // However we can only check the system clipboard async. For this early check, just add it in.
            // We filter providers again once we have the final dataTransfer we will use.
            (0, $a1Nyr.Mimes).uriList
        ];
        const allProviders = this._languageFeaturesService.documentPasteEditProvider.ordered(model).filter((provider)=>{
            // Filter out providers that don't match the requested paste types
            const preference = this._pasteAsActionContext?.preferred;
            if (preference) {
                if (provider.providedPasteEditKinds && !this.providerMatchesPreference(provider, preference)) return false;
            }
            // And providers that don't handle any of mime types in the clipboard
            return provider.pasteMimeTypes?.some((type)=>(0, $72c3141703bedf97$export$13f6505549b70d23)(type, allPotentialMimeTypes));
        });
        if (!allProviders.length) {
            if (this._pasteAsActionContext?.preferred) this.showPasteAsNoEditMessage(selections, this._pasteAsActionContext.preferred);
            return;
        }
        // Prevent the editor's default paste handler from running.
        // Note that after this point, we are fully responsible for handling paste.
        // If we can't provider a paste for any reason, we need to explicitly delegate pasting back to the editor.
        e.preventDefault();
        e.stopImmediatePropagation();
        if (this._pasteAsActionContext) this.showPasteAsPick(this._pasteAsActionContext.preferred, allProviders, selections, dataTransfer, metadata);
        else this.doPasteInline(allProviders, selections, dataTransfer, metadata, e);
    }
    showPasteAsNoEditMessage(selections, preference) {
        (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this._editor)?.showMessage((0, $4dEdH.localize)('pasteAsError', "No paste edits for '{0}' found", preference instanceof (0, $b9104f11117b1d0a$export$f06724c61e87d9db) ? preference.value : preference.providerId), selections[0].getStartPosition());
    }
    doPasteInline(allProviders, selections, dataTransfer, metadata, clipboardEvent) {
        const editor = this._editor;
        if (!editor.hasModel()) return;
        const editorStateCts = new (0, $lgoyH.EditorStateCancellationTokenSource)(editor, 3 /* CodeEditorStateFlag.Selection */ , undefined);
        const p = (0, $6bXyA.createCancelablePromise)(async (pToken)=>{
            const editor = this._editor;
            if (!editor.hasModel()) return;
            const model = editor.getModel();
            const disposables = new (0, $9cWcn.DisposableStore)();
            const cts = disposables.add(new (0, $giPcZ.CancellationTokenSource)(pToken));
            disposables.add(editorStateCts.token.onCancellationRequested(()=>cts.cancel()));
            const token = cts.token;
            try {
                await this.mergeInDataFromCopy(dataTransfer, metadata, token);
                if (token.isCancellationRequested) return;
                const supportedProviders = allProviders.filter((provider)=>this.isSupportedPasteProvider(provider, dataTransfer));
                if (!supportedProviders.length || supportedProviders.length === 1 && supportedProviders[0] instanceof (0, $e022cc124da90514$export$6744a7017d142b99 // Only our default text provider is active
                )) return this.applyDefaultPasteHandler(dataTransfer, metadata, token, clipboardEvent);
                const context = {
                    triggerKind: (0, $kzNQX.DocumentPasteTriggerKind).Automatic
                };
                const editSession = await this.getPasteEdits(supportedProviders, dataTransfer, model, selections, context, token);
                disposables.add(editSession);
                if (token.isCancellationRequested) return;
                // If the only edit returned is our default text edit, use the default paste handler
                if (editSession.edits.length === 1 && editSession.edits[0].provider instanceof (0, $e022cc124da90514$export$6744a7017d142b99)) return this.applyDefaultPasteHandler(dataTransfer, metadata, token, clipboardEvent);
                if (editSession.edits.length) {
                    const canShowWidget = editor.getOption(85 /* EditorOption.pasteAs */ ).showPasteSelector === 'afterPaste';
                    return this._postPasteWidgetManager.applyEditAndShowIfNeeded(selections, {
                        activeEditIndex: 0,
                        allEdits: editSession.edits
                    }, canShowWidget, (edit, token)=>{
                        return new Promise((resolve, reject)=>{
                            (async ()=>{
                                try {
                                    const resolveP = edit.provider.resolveDocumentPasteEdit?.(edit, token);
                                    const showP = new (0, $6bXyA.DeferredPromise)();
                                    const resolved = resolveP && await this._pasteProgressManager.showWhile(selections[0].getEndPosition(), (0, $4dEdH.localize)('resolveProcess', "Resolving paste edit. Click to cancel"), Promise.race([
                                        showP.p,
                                        resolveP
                                    ]), {
                                        cancel: ()=>{
                                            showP.cancel();
                                            return reject(new (0, $gPkHZ.CancellationError)());
                                        }
                                    }, 0);
                                    if (resolved) edit.additionalEdit = resolved.additionalEdit;
                                    return resolve(edit);
                                } catch (err) {
                                    return reject(err);
                                }
                            })();
                        });
                    }, token);
                }
                await this.applyDefaultPasteHandler(dataTransfer, metadata, token, clipboardEvent);
            } finally{
                disposables.dispose();
                if (this._currentPasteOperation === p) this._currentPasteOperation = undefined;
            }
        });
        this._pasteProgressManager.showWhile(selections[0].getEndPosition(), (0, $4dEdH.localize)('pasteIntoEditorProgress', "Running paste handlers. Click to cancel and do basic paste"), p, {
            cancel: async ()=>{
                try {
                    p.cancel();
                    if (editorStateCts.token.isCancellationRequested) return;
                    await this.applyDefaultPasteHandler(dataTransfer, metadata, editorStateCts.token, clipboardEvent);
                } finally{
                    editorStateCts.dispose();
                }
            }
        }).then(()=>{
            editorStateCts.dispose();
        });
        this._currentPasteOperation = p;
    }
    showPasteAsPick(preference, allProviders, selections, dataTransfer, metadata) {
        const p = (0, $6bXyA.createCancelablePromise)(async (token)=>{
            const editor = this._editor;
            if (!editor.hasModel()) return;
            const model = editor.getModel();
            const disposables = new (0, $9cWcn.DisposableStore)();
            const tokenSource = disposables.add(new (0, $lgoyH.EditorStateCancellationTokenSource)(editor, 3 /* CodeEditorStateFlag.Selection */ , undefined, token));
            try {
                await this.mergeInDataFromCopy(dataTransfer, metadata, tokenSource.token);
                if (tokenSource.token.isCancellationRequested) return;
                // Filter out any providers the don't match the full data transfer we will send them.
                let supportedProviders = allProviders.filter((provider)=>this.isSupportedPasteProvider(provider, dataTransfer, preference));
                if (preference) // We are looking for a specific edit
                supportedProviders = supportedProviders.filter((provider)=>this.providerMatchesPreference(provider, preference));
                const context = {
                    triggerKind: (0, $kzNQX.DocumentPasteTriggerKind).PasteAs,
                    only: preference && preference instanceof (0, $b9104f11117b1d0a$export$f06724c61e87d9db) ? preference : undefined
                };
                let editSession = disposables.add(await this.getPasteEdits(supportedProviders, dataTransfer, model, selections, context, tokenSource.token));
                if (tokenSource.token.isCancellationRequested) return;
                // Filter out any edits that don't match the requested kind
                if (preference) editSession = {
                    edits: editSession.edits.filter((edit)=>{
                        if (preference instanceof (0, $b9104f11117b1d0a$export$f06724c61e87d9db)) return preference.contains(edit.kind);
                        else return preference.providerId === edit.provider.id;
                    }),
                    dispose: editSession.dispose
                };
                if (!editSession.edits.length) {
                    if (context.only) this.showPasteAsNoEditMessage(selections, context.only);
                    return;
                }
                let pickedEdit;
                if (preference) pickedEdit = editSession.edits.at(0);
                else {
                    const selected = await this._quickInputService.pick(editSession.edits.map((edit)=>({
                            label: edit.title,
                            description: edit.kind?.value,
                            edit: edit
                        })), {
                        placeHolder: (0, $4dEdH.localize)('pasteAsPickerPlaceholder', "Select Paste Action")
                    });
                    pickedEdit = selected?.edit;
                }
                if (!pickedEdit) return;
                const combinedWorkspaceEdit = (0, $d30380705d7d29a5$export$32ae37d22c3ee706)(model.uri, selections, pickedEdit);
                await this._bulkEditService.apply(combinedWorkspaceEdit, {
                    editor: this._editor
                });
            } finally{
                disposables.dispose();
                if (this._currentPasteOperation === p) this._currentPasteOperation = undefined;
            }
        });
        this._progressService.withProgress({
            location: 10 /* ProgressLocation.Window */ ,
            title: (0, $4dEdH.localize)('pasteAsProgress', "Running paste handlers")
        }, ()=>p);
    }
    setCopyMetadata(dataTransfer, metadata) {
        dataTransfer.setData($a6fdbc9846d042ed$var$vscodeClipboardMime, JSON.stringify(metadata));
    }
    fetchCopyMetadata(e) {
        if (!e.clipboardData) return;
        // Prefer using the clipboard data we saved off
        const rawMetadata = e.clipboardData.getData($a6fdbc9846d042ed$var$vscodeClipboardMime);
        if (rawMetadata) try {
            return JSON.parse(rawMetadata);
        } catch  {
            return undefined;
        }
        // Otherwise try to extract the generic text editor metadata
        const [_, metadata] = (0, $al9cc.ClipboardEventUtils).getTextData(e.clipboardData);
        if (metadata) return {
            defaultPastePayload: {
                mode: metadata.mode,
                multicursorText: metadata.multicursorText ?? null,
                pasteOnNewLine: !!metadata.isFromEmptySelection
            }
        };
        return undefined;
    }
    async mergeInDataFromCopy(dataTransfer, metadata, token) {
        if (metadata?.id && $a6fdbc9846d042ed$var$CopyPasteController_1._currentCopyOperation?.handle === metadata.id) {
            const toMergeDataTransfer = await $a6fdbc9846d042ed$var$CopyPasteController_1._currentCopyOperation.dataTransferPromise;
            if (token.isCancellationRequested) return;
            for (const [key, value] of toMergeDataTransfer)dataTransfer.replace(key, value);
        }
        if (!dataTransfer.has((0, $a1Nyr.Mimes).uriList)) {
            const resources = await this._clipboardService.readResources();
            if (token.isCancellationRequested) return;
            if (resources.length) dataTransfer.append((0, $a1Nyr.Mimes).uriList, (0, $72c3141703bedf97$export$188ede8a56a46789)((0, $72c3141703bedf97$export$2d8e542162051a3f).create(resources)));
        }
    }
    async getPasteEdits(providers, dataTransfer, model, selections, context, token) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        const results = await (0, $6bXyA.raceCancellation)(Promise.all(providers.map(async (provider)=>{
            try {
                const edits = await provider.provideDocumentPasteEdits?.(model, selections, dataTransfer, context, token);
                if (edits) disposables.add(edits);
                return edits?.edits?.map((edit)=>({
                        ...edit,
                        provider: provider
                    }));
            } catch (err) {
                if (!(0, $gPkHZ.isCancellationError)(err)) console.error(err);
                return undefined;
            }
        })), token);
        const edits = (0, $kJ8UG.coalesce)(results ?? []).flat().filter((edit)=>{
            return !context.only || context.only.contains(edit.kind);
        });
        return {
            edits: (0, $d30380705d7d29a5$export$6e2fd12dccb2585)(edits),
            dispose: ()=>disposables.dispose()
        };
    }
    async applyDefaultPasteHandler(dataTransfer, metadata, token, clipboardEvent) {
        const textDataTransfer = dataTransfer.get((0, $a1Nyr.Mimes).text) ?? dataTransfer.get('text');
        const text = await textDataTransfer?.asString() ?? '';
        if (token.isCancellationRequested) return;
        const payload = {
            clipboardEvent: clipboardEvent,
            text: text,
            pasteOnNewLine: metadata?.defaultPastePayload.pasteOnNewLine ?? false,
            multicursorText: metadata?.defaultPastePayload.multicursorText ?? null,
            mode: null
        };
        this._editor.trigger('keyboard', "paste" /* Handler.Paste */ , payload);
    }
    /**
     * Filter out providers if they:
     * - Don't handle any of the data transfer types we have
     * - Don't match the preferred paste kind
     */ isSupportedPasteProvider(provider, dataTransfer, preference) {
        if (!provider.pasteMimeTypes?.some((type)=>dataTransfer.matches(type))) return false;
        return !preference || this.providerMatchesPreference(provider, preference);
    }
    providerMatchesPreference(provider, preference) {
        if (preference instanceof (0, $b9104f11117b1d0a$export$f06724c61e87d9db)) {
            if (!provider.providedPasteEditKinds) return true;
            return provider.providedPasteEditKinds.some((providedKind)=>preference.contains(providedKind));
        } else return provider.id === preference.providerId;
    }
};
$a6fdbc9846d042ed$export$893fe501c8c7105b = $a6fdbc9846d042ed$var$CopyPasteController_1 = $a6fdbc9846d042ed$var$__decorate([
    $a6fdbc9846d042ed$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $a6fdbc9846d042ed$var$__param(2, (0, $d4p5R.IBulkEditService)),
    $a6fdbc9846d042ed$var$__param(3, (0, $8QSW4.IClipboardService)),
    $a6fdbc9846d042ed$var$__param(4, (0, $4J6fu.ILanguageFeaturesService)),
    $a6fdbc9846d042ed$var$__param(5, (0, $3XkzC.IQuickInputService)),
    $a6fdbc9846d042ed$var$__param(6, (0, $4E7vx.IProgressService))
], $a6fdbc9846d042ed$export$893fe501c8c7105b);



var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $8QSW4 = parcelRequire("8QSW4");

var $cxCeF = parcelRequire("cxCeF");
const $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP = '9_cutcopypaste';
const $4ee582c5d0064095$var$supportsCut = $lb0Ah.isNative || document.queryCommandSupported('cut');
const $4ee582c5d0064095$var$supportsCopy = $lb0Ah.isNative || document.queryCommandSupported('copy');
// Firefox only supports navigator.clipboard.readText() in browser extensions.
// See https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/readText#Browser_compatibility
// When loading over http, navigator.clipboard can be undefined. See https://github.com/microsoft/monaco-editor/issues/2313
const $4ee582c5d0064095$var$supportsPaste = typeof navigator.clipboard === 'undefined' || $5yY14.isFirefox ? document.queryCommandSupported('paste') : true;
function $4ee582c5d0064095$var$registerCommand(command) {
    command.register();
    return command;
}
const $4ee582c5d0064095$export$c126fcd83420b17 = $4ee582c5d0064095$var$supportsCut ? $4ee582c5d0064095$var$registerCommand(new (0, $2iJTi.MultiCommand)({
    id: 'editor.action.clipboardCutAction',
    precondition: undefined,
    kbOpts: // Do not bind cut keybindings in the browser,
    // since browsers do that for us and it avoids security prompts
    $lb0Ah.isNative ? {
        primary: 2102 /* KeyCode.KeyX */ ,
        win: {
            primary: 2102 /* KeyCode.KeyX */ ,
            secondary: [
                1044 /* KeyCode.Delete */ 
            ]
        },
        weight: 100 /* KeybindingWeight.EditorContrib */ 
    } : undefined,
    menuOpts: [
        {
            menuId: (0, $g4v7E.MenuId).MenubarEditMenu,
            group: '2_ccp',
            title: $4dEdH.localize({
                key: 'miCut',
                comment: [
                    '&& denotes a mnemonic'
                ]
            }, "Cu&&t"),
            order: 1
        },
        {
            menuId: (0, $g4v7E.MenuId).EditorContext,
            group: $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP,
            title: $4dEdH.localize('actions.clipboard.cutLabel', "Cut"),
            when: (0, $ibKGQ.EditorContextKeys).writable,
            order: 1
        },
        {
            menuId: (0, $g4v7E.MenuId).CommandPalette,
            group: '',
            title: $4dEdH.localize('actions.clipboard.cutLabel', "Cut"),
            order: 1
        },
        {
            menuId: (0, $g4v7E.MenuId).SimpleEditorContext,
            group: $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP,
            title: $4dEdH.localize('actions.clipboard.cutLabel', "Cut"),
            when: (0, $ibKGQ.EditorContextKeys).writable,
            order: 1
        }
    ]
})) : undefined;
const $4ee582c5d0064095$export$958df07cbf9735fc = $4ee582c5d0064095$var$supportsCopy ? $4ee582c5d0064095$var$registerCommand(new (0, $2iJTi.MultiCommand)({
    id: 'editor.action.clipboardCopyAction',
    precondition: undefined,
    kbOpts: // Do not bind copy keybindings in the browser,
    // since browsers do that for us and it avoids security prompts
    $lb0Ah.isNative ? {
        primary: 2081 /* KeyCode.KeyC */ ,
        win: {
            primary: 2081 /* KeyCode.KeyC */ ,
            secondary: [
                2067 /* KeyCode.Insert */ 
            ]
        },
        weight: 100 /* KeybindingWeight.EditorContrib */ 
    } : undefined,
    menuOpts: [
        {
            menuId: (0, $g4v7E.MenuId).MenubarEditMenu,
            group: '2_ccp',
            title: $4dEdH.localize({
                key: 'miCopy',
                comment: [
                    '&& denotes a mnemonic'
                ]
            }, "&&Copy"),
            order: 2
        },
        {
            menuId: (0, $g4v7E.MenuId).EditorContext,
            group: $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP,
            title: $4dEdH.localize('actions.clipboard.copyLabel', "Copy"),
            order: 2
        },
        {
            menuId: (0, $g4v7E.MenuId).CommandPalette,
            group: '',
            title: $4dEdH.localize('actions.clipboard.copyLabel', "Copy"),
            order: 1
        },
        {
            menuId: (0, $g4v7E.MenuId).SimpleEditorContext,
            group: $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP,
            title: $4dEdH.localize('actions.clipboard.copyLabel', "Copy"),
            order: 2
        }
    ]
})) : undefined;
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).MenubarEditMenu, {
    submenu: (0, $g4v7E.MenuId).MenubarCopy,
    title: $4dEdH.localize2('copy as', "Copy As"),
    group: '2_ccp',
    order: 3
});
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).EditorContext, {
    submenu: (0, $g4v7E.MenuId).EditorContextCopy,
    title: $4dEdH.localize2('copy as', "Copy As"),
    group: $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP,
    order: 3
});
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).EditorContext, {
    submenu: (0, $g4v7E.MenuId).EditorContextShare,
    title: $4dEdH.localize2('share', "Share"),
    group: '11_share',
    order: -1,
    when: (0, $cxCeF.ContextKeyExpr).and((0, $cxCeF.ContextKeyExpr).notEquals('resourceScheme', 'output'), (0, $ibKGQ.EditorContextKeys).editorTextFocus)
});
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).ExplorerContext, {
    submenu: (0, $g4v7E.MenuId).ExplorerContextShare,
    title: $4dEdH.localize2('share', "Share"),
    group: '11_share',
    order: -1
});
const $4ee582c5d0064095$export$c386eebeb0318c58 = $4ee582c5d0064095$var$supportsPaste ? $4ee582c5d0064095$var$registerCommand(new (0, $2iJTi.MultiCommand)({
    id: 'editor.action.clipboardPasteAction',
    precondition: undefined,
    kbOpts: // Do not bind paste keybindings in the browser,
    // since browsers do that for us and it avoids security prompts
    $lb0Ah.isNative ? {
        primary: 2100 /* KeyCode.KeyV */ ,
        win: {
            primary: 2100 /* KeyCode.KeyV */ ,
            secondary: [
                1043 /* KeyCode.Insert */ 
            ]
        },
        linux: {
            primary: 2100 /* KeyCode.KeyV */ ,
            secondary: [
                1043 /* KeyCode.Insert */ 
            ]
        },
        weight: 100 /* KeybindingWeight.EditorContrib */ 
    } : undefined,
    menuOpts: [
        {
            menuId: (0, $g4v7E.MenuId).MenubarEditMenu,
            group: '2_ccp',
            title: $4dEdH.localize({
                key: 'miPaste',
                comment: [
                    '&& denotes a mnemonic'
                ]
            }, "&&Paste"),
            order: 4
        },
        {
            menuId: (0, $g4v7E.MenuId).EditorContext,
            group: $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP,
            title: $4dEdH.localize('actions.clipboard.pasteLabel', "Paste"),
            when: (0, $ibKGQ.EditorContextKeys).writable,
            order: 4
        },
        {
            menuId: (0, $g4v7E.MenuId).CommandPalette,
            group: '',
            title: $4dEdH.localize('actions.clipboard.pasteLabel', "Paste"),
            order: 1
        },
        {
            menuId: (0, $g4v7E.MenuId).SimpleEditorContext,
            group: $4ee582c5d0064095$var$CLIPBOARD_CONTEXT_MENU_GROUP,
            title: $4dEdH.localize('actions.clipboard.pasteLabel', "Paste"),
            when: (0, $ibKGQ.EditorContextKeys).writable,
            order: 4
        }
    ]
})) : undefined;
class $4ee582c5d0064095$var$ExecCommandCopyWithSyntaxHighlightingAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.clipboardCopyWithSyntaxHighlightingAction',
            label: $4dEdH.localize('actions.clipboard.copyWithSyntaxHighlightingLabel', "Copy With Syntax Highlighting"),
            alias: 'Copy With Syntax Highlighting',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        if (!editor.hasModel()) return;
        const emptySelectionClipboard = editor.getOption(37 /* EditorOption.emptySelectionClipboard */ );
        if (!emptySelectionClipboard && editor.getSelection().isEmpty()) return;
        (0, $al9cc.CopyOptions).forceCopyWithSyntaxHighlighting = true;
        editor.focus();
        editor.getContainerDomNode().ownerDocument.execCommand('copy');
        (0, $al9cc.CopyOptions).forceCopyWithSyntaxHighlighting = false;
    }
}
function $4ee582c5d0064095$var$registerExecCommandImpl(target, browserCommand) {
    if (!target) return;
    // 1. handle case when focus is in editor.
    target.addImplementation(10000, 'code-editor', (accessor, args)=>{
        // Only if editor text focus (i.e. not if editor has widget focus).
        const focusedEditor = accessor.get((0, $2Qfl0.ICodeEditorService)).getFocusedCodeEditor();
        if (focusedEditor && focusedEditor.hasTextFocus()) {
            // Do not execute if there is no selection and empty selection clipboard is off
            const emptySelectionClipboard = focusedEditor.getOption(37 /* EditorOption.emptySelectionClipboard */ );
            const selection = focusedEditor.getSelection();
            if (selection && selection.isEmpty() && !emptySelectionClipboard) return true;
            focusedEditor.getContainerDomNode().ownerDocument.execCommand(browserCommand);
            return true;
        }
        return false;
    });
    // 2. (default) handle case when focus is somewhere else.
    target.addImplementation(0, 'generic-dom', (accessor, args)=>{
        (0, $bDzmQ.getActiveDocument)().execCommand(browserCommand);
        return true;
    });
}
$4ee582c5d0064095$var$registerExecCommandImpl($4ee582c5d0064095$export$c126fcd83420b17, 'cut');
$4ee582c5d0064095$var$registerExecCommandImpl($4ee582c5d0064095$export$958df07cbf9735fc, 'copy');
if ($4ee582c5d0064095$export$c386eebeb0318c58) {
    // 1. Paste: handle case when focus is in editor.
    $4ee582c5d0064095$export$c386eebeb0318c58.addImplementation(10000, 'code-editor', (accessor, args)=>{
        const codeEditorService = accessor.get((0, $2Qfl0.ICodeEditorService));
        const clipboardService = accessor.get((0, $8QSW4.IClipboardService));
        // Only if editor text focus (i.e. not if editor has widget focus).
        const focusedEditor = codeEditorService.getFocusedCodeEditor();
        if (focusedEditor && focusedEditor.hasTextFocus()) {
            const result = focusedEditor.getContainerDomNode().ownerDocument.execCommand('paste');
            if (result) return (0, $a6fdbc9846d042ed$export$893fe501c8c7105b).get(focusedEditor)?.finishedPaste() ?? Promise.resolve();
            else if ($lb0Ah.isWeb) // Use the clipboard service if document.execCommand('paste') was not successful
            return (async ()=>{
                const clipboardText = await clipboardService.readText();
                if (clipboardText !== '') {
                    const metadata = (0, $al9cc.InMemoryClipboardMetadataManager).INSTANCE.get(clipboardText);
                    let pasteOnNewLine = false;
                    let multicursorText = null;
                    let mode = null;
                    if (metadata) {
                        pasteOnNewLine = focusedEditor.getOption(37 /* EditorOption.emptySelectionClipboard */ ) && !!metadata.isFromEmptySelection;
                        multicursorText = typeof metadata.multicursorText !== 'undefined' ? metadata.multicursorText : null;
                        mode = metadata.mode;
                    }
                    focusedEditor.trigger('keyboard', "paste" /* Handler.Paste */ , {
                        text: clipboardText,
                        pasteOnNewLine: pasteOnNewLine,
                        multicursorText: multicursorText,
                        mode: mode
                    });
                }
            })();
            return true;
        }
        return false;
    });
    // 2. Paste: (default) handle case when focus is somewhere else.
    $4ee582c5d0064095$export$c386eebeb0318c58.addImplementation(0, 'generic-dom', (accessor, args)=>{
        (0, $bDzmQ.getActiveDocument)().execCommand('paste');
        return true;
    });
}
if ($4ee582c5d0064095$var$supportsCopy) (0, $2iJTi.registerEditorAction)($4ee582c5d0064095$var$ExecCommandCopyWithSyntaxHighlightingAction);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $drPnH = parcelRequire("drPnH");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $jcr1R = parcelRequire("jcr1R");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $5OJ54 = parcelRequire("5OJ54");

var $d4p5R = parcelRequire("d4p5R");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $4J6fu = parcelRequire("4J6fu");

var $cKKJT = parcelRequire("cKKJT");

var $lgoyH = parcelRequire("lgoyH");

var $4dEdH = parcelRequire("4dEdH");

var $8tcMz = parcelRequire("8tcMz");

var $kCOKl = parcelRequire("kCOKl");

var $4E7vx = parcelRequire("4E7vx");

var $lMGba = parcelRequire("lMGba");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $gPkHZ = parcelRequire("gPkHZ");

const $fdf474d60745d657$export$c72b5966cfff6b4d = new class {
    constructor(){
        this.QuickFix = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('quickfix');
        this.Refactor = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('refactor');
        this.RefactorExtract = this.Refactor.append('extract');
        this.RefactorInline = this.Refactor.append('inline');
        this.RefactorMove = this.Refactor.append('move');
        this.RefactorRewrite = this.Refactor.append('rewrite');
        this.Notebook = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('notebook');
        this.Source = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)('source');
        this.SourceOrganizeImports = this.Source.append('organizeImports');
        this.SourceFixAll = this.Source.append('fixAll');
        this.SurroundWith = this.Refactor.append('surround');
    }
};
var $fdf474d60745d657$export$f0e69435f2eb5c46;
(function(CodeActionTriggerSource) {
    CodeActionTriggerSource["Refactor"] = "refactor";
    CodeActionTriggerSource["RefactorPreview"] = "refactor preview";
    CodeActionTriggerSource["Lightbulb"] = "lightbulb";
    CodeActionTriggerSource["Default"] = "other (default)";
    CodeActionTriggerSource["SourceAction"] = "source action";
    CodeActionTriggerSource["QuickFix"] = "quick fix action";
    CodeActionTriggerSource["FixAll"] = "fix all";
    CodeActionTriggerSource["OrganizeImports"] = "organize imports";
    CodeActionTriggerSource["AutoFix"] = "auto fix";
    CodeActionTriggerSource["QuickFixHover"] = "quick fix hover window";
    CodeActionTriggerSource["OnSave"] = "save participants";
    CodeActionTriggerSource["ProblemsView"] = "problems view";
})($fdf474d60745d657$export$f0e69435f2eb5c46 || ($fdf474d60745d657$export$f0e69435f2eb5c46 = {}));
function $fdf474d60745d657$export$260c8da5ecf5f71d(filter, providedKind) {
    // A provided kind may be a subset or superset of our filtered kind.
    if (filter.include && !filter.include.intersects(providedKind)) return false;
    if (filter.excludes) {
        if (filter.excludes.some((exclude)=>$fdf474d60745d657$var$excludesAction(providedKind, exclude, filter.include))) return false;
    }
    // Don't return source actions unless they are explicitly requested
    if (!filter.includeSourceActions && $fdf474d60745d657$export$c72b5966cfff6b4d.Source.contains(providedKind)) return false;
    return true;
}
function $fdf474d60745d657$export$b4bbf6ad637c4d35(filter, action) {
    const actionKind = action.kind ? new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(action.kind) : undefined;
    // Filter out actions by kind
    if (filter.include) {
        if (!actionKind || !filter.include.contains(actionKind)) return false;
    }
    if (filter.excludes) {
        if (actionKind && filter.excludes.some((exclude)=>$fdf474d60745d657$var$excludesAction(actionKind, exclude, filter.include))) return false;
    }
    // Don't return source actions unless they are explicitly requested
    if (!filter.includeSourceActions) {
        if (actionKind && $fdf474d60745d657$export$c72b5966cfff6b4d.Source.contains(actionKind)) return false;
    }
    if (filter.onlyIncludePreferredActions) {
        if (!action.isPreferred) return false;
    }
    return true;
}
function $fdf474d60745d657$var$excludesAction(providedKind, exclude, include) {
    if (!exclude.contains(providedKind)) return false;
    if (include && exclude.contains(include)) // The include is more specific, don't filter out
    return false;
    return true;
}
class $fdf474d60745d657$export$b4557d8a7419d430 {
    static fromUser(arg, defaults) {
        if (!arg || typeof arg !== 'object') return new $fdf474d60745d657$export$b4557d8a7419d430(defaults.kind, defaults.apply, false);
        return new $fdf474d60745d657$export$b4557d8a7419d430($fdf474d60745d657$export$b4557d8a7419d430.getKindFromUser(arg, defaults.kind), $fdf474d60745d657$export$b4557d8a7419d430.getApplyFromUser(arg, defaults.apply), $fdf474d60745d657$export$b4557d8a7419d430.getPreferredUser(arg));
    }
    static getApplyFromUser(arg, defaultAutoApply) {
        switch(typeof arg.apply === 'string' ? arg.apply.toLowerCase() : ''){
            case 'first':
                return "first" /* CodeActionAutoApply.First */ ;
            case 'never':
                return "never" /* CodeActionAutoApply.Never */ ;
            case 'ifsingle':
                return "ifSingle" /* CodeActionAutoApply.IfSingle */ ;
            default:
                return defaultAutoApply;
        }
    }
    static getKindFromUser(arg, defaultKind) {
        return typeof arg.kind === 'string' ? new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(arg.kind) : defaultKind;
    }
    static getPreferredUser(arg) {
        return typeof arg.preferred === 'boolean' ? arg.preferred : false;
    }
    constructor(kind, apply, preferred){
        this.kind = kind;
        this.apply = apply;
        this.preferred = preferred;
    }
}
class $fdf474d60745d657$export$1ff0bf878d7aea77 {
    constructor(action, provider, highlightRange){
        this.action = action;
        this.provider = provider;
        this.highlightRange = highlightRange;
    }
    async resolve(token) {
        if (this.provider?.resolveCodeAction && !this.action.edit) {
            let action;
            try {
                action = await this.provider.resolveCodeAction(this.action, token);
            } catch (err) {
                (0, $gPkHZ.onUnexpectedExternalError)(err);
            }
            if (action) this.action.edit = action.edit;
        }
        return this;
    }
}



const $ccc254bb322a1d5a$export$47d177835ea6d398 = 'editor.action.codeAction';
const $ccc254bb322a1d5a$export$3db60be65e567c5d = 'editor.action.quickFix';
const $ccc254bb322a1d5a$export$8e5bae78476830b3 = 'editor.action.autoFix';
const $ccc254bb322a1d5a$export$691d097e330e1493 = 'editor.action.refactor';
const $ccc254bb322a1d5a$export$239def49abcdebc4 = 'editor.action.sourceAction';
const $ccc254bb322a1d5a$export$9f47236fc64ddcf5 = 'editor.action.organizeImports';
const $ccc254bb322a1d5a$export$9866f0c931c06a92 = 'editor.action.fixAll';
class $ccc254bb322a1d5a$var$ManagedCodeActionSet extends (0, $9cWcn.Disposable) {
    static codeActionsPreferredComparator(a, b) {
        if (a.isPreferred && !b.isPreferred) return -1;
        else if (!a.isPreferred && b.isPreferred) return 1;
        else return 0;
    }
    static codeActionsComparator({ action: a }, { action: b }) {
        if (a.isAI && !b.isAI) return 1;
        else if (!a.isAI && b.isAI) return -1;
        if ((0, $kJ8UG.isNonEmptyArray)(a.diagnostics)) return (0, $kJ8UG.isNonEmptyArray)(b.diagnostics) ? $ccc254bb322a1d5a$var$ManagedCodeActionSet.codeActionsPreferredComparator(a, b) : -1;
        else if ((0, $kJ8UG.isNonEmptyArray)(b.diagnostics)) return 1;
        else return $ccc254bb322a1d5a$var$ManagedCodeActionSet.codeActionsPreferredComparator(a, b); // both have no diagnostics
    }
    constructor(actions, documentation, disposables){
        super();
        this.documentation = documentation;
        this._register(disposables);
        this.allActions = [
            ...actions
        ].sort($ccc254bb322a1d5a$var$ManagedCodeActionSet.codeActionsComparator);
        this.validActions = this.allActions.filter(({ action: action })=>!action.disabled);
    }
    get hasAutoFix() {
        return this.validActions.some(({ action: fix })=>!!fix.kind && (0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix.contains(new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(fix.kind)) && !!fix.isPreferred);
    }
    get hasAIFix() {
        return this.validActions.some(({ action: fix })=>!!fix.isAI);
    }
    get allAIFixes() {
        return this.validActions.every(({ action: fix })=>!!fix.isAI);
    }
}
const $ccc254bb322a1d5a$var$emptyCodeActionsResponse = {
    actions: [],
    documentation: undefined
};
async function $ccc254bb322a1d5a$export$52ee0249dd058aac(registry, model, rangeOrSelection, trigger, progress, token) {
    const filter = trigger.filter || {};
    const notebookFilter = {
        ...filter,
        excludes: [
            ...filter.excludes || [],
            (0, $fdf474d60745d657$export$c72b5966cfff6b4d).Notebook
        ]
    };
    const codeActionContext = {
        only: filter.include?.value,
        trigger: trigger.type
    };
    const cts = new (0, $lgoyH.TextModelCancellationTokenSource)(model, token);
    // if the trigger is auto (autosave, lightbulb, etc), we should exclude notebook codeActions
    const excludeNotebookCodeActions = trigger.type === 2 /* languages.CodeActionTriggerType.Auto */ ;
    const providers = $ccc254bb322a1d5a$var$getCodeActionProviders(registry, model, excludeNotebookCodeActions ? notebookFilter : filter);
    const disposables = new (0, $9cWcn.DisposableStore)();
    const promises = providers.map(async (provider)=>{
        try {
            progress.report(provider);
            const providedCodeActions = await provider.provideCodeActions(model, rangeOrSelection, codeActionContext, cts.token);
            if (providedCodeActions) disposables.add(providedCodeActions);
            if (cts.token.isCancellationRequested) return $ccc254bb322a1d5a$var$emptyCodeActionsResponse;
            const filteredActions = (providedCodeActions?.actions || []).filter((action)=>action && (0, $fdf474d60745d657$export$b4bbf6ad637c4d35)(filter, action));
            const documentation = $ccc254bb322a1d5a$var$getDocumentationFromProvider(provider, filteredActions, filter.include);
            return {
                actions: filteredActions.map((action)=>new (0, $fdf474d60745d657$export$1ff0bf878d7aea77)(action, provider)),
                documentation: documentation
            };
        } catch (err) {
            if ((0, $gPkHZ.isCancellationError)(err)) throw err;
            (0, $gPkHZ.onUnexpectedExternalError)(err);
            return $ccc254bb322a1d5a$var$emptyCodeActionsResponse;
        }
    });
    const listener = registry.onDidChange(()=>{
        const newProviders = registry.all(model);
        if (!(0, $kJ8UG.equals)(newProviders, providers)) cts.cancel();
    });
    try {
        const actions = await Promise.all(promises);
        const allActions = actions.map((x)=>x.actions).flat();
        const allDocumentation = [
            ...(0, $kJ8UG.coalesce)(actions.map((x)=>x.documentation)),
            ...$ccc254bb322a1d5a$var$getAdditionalDocumentationForShowingActions(registry, model, trigger, allActions)
        ];
        return new $ccc254bb322a1d5a$var$ManagedCodeActionSet(allActions, allDocumentation, disposables);
    } finally{
        listener.dispose();
        cts.dispose();
    }
}
function $ccc254bb322a1d5a$var$getCodeActionProviders(registry, model, filter) {
    return registry.all(model)// Don't include providers that we know will not return code actions of interest
    .filter((provider)=>{
        if (!provider.providedCodeActionKinds) // We don't know what type of actions this provider will return.
        return true;
        return provider.providedCodeActionKinds.some((kind)=>(0, $fdf474d60745d657$export$260c8da5ecf5f71d)(filter, new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(kind)));
    });
}
function* $ccc254bb322a1d5a$var$getAdditionalDocumentationForShowingActions(registry, model, trigger, actionsToShow) {
    if (model && actionsToShow.length) {
        for (const provider of registry.all(model))if (provider._getAdditionalMenuItems) yield* provider._getAdditionalMenuItems?.({
            trigger: trigger.type,
            only: trigger.filter?.include?.value
        }, actionsToShow.map((item)=>item.action));
    }
}
function $ccc254bb322a1d5a$var$getDocumentationFromProvider(provider, providedCodeActions, only) {
    if (!provider.documentation) return undefined;
    const documentation = provider.documentation.map((entry)=>({
            kind: new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(entry.kind),
            command: entry.command
        }));
    if (only) {
        let currentBest;
        for (const entry of documentation)if (entry.kind.contains(only)) {
            if (!currentBest) currentBest = entry;
            else // Take best match
            if (currentBest.kind.contains(entry.kind)) currentBest = entry;
        }
        if (currentBest) return currentBest?.command;
    }
    // Otherwise, check to see if any of the provided actions match.
    for (const action of providedCodeActions){
        if (!action.kind) continue;
        for (const entry of documentation){
            if (entry.kind.contains(new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(action.kind))) return entry.command;
        }
    }
    return undefined;
}
var $ccc254bb322a1d5a$export$b792534e34813fb2;
(function(ApplyCodeActionReason) {
    ApplyCodeActionReason["OnSave"] = "onSave";
    ApplyCodeActionReason["FromProblemsView"] = "fromProblemsView";
    ApplyCodeActionReason["FromCodeActions"] = "fromCodeActions";
    ApplyCodeActionReason["FromAILightbulb"] = "fromAILightbulb"; // direct invocation when clicking on the AI lightbulb
})($ccc254bb322a1d5a$export$b792534e34813fb2 || ($ccc254bb322a1d5a$export$b792534e34813fb2 = {}));
async function $ccc254bb322a1d5a$export$69c5fd17c7ee0695(accessor, item, codeActionReason, options, token = (0, $giPcZ.CancellationToken).None) {
    const bulkEditService = accessor.get((0, $d4p5R.IBulkEditService));
    const commandService = accessor.get((0, $8tcMz.ICommandService));
    const telemetryService = accessor.get((0, $lMGba.ITelemetryService));
    const notificationService = accessor.get((0, $kCOKl.INotificationService));
    telemetryService.publicLog2('codeAction.applyCodeAction', {
        codeActionTitle: item.action.title,
        codeActionKind: item.action.kind,
        codeActionIsPreferred: !!item.action.isPreferred,
        reason: codeActionReason
    });
    await item.resolve(token);
    if (token.isCancellationRequested) return;
    if (item.action.edit?.edits.length) {
        const result = await bulkEditService.apply(item.action.edit, {
            editor: options?.editor,
            label: item.action.title,
            quotableLabel: item.action.title,
            code: 'undoredo.codeAction',
            respectAutoSaveConfig: codeActionReason !== $ccc254bb322a1d5a$export$b792534e34813fb2.OnSave,
            showPreview: options?.preview
        });
        if (!result.isApplied) return;
    }
    if (item.action.command) try {
        await commandService.executeCommand(item.action.command.id, ...item.action.command.arguments || []);
    } catch (err) {
        const message = $ccc254bb322a1d5a$var$asMessage(err);
        notificationService.error(typeof message === 'string' ? message : $4dEdH.localize('applyCodeActionFailed', "An unknown error occurred while applying the code action"));
    }
}
function $ccc254bb322a1d5a$var$asMessage(err) {
    if (typeof err === 'string') return err;
    else if (err instanceof Error && typeof err.message === 'string') return err.message;
    else return undefined;
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeCodeActionProvider', async function(accessor, resource, rangeOrSelection, kind, itemResolveCount) {
    if (!(resource instanceof (0, $5OJ54.URI))) throw (0, $gPkHZ.illegalArgument)();
    const { codeActionProvider: codeActionProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(resource);
    if (!model) throw (0, $gPkHZ.illegalArgument)();
    const validatedRangeOrSelection = (0, $jzicX.Selection).isISelection(rangeOrSelection) ? (0, $jzicX.Selection).liftSelection(rangeOrSelection) : (0, $d00il.Range).isIRange(rangeOrSelection) ? model.validateRange(rangeOrSelection) : undefined;
    if (!validatedRangeOrSelection) throw (0, $gPkHZ.illegalArgument)();
    const include = typeof kind === 'string' ? new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(kind) : undefined;
    const codeActionSet = await $ccc254bb322a1d5a$export$52ee0249dd058aac(codeActionProvider, model, validatedRangeOrSelection, {
        type: 1 /* languages.CodeActionTriggerType.Invoke */ ,
        triggerAction: (0, $fdf474d60745d657$export$f0e69435f2eb5c46).Default,
        filter: {
            includeSourceActions: true,
            include: include
        }
    }, (0, $4E7vx.Progress).None, (0, $giPcZ.CancellationToken).None);
    const resolving = [];
    const resolveCount = Math.min(codeActionSet.validActions.length, typeof itemResolveCount === 'number' ? itemResolveCount : 0);
    for(let i = 0; i < resolveCount; i++)resolving.push(codeActionSet.validActions[i].resolve((0, $giPcZ.CancellationToken).None));
    try {
        await Promise.all(resolving);
        return codeActionSet.validActions.map((item)=>item.action);
    } finally{
        setTimeout(()=>codeActionSet.dispose(), 100);
    }
});



var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $aIbUW = parcelRequire("aIbUW");

var $gPkHZ = parcelRequire("gPkHZ");

var $7DcRJ = parcelRequire("7DcRJ");

var $9cWcn = parcelRequire("9cWcn");

var $dcxQ7 = parcelRequire("dcxQ7");

var $91ntV = parcelRequire("91ntV");

var $4J6fu = parcelRequire("4J6fu");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $7DcRJ = parcelRequire("7DcRJ");



var $7IxGd = parcelRequire("7IxGd");
var $30f87b82265d30a6$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $30f87b82265d30a6$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $30f87b82265d30a6$var$CodeActionKeybindingResolver_1;
let $30f87b82265d30a6$export$5b41f08e102f6dbe = class CodeActionKeybindingResolver {
    static{
        $30f87b82265d30a6$var$CodeActionKeybindingResolver_1 = this;
    }
    static{
        this.codeActionCommands = [
            (0, $ccc254bb322a1d5a$export$691d097e330e1493),
            (0, $ccc254bb322a1d5a$export$47d177835ea6d398),
            (0, $ccc254bb322a1d5a$export$239def49abcdebc4),
            (0, $ccc254bb322a1d5a$export$9f47236fc64ddcf5),
            (0, $ccc254bb322a1d5a$export$9866f0c931c06a92)
        ];
    }
    constructor(keybindingService){
        this.keybindingService = keybindingService;
    }
    getResolver() {
        // Lazy since we may not actually ever read the value
        const allCodeActionBindings = new (0, $7DcRJ.Lazy)(()=>this.keybindingService.getKeybindings().filter((item)=>$30f87b82265d30a6$var$CodeActionKeybindingResolver_1.codeActionCommands.indexOf(item.command) >= 0).filter((item)=>item.resolvedKeybinding).map((item)=>{
                // Special case these commands since they come built-in with VS Code and don't use 'commandArgs'
                let commandArgs = item.commandArgs;
                if (item.command === (0, $ccc254bb322a1d5a$export$9f47236fc64ddcf5)) commandArgs = {
                    kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).SourceOrganizeImports.value
                };
                else if (item.command === (0, $ccc254bb322a1d5a$export$9866f0c931c06a92)) commandArgs = {
                    kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).SourceFixAll.value
                };
                return {
                    resolvedKeybinding: item.resolvedKeybinding,
                    ...(0, $fdf474d60745d657$export$b4557d8a7419d430).fromUser(commandArgs, {
                        kind: (0, $b9104f11117b1d0a$export$f06724c61e87d9db).None,
                        apply: "never" /* CodeActionAutoApply.Never */ 
                    })
                };
            }));
        return (action)=>{
            if (action.kind) {
                const binding = this.bestKeybindingForCodeAction(action, allCodeActionBindings.value);
                return binding?.resolvedKeybinding;
            }
            return undefined;
        };
    }
    bestKeybindingForCodeAction(action, candidates) {
        if (!action.kind) return undefined;
        const kind = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(action.kind);
        return candidates.filter((candidate)=>candidate.kind.contains(kind)).filter((candidate)=>{
            if (candidate.preferred) // If the candidate keybinding only applies to preferred actions, the this action must also be preferred
            return action.isPreferred;
            return true;
        }).reduceRight((currentBest, candidate)=>{
            if (!currentBest) return candidate;
            // Select the more specific binding
            return currentBest.kind.contains(candidate.kind) ? candidate : currentBest;
        }, undefined);
    }
};
$30f87b82265d30a6$export$5b41f08e102f6dbe = $30f87b82265d30a6$var$CodeActionKeybindingResolver_1 = $30f87b82265d30a6$var$__decorate([
    $30f87b82265d30a6$var$__param(0, (0, $7IxGd.IKeybindingService))
], $30f87b82265d30a6$export$5b41f08e102f6dbe);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 




var $awgRE = parcelRequire("awgRE");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $4dEdH = parcelRequire("4dEdH");

var $gaWeX = parcelRequire("gaWeX");
const $56a55d348068c717$export$3fae9d11aa0b9bc4 = (0, $gaWeX.registerColor)('symbolIcon.arrayForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.arrayForeground', 'The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$8b518b8ab21e1b34 = (0, $gaWeX.registerColor)('symbolIcon.booleanForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.booleanForeground', 'The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$4e2906c73c1071f4 = (0, $gaWeX.registerColor)('symbolIcon.classForeground', {
    dark: '#EE9D28',
    light: '#D67E00',
    hcDark: '#EE9D28',
    hcLight: '#D67E00'
}, (0, $4dEdH.localize)('symbolIcon.classForeground', 'The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$b9dc349586d7399d = (0, $gaWeX.registerColor)('symbolIcon.colorForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.colorForeground', 'The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$aff0be1504894ea8 = (0, $gaWeX.registerColor)('symbolIcon.constantForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.constantForeground', 'The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$63d89b6050035451 = (0, $gaWeX.registerColor)('symbolIcon.constructorForeground', {
    dark: '#B180D7',
    light: '#652D90',
    hcDark: '#B180D7',
    hcLight: '#652D90'
}, (0, $4dEdH.localize)('symbolIcon.constructorForeground', 'The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$327509b94276884d = (0, $gaWeX.registerColor)('symbolIcon.enumeratorForeground', {
    dark: '#EE9D28',
    light: '#D67E00',
    hcDark: '#EE9D28',
    hcLight: '#D67E00'
}, (0, $4dEdH.localize)('symbolIcon.enumeratorForeground', 'The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$82c014b2122e3732 = (0, $gaWeX.registerColor)('symbolIcon.enumeratorMemberForeground', {
    dark: '#75BEFF',
    light: '#007ACC',
    hcDark: '#75BEFF',
    hcLight: '#007ACC'
}, (0, $4dEdH.localize)('symbolIcon.enumeratorMemberForeground', 'The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$d1dd34511c01e5f7 = (0, $gaWeX.registerColor)('symbolIcon.eventForeground', {
    dark: '#EE9D28',
    light: '#D67E00',
    hcDark: '#EE9D28',
    hcLight: '#D67E00'
}, (0, $4dEdH.localize)('symbolIcon.eventForeground', 'The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$74e9aa28e30eaabc = (0, $gaWeX.registerColor)('symbolIcon.fieldForeground', {
    dark: '#75BEFF',
    light: '#007ACC',
    hcDark: '#75BEFF',
    hcLight: '#007ACC'
}, (0, $4dEdH.localize)('symbolIcon.fieldForeground', 'The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$a116c119dac29f5d = (0, $gaWeX.registerColor)('symbolIcon.fileForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.fileForeground', 'The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$2d73341161b73c6b = (0, $gaWeX.registerColor)('symbolIcon.folderForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.folderForeground', 'The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$2ca6c19cc6b399f2 = (0, $gaWeX.registerColor)('symbolIcon.functionForeground', {
    dark: '#B180D7',
    light: '#652D90',
    hcDark: '#B180D7',
    hcLight: '#652D90'
}, (0, $4dEdH.localize)('symbolIcon.functionForeground', 'The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$8a976e1cbce7093b = (0, $gaWeX.registerColor)('symbolIcon.interfaceForeground', {
    dark: '#75BEFF',
    light: '#007ACC',
    hcDark: '#75BEFF',
    hcLight: '#007ACC'
}, (0, $4dEdH.localize)('symbolIcon.interfaceForeground', 'The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$73fcd76f3eaf95ca = (0, $gaWeX.registerColor)('symbolIcon.keyForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.keyForeground', 'The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$55c4a8243445e5c1 = (0, $gaWeX.registerColor)('symbolIcon.keywordForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.keywordForeground', 'The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$ffd6832099bc300 = (0, $gaWeX.registerColor)('symbolIcon.methodForeground', {
    dark: '#B180D7',
    light: '#652D90',
    hcDark: '#B180D7',
    hcLight: '#652D90'
}, (0, $4dEdH.localize)('symbolIcon.methodForeground', 'The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$a28f8647a8c464f7 = (0, $gaWeX.registerColor)('symbolIcon.moduleForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.moduleForeground', 'The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$3f085360969ec869 = (0, $gaWeX.registerColor)('symbolIcon.namespaceForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.namespaceForeground', 'The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$faf07d36462572e = (0, $gaWeX.registerColor)('symbolIcon.nullForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.nullForeground', 'The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$98983ac5e98e402e = (0, $gaWeX.registerColor)('symbolIcon.numberForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.numberForeground', 'The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$1c6ae5c31c02eebe = (0, $gaWeX.registerColor)('symbolIcon.objectForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.objectForeground', 'The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$f7ded60d36d8c9df = (0, $gaWeX.registerColor)('symbolIcon.operatorForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.operatorForeground', 'The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$201c5e1a4afacb86 = (0, $gaWeX.registerColor)('symbolIcon.packageForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.packageForeground', 'The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$ecc1bfda99ca719b = (0, $gaWeX.registerColor)('symbolIcon.propertyForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.propertyForeground', 'The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$b2b64d36d52e1648 = (0, $gaWeX.registerColor)('symbolIcon.referenceForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.referenceForeground', 'The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$2a18d5e0c753d08f = (0, $gaWeX.registerColor)('symbolIcon.snippetForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.snippetForeground', 'The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$e5b1264624214988 = (0, $gaWeX.registerColor)('symbolIcon.stringForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.stringForeground', 'The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$a09716ab27e476aa = (0, $gaWeX.registerColor)('symbolIcon.structForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.structForeground', 'The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$63bb8b0faacec0ee = (0, $gaWeX.registerColor)('symbolIcon.textForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.textForeground', 'The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$2832ad164df8dd4b = (0, $gaWeX.registerColor)('symbolIcon.typeParameterForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.typeParameterForeground', 'The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$a88fbc3f8bc85cf8 = (0, $gaWeX.registerColor)('symbolIcon.unitForeground', (0, $gaWeX.foreground), (0, $4dEdH.localize)('symbolIcon.unitForeground', 'The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));
const $56a55d348068c717$export$479057adc7371f16 = (0, $gaWeX.registerColor)('symbolIcon.variableForeground', {
    dark: '#75BEFF',
    light: '#007ACC',
    hcDark: '#75BEFF',
    hcLight: '#007ACC'
}, (0, $4dEdH.localize)('symbolIcon.variableForeground', 'The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget.'));



var $4dEdH = parcelRequire("4dEdH");

const $ae9ec488e0f21329$var$uncategorizedCodeActionGroup = Object.freeze({
    kind: (0, $b9104f11117b1d0a$export$f06724c61e87d9db).Empty,
    title: (0, $4dEdH.localize)('codeAction.widget.id.more', 'More Actions...')
});
const $ae9ec488e0f21329$var$codeActionGroups = Object.freeze([
    {
        kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix,
        title: (0, $4dEdH.localize)('codeAction.widget.id.quickfix', 'Quick Fix')
    },
    {
        kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorExtract,
        title: (0, $4dEdH.localize)('codeAction.widget.id.extract', 'Extract'),
        icon: (0, $awgRE.Codicon).wrench
    },
    {
        kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorInline,
        title: (0, $4dEdH.localize)('codeAction.widget.id.inline', 'Inline'),
        icon: (0, $awgRE.Codicon).wrench
    },
    {
        kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorRewrite,
        title: (0, $4dEdH.localize)('codeAction.widget.id.convert', 'Rewrite'),
        icon: (0, $awgRE.Codicon).wrench
    },
    {
        kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorMove,
        title: (0, $4dEdH.localize)('codeAction.widget.id.move', 'Move'),
        icon: (0, $awgRE.Codicon).wrench
    },
    {
        kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).SurroundWith,
        title: (0, $4dEdH.localize)('codeAction.widget.id.surround', 'Surround With'),
        icon: (0, $awgRE.Codicon).surroundWith
    },
    {
        kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).Source,
        title: (0, $4dEdH.localize)('codeAction.widget.id.source', 'Source Action'),
        icon: (0, $awgRE.Codicon).symbolFile
    },
    $ae9ec488e0f21329$var$uncategorizedCodeActionGroup
]);
function $ae9ec488e0f21329$export$ccfd4d10d26a30da(inputCodeActions, showHeaders, keybindingResolver) {
    if (!showHeaders) return inputCodeActions.map((action)=>{
        return {
            kind: "action" /* ActionListItemKind.Action */ ,
            item: action,
            group: $ae9ec488e0f21329$var$uncategorizedCodeActionGroup,
            disabled: !!action.action.disabled,
            label: action.action.disabled || action.action.title,
            canPreview: !!action.action.edit?.edits.length
        };
    });
    // Group code actions
    const menuEntries = $ae9ec488e0f21329$var$codeActionGroups.map((group)=>({
            group: group,
            actions: []
        }));
    for (const action of inputCodeActions){
        const kind = action.action.kind ? new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(action.action.kind) : (0, $b9104f11117b1d0a$export$f06724c61e87d9db).None;
        for (const menuEntry of menuEntries)if (menuEntry.group.kind.contains(kind)) {
            menuEntry.actions.push(action);
            break;
        }
    }
    const allMenuItems = [];
    for (const menuEntry of menuEntries)if (menuEntry.actions.length) {
        allMenuItems.push({
            kind: "header" /* ActionListItemKind.Header */ ,
            group: menuEntry.group
        });
        for (const action of menuEntry.actions){
            const group = menuEntry.group;
            allMenuItems.push({
                kind: "action" /* ActionListItemKind.Action */ ,
                item: action,
                group: action.action.isAI ? {
                    title: group.title,
                    kind: group.kind,
                    icon: (0, $awgRE.Codicon).sparkle
                } : group,
                label: action.action.title,
                disabled: !!action.action.disabled,
                keybinding: keybindingResolver(action.action)
            });
        }
    }
    return allMenuItems;
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $cnAUf = parcelRequire("cnAUf");

var $awgRE = parcelRequire("awgRE");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $5rADe = parcelRequire("5rADe");


var $1Y4vr = parcelRequire("1Y4vr");

var $91ntV = parcelRequire("91ntV");

var $a47jW = parcelRequire("a47jW");


var $4dEdH = parcelRequire("4dEdH");

var $7IxGd = parcelRequire("7IxGd");

var $hEsmQ = parcelRequire("hEsmQ");

var $d00il = parcelRequire("d00il");
var $710ecf1a61141b5c$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $710ecf1a61141b5c$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $710ecf1a61141b5c$var$LightBulbWidget_1;
const $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_ICON = (0, $hEsmQ.registerIcon)('gutter-lightbulb', (0, $awgRE.Codicon).lightBulb, $4dEdH.localize('gutterLightbulbWidget', 'Icon which spawns code actions menu from the gutter when there is no space in the editor.'));
const $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AUTO_FIX_ICON = (0, $hEsmQ.registerIcon)('gutter-lightbulb-auto-fix', (0, $awgRE.Codicon).lightbulbAutofix, $4dEdH.localize('gutterLightbulbAutoFixWidget', 'Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.'));
const $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AIFIX_ICON = (0, $hEsmQ.registerIcon)('gutter-lightbulb-sparkle', (0, $awgRE.Codicon).lightbulbSparkle, $4dEdH.localize('gutterLightbulbAIFixWidget', 'Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.'));
const $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AIFIX_AUTO_FIX_ICON = (0, $hEsmQ.registerIcon)('gutter-lightbulb-aifix-auto-fix', (0, $awgRE.Codicon).lightbulbSparkleAutofix, $4dEdH.localize('gutterLightbulbAIFixAutoFixWidget', 'Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.'));
const $710ecf1a61141b5c$var$GUTTER_SPARKLE_FILLED_ICON = (0, $hEsmQ.registerIcon)('gutter-lightbulb-sparkle-filled', (0, $awgRE.Codicon).sparkleFilled, $4dEdH.localize('gutterLightbulbSparkleFilledWidget', 'Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.'));
var $710ecf1a61141b5c$var$LightBulbState;
(function(LightBulbState) {
    LightBulbState.Hidden = {
        type: 0 /* Type.Hidden */ 
    };
    class Showing {
        constructor(actions, trigger, editorPosition, widgetPosition){
            this.actions = actions;
            this.trigger = trigger;
            this.editorPosition = editorPosition;
            this.widgetPosition = widgetPosition;
            this.type = 1 /* Type.Showing */ ;
        }
    }
    LightBulbState.Showing = Showing;
})($710ecf1a61141b5c$var$LightBulbState || ($710ecf1a61141b5c$var$LightBulbState = {}));
let $710ecf1a61141b5c$export$87ab1750f69500a0 = class LightBulbWidget extends (0, $9cWcn.Disposable) {
    static{
        $710ecf1a61141b5c$var$LightBulbWidget_1 = this;
    }
    static{
        this.GUTTER_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'codicon-gutter-lightbulb-decoration',
            glyphMarginClassName: (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).lightBulb),
            glyphMargin: {
                position: (0, $1Y4vr.GlyphMarginLane).Left
            },
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ 
        });
    }
    static{
        this.ID = 'editor.contrib.lightbulbWidget';
    }
    static{
        this._posPref = [
            0 /* ContentWidgetPositionPreference.EXACT */ 
        ];
    }
    constructor(_editor, _keybindingService){
        super();
        this._editor = _editor;
        this._keybindingService = _keybindingService;
        this._onClick = this._register(new (0, $5YaSO.Emitter)());
        this.onClick = this._onClick.event;
        this._state = $710ecf1a61141b5c$var$LightBulbState.Hidden;
        this._gutterState = $710ecf1a61141b5c$var$LightBulbState.Hidden;
        this._iconClasses = [];
        this.lightbulbClasses = [
            'codicon-' + $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_ICON.id,
            'codicon-' + $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AIFIX_AUTO_FIX_ICON.id,
            'codicon-' + $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AUTO_FIX_ICON.id,
            'codicon-' + $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AIFIX_ICON.id,
            'codicon-' + $710ecf1a61141b5c$var$GUTTER_SPARKLE_FILLED_ICON.id
        ];
        this.gutterDecoration = $710ecf1a61141b5c$var$LightBulbWidget_1.GUTTER_DECORATION;
        this._domNode = $bDzmQ.$('div.lightBulbWidget');
        this._domNode.role = 'listbox';
        this._register((0, $cnAUf.Gesture).ignoreTarget(this._domNode));
        this._editor.addContentWidget(this);
        this._register(this._editor.onDidChangeModelContent((_)=>{
            // cancel when the line in question has been removed
            const editorModel = this._editor.getModel();
            if (this.state.type !== 1 /* LightBulbState.Type.Showing */  || !editorModel || this.state.editorPosition.lineNumber >= editorModel.getLineCount()) this.hide();
            if (this.gutterState.type !== 1 /* LightBulbState.Type.Showing */  || !editorModel || this.gutterState.editorPosition.lineNumber >= editorModel.getLineCount()) this.gutterHide();
        }));
        this._register($bDzmQ.addStandardDisposableGenericMouseDownListener(this._domNode, (e)=>{
            if (this.state.type !== 1 /* LightBulbState.Type.Showing */ ) return;
            // Make sure that focus / cursor location is not lost when clicking widget icon
            this._editor.focus();
            e.preventDefault();
            // a bit of extra work to make sure the menu
            // doesn't cover the line-text
            const { top: top, height: height } = $bDzmQ.getDomNodePagePosition(this._domNode);
            const lineHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ );
            let pad = Math.floor(lineHeight / 3);
            if (this.state.widgetPosition.position !== null && this.state.widgetPosition.position.lineNumber < this.state.editorPosition.lineNumber) pad += lineHeight;
            this._onClick.fire({
                x: e.posx,
                y: top + height + pad,
                actions: this.state.actions,
                trigger: this.state.trigger
            });
        }));
        this._register($bDzmQ.addDisposableListener(this._domNode, 'mouseenter', (e)=>{
            if ((e.buttons & 1) !== 1) return;
            // mouse enters lightbulb while the primary/left button
            // is being pressed -> hide the lightbulb
            this.hide();
        }));
        this._register((0, $5YaSO.Event).runAndSubscribe(this._keybindingService.onDidUpdateKeybindings, ()=>{
            this._preferredKbLabel = this._keybindingService.lookupKeybinding((0, $ccc254bb322a1d5a$export$8e5bae78476830b3))?.getLabel() ?? undefined;
            this._quickFixKbLabel = this._keybindingService.lookupKeybinding((0, $ccc254bb322a1d5a$export$3db60be65e567c5d))?.getLabel() ?? undefined;
            this._updateLightBulbTitleAndIcon();
        }));
        this._register(this._editor.onMouseDown(async (e)=>{
            if (!e.target.element || !this.lightbulbClasses.some((cls)=>e.target.element && e.target.element.classList.contains(cls))) return;
            if (this.gutterState.type !== 1 /* LightBulbState.Type.Showing */ ) return;
            // Make sure that focus / cursor location is not lost when clicking widget icon
            this._editor.focus();
            // a bit of extra work to make sure the menu
            // doesn't cover the line-text
            const { top: top, height: height } = $bDzmQ.getDomNodePagePosition(e.target.element);
            const lineHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ );
            let pad = Math.floor(lineHeight / 3);
            if (this.gutterState.widgetPosition.position !== null && this.gutterState.widgetPosition.position.lineNumber < this.gutterState.editorPosition.lineNumber) pad += lineHeight;
            this._onClick.fire({
                x: e.event.posx,
                y: top + height + pad,
                actions: this.gutterState.actions,
                trigger: this.gutterState.trigger
            });
        }));
    }
    dispose() {
        super.dispose();
        this._editor.removeContentWidget(this);
        if (this._gutterDecorationID) this._removeGutterDecoration(this._gutterDecorationID);
    }
    getId() {
        return 'LightBulbWidget';
    }
    getDomNode() {
        return this._domNode;
    }
    getPosition() {
        return this._state.type === 1 /* LightBulbState.Type.Showing */  ? this._state.widgetPosition : null;
    }
    update(actions, trigger, atPosition) {
        if (actions.validActions.length <= 0) {
            this.gutterHide();
            return this.hide();
        }
        const hasTextFocus = this._editor.hasTextFocus();
        if (!hasTextFocus) {
            this.gutterHide();
            return this.hide();
        }
        const options = this._editor.getOptions();
        if (!options.get(65 /* EditorOption.lightbulb */ ).enabled) {
            this.gutterHide();
            return this.hide();
        }
        const model = this._editor.getModel();
        if (!model) {
            this.gutterHide();
            return this.hide();
        }
        const { lineNumber: lineNumber, column: column } = model.validatePosition(atPosition);
        const tabSize = model.getOptions().tabSize;
        const fontInfo = this._editor.getOptions().get(50 /* EditorOption.fontInfo */ );
        const lineContent = model.getLineContent(lineNumber);
        const indent = (0, $a47jW.computeIndentLevel)(lineContent, tabSize);
        const lineHasSpace = fontInfo.spaceWidth * indent > 22;
        const isFolded = (lineNumber)=>{
            return lineNumber > 2 && this._editor.getTopForLineNumber(lineNumber) === this._editor.getTopForLineNumber(lineNumber - 1);
        };
        // Check for glyph margin decorations of any kind
        const currLineDecorations = this._editor.getLineDecorations(lineNumber);
        let hasDecoration = false;
        if (currLineDecorations) for (const decoration of currLineDecorations){
            const glyphClass = decoration.options.glyphMarginClassName;
            if (glyphClass && !this.lightbulbClasses.some((className)=>glyphClass.includes(className))) {
                hasDecoration = true;
                break;
            }
        }
        let effectiveLineNumber = lineNumber;
        let effectiveColumnNumber = 1;
        if (!lineHasSpace) {
            // Checks if line is empty or starts with any amount of whitespace
            const isLineEmptyOrIndented = (lineNumber)=>{
                const lineContent = model.getLineContent(lineNumber);
                return /^\s*$|^\s+/.test(lineContent) || lineContent.length <= effectiveColumnNumber;
            };
            if (lineNumber > 1 && !isFolded(lineNumber - 1)) {
                const lineCount = model.getLineCount();
                const endLine = lineNumber === lineCount;
                const prevLineEmptyOrIndented = lineNumber > 1 && isLineEmptyOrIndented(lineNumber - 1);
                const nextLineEmptyOrIndented = !endLine && isLineEmptyOrIndented(lineNumber + 1);
                const currLineEmptyOrIndented = isLineEmptyOrIndented(lineNumber);
                const notEmpty = !nextLineEmptyOrIndented && !prevLineEmptyOrIndented;
                // check above and below. if both are blocked, display lightbulb in the gutter.
                if (!nextLineEmptyOrIndented && !prevLineEmptyOrIndented && !hasDecoration) {
                    this.gutterState = new $710ecf1a61141b5c$var$LightBulbState.Showing(actions, trigger, atPosition, {
                        position: {
                            lineNumber: effectiveLineNumber,
                            column: effectiveColumnNumber
                        },
                        preference: $710ecf1a61141b5c$var$LightBulbWidget_1._posPref
                    });
                    this.renderGutterLightbub();
                    return this.hide();
                } else if (prevLineEmptyOrIndented || endLine || prevLineEmptyOrIndented && !currLineEmptyOrIndented) effectiveLineNumber -= 1;
                else if (nextLineEmptyOrIndented || notEmpty && currLineEmptyOrIndented) effectiveLineNumber += 1;
            } else if (lineNumber === 1 && (lineNumber === model.getLineCount() || !isLineEmptyOrIndented(lineNumber + 1) && !isLineEmptyOrIndented(lineNumber))) {
                // special checks for first line blocked vs. not blocked.
                this.gutterState = new $710ecf1a61141b5c$var$LightBulbState.Showing(actions, trigger, atPosition, {
                    position: {
                        lineNumber: effectiveLineNumber,
                        column: effectiveColumnNumber
                    },
                    preference: $710ecf1a61141b5c$var$LightBulbWidget_1._posPref
                });
                if (hasDecoration) this.gutterHide();
                else {
                    this.renderGutterLightbub();
                    return this.hide();
                }
            } else if (lineNumber < model.getLineCount() && !isFolded(lineNumber + 1)) effectiveLineNumber += 1;
            else if (column * fontInfo.spaceWidth < 22) // cannot show lightbulb above/below and showing
            // it inline would overlay the cursor...
            return this.hide();
            effectiveColumnNumber = /^\S\s*$/.test(model.getLineContent(effectiveLineNumber)) ? 2 : 1;
        }
        this.state = new $710ecf1a61141b5c$var$LightBulbState.Showing(actions, trigger, atPosition, {
            position: {
                lineNumber: effectiveLineNumber,
                column: effectiveColumnNumber
            },
            preference: $710ecf1a61141b5c$var$LightBulbWidget_1._posPref
        });
        if (this._gutterDecorationID) {
            this._removeGutterDecoration(this._gutterDecorationID);
            this.gutterHide();
        }
        const validActions = actions.validActions;
        const actionKind = actions.validActions[0].action.kind;
        if (validActions.length !== 1 || !actionKind) {
            this._editor.layoutContentWidget(this);
            return;
        }
        this._editor.layoutContentWidget(this);
    }
    hide() {
        if (this.state === $710ecf1a61141b5c$var$LightBulbState.Hidden) return;
        this.state = $710ecf1a61141b5c$var$LightBulbState.Hidden;
        this._editor.layoutContentWidget(this);
    }
    gutterHide() {
        if (this.gutterState === $710ecf1a61141b5c$var$LightBulbState.Hidden) return;
        if (this._gutterDecorationID) this._removeGutterDecoration(this._gutterDecorationID);
        this.gutterState = $710ecf1a61141b5c$var$LightBulbState.Hidden;
    }
    get state() {
        return this._state;
    }
    set state(value) {
        this._state = value;
        this._updateLightBulbTitleAndIcon();
    }
    get gutterState() {
        return this._gutterState;
    }
    set gutterState(value) {
        this._gutterState = value;
        this._updateGutterLightBulbTitleAndIcon();
    }
    _updateLightBulbTitleAndIcon() {
        this._domNode.classList.remove(...this._iconClasses);
        this._iconClasses = [];
        if (this.state.type !== 1 /* LightBulbState.Type.Showing */ ) return;
        let icon;
        let autoRun = false;
        if (this.state.actions.allAIFixes) {
            icon = (0, $awgRE.Codicon).sparkleFilled;
            if (this.state.actions.validActions.length === 1) autoRun = true;
        } else if (this.state.actions.hasAutoFix) {
            if (this.state.actions.hasAIFix) icon = (0, $awgRE.Codicon).lightbulbSparkleAutofix;
            else icon = (0, $awgRE.Codicon).lightbulbAutofix;
        } else if (this.state.actions.hasAIFix) icon = (0, $awgRE.Codicon).lightbulbSparkle;
        else icon = (0, $awgRE.Codicon).lightBulb;
        this._updateLightbulbTitle(this.state.actions.hasAutoFix, autoRun);
        this._iconClasses = (0, $5rADe.ThemeIcon).asClassNameArray(icon);
        this._domNode.classList.add(...this._iconClasses);
    }
    _updateGutterLightBulbTitleAndIcon() {
        if (this.gutterState.type !== 1 /* LightBulbState.Type.Showing */ ) return;
        let icon;
        let autoRun = false;
        if (this.gutterState.actions.allAIFixes) {
            icon = $710ecf1a61141b5c$var$GUTTER_SPARKLE_FILLED_ICON;
            if (this.gutterState.actions.validActions.length === 1) autoRun = true;
        } else if (this.gutterState.actions.hasAutoFix) {
            if (this.gutterState.actions.hasAIFix) icon = $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AIFIX_AUTO_FIX_ICON;
            else icon = $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AUTO_FIX_ICON;
        } else if (this.gutterState.actions.hasAIFix) icon = $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_AIFIX_ICON;
        else icon = $710ecf1a61141b5c$var$GUTTER_LIGHTBULB_ICON;
        this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix, autoRun);
        const GUTTER_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'codicon-gutter-lightbulb-decoration',
            glyphMarginClassName: (0, $5rADe.ThemeIcon).asClassName(icon),
            glyphMargin: {
                position: (0, $1Y4vr.GlyphMarginLane).Left
            },
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ 
        });
        this.gutterDecoration = GUTTER_DECORATION;
    }
    /* Gutter Helper Functions */ renderGutterLightbub() {
        const selection = this._editor.getSelection();
        if (!selection) return;
        if (this._gutterDecorationID === undefined) this._addGutterDecoration(selection.startLineNumber);
        else this._updateGutterDecoration(this._gutterDecorationID, selection.startLineNumber);
    }
    _addGutterDecoration(lineNumber) {
        this._editor.changeDecorations((accessor)=>{
            this._gutterDecorationID = accessor.addDecoration(new (0, $d00il.Range)(lineNumber, 0, lineNumber, 0), this.gutterDecoration);
        });
    }
    _removeGutterDecoration(decorationId) {
        this._editor.changeDecorations((accessor)=>{
            accessor.removeDecoration(decorationId);
            this._gutterDecorationID = undefined;
        });
    }
    _updateGutterDecoration(decorationId, lineNumber) {
        this._editor.changeDecorations((accessor)=>{
            accessor.changeDecoration(decorationId, new (0, $d00il.Range)(lineNumber, 0, lineNumber, 0));
            accessor.changeDecorationOptions(decorationId, this.gutterDecoration);
        });
    }
    _updateLightbulbTitle(autoFix, autoRun) {
        if (this.state.type !== 1 /* LightBulbState.Type.Showing */ ) return;
        if (autoRun) this.title = $4dEdH.localize('codeActionAutoRun', "Run: {0}", this.state.actions.validActions[0].action.title);
        else if (autoFix && this._preferredKbLabel) this.title = $4dEdH.localize('preferredcodeActionWithKb', "Show Code Actions. Preferred Quick Fix Available ({0})", this._preferredKbLabel);
        else if (!autoFix && this._quickFixKbLabel) this.title = $4dEdH.localize('codeActionWithKb', "Show Code Actions ({0})", this._quickFixKbLabel);
        else if (!autoFix) this.title = $4dEdH.localize('codeAction', "Show Code Actions");
    }
    set title(value) {
        this._domNode.title = value;
    }
};
$710ecf1a61141b5c$export$87ab1750f69500a0 = $710ecf1a61141b5c$var$LightBulbWidget_1 = $710ecf1a61141b5c$var$__decorate([
    $710ecf1a61141b5c$var$__param(1, (0, $7IxGd.IKeybindingService))
], $710ecf1a61141b5c$export$87ab1750f69500a0);




var $4dEdH = parcelRequire("4dEdH");

var $bDzmQ = parcelRequire("bDzmQ");

var $czr0Q = parcelRequire("czr0Q");

var $9cWcn = parcelRequire("9cWcn");


var $4dEdH = parcelRequire("4dEdH");

var $bDzmQ = parcelRequire("bDzmQ");

var $27s0k = parcelRequire("27s0k");

var $dD2OW = parcelRequire("dD2OW");

var $giPcZ = parcelRequire("giPcZ");

var $awgRE = parcelRequire("awgRE");

var $9cWcn = parcelRequire("9cWcn");

var $lb0Ah = parcelRequire("lb0Ah");

var $5rADe = parcelRequire("5rADe");


var $4dEdH = parcelRequire("4dEdH");

var $d6K7e = parcelRequire("d6K7e");

var $7IxGd = parcelRequire("7IxGd");

var $l1XLO = parcelRequire("l1XLO");

var $gaWeX = parcelRequire("gaWeX");
var $e6b10c4d20dcdcf8$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $e6b10c4d20dcdcf8$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $e6b10c4d20dcdcf8$export$6f0ea2796e45373c = 'acceptSelectedCodeAction';
const $e6b10c4d20dcdcf8$export$77d3a8ab79a8eaa2 = 'previewSelectedCodeAction';
class $e6b10c4d20dcdcf8$var$HeaderRenderer {
    get templateId() {
        return "header" /* ActionListItemKind.Header */ ;
    }
    renderTemplate(container) {
        container.classList.add('group-header');
        const text = document.createElement('span');
        container.append(text);
        return {
            container: container,
            text: text
        };
    }
    renderElement(element, _index, templateData) {
        templateData.text.textContent = element.group?.title ?? '';
    }
    disposeTemplate(_templateData) {
    // noop
    }
}
let $e6b10c4d20dcdcf8$var$ActionItemRenderer = class ActionItemRenderer {
    get templateId() {
        return "action" /* ActionListItemKind.Action */ ;
    }
    constructor(_supportsPreview, _keybindingService){
        this._supportsPreview = _supportsPreview;
        this._keybindingService = _keybindingService;
    }
    renderTemplate(container) {
        container.classList.add(this.templateId);
        const icon = document.createElement('div');
        icon.className = 'icon';
        container.append(icon);
        const text = document.createElement('span');
        text.className = 'title';
        container.append(text);
        const keybinding = new (0, $27s0k.KeybindingLabel)(container, (0, $lb0Ah.OS));
        return {
            container: container,
            icon: icon,
            text: text,
            keybinding: keybinding
        };
    }
    renderElement(element, _index, data) {
        if (element.group?.icon) {
            data.icon.className = (0, $5rADe.ThemeIcon).asClassName(element.group.icon);
            if (element.group.icon.color) data.icon.style.color = (0, $gaWeX.asCssVariable)(element.group.icon.color.id);
        } else {
            data.icon.className = (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).lightBulb);
            data.icon.style.color = 'var(--vscode-editorLightBulb-foreground)';
        }
        if (!element.item || !element.label) return;
        data.text.textContent = $e6b10c4d20dcdcf8$var$stripNewlines(element.label);
        data.keybinding.set(element.keybinding);
        $bDzmQ.setVisibility(!!element.keybinding, data.keybinding.element);
        const actionTitle = this._keybindingService.lookupKeybinding($e6b10c4d20dcdcf8$export$6f0ea2796e45373c)?.getLabel();
        const previewTitle = this._keybindingService.lookupKeybinding($e6b10c4d20dcdcf8$export$77d3a8ab79a8eaa2)?.getLabel();
        data.container.classList.toggle('option-disabled', element.disabled);
        if (element.disabled) data.container.title = element.label;
        else if (actionTitle && previewTitle) {
            if (this._supportsPreview && element.canPreview) data.container.title = (0, $4dEdH.localize)({
                key: 'label-preview',
                comment: [
                    'placeholders are keybindings, e.g "F2 to Apply, Shift+F2 to Preview"'
                ]
            }, "{0} to Apply, {1} to Preview", actionTitle, previewTitle);
            else data.container.title = (0, $4dEdH.localize)({
                key: 'label',
                comment: [
                    'placeholder is a keybinding, e.g "F2 to Apply"'
                ]
            }, "{0} to Apply", actionTitle);
        } else data.container.title = '';
    }
    disposeTemplate(_templateData) {
        _templateData.keybinding.dispose();
    }
};
$e6b10c4d20dcdcf8$var$ActionItemRenderer = $e6b10c4d20dcdcf8$var$__decorate([
    $e6b10c4d20dcdcf8$var$__param(1, (0, $7IxGd.IKeybindingService))
], $e6b10c4d20dcdcf8$var$ActionItemRenderer);
class $e6b10c4d20dcdcf8$var$AcceptSelectedEvent extends UIEvent {
    constructor(){
        super('acceptSelectedAction');
    }
}
class $e6b10c4d20dcdcf8$var$PreviewSelectedEvent extends UIEvent {
    constructor(){
        super('previewSelectedAction');
    }
}
function $e6b10c4d20dcdcf8$var$getKeyboardNavigationLabel(item) {
    // Filter out header vs. action
    if (item.kind === 'action') return item.label;
    return undefined;
}
let $e6b10c4d20dcdcf8$export$1334b68ecc345cef = class ActionList extends (0, $9cWcn.Disposable) {
    constructor(user, preview, items, _delegate, _contextViewService, _keybindingService){
        super();
        this._delegate = _delegate;
        this._contextViewService = _contextViewService;
        this._keybindingService = _keybindingService;
        this._actionLineHeight = 24;
        this._headerLineHeight = 26;
        this.cts = this._register(new (0, $giPcZ.CancellationTokenSource)());
        this.domNode = document.createElement('div');
        this.domNode.classList.add('actionList');
        const virtualDelegate = {
            getHeight: (element)=>element.kind === "header" /* ActionListItemKind.Header */  ? this._headerLineHeight : this._actionLineHeight,
            getTemplateId: (element)=>element.kind
        };
        this._list = this._register(new (0, $dD2OW.List)(user, this.domNode, virtualDelegate, [
            new $e6b10c4d20dcdcf8$var$ActionItemRenderer(preview, this._keybindingService),
            new $e6b10c4d20dcdcf8$var$HeaderRenderer()
        ], {
            keyboardSupport: false,
            typeNavigationEnabled: true,
            keyboardNavigationLabelProvider: {
                getKeyboardNavigationLabel: $e6b10c4d20dcdcf8$var$getKeyboardNavigationLabel
            },
            accessibilityProvider: {
                getAriaLabel: (element)=>{
                    if (element.kind === "action" /* ActionListItemKind.Action */ ) {
                        let label = element.label ? $e6b10c4d20dcdcf8$var$stripNewlines(element?.label) : '';
                        if (element.disabled) label = (0, $4dEdH.localize)({
                            key: 'customQuickFixWidget.labels',
                            comment: [
                                `Action widget labels for accessibility.`
                            ]
                        }, "{0}, Disabled Reason: {1}", label, element.disabled);
                        return label;
                    }
                    return null;
                },
                getWidgetAriaLabel: ()=>(0, $4dEdH.localize)({
                        key: 'customQuickFixWidget',
                        comment: [
                            `An action widget option`
                        ]
                    }, "Action Widget"),
                getRole: (e)=>e.kind === "action" /* ActionListItemKind.Action */  ? 'option' : 'separator',
                getWidgetRole: ()=>'listbox'
            }
        }));
        this._list.style((0, $l1XLO.defaultListStyles));
        this._register(this._list.onMouseClick((e)=>this.onListClick(e)));
        this._register(this._list.onMouseOver((e)=>this.onListHover(e)));
        this._register(this._list.onDidChangeFocus(()=>this.onFocus()));
        this._register(this._list.onDidChangeSelection((e)=>this.onListSelection(e)));
        this._allMenuItems = items;
        this._list.splice(0, this._list.length, this._allMenuItems);
        if (this._list.length) this.focusNext();
    }
    focusCondition(element) {
        return !element.disabled && element.kind === "action" /* ActionListItemKind.Action */ ;
    }
    hide(didCancel) {
        this._delegate.onHide(didCancel);
        this.cts.cancel();
        this._contextViewService.hideContextView();
    }
    layout(minWidth) {
        // Updating list height, depending on how many separators and headers there are.
        const numHeaders = this._allMenuItems.filter((item)=>item.kind === 'header').length;
        const itemsHeight = this._allMenuItems.length * this._actionLineHeight;
        const heightWithHeaders = itemsHeight + numHeaders * this._headerLineHeight - numHeaders * this._actionLineHeight;
        this._list.layout(heightWithHeaders);
        let maxWidth = minWidth;
        if (this._allMenuItems.length >= 50) maxWidth = 380;
        else {
            // For finding width dynamically (not using resize observer)
            const itemWidths = this._allMenuItems.map((_, index)=>{
                const element = this.domNode.ownerDocument.getElementById(this._list.getElementID(index));
                if (element) {
                    element.style.width = 'auto';
                    const width = element.getBoundingClientRect().width;
                    element.style.width = '';
                    return width;
                }
                return 0;
            });
            // resize observer - can be used in the future since list widget supports dynamic height but not width
            maxWidth = Math.max(...itemWidths, minWidth);
        }
        const maxVhPrecentage = 0.7;
        const height = Math.min(heightWithHeaders, this.domNode.ownerDocument.body.clientHeight * maxVhPrecentage);
        this._list.layout(height, maxWidth);
        this.domNode.style.height = `${height}px`;
        this._list.domFocus();
        return maxWidth;
    }
    focusPrevious() {
        this._list.focusPrevious(1, true, undefined, this.focusCondition);
    }
    focusNext() {
        this._list.focusNext(1, true, undefined, this.focusCondition);
    }
    acceptSelected(preview) {
        const focused = this._list.getFocus();
        if (focused.length === 0) return;
        const focusIndex = focused[0];
        const element = this._list.element(focusIndex);
        if (!this.focusCondition(element)) return;
        const event = preview ? new $e6b10c4d20dcdcf8$var$PreviewSelectedEvent() : new $e6b10c4d20dcdcf8$var$AcceptSelectedEvent();
        this._list.setSelection([
            focusIndex
        ], event);
    }
    onListSelection(e) {
        if (!e.elements.length) return;
        const element = e.elements[0];
        if (element.item && this.focusCondition(element)) this._delegate.onSelect(element.item, e.browserEvent instanceof $e6b10c4d20dcdcf8$var$PreviewSelectedEvent);
        else this._list.setSelection([]);
    }
    onFocus() {
        const focused = this._list.getFocus();
        if (focused.length === 0) return;
        const focusIndex = focused[0];
        const element = this._list.element(focusIndex);
        this._delegate.onFocus?.(element.item);
    }
    async onListHover(e) {
        const element = e.element;
        if (element && element.item && this.focusCondition(element)) {
            if (this._delegate.onHover && !element.disabled && element.kind === "action" /* ActionListItemKind.Action */ ) {
                const result = await this._delegate.onHover(element.item, this.cts.token);
                element.canPreview = result ? result.canPreview : undefined;
            }
            if (e.index) this._list.splice(e.index, 1, [
                element
            ]);
        }
        this._list.setFocus(typeof e.index === 'number' ? [
            e.index
        ] : []);
    }
    onListClick(e) {
        if (e.element && this.focusCondition(e.element)) this._list.setFocus([]);
    }
};
$e6b10c4d20dcdcf8$export$1334b68ecc345cef = $e6b10c4d20dcdcf8$var$__decorate([
    $e6b10c4d20dcdcf8$var$__param(4, (0, $d6K7e.IContextViewService)),
    $e6b10c4d20dcdcf8$var$__param(5, (0, $7IxGd.IKeybindingService))
], $e6b10c4d20dcdcf8$export$1334b68ecc345cef);
function $e6b10c4d20dcdcf8$var$stripNewlines(str) {
    return str.replace(/\r\n|\r|\n/g, ' ');
}



var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");

var $d6K7e = parcelRequire("d6K7e");

var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

var $gaWeX = parcelRequire("gaWeX");
var $f1d7b56b2f7a6f69$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $f1d7b56b2f7a6f69$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
(0, $gaWeX.registerColor)('actionBar.toggledBackground', (0, $gaWeX.inputActiveOptionBackground), (0, $4dEdH.localize)('actionBar.toggledBackground', 'Background color for toggled action items in action bar.'));
const $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys = {
    Visible: new (0, $cxCeF.RawContextKey)('codeActionMenuVisible', false, (0, $4dEdH.localize)('codeActionMenuVisible', "Whether the action widget list is visible"))
};
const $f1d7b56b2f7a6f69$export$c7b3ec6ac743f926 = (0, $fdGPu.createDecorator)('actionWidgetService');
let $f1d7b56b2f7a6f69$var$ActionWidgetService = class ActionWidgetService extends (0, $9cWcn.Disposable) {
    get isVisible() {
        return $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys.Visible.getValue(this._contextKeyService) || false;
    }
    constructor(_contextViewService, _contextKeyService, _instantiationService){
        super();
        this._contextViewService = _contextViewService;
        this._contextKeyService = _contextKeyService;
        this._instantiationService = _instantiationService;
        this._list = this._register(new (0, $9cWcn.MutableDisposable)());
    }
    show(user, supportsPreview, items, delegate, anchor, container, actionBarActions) {
        const visibleContext = $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys.Visible.bindTo(this._contextKeyService);
        const list = this._instantiationService.createInstance((0, $e6b10c4d20dcdcf8$export$1334b68ecc345cef), user, supportsPreview, items, delegate);
        this._contextViewService.showContextView({
            getAnchor: ()=>anchor,
            render: (container)=>{
                visibleContext.set(true);
                return this._renderWidget(container, list, actionBarActions ?? []);
            },
            onHide: (didCancel)=>{
                visibleContext.reset();
                this._onWidgetClosed(didCancel);
            }
        }, container, false);
    }
    acceptSelected(preview) {
        this._list.value?.acceptSelected(preview);
    }
    focusPrevious() {
        this._list?.value?.focusPrevious();
    }
    focusNext() {
        this._list?.value?.focusNext();
    }
    hide(didCancel) {
        this._list.value?.hide(didCancel);
        this._list.clear();
    }
    _renderWidget(element, list, actionBarActions) {
        const widget = document.createElement('div');
        widget.classList.add('action-widget');
        element.appendChild(widget);
        this._list.value = list;
        if (this._list.value) widget.appendChild(this._list.value.domNode);
        else throw new Error('List has no value');
        const renderDisposables = new (0, $9cWcn.DisposableStore)();
        // Invisible div to block mouse interaction in the rest of the UI
        const menuBlock = document.createElement('div');
        const block = element.appendChild(menuBlock);
        block.classList.add('context-view-block');
        renderDisposables.add($bDzmQ.addDisposableListener(block, $bDzmQ.EventType.MOUSE_DOWN, (e)=>e.stopPropagation()));
        // Invisible div to block mouse interaction with the menu
        const pointerBlockDiv = document.createElement('div');
        const pointerBlock = element.appendChild(pointerBlockDiv);
        pointerBlock.classList.add('context-view-pointerBlock');
        // Removes block on click INSIDE widget or ANY mouse movement
        renderDisposables.add($bDzmQ.addDisposableListener(pointerBlock, $bDzmQ.EventType.POINTER_MOVE, ()=>pointerBlock.remove()));
        renderDisposables.add($bDzmQ.addDisposableListener(pointerBlock, $bDzmQ.EventType.MOUSE_DOWN, ()=>pointerBlock.remove()));
        // Action bar
        let actionBarWidth = 0;
        if (actionBarActions.length) {
            const actionBar = this._createActionBar('.action-widget-action-bar', actionBarActions);
            if (actionBar) {
                widget.appendChild(actionBar.getContainer().parentElement);
                renderDisposables.add(actionBar);
                actionBarWidth = actionBar.getContainer().offsetWidth;
            }
        }
        const width = this._list.value?.layout(actionBarWidth);
        widget.style.width = `${width}px`;
        const focusTracker = renderDisposables.add($bDzmQ.trackFocus(element));
        renderDisposables.add(focusTracker.onDidBlur(()=>this.hide(true)));
        return renderDisposables;
    }
    _createActionBar(className, actions) {
        if (!actions.length) return undefined;
        const container = $bDzmQ.$(className);
        const actionBar = new (0, $czr0Q.ActionBar)(container);
        actionBar.push(actions, {
            icon: false,
            label: true
        });
        return actionBar;
    }
    _onWidgetClosed(didCancel) {
        this._list.value?.hide(didCancel);
    }
};
$f1d7b56b2f7a6f69$var$ActionWidgetService = $f1d7b56b2f7a6f69$var$__decorate([
    $f1d7b56b2f7a6f69$var$__param(0, (0, $d6K7e.IContextViewService)),
    $f1d7b56b2f7a6f69$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $f1d7b56b2f7a6f69$var$__param(2, (0, $fdGPu.IInstantiationService))
], $f1d7b56b2f7a6f69$var$ActionWidgetService);
(0, $lf2vF.registerSingleton)($f1d7b56b2f7a6f69$export$c7b3ec6ac743f926, $f1d7b56b2f7a6f69$var$ActionWidgetService, 1 /* InstantiationType.Delayed */ );
const $f1d7b56b2f7a6f69$var$weight = 1100;
(0, $g4v7E.registerAction2)(class extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'hideCodeActionWidget',
            title: (0, $4dEdH.localize2)('hideCodeActionWidget.title', "Hide action widget"),
            precondition: $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys.Visible,
            keybinding: {
                weight: $f1d7b56b2f7a6f69$var$weight,
                primary: 9 /* KeyCode.Escape */ ,
                secondary: [
                    1033 /* KeyCode.Escape */ 
                ]
            }
        });
    }
    run(accessor) {
        accessor.get($f1d7b56b2f7a6f69$export$c7b3ec6ac743f926).hide(true);
    }
});
(0, $g4v7E.registerAction2)(class extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'selectPrevCodeAction',
            title: (0, $4dEdH.localize2)('selectPrevCodeAction.title', "Select previous action"),
            precondition: $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys.Visible,
            keybinding: {
                weight: $f1d7b56b2f7a6f69$var$weight,
                primary: 16 /* KeyCode.UpArrow */ ,
                secondary: [
                    2064 /* KeyCode.UpArrow */ 
                ],
                mac: {
                    primary: 16 /* KeyCode.UpArrow */ ,
                    secondary: [
                        2064 /* KeyCode.UpArrow */ ,
                        302 /* KeyCode.KeyP */ 
                    ]
                }
            }
        });
    }
    run(accessor) {
        const widgetService = accessor.get($f1d7b56b2f7a6f69$export$c7b3ec6ac743f926);
        if (widgetService instanceof $f1d7b56b2f7a6f69$var$ActionWidgetService) widgetService.focusPrevious();
    }
});
(0, $g4v7E.registerAction2)(class extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'selectNextCodeAction',
            title: (0, $4dEdH.localize2)('selectNextCodeAction.title', "Select next action"),
            precondition: $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys.Visible,
            keybinding: {
                weight: $f1d7b56b2f7a6f69$var$weight,
                primary: 18 /* KeyCode.DownArrow */ ,
                secondary: [
                    2066 /* KeyCode.DownArrow */ 
                ],
                mac: {
                    primary: 18 /* KeyCode.DownArrow */ ,
                    secondary: [
                        2066 /* KeyCode.DownArrow */ ,
                        300 /* KeyCode.KeyN */ 
                    ]
                }
            }
        });
    }
    run(accessor) {
        const widgetService = accessor.get($f1d7b56b2f7a6f69$export$c7b3ec6ac743f926);
        if (widgetService instanceof $f1d7b56b2f7a6f69$var$ActionWidgetService) widgetService.focusNext();
    }
});
(0, $g4v7E.registerAction2)(class extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: (0, $e6b10c4d20dcdcf8$export$6f0ea2796e45373c),
            title: (0, $4dEdH.localize2)('acceptSelected.title', "Accept selected action"),
            precondition: $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys.Visible,
            keybinding: {
                weight: $f1d7b56b2f7a6f69$var$weight,
                primary: 3 /* KeyCode.Enter */ ,
                secondary: [
                    2137 /* KeyCode.Period */ 
                ]
            }
        });
    }
    run(accessor) {
        const widgetService = accessor.get($f1d7b56b2f7a6f69$export$c7b3ec6ac743f926);
        if (widgetService instanceof $f1d7b56b2f7a6f69$var$ActionWidgetService) widgetService.acceptSelected();
    }
});
(0, $g4v7E.registerAction2)(class extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: (0, $e6b10c4d20dcdcf8$export$77d3a8ab79a8eaa2),
            title: (0, $4dEdH.localize2)('previewSelected.title', "Preview selected action"),
            precondition: $f1d7b56b2f7a6f69$var$ActionWidgetContextKeys.Visible,
            keybinding: {
                weight: $f1d7b56b2f7a6f69$var$weight,
                primary: 2051 /* KeyCode.Enter */ 
            }
        });
    }
    run(accessor) {
        const widgetService = accessor.get($f1d7b56b2f7a6f69$export$c7b3ec6ac743f926);
        if (widgetService instanceof $f1d7b56b2f7a6f69$var$ActionWidgetService) widgetService.acceptSelected(true);
    }
});



var $8tcMz = parcelRequire("8tcMz");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $enNKM = parcelRequire("enNKM");

var $4E7vx = parcelRequire("4E7vx");

var $gaWeX = parcelRequire("gaWeX");

var $95ky9 = parcelRequire("95ky9");

var $azIPz = parcelRequire("azIPz");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $5Aea5 = parcelRequire("5Aea5");

var $cd4KD = parcelRequire("cd4KD");

var $dcxQ7 = parcelRequire("dcxQ7");

var $jzicX = parcelRequire("jzicX");

var $cxCeF = parcelRequire("cxCeF");

var $4E7vx = parcelRequire("4E7vx");




var $eUQTM = parcelRequire("eUQTM");
const $54c4d7ad452c7b53$export$1209f8b35536d626 = new (0, $cxCeF.RawContextKey)('supportedCodeAction', '');
const $54c4d7ad452c7b53$export$dfeaa8f3e21a0eb2 = '_typescript.applyFixAllCodeAction';
class $54c4d7ad452c7b53$var$CodeActionOracle extends (0, $9cWcn.Disposable) {
    constructor(_editor, _markerService, _signalChange, _delay = 250){
        super();
        this._editor = _editor;
        this._markerService = _markerService;
        this._signalChange = _signalChange;
        this._delay = _delay;
        this._autoTriggerTimer = this._register(new (0, $6bXyA.TimeoutTimer)());
        this._register(this._markerService.onMarkerChanged((e)=>this._onMarkerChanges(e)));
        this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()));
    }
    trigger(trigger) {
        const selection = this._getRangeOfSelectionUnlessWhitespaceEnclosed(trigger);
        this._signalChange(selection ? {
            trigger: trigger,
            selection: selection
        } : undefined);
    }
    _onMarkerChanges(resources) {
        const model = this._editor.getModel();
        if (model && resources.some((resource)=>(0, $5Aea5.isEqual)(resource, model.uri))) this._tryAutoTrigger();
    }
    _tryAutoTrigger() {
        this._autoTriggerTimer.cancelAndSet(()=>{
            this.trigger({
                type: 2 /* CodeActionTriggerType.Auto */ ,
                triggerAction: (0, $fdf474d60745d657$export$f0e69435f2eb5c46).Default
            });
        }, this._delay);
    }
    _getRangeOfSelectionUnlessWhitespaceEnclosed(trigger) {
        if (!this._editor.hasModel()) return undefined;
        const selection = this._editor.getSelection();
        if (trigger.type === 1 /* CodeActionTriggerType.Invoke */ ) return selection;
        const enabled = this._editor.getOption(65 /* EditorOption.lightbulb */ ).enabled;
        if (enabled === (0, $cd4KD.ShowLightbulbIconMode).Off) return undefined;
        else if (enabled === (0, $cd4KD.ShowLightbulbIconMode).On) return selection;
        else if (enabled === (0, $cd4KD.ShowLightbulbIconMode).OnCode) {
            const isSelectionEmpty = selection.isEmpty();
            if (!isSelectionEmpty) return selection;
            const model = this._editor.getModel();
            const { lineNumber: lineNumber, column: column } = selection.getPosition();
            const line = model.getLineContent(lineNumber);
            if (line.length === 0) // empty line
            return undefined;
            else if (column === 1) {
                // look only right
                if (/\s/.test(line[0])) return undefined;
            } else if (column === model.getLineMaxColumn(lineNumber)) {
                // look only left
                if (/\s/.test(line[line.length - 1])) return undefined;
            } else {
                // look left and right
                if (/\s/.test(line[column - 2]) && /\s/.test(line[column - 1])) return undefined;
            }
        }
        return selection;
    }
}
var $54c4d7ad452c7b53$export$6e13bf9b6b21a756;
(function(CodeActionsState) {
    CodeActionsState.Empty = {
        type: 0 /* Type.Empty */ 
    };
    class Triggered {
        constructor(trigger, position, _cancellablePromise){
            this.trigger = trigger;
            this.position = position;
            this._cancellablePromise = _cancellablePromise;
            this.type = 1 /* Type.Triggered */ ;
            this.actions = _cancellablePromise.catch((e)=>{
                if ((0, $gPkHZ.isCancellationError)(e)) return $54c4d7ad452c7b53$var$emptyCodeActionSet;
                throw e;
            });
        }
        cancel() {
            this._cancellablePromise.cancel();
        }
    }
    CodeActionsState.Triggered = Triggered;
})($54c4d7ad452c7b53$export$6e13bf9b6b21a756 || ($54c4d7ad452c7b53$export$6e13bf9b6b21a756 = {}));
const $54c4d7ad452c7b53$var$emptyCodeActionSet = Object.freeze({
    allActions: [],
    validActions: [],
    dispose: ()=>{},
    documentation: [],
    hasAutoFix: false,
    hasAIFix: false,
    allAIFixes: false
});
class $54c4d7ad452c7b53$export$d2ba69ecaab87b2c extends (0, $9cWcn.Disposable) {
    constructor(_editor, _registry, _markerService, contextKeyService, _progressService, _configurationService, _telemetryService){
        super();
        this._editor = _editor;
        this._registry = _registry;
        this._markerService = _markerService;
        this._progressService = _progressService;
        this._configurationService = _configurationService;
        this._telemetryService = _telemetryService;
        this._codeActionOracle = this._register(new (0, $9cWcn.MutableDisposable)());
        this._state = $54c4d7ad452c7b53$export$6e13bf9b6b21a756.Empty;
        this._onDidChangeState = this._register(new (0, $5YaSO.Emitter)());
        this.onDidChangeState = this._onDidChangeState.event;
        this._disposed = false;
        this._supportedCodeActions = $54c4d7ad452c7b53$export$1209f8b35536d626.bindTo(contextKeyService);
        this._register(this._editor.onDidChangeModel(()=>this._update()));
        this._register(this._editor.onDidChangeModelLanguage(()=>this._update()));
        this._register(this._registry.onDidChange(()=>this._update()));
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(65 /* EditorOption.lightbulb */ )) this._update();
        }));
        this._update();
    }
    dispose() {
        if (this._disposed) return;
        this._disposed = true;
        super.dispose();
        this.setState($54c4d7ad452c7b53$export$6e13bf9b6b21a756.Empty, true);
    }
    _settingEnabledNearbyQuickfixes() {
        const model = this._editor?.getModel();
        return this._configurationService ? this._configurationService.getValue('editor.codeActionWidget.includeNearbyQuickFixes', {
            resource: model?.uri
        }) : false;
    }
    _update() {
        if (this._disposed) return;
        this._codeActionOracle.value = undefined;
        this.setState($54c4d7ad452c7b53$export$6e13bf9b6b21a756.Empty);
        const model = this._editor.getModel();
        if (model && this._registry.has(model) && !this._editor.getOption(92 /* EditorOption.readOnly */ )) {
            const supportedActions = this._registry.all(model).flatMap((provider)=>provider.providedCodeActionKinds ?? []);
            this._supportedCodeActions.set(supportedActions.join(' '));
            this._codeActionOracle.value = new $54c4d7ad452c7b53$var$CodeActionOracle(this._editor, this._markerService, (trigger)=>{
                if (!trigger) {
                    this.setState($54c4d7ad452c7b53$export$6e13bf9b6b21a756.Empty);
                    return;
                }
                const startPosition = trigger.selection.getStartPosition();
                const actions = (0, $6bXyA.createCancelablePromise)(async (token)=>{
                    if (this._settingEnabledNearbyQuickfixes() && trigger.trigger.type === 1 /* CodeActionTriggerType.Invoke */  && (trigger.trigger.triggerAction === (0, $fdf474d60745d657$export$f0e69435f2eb5c46).QuickFix || trigger.trigger.filter?.include?.contains((0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix))) {
                        const codeActionSet = await (0, $ccc254bb322a1d5a$export$52ee0249dd058aac)(this._registry, model, trigger.selection, trigger.trigger, (0, $4E7vx.Progress).None, token);
                        const allCodeActions = [
                            ...codeActionSet.allActions
                        ];
                        if (token.isCancellationRequested) return $54c4d7ad452c7b53$var$emptyCodeActionSet;
                        // Search for quickfixes in the curret code action set.
                        const foundQuickfix = codeActionSet.validActions?.some((action)=>action.action.kind ? (0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix.contains(new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(action.action.kind)) : false);
                        const allMarkers = this._markerService.read({
                            resource: model.uri
                        });
                        if (foundQuickfix) {
                            for (const action of codeActionSet.validActions)if (action.action.command?.arguments?.some((arg)=>typeof arg === 'string' && arg.includes($54c4d7ad452c7b53$export$dfeaa8f3e21a0eb2))) action.action.diagnostics = [
                                ...allMarkers.filter((marker)=>marker.relatedInformation)
                            ];
                            return {
                                validActions: codeActionSet.validActions,
                                allActions: allCodeActions,
                                documentation: codeActionSet.documentation,
                                hasAutoFix: codeActionSet.hasAutoFix,
                                hasAIFix: codeActionSet.hasAIFix,
                                allAIFixes: codeActionSet.allAIFixes,
                                dispose: ()=>{
                                    codeActionSet.dispose();
                                }
                            };
                        } else if (!foundQuickfix) // If markers exists, and there are no quickfixes found or length is zero, check for quickfixes on that line.
                        {
                            if (allMarkers.length > 0) {
                                const currPosition = trigger.selection.getPosition();
                                let trackedPosition = currPosition;
                                let distance = Number.MAX_VALUE;
                                const currentActions = [
                                    ...codeActionSet.validActions
                                ];
                                for (const marker of allMarkers){
                                    const col = marker.endColumn;
                                    const row = marker.endLineNumber;
                                    const startRow = marker.startLineNumber;
                                    // Found quickfix on the same line and check relative distance to other markers
                                    if (row === currPosition.lineNumber || startRow === currPosition.lineNumber) {
                                        trackedPosition = new (0, $dcxQ7.Position)(row, col);
                                        const newCodeActionTrigger = {
                                            type: trigger.trigger.type,
                                            triggerAction: trigger.trigger.triggerAction,
                                            filter: {
                                                include: trigger.trigger.filter?.include ? trigger.trigger.filter?.include : (0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix
                                            },
                                            autoApply: trigger.trigger.autoApply,
                                            context: {
                                                notAvailableMessage: trigger.trigger.context?.notAvailableMessage || '',
                                                position: trackedPosition
                                            }
                                        };
                                        const selectionAsPosition = new (0, $jzicX.Selection)(trackedPosition.lineNumber, trackedPosition.column, trackedPosition.lineNumber, trackedPosition.column);
                                        const actionsAtMarker = await (0, $ccc254bb322a1d5a$export$52ee0249dd058aac)(this._registry, model, selectionAsPosition, newCodeActionTrigger, (0, $4E7vx.Progress).None, token);
                                        if (actionsAtMarker.validActions.length !== 0) {
                                            for (const action of actionsAtMarker.validActions)if (action.action.command?.arguments?.some((arg)=>typeof arg === 'string' && arg.includes($54c4d7ad452c7b53$export$dfeaa8f3e21a0eb2))) action.action.diagnostics = [
                                                ...allMarkers.filter((marker)=>marker.relatedInformation)
                                            ];
                                            if (codeActionSet.allActions.length === 0) allCodeActions.push(...actionsAtMarker.allActions);
                                            // Already filtered through to only get quickfixes, so no need to filter again.
                                            if (Math.abs(currPosition.column - col) < distance) currentActions.unshift(...actionsAtMarker.validActions);
                                            else currentActions.push(...actionsAtMarker.validActions);
                                        }
                                        distance = Math.abs(currPosition.column - col);
                                    }
                                }
                                const filteredActions = currentActions.filter((action, index, self)=>self.findIndex((a)=>a.action.title === action.action.title) === index);
                                filteredActions.sort((a, b)=>{
                                    if (a.action.isPreferred && !b.action.isPreferred) return -1;
                                    else if (!a.action.isPreferred && b.action.isPreferred) return 1;
                                    else if (a.action.isAI && !b.action.isAI) return 1;
                                    else if (!a.action.isAI && b.action.isAI) return -1;
                                    else return 0;
                                });
                                // Only retriggers if actually found quickfix on the same line as cursor
                                return {
                                    validActions: filteredActions,
                                    allActions: allCodeActions,
                                    documentation: codeActionSet.documentation,
                                    hasAutoFix: codeActionSet.hasAutoFix,
                                    hasAIFix: codeActionSet.hasAIFix,
                                    allAIFixes: codeActionSet.allAIFixes,
                                    dispose: ()=>{
                                        codeActionSet.dispose();
                                    }
                                };
                            }
                        }
                    }
                    // Case for manual triggers - specifically Source Actions and Refactors
                    if (trigger.trigger.type === 1 /* CodeActionTriggerType.Invoke */ ) {
                        const sw = new (0, $eUQTM.StopWatch)();
                        const codeActions = await (0, $ccc254bb322a1d5a$export$52ee0249dd058aac)(this._registry, model, trigger.selection, trigger.trigger, (0, $4E7vx.Progress).None, token);
                        // Telemetry for duration of each code action on save.
                        if (this._telemetryService) this._telemetryService.publicLog2('codeAction.invokedDurations', {
                            codeActions: codeActions.validActions.length,
                            duration: sw.elapsed()
                        });
                        return codeActions;
                    }
                    return (0, $ccc254bb322a1d5a$export$52ee0249dd058aac)(this._registry, model, trigger.selection, trigger.trigger, (0, $4E7vx.Progress).None, token);
                });
                if (trigger.trigger.type === 1 /* CodeActionTriggerType.Invoke */ ) this._progressService?.showWhile(actions, 250);
                const newState = new $54c4d7ad452c7b53$export$6e13bf9b6b21a756.Triggered(trigger.trigger, startPosition, actions);
                let isManualToAutoTransition = false;
                if (this._state.type === 1 /* CodeActionsState.Type.Triggered */ ) // Check if the current state is manual and the new state is automatic
                isManualToAutoTransition = this._state.trigger.type === 1 /* CodeActionTriggerType.Invoke */  && newState.type === 1 /* CodeActionsState.Type.Triggered */  && newState.trigger.type === 2 /* CodeActionTriggerType.Auto */  && this._state.position !== newState.position;
                // Do not trigger state if current state is manual and incoming state is automatic
                if (!isManualToAutoTransition) this.setState(newState);
                else // Reset the new state after getting code actions back.
                setTimeout(()=>{
                    this.setState(newState);
                }, 500);
            }, undefined);
            this._codeActionOracle.value.trigger({
                type: 2 /* CodeActionTriggerType.Auto */ ,
                triggerAction: (0, $fdf474d60745d657$export$f0e69435f2eb5c46).Default
            });
        } else this._supportedCodeActions.reset();
    }
    trigger(trigger) {
        this._codeActionOracle.value?.trigger(trigger);
    }
    setState(newState, skipNotify) {
        if (newState === this._state) return;
        // Cancel old request
        if (this._state.type === 1 /* CodeActionsState.Type.Triggered */ ) this._state.cancel();
        this._state = newState;
        if (!skipNotify && !this._disposed) this._onDidChangeState.fire(newState);
    }
}




var $lMGba = parcelRequire("lMGba");
var $b873d21752bb0e36$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $b873d21752bb0e36$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $b873d21752bb0e36$var$CodeActionController_1;
const $b873d21752bb0e36$var$DECORATION_CLASS_NAME = 'quickfix-edit-highlight';
let $b873d21752bb0e36$export$d5e19c67c7b6551f = class CodeActionController extends (0, $9cWcn.Disposable) {
    static{
        $b873d21752bb0e36$var$CodeActionController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.codeActionController';
    }
    static get(editor) {
        return editor.getContribution($b873d21752bb0e36$var$CodeActionController_1.ID);
    }
    constructor(editor, markerService, contextKeyService, instantiationService, languageFeaturesService, progressService, _commandService, _configurationService, _actionWidgetService, _instantiationService, _telemetryService){
        super();
        this._commandService = _commandService;
        this._configurationService = _configurationService;
        this._actionWidgetService = _actionWidgetService;
        this._instantiationService = _instantiationService;
        this._telemetryService = _telemetryService;
        this._activeCodeActions = this._register(new (0, $9cWcn.MutableDisposable)());
        this._showDisabled = false;
        this._disposed = false;
        this._editor = editor;
        this._model = this._register(new (0, $54c4d7ad452c7b53$export$d2ba69ecaab87b2c)(this._editor, languageFeaturesService.codeActionProvider, markerService, contextKeyService, progressService, _configurationService, this._telemetryService));
        this._register(this._model.onDidChangeState((newState)=>this.update(newState)));
        this._lightBulbWidget = new (0, $7DcRJ.Lazy)(()=>{
            const widget = this._editor.getContribution((0, $710ecf1a61141b5c$export$87ab1750f69500a0).ID);
            if (widget) this._register(widget.onClick((e)=>this.showCodeActionsFromLightbulb(e.actions, e)));
            return widget;
        });
        this._resolver = instantiationService.createInstance((0, $30f87b82265d30a6$export$5b41f08e102f6dbe));
        this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()));
    }
    dispose() {
        this._disposed = true;
        super.dispose();
    }
    async showCodeActionsFromLightbulb(actions, at) {
        if (actions.allAIFixes && actions.validActions.length === 1) {
            const actionItem = actions.validActions[0];
            const command = actionItem.action.command;
            if (command && command.id === 'inlineChat.start') {
                if (command.arguments && command.arguments.length >= 1) command.arguments[0] = {
                    ...command.arguments[0],
                    autoSend: false
                };
            }
            await this._applyCodeAction(actionItem, false, false, (0, $ccc254bb322a1d5a$export$b792534e34813fb2).FromAILightbulb);
            return;
        }
        await this.showCodeActionList(actions, at, {
            includeDisabledActions: false,
            fromLightbulb: true
        });
    }
    showCodeActions(_trigger, actions, at) {
        return this.showCodeActionList(actions, at, {
            includeDisabledActions: false,
            fromLightbulb: false
        });
    }
    manualTriggerAtCurrentPosition(notAvailableMessage, triggerAction, filter, autoApply) {
        if (!this._editor.hasModel()) return;
        (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this._editor)?.closeMessage();
        const triggerPosition = this._editor.getPosition();
        this._trigger({
            type: 1 /* CodeActionTriggerType.Invoke */ ,
            triggerAction: triggerAction,
            filter: filter,
            autoApply: autoApply,
            context: {
                notAvailableMessage: notAvailableMessage,
                position: triggerPosition
            }
        });
    }
    _trigger(trigger) {
        return this._model.trigger(trigger);
    }
    async _applyCodeAction(action, retrigger, preview, actionReason) {
        try {
            await this._instantiationService.invokeFunction((0, $ccc254bb322a1d5a$export$69c5fd17c7ee0695), action, actionReason, {
                preview: preview,
                editor: this._editor
            });
        } finally{
            if (retrigger) this._trigger({
                type: 2 /* CodeActionTriggerType.Auto */ ,
                triggerAction: (0, $fdf474d60745d657$export$f0e69435f2eb5c46).QuickFix,
                filter: {}
            });
        }
    }
    hideLightBulbWidget() {
        this._lightBulbWidget.rawValue?.hide();
        this._lightBulbWidget.rawValue?.gutterHide();
    }
    async update(newState) {
        if (newState.type !== 1 /* CodeActionsState.Type.Triggered */ ) {
            this.hideLightBulbWidget();
            return;
        }
        let actions;
        try {
            actions = await newState.actions;
        } catch (e) {
            (0, $gPkHZ.onUnexpectedError)(e);
            return;
        }
        if (this._disposed) return;
        const selection = this._editor.getSelection();
        if (selection?.startLineNumber !== newState.position.lineNumber) return;
        this._lightBulbWidget.value?.update(actions, newState.trigger, newState.position);
        if (newState.trigger.type === 1 /* CodeActionTriggerType.Invoke */ ) {
            if (newState.trigger.filter?.include) {
                // Check to see if we want to auto apply.
                const validActionToApply = this.tryGetValidActionToApply(newState.trigger, actions);
                if (validActionToApply) {
                    try {
                        this.hideLightBulbWidget();
                        await this._applyCodeAction(validActionToApply, false, false, (0, $ccc254bb322a1d5a$export$b792534e34813fb2).FromCodeActions);
                    } finally{
                        actions.dispose();
                    }
                    return;
                }
                // Check to see if there is an action that we would have applied were it not invalid
                if (newState.trigger.context) {
                    const invalidAction = this.getInvalidActionThatWouldHaveBeenApplied(newState.trigger, actions);
                    if (invalidAction && invalidAction.action.disabled) {
                        (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this._editor)?.showMessage(invalidAction.action.disabled, newState.trigger.context.position);
                        actions.dispose();
                        return;
                    }
                }
            }
            const includeDisabledActions = !!newState.trigger.filter?.include;
            if (newState.trigger.context) {
                if (!actions.allActions.length || !includeDisabledActions && !actions.validActions.length) {
                    (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this._editor)?.showMessage(newState.trigger.context.notAvailableMessage, newState.trigger.context.position);
                    this._activeCodeActions.value = actions;
                    actions.dispose();
                    return;
                }
            }
            this._activeCodeActions.value = actions;
            this.showCodeActionList(actions, this.toCoords(newState.position), {
                includeDisabledActions: includeDisabledActions,
                fromLightbulb: false
            });
        } else // auto magically triggered
        if (this._actionWidgetService.isVisible) // TODO: Figure out if we should update the showing menu?
        actions.dispose();
        else this._activeCodeActions.value = actions;
    }
    getInvalidActionThatWouldHaveBeenApplied(trigger, actions) {
        if (!actions.allActions.length) return undefined;
        if (trigger.autoApply === "first" /* CodeActionAutoApply.First */  && actions.validActions.length === 0 || trigger.autoApply === "ifSingle" /* CodeActionAutoApply.IfSingle */  && actions.allActions.length === 1) return actions.allActions.find(({ action: action })=>action.disabled);
        return undefined;
    }
    tryGetValidActionToApply(trigger, actions) {
        if (!actions.validActions.length) return undefined;
        if (trigger.autoApply === "first" /* CodeActionAutoApply.First */  && actions.validActions.length > 0 || trigger.autoApply === "ifSingle" /* CodeActionAutoApply.IfSingle */  && actions.validActions.length === 1) return actions.validActions[0];
        return undefined;
    }
    static{
        this.DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'quickfix-highlight',
            className: $b873d21752bb0e36$var$DECORATION_CLASS_NAME
        });
    }
    async showCodeActionList(actions, at, options) {
        const currentDecorations = this._editor.createDecorationsCollection();
        const editorDom = this._editor.getDomNode();
        if (!editorDom) return;
        const actionsToShow = options.includeDisabledActions && (this._showDisabled || actions.validActions.length === 0) ? actions.allActions : actions.validActions;
        if (!actionsToShow.length) return;
        const anchor = (0, $dcxQ7.Position).isIPosition(at) ? this.toCoords(at) : at;
        const delegate = {
            onSelect: async (action, preview)=>{
                this._applyCodeAction(action, /* retrigger */ true, !!preview, options.fromLightbulb ? (0, $ccc254bb322a1d5a$export$b792534e34813fb2).FromAILightbulb : (0, $ccc254bb322a1d5a$export$b792534e34813fb2).FromCodeActions);
                this._actionWidgetService.hide(false);
                currentDecorations.clear();
            },
            onHide: (didCancel)=>{
                this._editor?.focus();
                currentDecorations.clear();
            },
            onHover: async (action, token)=>{
                if (token.isCancellationRequested) return;
                let canPreview = false;
                const actionKind = action.action.kind;
                if (actionKind) {
                    const hierarchicalKind = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(actionKind);
                    const refactorKinds = [
                        (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorExtract,
                        (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorInline,
                        (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorRewrite,
                        (0, $fdf474d60745d657$export$c72b5966cfff6b4d).RefactorMove,
                        (0, $fdf474d60745d657$export$c72b5966cfff6b4d).Source
                    ];
                    canPreview = refactorKinds.some((refactorKind)=>refactorKind.contains(hierarchicalKind));
                }
                return {
                    canPreview: canPreview || !!action.action.edit?.edits.length
                };
            },
            onFocus: (action)=>{
                if (action && action.action) {
                    const ranges = action.action.ranges;
                    const diagnostics = action.action.diagnostics;
                    currentDecorations.clear();
                    if (ranges && ranges.length > 0) {
                        // Handles case for `fix all` where there are multiple diagnostics.
                        const decorations = diagnostics && diagnostics?.length > 1 ? diagnostics.map((diagnostic)=>({
                                range: diagnostic,
                                options: $b873d21752bb0e36$var$CodeActionController_1.DECORATION
                            })) : ranges.map((range)=>({
                                range: range,
                                options: $b873d21752bb0e36$var$CodeActionController_1.DECORATION
                            }));
                        currentDecorations.set(decorations);
                    } else if (diagnostics && diagnostics.length > 0) {
                        const decorations = diagnostics.map((diagnostic)=>({
                                range: diagnostic,
                                options: $b873d21752bb0e36$var$CodeActionController_1.DECORATION
                            }));
                        currentDecorations.set(decorations);
                        const diagnostic = diagnostics[0];
                        if (diagnostic.startLineNumber && diagnostic.startColumn) {
                            const selectionText = this._editor.getModel()?.getWordAtPosition({
                                lineNumber: diagnostic.startLineNumber,
                                column: diagnostic.startColumn
                            })?.word;
                            $aIbUW.status((0, $4dEdH.localize)('editingNewSelection', "Context: {0} at line {1} and column {2}.", selectionText, diagnostic.startLineNumber, diagnostic.startColumn));
                        }
                    }
                } else currentDecorations.clear();
            }
        };
        this._actionWidgetService.show('codeActionWidget', true, (0, $ae9ec488e0f21329$export$ccfd4d10d26a30da)(actionsToShow, this._shouldShowHeaders(), this._resolver.getResolver()), delegate, anchor, editorDom, this._getActionBarActions(actions, at, options));
    }
    toCoords(position) {
        if (!this._editor.hasModel()) return {
            x: 0,
            y: 0
        };
        this._editor.revealPosition(position, 1 /* ScrollType.Immediate */ );
        this._editor.render();
        // Translate to absolute editor position
        const cursorCoords = this._editor.getScrolledVisiblePosition(position);
        const editorCoords = (0, $bDzmQ.getDomNodePagePosition)(this._editor.getDomNode());
        const x = editorCoords.left + cursorCoords.left;
        const y = editorCoords.top + cursorCoords.top + cursorCoords.height;
        return {
            x: x,
            y: y
        };
    }
    _shouldShowHeaders() {
        const model = this._editor?.getModel();
        return this._configurationService.getValue('editor.codeActionWidget.showHeaders', {
            resource: model?.uri
        });
    }
    _getActionBarActions(actions, at, options) {
        if (options.fromLightbulb) return [];
        const resultActions = actions.documentation.map((command)=>({
                id: command.id,
                label: command.title,
                tooltip: command.tooltip ?? '',
                class: undefined,
                enabled: true,
                run: ()=>this._commandService.executeCommand(command.id, ...command.arguments ?? [])
            }));
        if (options.includeDisabledActions && actions.validActions.length > 0 && actions.allActions.length !== actions.validActions.length) resultActions.push(this._showDisabled ? {
            id: 'hideMoreActions',
            label: (0, $4dEdH.localize)('hideMoreActions', 'Hide Disabled'),
            enabled: true,
            tooltip: '',
            class: undefined,
            run: ()=>{
                this._showDisabled = false;
                return this.showCodeActionList(actions, at, options);
            }
        } : {
            id: 'showMoreActions',
            label: (0, $4dEdH.localize)('showMoreActions', 'Show Disabled'),
            enabled: true,
            tooltip: '',
            class: undefined,
            run: ()=>{
                this._showDisabled = true;
                return this.showCodeActionList(actions, at, options);
            }
        });
        return resultActions;
    }
};
$b873d21752bb0e36$export$d5e19c67c7b6551f = $b873d21752bb0e36$var$CodeActionController_1 = $b873d21752bb0e36$var$__decorate([
    $b873d21752bb0e36$var$__param(1, (0, $enNKM.IMarkerService)),
    $b873d21752bb0e36$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $b873d21752bb0e36$var$__param(3, (0, $fdGPu.IInstantiationService)),
    $b873d21752bb0e36$var$__param(4, (0, $4J6fu.ILanguageFeaturesService)),
    $b873d21752bb0e36$var$__param(5, (0, $4E7vx.IEditorProgressService)),
    $b873d21752bb0e36$var$__param(6, (0, $8tcMz.ICommandService)),
    $b873d21752bb0e36$var$__param(7, (0, $35IZ9.IConfigurationService)),
    $b873d21752bb0e36$var$__param(8, (0, $f1d7b56b2f7a6f69$export$c7b3ec6ac743f926)),
    $b873d21752bb0e36$var$__param(9, (0, $fdGPu.IInstantiationService)),
    $b873d21752bb0e36$var$__param(10, (0, $lMGba.ITelemetryService))
], $b873d21752bb0e36$export$d5e19c67c7b6551f);
(0, $azIPz.registerThemingParticipant)((theme, collector)=>{
    const addBackgroundColorRule = (selector, color)=>{
        if (color) collector.addRule(`.monaco-editor ${selector} { background-color: ${color}; }`);
    };
    addBackgroundColorRule('.quickfix-edit-highlight', theme.getColor((0, $gaWeX.editorFindMatchHighlight)));
    const findMatchHighlightBorder = theme.getColor((0, $gaWeX.editorFindMatchHighlightBorder));
    if (findMatchHighlightBorder) collector.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${(0, $95ky9.isHighContrast)(theme.type) ? 'dotted' : 'solid'} ${findMatchHighlightBorder}; box-sizing: border-box; }`);
});



function $97c037be058ff5be$var$contextKeyForSupportedActions(kind) {
    return (0, $cxCeF.ContextKeyExpr).regex((0, $54c4d7ad452c7b53$export$1209f8b35536d626).keys()[0], new RegExp('(\\s|^)' + (0, $jcr1R.escapeRegExpCharacters)(kind.value) + '\\b'));
}
const $97c037be058ff5be$var$argsSchema = {
    type: 'object',
    defaultSnippets: [
        {
            body: {
                kind: ''
            }
        }
    ],
    properties: {
        'kind': {
            type: 'string',
            description: $4dEdH.localize('args.schema.kind', "Kind of the code action to run.")
        },
        'apply': {
            type: 'string',
            description: $4dEdH.localize('args.schema.apply', "Controls when the returned actions are applied."),
            default: "ifSingle" /* CodeActionAutoApply.IfSingle */ ,
            enum: [
                "first" /* CodeActionAutoApply.First */ ,
                "ifSingle" /* CodeActionAutoApply.IfSingle */ ,
                "never" /* CodeActionAutoApply.Never */ 
            ],
            enumDescriptions: [
                $4dEdH.localize('args.schema.apply.first', "Always apply the first returned code action."),
                $4dEdH.localize('args.schema.apply.ifSingle', "Apply the first returned code action if it is the only one."),
                $4dEdH.localize('args.schema.apply.never', "Do not apply the returned code actions.")
            ]
        },
        'preferred': {
            type: 'boolean',
            default: false,
            description: $4dEdH.localize('args.schema.preferred', "Controls if only preferred code actions should be returned.")
        }
    }
};
function $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, notAvailableMessage, filter, autoApply, triggerAction = (0, $fdf474d60745d657$export$f0e69435f2eb5c46).Default) {
    if (editor.hasModel()) {
        const controller = (0, $b873d21752bb0e36$export$d5e19c67c7b6551f).get(editor);
        controller?.manualTriggerAtCurrentPosition(notAvailableMessage, triggerAction, filter, autoApply);
    }
}
class $97c037be058ff5be$export$882e0ee127a25fbb extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $ccc254bb322a1d5a$export$3db60be65e567c5d),
            label: $4dEdH.localize('quickfix.trigger.label', "Quick Fix..."),
            alias: 'Quick Fix...',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasCodeActionsProvider),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 2137 /* KeyCode.Period */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        return $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, $4dEdH.localize('editor.action.quickFix.noneMessage', "No code actions available"), undefined, undefined, (0, $fdf474d60745d657$export$f0e69435f2eb5c46).QuickFix);
    }
}
class $97c037be058ff5be$export$94d24ce7f8ca1f8c extends (0, $2iJTi.EditorCommand) {
    constructor(){
        super({
            id: (0, $ccc254bb322a1d5a$export$47d177835ea6d398),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasCodeActionsProvider),
            metadata: {
                description: 'Trigger a code action',
                args: [
                    {
                        name: 'args',
                        schema: $97c037be058ff5be$var$argsSchema
                    }
                ]
            }
        });
    }
    runEditorCommand(_accessor, editor, userArgs) {
        const args = (0, $fdf474d60745d657$export$b4557d8a7419d430).fromUser(userArgs, {
            kind: (0, $b9104f11117b1d0a$export$f06724c61e87d9db).Empty,
            apply: "ifSingle" /* CodeActionAutoApply.IfSingle */ 
        });
        return $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, typeof userArgs?.kind === 'string' ? args.preferred ? $4dEdH.localize('editor.action.codeAction.noneMessage.preferred.kind', "No preferred code actions for '{0}' available", userArgs.kind) : $4dEdH.localize('editor.action.codeAction.noneMessage.kind', "No code actions for '{0}' available", userArgs.kind) : args.preferred ? $4dEdH.localize('editor.action.codeAction.noneMessage.preferred', "No preferred code actions available") : $4dEdH.localize('editor.action.codeAction.noneMessage', "No code actions available"), {
            include: args.kind,
            includeSourceActions: true,
            onlyIncludePreferredActions: args.preferred
        }, args.apply);
    }
}
class $97c037be058ff5be$export$717c8b29cf6c7de0 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $ccc254bb322a1d5a$export$691d097e330e1493),
            label: $4dEdH.localize('refactor.label', "Refactor..."),
            alias: 'Refactor...',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasCodeActionsProvider),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 3120 /* KeyCode.KeyR */ ,
                mac: {
                    primary: 1328 /* KeyCode.KeyR */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            contextMenuOpts: {
                group: '1_modification',
                order: 2,
                when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, $97c037be058ff5be$var$contextKeyForSupportedActions((0, $fdf474d60745d657$export$c72b5966cfff6b4d).Refactor))
            },
            metadata: {
                description: 'Refactor...',
                args: [
                    {
                        name: 'args',
                        schema: $97c037be058ff5be$var$argsSchema
                    }
                ]
            }
        });
    }
    run(_accessor, editor, userArgs) {
        const args = (0, $fdf474d60745d657$export$b4557d8a7419d430).fromUser(userArgs, {
            kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).Refactor,
            apply: "never" /* CodeActionAutoApply.Never */ 
        });
        return $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, typeof userArgs?.kind === 'string' ? args.preferred ? $4dEdH.localize('editor.action.refactor.noneMessage.preferred.kind', "No preferred refactorings for '{0}' available", userArgs.kind) : $4dEdH.localize('editor.action.refactor.noneMessage.kind', "No refactorings for '{0}' available", userArgs.kind) : args.preferred ? $4dEdH.localize('editor.action.refactor.noneMessage.preferred', "No preferred refactorings available") : $4dEdH.localize('editor.action.refactor.noneMessage', "No refactorings available"), {
            include: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).Refactor.contains(args.kind) ? args.kind : (0, $b9104f11117b1d0a$export$f06724c61e87d9db).None,
            onlyIncludePreferredActions: args.preferred
        }, args.apply, (0, $fdf474d60745d657$export$f0e69435f2eb5c46).Refactor);
    }
}
class $97c037be058ff5be$export$6754a4b1b720e9fb extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $ccc254bb322a1d5a$export$239def49abcdebc4),
            label: $4dEdH.localize('source.label', "Source Action..."),
            alias: 'Source Action...',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasCodeActionsProvider),
            contextMenuOpts: {
                group: '1_modification',
                order: 2.1,
                when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, $97c037be058ff5be$var$contextKeyForSupportedActions((0, $fdf474d60745d657$export$c72b5966cfff6b4d).Source))
            },
            metadata: {
                description: 'Source Action...',
                args: [
                    {
                        name: 'args',
                        schema: $97c037be058ff5be$var$argsSchema
                    }
                ]
            }
        });
    }
    run(_accessor, editor, userArgs) {
        const args = (0, $fdf474d60745d657$export$b4557d8a7419d430).fromUser(userArgs, {
            kind: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).Source,
            apply: "never" /* CodeActionAutoApply.Never */ 
        });
        return $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, typeof userArgs?.kind === 'string' ? args.preferred ? $4dEdH.localize('editor.action.source.noneMessage.preferred.kind', "No preferred source actions for '{0}' available", userArgs.kind) : $4dEdH.localize('editor.action.source.noneMessage.kind', "No source actions for '{0}' available", userArgs.kind) : args.preferred ? $4dEdH.localize('editor.action.source.noneMessage.preferred', "No preferred source actions available") : $4dEdH.localize('editor.action.source.noneMessage', "No source actions available"), {
            include: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).Source.contains(args.kind) ? args.kind : (0, $b9104f11117b1d0a$export$f06724c61e87d9db).None,
            includeSourceActions: true,
            onlyIncludePreferredActions: args.preferred
        }, args.apply, (0, $fdf474d60745d657$export$f0e69435f2eb5c46).SourceAction);
    }
}
class $97c037be058ff5be$export$839e26b4813ba04c extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $ccc254bb322a1d5a$export$9f47236fc64ddcf5),
            label: $4dEdH.localize('organizeImports.label', "Organize Imports"),
            alias: 'Organize Imports',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, $97c037be058ff5be$var$contextKeyForSupportedActions((0, $fdf474d60745d657$export$c72b5966cfff6b4d).SourceOrganizeImports)),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 1581 /* KeyCode.KeyO */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        return $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, $4dEdH.localize('editor.action.organize.noneMessage', "No organize imports action available"), {
            include: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).SourceOrganizeImports,
            includeSourceActions: true
        }, "ifSingle" /* CodeActionAutoApply.IfSingle */ , (0, $fdf474d60745d657$export$f0e69435f2eb5c46).OrganizeImports);
    }
}
class $97c037be058ff5be$export$900fefaddb0995e3 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $ccc254bb322a1d5a$export$9866f0c931c06a92),
            label: $4dEdH.localize('fixAll.label', "Fix All"),
            alias: 'Fix All',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, $97c037be058ff5be$var$contextKeyForSupportedActions((0, $fdf474d60745d657$export$c72b5966cfff6b4d).SourceFixAll))
        });
    }
    run(_accessor, editor) {
        return $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, $4dEdH.localize('fixAll.noneMessage', "No fix all action available"), {
            include: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).SourceFixAll,
            includeSourceActions: true
        }, "ifSingle" /* CodeActionAutoApply.IfSingle */ , (0, $fdf474d60745d657$export$f0e69435f2eb5c46).FixAll);
    }
}
class $97c037be058ff5be$export$2bffd38cf19da049 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $ccc254bb322a1d5a$export$8e5bae78476830b3),
            label: $4dEdH.localize('autoFix.label', "Auto Fix..."),
            alias: 'Auto Fix...',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, $97c037be058ff5be$var$contextKeyForSupportedActions((0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix)),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 1625 /* KeyCode.Period */ ,
                mac: {
                    primary: 2649 /* KeyCode.Period */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        return $97c037be058ff5be$var$triggerCodeActionsForEditorSelection(editor, $4dEdH.localize('editor.action.autoFix.noneMessage', "No auto fixes available"), {
            include: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix,
            onlyIncludePreferredActions: true
        }, "ifSingle" /* CodeActionAutoApply.IfSingle */ , (0, $fdf474d60745d657$export$f0e69435f2eb5c46).AutoFix);
    }
}





var $4dEdH = parcelRequire("4dEdH");

var $eWLlf = parcelRequire("eWLlf");

var $TezJS = parcelRequire("TezJS");
(0, $2iJTi.registerEditorContribution)((0, $b873d21752bb0e36$export$d5e19c67c7b6551f).ID, (0, $b873d21752bb0e36$export$d5e19c67c7b6551f), 3 /* EditorContributionInstantiation.Eventually */ );
(0, $2iJTi.registerEditorContribution)((0, $710ecf1a61141b5c$export$87ab1750f69500a0).ID, (0, $710ecf1a61141b5c$export$87ab1750f69500a0), 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorAction)((0, $97c037be058ff5be$export$882e0ee127a25fbb));
(0, $2iJTi.registerEditorAction)((0, $97c037be058ff5be$export$717c8b29cf6c7de0));
(0, $2iJTi.registerEditorAction)((0, $97c037be058ff5be$export$6754a4b1b720e9fb));
(0, $2iJTi.registerEditorAction)((0, $97c037be058ff5be$export$839e26b4813ba04c));
(0, $2iJTi.registerEditorAction)((0, $97c037be058ff5be$export$2bffd38cf19da049));
(0, $2iJTi.registerEditorAction)((0, $97c037be058ff5be$export$900fefaddb0995e3));
(0, $2iJTi.registerEditorCommand)(new (0, $97c037be058ff5be$export$94d24ce7f8ca1f8c)());
(0, $TezJS.Registry).as((0, $eWLlf.Extensions).Configuration).registerConfiguration({
    ...(0, $drPnH.editorConfigurationBaseNode),
    properties: {
        'editor.codeActionWidget.showHeaders': {
            type: 'boolean',
            scope: 5 /* ConfigurationScope.LANGUAGE_OVERRIDABLE */ ,
            description: $4dEdH.localize('showCodeActionHeaders', "Enable/disable showing group headers in the Code Action menu."),
            default: true
        }
    }
});
(0, $TezJS.Registry).as((0, $eWLlf.Extensions).Configuration).registerConfiguration({
    ...(0, $drPnH.editorConfigurationBaseNode),
    properties: {
        'editor.codeActionWidget.includeNearbyQuickFixes': {
            type: 'boolean',
            scope: 5 /* ConfigurationScope.LANGUAGE_OVERRIDABLE */ ,
            description: $4dEdH.localize('includeNearbyQuickFixes', "Enable/disable showing nearest Quick Fix within a line when not currently on a diagnostic."),
            default: true
        }
    }
});
(0, $TezJS.Registry).as((0, $eWLlf.Extensions).Configuration).registerConfiguration({
    ...(0, $drPnH.editorConfigurationBaseNode),
    properties: {
        'editor.codeActions.triggerOnFocusChange': {
            type: 'boolean',
            scope: 5 /* ConfigurationScope.LANGUAGE_OVERRIDABLE */ ,
            markdownDescription: $4dEdH.localize('triggerOnFocusChange', 'Enable triggering {0} when {1} is set to {2}. Code Actions must be set to {3} to be triggered for window and focus changes.', '`#editor.codeActionsOnSave#`', '`#files.autoSave#`', '`afterDelay`', '`always`'),
            default: false
        }
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $1RlHY = parcelRequire("1RlHY");

var $2iJTi = parcelRequire("2iJTi");

var $cd4KD = parcelRequire("cd4KD");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $cKKJT = parcelRequire("cKKJT");

var $8tcMz = parcelRequire("8tcMz");

var $4J6fu = parcelRequire("4J6fu");
class $228736e5f3929868$export$c6268d20d31c03ba {
    constructor(){
        this.lenses = [];
        this._disposables = new (0, $9cWcn.DisposableStore)();
    }
    dispose() {
        this._disposables.dispose();
    }
    get isDisposed() {
        return this._disposables.isDisposed;
    }
    add(list, provider) {
        this._disposables.add(list);
        for (const symbol of list.lenses)this.lenses.push({
            symbol: symbol,
            provider: provider
        });
    }
}
async function $228736e5f3929868$export$bebcff98c7e74873(registry, model, token) {
    const provider = registry.ordered(model);
    const providerRanks = new Map();
    const result = new $228736e5f3929868$export$c6268d20d31c03ba();
    const promises = provider.map(async (provider, i)=>{
        providerRanks.set(provider, i);
        try {
            const list = await Promise.resolve(provider.provideCodeLenses(model, token));
            if (list) result.add(list, provider);
        } catch (err) {
            (0, $gPkHZ.onUnexpectedExternalError)(err);
        }
    });
    await Promise.all(promises);
    result.lenses = result.lenses.sort((a, b)=>{
        // sort by lineNumber, provider-rank, and column
        if (a.symbol.range.startLineNumber < b.symbol.range.startLineNumber) return -1;
        else if (a.symbol.range.startLineNumber > b.symbol.range.startLineNumber) return 1;
        else if (providerRanks.get(a.provider) < providerRanks.get(b.provider)) return -1;
        else if (providerRanks.get(a.provider) > providerRanks.get(b.provider)) return 1;
        else if (a.symbol.range.startColumn < b.symbol.range.startColumn) return -1;
        else if (a.symbol.range.startColumn > b.symbol.range.startColumn) return 1;
        else return 0;
    });
    return result;
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeCodeLensProvider', function(accessor, ...args) {
    let [uri, itemResolveCount] = args;
    (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(uri));
    (0, $bxBg7.assertType)(typeof itemResolveCount === 'number' || !itemResolveCount);
    const { codeLensProvider: codeLensProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(uri);
    if (!model) throw (0, $gPkHZ.illegalArgument)();
    const result = [];
    const disposables = new (0, $9cWcn.DisposableStore)();
    return $228736e5f3929868$export$bebcff98c7e74873(codeLensProvider, model, (0, $giPcZ.CancellationToken).None).then((value)=>{
        disposables.add(value);
        const resolve = [];
        for (const item of value.lenses){
            if (itemResolveCount === undefined || itemResolveCount === null || Boolean(item.symbol.command)) result.push(item.symbol);
            else if (itemResolveCount-- > 0 && item.provider.resolveCodeLens) resolve.push(Promise.resolve(item.provider.resolveCodeLens(model, item.symbol, (0, $giPcZ.CancellationToken).None)).then((symbol)=>result.push(symbol || item.symbol)));
        }
        return Promise.all(resolve);
    }).then(()=>{
        return result;
    }).finally(()=>{
        // make sure to return results, then (on next tick)
        // dispose the results
        setTimeout(()=>disposables.dispose(), 100);
    });
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5YaSO = parcelRequire("5YaSO");

var $askDf = parcelRequire("askDf");

var $d00il = parcelRequire("d00il");


var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

var $2AUoS = parcelRequire("2AUoS");

var $8eY6m = parcelRequire("8eY6m");

var $bDzmQ = parcelRequire("bDzmQ");
var $7f2127e728f4c039$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $7f2127e728f4c039$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $7f2127e728f4c039$export$49a51fe6a3a59e77 = (0, $fdGPu.createDecorator)('ICodeLensCache');
class $7f2127e728f4c039$var$CacheItem {
    constructor(lineCount, data){
        this.lineCount = lineCount;
        this.data = data;
    }
}
let $7f2127e728f4c039$export$ff670dd45c13b8eb = class CodeLensCache {
    constructor(storageService){
        this._fakeProvider = new class {
            provideCodeLenses() {
                throw new Error('not supported');
            }
        };
        this._cache = new (0, $askDf.LRUCache)(20, 0.75);
        // remove old data
        const oldkey = 'codelens/cache';
        (0, $bDzmQ.runWhenWindowIdle)((0, $8eY6m.mainWindow), ()=>storageService.remove(oldkey, 1 /* StorageScope.WORKSPACE */ ));
        // restore lens data on start
        const key = 'codelens/cache2';
        const raw = storageService.get(key, 1 /* StorageScope.WORKSPACE */ , '{}');
        this._deserialize(raw);
        // store lens data on shutdown
        const onWillSaveStateBecauseOfShutdown = (0, $5YaSO.Event).filter(storageService.onWillSaveState, (e)=>e.reason === (0, $2AUoS.WillSaveStateReason).SHUTDOWN);
        (0, $5YaSO.Event).once(onWillSaveStateBecauseOfShutdown)((e)=>{
            storageService.store(key, this._serialize(), 1 /* StorageScope.WORKSPACE */ , 1 /* StorageTarget.MACHINE */ );
        });
    }
    put(model, data) {
        // create a copy of the model that is without command-ids
        // but with comand-labels
        const copyItems = data.lenses.map((item)=>{
            return {
                range: item.symbol.range,
                command: item.symbol.command && {
                    id: '',
                    title: item.symbol.command?.title
                }
            };
        });
        const copyModel = new (0, $228736e5f3929868$export$c6268d20d31c03ba)();
        copyModel.add({
            lenses: copyItems,
            dispose: ()=>{}
        }, this._fakeProvider);
        const item = new $7f2127e728f4c039$var$CacheItem(model.getLineCount(), copyModel);
        this._cache.set(model.uri.toString(), item);
    }
    get(model) {
        const item = this._cache.get(model.uri.toString());
        return item && item.lineCount === model.getLineCount() ? item.data : undefined;
    }
    delete(model) {
        this._cache.delete(model.uri.toString());
    }
    // --- persistence
    _serialize() {
        const data = Object.create(null);
        for (const [key, value] of this._cache){
            const lines = new Set();
            for (const d of value.data.lenses)lines.add(d.symbol.range.startLineNumber);
            data[key] = {
                lineCount: value.lineCount,
                lines: [
                    ...lines.values()
                ]
            };
        }
        return JSON.stringify(data);
    }
    _deserialize(raw) {
        try {
            const data = JSON.parse(raw);
            for(const key in data){
                const element = data[key];
                const lenses = [];
                for (const line of element.lines)lenses.push({
                    range: new (0, $d00il.Range)(line, 1, line, 11)
                });
                const model = new (0, $228736e5f3929868$export$c6268d20d31c03ba)();
                model.add({
                    lenses: lenses,
                    dispose () {}
                }, this._fakeProvider);
                this._cache.set(key, new $7f2127e728f4c039$var$CacheItem(element.lineCount, model));
            }
        } catch  {
        // ignore...
        }
    }
};
$7f2127e728f4c039$export$ff670dd45c13b8eb = $7f2127e728f4c039$var$__decorate([
    $7f2127e728f4c039$var$__param(0, (0, $2AUoS.IStorageService))
], $7f2127e728f4c039$export$ff670dd45c13b8eb);
(0, $lf2vF.registerSingleton)($7f2127e728f4c039$export$49a51fe6a3a59e77, $7f2127e728f4c039$export$ff670dd45c13b8eb, 1 /* InstantiationType.Delayed */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $6G2yS = parcelRequire("6G2yS");


var $d00il = parcelRequire("d00il");

var $91ntV = parcelRequire("91ntV");
class $08a0d36d17637495$var$CodeLensViewZone {
    constructor(afterLineNumber, heightInPx, onHeight){
        /**
         * We want that this view zone, which reserves space for a code lens appears
         * as close as possible to the next line, so we use a very large value here.
         */ this.afterColumn = 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ ;
        this.afterLineNumber = afterLineNumber;
        this.heightInPx = heightInPx;
        this._onHeight = onHeight;
        this.suppressMouseDown = true;
        this.domNode = document.createElement('div');
    }
    onComputedHeight(height) {
        if (this._lastHeight === undefined) this._lastHeight = height;
        else if (this._lastHeight !== height) {
            this._lastHeight = height;
            this._onHeight();
        }
    }
    isVisible() {
        return this._lastHeight !== 0 && this.domNode.hasAttribute('monaco-visible-view-zone');
    }
}
class $08a0d36d17637495$var$CodeLensContentWidget {
    static{
        this._idPool = 0;
    }
    constructor(editor, line){
        // Editor.IContentWidget.allowEditorOverflow
        this.allowEditorOverflow = false;
        this.suppressMouseDown = true;
        this._commands = new Map();
        this._isEmpty = true;
        this._editor = editor;
        this._id = `codelens.widget-${$08a0d36d17637495$var$CodeLensContentWidget._idPool++}`;
        this.updatePosition(line);
        this._domNode = document.createElement('span');
        this._domNode.className = `codelens-decoration`;
    }
    withCommands(lenses, animate) {
        this._commands.clear();
        const children = [];
        let hasSymbol = false;
        for(let i = 0; i < lenses.length; i++){
            const lens = lenses[i];
            if (!lens) continue;
            hasSymbol = true;
            if (lens.command) {
                const title = (0, $6G2yS.renderLabelWithIcons)(lens.command.title.trim());
                if (lens.command.id) {
                    const id = `c${$08a0d36d17637495$var$CodeLensContentWidget._idPool++}`;
                    children.push($bDzmQ.$('a', {
                        id: id,
                        title: lens.command.tooltip,
                        role: 'button'
                    }, ...title));
                    this._commands.set(id, lens.command);
                } else children.push($bDzmQ.$('span', {
                    title: lens.command.tooltip
                }, ...title));
                if (i + 1 < lenses.length) children.push($bDzmQ.$('span', undefined, '\u00a0|\u00a0'));
            }
        }
        if (!hasSymbol) // symbols but no commands
        $bDzmQ.reset(this._domNode, $bDzmQ.$('span', undefined, 'no commands'));
        else {
            // symbols and commands
            $bDzmQ.reset(this._domNode, ...children);
            if (this._isEmpty && animate) this._domNode.classList.add('fadein');
            this._isEmpty = false;
        }
    }
    getCommand(link) {
        return link.parentElement === this._domNode ? this._commands.get(link.id) : undefined;
    }
    getId() {
        return this._id;
    }
    getDomNode() {
        return this._domNode;
    }
    updatePosition(line) {
        const column = this._editor.getModel().getLineFirstNonWhitespaceColumn(line);
        this._widgetPosition = {
            position: {
                lineNumber: line,
                column: column
            },
            preference: [
                1 /* ContentWidgetPositionPreference.ABOVE */ 
            ]
        };
    }
    getPosition() {
        return this._widgetPosition || null;
    }
}
class $08a0d36d17637495$export$76bdebf29cc4b59e {
    constructor(){
        this._removeDecorations = [];
        this._addDecorations = [];
        this._addDecorationsCallbacks = [];
    }
    addDecoration(decoration, callback) {
        this._addDecorations.push(decoration);
        this._addDecorationsCallbacks.push(callback);
    }
    removeDecoration(decorationId) {
        this._removeDecorations.push(decorationId);
    }
    commit(changeAccessor) {
        const resultingDecorations = changeAccessor.deltaDecorations(this._removeDecorations, this._addDecorations);
        for(let i = 0, len = resultingDecorations.length; i < len; i++)this._addDecorationsCallbacks[i](resultingDecorations[i]);
    }
}
const $08a0d36d17637495$var$codeLensDecorationOptions = (0, $91ntV.ModelDecorationOptions).register({
    collapseOnReplaceEdit: true,
    description: 'codelens'
});
class $08a0d36d17637495$export$c4760329dfff1b1c {
    constructor(data, editor, helper, viewZoneChangeAccessor, heightInPx, updateCallback){
        this._isDisposed = false;
        this._editor = editor;
        this._data = data;
        // create combined range, track all ranges with decorations,
        // check if there is already something to render
        this._decorationIds = [];
        let range;
        const lenses = [];
        this._data.forEach((codeLensData, i)=>{
            if (codeLensData.symbol.command) lenses.push(codeLensData.symbol);
            helper.addDecoration({
                range: codeLensData.symbol.range,
                options: $08a0d36d17637495$var$codeLensDecorationOptions
            }, (id)=>this._decorationIds[i] = id);
            // the range contains all lenses on this line
            if (!range) range = (0, $d00il.Range).lift(codeLensData.symbol.range);
            else range = (0, $d00il.Range).plusRange(range, codeLensData.symbol.range);
        });
        this._viewZone = new $08a0d36d17637495$var$CodeLensViewZone(range.startLineNumber - 1, heightInPx, updateCallback);
        this._viewZoneId = viewZoneChangeAccessor.addZone(this._viewZone);
        if (lenses.length > 0) {
            this._createContentWidgetIfNecessary();
            this._contentWidget.withCommands(lenses, false);
        }
    }
    _createContentWidgetIfNecessary() {
        if (!this._contentWidget) {
            this._contentWidget = new $08a0d36d17637495$var$CodeLensContentWidget(this._editor, this._viewZone.afterLineNumber + 1);
            this._editor.addContentWidget(this._contentWidget);
        } else this._editor.layoutContentWidget(this._contentWidget);
    }
    dispose(helper, viewZoneChangeAccessor) {
        this._decorationIds.forEach(helper.removeDecoration, helper);
        this._decorationIds = [];
        viewZoneChangeAccessor?.removeZone(this._viewZoneId);
        if (this._contentWidget) {
            this._editor.removeContentWidget(this._contentWidget);
            this._contentWidget = undefined;
        }
        this._isDisposed = true;
    }
    isDisposed() {
        return this._isDisposed;
    }
    isValid() {
        return this._decorationIds.some((id, i)=>{
            const range = this._editor.getModel().getDecorationRange(id);
            const symbol = this._data[i].symbol;
            return !!(range && (0, $d00il.Range).isEmpty(symbol.range) === range.isEmpty());
        });
    }
    updateCodeLensSymbols(data, helper) {
        this._decorationIds.forEach(helper.removeDecoration, helper);
        this._decorationIds = [];
        this._data = data;
        this._data.forEach((codeLensData, i)=>{
            helper.addDecoration({
                range: codeLensData.symbol.range,
                options: $08a0d36d17637495$var$codeLensDecorationOptions
            }, (id)=>this._decorationIds[i] = id);
        });
    }
    updateHeight(height, viewZoneChangeAccessor) {
        this._viewZone.heightInPx = height;
        viewZoneChangeAccessor.layoutZone(this._viewZoneId);
        if (this._contentWidget) this._editor.layoutContentWidget(this._contentWidget);
    }
    computeIfNecessary(model) {
        if (!this._viewZone.isVisible()) return null;
        // Read editor current state
        for(let i = 0; i < this._decorationIds.length; i++){
            const range = model.getDecorationRange(this._decorationIds[i]);
            if (range) this._data[i].symbol.range = range;
        }
        return this._data;
    }
    updateCommands(symbols) {
        this._createContentWidgetIfNecessary();
        this._contentWidget.withCommands(symbols, true);
        for(let i = 0; i < this._data.length; i++){
            const resolved = symbols[i];
            if (resolved) {
                const { symbol: symbol } = this._data[i];
                symbol.command = resolved.command || symbol.command;
            }
        }
    }
    getCommand(link) {
        return this._contentWidget?.getCommand(link);
    }
    getLineNumber() {
        const range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);
        if (range) return range.startLineNumber;
        return -1;
    }
    update(viewZoneChangeAccessor) {
        if (this.isValid()) {
            const range = this._editor.getModel().getDecorationRange(this._decorationIds[0]);
            if (range) {
                this._viewZone.afterLineNumber = range.startLineNumber - 1;
                viewZoneChangeAccessor.layoutZone(this._viewZoneId);
                if (this._contentWidget) {
                    this._contentWidget.updatePosition(range.startLineNumber);
                    this._editor.layoutContentWidget(this._contentWidget);
                }
            }
        }
    }
}



var $4dEdH = parcelRequire("4dEdH");

var $8tcMz = parcelRequire("8tcMz");

var $kCOKl = parcelRequire("kCOKl");

var $3XkzC = parcelRequire("3XkzC");

var $goG89 = parcelRequire("goG89");

var $4J6fu = parcelRequire("4J6fu");
var $941279b768392f49$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $941279b768392f49$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $941279b768392f49$export$2ad2fe275c1424ff = class CodeLensContribution {
    static{
        this.ID = 'css.editor.codeLens';
    }
    constructor(_editor, _languageFeaturesService, debounceService, _commandService, _notificationService, _codeLensCache){
        this._editor = _editor;
        this._languageFeaturesService = _languageFeaturesService;
        this._commandService = _commandService;
        this._notificationService = _notificationService;
        this._codeLensCache = _codeLensCache;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._localToDispose = new (0, $9cWcn.DisposableStore)();
        this._lenses = [];
        this._oldCodeLensModels = new (0, $9cWcn.DisposableStore)();
        this._provideCodeLensDebounce = debounceService.for(_languageFeaturesService.codeLensProvider, 'CodeLensProvide', {
            min: 250
        });
        this._resolveCodeLensesDebounce = debounceService.for(_languageFeaturesService.codeLensProvider, 'CodeLensResolve', {
            min: 250,
            salt: 'resolve'
        });
        this._resolveCodeLensesScheduler = new (0, $6bXyA.RunOnceScheduler)(()=>this._resolveCodeLensesInViewport(), this._resolveCodeLensesDebounce.default());
        this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange()));
        this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange()));
        this._disposables.add(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(50 /* EditorOption.fontInfo */ ) || e.hasChanged(19 /* EditorOption.codeLensFontSize */ ) || e.hasChanged(18 /* EditorOption.codeLensFontFamily */ )) this._updateLensStyle();
            if (e.hasChanged(17 /* EditorOption.codeLens */ )) this._onModelChange();
        }));
        this._disposables.add(_languageFeaturesService.codeLensProvider.onDidChange(this._onModelChange, this));
        this._onModelChange();
        this._updateLensStyle();
    }
    dispose() {
        this._localDispose();
        this._disposables.dispose();
        this._oldCodeLensModels.dispose();
        this._currentCodeLensModel?.dispose();
    }
    _getLayoutInfo() {
        const lineHeightFactor = Math.max(1.3, this._editor.getOption(67 /* EditorOption.lineHeight */ ) / this._editor.getOption(52 /* EditorOption.fontSize */ ));
        let fontSize = this._editor.getOption(19 /* EditorOption.codeLensFontSize */ );
        if (!fontSize || fontSize < 5) fontSize = this._editor.getOption(52 /* EditorOption.fontSize */ ) * .9 | 0;
        return {
            fontSize: fontSize,
            codeLensHeight: fontSize * lineHeightFactor | 0
        };
    }
    _updateLensStyle() {
        const { codeLensHeight: codeLensHeight, fontSize: fontSize } = this._getLayoutInfo();
        const fontFamily = this._editor.getOption(18 /* EditorOption.codeLensFontFamily */ );
        const editorFontInfo = this._editor.getOption(50 /* EditorOption.fontInfo */ );
        const { style: style } = this._editor.getContainerDomNode();
        style.setProperty('--vscode-editorCodeLens-lineHeight', `${codeLensHeight}px`);
        style.setProperty('--vscode-editorCodeLens-fontSize', `${fontSize}px`);
        style.setProperty('--vscode-editorCodeLens-fontFeatureSettings', editorFontInfo.fontFeatureSettings);
        if (fontFamily) {
            style.setProperty('--vscode-editorCodeLens-fontFamily', fontFamily);
            style.setProperty('--vscode-editorCodeLens-fontFamilyDefault', (0, $cd4KD.EDITOR_FONT_DEFAULTS).fontFamily);
        }
        //
        this._editor.changeViewZones((accessor)=>{
            for (const lens of this._lenses)lens.updateHeight(codeLensHeight, accessor);
        });
    }
    _localDispose() {
        this._getCodeLensModelPromise?.cancel();
        this._getCodeLensModelPromise = undefined;
        this._resolveCodeLensesPromise?.cancel();
        this._resolveCodeLensesPromise = undefined;
        this._localToDispose.clear();
        this._oldCodeLensModels.clear();
        this._currentCodeLensModel?.dispose();
    }
    _onModelChange() {
        this._localDispose();
        const model = this._editor.getModel();
        if (!model) return;
        if (!this._editor.getOption(17 /* EditorOption.codeLens */ ) || model.isTooLargeForTokenization()) return;
        const cachedLenses = this._codeLensCache.get(model);
        if (cachedLenses) this._renderCodeLensSymbols(cachedLenses);
        if (!this._languageFeaturesService.codeLensProvider.has(model)) {
            // no provider -> return but check with
            // cached lenses. they expire after 30 seconds
            if (cachedLenses) (0, $6bXyA.disposableTimeout)(()=>{
                const cachedLensesNow = this._codeLensCache.get(model);
                if (cachedLenses === cachedLensesNow) {
                    this._codeLensCache.delete(model);
                    this._onModelChange();
                }
            }, 30000, this._localToDispose);
            return;
        }
        for (const provider of this._languageFeaturesService.codeLensProvider.all(model))if (typeof provider.onDidChange === 'function') {
            const registration = provider.onDidChange(()=>scheduler.schedule());
            this._localToDispose.add(registration);
        }
        const scheduler = new (0, $6bXyA.RunOnceScheduler)(()=>{
            const t1 = Date.now();
            this._getCodeLensModelPromise?.cancel();
            this._getCodeLensModelPromise = (0, $6bXyA.createCancelablePromise)((token)=>(0, $228736e5f3929868$export$bebcff98c7e74873)(this._languageFeaturesService.codeLensProvider, model, token));
            this._getCodeLensModelPromise.then((result)=>{
                if (this._currentCodeLensModel) this._oldCodeLensModels.add(this._currentCodeLensModel);
                this._currentCodeLensModel = result;
                // cache model to reduce flicker
                this._codeLensCache.put(model, result);
                // update moving average
                const newDelay = this._provideCodeLensDebounce.update(model, Date.now() - t1);
                scheduler.delay = newDelay;
                // render lenses
                this._renderCodeLensSymbols(result);
                // dom.scheduleAtNextAnimationFrame(() => this._resolveCodeLensesInViewport());
                this._resolveCodeLensesInViewportSoon();
            }, (0, $gPkHZ.onUnexpectedError));
        }, this._provideCodeLensDebounce.get(model));
        this._localToDispose.add(scheduler);
        this._localToDispose.add((0, $9cWcn.toDisposable)(()=>this._resolveCodeLensesScheduler.cancel()));
        this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{
            this._editor.changeDecorations((decorationsAccessor)=>{
                this._editor.changeViewZones((viewZonesAccessor)=>{
                    const toDispose = [];
                    let lastLensLineNumber = -1;
                    this._lenses.forEach((lens)=>{
                        if (!lens.isValid() || lastLensLineNumber === lens.getLineNumber()) // invalid -> lens collapsed, attach range doesn't exist anymore
                        // line_number -> lenses should never be on the same line
                        toDispose.push(lens);
                        else {
                            lens.update(viewZonesAccessor);
                            lastLensLineNumber = lens.getLineNumber();
                        }
                    });
                    const helper = new (0, $08a0d36d17637495$export$76bdebf29cc4b59e)();
                    toDispose.forEach((l)=>{
                        l.dispose(helper, viewZonesAccessor);
                        this._lenses.splice(this._lenses.indexOf(l), 1);
                    });
                    helper.commit(decorationsAccessor);
                });
            });
            // Ask for all references again
            scheduler.schedule();
            // Cancel pending and active resolve requests
            this._resolveCodeLensesScheduler.cancel();
            this._resolveCodeLensesPromise?.cancel();
            this._resolveCodeLensesPromise = undefined;
        }));
        this._localToDispose.add(this._editor.onDidFocusEditorText(()=>{
            scheduler.schedule();
        }));
        this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{
            scheduler.cancel();
        }));
        this._localToDispose.add(this._editor.onDidScrollChange((e)=>{
            if (e.scrollTopChanged && this._lenses.length > 0) this._resolveCodeLensesInViewportSoon();
        }));
        this._localToDispose.add(this._editor.onDidLayoutChange(()=>{
            this._resolveCodeLensesInViewportSoon();
        }));
        this._localToDispose.add((0, $9cWcn.toDisposable)(()=>{
            if (this._editor.getModel()) {
                const scrollState = (0, $1RlHY.StableEditorScrollState).capture(this._editor);
                this._editor.changeDecorations((decorationsAccessor)=>{
                    this._editor.changeViewZones((viewZonesAccessor)=>{
                        this._disposeAllLenses(decorationsAccessor, viewZonesAccessor);
                    });
                });
                scrollState.restore(this._editor);
            } else // No accessors available
            this._disposeAllLenses(undefined, undefined);
        }));
        this._localToDispose.add(this._editor.onMouseDown((e)=>{
            if (e.target.type !== 9 /* MouseTargetType.CONTENT_WIDGET */ ) return;
            let target = e.target.element;
            if (target?.tagName === 'SPAN') target = target.parentElement;
            if (target?.tagName === 'A') for (const lens of this._lenses){
                const command = lens.getCommand(target);
                if (command) {
                    this._commandService.executeCommand(command.id, ...command.arguments || []).catch((err)=>this._notificationService.error(err));
                    break;
                }
            }
        }));
        scheduler.schedule();
    }
    _disposeAllLenses(decChangeAccessor, viewZoneChangeAccessor) {
        const helper = new (0, $08a0d36d17637495$export$76bdebf29cc4b59e)();
        for (const lens of this._lenses)lens.dispose(helper, viewZoneChangeAccessor);
        if (decChangeAccessor) helper.commit(decChangeAccessor);
        this._lenses.length = 0;
    }
    _renderCodeLensSymbols(symbols) {
        if (!this._editor.hasModel()) return;
        const maxLineNumber = this._editor.getModel().getLineCount();
        const groups = [];
        let lastGroup;
        for (const symbol of symbols.lenses){
            const line = symbol.symbol.range.startLineNumber;
            if (line < 1 || line > maxLineNumber) continue;
            else if (lastGroup && lastGroup[lastGroup.length - 1].symbol.range.startLineNumber === line) // on same line as previous
            lastGroup.push(symbol);
            else {
                // on later line as previous
                lastGroup = [
                    symbol
                ];
                groups.push(lastGroup);
            }
        }
        if (!groups.length && !this._lenses.length) // Nothing to change
        return;
        const scrollState = (0, $1RlHY.StableEditorScrollState).capture(this._editor);
        const layoutInfo = this._getLayoutInfo();
        this._editor.changeDecorations((decorationsAccessor)=>{
            this._editor.changeViewZones((viewZoneAccessor)=>{
                const helper = new (0, $08a0d36d17637495$export$76bdebf29cc4b59e)();
                let codeLensIndex = 0;
                let groupsIndex = 0;
                while(groupsIndex < groups.length && codeLensIndex < this._lenses.length){
                    const symbolsLineNumber = groups[groupsIndex][0].symbol.range.startLineNumber;
                    const codeLensLineNumber = this._lenses[codeLensIndex].getLineNumber();
                    if (codeLensLineNumber < symbolsLineNumber) {
                        this._lenses[codeLensIndex].dispose(helper, viewZoneAccessor);
                        this._lenses.splice(codeLensIndex, 1);
                    } else if (codeLensLineNumber === symbolsLineNumber) {
                        this._lenses[codeLensIndex].updateCodeLensSymbols(groups[groupsIndex], helper);
                        groupsIndex++;
                        codeLensIndex++;
                    } else {
                        this._lenses.splice(codeLensIndex, 0, new (0, $08a0d36d17637495$export$c4760329dfff1b1c)(groups[groupsIndex], this._editor, helper, viewZoneAccessor, layoutInfo.codeLensHeight, ()=>this._resolveCodeLensesInViewportSoon()));
                        codeLensIndex++;
                        groupsIndex++;
                    }
                }
                // Delete extra code lenses
                while(codeLensIndex < this._lenses.length){
                    this._lenses[codeLensIndex].dispose(helper, viewZoneAccessor);
                    this._lenses.splice(codeLensIndex, 1);
                }
                // Create extra symbols
                while(groupsIndex < groups.length){
                    this._lenses.push(new (0, $08a0d36d17637495$export$c4760329dfff1b1c)(groups[groupsIndex], this._editor, helper, viewZoneAccessor, layoutInfo.codeLensHeight, ()=>this._resolveCodeLensesInViewportSoon()));
                    groupsIndex++;
                }
                helper.commit(decorationsAccessor);
            });
        });
        scrollState.restore(this._editor);
    }
    _resolveCodeLensesInViewportSoon() {
        const model = this._editor.getModel();
        if (model) this._resolveCodeLensesScheduler.schedule();
    }
    _resolveCodeLensesInViewport() {
        this._resolveCodeLensesPromise?.cancel();
        this._resolveCodeLensesPromise = undefined;
        const model = this._editor.getModel();
        if (!model) return;
        const toResolve = [];
        const lenses = [];
        this._lenses.forEach((lens)=>{
            const request = lens.computeIfNecessary(model);
            if (request) {
                toResolve.push(request);
                lenses.push(lens);
            }
        });
        if (toResolve.length === 0) return;
        const t1 = Date.now();
        const resolvePromise = (0, $6bXyA.createCancelablePromise)((token)=>{
            const promises = toResolve.map((request, i)=>{
                const resolvedSymbols = new Array(request.length);
                const promises = request.map((request, i)=>{
                    if (!request.symbol.command && typeof request.provider.resolveCodeLens === 'function') return Promise.resolve(request.provider.resolveCodeLens(model, request.symbol, token)).then((symbol)=>{
                        resolvedSymbols[i] = symbol;
                    }, (0, $gPkHZ.onUnexpectedExternalError));
                    else {
                        resolvedSymbols[i] = request.symbol;
                        return Promise.resolve(undefined);
                    }
                });
                return Promise.all(promises).then(()=>{
                    if (!token.isCancellationRequested && !lenses[i].isDisposed()) lenses[i].updateCommands(resolvedSymbols);
                });
            });
            return Promise.all(promises);
        });
        this._resolveCodeLensesPromise = resolvePromise;
        this._resolveCodeLensesPromise.then(()=>{
            // update moving average
            const newDelay = this._resolveCodeLensesDebounce.update(model, Date.now() - t1);
            this._resolveCodeLensesScheduler.delay = newDelay;
            if (this._currentCodeLensModel) this._codeLensCache.put(model, this._currentCodeLensModel);
            this._oldCodeLensModels.clear(); // dispose old models once we have updated the UI with the current model
            if (resolvePromise === this._resolveCodeLensesPromise) this._resolveCodeLensesPromise = undefined;
        }, (err)=>{
            (0, $gPkHZ.onUnexpectedError)(err); // can also be cancellation!
            if (resolvePromise === this._resolveCodeLensesPromise) this._resolveCodeLensesPromise = undefined;
        });
    }
    async getModel() {
        await this._getCodeLensModelPromise;
        await this._resolveCodeLensesPromise;
        return !this._currentCodeLensModel?.isDisposed ? this._currentCodeLensModel : undefined;
    }
};
$941279b768392f49$export$2ad2fe275c1424ff = $941279b768392f49$var$__decorate([
    $941279b768392f49$var$__param(1, (0, $4J6fu.ILanguageFeaturesService)),
    $941279b768392f49$var$__param(2, (0, $goG89.ILanguageFeatureDebounceService)),
    $941279b768392f49$var$__param(3, (0, $8tcMz.ICommandService)),
    $941279b768392f49$var$__param(4, (0, $kCOKl.INotificationService)),
    $941279b768392f49$var$__param(5, (0, $7f2127e728f4c039$export$49a51fe6a3a59e77))
], $941279b768392f49$export$2ad2fe275c1424ff);
(0, $2iJTi.registerEditorContribution)($941279b768392f49$export$2ad2fe275c1424ff.ID, $941279b768392f49$export$2ad2fe275c1424ff, 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $2iJTi.registerEditorAction)(class ShowLensesInCurrentLine extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'codelens.showLensesInCurrentLine',
            precondition: (0, $ibKGQ.EditorContextKeys).hasCodeLensProvider,
            label: (0, $4dEdH.localize)('showLensOnLine', "Show CodeLens Commands For Current Line"),
            alias: 'Show CodeLens Commands For Current Line'
        });
    }
    async run(accessor, editor) {
        if (!editor.hasModel()) return;
        const quickInputService = accessor.get((0, $3XkzC.IQuickInputService));
        const commandService = accessor.get((0, $8tcMz.ICommandService));
        const notificationService = accessor.get((0, $kCOKl.INotificationService));
        const lineNumber = editor.getSelection().positionLineNumber;
        const codelensController = editor.getContribution($941279b768392f49$export$2ad2fe275c1424ff.ID);
        if (!codelensController) return;
        const model = await codelensController.getModel();
        if (!model) // nothing
        return;
        const items = [];
        for (const lens of model.lenses)if (lens.symbol.command && lens.symbol.range.startLineNumber === lineNumber) items.push({
            label: lens.symbol.command.title,
            command: lens.symbol.command
        });
        if (items.length === 0) // We dont want an empty picker
        return;
        const item = await quickInputService.pick(items, {
            canPickMany: false,
            placeHolder: (0, $4dEdH.localize)('placeHolder', "Select a command")
        });
        if (!item) // Nothing picked
        return;
        let command = item.command;
        if (model.isDisposed) {
            // try to find the same command again in-case the model has been re-created in the meantime
            // this is a best attempt approach which shouldn't be needed because eager model re-creates
            // shouldn't happen due to focus in/out anymore
            const newModel = await codelensController.getModel();
            const newLens = newModel?.lenses.find((lens)=>lens.symbol.range.startLineNumber === lineNumber && lens.symbol.command?.title === command.title);
            if (!newLens || !newLens.symbol.command) return;
            command = newLens.symbol.command;
        }
        try {
            await commandService.executeCommand(command.id, ...command.arguments || []);
        } catch (err) {
            notificationService.error(err);
        }
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $d00il = parcelRequire("d00il");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $bjjQO = parcelRequire("bjjQO");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $eUQTM = parcelRequire("eUQTM");

var $jcr1R = parcelRequire("jcr1R");

var $loznH = parcelRequire("loznH");

var $2iJTi = parcelRequire("2iJTi");

var $d00il = parcelRequire("d00il");

var $91ntV = parcelRequire("91ntV");

var $goG89 = parcelRequire("goG89");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $5OJ54 = parcelRequire("5OJ54");

var $d00il = parcelRequire("d00il");

var $cKKJT = parcelRequire("cKKJT");

var $8tcMz = parcelRequire("8tcMz");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bjjQO = parcelRequire("bjjQO");

var $9cWcn = parcelRequire("9cWcn");

var $4J6fu = parcelRequire("4J6fu");

var $54y8R = parcelRequire("54y8R");

var $zvLvK = parcelRequire("zvLvK");
var $fbfb5a95eda13a12$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $fbfb5a95eda13a12$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $fbfb5a95eda13a12$export$2ca312b7c8c08c1e = class DefaultDocumentColorProvider {
    constructor(_editorWorkerService){
        this._editorWorkerService = _editorWorkerService;
    }
    async provideDocumentColors(model, _token) {
        return this._editorWorkerService.computeDefaultDocumentColors(model.uri);
    }
    provideColorPresentations(_model, colorInfo, _token) {
        const range = colorInfo.range;
        const colorFromInfo = colorInfo.color;
        const alpha = colorFromInfo.alpha;
        const color = new (0, $bjjQO.Color)(new (0, $bjjQO.RGBA)(Math.round(255 * colorFromInfo.red), Math.round(255 * colorFromInfo.green), Math.round(255 * colorFromInfo.blue), alpha));
        const rgb = alpha ? (0, $bjjQO.Color).Format.CSS.formatRGB(color) : (0, $bjjQO.Color).Format.CSS.formatRGBA(color);
        const hsl = alpha ? (0, $bjjQO.Color).Format.CSS.formatHSL(color) : (0, $bjjQO.Color).Format.CSS.formatHSLA(color);
        const hex = alpha ? (0, $bjjQO.Color).Format.CSS.formatHex(color) : (0, $bjjQO.Color).Format.CSS.formatHexA(color);
        const colorPresentations = [];
        colorPresentations.push({
            label: rgb,
            textEdit: {
                range: range,
                text: rgb
            }
        });
        colorPresentations.push({
            label: hsl,
            textEdit: {
                range: range,
                text: hsl
            }
        });
        colorPresentations.push({
            label: hex,
            textEdit: {
                range: range,
                text: hex
            }
        });
        return colorPresentations;
    }
};
$fbfb5a95eda13a12$export$2ca312b7c8c08c1e = $fbfb5a95eda13a12$var$__decorate([
    $fbfb5a95eda13a12$var$__param(0, (0, $zvLvK.IEditorWorkerService))
], $fbfb5a95eda13a12$export$2ca312b7c8c08c1e);
let $fbfb5a95eda13a12$var$DefaultDocumentColorProviderFeature = class DefaultDocumentColorProviderFeature extends (0, $9cWcn.Disposable) {
    constructor(_languageFeaturesService, editorWorkerService){
        super();
        this._register(_languageFeaturesService.colorProvider.register('*', new $fbfb5a95eda13a12$export$2ca312b7c8c08c1e(editorWorkerService)));
    }
};
$fbfb5a95eda13a12$var$DefaultDocumentColorProviderFeature = $fbfb5a95eda13a12$var$__decorate([
    $fbfb5a95eda13a12$var$__param(0, (0, $4J6fu.ILanguageFeaturesService)),
    $fbfb5a95eda13a12$var$__param(1, (0, $zvLvK.IEditorWorkerService))
], $fbfb5a95eda13a12$var$DefaultDocumentColorProviderFeature);
(0, $54y8R.registerEditorFeature)($fbfb5a95eda13a12$var$DefaultDocumentColorProviderFeature);



var $35IZ9 = parcelRequire("35IZ9");
async function $666d3363bf3e2520$export$6cee60e8aa85e528(colorProviderRegistry, model, token, isDefaultColorDecoratorsEnabled = true) {
    return $666d3363bf3e2520$var$_findColorData(new $666d3363bf3e2520$var$ColorDataCollector(), colorProviderRegistry, model, token, isDefaultColorDecoratorsEnabled);
}
function $666d3363bf3e2520$export$c3064c7f8ffdbaa5(model, colorInfo, provider, token) {
    return Promise.resolve(provider.provideColorPresentations(model, colorInfo, token));
}
class $666d3363bf3e2520$var$ColorDataCollector {
    constructor(){}
    async compute(provider, model, token, colors) {
        const documentColors = await provider.provideDocumentColors(model, token);
        if (Array.isArray(documentColors)) for (const colorInfo of documentColors)colors.push({
            colorInfo: colorInfo,
            provider: provider
        });
        return Array.isArray(documentColors);
    }
}
class $666d3363bf3e2520$var$ExtColorDataCollector {
    constructor(){}
    async compute(provider, model, token, colors) {
        const documentColors = await provider.provideDocumentColors(model, token);
        if (Array.isArray(documentColors)) for (const colorInfo of documentColors)colors.push({
            range: colorInfo.range,
            color: [
                colorInfo.color.red,
                colorInfo.color.green,
                colorInfo.color.blue,
                colorInfo.color.alpha
            ]
        });
        return Array.isArray(documentColors);
    }
}
class $666d3363bf3e2520$var$ColorPresentationsCollector {
    constructor(colorInfo){
        this.colorInfo = colorInfo;
    }
    async compute(provider, model, _token, colors) {
        const documentColors = await provider.provideColorPresentations(model, this.colorInfo, (0, $giPcZ.CancellationToken).None);
        if (Array.isArray(documentColors)) colors.push(...documentColors);
        return Array.isArray(documentColors);
    }
}
async function $666d3363bf3e2520$var$_findColorData(collector, colorProviderRegistry, model, token, isDefaultColorDecoratorsEnabled) {
    let validDocumentColorProviderFound = false;
    let defaultProvider;
    const colorData = [];
    const documentColorProviders = colorProviderRegistry.ordered(model);
    for(let i = documentColorProviders.length - 1; i >= 0; i--){
        const provider = documentColorProviders[i];
        if (provider instanceof (0, $fbfb5a95eda13a12$export$2ca312b7c8c08c1e)) defaultProvider = provider;
        else try {
            if (await collector.compute(provider, model, token, colorData)) validDocumentColorProviderFound = true;
        } catch (e) {
            (0, $gPkHZ.onUnexpectedExternalError)(e);
        }
    }
    if (validDocumentColorProviderFound) return colorData;
    if (defaultProvider && isDefaultColorDecoratorsEnabled) {
        await collector.compute(defaultProvider, model, token, colorData);
        return colorData;
    }
    return [];
}
function $666d3363bf3e2520$var$_setupColorCommand(accessor, resource) {
    const { colorProvider: colorProviderRegistry } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(resource);
    if (!model) throw (0, $gPkHZ.illegalArgument)();
    const isDefaultColorDecoratorsEnabled = accessor.get((0, $35IZ9.IConfigurationService)).getValue('editor.defaultColorDecorators', {
        resource: resource
    });
    return {
        model: model,
        colorProviderRegistry: colorProviderRegistry,
        isDefaultColorDecoratorsEnabled: isDefaultColorDecoratorsEnabled
    };
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeDocumentColorProvider', function(accessor, ...args) {
    const [resource] = args;
    if (!(resource instanceof (0, $5OJ54.URI))) throw (0, $gPkHZ.illegalArgument)();
    const { model: model, colorProviderRegistry: colorProviderRegistry, isDefaultColorDecoratorsEnabled: isDefaultColorDecoratorsEnabled } = $666d3363bf3e2520$var$_setupColorCommand(accessor, resource);
    return $666d3363bf3e2520$var$_findColorData(new $666d3363bf3e2520$var$ExtColorDataCollector(), colorProviderRegistry, model, (0, $giPcZ.CancellationToken).None, isDefaultColorDecoratorsEnabled);
});
(0, $8tcMz.CommandsRegistry).registerCommand('_executeColorPresentationProvider', function(accessor, ...args) {
    const [color, context] = args;
    const { uri: uri, range: range } = context;
    if (!(uri instanceof (0, $5OJ54.URI)) || !Array.isArray(color) || color.length !== 4 || !(0, $d00il.Range).isIRange(range)) throw (0, $gPkHZ.illegalArgument)();
    const { model: model, colorProviderRegistry: colorProviderRegistry, isDefaultColorDecoratorsEnabled: isDefaultColorDecoratorsEnabled } = $666d3363bf3e2520$var$_setupColorCommand(accessor, uri);
    const [red, green, blue, alpha] = color;
    return $666d3363bf3e2520$var$_findColorData(new $666d3363bf3e2520$var$ColorPresentationsCollector({
        range: range,
        color: {
            red: red,
            green: green,
            blue: blue,
            alpha: alpha
        }
    }), colorProviderRegistry, model, (0, $giPcZ.CancellationToken).None, isDefaultColorDecoratorsEnabled);
});



var $35IZ9 = parcelRequire("35IZ9");
var $dafa37c57c56cca4$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $dafa37c57c56cca4$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $dafa37c57c56cca4$var$ColorDetector_1;
const $dafa37c57c56cca4$export$f3ca1233c9ea131e = Object.create({});
let $dafa37c57c56cca4$export$267b3b1876bfdb86 = class ColorDetector extends (0, $9cWcn.Disposable) {
    static{
        $dafa37c57c56cca4$var$ColorDetector_1 = this;
    }
    static{
        this.ID = 'editor.contrib.colorDetector';
    }
    static{
        this.RECOMPUTE_TIME = 1000;
    }
    constructor(_editor, _configurationService, _languageFeaturesService, languageFeatureDebounceService){
        super();
        this._editor = _editor;
        this._configurationService = _configurationService;
        this._languageFeaturesService = _languageFeaturesService;
        this._localToDispose = this._register(new (0, $9cWcn.DisposableStore)());
        this._decorationsIds = [];
        this._colorDatas = new Map();
        this._colorDecoratorIds = this._editor.createDecorationsCollection();
        this._ruleFactory = new (0, $loznH.DynamicCssRules)(this._editor);
        this._decoratorLimitReporter = new $dafa37c57c56cca4$export$1fb8ae9ee9e6e9be();
        this._colorDecorationClassRefs = this._register(new (0, $9cWcn.DisposableStore)());
        this._debounceInformation = languageFeatureDebounceService.for(_languageFeaturesService.colorProvider, 'Document Colors', {
            min: $dafa37c57c56cca4$var$ColorDetector_1.RECOMPUTE_TIME
        });
        this._register(_editor.onDidChangeModel(()=>{
            this._isColorDecoratorsEnabled = this.isEnabled();
            this.updateColors();
        }));
        this._register(_editor.onDidChangeModelLanguage(()=>this.updateColors()));
        this._register(_languageFeaturesService.colorProvider.onDidChange(()=>this.updateColors()));
        this._register(_editor.onDidChangeConfiguration((e)=>{
            const prevIsEnabled = this._isColorDecoratorsEnabled;
            this._isColorDecoratorsEnabled = this.isEnabled();
            this._isDefaultColorDecoratorsEnabled = this._editor.getOption(148 /* EditorOption.defaultColorDecorators */ );
            const updatedColorDecoratorsSetting = prevIsEnabled !== this._isColorDecoratorsEnabled || e.hasChanged(21 /* EditorOption.colorDecoratorsLimit */ );
            const updatedDefaultColorDecoratorsSetting = e.hasChanged(148 /* EditorOption.defaultColorDecorators */ );
            if (updatedColorDecoratorsSetting || updatedDefaultColorDecoratorsSetting) {
                if (this._isColorDecoratorsEnabled) this.updateColors();
                else this.removeAllDecorations();
            }
        }));
        this._timeoutTimer = null;
        this._computePromise = null;
        this._isColorDecoratorsEnabled = this.isEnabled();
        this._isDefaultColorDecoratorsEnabled = this._editor.getOption(148 /* EditorOption.defaultColorDecorators */ );
        this.updateColors();
    }
    isEnabled() {
        const model = this._editor.getModel();
        if (!model) return false;
        const languageId = model.getLanguageId();
        // handle deprecated settings. [languageId].colorDecorators.enable
        const deprecatedConfig = this._configurationService.getValue(languageId);
        if (deprecatedConfig && typeof deprecatedConfig === 'object') {
            const colorDecorators = deprecatedConfig['colorDecorators']; // deprecatedConfig.valueOf('.colorDecorators.enable');
            if (colorDecorators && colorDecorators['enable'] !== undefined && !colorDecorators['enable']) return colorDecorators['enable'];
        }
        return this._editor.getOption(20 /* EditorOption.colorDecorators */ );
    }
    static get(editor) {
        return editor.getContribution(this.ID);
    }
    dispose() {
        this.stop();
        this.removeAllDecorations();
        super.dispose();
    }
    updateColors() {
        this.stop();
        if (!this._isColorDecoratorsEnabled) return;
        const model = this._editor.getModel();
        if (!model || !this._languageFeaturesService.colorProvider.has(model)) return;
        this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{
            if (!this._timeoutTimer) {
                this._timeoutTimer = new (0, $6bXyA.TimeoutTimer)();
                this._timeoutTimer.cancelAndSet(()=>{
                    this._timeoutTimer = null;
                    this.beginCompute();
                }, this._debounceInformation.get(model));
            }
        }));
        this.beginCompute();
    }
    async beginCompute() {
        this._computePromise = (0, $6bXyA.createCancelablePromise)(async (token)=>{
            const model = this._editor.getModel();
            if (!model) return [];
            const sw = new (0, $eUQTM.StopWatch)(false);
            const colors = await (0, $666d3363bf3e2520$export$6cee60e8aa85e528)(this._languageFeaturesService.colorProvider, model, token, this._isDefaultColorDecoratorsEnabled);
            this._debounceInformation.update(model, sw.elapsed());
            return colors;
        });
        try {
            const colors = await this._computePromise;
            this.updateDecorations(colors);
            this.updateColorDecorators(colors);
            this._computePromise = null;
        } catch (e) {
            (0, $gPkHZ.onUnexpectedError)(e);
        }
    }
    stop() {
        if (this._timeoutTimer) {
            this._timeoutTimer.cancel();
            this._timeoutTimer = null;
        }
        if (this._computePromise) {
            this._computePromise.cancel();
            this._computePromise = null;
        }
        this._localToDispose.clear();
    }
    updateDecorations(colorDatas) {
        const decorations = colorDatas.map((c)=>({
                range: {
                    startLineNumber: c.colorInfo.range.startLineNumber,
                    startColumn: c.colorInfo.range.startColumn,
                    endLineNumber: c.colorInfo.range.endLineNumber,
                    endColumn: c.colorInfo.range.endColumn
                },
                options: (0, $91ntV.ModelDecorationOptions).EMPTY
            }));
        this._editor.changeDecorations((changeAccessor)=>{
            this._decorationsIds = changeAccessor.deltaDecorations(this._decorationsIds, decorations);
            this._colorDatas = new Map();
            this._decorationsIds.forEach((id, i)=>this._colorDatas.set(id, colorDatas[i]));
        });
    }
    updateColorDecorators(colorData) {
        this._colorDecorationClassRefs.clear();
        const decorations = [];
        const limit = this._editor.getOption(21 /* EditorOption.colorDecoratorsLimit */ );
        for(let i = 0; i < colorData.length && decorations.length < limit; i++){
            const { red: red, green: green, blue: blue, alpha: alpha } = colorData[i].colorInfo.color;
            const rgba = new (0, $bjjQO.RGBA)(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);
            const color = `rgba(${rgba.r}, ${rgba.g}, ${rgba.b}, ${rgba.a})`;
            const ref = this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({
                backgroundColor: color
            }));
            decorations.push({
                range: {
                    startLineNumber: colorData[i].colorInfo.range.startLineNumber,
                    startColumn: colorData[i].colorInfo.range.startColumn,
                    endLineNumber: colorData[i].colorInfo.range.endLineNumber,
                    endColumn: colorData[i].colorInfo.range.endColumn
                },
                options: {
                    description: 'colorDetector',
                    before: {
                        content: (0, $jcr1R.noBreakWhitespace),
                        inlineClassName: `${ref.className} colorpicker-color-decoration`,
                        inlineClassNameAffectsLetterSpacing: true,
                        attachedData: $dafa37c57c56cca4$export$f3ca1233c9ea131e
                    }
                }
            });
        }
        const limited = limit < colorData.length ? limit : false;
        this._decoratorLimitReporter.update(colorData.length, limited);
        this._colorDecoratorIds.set(decorations);
    }
    removeAllDecorations() {
        this._editor.removeDecorations(this._decorationsIds);
        this._decorationsIds = [];
        this._colorDecoratorIds.clear();
        this._colorDecorationClassRefs.clear();
    }
    getColorData(position) {
        const model = this._editor.getModel();
        if (!model) return null;
        const decorations = model.getDecorationsInRange((0, $d00il.Range).fromPositions(position, position)).filter((d)=>this._colorDatas.has(d.id));
        if (decorations.length === 0) return null;
        return this._colorDatas.get(decorations[0].id);
    }
    isColorDecoration(decoration) {
        return this._colorDecoratorIds.has(decoration);
    }
};
$dafa37c57c56cca4$export$267b3b1876bfdb86 = $dafa37c57c56cca4$var$ColorDetector_1 = $dafa37c57c56cca4$var$__decorate([
    $dafa37c57c56cca4$var$__param(1, (0, $35IZ9.IConfigurationService)),
    $dafa37c57c56cca4$var$__param(2, (0, $4J6fu.ILanguageFeaturesService)),
    $dafa37c57c56cca4$var$__param(3, (0, $goG89.ILanguageFeatureDebounceService))
], $dafa37c57c56cca4$export$267b3b1876bfdb86);
class $dafa37c57c56cca4$export$1fb8ae9ee9e6e9be {
    constructor(){
        this._onDidChange = new (0, $5YaSO.Emitter)();
        this._computed = 0;
        this._limited = false;
    }
    update(computed, limited) {
        if (computed !== this._computed || limited !== this._limited) {
            this._computed = computed;
            this._limited = limited;
            this._onDidChange.fire();
        }
    }
}
(0, $2iJTi.registerEditorContribution)($dafa37c57c56cca4$export$267b3b1876bfdb86.ID, $dafa37c57c56cca4$export$267b3b1876bfdb86, 1 /* EditorContributionInstantiation.AfterFirstRender */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $bjjQO = parcelRequire("bjjQO");

var $9cWcn = parcelRequire("9cWcn");

var $d00il = parcelRequire("d00il");


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5YaSO = parcelRequire("5YaSO");
class $8647f241d7cfeb63$export$76cf66edc64e95a7 {
    get color() {
        return this._color;
    }
    set color(color) {
        if (this._color.equals(color)) return;
        this._color = color;
        this._onDidChangeColor.fire(color);
    }
    get presentation() {
        return this.colorPresentations[this.presentationIndex];
    }
    get colorPresentations() {
        return this._colorPresentations;
    }
    set colorPresentations(colorPresentations) {
        this._colorPresentations = colorPresentations;
        if (this.presentationIndex > colorPresentations.length - 1) this.presentationIndex = 0;
        this._onDidChangePresentation.fire(this.presentation);
    }
    constructor(color, availableColorPresentations, presentationIndex){
        this.presentationIndex = presentationIndex;
        this._onColorFlushed = new (0, $5YaSO.Emitter)();
        this.onColorFlushed = this._onColorFlushed.event;
        this._onDidChangeColor = new (0, $5YaSO.Emitter)();
        this.onDidChangeColor = this._onDidChangeColor.event;
        this._onDidChangePresentation = new (0, $5YaSO.Emitter)();
        this.onDidChangePresentation = this._onDidChangePresentation.event;
        this.originalColor = color;
        this._color = color;
        this._colorPresentations = availableColorPresentations;
    }
    selectNextColorPresentation() {
        this.presentationIndex = (this.presentationIndex + 1) % this.colorPresentations.length;
        this.flushColor();
        this._onDidChangePresentation.fire(this.presentation);
    }
    guessColorPresentation(color, originalText) {
        let presentationIndex = -1;
        for(let i = 0; i < this.colorPresentations.length; i++)if (originalText.toLowerCase() === this.colorPresentations[i].label) {
            presentationIndex = i;
            break;
        }
        if (presentationIndex === -1) {
            // check which color presentation text has same prefix as original text's prefix
            const originalTextPrefix = originalText.split('(')[0].toLowerCase();
            for(let i = 0; i < this.colorPresentations.length; i++)if (this.colorPresentations[i].label.toLowerCase().startsWith(originalTextPrefix)) {
                presentationIndex = i;
                break;
            }
        }
        if (presentationIndex !== -1 && presentationIndex !== this.presentationIndex) {
            this.presentationIndex = presentationIndex;
            this._onDidChangePresentation.fire(this.presentation);
        }
    }
    flushColor() {
        this._onColorFlushed.fire(this._color);
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4nLbs = parcelRequire("4nLbs");

var $bDzmQ = parcelRequire("bDzmQ");

var $6nVXx = parcelRequire("6nVXx");

var $fxJYg = parcelRequire("fxJYg");

var $awgRE = parcelRequire("awgRE");

var $bjjQO = parcelRequire("bjjQO");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $5rADe = parcelRequire("5rADe");


var $4dEdH = parcelRequire("4dEdH");

var $gaWeX = parcelRequire("gaWeX");

var $hEsmQ = parcelRequire("hEsmQ");
const $4707d5adc59abe95$var$$ = $bDzmQ.$;
class $4707d5adc59abe95$export$89f2225ce9c7d7ad extends (0, $9cWcn.Disposable) {
    constructor(container, model, themeService, showingStandaloneColorPicker = false){
        super();
        this.model = model;
        this.showingStandaloneColorPicker = showingStandaloneColorPicker;
        this._closeButton = null;
        this._domNode = $4707d5adc59abe95$var$$('.colorpicker-header');
        $bDzmQ.append(container, this._domNode);
        this._pickedColorNode = $bDzmQ.append(this._domNode, $4707d5adc59abe95$var$$('.picked-color'));
        $bDzmQ.append(this._pickedColorNode, $4707d5adc59abe95$var$$('span.codicon.codicon-color-mode'));
        this._pickedColorPresentation = $bDzmQ.append(this._pickedColorNode, document.createElement('span'));
        this._pickedColorPresentation.classList.add('picked-color-presentation');
        const tooltip = (0, $4dEdH.localize)('clickToToggleColorOptions', "Click to toggle color options (rgb/hsl/hex)");
        this._pickedColorNode.setAttribute('title', tooltip);
        this._originalColorNode = $bDzmQ.append(this._domNode, $4707d5adc59abe95$var$$('.original-color'));
        this._originalColorNode.style.backgroundColor = (0, $bjjQO.Color).Format.CSS.format(this.model.originalColor) || '';
        this.backgroundColor = themeService.getColorTheme().getColor((0, $gaWeX.editorHoverBackground)) || (0, $bjjQO.Color).white;
        this._register(themeService.onDidColorThemeChange((theme)=>{
            this.backgroundColor = theme.getColor((0, $gaWeX.editorHoverBackground)) || (0, $bjjQO.Color).white;
        }));
        this._register($bDzmQ.addDisposableListener(this._pickedColorNode, $bDzmQ.EventType.CLICK, ()=>this.model.selectNextColorPresentation()));
        this._register($bDzmQ.addDisposableListener(this._originalColorNode, $bDzmQ.EventType.CLICK, ()=>{
            this.model.color = this.model.originalColor;
            this.model.flushColor();
        }));
        this._register(model.onDidChangeColor(this.onDidChangeColor, this));
        this._register(model.onDidChangePresentation(this.onDidChangePresentation, this));
        this._pickedColorNode.style.backgroundColor = (0, $bjjQO.Color).Format.CSS.format(model.color) || '';
        this._pickedColorNode.classList.toggle('light', model.color.rgba.a < 0.5 ? this.backgroundColor.isLighter() : model.color.isLighter());
        this.onDidChangeColor(this.model.color);
        // When the color picker widget is a standalone color picker widget, then add a close button
        if (this.showingStandaloneColorPicker) {
            this._domNode.classList.add('standalone-colorpicker');
            this._closeButton = this._register(new $4707d5adc59abe95$var$CloseButton(this._domNode));
        }
    }
    get closeButton() {
        return this._closeButton;
    }
    get pickedColorNode() {
        return this._pickedColorNode;
    }
    get originalColorNode() {
        return this._originalColorNode;
    }
    onDidChangeColor(color) {
        this._pickedColorNode.style.backgroundColor = (0, $bjjQO.Color).Format.CSS.format(color) || '';
        this._pickedColorNode.classList.toggle('light', color.rgba.a < 0.5 ? this.backgroundColor.isLighter() : color.isLighter());
        this.onDidChangePresentation();
    }
    onDidChangePresentation() {
        this._pickedColorPresentation.textContent = this.model.presentation ? this.model.presentation.label : '';
    }
}
class $4707d5adc59abe95$var$CloseButton extends (0, $9cWcn.Disposable) {
    constructor(container){
        super();
        this._onClicked = this._register(new (0, $5YaSO.Emitter)());
        this.onClicked = this._onClicked.event;
        this._button = document.createElement('div');
        this._button.classList.add('close-button');
        $bDzmQ.append(container, this._button);
        const innerDiv = document.createElement('div');
        innerDiv.classList.add('close-button-inner-div');
        $bDzmQ.append(this._button, innerDiv);
        const closeButton = $bDzmQ.append(innerDiv, $4707d5adc59abe95$var$$('.button' + (0, $5rADe.ThemeIcon).asCSSSelector((0, $hEsmQ.registerIcon)('color-picker-close', (0, $awgRE.Codicon).close, (0, $4dEdH.localize)('closeIcon', 'Icon to close the color picker')))));
        closeButton.classList.add('close-icon');
        this._register($bDzmQ.addDisposableListener(this._button, $bDzmQ.EventType.CLICK, ()=>{
            this._onClicked.fire();
        }));
    }
}
class $4707d5adc59abe95$export$d4d2a64f59ef343b extends (0, $9cWcn.Disposable) {
    constructor(container, model, pixelRatio, isStandaloneColorPicker = false){
        super();
        this.model = model;
        this.pixelRatio = pixelRatio;
        this._insertButton = null;
        this._domNode = $4707d5adc59abe95$var$$('.colorpicker-body');
        $bDzmQ.append(container, this._domNode);
        this._saturationBox = new $4707d5adc59abe95$var$SaturationBox(this._domNode, this.model, this.pixelRatio);
        this._register(this._saturationBox);
        this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange, this));
        this._register(this._saturationBox.onColorFlushed(this.flushColor, this));
        this._opacityStrip = new $4707d5adc59abe95$var$OpacityStrip(this._domNode, this.model, isStandaloneColorPicker);
        this._register(this._opacityStrip);
        this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange, this));
        this._register(this._opacityStrip.onColorFlushed(this.flushColor, this));
        this._hueStrip = new $4707d5adc59abe95$var$HueStrip(this._domNode, this.model, isStandaloneColorPicker);
        this._register(this._hueStrip);
        this._register(this._hueStrip.onDidChange(this.onDidHueChange, this));
        this._register(this._hueStrip.onColorFlushed(this.flushColor, this));
        if (isStandaloneColorPicker) {
            this._insertButton = this._register(new $4707d5adc59abe95$export$a84121b2ebfb3ce9(this._domNode));
            this._domNode.classList.add('standalone-colorpicker');
        }
    }
    flushColor() {
        this.model.flushColor();
    }
    onDidSaturationValueChange({ s: s, v: v }) {
        const hsva = this.model.color.hsva;
        this.model.color = new (0, $bjjQO.Color)(new (0, $bjjQO.HSVA)(hsva.h, s, v, hsva.a));
    }
    onDidOpacityChange(a) {
        const hsva = this.model.color.hsva;
        this.model.color = new (0, $bjjQO.Color)(new (0, $bjjQO.HSVA)(hsva.h, hsva.s, hsva.v, a));
    }
    onDidHueChange(value) {
        const hsva = this.model.color.hsva;
        const h = (1 - value) * 360;
        this.model.color = new (0, $bjjQO.Color)(new (0, $bjjQO.HSVA)(h === 360 ? 0 : h, hsva.s, hsva.v, hsva.a));
    }
    get domNode() {
        return this._domNode;
    }
    get saturationBox() {
        return this._saturationBox;
    }
    get enterButton() {
        return this._insertButton;
    }
    layout() {
        this._saturationBox.layout();
        this._opacityStrip.layout();
        this._hueStrip.layout();
    }
}
class $4707d5adc59abe95$var$SaturationBox extends (0, $9cWcn.Disposable) {
    constructor(container, model, pixelRatio){
        super();
        this.model = model;
        this.pixelRatio = pixelRatio;
        this._onDidChange = new (0, $5YaSO.Emitter)();
        this.onDidChange = this._onDidChange.event;
        this._onColorFlushed = new (0, $5YaSO.Emitter)();
        this.onColorFlushed = this._onColorFlushed.event;
        this._domNode = $4707d5adc59abe95$var$$('.saturation-wrap');
        $bDzmQ.append(container, this._domNode);
        // Create canvas, draw selected color
        this._canvas = document.createElement('canvas');
        this._canvas.className = 'saturation-box';
        $bDzmQ.append(this._domNode, this._canvas);
        // Add selection circle
        this.selection = $4707d5adc59abe95$var$$('.saturation-selection');
        $bDzmQ.append(this._domNode, this.selection);
        this.layout();
        this._register($bDzmQ.addDisposableListener(this._domNode, $bDzmQ.EventType.POINTER_DOWN, (e)=>this.onPointerDown(e)));
        this._register(this.model.onDidChangeColor(this.onDidChangeColor, this));
        this.monitor = null;
    }
    get domNode() {
        return this._domNode;
    }
    onPointerDown(e) {
        if (!e.target || !(e.target instanceof Element)) return;
        this.monitor = this._register(new (0, $6nVXx.GlobalPointerMoveMonitor)());
        const origin = $bDzmQ.getDomNodePagePosition(this._domNode);
        if (e.target !== this.selection) this.onDidChangePosition(e.offsetX, e.offsetY);
        this.monitor.startMonitoring(e.target, e.pointerId, e.buttons, (event)=>this.onDidChangePosition(event.pageX - origin.left, event.pageY - origin.top), ()=>null);
        const pointerUpListener = $bDzmQ.addDisposableListener(e.target.ownerDocument, $bDzmQ.EventType.POINTER_UP, ()=>{
            this._onColorFlushed.fire();
            pointerUpListener.dispose();
            if (this.monitor) {
                this.monitor.stopMonitoring(true);
                this.monitor = null;
            }
        }, true);
    }
    onDidChangePosition(left, top) {
        const s = Math.max(0, Math.min(1, left / this.width));
        const v = Math.max(0, Math.min(1, 1 - top / this.height));
        this.paintSelection(s, v);
        this._onDidChange.fire({
            s: s,
            v: v
        });
    }
    layout() {
        this.width = this._domNode.offsetWidth;
        this.height = this._domNode.offsetHeight;
        this._canvas.width = this.width * this.pixelRatio;
        this._canvas.height = this.height * this.pixelRatio;
        this.paint();
        const hsva = this.model.color.hsva;
        this.paintSelection(hsva.s, hsva.v);
    }
    paint() {
        const hsva = this.model.color.hsva;
        const saturatedColor = new (0, $bjjQO.Color)(new (0, $bjjQO.HSVA)(hsva.h, 1, 1, 1));
        const ctx = this._canvas.getContext('2d');
        const whiteGradient = ctx.createLinearGradient(0, 0, this._canvas.width, 0);
        whiteGradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
        whiteGradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.5)');
        whiteGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
        const blackGradient = ctx.createLinearGradient(0, 0, 0, this._canvas.height);
        blackGradient.addColorStop(0, 'rgba(0, 0, 0, 0)');
        blackGradient.addColorStop(1, 'rgba(0, 0, 0, 1)');
        ctx.rect(0, 0, this._canvas.width, this._canvas.height);
        ctx.fillStyle = (0, $bjjQO.Color).Format.CSS.format(saturatedColor);
        ctx.fill();
        ctx.fillStyle = whiteGradient;
        ctx.fill();
        ctx.fillStyle = blackGradient;
        ctx.fill();
    }
    paintSelection(s, v) {
        this.selection.style.left = `${s * this.width}px`;
        this.selection.style.top = `${this.height - v * this.height}px`;
    }
    onDidChangeColor(color) {
        if (this.monitor && this.monitor.isMonitoring()) return;
        this.paint();
        const hsva = color.hsva;
        this.paintSelection(hsva.s, hsva.v);
    }
}
class $4707d5adc59abe95$var$Strip extends (0, $9cWcn.Disposable) {
    constructor(container, model, showingStandaloneColorPicker = false){
        super();
        this.model = model;
        this._onDidChange = new (0, $5YaSO.Emitter)();
        this.onDidChange = this._onDidChange.event;
        this._onColorFlushed = new (0, $5YaSO.Emitter)();
        this.onColorFlushed = this._onColorFlushed.event;
        if (showingStandaloneColorPicker) {
            this.domNode = $bDzmQ.append(container, $4707d5adc59abe95$var$$('.standalone-strip'));
            this.overlay = $bDzmQ.append(this.domNode, $4707d5adc59abe95$var$$('.standalone-overlay'));
        } else {
            this.domNode = $bDzmQ.append(container, $4707d5adc59abe95$var$$('.strip'));
            this.overlay = $bDzmQ.append(this.domNode, $4707d5adc59abe95$var$$('.overlay'));
        }
        this.slider = $bDzmQ.append(this.domNode, $4707d5adc59abe95$var$$('.slider'));
        this.slider.style.top = `0px`;
        this._register($bDzmQ.addDisposableListener(this.domNode, $bDzmQ.EventType.POINTER_DOWN, (e)=>this.onPointerDown(e)));
        this._register(model.onDidChangeColor(this.onDidChangeColor, this));
        this.layout();
    }
    layout() {
        this.height = this.domNode.offsetHeight - this.slider.offsetHeight;
        const value = this.getValue(this.model.color);
        this.updateSliderPosition(value);
    }
    onDidChangeColor(color) {
        const value = this.getValue(color);
        this.updateSliderPosition(value);
    }
    onPointerDown(e) {
        if (!e.target || !(e.target instanceof Element)) return;
        const monitor = this._register(new (0, $6nVXx.GlobalPointerMoveMonitor)());
        const origin = $bDzmQ.getDomNodePagePosition(this.domNode);
        this.domNode.classList.add('grabbing');
        if (e.target !== this.slider) this.onDidChangeTop(e.offsetY);
        monitor.startMonitoring(e.target, e.pointerId, e.buttons, (event)=>this.onDidChangeTop(event.pageY - origin.top), ()=>null);
        const pointerUpListener = $bDzmQ.addDisposableListener(e.target.ownerDocument, $bDzmQ.EventType.POINTER_UP, ()=>{
            this._onColorFlushed.fire();
            pointerUpListener.dispose();
            monitor.stopMonitoring(true);
            this.domNode.classList.remove('grabbing');
        }, true);
    }
    onDidChangeTop(top) {
        const value = Math.max(0, Math.min(1, 1 - top / this.height));
        this.updateSliderPosition(value);
        this._onDidChange.fire(value);
    }
    updateSliderPosition(value) {
        this.slider.style.top = `${(1 - value) * this.height}px`;
    }
}
class $4707d5adc59abe95$var$OpacityStrip extends $4707d5adc59abe95$var$Strip {
    constructor(container, model, showingStandaloneColorPicker = false){
        super(container, model, showingStandaloneColorPicker);
        this.domNode.classList.add('opacity-strip');
        this.onDidChangeColor(this.model.color);
    }
    onDidChangeColor(color) {
        super.onDidChangeColor(color);
        const { r: r, g: g, b: b } = color.rgba;
        const opaque = new (0, $bjjQO.Color)(new (0, $bjjQO.RGBA)(r, g, b, 1));
        const transparent = new (0, $bjjQO.Color)(new (0, $bjjQO.RGBA)(r, g, b, 0));
        this.overlay.style.background = `linear-gradient(to bottom, ${opaque} 0%, ${transparent} 100%)`;
    }
    getValue(color) {
        return color.hsva.a;
    }
}
class $4707d5adc59abe95$var$HueStrip extends $4707d5adc59abe95$var$Strip {
    constructor(container, model, showingStandaloneColorPicker = false){
        super(container, model, showingStandaloneColorPicker);
        this.domNode.classList.add('hue-strip');
    }
    getValue(color) {
        return 1 - color.hsva.h / 360;
    }
}
class $4707d5adc59abe95$export$a84121b2ebfb3ce9 extends (0, $9cWcn.Disposable) {
    constructor(container){
        super();
        this._onClicked = this._register(new (0, $5YaSO.Emitter)());
        this.onClicked = this._onClicked.event;
        this._button = $bDzmQ.append(container, document.createElement('button'));
        this._button.classList.add('insert-button');
        this._button.textContent = 'Insert';
        this._register($bDzmQ.addDisposableListener(this._button, $bDzmQ.EventType.CLICK, ()=>{
            this._onClicked.fire();
        }));
    }
    get button() {
        return this._button;
    }
}
class $4707d5adc59abe95$export$1d10c81ebf4df2e3 extends (0, $fxJYg.Widget) {
    constructor(container, model, pixelRatio, themeService, standaloneColorPicker = false){
        super();
        this.model = model;
        this.pixelRatio = pixelRatio;
        this._register((0, $4nLbs.PixelRatio).getInstance($bDzmQ.getWindow(container)).onDidChange(()=>this.layout()));
        this._domNode = $4707d5adc59abe95$var$$('.colorpicker-widget');
        container.appendChild(this._domNode);
        this.header = this._register(new $4707d5adc59abe95$export$89f2225ce9c7d7ad(this._domNode, this.model, themeService, standaloneColorPicker));
        this.body = this._register(new $4707d5adc59abe95$export$d4d2a64f59ef343b(this._domNode, this.model, this.pixelRatio, standaloneColorPicker));
    }
    layout() {
        this.body.layout();
    }
    get domNode() {
        return this._domNode;
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ class $4760294cb1bcf994$export$2a967524099ecc2c {
    constructor(priority, range, initialMousePosX, initialMousePosY){
        this.priority = priority;
        this.range = range;
        this.initialMousePosX = initialMousePosX;
        this.initialMousePosY = initialMousePosY;
        this.type = 1 /* HoverAnchorType.Range */ ;
    }
    equals(other) {
        return other.type === 1 /* HoverAnchorType.Range */  && this.range.equalsRange(other.range);
    }
    canAdoptVisibleHover(lastAnchor, showAtPosition) {
        return lastAnchor.type === 1 /* HoverAnchorType.Range */  && showAtPosition.lineNumber === this.range.startLineNumber;
    }
}
class $4760294cb1bcf994$export$cadc11e524c92809 {
    constructor(priority, owner, range, initialMousePosX, initialMousePosY, supportsMarkerHover){
        this.priority = priority;
        this.owner = owner;
        this.range = range;
        this.initialMousePosX = initialMousePosX;
        this.initialMousePosY = initialMousePosY;
        this.supportsMarkerHover = supportsMarkerHover;
        this.type = 2 /* HoverAnchorType.ForeignElement */ ;
    }
    equals(other) {
        return other.type === 2 /* HoverAnchorType.ForeignElement */  && this.owner === other.owner;
    }
    canAdoptVisibleHover(lastAnchor, showAtPosition) {
        return lastAnchor.type === 2 /* HoverAnchorType.ForeignElement */  && this.owner === lastAnchor.owner;
    }
}
class $4760294cb1bcf994$export$637327e7f36b9c4a {
    constructor(renderedHoverParts){
        this.renderedHoverParts = renderedHoverParts;
    }
    dispose() {
        for (const part of this.renderedHoverParts)part.dispose();
    }
}
const $4760294cb1bcf994$export$fc2e2429672a46bc = new class HoverParticipantRegistry {
    constructor(){
        this._participants = [];
    }
    register(ctor) {
        this._participants.push(ctor);
    }
    getAll() {
        return this._participants;
    }
}();



var $azIPz = parcelRequire("azIPz");

var $bDzmQ = parcelRequire("bDzmQ");
var $6d075c31a65fd2a0$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $6d075c31a65fd2a0$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $6d075c31a65fd2a0$export$1e790ecd6a44b70f {
    constructor(owner, range, model, provider){
        this.owner = owner;
        this.range = range;
        this.model = model;
        this.provider = provider;
        /**
         * Force the hover to always be rendered at this specific range,
         * even in the case of multiple hover parts.
         */ this.forceShowAtRange = true;
    }
    isValidForHoverAnchor(anchor) {
        return anchor.type === 1 /* HoverAnchorType.Range */  && this.range.startColumn <= anchor.range.startColumn && this.range.endColumn >= anchor.range.endColumn;
    }
}
let $6d075c31a65fd2a0$export$c4145a38e12cf25c = class ColorHoverParticipant {
    constructor(_editor, _themeService){
        this._editor = _editor;
        this._themeService = _themeService;
        this.hoverOrdinal = 2;
    }
    computeSync(_anchor, _lineDecorations) {
        return [];
    }
    computeAsync(anchor, lineDecorations, token) {
        return (0, $6bXyA.AsyncIterableObject).fromPromise(this._computeAsync(anchor, lineDecorations, token));
    }
    async _computeAsync(_anchor, lineDecorations, _token) {
        if (!this._editor.hasModel()) return [];
        const colorDetector = (0, $dafa37c57c56cca4$export$267b3b1876bfdb86).get(this._editor);
        if (!colorDetector) return [];
        for (const d of lineDecorations){
            if (!colorDetector.isColorDecoration(d)) continue;
            const colorData = colorDetector.getColorData(d.range.getStartPosition());
            if (colorData) {
                const colorHover = await $6d075c31a65fd2a0$var$_createColorHover(this, this._editor.getModel(), colorData.colorInfo, colorData.provider);
                return [
                    colorHover
                ];
            }
        }
        return [];
    }
    renderHoverParts(context, hoverParts) {
        const renderedPart = $6d075c31a65fd2a0$var$renderHoverParts(this, this._editor, this._themeService, hoverParts, context);
        if (!renderedPart) return new (0, $4760294cb1bcf994$export$637327e7f36b9c4a)([]);
        this._colorPicker = renderedPart.colorPicker;
        const renderedHoverPart = {
            hoverPart: renderedPart.hoverPart,
            hoverElement: this._colorPicker.domNode,
            dispose () {
                renderedPart.disposables.dispose();
            }
        };
        return new (0, $4760294cb1bcf994$export$637327e7f36b9c4a)([
            renderedHoverPart
        ]);
    }
    handleResize() {
        this._colorPicker?.layout();
    }
    isColorPickerVisible() {
        return !!this._colorPicker;
    }
};
$6d075c31a65fd2a0$export$c4145a38e12cf25c = $6d075c31a65fd2a0$var$__decorate([
    $6d075c31a65fd2a0$var$__param(1, (0, $azIPz.IThemeService))
], $6d075c31a65fd2a0$export$c4145a38e12cf25c);
class $6d075c31a65fd2a0$export$31a44700a902e757 {
    constructor(owner, range, model, provider){
        this.owner = owner;
        this.range = range;
        this.model = model;
        this.provider = provider;
    }
}
let $6d075c31a65fd2a0$export$32cb5245d7be00c7 = class StandaloneColorPickerParticipant {
    constructor(_editor, _themeService){
        this._editor = _editor;
        this._themeService = _themeService;
        this._color = null;
    }
    async createColorHover(defaultColorInfo, defaultColorProvider, colorProviderRegistry) {
        if (!this._editor.hasModel()) return null;
        const colorDetector = (0, $dafa37c57c56cca4$export$267b3b1876bfdb86).get(this._editor);
        if (!colorDetector) return null;
        const colors = await (0, $666d3363bf3e2520$export$6cee60e8aa85e528)(colorProviderRegistry, this._editor.getModel(), (0, $giPcZ.CancellationToken).None);
        let foundColorInfo = null;
        let foundColorProvider = null;
        for (const colorData of colors){
            const colorInfo = colorData.colorInfo;
            if ((0, $d00il.Range).containsRange(colorInfo.range, defaultColorInfo.range)) {
                foundColorInfo = colorInfo;
                foundColorProvider = colorData.provider;
            }
        }
        const colorInfo = foundColorInfo ?? defaultColorInfo;
        const colorProvider = foundColorProvider ?? defaultColorProvider;
        const foundInEditor = !!foundColorInfo;
        return {
            colorHover: await $6d075c31a65fd2a0$var$_createColorHover(this, this._editor.getModel(), colorInfo, colorProvider),
            foundInEditor: foundInEditor
        };
    }
    async updateEditorModel(colorHoverData) {
        if (!this._editor.hasModel()) return;
        const colorPickerModel = colorHoverData.model;
        let range = new (0, $d00il.Range)(colorHoverData.range.startLineNumber, colorHoverData.range.startColumn, colorHoverData.range.endLineNumber, colorHoverData.range.endColumn);
        if (this._color) {
            await $6d075c31a65fd2a0$var$_updateColorPresentations(this._editor.getModel(), colorPickerModel, this._color, range, colorHoverData);
            range = $6d075c31a65fd2a0$var$_updateEditorModel(this._editor, range, colorPickerModel);
        }
    }
    renderHoverParts(context, hoverParts) {
        return $6d075c31a65fd2a0$var$renderHoverParts(this, this._editor, this._themeService, hoverParts, context);
    }
    set color(color) {
        this._color = color;
    }
    get color() {
        return this._color;
    }
};
$6d075c31a65fd2a0$export$32cb5245d7be00c7 = $6d075c31a65fd2a0$var$__decorate([
    $6d075c31a65fd2a0$var$__param(1, (0, $azIPz.IThemeService))
], $6d075c31a65fd2a0$export$32cb5245d7be00c7);
async function $6d075c31a65fd2a0$var$_createColorHover(participant, editorModel, colorInfo, provider) {
    const originalText = editorModel.getValueInRange(colorInfo.range);
    const { red: red, green: green, blue: blue, alpha: alpha } = colorInfo.color;
    const rgba = new (0, $bjjQO.RGBA)(Math.round(red * 255), Math.round(green * 255), Math.round(blue * 255), alpha);
    const color = new (0, $bjjQO.Color)(rgba);
    const colorPresentations = await (0, $666d3363bf3e2520$export$c3064c7f8ffdbaa5)(editorModel, colorInfo, provider, (0, $giPcZ.CancellationToken).None);
    const model = new (0, $8647f241d7cfeb63$export$76cf66edc64e95a7)(color, [], 0);
    model.colorPresentations = colorPresentations || [];
    model.guessColorPresentation(color, originalText);
    if (participant instanceof $6d075c31a65fd2a0$export$c4145a38e12cf25c) return new $6d075c31a65fd2a0$export$1e790ecd6a44b70f(participant, (0, $d00il.Range).lift(colorInfo.range), model, provider);
    else return new $6d075c31a65fd2a0$export$31a44700a902e757(participant, (0, $d00il.Range).lift(colorInfo.range), model, provider);
}
function $6d075c31a65fd2a0$var$renderHoverParts(participant, editor, themeService, hoverParts, context) {
    if (hoverParts.length === 0 || !editor.hasModel()) return undefined;
    if (context.setMinimumDimensions) {
        const minimumHeight = editor.getOption(67 /* EditorOption.lineHeight */ ) + 8;
        context.setMinimumDimensions(new (0, $bDzmQ.Dimension)(302, minimumHeight));
    }
    const disposables = new (0, $9cWcn.DisposableStore)();
    const colorHover = hoverParts[0];
    const editorModel = editor.getModel();
    const model = colorHover.model;
    const colorPicker = disposables.add(new (0, $4707d5adc59abe95$export$1d10c81ebf4df2e3)(context.fragment, model, editor.getOption(144 /* EditorOption.pixelRatio */ ), themeService, participant instanceof $6d075c31a65fd2a0$export$32cb5245d7be00c7));
    let editorUpdatedByColorPicker = false;
    let range = new (0, $d00il.Range)(colorHover.range.startLineNumber, colorHover.range.startColumn, colorHover.range.endLineNumber, colorHover.range.endColumn);
    if (participant instanceof $6d075c31a65fd2a0$export$32cb5245d7be00c7) {
        const color = colorHover.model.color;
        participant.color = color;
        $6d075c31a65fd2a0$var$_updateColorPresentations(editorModel, model, color, range, colorHover);
        disposables.add(model.onColorFlushed((color)=>{
            participant.color = color;
        }));
    } else disposables.add(model.onColorFlushed(async (color)=>{
        await $6d075c31a65fd2a0$var$_updateColorPresentations(editorModel, model, color, range, colorHover);
        editorUpdatedByColorPicker = true;
        range = $6d075c31a65fd2a0$var$_updateEditorModel(editor, range, model);
    }));
    disposables.add(model.onDidChangeColor((color)=>{
        $6d075c31a65fd2a0$var$_updateColorPresentations(editorModel, model, color, range, colorHover);
    }));
    disposables.add(editor.onDidChangeModelContent((e)=>{
        if (editorUpdatedByColorPicker) editorUpdatedByColorPicker = false;
        else {
            context.hide();
            editor.focus();
        }
    }));
    return {
        hoverPart: colorHover,
        colorPicker: colorPicker,
        disposables: disposables
    };
}
function $6d075c31a65fd2a0$var$_updateEditorModel(editor, range, model) {
    const textEdits = [];
    const edit = model.presentation.textEdit ?? {
        range: range,
        text: model.presentation.label,
        forceMoveMarkers: false
    };
    textEdits.push(edit);
    if (model.presentation.additionalTextEdits) textEdits.push(...model.presentation.additionalTextEdits);
    const replaceRange = (0, $d00il.Range).lift(edit.range);
    const trackedRange = editor.getModel()._setTrackedRange(null, replaceRange, 3 /* TrackedRangeStickiness.GrowsOnlyWhenTypingAfter */ );
    editor.executeEdits('colorpicker', textEdits);
    editor.pushUndoStop();
    return editor.getModel()._getTrackedRange(trackedRange) ?? replaceRange;
}
async function $6d075c31a65fd2a0$var$_updateColorPresentations(editorModel, colorPickerModel, color, range, colorHover) {
    const colorPresentations = await (0, $666d3363bf3e2520$export$c3064c7f8ffdbaa5)(editorModel, {
        range: range,
        color: {
            red: color.rgba.r / 255,
            green: color.rgba.g / 255,
            blue: color.rgba.b / 255,
            alpha: color.rgba.a
        }
    }, colorHover.provider, (0, $giPcZ.CancellationToken).None);
    colorPickerModel.colorPresentations = colorPresentations || [];
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4dEdH = parcelRequire("4dEdH");
const $12f419b3d72893f8$export$62786f1070e2cbd1 = 'editor.action.showHover';
const $12f419b3d72893f8$export$1a6c7cbea3b39bc2 = 'editor.action.showDefinitionPreviewHover';
const $12f419b3d72893f8$export$3b6e5fd9ecfb8818 = 'editor.action.scrollUpHover';
const $12f419b3d72893f8$export$3aae40ec50cdf518 = 'editor.action.scrollDownHover';
const $12f419b3d72893f8$export$9ebf83601aac402d = 'editor.action.scrollLeftHover';
const $12f419b3d72893f8$export$b3287a0fd661351c = 'editor.action.scrollRightHover';
const $12f419b3d72893f8$export$a2ee82287204c334 = 'editor.action.pageUpHover';
const $12f419b3d72893f8$export$fe51d4b753097916 = 'editor.action.pageDownHover';
const $12f419b3d72893f8$export$661f13a87001816f = 'editor.action.goToTopHover';
const $12f419b3d72893f8$export$686aa8960b1c24f6 = 'editor.action.goToBottomHover';
const $12f419b3d72893f8$export$876e0bba4925f0cd = 'editor.action.increaseHoverVerbosityLevel';
const $12f419b3d72893f8$export$11c4eab940ded057 = $4dEdH.localize({
    key: 'increaseHoverVerbosityLevel',
    comment: [
        'Label for action that will increase the hover verbosity level.'
    ]
}, "Increase Hover Verbosity Level");
const $12f419b3d72893f8$export$cb7016f65e6be5ca = 'editor.action.decreaseHoverVerbosityLevel';
const $12f419b3d72893f8$export$c8fd0cdc78f4b697 = $4dEdH.localize({
    key: 'decreaseHoverVerbosityLevel',
    comment: [
        'Label for action that will decrease the hover verbosity level.'
    ]
}, "Decrease Hover Verbosity Level");



var $9cWcn = parcelRequire("9cWcn");

var $fdGPu = parcelRequire("fdGPu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $6nSvp = parcelRequire("6nSvp");

var $27s0k = parcelRequire("27s0k");

var $cVfMQ = parcelRequire("cVfMQ");

var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");

var $awgRE = parcelRequire("awgRE");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $5Gd0V = parcelRequire("5Gd0V");

var $lb0Ah = parcelRequire("lb0Ah");

var $5rADe = parcelRequire("5rADe");


var $dcxQ7 = parcelRequire("dcxQ7");

var $kzNQX = parcelRequire("kzNQX");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ const $385d40f4a712f69a$export$f1235a78c589a102 = 'editor.action.inlineSuggest.commit';
const $385d40f4a712f69a$export$fa9ae9dbf994df58 = 'editor.action.inlineSuggest.showPrevious';
const $385d40f4a712f69a$export$e1de09bbdbe549c1 = 'editor.action.inlineSuggest.showNext';



var $4dEdH = parcelRequire("4dEdH");

var $hbDWq = parcelRequire("hbDWq");

var $lNBi4 = parcelRequire("lNBi4");

var $g4v7E = parcelRequire("g4v7E");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $d6K7e = parcelRequire("d6K7e");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $lMGba = parcelRequire("lMGba");

var $hEsmQ = parcelRequire("hEsmQ");
var $b8b03009035a1e69$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $b8b03009035a1e69$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $b8b03009035a1e69$var$InlineSuggestionHintsContentWidget_1;
let $b8b03009035a1e69$export$3a097b0f53a9c529 = class InlineCompletionsHintsWidget extends (0, $9cWcn.Disposable) {
    constructor(editor, model, instantiationService){
        super();
        this.editor = editor;
        this.model = model;
        this.instantiationService = instantiationService;
        this.alwaysShowToolbar = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(62 /* EditorOption.inlineSuggest */ ).showToolbar === 'always');
        this.sessionPosition = undefined;
        this.position = (0, $4fzqs.derived)(this, (reader)=>{
            const ghostText = this.model.read(reader)?.primaryGhostText.read(reader);
            if (!this.alwaysShowToolbar.read(reader) || !ghostText || ghostText.parts.length === 0) {
                this.sessionPosition = undefined;
                return null;
            }
            const firstColumn = ghostText.parts[0].column;
            if (this.sessionPosition && this.sessionPosition.lineNumber !== ghostText.lineNumber) this.sessionPosition = undefined;
            const position = new (0, $dcxQ7.Position)(ghostText.lineNumber, Math.min(firstColumn, this.sessionPosition?.column ?? Number.MAX_SAFE_INTEGER));
            this.sessionPosition = position;
            return position;
        });
        this._register((0, $4fzqs.autorunWithStore)((reader, store)=>{
            /** @description setup content widget */ const model = this.model.read(reader);
            if (!model || !this.alwaysShowToolbar.read(reader)) return;
            const contentWidgetValue = (0, $5Gd0V.derivedWithStore)((reader, store)=>{
                const contentWidget = store.add(this.instantiationService.createInstance($b8b03009035a1e69$export$4773b7ce527dcc8e, this.editor, true, this.position, model.selectedInlineCompletionIndex, model.inlineCompletionsCount, model.activeCommands));
                editor.addContentWidget(contentWidget);
                store.add((0, $9cWcn.toDisposable)(()=>editor.removeContentWidget(contentWidget)));
                store.add((0, $4fzqs.autorun)((reader)=>{
                    /** @description request explicit */ const position = this.position.read(reader);
                    if (!position) return;
                    if (model.lastTriggerKind.read(reader) !== (0, $kzNQX.InlineCompletionTriggerKind).Explicit) model.triggerExplicitly();
                }));
                return contentWidget;
            });
            const hadPosition = (0, $4fzqs.derivedObservableWithCache)(this, (reader, lastValue)=>!!this.position.read(reader) || !!lastValue);
            store.add((0, $4fzqs.autorun)((reader)=>{
                if (hadPosition.read(reader)) contentWidgetValue.read(reader);
            }));
        }));
    }
};
$b8b03009035a1e69$export$3a097b0f53a9c529 = $b8b03009035a1e69$var$__decorate([
    $b8b03009035a1e69$var$__param(2, (0, $fdGPu.IInstantiationService))
], $b8b03009035a1e69$export$3a097b0f53a9c529);
const $b8b03009035a1e69$var$inlineSuggestionHintsNextIcon = (0, $hEsmQ.registerIcon)('inline-suggestion-hints-next', (0, $awgRE.Codicon).chevronRight, (0, $4dEdH.localize)('parameterHintsNextIcon', 'Icon for show next parameter hint.'));
const $b8b03009035a1e69$var$inlineSuggestionHintsPreviousIcon = (0, $hEsmQ.registerIcon)('inline-suggestion-hints-previous', (0, $awgRE.Codicon).chevronLeft, (0, $4dEdH.localize)('parameterHintsPreviousIcon', 'Icon for show previous parameter hint.'));
let $b8b03009035a1e69$export$4773b7ce527dcc8e = class InlineSuggestionHintsContentWidget extends (0, $9cWcn.Disposable) {
    static{
        $b8b03009035a1e69$var$InlineSuggestionHintsContentWidget_1 = this;
    }
    static{
        this._dropDownVisible = false;
    }
    static get dropDownVisible() {
        return this._dropDownVisible;
    }
    static{
        this.id = 0;
    }
    createCommandAction(commandId, label, iconClassName) {
        const action = new (0, $cVfMQ.Action)(commandId, label, iconClassName, true, ()=>this._commandService.executeCommand(commandId));
        const kb = this.keybindingService.lookupKeybinding(commandId, this._contextKeyService);
        let tooltip = label;
        if (kb) tooltip = (0, $4dEdH.localize)({
            key: 'content',
            comment: [
                'A label',
                'A keybinding'
            ]
        }, '{0} ({1})', label, kb.getLabel());
        action.tooltip = tooltip;
        return action;
    }
    constructor(editor, withBorder, _position, _currentSuggestionIdx, _suggestionCount, _extraCommands, _commandService, instantiationService, keybindingService, _contextKeyService, _menuService){
        super();
        this.editor = editor;
        this.withBorder = withBorder;
        this._position = _position;
        this._currentSuggestionIdx = _currentSuggestionIdx;
        this._suggestionCount = _suggestionCount;
        this._extraCommands = _extraCommands;
        this._commandService = _commandService;
        this.keybindingService = keybindingService;
        this._contextKeyService = _contextKeyService;
        this._menuService = _menuService;
        this.id = `InlineSuggestionHintsContentWidget${$b8b03009035a1e69$var$InlineSuggestionHintsContentWidget_1.id++}`;
        this.allowEditorOverflow = true;
        this.suppressMouseDown = false;
        this.nodes = (0, $bDzmQ.h)('div.inlineSuggestionsHints', {
            className: this.withBorder ? '.withBorder' : ''
        }, [
            (0, $bDzmQ.h)('div@toolBar')
        ]);
        this.previousAction = this.createCommandAction((0, $385d40f4a712f69a$export$fa9ae9dbf994df58), (0, $4dEdH.localize)('previous', 'Previous'), (0, $5rADe.ThemeIcon).asClassName($b8b03009035a1e69$var$inlineSuggestionHintsPreviousIcon));
        this.availableSuggestionCountAction = new (0, $cVfMQ.Action)('inlineSuggestionHints.availableSuggestionCount', '', undefined, false);
        this.nextAction = this.createCommandAction((0, $385d40f4a712f69a$export$e1de09bbdbe549c1), (0, $4dEdH.localize)('next', 'Next'), (0, $5rADe.ThemeIcon).asClassName($b8b03009035a1e69$var$inlineSuggestionHintsNextIcon));
        // TODO@hediet: deprecate MenuId.InlineCompletionsActions
        this.inlineCompletionsActionsMenus = this._register(this._menuService.createMenu((0, $g4v7E.MenuId).InlineCompletionsActions, this._contextKeyService));
        this.clearAvailableSuggestionCountLabelDebounced = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>{
            this.availableSuggestionCountAction.label = '';
        }, 100));
        this.disableButtonsDebounced = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>{
            this.previousAction.enabled = this.nextAction.enabled = false;
        }, 100));
        this.toolBar = this._register(instantiationService.createInstance($b8b03009035a1e69$export$d5fdeb440ea8130f, this.nodes.toolBar, (0, $g4v7E.MenuId).InlineSuggestionToolbar, {
            menuOptions: {
                renderShortTitle: true
            },
            toolbarOptions: {
                primaryGroup: (g)=>g.startsWith('primary')
            },
            actionViewItemProvider: (action, options)=>{
                if (action instanceof (0, $g4v7E.MenuItemAction)) return instantiationService.createInstance($b8b03009035a1e69$var$StatusBarViewItem, action, undefined);
                if (action === this.availableSuggestionCountAction) {
                    const a = new $b8b03009035a1e69$var$ActionViewItemWithClassName(undefined, action, {
                        label: true,
                        icon: false
                    });
                    a.setClass('availableSuggestionCount');
                    return a;
                }
                return undefined;
            },
            telemetrySource: 'InlineSuggestionToolbar'
        }));
        this.toolBar.setPrependedPrimaryActions([
            this.previousAction,
            this.availableSuggestionCountAction,
            this.nextAction
        ]);
        this._register(this.toolBar.onDidChangeDropdownVisibility((e)=>{
            $b8b03009035a1e69$var$InlineSuggestionHintsContentWidget_1._dropDownVisible = e;
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description update position */ this._position.read(reader);
            this.editor.layoutContentWidget(this);
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description counts */ const suggestionCount = this._suggestionCount.read(reader);
            const currentSuggestionIdx = this._currentSuggestionIdx.read(reader);
            if (suggestionCount !== undefined) {
                this.clearAvailableSuggestionCountLabelDebounced.cancel();
                this.availableSuggestionCountAction.label = `${currentSuggestionIdx + 1}/${suggestionCount}`;
            } else this.clearAvailableSuggestionCountLabelDebounced.schedule();
            if (suggestionCount !== undefined && suggestionCount > 1) {
                this.disableButtonsDebounced.cancel();
                this.previousAction.enabled = this.nextAction.enabled = true;
            } else this.disableButtonsDebounced.schedule();
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description extra commands */ const extraCommands = this._extraCommands.read(reader);
            const extraActions = extraCommands.map((c)=>({
                    class: undefined,
                    id: c.id,
                    enabled: true,
                    tooltip: c.tooltip || '',
                    label: c.title,
                    run: (event)=>{
                        return this._commandService.executeCommand(c.id);
                    }
                }));
            for (const [_, group] of this.inlineCompletionsActionsMenus.getActions()){
                for (const action of group)if (action instanceof (0, $g4v7E.MenuItemAction)) extraActions.push(action);
            }
            if (extraActions.length > 0) extraActions.unshift(new (0, $cVfMQ.Separator)());
            this.toolBar.setAdditionalSecondaryActions(extraActions);
        }));
    }
    getId() {
        return this.id;
    }
    getDomNode() {
        return this.nodes.root;
    }
    getPosition() {
        return {
            position: this._position.get(),
            preference: [
                1 /* ContentWidgetPositionPreference.ABOVE */ ,
                2 /* ContentWidgetPositionPreference.BELOW */ 
            ],
            positionAffinity: 3 /* PositionAffinity.LeftOfInjectedText */ 
        };
    }
};
$b8b03009035a1e69$export$4773b7ce527dcc8e = $b8b03009035a1e69$var$InlineSuggestionHintsContentWidget_1 = $b8b03009035a1e69$var$__decorate([
    $b8b03009035a1e69$var$__param(6, (0, $8tcMz.ICommandService)),
    $b8b03009035a1e69$var$__param(7, (0, $fdGPu.IInstantiationService)),
    $b8b03009035a1e69$var$__param(8, (0, $7IxGd.IKeybindingService)),
    $b8b03009035a1e69$var$__param(9, (0, $cxCeF.IContextKeyService)),
    $b8b03009035a1e69$var$__param(10, (0, $g4v7E.IMenuService))
], $b8b03009035a1e69$export$4773b7ce527dcc8e);
class $b8b03009035a1e69$var$ActionViewItemWithClassName extends (0, $6nSvp.ActionViewItem) {
    constructor(){
        super(...arguments);
        this._className = undefined;
    }
    setClass(className) {
        this._className = className;
    }
    render(container) {
        super.render(container);
        if (this._className) container.classList.add(this._className);
    }
    updateTooltip() {
    // NOOP, disable tooltip
    }
}
class $b8b03009035a1e69$var$StatusBarViewItem extends (0, $hbDWq.MenuEntryActionViewItem) {
    updateLabel() {
        const kb = this._keybindingService.lookupKeybinding(this._action.id, this._contextKeyService);
        if (!kb) return super.updateLabel();
        if (this.label) {
            const div = (0, $bDzmQ.h)('div.keybinding').root;
            const k = this._register(new (0, $27s0k.KeybindingLabel)(div, (0, $lb0Ah.OS), {
                disableTitle: true,
                ...(0, $27s0k.unthemedKeybindingLabelOptions)
            }));
            k.set(kb);
            this.label.textContent = this._action.label;
            this.label.appendChild(div);
            this.label.classList.add('inlineSuggestionStatusBarItemLabel');
        }
    }
    updateTooltip() {
    // NOOP, disable tooltip
    }
}
let $b8b03009035a1e69$export$d5fdeb440ea8130f = class CustomizedMenuWorkbenchToolBar extends (0, $lNBi4.WorkbenchToolBar) {
    constructor(container, menuId, options2, menuService, contextKeyService, contextMenuService, keybindingService, commandService, telemetryService){
        super(container, {
            resetMenu: menuId,
            ...options2
        }, menuService, contextKeyService, contextMenuService, keybindingService, commandService, telemetryService);
        this.menuId = menuId;
        this.options2 = options2;
        this.menuService = menuService;
        this.contextKeyService = contextKeyService;
        this.menu = this._store.add(this.menuService.createMenu(this.menuId, this.contextKeyService, {
            emitEventsForSubmenuChanges: true
        }));
        this.additionalActions = [];
        this.prependedPrimaryActions = [];
        this._store.add(this.menu.onDidChange(()=>this.updateToolbar()));
        this.updateToolbar();
    }
    updateToolbar() {
        const primary = [];
        const secondary = [];
        (0, $hbDWq.createAndFillInActionBarActions)(this.menu, this.options2?.menuOptions, {
            primary: primary,
            secondary: secondary
        }, this.options2?.toolbarOptions?.primaryGroup, this.options2?.toolbarOptions?.shouldInlineSubmenu, this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions);
        secondary.push(...this.additionalActions);
        primary.unshift(...this.prependedPrimaryActions);
        this.setActions(primary, secondary);
    }
    setPrependedPrimaryActions(actions) {
        if ((0, $kJ8UG.equals)(this.prependedPrimaryActions, actions, (a, b)=>a === b)) return;
        this.prependedPrimaryActions = actions;
        this.updateToolbar();
    }
    setAdditionalSecondaryActions(actions) {
        if ((0, $kJ8UG.equals)(this.additionalActions, actions, (a, b)=>a === b)) return;
        this.additionalActions = actions;
        this.updateToolbar();
    }
};
$b8b03009035a1e69$export$d5fdeb440ea8130f = $b8b03009035a1e69$var$__decorate([
    $b8b03009035a1e69$var$__param(3, (0, $g4v7E.IMenuService)),
    $b8b03009035a1e69$var$__param(4, (0, $cxCeF.IContextKeyService)),
    $b8b03009035a1e69$var$__param(5, (0, $d6K7e.IContextMenuService)),
    $b8b03009035a1e69$var$__param(6, (0, $7IxGd.IKeybindingService)),
    $b8b03009035a1e69$var$__param(7, (0, $8tcMz.ICommandService)),
    $b8b03009035a1e69$var$__param(8, (0, $lMGba.ITelemetryService))
], $b8b03009035a1e69$export$d5fdeb440ea8130f);



var $7IxGd = parcelRequire("7IxGd");

var $6bXyA = parcelRequire("6bXyA");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");
function $d0df60e44163b9d6$export$23bb0db67a9f6e2f(element, posx, posy) {
    const elementRect = $bDzmQ.getDomNodePagePosition(element);
    if (posx < elementRect.left || posx > elementRect.left + elementRect.width || posy < elementRect.top || posy > elementRect.top + elementRect.height) return false;
    return true;
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $9cWcn = parcelRequire("9cWcn");

var $kzNQX = parcelRequire("kzNQX");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");
class $161a8a25a79256cc$export$f0be135662da9b6 {
    constructor(value, isComplete, hasLoadingMessage){
        this.value = value;
        this.isComplete = isComplete;
        this.hasLoadingMessage = hasLoadingMessage;
    }
}
class $161a8a25a79256cc$export$35fb423ab90fde65 extends (0, $9cWcn.Disposable) {
    constructor(_editor, _computer){
        super();
        this._editor = _editor;
        this._computer = _computer;
        this._onResult = this._register(new (0, $5YaSO.Emitter)());
        this.onResult = this._onResult.event;
        this._firstWaitScheduler = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._triggerAsyncComputation(), 0));
        this._secondWaitScheduler = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._triggerSyncComputation(), 0));
        this._loadingMessageScheduler = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._triggerLoadingMessage(), 0));
        this._state = 0 /* HoverOperationState.Idle */ ;
        this._asyncIterable = null;
        this._asyncIterableDone = false;
        this._result = [];
    }
    dispose() {
        if (this._asyncIterable) {
            this._asyncIterable.cancel();
            this._asyncIterable = null;
        }
        super.dispose();
    }
    get _hoverTime() {
        return this._editor.getOption(60 /* EditorOption.hover */ ).delay;
    }
    get _firstWaitTime() {
        return this._hoverTime / 2;
    }
    get _secondWaitTime() {
        return this._hoverTime - this._firstWaitTime;
    }
    get _loadingMessageTime() {
        return 3 * this._hoverTime;
    }
    _setState(state, fireResult = true) {
        this._state = state;
        if (fireResult) this._fireResult();
    }
    _triggerAsyncComputation() {
        this._setState(2 /* HoverOperationState.SecondWait */ );
        this._secondWaitScheduler.schedule(this._secondWaitTime);
        if (this._computer.computeAsync) {
            this._asyncIterableDone = false;
            this._asyncIterable = (0, $6bXyA.createCancelableAsyncIterable)((token)=>this._computer.computeAsync(token));
            (async ()=>{
                try {
                    for await (const item of this._asyncIterable)if (item) {
                        this._result.push(item);
                        this._fireResult();
                    }
                    this._asyncIterableDone = true;
                    if (this._state === 3 /* HoverOperationState.WaitingForAsync */  || this._state === 4 /* HoverOperationState.WaitingForAsyncShowingLoading */ ) this._setState(0 /* HoverOperationState.Idle */ );
                } catch (e) {
                    (0, $gPkHZ.onUnexpectedError)(e);
                }
            })();
        } else this._asyncIterableDone = true;
    }
    _triggerSyncComputation() {
        if (this._computer.computeSync) this._result = this._result.concat(this._computer.computeSync());
        this._setState(this._asyncIterableDone ? 0 /* HoverOperationState.Idle */  : 3 /* HoverOperationState.WaitingForAsync */ );
    }
    _triggerLoadingMessage() {
        if (this._state === 3 /* HoverOperationState.WaitingForAsync */ ) this._setState(4 /* HoverOperationState.WaitingForAsyncShowingLoading */ );
    }
    _fireResult() {
        if (this._state === 1 /* HoverOperationState.FirstWait */  || this._state === 2 /* HoverOperationState.SecondWait */ ) // Do not send out results before the hover time
        return;
        const isComplete = this._state === 0 /* HoverOperationState.Idle */ ;
        const hasLoadingMessage = this._state === 4 /* HoverOperationState.WaitingForAsyncShowingLoading */ ;
        this._onResult.fire(new $161a8a25a79256cc$export$f0be135662da9b6(this._result.slice(0), isComplete, hasLoadingMessage));
    }
    start(mode) {
        if (mode === 0 /* HoverStartMode.Delayed */ ) {
            if (this._state === 0 /* HoverOperationState.Idle */ ) {
                this._setState(1 /* HoverOperationState.FirstWait */ );
                this._firstWaitScheduler.schedule(this._firstWaitTime);
                this._loadingMessageScheduler.schedule(this._loadingMessageTime);
            }
        } else switch(this._state){
            case 0 /* HoverOperationState.Idle */ :
                this._triggerAsyncComputation();
                this._secondWaitScheduler.cancel();
                this._triggerSyncComputation();
                break;
            case 2 /* HoverOperationState.SecondWait */ :
                this._secondWaitScheduler.cancel();
                this._triggerSyncComputation();
                break;
        }
    }
    cancel() {
        this._firstWaitScheduler.cancel();
        this._secondWaitScheduler.cancel();
        this._loadingMessageScheduler.cancel();
        if (this._asyncIterable) {
            this._asyncIterable.cancel();
            this._asyncIterable = null;
        }
        this._result = [];
        this._setState(0 /* HoverOperationState.Idle */ , false);
    }
}




var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $7IxGd = parcelRequire("7IxGd");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $9lxpu = parcelRequire("9lxpu");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");
class $0429f67b71a5cf7d$export$f049a29194943609 {
    constructor(){
        this._onDidWillResize = new (0, $5YaSO.Emitter)();
        this.onDidWillResize = this._onDidWillResize.event;
        this._onDidResize = new (0, $5YaSO.Emitter)();
        this.onDidResize = this._onDidResize.event;
        this._sashListener = new (0, $9cWcn.DisposableStore)();
        this._size = new (0, $bDzmQ.Dimension)(0, 0);
        this._minSize = new (0, $bDzmQ.Dimension)(0, 0);
        this._maxSize = new (0, $bDzmQ.Dimension)(Number.MAX_SAFE_INTEGER, Number.MAX_SAFE_INTEGER);
        this.domNode = document.createElement('div');
        this._eastSash = new (0, $9lxpu.Sash)(this.domNode, {
            getVerticalSashLeft: ()=>this._size.width
        }, {
            orientation: 0 /* Orientation.VERTICAL */ 
        });
        this._westSash = new (0, $9lxpu.Sash)(this.domNode, {
            getVerticalSashLeft: ()=>0
        }, {
            orientation: 0 /* Orientation.VERTICAL */ 
        });
        this._northSash = new (0, $9lxpu.Sash)(this.domNode, {
            getHorizontalSashTop: ()=>0
        }, {
            orientation: 1 /* Orientation.HORIZONTAL */ ,
            orthogonalEdge: (0, $9lxpu.OrthogonalEdge).North
        });
        this._southSash = new (0, $9lxpu.Sash)(this.domNode, {
            getHorizontalSashTop: ()=>this._size.height
        }, {
            orientation: 1 /* Orientation.HORIZONTAL */ ,
            orthogonalEdge: (0, $9lxpu.OrthogonalEdge).South
        });
        this._northSash.orthogonalStartSash = this._westSash;
        this._northSash.orthogonalEndSash = this._eastSash;
        this._southSash.orthogonalStartSash = this._westSash;
        this._southSash.orthogonalEndSash = this._eastSash;
        let currentSize;
        let deltaY = 0;
        let deltaX = 0;
        this._sashListener.add((0, $5YaSO.Event).any(this._northSash.onDidStart, this._eastSash.onDidStart, this._southSash.onDidStart, this._westSash.onDidStart)(()=>{
            if (currentSize === undefined) {
                this._onDidWillResize.fire();
                currentSize = this._size;
                deltaY = 0;
                deltaX = 0;
            }
        }));
        this._sashListener.add((0, $5YaSO.Event).any(this._northSash.onDidEnd, this._eastSash.onDidEnd, this._southSash.onDidEnd, this._westSash.onDidEnd)(()=>{
            if (currentSize !== undefined) {
                currentSize = undefined;
                deltaY = 0;
                deltaX = 0;
                this._onDidResize.fire({
                    dimension: this._size,
                    done: true
                });
            }
        }));
        this._sashListener.add(this._eastSash.onDidChange((e)=>{
            if (currentSize) {
                deltaX = e.currentX - e.startX;
                this.layout(currentSize.height + deltaY, currentSize.width + deltaX);
                this._onDidResize.fire({
                    dimension: this._size,
                    done: false,
                    east: true
                });
            }
        }));
        this._sashListener.add(this._westSash.onDidChange((e)=>{
            if (currentSize) {
                deltaX = -(e.currentX - e.startX);
                this.layout(currentSize.height + deltaY, currentSize.width + deltaX);
                this._onDidResize.fire({
                    dimension: this._size,
                    done: false,
                    west: true
                });
            }
        }));
        this._sashListener.add(this._northSash.onDidChange((e)=>{
            if (currentSize) {
                deltaY = -(e.currentY - e.startY);
                this.layout(currentSize.height + deltaY, currentSize.width + deltaX);
                this._onDidResize.fire({
                    dimension: this._size,
                    done: false,
                    north: true
                });
            }
        }));
        this._sashListener.add(this._southSash.onDidChange((e)=>{
            if (currentSize) {
                deltaY = e.currentY - e.startY;
                this.layout(currentSize.height + deltaY, currentSize.width + deltaX);
                this._onDidResize.fire({
                    dimension: this._size,
                    done: false,
                    south: true
                });
            }
        }));
        this._sashListener.add((0, $5YaSO.Event).any(this._eastSash.onDidReset, this._westSash.onDidReset)((e)=>{
            if (this._preferredSize) {
                this.layout(this._size.height, this._preferredSize.width);
                this._onDidResize.fire({
                    dimension: this._size,
                    done: true
                });
            }
        }));
        this._sashListener.add((0, $5YaSO.Event).any(this._northSash.onDidReset, this._southSash.onDidReset)((e)=>{
            if (this._preferredSize) {
                this.layout(this._preferredSize.height, this._size.width);
                this._onDidResize.fire({
                    dimension: this._size,
                    done: true
                });
            }
        }));
    }
    dispose() {
        this._northSash.dispose();
        this._southSash.dispose();
        this._eastSash.dispose();
        this._westSash.dispose();
        this._sashListener.dispose();
        this._onDidResize.dispose();
        this._onDidWillResize.dispose();
        this.domNode.remove();
    }
    enableSashes(north, east, south, west) {
        this._northSash.state = north ? 3 /* SashState.Enabled */  : 0 /* SashState.Disabled */ ;
        this._eastSash.state = east ? 3 /* SashState.Enabled */  : 0 /* SashState.Disabled */ ;
        this._southSash.state = south ? 3 /* SashState.Enabled */  : 0 /* SashState.Disabled */ ;
        this._westSash.state = west ? 3 /* SashState.Enabled */  : 0 /* SashState.Disabled */ ;
    }
    layout(height = this.size.height, width = this.size.width) {
        const { height: minHeight, width: minWidth } = this._minSize;
        const { height: maxHeight, width: maxWidth } = this._maxSize;
        height = Math.max(minHeight, Math.min(maxHeight, height));
        width = Math.max(minWidth, Math.min(maxWidth, width));
        const newSize = new (0, $bDzmQ.Dimension)(width, height);
        if (!(0, $bDzmQ.Dimension).equals(newSize, this._size)) {
            this.domNode.style.height = height + 'px';
            this.domNode.style.width = width + 'px';
            this._size = newSize;
            this._northSash.layout();
            this._eastSash.layout();
            this._southSash.layout();
            this._westSash.layout();
        }
    }
    clearSashHoverState() {
        this._eastSash.clearSashHoverState();
        this._westSash.clearSashHoverState();
        this._northSash.clearSashHoverState();
        this._southSash.clearSashHoverState();
    }
    get size() {
        return this._size;
    }
    set maxSize(value) {
        this._maxSize = value;
    }
    get maxSize() {
        return this._maxSize;
    }
    set minSize(value) {
        this._minSize = value;
    }
    get minSize() {
        return this._minSize;
    }
    set preferredSize(value) {
        this._preferredSize = value;
    }
    get preferredSize() {
        return this._preferredSize;
    }
}



var $9cWcn = parcelRequire("9cWcn");

var $dcxQ7 = parcelRequire("dcxQ7");

var $bDzmQ = parcelRequire("bDzmQ");
const $2f0ac757048a03be$var$TOP_HEIGHT = 30;
const $2f0ac757048a03be$var$BOTTOM_HEIGHT = 24;
class $2f0ac757048a03be$export$5253761ad807500 extends (0, $9cWcn.Disposable) {
    constructor(_editor, minimumSize = new $bDzmQ.Dimension(10, 10)){
        super();
        this._editor = _editor;
        this.allowEditorOverflow = true;
        this.suppressMouseDown = false;
        this._resizableNode = this._register(new (0, $0429f67b71a5cf7d$export$f049a29194943609)());
        this._contentPosition = null;
        this._isResizing = false;
        this._resizableNode.domNode.style.position = 'absolute';
        this._resizableNode.minSize = $bDzmQ.Dimension.lift(minimumSize);
        this._resizableNode.layout(minimumSize.height, minimumSize.width);
        this._resizableNode.enableSashes(true, true, true, true);
        this._register(this._resizableNode.onDidResize((e)=>{
            this._resize(new $bDzmQ.Dimension(e.dimension.width, e.dimension.height));
            if (e.done) this._isResizing = false;
        }));
        this._register(this._resizableNode.onDidWillResize(()=>{
            this._isResizing = true;
        }));
    }
    get isResizing() {
        return this._isResizing;
    }
    getDomNode() {
        return this._resizableNode.domNode;
    }
    getPosition() {
        return this._contentPosition;
    }
    get position() {
        return this._contentPosition?.position ? (0, $dcxQ7.Position).lift(this._contentPosition.position) : undefined;
    }
    _availableVerticalSpaceAbove(position) {
        const editorDomNode = this._editor.getDomNode();
        const mouseBox = this._editor.getScrolledVisiblePosition(position);
        if (!editorDomNode || !mouseBox) return;
        const editorBox = $bDzmQ.getDomNodePagePosition(editorDomNode);
        return editorBox.top + mouseBox.top - $2f0ac757048a03be$var$TOP_HEIGHT;
    }
    _availableVerticalSpaceBelow(position) {
        const editorDomNode = this._editor.getDomNode();
        const mouseBox = this._editor.getScrolledVisiblePosition(position);
        if (!editorDomNode || !mouseBox) return;
        const editorBox = $bDzmQ.getDomNodePagePosition(editorDomNode);
        const bodyBox = $bDzmQ.getClientArea(editorDomNode.ownerDocument.body);
        const mouseBottom = editorBox.top + mouseBox.top + mouseBox.height;
        return bodyBox.height - mouseBottom - $2f0ac757048a03be$var$BOTTOM_HEIGHT;
    }
    _findPositionPreference(widgetHeight, showAtPosition) {
        const maxHeightBelow = Math.min(this._availableVerticalSpaceBelow(showAtPosition) ?? Infinity, widgetHeight);
        const maxHeightAbove = Math.min(this._availableVerticalSpaceAbove(showAtPosition) ?? Infinity, widgetHeight);
        const maxHeight = Math.min(Math.max(maxHeightAbove, maxHeightBelow), widgetHeight);
        const height = Math.min(widgetHeight, maxHeight);
        let renderingAbove;
        if (this._editor.getOption(60 /* EditorOption.hover */ ).above) renderingAbove = height <= maxHeightAbove ? 1 /* ContentWidgetPositionPreference.ABOVE */  : 2 /* ContentWidgetPositionPreference.BELOW */ ;
        else renderingAbove = height <= maxHeightBelow ? 2 /* ContentWidgetPositionPreference.BELOW */  : 1 /* ContentWidgetPositionPreference.ABOVE */ ;
        if (renderingAbove === 1 /* ContentWidgetPositionPreference.ABOVE */ ) this._resizableNode.enableSashes(true, true, false, false);
        else this._resizableNode.enableSashes(false, true, true, false);
        return renderingAbove;
    }
    _resize(dimension) {
        this._resizableNode.layout(dimension.height, dimension.width);
    }
}



var $cxCeF = parcelRequire("cxCeF");

var $35IZ9 = parcelRequire("35IZ9");

var $gjaQN = parcelRequire("gjaQN");

var $ibKGQ = parcelRequire("ibKGQ");

var $jsiuM = parcelRequire("jsiuM");

var $5YaSO = parcelRequire("5YaSO");
var $135295b01e910bfa$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $135295b01e910bfa$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $135295b01e910bfa$var$ContentHoverWidget_1;
const $135295b01e910bfa$var$HORIZONTAL_SCROLLING_BY = 30;
const $135295b01e910bfa$var$CONTAINER_HEIGHT_PADDING = 6;
let $135295b01e910bfa$export$ea089e382ccfc912 = class ContentHoverWidget extends (0, $2f0ac757048a03be$export$5253761ad807500) {
    static{
        $135295b01e910bfa$var$ContentHoverWidget_1 = this;
    }
    static{
        this.ID = 'editor.contrib.resizableContentHoverWidget';
    }
    static{
        this._lastDimensions = new $bDzmQ.Dimension(0, 0);
    }
    get isVisibleFromKeyboard() {
        return this._renderedHover?.source === 1 /* HoverStartSource.Keyboard */ ;
    }
    get isVisible() {
        return this._hoverVisibleKey.get() ?? false;
    }
    get isFocused() {
        return this._hoverFocusedKey.get() ?? false;
    }
    constructor(editor, contextKeyService, _configurationService, _accessibilityService, _keybindingService){
        const minimumHeight = editor.getOption(67 /* EditorOption.lineHeight */ ) + 8;
        const minimumWidth = 150;
        const minimumSize = new $bDzmQ.Dimension(minimumWidth, minimumHeight);
        super(editor, minimumSize);
        this._configurationService = _configurationService;
        this._accessibilityService = _accessibilityService;
        this._keybindingService = _keybindingService;
        this._hover = this._register(new (0, $jsiuM.HoverWidget)());
        this._onDidResize = this._register(new (0, $5YaSO.Emitter)());
        this.onDidResize = this._onDidResize.event;
        this._minimumSize = minimumSize;
        this._hoverVisibleKey = (0, $ibKGQ.EditorContextKeys).hoverVisible.bindTo(contextKeyService);
        this._hoverFocusedKey = (0, $ibKGQ.EditorContextKeys).hoverFocused.bindTo(contextKeyService);
        $bDzmQ.append(this._resizableNode.domNode, this._hover.containerDomNode);
        this._resizableNode.domNode.style.zIndex = '50';
        this._register(this._editor.onDidLayoutChange(()=>{
            if (this.isVisible) this._updateMaxDimensions();
        }));
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(50 /* EditorOption.fontInfo */ )) this._updateFont();
        }));
        const focusTracker = this._register($bDzmQ.trackFocus(this._resizableNode.domNode));
        this._register(focusTracker.onDidFocus(()=>{
            this._hoverFocusedKey.set(true);
        }));
        this._register(focusTracker.onDidBlur(()=>{
            this._hoverFocusedKey.set(false);
        }));
        this._setRenderedHover(undefined);
        this._editor.addContentWidget(this);
    }
    dispose() {
        super.dispose();
        this._renderedHover?.dispose();
        this._editor.removeContentWidget(this);
    }
    getId() {
        return $135295b01e910bfa$var$ContentHoverWidget_1.ID;
    }
    static _applyDimensions(container, width, height) {
        const transformedWidth = typeof width === 'number' ? `${width}px` : width;
        const transformedHeight = typeof height === 'number' ? `${height}px` : height;
        container.style.width = transformedWidth;
        container.style.height = transformedHeight;
    }
    _setContentsDomNodeDimensions(width, height) {
        const contentsDomNode = this._hover.contentsDomNode;
        return $135295b01e910bfa$var$ContentHoverWidget_1._applyDimensions(contentsDomNode, width, height);
    }
    _setContainerDomNodeDimensions(width, height) {
        const containerDomNode = this._hover.containerDomNode;
        return $135295b01e910bfa$var$ContentHoverWidget_1._applyDimensions(containerDomNode, width, height);
    }
    _setHoverWidgetDimensions(width, height) {
        this._setContentsDomNodeDimensions(width, height);
        this._setContainerDomNodeDimensions(width, height);
        this._layoutContentWidget();
    }
    static _applyMaxDimensions(container, width, height) {
        const transformedWidth = typeof width === 'number' ? `${width}px` : width;
        const transformedHeight = typeof height === 'number' ? `${height}px` : height;
        container.style.maxWidth = transformedWidth;
        container.style.maxHeight = transformedHeight;
    }
    _setHoverWidgetMaxDimensions(width, height) {
        $135295b01e910bfa$var$ContentHoverWidget_1._applyMaxDimensions(this._hover.contentsDomNode, width, height);
        $135295b01e910bfa$var$ContentHoverWidget_1._applyMaxDimensions(this._hover.containerDomNode, width, height);
        this._hover.containerDomNode.style.setProperty('--vscode-hover-maxWidth', typeof width === 'number' ? `${width}px` : width);
        this._layoutContentWidget();
    }
    _setAdjustedHoverWidgetDimensions(size) {
        this._setHoverWidgetMaxDimensions('none', 'none');
        const width = size.width;
        const height = size.height;
        this._setHoverWidgetDimensions(width, height);
    }
    _updateResizableNodeMaxDimensions() {
        const maxRenderingWidth = this._findMaximumRenderingWidth() ?? Infinity;
        const maxRenderingHeight = this._findMaximumRenderingHeight() ?? Infinity;
        this._resizableNode.maxSize = new $bDzmQ.Dimension(maxRenderingWidth, maxRenderingHeight);
        this._setHoverWidgetMaxDimensions(maxRenderingWidth, maxRenderingHeight);
    }
    _resize(size) {
        $135295b01e910bfa$var$ContentHoverWidget_1._lastDimensions = new $bDzmQ.Dimension(size.width, size.height);
        this._setAdjustedHoverWidgetDimensions(size);
        this._resizableNode.layout(size.height, size.width);
        this._updateResizableNodeMaxDimensions();
        this._hover.scrollbar.scanDomNode();
        this._editor.layoutContentWidget(this);
        this._onDidResize.fire();
    }
    _findAvailableSpaceVertically() {
        const position = this._renderedHover?.showAtPosition;
        if (!position) return;
        return this._positionPreference === 1 /* ContentWidgetPositionPreference.ABOVE */  ? this._availableVerticalSpaceAbove(position) : this._availableVerticalSpaceBelow(position);
    }
    _findMaximumRenderingHeight() {
        const availableSpace = this._findAvailableSpaceVertically();
        if (!availableSpace) return;
        // Padding needed in order to stop the resizing down to a smaller height
        let maximumHeight = $135295b01e910bfa$var$CONTAINER_HEIGHT_PADDING;
        Array.from(this._hover.contentsDomNode.children).forEach((hoverPart)=>{
            maximumHeight += hoverPart.clientHeight;
        });
        return Math.min(availableSpace, maximumHeight);
    }
    _isHoverTextOverflowing() {
        // To find out if the text is overflowing, we will disable wrapping, check the widths, and then re-enable wrapping
        this._hover.containerDomNode.style.setProperty('--vscode-hover-whiteSpace', 'nowrap');
        this._hover.containerDomNode.style.setProperty('--vscode-hover-sourceWhiteSpace', 'nowrap');
        const overflowing = Array.from(this._hover.contentsDomNode.children).some((hoverElement)=>{
            return hoverElement.scrollWidth > hoverElement.clientWidth;
        });
        this._hover.containerDomNode.style.removeProperty('--vscode-hover-whiteSpace');
        this._hover.containerDomNode.style.removeProperty('--vscode-hover-sourceWhiteSpace');
        return overflowing;
    }
    _findMaximumRenderingWidth() {
        if (!this._editor || !this._editor.hasModel()) return;
        const overflowing = this._isHoverTextOverflowing();
        const initialWidth = typeof this._contentWidth === 'undefined' ? 0 : this._contentWidth - 2 // - 2 for the borders
        ;
        if (overflowing || this._hover.containerDomNode.clientWidth < initialWidth) {
            const bodyBoxWidth = $bDzmQ.getClientArea(this._hover.containerDomNode.ownerDocument.body).width;
            const horizontalPadding = 14;
            return bodyBoxWidth - horizontalPadding;
        } else return this._hover.containerDomNode.clientWidth + 2;
    }
    isMouseGettingCloser(posx, posy) {
        if (!this._renderedHover) return false;
        if (this._renderedHover.initialMousePosX === undefined || this._renderedHover.initialMousePosY === undefined) {
            this._renderedHover.initialMousePosX = posx;
            this._renderedHover.initialMousePosY = posy;
            return false;
        }
        const widgetRect = $bDzmQ.getDomNodePagePosition(this.getDomNode());
        if (this._renderedHover.closestMouseDistance === undefined) this._renderedHover.closestMouseDistance = $135295b01e910bfa$var$computeDistanceFromPointToRectangle(this._renderedHover.initialMousePosX, this._renderedHover.initialMousePosY, widgetRect.left, widgetRect.top, widgetRect.width, widgetRect.height);
        const distance = $135295b01e910bfa$var$computeDistanceFromPointToRectangle(posx, posy, widgetRect.left, widgetRect.top, widgetRect.width, widgetRect.height);
        if (distance > this._renderedHover.closestMouseDistance + 4 /* tolerance of 4 pixels */ ) // The mouse is getting farther away
        return false;
        this._renderedHover.closestMouseDistance = Math.min(this._renderedHover.closestMouseDistance, distance);
        return true;
    }
    _setRenderedHover(renderedHover) {
        this._renderedHover?.dispose();
        this._renderedHover = renderedHover;
        this._hoverVisibleKey.set(!!renderedHover);
        this._hover.containerDomNode.classList.toggle('hidden', !renderedHover);
    }
    _updateFont() {
        const { fontSize: fontSize, lineHeight: lineHeight } = this._editor.getOption(50 /* EditorOption.fontInfo */ );
        const contentsDomNode = this._hover.contentsDomNode;
        contentsDomNode.style.fontSize = `${fontSize}px`;
        contentsDomNode.style.lineHeight = `${lineHeight / fontSize}`;
        const codeClasses = Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName('code'));
        codeClasses.forEach((node)=>this._editor.applyFontInfo(node));
    }
    _updateContent(node) {
        const contentsDomNode = this._hover.contentsDomNode;
        contentsDomNode.style.paddingBottom = '';
        contentsDomNode.textContent = '';
        contentsDomNode.appendChild(node);
    }
    _layoutContentWidget() {
        this._editor.layoutContentWidget(this);
        this._hover.onContentsChanged();
    }
    _updateMaxDimensions() {
        const height = Math.max(this._editor.getLayoutInfo().height / 4, 250, $135295b01e910bfa$var$ContentHoverWidget_1._lastDimensions.height);
        const width = Math.max(this._editor.getLayoutInfo().width * 0.66, 500, $135295b01e910bfa$var$ContentHoverWidget_1._lastDimensions.width);
        this._setHoverWidgetMaxDimensions(width, height);
    }
    _render(renderedHover) {
        this._setRenderedHover(renderedHover);
        this._updateFont();
        this._updateContent(renderedHover.domNode);
        this._updateMaxDimensions();
        this.onContentsChanged();
        // Simply force a synchronous render on the editor
        // such that the widget does not really render with left = '0px'
        this._editor.render();
    }
    getPosition() {
        if (!this._renderedHover) return null;
        return {
            position: this._renderedHover.showAtPosition,
            secondaryPosition: this._renderedHover.showAtSecondaryPosition,
            positionAffinity: this._renderedHover.shouldAppearBeforeContent ? 3 /* PositionAffinity.LeftOfInjectedText */  : undefined,
            preference: [
                this._positionPreference ?? 1 /* ContentWidgetPositionPreference.ABOVE */ 
            ]
        };
    }
    show(renderedHover) {
        if (!this._editor || !this._editor.hasModel()) return;
        this._render(renderedHover);
        const widgetHeight = $bDzmQ.getTotalHeight(this._hover.containerDomNode);
        const widgetPosition = renderedHover.showAtPosition;
        this._positionPreference = this._findPositionPreference(widgetHeight, widgetPosition) ?? 1 /* ContentWidgetPositionPreference.ABOVE */ ;
        // See https://github.com/microsoft/vscode/issues/140339
        // TODO: Doing a second layout of the hover after force rendering the editor
        this.onContentsChanged();
        if (renderedHover.shouldFocus) this._hover.containerDomNode.focus();
        this._onDidResize.fire();
        // The aria label overrides the label, so if we add to it, add the contents of the hover
        const hoverFocused = this._hover.containerDomNode.ownerDocument.activeElement === this._hover.containerDomNode;
        const accessibleViewHint = hoverFocused && (0, $jsiuM.getHoverAccessibleViewHint)(this._configurationService.getValue('accessibility.verbosity.hover') === true && this._accessibilityService.isScreenReaderOptimized(), this._keybindingService.lookupKeybinding('editor.action.accessibleView')?.getAriaLabel() ?? '');
        if (accessibleViewHint) this._hover.contentsDomNode.ariaLabel = this._hover.contentsDomNode.textContent + ', ' + accessibleViewHint;
    }
    hide() {
        if (!this._renderedHover) return;
        const hoverStoleFocus = this._renderedHover.shouldFocus || this._hoverFocusedKey.get();
        this._setRenderedHover(undefined);
        this._resizableNode.maxSize = new $bDzmQ.Dimension(Infinity, Infinity);
        this._resizableNode.clearSashHoverState();
        this._hoverFocusedKey.set(false);
        this._editor.layoutContentWidget(this);
        if (hoverStoleFocus) this._editor.focus();
    }
    _removeConstraintsRenderNormally() {
        // Added because otherwise the initial size of the hover content is smaller than should be
        const layoutInfo = this._editor.getLayoutInfo();
        this._resizableNode.layout(layoutInfo.height, layoutInfo.width);
        this._setHoverWidgetDimensions('auto', 'auto');
    }
    setMinimumDimensions(dimensions) {
        // We combine the new minimum dimensions with the previous ones
        this._minimumSize = new $bDzmQ.Dimension(Math.max(this._minimumSize.width, dimensions.width), Math.max(this._minimumSize.height, dimensions.height));
        this._updateMinimumWidth();
    }
    _updateMinimumWidth() {
        const width = typeof this._contentWidth === 'undefined' ? this._minimumSize.width : Math.min(this._contentWidth, this._minimumSize.width);
        // We want to avoid that the hover is artificially large, so we use the content width as minimum width
        this._resizableNode.minSize = new $bDzmQ.Dimension(width, this._minimumSize.height);
    }
    onContentsChanged() {
        this._removeConstraintsRenderNormally();
        const containerDomNode = this._hover.containerDomNode;
        let height = $bDzmQ.getTotalHeight(containerDomNode);
        let width = $bDzmQ.getTotalWidth(containerDomNode);
        this._resizableNode.layout(height, width);
        this._setHoverWidgetDimensions(width, height);
        height = $bDzmQ.getTotalHeight(containerDomNode);
        width = $bDzmQ.getTotalWidth(containerDomNode);
        this._contentWidth = width;
        this._updateMinimumWidth();
        this._resizableNode.layout(height, width);
        if (this._renderedHover?.showAtPosition) {
            const widgetHeight = $bDzmQ.getTotalHeight(this._hover.containerDomNode);
            this._positionPreference = this._findPositionPreference(widgetHeight, this._renderedHover.showAtPosition);
        }
        this._layoutContentWidget();
    }
    focus() {
        this._hover.containerDomNode.focus();
    }
    scrollUp() {
        const scrollTop = this._hover.scrollbar.getScrollPosition().scrollTop;
        const fontInfo = this._editor.getOption(50 /* EditorOption.fontInfo */ );
        this._hover.scrollbar.setScrollPosition({
            scrollTop: scrollTop - fontInfo.lineHeight
        });
    }
    scrollDown() {
        const scrollTop = this._hover.scrollbar.getScrollPosition().scrollTop;
        const fontInfo = this._editor.getOption(50 /* EditorOption.fontInfo */ );
        this._hover.scrollbar.setScrollPosition({
            scrollTop: scrollTop + fontInfo.lineHeight
        });
    }
    scrollLeft() {
        const scrollLeft = this._hover.scrollbar.getScrollPosition().scrollLeft;
        this._hover.scrollbar.setScrollPosition({
            scrollLeft: scrollLeft - $135295b01e910bfa$var$HORIZONTAL_SCROLLING_BY
        });
    }
    scrollRight() {
        const scrollLeft = this._hover.scrollbar.getScrollPosition().scrollLeft;
        this._hover.scrollbar.setScrollPosition({
            scrollLeft: scrollLeft + $135295b01e910bfa$var$HORIZONTAL_SCROLLING_BY
        });
    }
    pageUp() {
        const scrollTop = this._hover.scrollbar.getScrollPosition().scrollTop;
        const scrollHeight = this._hover.scrollbar.getScrollDimensions().height;
        this._hover.scrollbar.setScrollPosition({
            scrollTop: scrollTop - scrollHeight
        });
    }
    pageDown() {
        const scrollTop = this._hover.scrollbar.getScrollPosition().scrollTop;
        const scrollHeight = this._hover.scrollbar.getScrollDimensions().height;
        this._hover.scrollbar.setScrollPosition({
            scrollTop: scrollTop + scrollHeight
        });
    }
    goToTop() {
        this._hover.scrollbar.setScrollPosition({
            scrollTop: 0
        });
    }
    goToBottom() {
        this._hover.scrollbar.setScrollPosition({
            scrollTop: this._hover.scrollbar.getScrollDimensions().scrollHeight
        });
    }
};
$135295b01e910bfa$export$ea089e382ccfc912 = $135295b01e910bfa$var$ContentHoverWidget_1 = $135295b01e910bfa$var$__decorate([
    $135295b01e910bfa$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $135295b01e910bfa$var$__param(2, (0, $35IZ9.IConfigurationService)),
    $135295b01e910bfa$var$__param(3, (0, $gjaQN.IAccessibilityService)),
    $135295b01e910bfa$var$__param(4, (0, $7IxGd.IKeybindingService))
], $135295b01e910bfa$export$ea089e382ccfc912);
function $135295b01e910bfa$var$computeDistanceFromPointToRectangle(pointX, pointY, left, top, width, height) {
    const x = left + width / 2; // x center of rectangle
    const y = top + height / 2; // y center of rectangle
    const dx = Math.max(Math.abs(pointX - x) - width / 2, 0);
    const dy = Math.max(Math.abs(pointY - y) - height / 2, 0);
    return Math.sqrt(dx * dx + dy * dy);
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");
class $8d5623b7ba9c7d0d$export$ffa69eebf1b99b98 {
    get anchor() {
        return this._anchor;
    }
    set anchor(value) {
        this._anchor = value;
    }
    get shouldFocus() {
        return this._shouldFocus;
    }
    set shouldFocus(value) {
        this._shouldFocus = value;
    }
    get source() {
        return this._source;
    }
    set source(value) {
        this._source = value;
    }
    get insistOnKeepingHoverVisible() {
        return this._insistOnKeepingHoverVisible;
    }
    set insistOnKeepingHoverVisible(value) {
        this._insistOnKeepingHoverVisible = value;
    }
    constructor(_editor, _participants){
        this._editor = _editor;
        this._participants = _participants;
        this._anchor = null;
        this._shouldFocus = false;
        this._source = 0 /* HoverStartSource.Mouse */ ;
        this._insistOnKeepingHoverVisible = false;
    }
    static _getLineDecorations(editor, anchor) {
        if (anchor.type !== 1 /* HoverAnchorType.Range */  && !anchor.supportsMarkerHover) return [];
        const model = editor.getModel();
        const lineNumber = anchor.range.startLineNumber;
        if (lineNumber > model.getLineCount()) // invalid line
        return [];
        const maxColumn = model.getLineMaxColumn(lineNumber);
        return editor.getLineDecorations(lineNumber).filter((d)=>{
            if (d.options.isWholeLine) return true;
            const startColumn = d.range.startLineNumber === lineNumber ? d.range.startColumn : 1;
            const endColumn = d.range.endLineNumber === lineNumber ? d.range.endColumn : maxColumn;
            if (d.options.showIfCollapsed) {
                // Relax check around `showIfCollapsed` decorations to also include +/- 1 character
                if (startColumn > anchor.range.startColumn + 1 || anchor.range.endColumn - 1 > endColumn) return false;
            } else {
                if (startColumn > anchor.range.startColumn || anchor.range.endColumn > endColumn) return false;
            }
            return true;
        });
    }
    computeAsync(token) {
        const anchor = this._anchor;
        if (!this._editor.hasModel() || !anchor) return (0, $6bXyA.AsyncIterableObject).EMPTY;
        const lineDecorations = $8d5623b7ba9c7d0d$export$ffa69eebf1b99b98._getLineDecorations(this._editor, anchor);
        return (0, $6bXyA.AsyncIterableObject).merge(this._participants.map((participant)=>{
            if (!participant.computeAsync) return (0, $6bXyA.AsyncIterableObject).EMPTY;
            return participant.computeAsync(anchor, lineDecorations, token);
        }));
    }
    computeSync() {
        if (!this._editor.hasModel() || !this._anchor) return [];
        const lineDecorations = $8d5623b7ba9c7d0d$export$ffa69eebf1b99b98._getLineDecorations(this._editor, this._anchor);
        let result = [];
        for (const participant of this._participants)result = result.concat(participant.computeSync(this._anchor, lineDecorations));
        return (0, $kJ8UG.coalesce)(result);
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ class $dbb6eb9d9c9f17dc$export$f0be135662da9b6 {
    constructor(anchor, hoverParts, isComplete){
        this.anchor = anchor;
        this.hoverParts = hoverParts;
        this.isComplete = isComplete;
    }
    filter(anchor) {
        const filteredHoverParts = this.hoverParts.filter((m)=>m.isValidForHoverAnchor(anchor));
        if (filteredHoverParts.length === this.hoverParts.length) return this;
        return new $dbb6eb9d9c9f17dc$export$36bb0f15b7147b23(this, this.anchor, filteredHoverParts, this.isComplete);
    }
}
class $dbb6eb9d9c9f17dc$export$36bb0f15b7147b23 extends $dbb6eb9d9c9f17dc$export$f0be135662da9b6 {
    constructor(original, anchor, messages, isComplete){
        super(anchor, messages, isComplete);
        this.original = original;
    }
    filter(anchor) {
        return this.original.filter(anchor);
    }
}



var $5YaSO = parcelRequire("5YaSO");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $9cWcn = parcelRequire("9cWcn");

var $bDzmQ = parcelRequire("bDzmQ");

var $jsiuM = parcelRequire("jsiuM");

var $9cWcn = parcelRequire("9cWcn");

var $7IxGd = parcelRequire("7IxGd");
var $9559ba32f7b69229$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $9559ba32f7b69229$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $9559ba32f7b69229$var$$ = $bDzmQ.$;
let $9559ba32f7b69229$export$b3dad84b67c8b2c0 = class EditorHoverStatusBar extends (0, $9cWcn.Disposable) {
    get hasContent() {
        return this._hasContent;
    }
    constructor(_keybindingService){
        super();
        this._keybindingService = _keybindingService;
        this.actions = [];
        this._hasContent = false;
        this.hoverElement = $9559ba32f7b69229$var$$('div.hover-row.status-bar');
        this.hoverElement.tabIndex = 0;
        this.actionsElement = $bDzmQ.append(this.hoverElement, $9559ba32f7b69229$var$$('div.actions'));
    }
    addAction(actionOptions) {
        const keybinding = this._keybindingService.lookupKeybinding(actionOptions.commandId);
        const keybindingLabel = keybinding ? keybinding.getLabel() : null;
        this._hasContent = true;
        const action = this._register((0, $jsiuM.HoverAction).render(this.actionsElement, actionOptions, keybindingLabel));
        this.actions.push(action);
        return action;
    }
    append(element) {
        const result = $bDzmQ.append(this.actionsElement, element);
        this._hasContent = true;
        return result;
    }
};
$9559ba32f7b69229$export$b3dad84b67c8b2c0 = $9559ba32f7b69229$var$__decorate([
    $9559ba32f7b69229$var$__param(0, (0, $7IxGd.IKeybindingService))
], $9559ba32f7b69229$export$b3dad84b67c8b2c0);



var $91ntV = parcelRequire("91ntV");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $bDzmQ = parcelRequire("bDzmQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");

var $1vDLP = parcelRequire("1vDLP");


var $d00il = parcelRequire("d00il");

var $h9Xpp = parcelRequire("h9Xpp");


var $4dEdH = parcelRequire("4dEdH");

var $35IZ9 = parcelRequire("35IZ9");

var $iAi3o = parcelRequire("iAi3o");

var $4J6fu = parcelRequire("4J6fu");

var $kzNQX = parcelRequire("kzNQX");

var $hEsmQ = parcelRequire("hEsmQ");

var $awgRE = parcelRequire("awgRE");

var $5rADe = parcelRequire("5rADe");

var $gPkHZ = parcelRequire("gPkHZ");

var $7IxGd = parcelRequire("7IxGd");

var $jsiuM = parcelRequire("jsiuM");

var $lc5DL = parcelRequire("lc5DL");

var $6bXyA = parcelRequire("6bXyA");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $2iJTi = parcelRequire("2iJTi");

var $4J6fu = parcelRequire("4J6fu");
class $f5c90efe5bc3f5fb$export$b4cb00c725d0d256 {
    constructor(provider, hover, ordinal){
        this.provider = provider;
        this.hover = hover;
        this.ordinal = ordinal;
    }
}
/**
 * Does not throw or return a rejected promise (returns undefined instead).
 */ async function $f5c90efe5bc3f5fb$var$executeProvider(provider, ordinal, model, position, token) {
    const result = await Promise.resolve(provider.provideHover(model, position, token)).catch((0, $gPkHZ.onUnexpectedExternalError));
    if (!result || !$f5c90efe5bc3f5fb$var$isValid(result)) return undefined;
    return new $f5c90efe5bc3f5fb$export$b4cb00c725d0d256(provider, result, ordinal);
}
function $f5c90efe5bc3f5fb$export$fe317e31968a65d8(registry, model, position, token, recursive = false) {
    const providers = registry.ordered(model, recursive);
    const promises = providers.map((provider, index)=>$f5c90efe5bc3f5fb$var$executeProvider(provider, index, model, position, token));
    return (0, $6bXyA.AsyncIterableObject).fromPromises(promises).coalesce();
}
function $f5c90efe5bc3f5fb$export$55b5cb08220427af(registry, model, position, token, recursive = false) {
    return $f5c90efe5bc3f5fb$export$fe317e31968a65d8(registry, model, position, token, recursive).map((item)=>item.hover).toPromise();
}
(0, $2iJTi.registerModelAndPositionCommand)('_executeHoverProvider', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    return $f5c90efe5bc3f5fb$export$55b5cb08220427af(languageFeaturesService.hoverProvider, model, position, (0, $giPcZ.CancellationToken).None);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeHoverProvider_recursive', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    return $f5c90efe5bc3f5fb$export$55b5cb08220427af(languageFeaturesService.hoverProvider, model, position, (0, $giPcZ.CancellationToken).None, true);
});
function $f5c90efe5bc3f5fb$var$isValid(result) {
    const hasRange = typeof result.range !== 'undefined';
    const hasHtmlContent = typeof result.contents !== 'undefined' && result.contents && result.contents.length > 0;
    return hasRange && hasHtmlContent;
}



var $8tcMz = parcelRequire("8tcMz");
var $9195b2d03426c505$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $9195b2d03426c505$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $9195b2d03426c505$var$$ = $bDzmQ.$;
const $9195b2d03426c505$var$increaseHoverVerbosityIcon = (0, $hEsmQ.registerIcon)('hover-increase-verbosity', (0, $awgRE.Codicon).add, $4dEdH.localize('increaseHoverVerbosity', 'Icon for increaseing hover verbosity.'));
const $9195b2d03426c505$var$decreaseHoverVerbosityIcon = (0, $hEsmQ.registerIcon)('hover-decrease-verbosity', (0, $awgRE.Codicon).remove, $4dEdH.localize('decreaseHoverVerbosity', 'Icon for decreasing hover verbosity.'));
class $9195b2d03426c505$export$de5210377542b3f9 {
    constructor(owner, range, contents, isBeforeContent, ordinal, source){
        this.owner = owner;
        this.range = range;
        this.contents = contents;
        this.isBeforeContent = isBeforeContent;
        this.ordinal = ordinal;
        this.source = source;
    }
    isValidForHoverAnchor(anchor) {
        return anchor.type === 1 /* HoverAnchorType.Range */  && this.range.startColumn <= anchor.range.startColumn && this.range.endColumn >= anchor.range.endColumn;
    }
}
class $9195b2d03426c505$var$HoverSource {
    constructor(hover, hoverProvider, hoverPosition){
        this.hover = hover;
        this.hoverProvider = hoverProvider;
        this.hoverPosition = hoverPosition;
    }
    supportsVerbosityAction(hoverVerbosityAction) {
        switch(hoverVerbosityAction){
            case (0, $kzNQX.HoverVerbosityAction).Increase:
                return this.hover.canIncreaseVerbosity ?? false;
            case (0, $kzNQX.HoverVerbosityAction).Decrease:
                return this.hover.canDecreaseVerbosity ?? false;
        }
    }
}
let $9195b2d03426c505$export$db7233c4b0ae81a2 = class MarkdownHoverParticipant {
    constructor(_editor, _languageService, _openerService, _configurationService, _languageFeaturesService, _keybindingService, _hoverService, _commandService){
        this._editor = _editor;
        this._languageService = _languageService;
        this._openerService = _openerService;
        this._configurationService = _configurationService;
        this._languageFeaturesService = _languageFeaturesService;
        this._keybindingService = _keybindingService;
        this._hoverService = _hoverService;
        this._commandService = _commandService;
        this.hoverOrdinal = 3;
    }
    createLoadingMessage(anchor) {
        return new $9195b2d03426c505$export$de5210377542b3f9(this, anchor.range, [
            new (0, $iGmb0.MarkdownString)().appendText($4dEdH.localize('modesContentHover.loading', "Loading..."))
        ], false, 2000);
    }
    computeSync(anchor, lineDecorations) {
        if (!this._editor.hasModel() || anchor.type !== 1 /* HoverAnchorType.Range */ ) return [];
        const model = this._editor.getModel();
        const lineNumber = anchor.range.startLineNumber;
        const maxColumn = model.getLineMaxColumn(lineNumber);
        const result = [];
        let index = 1000;
        const lineLength = model.getLineLength(lineNumber);
        const languageId = model.getLanguageIdAtPosition(anchor.range.startLineNumber, anchor.range.startColumn);
        const stopRenderingLineAfter = this._editor.getOption(118 /* EditorOption.stopRenderingLineAfter */ );
        const maxTokenizationLineLength = this._configurationService.getValue('editor.maxTokenizationLineLength', {
            overrideIdentifier: languageId
        });
        let stopRenderingMessage = false;
        if (stopRenderingLineAfter >= 0 && lineLength > stopRenderingLineAfter && anchor.range.startColumn >= stopRenderingLineAfter) {
            stopRenderingMessage = true;
            result.push(new $9195b2d03426c505$export$de5210377542b3f9(this, anchor.range, [
                {
                    value: $4dEdH.localize('stopped rendering', "Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")
                }
            ], false, index++));
        }
        if (!stopRenderingMessage && typeof maxTokenizationLineLength === 'number' && lineLength >= maxTokenizationLineLength) result.push(new $9195b2d03426c505$export$de5210377542b3f9(this, anchor.range, [
            {
                value: $4dEdH.localize('too many characters', "Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")
            }
        ], false, index++));
        let isBeforeContent = false;
        for (const d of lineDecorations){
            const startColumn = d.range.startLineNumber === lineNumber ? d.range.startColumn : 1;
            const endColumn = d.range.endLineNumber === lineNumber ? d.range.endColumn : maxColumn;
            const hoverMessage = d.options.hoverMessage;
            if (!hoverMessage || (0, $iGmb0.isEmptyMarkdownString)(hoverMessage)) continue;
            if (d.options.beforeContentClassName) isBeforeContent = true;
            const range = new (0, $d00il.Range)(anchor.range.startLineNumber, startColumn, anchor.range.startLineNumber, endColumn);
            result.push(new $9195b2d03426c505$export$de5210377542b3f9(this, range, (0, $kJ8UG.asArray)(hoverMessage), isBeforeContent, index++));
        }
        return result;
    }
    computeAsync(anchor, lineDecorations, token) {
        if (!this._editor.hasModel() || anchor.type !== 1 /* HoverAnchorType.Range */ ) return (0, $6bXyA.AsyncIterableObject).EMPTY;
        const model = this._editor.getModel();
        const hoverProviderRegistry = this._languageFeaturesService.hoverProvider;
        if (!hoverProviderRegistry.has(model)) return (0, $6bXyA.AsyncIterableObject).EMPTY;
        const markdownHovers = this._getMarkdownHovers(hoverProviderRegistry, model, anchor, token);
        return markdownHovers;
    }
    _getMarkdownHovers(hoverProviderRegistry, model, anchor, token) {
        const position = anchor.range.getStartPosition();
        const hoverProviderResults = (0, $f5c90efe5bc3f5fb$export$fe317e31968a65d8)(hoverProviderRegistry, model, position, token);
        const markdownHovers = hoverProviderResults.filter((item)=>!(0, $iGmb0.isEmptyMarkdownString)(item.hover.contents)).map((item)=>{
            const range = item.hover.range ? (0, $d00il.Range).lift(item.hover.range) : anchor.range;
            const hoverSource = new $9195b2d03426c505$var$HoverSource(item.hover, item.provider, position);
            return new $9195b2d03426c505$export$de5210377542b3f9(this, range, item.hover.contents, false, item.ordinal, hoverSource);
        });
        return markdownHovers;
    }
    renderHoverParts(context, hoverParts) {
        this._renderedHoverParts = new $9195b2d03426c505$var$MarkdownRenderedHoverParts(hoverParts, context.fragment, this, this._editor, this._languageService, this._openerService, this._commandService, this._keybindingService, this._hoverService, this._configurationService, context.onContentsChanged);
        return this._renderedHoverParts;
    }
    updateMarkdownHoverVerbosityLevel(action, index, focus) {
        return Promise.resolve(this._renderedHoverParts?.updateMarkdownHoverPartVerbosityLevel(action, index, focus));
    }
};
$9195b2d03426c505$export$db7233c4b0ae81a2 = $9195b2d03426c505$var$__decorate([
    $9195b2d03426c505$var$__param(1, (0, $h9Xpp.ILanguageService)),
    $9195b2d03426c505$var$__param(2, (0, $iAi3o.IOpenerService)),
    $9195b2d03426c505$var$__param(3, (0, $35IZ9.IConfigurationService)),
    $9195b2d03426c505$var$__param(4, (0, $4J6fu.ILanguageFeaturesService)),
    $9195b2d03426c505$var$__param(5, (0, $7IxGd.IKeybindingService)),
    $9195b2d03426c505$var$__param(6, (0, $lc5DL.IHoverService)),
    $9195b2d03426c505$var$__param(7, (0, $8tcMz.ICommandService))
], $9195b2d03426c505$export$db7233c4b0ae81a2);
class $9195b2d03426c505$var$RenderedMarkdownHoverPart {
    constructor(hoverPart, hoverElement, disposables){
        this.hoverPart = hoverPart;
        this.hoverElement = hoverElement;
        this.disposables = disposables;
    }
    dispose() {
        this.disposables.dispose();
    }
}
class $9195b2d03426c505$var$MarkdownRenderedHoverParts {
    constructor(hoverParts, hoverPartsContainer, _hoverParticipant, _editor, _languageService, _openerService, _commandService, _keybindingService, _hoverService, _configurationService, _onFinishedRendering){
        this._hoverParticipant = _hoverParticipant;
        this._editor = _editor;
        this._languageService = _languageService;
        this._openerService = _openerService;
        this._commandService = _commandService;
        this._keybindingService = _keybindingService;
        this._hoverService = _hoverService;
        this._configurationService = _configurationService;
        this._onFinishedRendering = _onFinishedRendering;
        this._ongoingHoverOperations = new Map();
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this.renderedHoverParts = this._renderHoverParts(hoverParts, hoverPartsContainer, this._onFinishedRendering);
        this._disposables.add((0, $9cWcn.toDisposable)(()=>{
            this.renderedHoverParts.forEach((renderedHoverPart)=>{
                renderedHoverPart.dispose();
            });
            this._ongoingHoverOperations.forEach((operation)=>{
                operation.tokenSource.dispose(true);
            });
        }));
    }
    _renderHoverParts(hoverParts, hoverPartsContainer, onFinishedRendering) {
        hoverParts.sort((0, $kJ8UG.compareBy)((hover)=>hover.ordinal, (0, $kJ8UG.numberComparator)));
        return hoverParts.map((hoverPart)=>{
            const renderedHoverPart = this._renderHoverPart(hoverPart, onFinishedRendering);
            hoverPartsContainer.appendChild(renderedHoverPart.hoverElement);
            return renderedHoverPart;
        });
    }
    _renderHoverPart(hoverPart, onFinishedRendering) {
        const renderedMarkdownPart = this._renderMarkdownHover(hoverPart, onFinishedRendering);
        const renderedMarkdownElement = renderedMarkdownPart.hoverElement;
        const hoverSource = hoverPart.source;
        const disposables = new (0, $9cWcn.DisposableStore)();
        disposables.add(renderedMarkdownPart);
        if (!hoverSource) return new $9195b2d03426c505$var$RenderedMarkdownHoverPart(hoverPart, renderedMarkdownElement, disposables);
        const canIncreaseVerbosity = hoverSource.supportsVerbosityAction((0, $kzNQX.HoverVerbosityAction).Increase);
        const canDecreaseVerbosity = hoverSource.supportsVerbosityAction((0, $kzNQX.HoverVerbosityAction).Decrease);
        if (!canIncreaseVerbosity && !canDecreaseVerbosity) return new $9195b2d03426c505$var$RenderedMarkdownHoverPart(hoverPart, renderedMarkdownElement, disposables);
        const actionsContainer = $9195b2d03426c505$var$$('div.verbosity-actions');
        renderedMarkdownElement.prepend(actionsContainer);
        disposables.add(this._renderHoverExpansionAction(actionsContainer, (0, $kzNQX.HoverVerbosityAction).Increase, canIncreaseVerbosity));
        disposables.add(this._renderHoverExpansionAction(actionsContainer, (0, $kzNQX.HoverVerbosityAction).Decrease, canDecreaseVerbosity));
        return new $9195b2d03426c505$var$RenderedMarkdownHoverPart(hoverPart, renderedMarkdownElement, disposables);
    }
    _renderMarkdownHover(markdownHover, onFinishedRendering) {
        const renderedMarkdownHover = $9195b2d03426c505$var$renderMarkdownInContainer(this._editor, markdownHover, this._languageService, this._openerService, onFinishedRendering);
        return renderedMarkdownHover;
    }
    _renderHoverExpansionAction(container, action, actionEnabled) {
        const store = new (0, $9cWcn.DisposableStore)();
        const isActionIncrease = action === (0, $kzNQX.HoverVerbosityAction).Increase;
        const actionElement = $bDzmQ.append(container, $9195b2d03426c505$var$$((0, $5rADe.ThemeIcon).asCSSSelector(isActionIncrease ? $9195b2d03426c505$var$increaseHoverVerbosityIcon : $9195b2d03426c505$var$decreaseHoverVerbosityIcon)));
        actionElement.tabIndex = 0;
        const hoverDelegate = new (0, $lc5DL.WorkbenchHoverDelegate)('mouse', false, {
            target: container,
            position: {
                hoverPosition: 0 /* HoverPosition.LEFT */ 
            }
        }, this._configurationService, this._hoverService);
        store.add(this._hoverService.setupManagedHover(hoverDelegate, actionElement, $9195b2d03426c505$export$14c7a49e69f5cf83(this._keybindingService, action)));
        if (!actionEnabled) {
            actionElement.classList.add('disabled');
            return store;
        }
        actionElement.classList.add('enabled');
        const actionFunction = ()=>this._commandService.executeCommand(action === (0, $kzNQX.HoverVerbosityAction).Increase ? (0, $12f419b3d72893f8$export$876e0bba4925f0cd) : (0, $12f419b3d72893f8$export$cb7016f65e6be5ca));
        store.add(new (0, $jsiuM.ClickAction)(actionElement, actionFunction));
        store.add(new (0, $jsiuM.KeyDownAction)(actionElement, actionFunction, [
            3 /* KeyCode.Enter */ ,
            10 /* KeyCode.Space */ 
        ]));
        return store;
    }
    async updateMarkdownHoverPartVerbosityLevel(action, index, focus = true) {
        const model = this._editor.getModel();
        if (!model) return undefined;
        const hoverRenderedPart = this._getRenderedHoverPartAtIndex(index);
        const hoverSource = hoverRenderedPart?.hoverPart.source;
        if (!hoverRenderedPart || !hoverSource?.supportsVerbosityAction(action)) return undefined;
        const newHover = await this._fetchHover(hoverSource, model, action);
        if (!newHover) return undefined;
        const newHoverSource = new $9195b2d03426c505$var$HoverSource(newHover, hoverSource.hoverProvider, hoverSource.hoverPosition);
        const initialHoverPart = hoverRenderedPart.hoverPart;
        const newHoverPart = new $9195b2d03426c505$export$de5210377542b3f9(this._hoverParticipant, initialHoverPart.range, newHover.contents, initialHoverPart.isBeforeContent, initialHoverPart.ordinal, newHoverSource);
        const newHoverRenderedPart = this._renderHoverPart(newHoverPart, this._onFinishedRendering);
        this._replaceRenderedHoverPartAtIndex(index, newHoverRenderedPart, newHoverPart);
        if (focus) this._focusOnHoverPartWithIndex(index);
        return {
            hoverPart: newHoverPart,
            hoverElement: newHoverRenderedPart.hoverElement
        };
    }
    async _fetchHover(hoverSource, model, action) {
        let verbosityDelta = action === (0, $kzNQX.HoverVerbosityAction).Increase ? 1 : -1;
        const provider = hoverSource.hoverProvider;
        const ongoingHoverOperation = this._ongoingHoverOperations.get(provider);
        if (ongoingHoverOperation) {
            ongoingHoverOperation.tokenSource.cancel();
            verbosityDelta += ongoingHoverOperation.verbosityDelta;
        }
        const tokenSource = new (0, $giPcZ.CancellationTokenSource)();
        this._ongoingHoverOperations.set(provider, {
            verbosityDelta: verbosityDelta,
            tokenSource: tokenSource
        });
        const context = {
            verbosityRequest: {
                verbosityDelta: verbosityDelta,
                previousHover: hoverSource.hover
            }
        };
        let hover;
        try {
            hover = await Promise.resolve(provider.provideHover(model, hoverSource.hoverPosition, tokenSource.token, context));
        } catch (e) {
            (0, $gPkHZ.onUnexpectedExternalError)(e);
        }
        tokenSource.dispose();
        this._ongoingHoverOperations.delete(provider);
        return hover;
    }
    _replaceRenderedHoverPartAtIndex(index, renderedHoverPart, hoverPart) {
        if (index >= this.renderedHoverParts.length || index < 0) return;
        const currentRenderedHoverPart = this.renderedHoverParts[index];
        const currentRenderedMarkdown = currentRenderedHoverPart.hoverElement;
        const renderedMarkdown = renderedHoverPart.hoverElement;
        const renderedChildrenElements = Array.from(renderedMarkdown.children);
        currentRenderedMarkdown.replaceChildren(...renderedChildrenElements);
        const newRenderedHoverPart = new $9195b2d03426c505$var$RenderedMarkdownHoverPart(hoverPart, currentRenderedMarkdown, renderedHoverPart.disposables);
        currentRenderedMarkdown.focus();
        currentRenderedHoverPart.dispose();
        this.renderedHoverParts[index] = newRenderedHoverPart;
    }
    _focusOnHoverPartWithIndex(index) {
        this.renderedHoverParts[index].hoverElement.focus();
    }
    _getRenderedHoverPartAtIndex(index) {
        return this.renderedHoverParts[index];
    }
    dispose() {
        this._disposables.dispose();
    }
}
function $9195b2d03426c505$export$d74d68ef545bd110(context, markdownHovers, editor, languageService, openerService) {
    // Sort hover parts to keep them stable since they might come in async, out-of-order
    markdownHovers.sort((0, $kJ8UG.compareBy)((hover)=>hover.ordinal, (0, $kJ8UG.numberComparator)));
    const renderedHoverParts = [];
    for (const markdownHover of markdownHovers)renderedHoverParts.push($9195b2d03426c505$var$renderMarkdownInContainer(editor, markdownHover, languageService, openerService, context.onContentsChanged));
    return new (0, $4760294cb1bcf994$export$637327e7f36b9c4a)(renderedHoverParts);
}
function $9195b2d03426c505$var$renderMarkdownInContainer(editor, markdownHover, languageService, openerService, onFinishedRendering) {
    const disposables = new (0, $9cWcn.DisposableStore)();
    const renderedMarkdown = $9195b2d03426c505$var$$('div.hover-row');
    const renderedMarkdownContents = $9195b2d03426c505$var$$('div.hover-row-contents');
    renderedMarkdown.appendChild(renderedMarkdownContents);
    const markdownStrings = markdownHover.contents;
    for (const markdownString of markdownStrings){
        if ((0, $iGmb0.isEmptyMarkdownString)(markdownString)) continue;
        const markdownHoverElement = $9195b2d03426c505$var$$('div.markdown-hover');
        const hoverContentsElement = $bDzmQ.append(markdownHoverElement, $9195b2d03426c505$var$$('div.hover-contents'));
        const renderer = disposables.add(new (0, $1vDLP.MarkdownRenderer)({
            editor: editor
        }, languageService, openerService));
        disposables.add(renderer.onDidRenderAsync(()=>{
            hoverContentsElement.className = 'hover-contents code-hover-contents';
            onFinishedRendering();
        }));
        const renderedContents = disposables.add(renderer.render(markdownString));
        hoverContentsElement.appendChild(renderedContents.element);
        renderedMarkdownContents.appendChild(markdownHoverElement);
    }
    const renderedHoverPart = {
        hoverPart: markdownHover,
        hoverElement: renderedMarkdown,
        dispose () {
            disposables.dispose();
        }
    };
    return renderedHoverPart;
}
function $9195b2d03426c505$export$14c7a49e69f5cf83(keybindingService, action) {
    switch(action){
        case (0, $kzNQX.HoverVerbosityAction).Increase:
            {
                const kb = keybindingService.lookupKeybinding((0, $12f419b3d72893f8$export$876e0bba4925f0cd));
                return kb ? $4dEdH.localize('increaseVerbosityWithKb', "Increase Hover Verbosity ({0})", kb.getLabel()) : $4dEdH.localize('increaseVerbosity', "Increase Hover Verbosity");
            }
        case (0, $kzNQX.HoverVerbosityAction).Decrease:
            {
                const kb = keybindingService.lookupKeybinding((0, $12f419b3d72893f8$export$cb7016f65e6be5ca));
                return kb ? $4dEdH.localize('decreaseVerbosityWithKb', "Decrease Hover Verbosity ({0})", kb.getLabel()) : $4dEdH.localize('decreaseVerbosity', "Decrease Hover Verbosity");
            }
    }
}



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $iGmb0 = parcelRequire("iGmb0");

var $dcxQ7 = parcelRequire("dcxQ7");

var $91ntV = parcelRequire("91ntV");


var $h9Xpp = parcelRequire("h9Xpp");

var $aTkrt = parcelRequire("aTkrt");


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $askDf = parcelRequire("askDf");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $loznH = parcelRequire("loznH");

var $1RlHY = parcelRequire("1RlHY");

var $cd4KD = parcelRequire("cd4KD");

var $kHJv6 = parcelRequire("kHJv6");

var $d00il = parcelRequire("d00il");

var $kzNQX = parcelRequire("kzNQX");

var $1Y4vr = parcelRequire("1Y4vr");

var $91ntV = parcelRequire("91ntV");

var $goG89 = parcelRequire("goG89");

var $4J6fu = parcelRequire("4J6fu");

var $aTkrt = parcelRequire("aTkrt");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $lb0Ah = parcelRequire("lb0Ah");
function $485c48732062cc95$var$hasModifier(e, modifier) {
    return !!e[modifier];
}
class $485c48732062cc95$export$69f99c1197f68370 {
    constructor(source, opts){
        this.target = source.target;
        this.isLeftClick = source.event.leftButton;
        this.isMiddleClick = source.event.middleButton;
        this.isRightClick = source.event.rightButton;
        this.hasTriggerModifier = $485c48732062cc95$var$hasModifier(source.event, opts.triggerModifier);
        this.hasSideBySideModifier = $485c48732062cc95$var$hasModifier(source.event, opts.triggerSideBySideModifier);
        this.isNoneOrSingleMouseDown = source.event.detail <= 1;
    }
}
class $485c48732062cc95$export$40b9eb22d04cd705 {
    constructor(source, opts){
        this.keyCodeIsTriggerKey = source.keyCode === opts.triggerKey;
        this.keyCodeIsSideBySideKey = source.keyCode === opts.triggerSideBySideKey;
        this.hasTriggerModifier = $485c48732062cc95$var$hasModifier(source, opts.triggerModifier);
    }
}
class $485c48732062cc95$export$17acd7002e6c5cb3 {
    constructor(triggerKey, triggerModifier, triggerSideBySideKey, triggerSideBySideModifier){
        this.triggerKey = triggerKey;
        this.triggerModifier = triggerModifier;
        this.triggerSideBySideKey = triggerSideBySideKey;
        this.triggerSideBySideModifier = triggerSideBySideModifier;
    }
    equals(other) {
        return this.triggerKey === other.triggerKey && this.triggerModifier === other.triggerModifier && this.triggerSideBySideKey === other.triggerSideBySideKey && this.triggerSideBySideModifier === other.triggerSideBySideModifier;
    }
}
function $485c48732062cc95$var$createOptions(multiCursorModifier) {
    if (multiCursorModifier === 'altKey') {
        if ($lb0Ah.isMacintosh) return new $485c48732062cc95$export$17acd7002e6c5cb3(57 /* KeyCode.Meta */ , 'metaKey', 6 /* KeyCode.Alt */ , 'altKey');
        return new $485c48732062cc95$export$17acd7002e6c5cb3(5 /* KeyCode.Ctrl */ , 'ctrlKey', 6 /* KeyCode.Alt */ , 'altKey');
    }
    if ($lb0Ah.isMacintosh) return new $485c48732062cc95$export$17acd7002e6c5cb3(6 /* KeyCode.Alt */ , 'altKey', 57 /* KeyCode.Meta */ , 'metaKey');
    return new $485c48732062cc95$export$17acd7002e6c5cb3(6 /* KeyCode.Alt */ , 'altKey', 5 /* KeyCode.Ctrl */ , 'ctrlKey');
}
class $485c48732062cc95$export$e5a83b5c609cb4bb extends (0, $9cWcn.Disposable) {
    constructor(editor, opts){
        super();
        this._onMouseMoveOrRelevantKeyDown = this._register(new (0, $5YaSO.Emitter)());
        this.onMouseMoveOrRelevantKeyDown = this._onMouseMoveOrRelevantKeyDown.event;
        this._onExecute = this._register(new (0, $5YaSO.Emitter)());
        this.onExecute = this._onExecute.event;
        this._onCancel = this._register(new (0, $5YaSO.Emitter)());
        this.onCancel = this._onCancel.event;
        this._editor = editor;
        this._extractLineNumberFromMouseEvent = opts?.extractLineNumberFromMouseEvent ?? ((e)=>e.target.position ? e.target.position.lineNumber : 0);
        this._opts = $485c48732062cc95$var$createOptions(this._editor.getOption(78 /* EditorOption.multiCursorModifier */ ));
        this._lastMouseMoveEvent = null;
        this._hasTriggerKeyOnMouseDown = false;
        this._lineNumberOnMouseDown = 0;
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(78 /* EditorOption.multiCursorModifier */ )) {
                const newOpts = $485c48732062cc95$var$createOptions(this._editor.getOption(78 /* EditorOption.multiCursorModifier */ ));
                if (this._opts.equals(newOpts)) return;
                this._opts = newOpts;
                this._lastMouseMoveEvent = null;
                this._hasTriggerKeyOnMouseDown = false;
                this._lineNumberOnMouseDown = 0;
                this._onCancel.fire();
            }
        }));
        this._register(this._editor.onMouseMove((e)=>this._onEditorMouseMove(new $485c48732062cc95$export$69f99c1197f68370(e, this._opts))));
        this._register(this._editor.onMouseDown((e)=>this._onEditorMouseDown(new $485c48732062cc95$export$69f99c1197f68370(e, this._opts))));
        this._register(this._editor.onMouseUp((e)=>this._onEditorMouseUp(new $485c48732062cc95$export$69f99c1197f68370(e, this._opts))));
        this._register(this._editor.onKeyDown((e)=>this._onEditorKeyDown(new $485c48732062cc95$export$40b9eb22d04cd705(e, this._opts))));
        this._register(this._editor.onKeyUp((e)=>this._onEditorKeyUp(new $485c48732062cc95$export$40b9eb22d04cd705(e, this._opts))));
        this._register(this._editor.onMouseDrag(()=>this._resetHandler()));
        this._register(this._editor.onDidChangeCursorSelection((e)=>this._onDidChangeCursorSelection(e)));
        this._register(this._editor.onDidChangeModel((e)=>this._resetHandler()));
        this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler()));
        this._register(this._editor.onDidScrollChange((e)=>{
            if (e.scrollTopChanged || e.scrollLeftChanged) this._resetHandler();
        }));
    }
    _onDidChangeCursorSelection(e) {
        if (e.selection && e.selection.startColumn !== e.selection.endColumn) this._resetHandler(); // immediately stop this feature if the user starts to select (https://github.com/microsoft/vscode/issues/7827)
    }
    _onEditorMouseMove(mouseEvent) {
        this._lastMouseMoveEvent = mouseEvent;
        this._onMouseMoveOrRelevantKeyDown.fire([
            mouseEvent,
            null
        ]);
    }
    _onEditorMouseDown(mouseEvent) {
        // We need to record if we had the trigger key on mouse down because someone might select something in the editor
        // holding the mouse down and then while mouse is down start to press Ctrl/Cmd to start a copy operation and then
        // release the mouse button without wanting to do the navigation.
        // With this flag we prevent goto definition if the mouse was down before the trigger key was pressed.
        this._hasTriggerKeyOnMouseDown = mouseEvent.hasTriggerModifier;
        this._lineNumberOnMouseDown = this._extractLineNumberFromMouseEvent(mouseEvent);
    }
    _onEditorMouseUp(mouseEvent) {
        const currentLineNumber = this._extractLineNumberFromMouseEvent(mouseEvent);
        if (this._hasTriggerKeyOnMouseDown && this._lineNumberOnMouseDown && this._lineNumberOnMouseDown === currentLineNumber) this._onExecute.fire(mouseEvent);
    }
    _onEditorKeyDown(e) {
        if (this._lastMouseMoveEvent && (e.keyCodeIsTriggerKey // User just pressed Ctrl/Cmd (normal goto definition)
         || e.keyCodeIsSideBySideKey && e.hasTriggerModifier // User pressed Ctrl/Cmd+Alt (goto definition to the side)
        )) this._onMouseMoveOrRelevantKeyDown.fire([
            this._lastMouseMoveEvent,
            e
        ]);
        else if (e.hasTriggerModifier) this._onCancel.fire(); // remove decorations if user holds another key with ctrl/cmd to prevent accident goto declaration
    }
    _onEditorKeyUp(e) {
        if (e.keyCodeIsTriggerKey) this._onCancel.fire();
    }
    _resetHandler() {
        this._lastMouseMoveEvent = null;
        this._hasTriggerKeyOnMouseDown = false;
        this._onCancel.fire();
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $8GPp8 = parcelRequire("8GPp8");

var $5OJ54 = parcelRequire("5OJ54");
class $143e7f0b04cd0b1d$export$7f6a0555505c92c6 {
    constructor(range, direction){
        this.range = range;
        this.direction = direction;
    }
}
class $143e7f0b04cd0b1d$export$dc49f58ebca93808 {
    constructor(hint, anchor, provider){
        this.hint = hint;
        this.anchor = anchor;
        this.provider = provider;
        this._isResolved = false;
    }
    with(delta) {
        const result = new $143e7f0b04cd0b1d$export$dc49f58ebca93808(this.hint, delta.anchor, this.provider);
        result._isResolved = this._isResolved;
        result._currentResolve = this._currentResolve;
        return result;
    }
    async resolve(token) {
        if (typeof this.provider.resolveInlayHint !== 'function') return;
        if (this._currentResolve) {
            // wait for an active resolve operation and try again
            // when that's done.
            await this._currentResolve;
            if (token.isCancellationRequested) return;
            return this.resolve(token);
        }
        if (!this._isResolved) this._currentResolve = this._doResolve(token).finally(()=>this._currentResolve = undefined);
        await this._currentResolve;
    }
    async _doResolve(token) {
        try {
            const newHint = await Promise.resolve(this.provider.resolveInlayHint(this.hint, token));
            this.hint.tooltip = newHint?.tooltip ?? this.hint.tooltip;
            this.hint.label = newHint?.label ?? this.hint.label;
            this.hint.textEdits = newHint?.textEdits ?? this.hint.textEdits;
            this._isResolved = true;
        } catch (err) {
            (0, $gPkHZ.onUnexpectedExternalError)(err);
            this._isResolved = false;
        }
    }
}
class $143e7f0b04cd0b1d$export$a7a5e2275dfc6de6 {
    static{
        this._emptyInlayHintList = Object.freeze({
            dispose () {},
            hints: []
        });
    }
    static async create(registry, model, ranges, token) {
        const data = [];
        const promises = registry.ordered(model).reverse().map((provider)=>ranges.map(async (range)=>{
                try {
                    const result = await provider.provideInlayHints(model, range, token);
                    if (result?.hints.length || provider.onDidChangeInlayHints) data.push([
                        result ?? $143e7f0b04cd0b1d$export$a7a5e2275dfc6de6._emptyInlayHintList,
                        provider
                    ]);
                } catch (err) {
                    (0, $gPkHZ.onUnexpectedExternalError)(err);
                }
            }));
        await Promise.all(promises.flat());
        if (token.isCancellationRequested || model.isDisposed()) throw new (0, $gPkHZ.CancellationError)();
        return new $143e7f0b04cd0b1d$export$a7a5e2275dfc6de6(ranges, data, model);
    }
    constructor(ranges, data, model){
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this.ranges = ranges;
        this.provider = new Set();
        const items = [];
        for (const [list, provider] of data){
            this._disposables.add(list);
            this.provider.add(provider);
            for (const hint of list.hints){
                // compute the range to which the item should be attached to
                const position = model.validatePosition(hint.position);
                let direction = 'before';
                const wordRange = $143e7f0b04cd0b1d$export$a7a5e2275dfc6de6._getRangeAtPosition(model, position);
                let range;
                if (wordRange.getStartPosition().isBefore(position)) {
                    range = (0, $d00il.Range).fromPositions(wordRange.getStartPosition(), position);
                    direction = 'after';
                } else {
                    range = (0, $d00il.Range).fromPositions(position, wordRange.getEndPosition());
                    direction = 'before';
                }
                items.push(new $143e7f0b04cd0b1d$export$dc49f58ebca93808(hint, new $143e7f0b04cd0b1d$export$7f6a0555505c92c6(range, direction), provider));
            }
        }
        this.items = items.sort((a, b)=>(0, $dcxQ7.Position).compare(a.hint.position, b.hint.position));
    }
    dispose() {
        this._disposables.dispose();
    }
    static _getRangeAtPosition(model, position) {
        const line = position.lineNumber;
        const word = model.getWordAtPosition(position);
        if (word) // always prefer the word range
        return new (0, $d00il.Range)(line, word.startColumn, line, word.endColumn);
        model.tokenization.tokenizeIfCheap(line);
        const tokens = model.tokenization.getLineTokens(line);
        const offset = position.column - 1;
        const idx = tokens.findTokenIndexAtOffset(offset);
        let start = tokens.getStartOffset(idx);
        let end = tokens.getEndOffset(idx);
        if (end - start === 1) {
            // single character token, when at its end try leading/trailing token instead
            if (start === offset && idx > 1) {
                // leading token
                start = tokens.getStartOffset(idx - 1);
                end = tokens.getEndOffset(idx - 1);
            } else if (end === offset && idx < tokens.getCount() - 1) {
                // trailing token
                start = tokens.getStartOffset(idx + 1);
                end = tokens.getEndOffset(idx + 1);
            }
        }
        return new (0, $d00il.Range)(line, start + 1, line, end + 1);
    }
}
function $143e7f0b04cd0b1d$export$2bd95c79fcb29f(command) {
    return (0, $5OJ54.URI).from({
        scheme: (0, $8GPp8.Schemas).command,
        path: command.id,
        query: command.arguments && encodeURIComponent(JSON.stringify(command.arguments))
    }).toString();
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $cVfMQ = parcelRequire("cVfMQ");

var $giPcZ = parcelRequire("giPcZ");


var $d00il = parcelRequire("d00il");

var $aTkrt = parcelRequire("aTkrt");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $aIbUW = parcelRequire("aIbUW");

var $6bXyA = parcelRequire("6bXyA");

var $fuc8X = parcelRequire("fuc8X");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $lgoyH = parcelRequire("lgoyH");

var $7UXLG = parcelRequire("7UXLG");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $7w8Da = parcelRequire("7w8Da");

var $2Qfl0 = parcelRequire("2Qfl0");

var $62QtC = parcelRequire("62QtC");

var $1qkuR = parcelRequire("1qkuR");

var $4J6fu = parcelRequire("4J6fu");

var $gjaQN = parcelRequire("gjaQN");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $kCOKl = parcelRequire("kCOKl");

var $azIPz = parcelRequire("azIPz");
var $205d91d7661de01d$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $205d91d7661de01d$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $205d91d7661de01d$export$3c7efbd913d316d0 = class EmbeddedCodeEditorWidget extends (0, $62QtC.CodeEditorWidget) {
    constructor(domElement, options, codeEditorWidgetOptions, parentEditor, instantiationService, codeEditorService, commandService, contextKeyService, themeService, notificationService, accessibilityService, languageConfigurationService, languageFeaturesService){
        super(domElement, {
            ...parentEditor.getRawOptions(),
            overflowWidgetsDomNode: parentEditor.getOverflowWidgetsDomNode()
        }, codeEditorWidgetOptions, instantiationService, codeEditorService, commandService, contextKeyService, themeService, notificationService, accessibilityService, languageConfigurationService, languageFeaturesService);
        this._parentEditor = parentEditor;
        this._overwriteOptions = options;
        // Overwrite parent's options
        super.updateOptions(this._overwriteOptions);
        this._register(parentEditor.onDidChangeConfiguration((e)=>this._onParentConfigurationChanged(e)));
    }
    getParentEditor() {
        return this._parentEditor;
    }
    _onParentConfigurationChanged(e) {
        super.updateOptions(this._parentEditor.getRawOptions());
        super.updateOptions(this._overwriteOptions);
    }
    updateOptions(newOptions) {
        $7w8Da.mixin(this._overwriteOptions, newOptions, true);
        super.updateOptions(this._overwriteOptions);
    }
};
$205d91d7661de01d$export$3c7efbd913d316d0 = $205d91d7661de01d$var$__decorate([
    $205d91d7661de01d$var$__param(4, (0, $fdGPu.IInstantiationService)),
    $205d91d7661de01d$var$__param(5, (0, $2Qfl0.ICodeEditorService)),
    $205d91d7661de01d$var$__param(6, (0, $8tcMz.ICommandService)),
    $205d91d7661de01d$var$__param(7, (0, $cxCeF.IContextKeyService)),
    $205d91d7661de01d$var$__param(8, (0, $azIPz.IThemeService)),
    $205d91d7661de01d$var$__param(9, (0, $kCOKl.INotificationService)),
    $205d91d7661de01d$var$__param(10, (0, $gjaQN.IAccessibilityService)),
    $205d91d7661de01d$var$__param(11, (0, $1qkuR.ILanguageConfigurationService)),
    $205d91d7661de01d$var$__param(12, (0, $4J6fu.ILanguageFeaturesService))
], $205d91d7661de01d$export$3c7efbd913d316d0);



var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $kzNQX = parcelRequire("kzNQX");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $fuc8X = parcelRequire("fuc8X");

var $9cWcn = parcelRequire("9cWcn");

var $2Qfl0 = parcelRequire("2Qfl0");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $czr0Q = parcelRequire("czr0Q");

var $cVfMQ = parcelRequire("cVfMQ");

var $awgRE = parcelRequire("awgRE");

var $5rADe = parcelRequire("5rADe");

var $bjjQO = parcelRequire("bjjQO");

var $5YaSO = parcelRequire("5YaSO");

var $7w8Da = parcelRequire("7w8Da");


var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $9lxpu = parcelRequire("9lxpu");

var $bjjQO = parcelRequire("bjjQO");

var $nKTlZ = parcelRequire("nKTlZ");

var $9cWcn = parcelRequire("9cWcn");

var $7w8Da = parcelRequire("7w8Da");


var $d00il = parcelRequire("d00il");

var $91ntV = parcelRequire("91ntV");
const $8d7a2aa5b8d49436$var$defaultColor = new (0, $bjjQO.Color)(new (0, $bjjQO.RGBA)(0, 122, 204));
const $8d7a2aa5b8d49436$var$defaultOptions = {
    showArrow: true,
    showFrame: true,
    className: '',
    frameColor: $8d7a2aa5b8d49436$var$defaultColor,
    arrowColor: $8d7a2aa5b8d49436$var$defaultColor,
    keepEditorSelection: false
};
const $8d7a2aa5b8d49436$var$WIDGET_ID = 'vs.editor.contrib.zoneWidget';
class $8d7a2aa5b8d49436$var$ViewZoneDelegate {
    constructor(domNode, afterLineNumber, afterColumn, heightInLines, onDomNodeTop, onComputedHeight, showInHiddenAreas, ordinal){
        this.id = ''; // A valid zone id should be greater than 0
        this.domNode = domNode;
        this.afterLineNumber = afterLineNumber;
        this.afterColumn = afterColumn;
        this.heightInLines = heightInLines;
        this.showInHiddenAreas = showInHiddenAreas;
        this.ordinal = ordinal;
        this._onDomNodeTop = onDomNodeTop;
        this._onComputedHeight = onComputedHeight;
    }
    onDomNodeTop(top) {
        this._onDomNodeTop(top);
    }
    onComputedHeight(height) {
        this._onComputedHeight(height);
    }
}
class $8d7a2aa5b8d49436$export$4f860089b67ba96 {
    constructor(id, domNode){
        this._id = id;
        this._domNode = domNode;
    }
    getId() {
        return this._id;
    }
    getDomNode() {
        return this._domNode;
    }
    getPosition() {
        return null;
    }
}
class $8d7a2aa5b8d49436$var$Arrow {
    static{
        this._IdGenerator = new (0, $nKTlZ.IdGenerator)('.arrow-decoration-');
    }
    constructor(_editor){
        this._editor = _editor;
        this._ruleName = $8d7a2aa5b8d49436$var$Arrow._IdGenerator.nextId();
        this._decorations = this._editor.createDecorationsCollection();
        this._color = null;
        this._height = -1;
    }
    dispose() {
        this.hide();
        $bDzmQ.removeCSSRulesContainingSelector(this._ruleName);
    }
    set color(value) {
        if (this._color !== value) {
            this._color = value;
            this._updateStyle();
        }
    }
    set height(value) {
        if (this._height !== value) {
            this._height = value;
            this._updateStyle();
        }
    }
    _updateStyle() {
        $bDzmQ.removeCSSRulesContainingSelector(this._ruleName);
        $bDzmQ.createCSSRule(`.monaco-editor ${this._ruleName}`, `border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `);
    }
    show(where) {
        if (where.column === 1) // the arrow isn't pretty at column 1 and we need to push it out a little
        where = {
            lineNumber: where.lineNumber,
            column: 2
        };
        this._decorations.set([
            {
                range: (0, $d00il.Range).fromPositions(where),
                options: {
                    description: 'zone-widget-arrow',
                    className: this._ruleName,
                    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ 
                }
            }
        ]);
    }
    hide() {
        this._decorations.clear();
    }
}
class $8d7a2aa5b8d49436$export$4a50bb71db87eba6 {
    constructor(editor, options = {}){
        this._arrow = null;
        this._overlayWidget = null;
        this._resizeSash = null;
        this._viewZone = null;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this.container = null;
        this._isShowing = false;
        this.editor = editor;
        this._positionMarkerId = this.editor.createDecorationsCollection();
        this.options = $7w8Da.deepClone(options);
        $7w8Da.mixin(this.options, $8d7a2aa5b8d49436$var$defaultOptions, false);
        this.domNode = document.createElement('div');
        if (!this.options.isAccessible) {
            this.domNode.setAttribute('aria-hidden', 'true');
            this.domNode.setAttribute('role', 'presentation');
        }
        this._disposables.add(this.editor.onDidLayoutChange((info)=>{
            const width = this._getWidth(info);
            this.domNode.style.width = width + 'px';
            this.domNode.style.left = this._getLeft(info) + 'px';
            this._onWidth(width);
        }));
    }
    dispose() {
        if (this._overlayWidget) {
            this.editor.removeOverlayWidget(this._overlayWidget);
            this._overlayWidget = null;
        }
        if (this._viewZone) this.editor.changeViewZones((accessor)=>{
            if (this._viewZone) accessor.removeZone(this._viewZone.id);
            this._viewZone = null;
        });
        this._positionMarkerId.clear();
        this._disposables.dispose();
    }
    create() {
        this.domNode.classList.add('zone-widget');
        if (this.options.className) this.domNode.classList.add(this.options.className);
        this.container = document.createElement('div');
        this.container.classList.add('zone-widget-container');
        this.domNode.appendChild(this.container);
        if (this.options.showArrow) {
            this._arrow = new $8d7a2aa5b8d49436$var$Arrow(this.editor);
            this._disposables.add(this._arrow);
        }
        this._fillContainer(this.container);
        this._initSash();
        this._applyStyles();
    }
    style(styles) {
        if (styles.frameColor) this.options.frameColor = styles.frameColor;
        if (styles.arrowColor) this.options.arrowColor = styles.arrowColor;
        this._applyStyles();
    }
    _applyStyles() {
        if (this.container && this.options.frameColor) {
            const frameColor = this.options.frameColor.toString();
            this.container.style.borderTopColor = frameColor;
            this.container.style.borderBottomColor = frameColor;
        }
        if (this._arrow && this.options.arrowColor) {
            const arrowColor = this.options.arrowColor.toString();
            this._arrow.color = arrowColor;
        }
    }
    _getWidth(info) {
        return info.width - info.minimap.minimapWidth - info.verticalScrollbarWidth;
    }
    _getLeft(info) {
        // If minimap is to the left, we move beyond it
        if (info.minimap.minimapWidth > 0 && info.minimap.minimapLeft === 0) return info.minimap.minimapWidth;
        return 0;
    }
    _onViewZoneTop(top) {
        this.domNode.style.top = top + 'px';
    }
    _onViewZoneHeight(height) {
        this.domNode.style.height = `${height}px`;
        if (this.container) {
            const containerHeight = height - this._decoratingElementsHeight();
            this.container.style.height = `${containerHeight}px`;
            const layoutInfo = this.editor.getLayoutInfo();
            this._doLayout(containerHeight, this._getWidth(layoutInfo));
        }
        this._resizeSash?.layout();
    }
    get position() {
        const range = this._positionMarkerId.getRange(0);
        if (!range) return undefined;
        return range.getStartPosition();
    }
    show(rangeOrPos, heightInLines) {
        const range = (0, $d00il.Range).isIRange(rangeOrPos) ? (0, $d00il.Range).lift(rangeOrPos) : (0, $d00il.Range).fromPositions(rangeOrPos);
        this._isShowing = true;
        this._showImpl(range, heightInLines);
        this._isShowing = false;
        this._positionMarkerId.set([
            {
                range: range,
                options: (0, $91ntV.ModelDecorationOptions).EMPTY
            }
        ]);
    }
    hide() {
        if (this._viewZone) {
            this.editor.changeViewZones((accessor)=>{
                if (this._viewZone) accessor.removeZone(this._viewZone.id);
            });
            this._viewZone = null;
        }
        if (this._overlayWidget) {
            this.editor.removeOverlayWidget(this._overlayWidget);
            this._overlayWidget = null;
        }
        this._arrow?.hide();
        this._positionMarkerId.clear();
    }
    _decoratingElementsHeight() {
        const lineHeight = this.editor.getOption(67 /* EditorOption.lineHeight */ );
        let result = 0;
        if (this.options.showArrow) {
            const arrowHeight = Math.round(lineHeight / 3);
            result += 2 * arrowHeight;
        }
        if (this.options.showFrame) {
            const frameThickness = Math.round(lineHeight / 9);
            result += 2 * frameThickness;
        }
        return result;
    }
    _showImpl(where, heightInLines) {
        const position = where.getStartPosition();
        const layoutInfo = this.editor.getLayoutInfo();
        const width = this._getWidth(layoutInfo);
        this.domNode.style.width = `${width}px`;
        this.domNode.style.left = this._getLeft(layoutInfo) + 'px';
        // Render the widget as zone (rendering) and widget (lifecycle)
        const viewZoneDomNode = document.createElement('div');
        viewZoneDomNode.style.overflow = 'hidden';
        const lineHeight = this.editor.getOption(67 /* EditorOption.lineHeight */ );
        // adjust heightInLines to viewport
        if (!this.options.allowUnlimitedHeight) {
            const maxHeightInLines = Math.max(12, this.editor.getLayoutInfo().height / lineHeight * 0.8);
            heightInLines = Math.min(heightInLines, maxHeightInLines);
        }
        let arrowHeight = 0;
        let frameThickness = 0;
        // Render the arrow one 1/3 of an editor line height
        if (this._arrow && this.options.showArrow) {
            arrowHeight = Math.round(lineHeight / 3);
            this._arrow.height = arrowHeight;
            this._arrow.show(position);
        }
        // Render the frame as 1/9 of an editor line height
        if (this.options.showFrame) frameThickness = Math.round(lineHeight / 9);
        // insert zone widget
        this.editor.changeViewZones((accessor)=>{
            if (this._viewZone) accessor.removeZone(this._viewZone.id);
            if (this._overlayWidget) {
                this.editor.removeOverlayWidget(this._overlayWidget);
                this._overlayWidget = null;
            }
            this.domNode.style.top = '-1000px';
            this._viewZone = new $8d7a2aa5b8d49436$var$ViewZoneDelegate(viewZoneDomNode, position.lineNumber, position.column, heightInLines, (top)=>this._onViewZoneTop(top), (height)=>this._onViewZoneHeight(height), this.options.showInHiddenAreas, this.options.ordinal);
            this._viewZone.id = accessor.addZone(this._viewZone);
            this._overlayWidget = new $8d7a2aa5b8d49436$export$4f860089b67ba96($8d7a2aa5b8d49436$var$WIDGET_ID + this._viewZone.id, this.domNode);
            this.editor.addOverlayWidget(this._overlayWidget);
        });
        if (this.container && this.options.showFrame) {
            const width = this.options.frameWidth ? this.options.frameWidth : frameThickness;
            this.container.style.borderTopWidth = width + 'px';
            this.container.style.borderBottomWidth = width + 'px';
        }
        const containerHeight = heightInLines * lineHeight - this._decoratingElementsHeight();
        if (this.container) {
            this.container.style.top = arrowHeight + 'px';
            this.container.style.height = containerHeight + 'px';
            this.container.style.overflow = 'hidden';
        }
        this._doLayout(containerHeight, width);
        if (!this.options.keepEditorSelection) this.editor.setSelection(where);
        const model = this.editor.getModel();
        if (model) {
            const range = model.validateRange(new (0, $d00il.Range)(where.startLineNumber, 1, where.endLineNumber + 1, 1));
            this.revealRange(range, range.startLineNumber === model.getLineCount());
        }
    }
    revealRange(range, isLastLine) {
        if (isLastLine) this.editor.revealLineNearTop(range.endLineNumber, 0 /* ScrollType.Smooth */ );
        else this.editor.revealRange(range, 0 /* ScrollType.Smooth */ );
    }
    setCssClass(className, classToReplace) {
        if (!this.container) return;
        if (classToReplace) this.container.classList.remove(classToReplace);
        this.container.classList.add(className);
    }
    _onWidth(widthInPixel) {
    // implement in subclass
    }
    _doLayout(heightInPixel, widthInPixel) {
    // implement in subclass
    }
    _relayout(newHeightInLines) {
        if (this._viewZone && this._viewZone.heightInLines !== newHeightInLines) this.editor.changeViewZones((accessor)=>{
            if (this._viewZone) {
                this._viewZone.heightInLines = newHeightInLines;
                accessor.layoutZone(this._viewZone.id);
            }
        });
    }
    // --- sash
    _initSash() {
        if (this._resizeSash) return;
        this._resizeSash = this._disposables.add(new (0, $9lxpu.Sash)(this.domNode, this, {
            orientation: 1 /* Orientation.HORIZONTAL */ 
        }));
        if (!this.options.isResizeable) this._resizeSash.state = 0 /* SashState.Disabled */ ;
        let data;
        this._disposables.add(this._resizeSash.onDidStart((e)=>{
            if (this._viewZone) data = {
                startY: e.startY,
                heightInLines: this._viewZone.heightInLines
            };
        }));
        this._disposables.add(this._resizeSash.onDidEnd(()=>{
            data = undefined;
        }));
        this._disposables.add(this._resizeSash.onDidChange((evt)=>{
            if (data) {
                const lineDelta = (evt.currentY - data.startY) / this.editor.getOption(67 /* EditorOption.lineHeight */ );
                const roundedLineDelta = lineDelta < 0 ? Math.ceil(lineDelta) : Math.floor(lineDelta);
                const newHeightInLines = data.heightInLines + roundedLineDelta;
                if (newHeightInLines > 5 && newHeightInLines < 35) this._relayout(newHeightInLines);
            }
        }));
    }
    getHorizontalSashLeft() {
        return 0;
    }
    getHorizontalSashTop() {
        return (this.domNode.style.height === null ? 0 : parseInt(this.domNode.style.height)) - this._decoratingElementsHeight() / 2;
    }
    getHorizontalSashWidth() {
        const layoutInfo = this.editor.getLayoutInfo();
        return layoutInfo.width - layoutInfo.minimap.minimapWidth;
    }
}



var $4dEdH = parcelRequire("4dEdH");

var $hbDWq = parcelRequire("hbDWq");

var $cxCeF = parcelRequire("cxCeF");

var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

var $gaWeX = parcelRequire("gaWeX");
var $fb5054a30d54157b$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $fb5054a30d54157b$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $fb5054a30d54157b$export$8277d1187e5db7d6 = (0, $fdGPu.createDecorator)('IPeekViewService');
(0, $lf2vF.registerSingleton)($fb5054a30d54157b$export$8277d1187e5db7d6, class {
    constructor(){
        this._widgets = new Map();
    }
    addExclusiveWidget(editor, widget) {
        const existing = this._widgets.get(editor);
        if (existing) {
            existing.listener.dispose();
            existing.widget.dispose();
        }
        const remove = ()=>{
            const data = this._widgets.get(editor);
            if (data && data.widget === widget) {
                data.listener.dispose();
                this._widgets.delete(editor);
            }
        };
        this._widgets.set(editor, {
            widget: widget,
            listener: widget.onDidClose(remove)
        });
    }
}, 1 /* InstantiationType.Delayed */ );
var $fb5054a30d54157b$export$5afd50a7c05ff96a;
(function(PeekContext) {
    PeekContext.inPeekEditor = new (0, $cxCeF.RawContextKey)('inReferenceSearchEditor', true, $4dEdH.localize('inReferenceSearchEditor', "Whether the current code editor is embedded inside peek"));
    PeekContext.notInPeekEditor = PeekContext.inPeekEditor.toNegated();
})($fb5054a30d54157b$export$5afd50a7c05ff96a || ($fb5054a30d54157b$export$5afd50a7c05ff96a = {}));
let $fb5054a30d54157b$var$PeekContextController = class PeekContextController {
    static{
        this.ID = 'editor.contrib.referenceController';
    }
    constructor(editor, contextKeyService){
        if (editor instanceof (0, $205d91d7661de01d$export$3c7efbd913d316d0)) $fb5054a30d54157b$export$5afd50a7c05ff96a.inPeekEditor.bindTo(contextKeyService);
    }
    dispose() {}
};
$fb5054a30d54157b$var$PeekContextController = $fb5054a30d54157b$var$__decorate([
    $fb5054a30d54157b$var$__param(1, (0, $cxCeF.IContextKeyService))
], $fb5054a30d54157b$var$PeekContextController);
(0, $2iJTi.registerEditorContribution)($fb5054a30d54157b$var$PeekContextController.ID, $fb5054a30d54157b$var$PeekContextController, 0 /* EditorContributionInstantiation.Eager */ ); // eager because it needs to define a context key
function $fb5054a30d54157b$export$434a98f74be8c7b9(accessor) {
    const editor = accessor.get((0, $2Qfl0.ICodeEditorService)).getFocusedCodeEditor();
    if (editor instanceof (0, $205d91d7661de01d$export$3c7efbd913d316d0)) return editor.getParentEditor();
    return editor;
}
const $fb5054a30d54157b$var$defaultOptions = {
    headerBackgroundColor: (0, $bjjQO.Color).white,
    primaryHeadingColor: (0, $bjjQO.Color).fromHex('#333333'),
    secondaryHeadingColor: (0, $bjjQO.Color).fromHex('#6c6c6cb3')
};
let $fb5054a30d54157b$export$85acc0ce60f75b9f = class PeekViewWidget extends (0, $8d7a2aa5b8d49436$export$4a50bb71db87eba6) {
    constructor(editor, options, instantiationService){
        super(editor, options);
        this.instantiationService = instantiationService;
        this._onDidClose = new (0, $5YaSO.Emitter)();
        this.onDidClose = this._onDidClose.event;
        $7w8Da.mixin(this.options, $fb5054a30d54157b$var$defaultOptions, false);
    }
    dispose() {
        if (!this.disposed) {
            this.disposed = true; // prevent consumers who dispose on onDidClose from looping
            super.dispose();
            this._onDidClose.fire(this);
        }
    }
    style(styles) {
        const options = this.options;
        if (styles.headerBackgroundColor) options.headerBackgroundColor = styles.headerBackgroundColor;
        if (styles.primaryHeadingColor) options.primaryHeadingColor = styles.primaryHeadingColor;
        if (styles.secondaryHeadingColor) options.secondaryHeadingColor = styles.secondaryHeadingColor;
        super.style(styles);
    }
    _applyStyles() {
        super._applyStyles();
        const options = this.options;
        if (this._headElement && options.headerBackgroundColor) this._headElement.style.backgroundColor = options.headerBackgroundColor.toString();
        if (this._primaryHeading && options.primaryHeadingColor) this._primaryHeading.style.color = options.primaryHeadingColor.toString();
        if (this._secondaryHeading && options.secondaryHeadingColor) this._secondaryHeading.style.color = options.secondaryHeadingColor.toString();
        if (this._bodyElement && options.frameColor) this._bodyElement.style.borderColor = options.frameColor.toString();
    }
    _fillContainer(container) {
        this.setCssClass('peekview-widget');
        this._headElement = $bDzmQ.$('.head');
        this._bodyElement = $bDzmQ.$('.body');
        this._fillHead(this._headElement);
        this._fillBody(this._bodyElement);
        container.appendChild(this._headElement);
        container.appendChild(this._bodyElement);
    }
    _fillHead(container, noCloseAction) {
        this._titleElement = $bDzmQ.$('.peekview-title');
        if (this.options.supportOnTitleClick) {
            this._titleElement.classList.add('clickable');
            $bDzmQ.addStandardDisposableListener(this._titleElement, 'click', (event)=>this._onTitleClick(event));
        }
        $bDzmQ.append(this._headElement, this._titleElement);
        this._fillTitleIcon(this._titleElement);
        this._primaryHeading = $bDzmQ.$('span.filename');
        this._secondaryHeading = $bDzmQ.$('span.dirname');
        this._metaHeading = $bDzmQ.$('span.meta');
        $bDzmQ.append(this._titleElement, this._primaryHeading, this._secondaryHeading, this._metaHeading);
        const actionsContainer = $bDzmQ.$('.peekview-actions');
        $bDzmQ.append(this._headElement, actionsContainer);
        const actionBarOptions = this._getActionBarOptions();
        this._actionbarWidget = new (0, $czr0Q.ActionBar)(actionsContainer, actionBarOptions);
        this._disposables.add(this._actionbarWidget);
        if (!noCloseAction) this._actionbarWidget.push(new (0, $cVfMQ.Action)('peekview.close', $4dEdH.localize('label.close', "Close"), (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).close), true, ()=>{
            this.dispose();
            return Promise.resolve();
        }), {
            label: false,
            icon: true
        });
    }
    _fillTitleIcon(container) {}
    _getActionBarOptions() {
        return {
            actionViewItemProvider: (0, $hbDWq.createActionViewItem).bind(undefined, this.instantiationService),
            orientation: 0 /* ActionsOrientation.HORIZONTAL */ 
        };
    }
    _onTitleClick(event) {
    // implement me if supportOnTitleClick option is set
    }
    setTitle(primaryHeading, secondaryHeading) {
        if (this._primaryHeading && this._secondaryHeading) {
            this._primaryHeading.innerText = primaryHeading;
            this._primaryHeading.setAttribute('title', primaryHeading);
            if (secondaryHeading) this._secondaryHeading.innerText = secondaryHeading;
            else $bDzmQ.clearNode(this._secondaryHeading);
        }
    }
    setMetaTitle(value) {
        if (this._metaHeading) {
            if (value) {
                this._metaHeading.innerText = value;
                $bDzmQ.show(this._metaHeading);
            } else $bDzmQ.hide(this._metaHeading);
        }
    }
    _doLayout(heightInPixel, widthInPixel) {
        if (!this._isShowing && heightInPixel < 0) {
            // Looks like the view zone got folded away!
            this.dispose();
            return;
        }
        const headHeight = Math.ceil(this.editor.getOption(67 /* EditorOption.lineHeight */ ) * 1.2);
        const bodyHeight = Math.round(heightInPixel - (headHeight + 2 /* the border-top/bottom width*/ ));
        this._doLayoutHead(headHeight, widthInPixel);
        this._doLayoutBody(bodyHeight, widthInPixel);
    }
    _doLayoutHead(heightInPixel, widthInPixel) {
        if (this._headElement) {
            this._headElement.style.height = `${heightInPixel}px`;
            this._headElement.style.lineHeight = this._headElement.style.height;
        }
    }
    _doLayoutBody(heightInPixel, widthInPixel) {
        if (this._bodyElement) this._bodyElement.style.height = `${heightInPixel}px`;
    }
};
$fb5054a30d54157b$export$85acc0ce60f75b9f = $fb5054a30d54157b$var$__decorate([
    $fb5054a30d54157b$var$__param(2, (0, $fdGPu.IInstantiationService))
], $fb5054a30d54157b$export$85acc0ce60f75b9f);
const $fb5054a30d54157b$export$b1e2a843606aa53d = (0, $gaWeX.registerColor)('peekViewTitle.background', {
    dark: '#252526',
    light: '#F3F3F3',
    hcDark: (0, $bjjQO.Color).black,
    hcLight: (0, $bjjQO.Color).white
}, $4dEdH.localize('peekViewTitleBackground', 'Background color of the peek view title area.'));
const $fb5054a30d54157b$export$5f7b8e8b47f91ad3 = (0, $gaWeX.registerColor)('peekViewTitleLabel.foreground', {
    dark: (0, $bjjQO.Color).white,
    light: (0, $bjjQO.Color).black,
    hcDark: (0, $bjjQO.Color).white,
    hcLight: (0, $gaWeX.editorForeground)
}, $4dEdH.localize('peekViewTitleForeground', 'Color of the peek view title.'));
const $fb5054a30d54157b$export$cdda5f1c5d2481c1 = (0, $gaWeX.registerColor)('peekViewTitleDescription.foreground', {
    dark: '#ccccccb3',
    light: '#616161',
    hcDark: '#FFFFFF99',
    hcLight: '#292929'
}, $4dEdH.localize('peekViewTitleInfoForeground', 'Color of the peek view title info.'));
const $fb5054a30d54157b$export$2d4f038d18170ad2 = (0, $gaWeX.registerColor)('peekView.border', {
    dark: (0, $gaWeX.editorInfoForeground),
    light: (0, $gaWeX.editorInfoForeground),
    hcDark: (0, $gaWeX.contrastBorder),
    hcLight: (0, $gaWeX.contrastBorder)
}, $4dEdH.localize('peekViewBorder', 'Color of the peek view borders and arrow.'));
const $fb5054a30d54157b$export$84f26812d83dda36 = (0, $gaWeX.registerColor)('peekViewResult.background', {
    dark: '#252526',
    light: '#F3F3F3',
    hcDark: (0, $bjjQO.Color).black,
    hcLight: (0, $bjjQO.Color).white
}, $4dEdH.localize('peekViewResultsBackground', 'Background color of the peek view result list.'));
const $fb5054a30d54157b$export$a491fa13f1ce3738 = (0, $gaWeX.registerColor)('peekViewResult.lineForeground', {
    dark: '#bbbbbb',
    light: '#646465',
    hcDark: (0, $bjjQO.Color).white,
    hcLight: (0, $gaWeX.editorForeground)
}, $4dEdH.localize('peekViewResultsMatchForeground', 'Foreground color for line nodes in the peek view result list.'));
const $fb5054a30d54157b$export$a1687901d0a759bc = (0, $gaWeX.registerColor)('peekViewResult.fileForeground', {
    dark: (0, $bjjQO.Color).white,
    light: '#1E1E1E',
    hcDark: (0, $bjjQO.Color).white,
    hcLight: (0, $gaWeX.editorForeground)
}, $4dEdH.localize('peekViewResultsFileForeground', 'Foreground color for file nodes in the peek view result list.'));
const $fb5054a30d54157b$export$69e7cc9d2668590d = (0, $gaWeX.registerColor)('peekViewResult.selectionBackground', {
    dark: '#3399ff33',
    light: '#3399ff33',
    hcDark: null,
    hcLight: null
}, $4dEdH.localize('peekViewResultsSelectionBackground', 'Background color of the selected entry in the peek view result list.'));
const $fb5054a30d54157b$export$a92d00dd8eacf5a2 = (0, $gaWeX.registerColor)('peekViewResult.selectionForeground', {
    dark: (0, $bjjQO.Color).white,
    light: '#6C6C6C',
    hcDark: (0, $bjjQO.Color).white,
    hcLight: (0, $gaWeX.editorForeground)
}, $4dEdH.localize('peekViewResultsSelectionForeground', 'Foreground color of the selected entry in the peek view result list.'));
const $fb5054a30d54157b$export$192226a1c99f760c = (0, $gaWeX.registerColor)('peekViewEditor.background', {
    dark: '#001F33',
    light: '#F2F8FC',
    hcDark: (0, $bjjQO.Color).black,
    hcLight: (0, $bjjQO.Color).white
}, $4dEdH.localize('peekViewEditorBackground', 'Background color of the peek view editor.'));
const $fb5054a30d54157b$export$bbfa630afc4be338 = (0, $gaWeX.registerColor)('peekViewEditorGutter.background', $fb5054a30d54157b$export$192226a1c99f760c, $4dEdH.localize('peekViewEditorGutterBackground', 'Background color of the gutter in the peek view editor.'));
const $fb5054a30d54157b$export$920282bba758640a = (0, $gaWeX.registerColor)('peekViewEditorStickyScroll.background', $fb5054a30d54157b$export$192226a1c99f760c, $4dEdH.localize('peekViewEditorStickScrollBackground', 'Background color of sticky scroll in the peek view editor.'));
const $fb5054a30d54157b$export$f4638ed4c5a4d0b9 = (0, $gaWeX.registerColor)('peekViewResult.matchHighlightBackground', {
    dark: '#ea5c004d',
    light: '#ea5c004d',
    hcDark: null,
    hcLight: null
}, $4dEdH.localize('peekViewResultsMatchHighlight', 'Match highlight color in the peek view result list.'));
const $fb5054a30d54157b$export$164f8e8ef1987462 = (0, $gaWeX.registerColor)('peekViewEditor.matchHighlightBackground', {
    dark: '#ff8f0099',
    light: '#f5d802de',
    hcDark: null,
    hcLight: null
}, $4dEdH.localize('peekViewEditorMatchHighlight', 'Match highlight color in the peek view editor.'));
const $fb5054a30d54157b$export$f891f8a4d014823a = (0, $gaWeX.registerColor)('peekViewEditor.matchHighlightBorder', {
    dark: null,
    light: null,
    hcDark: (0, $gaWeX.activeContrastBorder),
    hcLight: (0, $gaWeX.activeContrastBorder)
}, $4dEdH.localize('peekViewEditorMatchHighlightBorder', 'Match highlight border in the peek view editor.'));



var $4dEdH = parcelRequire("4dEdH");

var $8tcMz = parcelRequire("8tcMz");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $6AWYG = parcelRequire("6AWYG");

var $7UXCS = parcelRequire("7UXCS");

var $kCOKl = parcelRequire("kCOKl");

var $2AUoS = parcelRequire("2AUoS");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $nKTlZ = parcelRequire("nKTlZ");

var $9cWcn = parcelRequire("9cWcn");

var $askDf = parcelRequire("askDf");

var $5Aea5 = parcelRequire("5Aea5");

var $jcr1R = parcelRequire("jcr1R");

var $d00il = parcelRequire("d00il");

var $4dEdH = parcelRequire("4dEdH");
class $5b460a97be6401b7$export$5a16ca2afcb50c8b {
    constructor(isProviderFirst, parent, link, _rangeCallback){
        this.isProviderFirst = isProviderFirst;
        this.parent = parent;
        this.link = link;
        this._rangeCallback = _rangeCallback;
        this.id = (0, $nKTlZ.defaultGenerator).nextId();
    }
    get uri() {
        return this.link.uri;
    }
    get range() {
        return this._range ?? this.link.targetSelectionRange ?? this.link.range;
    }
    set range(value) {
        this._range = value;
        this._rangeCallback(this);
    }
    get ariaMessage() {
        const preview = this.parent.getPreview(this)?.preview(this.range);
        if (!preview) return (0, $4dEdH.localize)('aria.oneReference', "in {0} on line {1} at column {2}", (0, $5Aea5.basename)(this.uri), this.range.startLineNumber, this.range.startColumn);
        else return (0, $4dEdH.localize)({
            key: 'aria.oneReference.preview',
            comment: [
                'Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code'
            ]
        }, "{0} in {1} on line {2} at column {3}", preview.value, (0, $5Aea5.basename)(this.uri), this.range.startLineNumber, this.range.startColumn);
    }
}
class $5b460a97be6401b7$export$a127194569a41afb {
    constructor(_modelReference){
        this._modelReference = _modelReference;
    }
    dispose() {
        this._modelReference.dispose();
    }
    preview(range, n = 8) {
        const model = this._modelReference.object.textEditorModel;
        if (!model) return undefined;
        const { startLineNumber: startLineNumber, startColumn: startColumn, endLineNumber: endLineNumber, endColumn: endColumn } = range;
        const word = model.getWordUntilPosition({
            lineNumber: startLineNumber,
            column: startColumn - n
        });
        const beforeRange = new (0, $d00il.Range)(startLineNumber, word.startColumn, startLineNumber, startColumn);
        const afterRange = new (0, $d00il.Range)(endLineNumber, endColumn, endLineNumber, 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ );
        const before = model.getValueInRange(beforeRange).replace(/^\s+/, '');
        const inside = model.getValueInRange(range);
        const after = model.getValueInRange(afterRange).replace(/\s+$/, '');
        return {
            value: before + inside + after,
            highlight: {
                start: before.length,
                end: before.length + inside.length
            }
        };
    }
}
class $5b460a97be6401b7$export$abd311b1beafe84f {
    constructor(parent, uri){
        this.parent = parent;
        this.uri = uri;
        this.children = [];
        this._previews = new (0, $askDf.ResourceMap)();
    }
    dispose() {
        (0, $9cWcn.dispose)(this._previews.values());
        this._previews.clear();
    }
    getPreview(child) {
        return this._previews.get(child.uri);
    }
    get ariaMessage() {
        const len = this.children.length;
        if (len === 1) return (0, $4dEdH.localize)('aria.fileReferences.1', "1 symbol in {0}, full path {1}", (0, $5Aea5.basename)(this.uri), this.uri.fsPath);
        else return (0, $4dEdH.localize)('aria.fileReferences.N', "{0} symbols in {1}, full path {2}", len, (0, $5Aea5.basename)(this.uri), this.uri.fsPath);
    }
    async resolve(textModelResolverService) {
        if (this._previews.size !== 0) return this;
        for (const child of this.children){
            if (this._previews.has(child.uri)) continue;
            try {
                const ref = await textModelResolverService.createModelReference(child.uri);
                this._previews.set(child.uri, new $5b460a97be6401b7$export$a127194569a41afb(ref));
            } catch (err) {
                (0, $gPkHZ.onUnexpectedError)(err);
            }
        }
        return this;
    }
}
class $5b460a97be6401b7$export$f3299b77f3be0450 {
    constructor(links, title){
        this.groups = [];
        this.references = [];
        this._onDidChangeReferenceRange = new (0, $5YaSO.Emitter)();
        this.onDidChangeReferenceRange = this._onDidChangeReferenceRange.event;
        this._links = links;
        this._title = title;
        // grouping and sorting
        const [providersFirst] = links;
        links.sort($5b460a97be6401b7$export$f3299b77f3be0450._compareReferences);
        let current;
        for (const link of links){
            if (!current || !(0, $5Aea5.extUri).isEqual(current.uri, link.uri, true)) {
                // new group
                current = new $5b460a97be6401b7$export$abd311b1beafe84f(this, link.uri);
                this.groups.push(current);
            }
            // append, check for equality first!
            if (current.children.length === 0 || $5b460a97be6401b7$export$f3299b77f3be0450._compareReferences(link, current.children[current.children.length - 1]) !== 0) {
                const oneRef = new $5b460a97be6401b7$export$5a16ca2afcb50c8b(providersFirst === link, current, link, (ref)=>this._onDidChangeReferenceRange.fire(ref));
                this.references.push(oneRef);
                current.children.push(oneRef);
            }
        }
    }
    dispose() {
        (0, $9cWcn.dispose)(this.groups);
        this._onDidChangeReferenceRange.dispose();
        this.groups.length = 0;
    }
    clone() {
        return new $5b460a97be6401b7$export$f3299b77f3be0450(this._links, this._title);
    }
    get title() {
        return this._title;
    }
    get isEmpty() {
        return this.groups.length === 0;
    }
    get ariaMessage() {
        if (this.isEmpty) return (0, $4dEdH.localize)('aria.result.0', "No results found");
        else if (this.references.length === 1) return (0, $4dEdH.localize)('aria.result.1', "Found 1 symbol in {0}", this.references[0].uri.fsPath);
        else if (this.groups.length === 1) return (0, $4dEdH.localize)('aria.result.n1', "Found {0} symbols in {1}", this.references.length, this.groups[0].uri.fsPath);
        else return (0, $4dEdH.localize)('aria.result.nm', "Found {0} symbols in {1} files", this.references.length, this.groups.length);
    }
    nextOrPreviousReference(reference, next) {
        const { parent: parent } = reference;
        let idx = parent.children.indexOf(reference);
        const childCount = parent.children.length;
        const groupCount = parent.parent.groups.length;
        if (groupCount === 1 || next && idx + 1 < childCount || !next && idx > 0) {
            // cycling within one file
            if (next) idx = (idx + 1) % childCount;
            else idx = (idx + childCount - 1) % childCount;
            return parent.children[idx];
        }
        idx = parent.parent.groups.indexOf(parent);
        if (next) {
            idx = (idx + 1) % groupCount;
            return parent.parent.groups[idx].children[0];
        } else {
            idx = (idx + groupCount - 1) % groupCount;
            return parent.parent.groups[idx].children[parent.parent.groups[idx].children.length - 1];
        }
    }
    nearestReference(resource, position) {
        const nearest = this.references.map((ref, idx)=>{
            return {
                idx: idx,
                prefixLen: $jcr1R.commonPrefixLength(ref.uri.toString(), resource.toString()),
                offsetDist: Math.abs(ref.range.startLineNumber - position.lineNumber) * 100 + Math.abs(ref.range.startColumn - position.column)
            };
        }).sort((a, b)=>{
            if (a.prefixLen > b.prefixLen) return -1;
            else if (a.prefixLen < b.prefixLen) return 1;
            else if (a.offsetDist < b.offsetDist) return -1;
            else if (a.offsetDist > b.offsetDist) return 1;
            else return 0;
        })[0];
        if (nearest) return this.references[nearest.idx];
        return undefined;
    }
    referenceAt(resource, position) {
        for (const ref of this.references)if (ref.uri.toString() === resource.toString()) {
            if ((0, $d00il.Range).containsPosition(ref.range, position)) return ref;
        }
        return undefined;
    }
    firstReference() {
        for (const ref of this.references){
            if (ref.isProviderFirst) return ref;
        }
        return this.references[0];
    }
    static _compareReferences(a, b) {
        return (0, $5Aea5.extUri).compare(a.uri, b.uri) || (0, $d00il.Range).compareRangesUsingStarts(a.range, b.range);
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $ilw5j = parcelRequire("ilw5j");

var $bjjQO = parcelRequire("bjjQO");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $8GPp8 = parcelRequire("8GPp8");

var $5Aea5 = parcelRequire("5Aea5");



var $d00il = parcelRequire("d00il");

var $91ntV = parcelRequire("91ntV");

var $9QNEO = parcelRequire("9QNEO");

var $aTkrt = parcelRequire("aTkrt");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $gmIgD = parcelRequire("gmIgD");

var $5WE8v = parcelRequire("5WE8v");

var $7XjKn = parcelRequire("7XjKn");

var $lk06m = parcelRequire("lk06m");

var $9cWcn = parcelRequire("9cWcn");

var $5Aea5 = parcelRequire("5Aea5");

var $aTkrt = parcelRequire("aTkrt");

var $4dEdH = parcelRequire("4dEdH");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $8GcbM = parcelRequire("8GcbM");

var $l1XLO = parcelRequire("l1XLO");

var $125e9033d246cf35$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $125e9033d246cf35$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $125e9033d246cf35$var$FileReferencesRenderer_1;
let $125e9033d246cf35$export$accd73d198d77d2f = class DataSource {
    constructor(_resolverService){
        this._resolverService = _resolverService;
    }
    hasChildren(element) {
        if (element instanceof (0, $5b460a97be6401b7$export$f3299b77f3be0450)) return true;
        if (element instanceof (0, $5b460a97be6401b7$export$abd311b1beafe84f)) return true;
        return false;
    }
    getChildren(element) {
        if (element instanceof (0, $5b460a97be6401b7$export$f3299b77f3be0450)) return element.groups;
        if (element instanceof (0, $5b460a97be6401b7$export$abd311b1beafe84f)) return element.resolve(this._resolverService).then((val)=>{
            // if (element.failure) {
            // 	// refresh the element on failure so that
            // 	// we can update its rendering
            // 	return tree.refresh(element).then(() => val.children);
            // }
            return val.children;
        });
        throw new Error('bad tree');
    }
};
$125e9033d246cf35$export$accd73d198d77d2f = $125e9033d246cf35$var$__decorate([
    $125e9033d246cf35$var$__param(0, (0, $aTkrt.ITextModelService))
], $125e9033d246cf35$export$accd73d198d77d2f);
class $125e9033d246cf35$export$2a8f9cc4e68431ea {
    getHeight() {
        return 23;
    }
    getTemplateId(element) {
        if (element instanceof (0, $5b460a97be6401b7$export$abd311b1beafe84f)) return $125e9033d246cf35$export$15497fea8d02acf6.id;
        else return $125e9033d246cf35$export$b181a089ad2d048d.id;
    }
}
let $125e9033d246cf35$export$5a1ff9bb06397f8e = class StringRepresentationProvider {
    constructor(_keybindingService){
        this._keybindingService = _keybindingService;
    }
    getKeyboardNavigationLabel(element) {
        if (element instanceof (0, $5b460a97be6401b7$export$5a16ca2afcb50c8b)) {
            const parts = element.parent.getPreview(element)?.preview(element.range);
            if (parts) return parts.value;
        }
        // FileReferences or unresolved OneReference
        return (0, $5Aea5.basename)(element.uri);
    }
};
$125e9033d246cf35$export$5a1ff9bb06397f8e = $125e9033d246cf35$var$__decorate([
    $125e9033d246cf35$var$__param(0, (0, $7IxGd.IKeybindingService))
], $125e9033d246cf35$export$5a1ff9bb06397f8e);
class $125e9033d246cf35$export$26106abfb5b2a456 {
    getId(element) {
        return element instanceof (0, $5b460a97be6401b7$export$5a16ca2afcb50c8b) ? element.id : element.uri;
    }
}
//#region render: File
let $125e9033d246cf35$var$FileReferencesTemplate = class FileReferencesTemplate extends (0, $9cWcn.Disposable) {
    constructor(container, _labelService){
        super();
        this._labelService = _labelService;
        const parent = document.createElement('div');
        parent.classList.add('reference-file');
        this.file = this._register(new (0, $7XjKn.IconLabel)(parent, {
            supportHighlights: true
        }));
        this.badge = new (0, $gmIgD.CountBadge)($bDzmQ.append(parent, $bDzmQ.$('.count')), {}, (0, $l1XLO.defaultCountBadgeStyles));
        container.appendChild(parent);
    }
    set(element, matches) {
        const parent = (0, $5Aea5.dirname)(element.uri);
        this.file.setLabel(this._labelService.getUriBasenameLabel(element.uri), this._labelService.getUriLabel(parent, {
            relative: true
        }), {
            title: this._labelService.getUriLabel(element.uri),
            matches: matches
        });
        const len = element.children.length;
        this.badge.setCount(len);
        if (len > 1) this.badge.setTitleFormat((0, $4dEdH.localize)('referencesCount', "{0} references", len));
        else this.badge.setTitleFormat((0, $4dEdH.localize)('referenceCount', "{0} reference", len));
    }
};
$125e9033d246cf35$var$FileReferencesTemplate = $125e9033d246cf35$var$__decorate([
    $125e9033d246cf35$var$__param(1, (0, $8GcbM.ILabelService))
], $125e9033d246cf35$var$FileReferencesTemplate);
let $125e9033d246cf35$export$15497fea8d02acf6 = class FileReferencesRenderer {
    static{
        $125e9033d246cf35$var$FileReferencesRenderer_1 = this;
    }
    static{
        this.id = 'FileReferencesRenderer';
    }
    constructor(_instantiationService){
        this._instantiationService = _instantiationService;
        this.templateId = $125e9033d246cf35$var$FileReferencesRenderer_1.id;
    }
    renderTemplate(container) {
        return this._instantiationService.createInstance($125e9033d246cf35$var$FileReferencesTemplate, container);
    }
    renderElement(node, index, template) {
        template.set(node.element, (0, $lk06m.createMatches)(node.filterData));
    }
    disposeTemplate(templateData) {
        templateData.dispose();
    }
};
$125e9033d246cf35$export$15497fea8d02acf6 = $125e9033d246cf35$var$FileReferencesRenderer_1 = $125e9033d246cf35$var$__decorate([
    $125e9033d246cf35$var$__param(0, (0, $fdGPu.IInstantiationService))
], $125e9033d246cf35$export$15497fea8d02acf6);
//#endregion
//#region render: Reference
class $125e9033d246cf35$var$OneReferenceTemplate extends (0, $9cWcn.Disposable) {
    constructor(container){
        super();
        this.label = this._register(new (0, $5WE8v.HighlightedLabel)(container));
    }
    set(element, score) {
        const preview = element.parent.getPreview(element)?.preview(element.range);
        if (!preview || !preview.value) // this means we FAILED to resolve the document or the value is the empty string
        this.label.set(`${(0, $5Aea5.basename)(element.uri)}:${element.range.startLineNumber + 1}:${element.range.startColumn + 1}`);
        else {
            // render search match as highlight unless
            // we have score, then render the score
            const { value: value, highlight: highlight } = preview;
            if (score && !(0, $lk06m.FuzzyScore).isDefault(score)) {
                this.label.element.classList.toggle('referenceMatch', false);
                this.label.set(value, (0, $lk06m.createMatches)(score));
            } else {
                this.label.element.classList.toggle('referenceMatch', true);
                this.label.set(value, [
                    highlight
                ]);
            }
        }
    }
}
class $125e9033d246cf35$export$b181a089ad2d048d {
    constructor(){
        this.templateId = $125e9033d246cf35$export$b181a089ad2d048d.id;
    }
    static{
        this.id = 'OneReferenceRenderer';
    }
    renderTemplate(container) {
        return new $125e9033d246cf35$var$OneReferenceTemplate(container);
    }
    renderElement(node, index, templateData) {
        templateData.set(node.element, node.filterData);
    }
    disposeTemplate(templateData) {
        templateData.dispose();
    }
}
class $125e9033d246cf35$export$aa8739b876e4b61f {
    getWidgetAriaLabel() {
        return (0, $4dEdH.localize)('treeAriaLabel', "References");
    }
    getAriaLabel(element) {
        return element.ariaMessage;
    }
}




var $4dEdH = parcelRequire("4dEdH");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $8GcbM = parcelRequire("8GcbM");

var $7UXCS = parcelRequire("7UXCS");

var $azIPz = parcelRequire("azIPz");

var $c2be12bba33f3dc6$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c2be12bba33f3dc6$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $c2be12bba33f3dc6$var$DecorationsManager {
    static{
        this.DecorationOptions = (0, $91ntV.ModelDecorationOptions).register({
            description: 'reference-decoration',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            className: 'reference-decoration'
        });
    }
    constructor(_editor, _model){
        this._editor = _editor;
        this._model = _model;
        this._decorations = new Map();
        this._decorationIgnoreSet = new Set();
        this._callOnDispose = new (0, $9cWcn.DisposableStore)();
        this._callOnModelChange = new (0, $9cWcn.DisposableStore)();
        this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged()));
        this._onModelChanged();
    }
    dispose() {
        this._callOnModelChange.dispose();
        this._callOnDispose.dispose();
        this.removeDecorations();
    }
    _onModelChanged() {
        this._callOnModelChange.clear();
        const model = this._editor.getModel();
        if (!model) return;
        for (const ref of this._model.references)if (ref.uri.toString() === model.uri.toString()) {
            this._addDecorations(ref.parent);
            return;
        }
    }
    _addDecorations(reference) {
        if (!this._editor.hasModel()) return;
        this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));
        const newDecorations = [];
        const newDecorationsActualIndex = [];
        for(let i = 0, len = reference.children.length; i < len; i++){
            const oneReference = reference.children[i];
            if (this._decorationIgnoreSet.has(oneReference.id)) continue;
            if (oneReference.uri.toString() !== this._editor.getModel().uri.toString()) continue;
            newDecorations.push({
                range: oneReference.range,
                options: $c2be12bba33f3dc6$var$DecorationsManager.DecorationOptions
            });
            newDecorationsActualIndex.push(i);
        }
        this._editor.changeDecorations((changeAccessor)=>{
            const decorations = changeAccessor.deltaDecorations([], newDecorations);
            for(let i = 0; i < decorations.length; i++)this._decorations.set(decorations[i], reference.children[newDecorationsActualIndex[i]]);
        });
    }
    _onDecorationChanged() {
        const toRemove = [];
        const model = this._editor.getModel();
        if (!model) return;
        for (const [decorationId, reference] of this._decorations){
            const newRange = model.getDecorationRange(decorationId);
            if (!newRange) continue;
            let ignore = false;
            if ((0, $d00il.Range).equalsRange(newRange, reference.range)) continue;
            if ((0, $d00il.Range).spansMultipleLines(newRange)) ignore = true;
            else {
                const lineLength = reference.range.endColumn - reference.range.startColumn;
                const newLineLength = newRange.endColumn - newRange.startColumn;
                if (lineLength !== newLineLength) ignore = true;
            }
            if (ignore) {
                this._decorationIgnoreSet.add(reference.id);
                toRemove.push(decorationId);
            } else reference.range = newRange;
        }
        for(let i = 0, len = toRemove.length; i < len; i++)this._decorations.delete(toRemove[i]);
        this._editor.removeDecorations(toRemove);
    }
    removeDecorations() {
        this._editor.removeDecorations([
            ...this._decorations.keys()
        ]);
        this._decorations.clear();
    }
}
class $c2be12bba33f3dc6$export$276a580b24a20d1 {
    constructor(){
        this.ratio = 0.7;
        this.heightInLines = 18;
    }
    static fromJSON(raw) {
        let ratio;
        let heightInLines;
        try {
            const data = JSON.parse(raw);
            ratio = data.ratio;
            heightInLines = data.heightInLines;
        } catch  {
        //
        }
        return {
            ratio: ratio || 0.7,
            heightInLines: heightInLines || 18
        };
    }
}
class $c2be12bba33f3dc6$var$ReferencesTree extends (0, $7UXCS.WorkbenchAsyncDataTree) {
}
/**
 * ZoneWidget that is shown inside the editor
 */ let $c2be12bba33f3dc6$export$a6aef00aae3b3577 = class ReferenceWidget extends $fb5054a30d54157b$export$85acc0ce60f75b9f {
    constructor(editor, _defaultTreeKeyboardSupport, layoutData, themeService, _textModelResolverService, _instantiationService, _peekViewService, _uriLabel, _keybindingService){
        super(editor, {
            showFrame: false,
            showArrow: true,
            isResizeable: true,
            isAccessible: true,
            supportOnTitleClick: true
        }, _instantiationService);
        this._defaultTreeKeyboardSupport = _defaultTreeKeyboardSupport;
        this.layoutData = layoutData;
        this._textModelResolverService = _textModelResolverService;
        this._instantiationService = _instantiationService;
        this._peekViewService = _peekViewService;
        this._uriLabel = _uriLabel;
        this._keybindingService = _keybindingService;
        this._disposeOnNewModel = new (0, $9cWcn.DisposableStore)();
        this._callOnDispose = new (0, $9cWcn.DisposableStore)();
        this._onDidSelectReference = new (0, $5YaSO.Emitter)();
        this.onDidSelectReference = this._onDidSelectReference.event;
        this._dim = new $bDzmQ.Dimension(0, 0);
        this._isClosing = false; // whether or not a dispose is already in progress
        this._applyTheme(themeService.getColorTheme());
        this._callOnDispose.add(themeService.onDidColorThemeChange(this._applyTheme.bind(this)));
        this._peekViewService.addExclusiveWidget(editor, this);
        this.create();
    }
    get isClosing() {
        return this._isClosing;
    }
    dispose() {
        this._isClosing = true;
        this.setModel(undefined);
        this._callOnDispose.dispose();
        this._disposeOnNewModel.dispose();
        (0, $9cWcn.dispose)(this._preview);
        (0, $9cWcn.dispose)(this._previewNotAvailableMessage);
        (0, $9cWcn.dispose)(this._tree);
        (0, $9cWcn.dispose)(this._previewModelReference);
        this._splitView.dispose();
        super.dispose();
    }
    _applyTheme(theme) {
        const borderColor = theme.getColor($fb5054a30d54157b$export$2d4f038d18170ad2) || (0, $bjjQO.Color).transparent;
        this.style({
            arrowColor: borderColor,
            frameColor: borderColor,
            headerBackgroundColor: theme.getColor($fb5054a30d54157b$export$b1e2a843606aa53d) || (0, $bjjQO.Color).transparent,
            primaryHeadingColor: theme.getColor($fb5054a30d54157b$export$5f7b8e8b47f91ad3),
            secondaryHeadingColor: theme.getColor($fb5054a30d54157b$export$cdda5f1c5d2481c1)
        });
    }
    show(where) {
        super.show(where, this.layoutData.heightInLines || 18);
    }
    focusOnReferenceTree() {
        this._tree.domFocus();
    }
    focusOnPreviewEditor() {
        this._preview.focus();
    }
    isPreviewEditorFocused() {
        return this._preview.hasTextFocus();
    }
    _onTitleClick(e) {
        if (this._preview && this._preview.getModel()) this._onDidSelectReference.fire({
            element: this._getFocusedReference(),
            kind: e.ctrlKey || e.metaKey || e.altKey ? 'side' : 'open',
            source: 'title'
        });
    }
    _fillBody(containerElement) {
        this.setCssClass('reference-zone-widget');
        // message pane
        this._messageContainer = $bDzmQ.append(containerElement, $bDzmQ.$('div.messages'));
        $bDzmQ.hide(this._messageContainer);
        this._splitView = new (0, $ilw5j.SplitView)(containerElement, {
            orientation: 1 /* Orientation.HORIZONTAL */ 
        });
        // editor
        this._previewContainer = $bDzmQ.append(containerElement, $bDzmQ.$('div.preview.inline'));
        const options = {
            scrollBeyondLastLine: false,
            scrollbar: {
                verticalScrollbarSize: 14,
                horizontal: 'auto',
                useShadows: true,
                verticalHasArrows: false,
                horizontalHasArrows: false,
                alwaysConsumeMouseWheel: true
            },
            overviewRulerLanes: 2,
            fixedOverflowWidgets: true,
            minimap: {
                enabled: false
            }
        };
        this._preview = this._instantiationService.createInstance((0, $205d91d7661de01d$export$3c7efbd913d316d0), this._previewContainer, options, {}, this.editor);
        $bDzmQ.hide(this._previewContainer);
        this._previewNotAvailableMessage = this._instantiationService.createInstance((0, $91ntV.TextModel), $4dEdH.localize('missingPreviewMessage', "no preview available"), (0, $9QNEO.PLAINTEXT_LANGUAGE_ID), (0, $91ntV.TextModel).DEFAULT_CREATION_OPTIONS, null);
        // tree
        this._treeContainer = $bDzmQ.append(containerElement, $bDzmQ.$('div.ref-tree.inline'));
        const treeOptions = {
            keyboardSupport: this._defaultTreeKeyboardSupport,
            accessibilityProvider: new (0, $125e9033d246cf35$export$aa8739b876e4b61f)(),
            keyboardNavigationLabelProvider: this._instantiationService.createInstance((0, $125e9033d246cf35$export$5a1ff9bb06397f8e)),
            identityProvider: new (0, $125e9033d246cf35$export$26106abfb5b2a456)(),
            openOnSingleClick: true,
            selectionNavigation: true,
            overrideStyles: {
                listBackground: $fb5054a30d54157b$export$84f26812d83dda36
            }
        };
        if (this._defaultTreeKeyboardSupport) // the tree will consume `Escape` and prevent the widget from closing
        this._callOnDispose.add($bDzmQ.addStandardDisposableListener(this._treeContainer, 'keydown', (e)=>{
            if (e.equals(9 /* KeyCode.Escape */ )) {
                this._keybindingService.dispatchEvent(e, e.target);
                e.stopPropagation();
            }
        }, true));
        this._tree = this._instantiationService.createInstance($c2be12bba33f3dc6$var$ReferencesTree, 'ReferencesWidget', this._treeContainer, new (0, $125e9033d246cf35$export$2a8f9cc4e68431ea)(), [
            this._instantiationService.createInstance((0, $125e9033d246cf35$export$15497fea8d02acf6)),
            this._instantiationService.createInstance((0, $125e9033d246cf35$export$b181a089ad2d048d))
        ], this._instantiationService.createInstance((0, $125e9033d246cf35$export$accd73d198d77d2f)), treeOptions);
        // split stuff
        this._splitView.addView({
            onDidChange: (0, $5YaSO.Event).None,
            element: this._previewContainer,
            minimumSize: 200,
            maximumSize: Number.MAX_VALUE,
            layout: (width)=>{
                this._preview.layout({
                    height: this._dim.height,
                    width: width
                });
            }
        }, (0, $ilw5j.Sizing).Distribute);
        this._splitView.addView({
            onDidChange: (0, $5YaSO.Event).None,
            element: this._treeContainer,
            minimumSize: 100,
            maximumSize: Number.MAX_VALUE,
            layout: (width)=>{
                this._treeContainer.style.height = `${this._dim.height}px`;
                this._treeContainer.style.width = `${width}px`;
                this._tree.layout(this._dim.height, width);
            }
        }, (0, $ilw5j.Sizing).Distribute);
        this._disposables.add(this._splitView.onDidSashChange(()=>{
            if (this._dim.width) this.layoutData.ratio = this._splitView.getViewSize(0) / this._dim.width;
        }, undefined));
        // listen on selection and focus
        const onEvent = (element, kind)=>{
            if (element instanceof (0, $5b460a97be6401b7$export$5a16ca2afcb50c8b)) {
                if (kind === 'show') this._revealReference(element, false);
                this._onDidSelectReference.fire({
                    element: element,
                    kind: kind,
                    source: 'tree'
                });
            }
        };
        this._disposables.add(this._tree.onDidOpen((e)=>{
            if (e.sideBySide) onEvent(e.element, 'side');
            else if (e.editorOptions.pinned) onEvent(e.element, 'goto');
            else onEvent(e.element, 'show');
        }));
        $bDzmQ.hide(this._treeContainer);
    }
    _onWidth(width) {
        if (this._dim) this._doLayoutBody(this._dim.height, width);
    }
    _doLayoutBody(heightInPixel, widthInPixel) {
        super._doLayoutBody(heightInPixel, widthInPixel);
        this._dim = new $bDzmQ.Dimension(widthInPixel, heightInPixel);
        this.layoutData.heightInLines = this._viewZone ? this._viewZone.heightInLines : this.layoutData.heightInLines;
        this._splitView.layout(widthInPixel);
        this._splitView.resizeView(0, widthInPixel * this.layoutData.ratio);
    }
    setSelection(selection) {
        return this._revealReference(selection, true).then(()=>{
            if (!this._model) // disposed
            return;
            // show in tree
            this._tree.setSelection([
                selection
            ]);
            this._tree.setFocus([
                selection
            ]);
        });
    }
    setModel(newModel) {
        // clean up
        this._disposeOnNewModel.clear();
        this._model = newModel;
        if (this._model) return this._onNewModel();
        return Promise.resolve();
    }
    _onNewModel() {
        if (!this._model) return Promise.resolve(undefined);
        if (this._model.isEmpty) {
            this.setTitle('');
            this._messageContainer.innerText = $4dEdH.localize('noResults', "No results");
            $bDzmQ.show(this._messageContainer);
            return Promise.resolve(undefined);
        }
        $bDzmQ.hide(this._messageContainer);
        this._decorationsManager = new $c2be12bba33f3dc6$var$DecorationsManager(this._preview, this._model);
        this._disposeOnNewModel.add(this._decorationsManager);
        // listen on model changes
        this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange((reference)=>this._tree.rerender(reference)));
        // listen on editor
        this._disposeOnNewModel.add(this._preview.onMouseDown((e)=>{
            const { event: event, target: target } = e;
            if (event.detail !== 2) return;
            const element = this._getFocusedReference();
            if (!element) return;
            this._onDidSelectReference.fire({
                element: {
                    uri: element.uri,
                    range: target.range
                },
                kind: event.ctrlKey || event.metaKey || event.altKey ? 'side' : 'open',
                source: 'editor'
            });
        }));
        // make sure things are rendered
        this.container.classList.add('results-loaded');
        $bDzmQ.show(this._treeContainer);
        $bDzmQ.show(this._previewContainer);
        this._splitView.layout(this._dim.width);
        this.focusOnReferenceTree();
        // pick input and a reference to begin with
        return this._tree.setInput(this._model.groups.length === 1 ? this._model.groups[0] : this._model);
    }
    _getFocusedReference() {
        const [element] = this._tree.getFocus();
        if (element instanceof (0, $5b460a97be6401b7$export$5a16ca2afcb50c8b)) return element;
        else if (element instanceof (0, $5b460a97be6401b7$export$abd311b1beafe84f)) {
            if (element.children.length > 0) return element.children[0];
        }
        return undefined;
    }
    async revealReference(reference) {
        await this._revealReference(reference, false);
        this._onDidSelectReference.fire({
            element: reference,
            kind: 'goto',
            source: 'tree'
        });
    }
    async _revealReference(reference, revealParent) {
        // check if there is anything to do...
        if (this._revealedReference === reference) return;
        this._revealedReference = reference;
        // Update widget header
        if (reference.uri.scheme !== (0, $8GPp8.Schemas).inMemory) this.setTitle((0, $5Aea5.basenameOrAuthority)(reference.uri), this._uriLabel.getUriLabel((0, $5Aea5.dirname)(reference.uri)));
        else this.setTitle($4dEdH.localize('peekView.alternateTitle', "References"));
        const promise = this._textModelResolverService.createModelReference(reference.uri);
        if (this._tree.getInput() === reference.parent) this._tree.reveal(reference);
        else {
            if (revealParent) this._tree.reveal(reference.parent);
            await this._tree.expand(reference.parent);
            this._tree.reveal(reference);
        }
        const ref = await promise;
        if (!this._model) {
            // disposed
            ref.dispose();
            return;
        }
        (0, $9cWcn.dispose)(this._previewModelReference);
        // show in editor
        const model = ref.object;
        if (model) {
            const scrollType = this._preview.getModel() === model.textEditorModel ? 0 /* ScrollType.Smooth */  : 1 /* ScrollType.Immediate */ ;
            const sel = (0, $d00il.Range).lift(reference.range).collapseToStart();
            this._previewModelReference = ref;
            this._preview.setModel(model.textEditorModel);
            this._preview.setSelection(sel);
            this._preview.revealRangeInCenter(sel, scrollType);
        } else {
            this._preview.setModel(this._previewNotAvailableMessage);
            ref.dispose();
        }
    }
};
$c2be12bba33f3dc6$export$a6aef00aae3b3577 = $c2be12bba33f3dc6$var$__decorate([
    $c2be12bba33f3dc6$var$__param(3, (0, $azIPz.IThemeService)),
    $c2be12bba33f3dc6$var$__param(4, (0, $aTkrt.ITextModelService)),
    $c2be12bba33f3dc6$var$__param(5, (0, $fdGPu.IInstantiationService)),
    $c2be12bba33f3dc6$var$__param(6, $fb5054a30d54157b$export$8277d1187e5db7d6),
    $c2be12bba33f3dc6$var$__param(7, (0, $8GcbM.ILabelService)),
    $c2be12bba33f3dc6$var$__param(8, (0, $7IxGd.IKeybindingService))
], $c2be12bba33f3dc6$export$a6aef00aae3b3577);



var $ibKGQ = parcelRequire("ibKGQ");

var $h84gy = parcelRequire("h84gy");
var $cbeaa13ed7da71f5$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $cbeaa13ed7da71f5$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $cbeaa13ed7da71f5$var$ReferencesController_1;
const $cbeaa13ed7da71f5$export$8ecb7f78c7d67b70 = new (0, $cxCeF.RawContextKey)('referenceSearchVisible', false, $4dEdH.localize('referenceSearchVisible', "Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));
let $cbeaa13ed7da71f5$export$60e6f978b59c492d = class ReferencesController {
    static{
        $cbeaa13ed7da71f5$var$ReferencesController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.referencesController';
    }
    static get(editor) {
        return editor.getContribution($cbeaa13ed7da71f5$var$ReferencesController_1.ID);
    }
    constructor(_defaultTreeKeyboardSupport, _editor, contextKeyService, _editorService, _notificationService, _instantiationService, _storageService, _configurationService){
        this._defaultTreeKeyboardSupport = _defaultTreeKeyboardSupport;
        this._editor = _editor;
        this._editorService = _editorService;
        this._notificationService = _notificationService;
        this._instantiationService = _instantiationService;
        this._storageService = _storageService;
        this._configurationService = _configurationService;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._requestIdPool = 0;
        this._ignoreModelChangeEvent = false;
        this._referenceSearchVisible = $cbeaa13ed7da71f5$export$8ecb7f78c7d67b70.bindTo(contextKeyService);
    }
    dispose() {
        this._referenceSearchVisible.reset();
        this._disposables.dispose();
        this._widget?.dispose();
        this._model?.dispose();
        this._widget = undefined;
        this._model = undefined;
    }
    toggleWidget(range, modelPromise, peekMode) {
        // close current widget and return early is position didn't change
        let widgetPosition;
        if (this._widget) widgetPosition = this._widget.position;
        this.closeWidget();
        if (!!widgetPosition && range.containsPosition(widgetPosition)) return;
        this._peekMode = peekMode;
        this._referenceSearchVisible.set(true);
        // close the widget on model/mode changes
        this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{
            this.closeWidget();
        }));
        this._disposables.add(this._editor.onDidChangeModel(()=>{
            if (!this._ignoreModelChangeEvent) this.closeWidget();
        }));
        const storageKey = 'peekViewLayout';
        const data = (0, $c2be12bba33f3dc6$export$276a580b24a20d1).fromJSON(this._storageService.get(storageKey, 0 /* StorageScope.PROFILE */ , '{}'));
        this._widget = this._instantiationService.createInstance((0, $c2be12bba33f3dc6$export$a6aef00aae3b3577), this._editor, this._defaultTreeKeyboardSupport, data);
        this._widget.setTitle($4dEdH.localize('labelLoading', "Loading..."));
        this._widget.show(range);
        this._disposables.add(this._widget.onDidClose(()=>{
            modelPromise.cancel();
            if (this._widget) {
                this._storageService.store(storageKey, JSON.stringify(this._widget.layoutData), 0 /* StorageScope.PROFILE */ , 1 /* StorageTarget.MACHINE */ );
                if (!this._widget.isClosing) // to prevent calling this too many times, check whether it was already closing.
                this.closeWidget();
                this._widget = undefined;
            } else this.closeWidget();
        }));
        this._disposables.add(this._widget.onDidSelectReference((event)=>{
            const { element: element, kind: kind } = event;
            if (!element) return;
            switch(kind){
                case 'open':
                    if (event.source !== 'editor' || !this._configurationService.getValue('editor.stablePeek')) // when stable peek is configured we don't close
                    // the peek window on selecting the editor
                    this.openReference(element, false, false);
                    break;
                case 'side':
                    this.openReference(element, true, false);
                    break;
                case 'goto':
                    if (peekMode) this._gotoReference(element, true);
                    else this.openReference(element, false, true);
                    break;
            }
        }));
        const requestId = ++this._requestIdPool;
        modelPromise.then((model)=>{
            // still current request? widget still open?
            if (requestId !== this._requestIdPool || !this._widget) {
                model.dispose();
                return undefined;
            }
            this._model?.dispose();
            this._model = model;
            // show widget
            return this._widget.setModel(this._model).then(()=>{
                if (this._widget && this._model && this._editor.hasModel()) {
                    // set title
                    if (!this._model.isEmpty) this._widget.setMetaTitle($4dEdH.localize('metaTitle.N', "{0} ({1})", this._model.title, this._model.references.length));
                    else this._widget.setMetaTitle('');
                    // set 'best' selection
                    const uri = this._editor.getModel().uri;
                    const pos = new (0, $dcxQ7.Position)(range.startLineNumber, range.startColumn);
                    const selection = this._model.nearestReference(uri, pos);
                    if (selection) return this._widget.setSelection(selection).then(()=>{
                        if (this._widget && this._editor.getOption(87 /* EditorOption.peekWidgetDefaultFocus */ ) === 'editor') this._widget.focusOnPreviewEditor();
                    });
                }
                return undefined;
            });
        }, (error)=>{
            this._notificationService.error(error);
        });
    }
    changeFocusBetweenPreviewAndReferences() {
        if (!this._widget) // can be called while still resolving...
        return;
        if (this._widget.isPreviewEditorFocused()) this._widget.focusOnReferenceTree();
        else this._widget.focusOnPreviewEditor();
    }
    async goToNextOrPreviousReference(fwd) {
        if (!this._editor.hasModel() || !this._model || !this._widget) // can be called while still resolving...
        return;
        const currentPosition = this._widget.position;
        if (!currentPosition) return;
        const source = this._model.nearestReference(this._editor.getModel().uri, currentPosition);
        if (!source) return;
        const target = this._model.nextOrPreviousReference(source, fwd);
        const editorFocus = this._editor.hasTextFocus();
        const previewEditorFocus = this._widget.isPreviewEditorFocused();
        await this._widget.setSelection(target);
        await this._gotoReference(target, false);
        if (editorFocus) this._editor.focus();
        else if (this._widget && previewEditorFocus) this._widget.focusOnPreviewEditor();
    }
    async revealReference(reference) {
        if (!this._editor.hasModel() || !this._model || !this._widget) // can be called while still resolving...
        return;
        await this._widget.revealReference(reference);
    }
    closeWidget(focusEditor = true) {
        this._widget?.dispose();
        this._model?.dispose();
        this._referenceSearchVisible.reset();
        this._disposables.clear();
        this._widget = undefined;
        this._model = undefined;
        if (focusEditor) this._editor.focus();
        this._requestIdPool += 1; // Cancel pending requests
    }
    _gotoReference(ref, pinned) {
        this._widget?.hide();
        this._ignoreModelChangeEvent = true;
        const range = (0, $d00il.Range).lift(ref.range).collapseToStart();
        return this._editorService.openCodeEditor({
            resource: ref.uri,
            options: {
                selection: range,
                selectionSource: "code.jump" /* TextEditorSelectionSource.JUMP */ ,
                pinned: pinned
            }
        }, this._editor).then((openedEditor)=>{
            this._ignoreModelChangeEvent = false;
            if (!openedEditor || !this._widget) {
                // something went wrong...
                this.closeWidget();
                return;
            }
            if (this._editor === openedEditor) {
                //
                this._widget.show(range);
                this._widget.focusOnReferenceTree();
            } else {
                // we opened a different editor instance which means a different controller instance.
                // therefore we stop with this controller and continue with the other
                const other = $cbeaa13ed7da71f5$var$ReferencesController_1.get(openedEditor);
                const model = this._model.clone();
                this.closeWidget();
                openedEditor.focus();
                other?.toggleWidget(range, (0, $6bXyA.createCancelablePromise)((_)=>Promise.resolve(model)), this._peekMode ?? false);
            }
        }, (err)=>{
            this._ignoreModelChangeEvent = false;
            (0, $gPkHZ.onUnexpectedError)(err);
        });
    }
    openReference(ref, sideBySide, pinned) {
        // clear stage
        if (!sideBySide) this.closeWidget();
        const { uri: uri, range: range } = ref;
        this._editorService.openCodeEditor({
            resource: uri,
            options: {
                selection: range,
                selectionSource: "code.jump" /* TextEditorSelectionSource.JUMP */ ,
                pinned: pinned
            }
        }, this._editor, sideBySide);
    }
};
$cbeaa13ed7da71f5$export$60e6f978b59c492d = $cbeaa13ed7da71f5$var$ReferencesController_1 = $cbeaa13ed7da71f5$var$__decorate([
    $cbeaa13ed7da71f5$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $cbeaa13ed7da71f5$var$__param(3, (0, $2Qfl0.ICodeEditorService)),
    $cbeaa13ed7da71f5$var$__param(4, (0, $kCOKl.INotificationService)),
    $cbeaa13ed7da71f5$var$__param(5, (0, $fdGPu.IInstantiationService)),
    $cbeaa13ed7da71f5$var$__param(6, (0, $2AUoS.IStorageService)),
    $cbeaa13ed7da71f5$var$__param(7, (0, $35IZ9.IConfigurationService))
], $cbeaa13ed7da71f5$export$60e6f978b59c492d);
function $cbeaa13ed7da71f5$var$withController(accessor, fn) {
    const outerEditor = (0, $fb5054a30d54157b$export$434a98f74be8c7b9)(accessor);
    if (!outerEditor) return;
    const controller = $cbeaa13ed7da71f5$export$60e6f978b59c492d.get(outerEditor);
    if (controller) fn(controller);
}
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'togglePeekWidgetFocus',
    weight: 100 /* KeybindingWeight.EditorContrib */ ,
    primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 60 /* KeyCode.F2 */ ),
    when: (0, $cxCeF.ContextKeyExpr).or($cbeaa13ed7da71f5$export$8ecb7f78c7d67b70, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).inPeekEditor),
    handler (accessor) {
        $cbeaa13ed7da71f5$var$withController(accessor, (controller)=>{
            controller.changeFocusBetweenPreviewAndReferences();
        });
    }
});
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'goToNextReference',
    weight: 90,
    primary: 62 /* KeyCode.F4 */ ,
    secondary: [
        70 /* KeyCode.F12 */ 
    ],
    when: (0, $cxCeF.ContextKeyExpr).or($cbeaa13ed7da71f5$export$8ecb7f78c7d67b70, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).inPeekEditor),
    handler (accessor) {
        $cbeaa13ed7da71f5$var$withController(accessor, (controller)=>{
            controller.goToNextOrPreviousReference(true);
        });
    }
});
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'goToPreviousReference',
    weight: 90,
    primary: 1086 /* KeyCode.F4 */ ,
    secondary: [
        1094 /* KeyCode.F12 */ 
    ],
    when: (0, $cxCeF.ContextKeyExpr).or($cbeaa13ed7da71f5$export$8ecb7f78c7d67b70, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).inPeekEditor),
    handler (accessor) {
        $cbeaa13ed7da71f5$var$withController(accessor, (controller)=>{
            controller.goToNextOrPreviousReference(false);
        });
    }
});
// commands that aren't needed anymore because there is now ContextKeyExpr.OR
(0, $8tcMz.CommandsRegistry).registerCommandAlias('goToNextReferenceFromEmbeddedEditor', 'goToNextReference');
(0, $8tcMz.CommandsRegistry).registerCommandAlias('goToPreviousReferenceFromEmbeddedEditor', 'goToPreviousReference');
// close
(0, $8tcMz.CommandsRegistry).registerCommandAlias('closeReferenceSearchEditor', 'closeReferenceSearch');
(0, $8tcMz.CommandsRegistry).registerCommand('closeReferenceSearch', (accessor)=>$cbeaa13ed7da71f5$var$withController(accessor, (controller)=>controller.closeWidget()));
(0, $6AWYG.KeybindingsRegistry).registerKeybindingRule({
    id: 'closeReferenceSearch',
    weight: -1,
    primary: 9 /* KeyCode.Escape */ ,
    secondary: [
        1033 /* KeyCode.Escape */ 
    ],
    when: (0, $cxCeF.ContextKeyExpr).and((0, $fb5054a30d54157b$export$5afd50a7c05ff96a).inPeekEditor, (0, $cxCeF.ContextKeyExpr).not('config.editor.stablePeek'))
});
(0, $6AWYG.KeybindingsRegistry).registerKeybindingRule({
    id: 'closeReferenceSearch',
    weight: 250,
    primary: 9 /* KeyCode.Escape */ ,
    secondary: [
        1033 /* KeyCode.Escape */ 
    ],
    when: (0, $cxCeF.ContextKeyExpr).and($cbeaa13ed7da71f5$export$8ecb7f78c7d67b70, (0, $cxCeF.ContextKeyExpr).not('config.editor.stablePeek'), (0, $cxCeF.ContextKeyExpr).or((0, $ibKGQ.EditorContextKeys).editorTextFocus, (0, $h84gy.InputFocusedContext).negate()))
});
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'revealReference',
    weight: 200 /* KeybindingWeight.WorkbenchContrib */ ,
    primary: 3 /* KeyCode.Enter */ ,
    mac: {
        primary: 3 /* KeyCode.Enter */ ,
        secondary: [
            2066 /* KeyCode.DownArrow */ 
        ]
    },
    when: (0, $cxCeF.ContextKeyExpr).and($cbeaa13ed7da71f5$export$8ecb7f78c7d67b70, (0, $7UXCS.WorkbenchListFocusContextKey), (0, $7UXCS.WorkbenchTreeElementCanCollapse).negate(), (0, $7UXCS.WorkbenchTreeElementCanExpand).negate()),
    handler (accessor) {
        const listService = accessor.get((0, $7UXCS.IListService));
        const focus = listService.lastFocusedList?.getFocus();
        if (Array.isArray(focus) && focus[0] instanceof (0, $5b460a97be6401b7$export$5a16ca2afcb50c8b)) $cbeaa13ed7da71f5$var$withController(accessor, (controller)=>controller.revealReference(focus[0]));
    }
});
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'openReferenceToSide',
    weight: 100 /* KeybindingWeight.EditorContrib */ ,
    primary: 2051 /* KeyCode.Enter */ ,
    mac: {
        primary: 259 /* KeyCode.Enter */ 
    },
    when: (0, $cxCeF.ContextKeyExpr).and($cbeaa13ed7da71f5$export$8ecb7f78c7d67b70, (0, $7UXCS.WorkbenchListFocusContextKey), (0, $7UXCS.WorkbenchTreeElementCanCollapse).negate(), (0, $7UXCS.WorkbenchTreeElementCanExpand).negate()),
    handler (accessor) {
        const listService = accessor.get((0, $7UXCS.IListService));
        const focus = listService.lastFocusedList?.getFocus();
        if (Array.isArray(focus) && focus[0] instanceof (0, $5b460a97be6401b7$export$5a16ca2afcb50c8b)) $cbeaa13ed7da71f5$var$withController(accessor, (controller)=>controller.openReference(focus[0], true, true));
    }
});
(0, $8tcMz.CommandsRegistry).registerCommand('openReference', (accessor)=>{
    const listService = accessor.get((0, $7UXCS.IListService));
    const focus = listService.lastFocusedList?.getFocus();
    if (Array.isArray(focus) && focus[0] instanceof (0, $5b460a97be6401b7$export$5a16ca2afcb50c8b)) $cbeaa13ed7da71f5$var$withController(accessor, (controller)=>controller.openReference(focus[0], false, true));
});



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $5Aea5 = parcelRequire("5Aea5");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $d00il = parcelRequire("d00il");

var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $6AWYG = parcelRequire("6AWYG");

var $kCOKl = parcelRequire("kCOKl");
var $49acf92d5615c20a$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $49acf92d5615c20a$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $49acf92d5615c20a$export$8abaed58afa3da78 = new (0, $cxCeF.RawContextKey)('hasSymbols', false, (0, $4dEdH.localize)('hasSymbols', "Whether there are symbol locations that can be navigated via keyboard-only."));
const $49acf92d5615c20a$export$feb1d4817f01196e = (0, $fdGPu.createDecorator)('ISymbolNavigationService');
let $49acf92d5615c20a$var$SymbolNavigationService = class SymbolNavigationService {
    constructor(contextKeyService, _editorService, _notificationService, _keybindingService){
        this._editorService = _editorService;
        this._notificationService = _notificationService;
        this._keybindingService = _keybindingService;
        this._currentModel = undefined;
        this._currentIdx = -1;
        this._ignoreEditorChange = false;
        this._ctxHasSymbols = $49acf92d5615c20a$export$8abaed58afa3da78.bindTo(contextKeyService);
    }
    reset() {
        this._ctxHasSymbols.reset();
        this._currentState?.dispose();
        this._currentMessage?.dispose();
        this._currentModel = undefined;
        this._currentIdx = -1;
    }
    put(anchor) {
        const refModel = anchor.parent.parent;
        if (refModel.references.length <= 1) {
            this.reset();
            return;
        }
        this._currentModel = refModel;
        this._currentIdx = refModel.references.indexOf(anchor);
        this._ctxHasSymbols.set(true);
        this._showMessage();
        const editorState = new $49acf92d5615c20a$var$EditorState(this._editorService);
        const listener = editorState.onDidChange((_)=>{
            if (this._ignoreEditorChange) return;
            const editor = this._editorService.getActiveCodeEditor();
            if (!editor) return;
            const model = editor.getModel();
            const position = editor.getPosition();
            if (!model || !position) return;
            let seenUri = false;
            let seenPosition = false;
            for (const reference of refModel.references){
                if ((0, $5Aea5.isEqual)(reference.uri, model.uri)) {
                    seenUri = true;
                    seenPosition = seenPosition || (0, $d00il.Range).containsPosition(reference.range, position);
                } else if (seenUri) break;
            }
            if (!seenUri || !seenPosition) this.reset();
        });
        this._currentState = (0, $9cWcn.combinedDisposable)(editorState, listener);
    }
    revealNext(source) {
        if (!this._currentModel) return Promise.resolve();
        // get next result and advance
        this._currentIdx += 1;
        this._currentIdx %= this._currentModel.references.length;
        const reference = this._currentModel.references[this._currentIdx];
        // status
        this._showMessage();
        // open editor, ignore events while that happens
        this._ignoreEditorChange = true;
        return this._editorService.openCodeEditor({
            resource: reference.uri,
            options: {
                selection: (0, $d00il.Range).collapseToStart(reference.range),
                selectionRevealType: 3 /* TextEditorSelectionRevealType.NearTopIfOutsideViewport */ 
            }
        }, source).finally(()=>{
            this._ignoreEditorChange = false;
        });
    }
    _showMessage() {
        this._currentMessage?.dispose();
        const kb = this._keybindingService.lookupKeybinding('editor.gotoNextSymbolFromResult');
        const message = kb ? (0, $4dEdH.localize)('location.kb', "Symbol {0} of {1}, {2} for next", this._currentIdx + 1, this._currentModel.references.length, kb.getLabel()) : (0, $4dEdH.localize)('location', "Symbol {0} of {1}", this._currentIdx + 1, this._currentModel.references.length);
        this._currentMessage = this._notificationService.status(message);
    }
};
$49acf92d5615c20a$var$SymbolNavigationService = $49acf92d5615c20a$var$__decorate([
    $49acf92d5615c20a$var$__param(0, (0, $cxCeF.IContextKeyService)),
    $49acf92d5615c20a$var$__param(1, (0, $2Qfl0.ICodeEditorService)),
    $49acf92d5615c20a$var$__param(2, (0, $kCOKl.INotificationService)),
    $49acf92d5615c20a$var$__param(3, (0, $7IxGd.IKeybindingService))
], $49acf92d5615c20a$var$SymbolNavigationService);
(0, $lf2vF.registerSingleton)($49acf92d5615c20a$export$feb1d4817f01196e, $49acf92d5615c20a$var$SymbolNavigationService, 1 /* InstantiationType.Delayed */ );
(0, $2iJTi.registerEditorCommand)(new class extends (0, $2iJTi.EditorCommand) {
    constructor(){
        super({
            id: 'editor.gotoNextSymbolFromResult',
            precondition: $49acf92d5615c20a$export$8abaed58afa3da78,
            kbOpts: {
                weight: 100 /* KeybindingWeight.EditorContrib */ ,
                primary: 70 /* KeyCode.F12 */ 
            }
        });
    }
    runEditorCommand(accessor, editor) {
        return accessor.get($49acf92d5615c20a$export$feb1d4817f01196e).revealNext(editor);
    }
});
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'editor.gotoNextSymbolFromResult.cancel',
    weight: 100 /* KeybindingWeight.EditorContrib */ ,
    when: $49acf92d5615c20a$export$8abaed58afa3da78,
    primary: 9 /* KeyCode.Escape */ ,
    handler (accessor) {
        accessor.get($49acf92d5615c20a$export$feb1d4817f01196e).reset();
    }
});
//
let $49acf92d5615c20a$var$EditorState = class EditorState {
    constructor(editorService){
        this._listener = new Map();
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._onDidChange = new (0, $5YaSO.Emitter)();
        this.onDidChange = this._onDidChange.event;
        this._disposables.add(editorService.onCodeEditorRemove(this._onDidRemoveEditor, this));
        this._disposables.add(editorService.onCodeEditorAdd(this._onDidAddEditor, this));
        editorService.listCodeEditors().forEach(this._onDidAddEditor, this);
    }
    dispose() {
        this._disposables.dispose();
        this._onDidChange.dispose();
        (0, $9cWcn.dispose)(this._listener.values());
    }
    _onDidAddEditor(editor) {
        this._listener.set(editor, (0, $9cWcn.combinedDisposable)(editor.onDidChangeCursorPosition((_)=>this._onDidChange.fire({
                editor: editor
            })), editor.onDidChangeModelContent((_)=>this._onDidChange.fire({
                editor: editor
            }))));
    }
    _onDidRemoveEditor(editor) {
        this._listener.get(editor)?.dispose();
        this._listener.delete(editor);
    }
};
$49acf92d5615c20a$var$EditorState = $49acf92d5615c20a$var$__decorate([
    $49acf92d5615c20a$var$__param(0, (0, $2Qfl0.ICodeEditorService))
], $49acf92d5615c20a$var$EditorState);





var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $kCOKl = parcelRequire("kCOKl");

var $4E7vx = parcelRequire("4E7vx");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $8GPp8 = parcelRequire("8GPp8");

var $2iJTi = parcelRequire("2iJTi");

var $4J6fu = parcelRequire("4J6fu");

function $398bbabbcbf6b57c$var$shouldIncludeLocationLink(sourceModel, loc) {
    // Always allow the location if the request comes from a document with the same scheme.
    if (loc.uri.scheme === sourceModel.uri.scheme) return true;
    // Otherwise filter out locations from internal schemes
    if ((0, $8GPp8.matchesSomeScheme)(loc.uri, (0, $8GPp8.Schemas).walkThroughSnippet, (0, $8GPp8.Schemas).vscodeChatCodeBlock, (0, $8GPp8.Schemas).vscodeChatCodeCompareBlock)) return false;
    return true;
}
async function $398bbabbcbf6b57c$var$getLocationLinks(model, position, registry, recursive, provide) {
    const provider = registry.ordered(model, recursive);
    // get results
    const promises = provider.map((provider)=>{
        return Promise.resolve(provide(provider, model, position)).then(undefined, (err)=>{
            (0, $gPkHZ.onUnexpectedExternalError)(err);
            return undefined;
        });
    });
    const values = await Promise.all(promises);
    return (0, $kJ8UG.coalesce)(values.flat()).filter((loc)=>$398bbabbcbf6b57c$var$shouldIncludeLocationLink(model, loc));
}
function $398bbabbcbf6b57c$export$6b9dcdfe32ab3450(registry, model, position, recursive, token) {
    return $398bbabbcbf6b57c$var$getLocationLinks(model, position, registry, recursive, (provider, model, position)=>{
        return provider.provideDefinition(model, position, token);
    });
}
function $398bbabbcbf6b57c$export$268ced517630b719(registry, model, position, recursive, token) {
    return $398bbabbcbf6b57c$var$getLocationLinks(model, position, registry, recursive, (provider, model, position)=>{
        return provider.provideDeclaration(model, position, token);
    });
}
function $398bbabbcbf6b57c$export$7d6802a2edcceb51(registry, model, position, recursive, token) {
    return $398bbabbcbf6b57c$var$getLocationLinks(model, position, registry, recursive, (provider, model, position)=>{
        return provider.provideImplementation(model, position, token);
    });
}
function $398bbabbcbf6b57c$export$e2b810cd1720408a(registry, model, position, recursive, token) {
    return $398bbabbcbf6b57c$var$getLocationLinks(model, position, registry, recursive, (provider, model, position)=>{
        return provider.provideTypeDefinition(model, position, token);
    });
}
function $398bbabbcbf6b57c$export$2bb33a4e47554443(registry, model, position, compact, recursive, token) {
    return $398bbabbcbf6b57c$var$getLocationLinks(model, position, registry, recursive, async (provider, model, position)=>{
        const result = (await provider.provideReferences(model, position, {
            includeDeclaration: true
        }, token))?.filter((ref)=>$398bbabbcbf6b57c$var$shouldIncludeLocationLink(model, ref));
        if (!compact || !result || result.length !== 2) return result;
        const resultWithoutDeclaration = (await provider.provideReferences(model, position, {
            includeDeclaration: false
        }, token))?.filter((ref)=>$398bbabbcbf6b57c$var$shouldIncludeLocationLink(model, ref));
        if (resultWithoutDeclaration && resultWithoutDeclaration.length === 1) return resultWithoutDeclaration;
        return result;
    });
}
// -- API commands ----
async function $398bbabbcbf6b57c$var$_sortedAndDeduped(callback) {
    const rawLinks = await callback();
    const model = new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(rawLinks, '');
    const modelLinks = model.references.map((ref)=>ref.link);
    model.dispose();
    return modelLinks;
}
(0, $2iJTi.registerModelAndPositionCommand)('_executeDefinitionProvider', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$6b9dcdfe32ab3450(languageFeaturesService.definitionProvider, model, position, false, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeDefinitionProvider_recursive', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$6b9dcdfe32ab3450(languageFeaturesService.definitionProvider, model, position, true, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeTypeDefinitionProvider', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$e2b810cd1720408a(languageFeaturesService.typeDefinitionProvider, model, position, false, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeTypeDefinitionProvider_recursive', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$e2b810cd1720408a(languageFeaturesService.typeDefinitionProvider, model, position, true, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeDeclarationProvider', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$268ced517630b719(languageFeaturesService.declarationProvider, model, position, false, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeDeclarationProvider_recursive', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$268ced517630b719(languageFeaturesService.declarationProvider, model, position, true, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeReferenceProvider', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$2bb33a4e47554443(languageFeaturesService.referenceProvider, model, position, false, false, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeReferenceProvider_recursive', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$2bb33a4e47554443(languageFeaturesService.referenceProvider, model, position, false, true, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeImplementationProvider', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$7d6802a2edcceb51(languageFeaturesService.implementationProvider, model, position, false, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executeImplementationProvider_recursive', (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const promise = $398bbabbcbf6b57c$export$7d6802a2edcceb51(languageFeaturesService.implementationProvider, model, position, true, (0, $giPcZ.CancellationToken).None);
    return $398bbabbcbf6b57c$var$_sortedAndDeduped(()=>promise);
});



var $4J6fu = parcelRequire("4J6fu");

var $6CAkM = parcelRequire("6CAkM");

var $h84gy = parcelRequire("h84gy");
(0, $g4v7E.MenuRegistry).appendMenuItem((0, $g4v7E.MenuId).EditorContext, {
    submenu: (0, $g4v7E.MenuId).EditorContextPeek,
    title: $4dEdH.localize('peek.submenu', "Peek"),
    group: 'navigation',
    order: 100
});
class $48e5d411b2010803$export$9e187f320a7b361f {
    static is(thing) {
        if (!thing || typeof thing !== 'object') return false;
        if (thing instanceof $48e5d411b2010803$export$9e187f320a7b361f) return true;
        if ($dcxQ7.Position.isIPosition(thing.position) && thing.model) return true;
        return false;
    }
    constructor(model, position){
        this.model = model;
        this.position = position;
    }
}
class $48e5d411b2010803$export$858184cc1f739c5d extends (0, $2iJTi.EditorAction2) {
    static{
        this._allSymbolNavigationCommands = new Map();
    }
    static{
        this._activeAlternativeCommands = new Set();
    }
    static all() {
        return $48e5d411b2010803$export$858184cc1f739c5d._allSymbolNavigationCommands.values();
    }
    static _patchConfig(opts) {
        const result = {
            ...opts,
            f1: true
        };
        // patch context menu when clause
        if (result.menu) {
            for (const item of (0, $6CAkM.Iterable).wrap(result.menu))if (item.id === (0, $g4v7E.MenuId).EditorContext || item.id === (0, $g4v7E.MenuId).EditorContextPeek) item.when = (0, $cxCeF.ContextKeyExpr).and(opts.precondition, item.when);
        }
        return result;
    }
    constructor(configuration, opts){
        super($48e5d411b2010803$export$858184cc1f739c5d._patchConfig(opts));
        this.configuration = configuration;
        $48e5d411b2010803$export$858184cc1f739c5d._allSymbolNavigationCommands.set(opts.id, this);
    }
    runEditorCommand(accessor, editor, arg, range) {
        if (!editor.hasModel()) return Promise.resolve(undefined);
        const notificationService = accessor.get((0, $kCOKl.INotificationService));
        const editorService = accessor.get((0, $2Qfl0.ICodeEditorService));
        const progressService = accessor.get((0, $4E7vx.IEditorProgressService));
        const symbolNavService = accessor.get((0, $49acf92d5615c20a$export$feb1d4817f01196e));
        const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
        const instaService = accessor.get((0, $fdGPu.IInstantiationService));
        const model = editor.getModel();
        const position = editor.getPosition();
        const anchor = $48e5d411b2010803$export$9e187f320a7b361f.is(arg) ? arg : new $48e5d411b2010803$export$9e187f320a7b361f(model, position);
        const cts = new (0, $lgoyH.EditorStateCancellationTokenSource)(editor, 5 /* CodeEditorStateFlag.Position */ );
        const promise = (0, $6bXyA.raceCancellation)(this._getLocationModel(languageFeaturesService, anchor.model, anchor.position, cts.token), cts.token).then(async (references)=>{
            if (!references || cts.token.isCancellationRequested) return;
            (0, $aIbUW.alert)(references.ariaMessage);
            let altAction;
            if (references.referenceAt(model.uri, position)) {
                const altActionId = this._getAlternativeCommand(editor);
                if (!$48e5d411b2010803$export$858184cc1f739c5d._activeAlternativeCommands.has(altActionId) && $48e5d411b2010803$export$858184cc1f739c5d._allSymbolNavigationCommands.has(altActionId)) altAction = $48e5d411b2010803$export$858184cc1f739c5d._allSymbolNavigationCommands.get(altActionId);
            }
            const referenceCount = references.references.length;
            if (referenceCount === 0) // no result -> show message
            {
                if (!this.configuration.muteMessage) {
                    const info = model.getWordAtPosition(position);
                    (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(editor)?.showMessage(this._getNoResultFoundMessage(info), position);
                }
            } else if (referenceCount === 1 && altAction) {
                // already at the only result, run alternative
                $48e5d411b2010803$export$858184cc1f739c5d._activeAlternativeCommands.add(this.desc.id);
                instaService.invokeFunction((accessor)=>altAction.runEditorCommand(accessor, editor, arg, range).finally(()=>{
                        $48e5d411b2010803$export$858184cc1f739c5d._activeAlternativeCommands.delete(this.desc.id);
                    }));
            } else // normal results handling
            return this._onResult(editorService, symbolNavService, editor, references, range);
        }, (err)=>{
            // report an error
            notificationService.error(err);
        }).finally(()=>{
            cts.dispose();
        });
        progressService.showWhile(promise, 250);
        return promise;
    }
    async _onResult(editorService, symbolNavService, editor, model, range) {
        const gotoLocation = this._getGoToPreference(editor);
        if (!(editor instanceof (0, $205d91d7661de01d$export$3c7efbd913d316d0)) && (this.configuration.openInPeek || gotoLocation === 'peek' && model.references.length > 1)) this._openInPeek(editor, model, range);
        else {
            const next = model.firstReference();
            const peek = model.references.length > 1 && gotoLocation === 'gotoAndPeek';
            const targetEditor = await this._openReference(editor, editorService, next, this.configuration.openToSide, !peek);
            if (peek && targetEditor) this._openInPeek(targetEditor, model, range);
            else model.dispose();
            // keep remaining locations around when using
            // 'goto'-mode
            if (gotoLocation === 'goto') symbolNavService.put(next);
        }
    }
    async _openReference(editor, editorService, reference, sideBySide, highlight) {
        // range is the target-selection-range when we have one
        // and the fallback is the 'full' range
        let range = undefined;
        if ((0, $kzNQX.isLocationLink)(reference)) range = reference.targetSelectionRange;
        if (!range) range = reference.range;
        if (!range) return undefined;
        const targetEditor = await editorService.openCodeEditor({
            resource: reference.uri,
            options: {
                selection: (0, $d00il.Range).collapseToStart(range),
                selectionRevealType: 3 /* TextEditorSelectionRevealType.NearTopIfOutsideViewport */ ,
                selectionSource: "code.jump" /* TextEditorSelectionSource.JUMP */ 
            }
        }, editor, sideBySide);
        if (!targetEditor) return undefined;
        if (highlight) {
            const modelNow = targetEditor.getModel();
            const decorations = targetEditor.createDecorationsCollection([
                {
                    range: range,
                    options: {
                        description: 'symbol-navigate-action-highlight',
                        className: 'symbolHighlight'
                    }
                }
            ]);
            setTimeout(()=>{
                if (targetEditor.getModel() === modelNow) decorations.clear();
            }, 350);
        }
        return targetEditor;
    }
    _openInPeek(target, model, range) {
        const controller = (0, $cbeaa13ed7da71f5$export$60e6f978b59c492d).get(target);
        if (controller && target.hasModel()) controller.toggleWidget(range ?? target.getSelection(), (0, $6bXyA.createCancelablePromise)((_)=>Promise.resolve(model)), this.configuration.openInPeek);
        else model.dispose();
    }
}
class $48e5d411b2010803$export$5aed1003b9513172 extends $48e5d411b2010803$export$858184cc1f739c5d {
    async _getLocationModel(languageFeaturesService, model, position, token) {
        return new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(await (0, $398bbabbcbf6b57c$export$6b9dcdfe32ab3450)(languageFeaturesService.definitionProvider, model, position, false, token), $4dEdH.localize('def.title', 'Definitions'));
    }
    _getNoResultFoundMessage(info) {
        return info && info.word ? $4dEdH.localize('noResultWord', "No definition found for '{0}'", info.word) : $4dEdH.localize('generic.noResults', "No definition found");
    }
    _getAlternativeCommand(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).alternativeDefinitionCommand;
    }
    _getGoToPreference(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).multipleDefinitions;
    }
}
(0, $g4v7E.registerAction2)(class GoToDefinitionAction extends $48e5d411b2010803$export$5aed1003b9513172 {
    static{
        this.id = 'editor.action.revealDefinition';
    }
    constructor(){
        super({
            openToSide: false,
            openInPeek: false,
            muteMessage: false
        }, {
            id: GoToDefinitionAction.id,
            title: {
                ...$4dEdH.localize2('actions.goToDecl.label', "Go to Definition"),
                mnemonicTitle: $4dEdH.localize({
                    key: 'miGotoDefinition',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Go to &&Definition")
            },
            precondition: (0, $ibKGQ.EditorContextKeys).hasDefinitionProvider,
            keybinding: [
                {
                    when: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                    primary: 70 /* KeyCode.F12 */ ,
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                },
                {
                    when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).editorTextFocus, (0, $h84gy.IsWebContext)),
                    primary: 2118 /* KeyCode.F12 */ ,
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                }
            ],
            menu: [
                {
                    id: (0, $g4v7E.MenuId).EditorContext,
                    group: 'navigation',
                    order: 1.1
                },
                {
                    id: (0, $g4v7E.MenuId).MenubarGoMenu,
                    precondition: null,
                    group: '4_symbol_nav',
                    order: 2
                }
            ]
        });
        (0, $8tcMz.CommandsRegistry).registerCommandAlias('editor.action.goToDeclaration', GoToDefinitionAction.id);
    }
});
(0, $g4v7E.registerAction2)(class OpenDefinitionToSideAction extends $48e5d411b2010803$export$5aed1003b9513172 {
    static{
        this.id = 'editor.action.revealDefinitionAside';
    }
    constructor(){
        super({
            openToSide: true,
            openInPeek: false,
            muteMessage: false
        }, {
            id: OpenDefinitionToSideAction.id,
            title: $4dEdH.localize2('actions.goToDeclToSide.label', "Open Definition to the Side"),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasDefinitionProvider, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            keybinding: [
                {
                    when: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                    primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 70 /* KeyCode.F12 */ ),
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                },
                {
                    when: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).editorTextFocus, (0, $h84gy.IsWebContext)),
                    primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2118 /* KeyCode.F12 */ ),
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                }
            ]
        });
        (0, $8tcMz.CommandsRegistry).registerCommandAlias('editor.action.openDeclarationToTheSide', OpenDefinitionToSideAction.id);
    }
});
(0, $g4v7E.registerAction2)(class PeekDefinitionAction extends $48e5d411b2010803$export$5aed1003b9513172 {
    static{
        this.id = 'editor.action.peekDefinition';
    }
    constructor(){
        super({
            openToSide: false,
            openInPeek: true,
            muteMessage: false
        }, {
            id: PeekDefinitionAction.id,
            title: $4dEdH.localize2('actions.previewDecl.label', "Peek Definition"),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasDefinitionProvider, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).notInPeekEditor, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            keybinding: {
                when: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 582 /* KeyCode.F12 */ ,
                linux: {
                    primary: 3140 /* KeyCode.F10 */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menu: {
                id: (0, $g4v7E.MenuId).EditorContextPeek,
                group: 'peek',
                order: 2
            }
        });
        (0, $8tcMz.CommandsRegistry).registerCommandAlias('editor.action.previewDeclaration', PeekDefinitionAction.id);
    }
});
//#endregion
//#region --- DECLARATION
class $48e5d411b2010803$var$DeclarationAction extends $48e5d411b2010803$export$858184cc1f739c5d {
    async _getLocationModel(languageFeaturesService, model, position, token) {
        return new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(await (0, $398bbabbcbf6b57c$export$268ced517630b719)(languageFeaturesService.declarationProvider, model, position, false, token), $4dEdH.localize('decl.title', 'Declarations'));
    }
    _getNoResultFoundMessage(info) {
        return info && info.word ? $4dEdH.localize('decl.noResultWord', "No declaration found for '{0}'", info.word) : $4dEdH.localize('decl.generic.noResults', "No declaration found");
    }
    _getAlternativeCommand(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).alternativeDeclarationCommand;
    }
    _getGoToPreference(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).multipleDeclarations;
    }
}
(0, $g4v7E.registerAction2)(class GoToDeclarationAction extends $48e5d411b2010803$var$DeclarationAction {
    static{
        this.id = 'editor.action.revealDeclaration';
    }
    constructor(){
        super({
            openToSide: false,
            openInPeek: false,
            muteMessage: false
        }, {
            id: GoToDeclarationAction.id,
            title: {
                ...$4dEdH.localize2('actions.goToDeclaration.label', "Go to Declaration"),
                mnemonicTitle: $4dEdH.localize({
                    key: 'miGotoDeclaration',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Go to &&Declaration")
            },
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasDeclarationProvider, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            menu: [
                {
                    id: (0, $g4v7E.MenuId).EditorContext,
                    group: 'navigation',
                    order: 1.3
                },
                {
                    id: (0, $g4v7E.MenuId).MenubarGoMenu,
                    precondition: null,
                    group: '4_symbol_nav',
                    order: 3
                }
            ]
        });
    }
    _getNoResultFoundMessage(info) {
        return info && info.word ? $4dEdH.localize('decl.noResultWord', "No declaration found for '{0}'", info.word) : $4dEdH.localize('decl.generic.noResults', "No declaration found");
    }
});
(0, $g4v7E.registerAction2)(class PeekDeclarationAction extends $48e5d411b2010803$var$DeclarationAction {
    constructor(){
        super({
            openToSide: false,
            openInPeek: true,
            muteMessage: false
        }, {
            id: 'editor.action.peekDeclaration',
            title: $4dEdH.localize2('actions.peekDecl.label', "Peek Declaration"),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasDeclarationProvider, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).notInPeekEditor, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            menu: {
                id: (0, $g4v7E.MenuId).EditorContextPeek,
                group: 'peek',
                order: 3
            }
        });
    }
});
//#endregion
//#region --- TYPE DEFINITION
class $48e5d411b2010803$var$TypeDefinitionAction extends $48e5d411b2010803$export$858184cc1f739c5d {
    async _getLocationModel(languageFeaturesService, model, position, token) {
        return new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(await (0, $398bbabbcbf6b57c$export$e2b810cd1720408a)(languageFeaturesService.typeDefinitionProvider, model, position, false, token), $4dEdH.localize('typedef.title', 'Type Definitions'));
    }
    _getNoResultFoundMessage(info) {
        return info && info.word ? $4dEdH.localize('goToTypeDefinition.noResultWord', "No type definition found for '{0}'", info.word) : $4dEdH.localize('goToTypeDefinition.generic.noResults', "No type definition found");
    }
    _getAlternativeCommand(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).alternativeTypeDefinitionCommand;
    }
    _getGoToPreference(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).multipleTypeDefinitions;
    }
}
(0, $g4v7E.registerAction2)(class GoToTypeDefinitionAction extends $48e5d411b2010803$var$TypeDefinitionAction {
    static{
        this.ID = 'editor.action.goToTypeDefinition';
    }
    constructor(){
        super({
            openToSide: false,
            openInPeek: false,
            muteMessage: false
        }, {
            id: GoToTypeDefinitionAction.ID,
            title: {
                ...$4dEdH.localize2('actions.goToTypeDefinition.label', "Go to Type Definition"),
                mnemonicTitle: $4dEdH.localize({
                    key: 'miGotoTypeDefinition',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Go to &&Type Definition")
            },
            precondition: (0, $ibKGQ.EditorContextKeys).hasTypeDefinitionProvider,
            keybinding: {
                when: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 0,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menu: [
                {
                    id: (0, $g4v7E.MenuId).EditorContext,
                    group: 'navigation',
                    order: 1.4
                },
                {
                    id: (0, $g4v7E.MenuId).MenubarGoMenu,
                    precondition: null,
                    group: '4_symbol_nav',
                    order: 3
                }
            ]
        });
    }
});
(0, $g4v7E.registerAction2)(class PeekTypeDefinitionAction extends $48e5d411b2010803$var$TypeDefinitionAction {
    static{
        this.ID = 'editor.action.peekTypeDefinition';
    }
    constructor(){
        super({
            openToSide: false,
            openInPeek: true,
            muteMessage: false
        }, {
            id: PeekTypeDefinitionAction.ID,
            title: $4dEdH.localize2('actions.peekTypeDefinition.label', "Peek Type Definition"),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasTypeDefinitionProvider, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).notInPeekEditor, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            menu: {
                id: (0, $g4v7E.MenuId).EditorContextPeek,
                group: 'peek',
                order: 4
            }
        });
    }
});
//#endregion
//#region --- IMPLEMENTATION
class $48e5d411b2010803$var$ImplementationAction extends $48e5d411b2010803$export$858184cc1f739c5d {
    async _getLocationModel(languageFeaturesService, model, position, token) {
        return new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(await (0, $398bbabbcbf6b57c$export$7d6802a2edcceb51)(languageFeaturesService.implementationProvider, model, position, false, token), $4dEdH.localize('impl.title', 'Implementations'));
    }
    _getNoResultFoundMessage(info) {
        return info && info.word ? $4dEdH.localize('goToImplementation.noResultWord', "No implementation found for '{0}'", info.word) : $4dEdH.localize('goToImplementation.generic.noResults', "No implementation found");
    }
    _getAlternativeCommand(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).alternativeImplementationCommand;
    }
    _getGoToPreference(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).multipleImplementations;
    }
}
(0, $g4v7E.registerAction2)(class GoToImplementationAction extends $48e5d411b2010803$var$ImplementationAction {
    static{
        this.ID = 'editor.action.goToImplementation';
    }
    constructor(){
        super({
            openToSide: false,
            openInPeek: false,
            muteMessage: false
        }, {
            id: GoToImplementationAction.ID,
            title: {
                ...$4dEdH.localize2('actions.goToImplementation.label', "Go to Implementations"),
                mnemonicTitle: $4dEdH.localize({
                    key: 'miGotoImplementation',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Go to &&Implementations")
            },
            precondition: (0, $ibKGQ.EditorContextKeys).hasImplementationProvider,
            keybinding: {
                when: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2118 /* KeyCode.F12 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menu: [
                {
                    id: (0, $g4v7E.MenuId).EditorContext,
                    group: 'navigation',
                    order: 1.45
                },
                {
                    id: (0, $g4v7E.MenuId).MenubarGoMenu,
                    precondition: null,
                    group: '4_symbol_nav',
                    order: 4
                }
            ]
        });
    }
});
(0, $g4v7E.registerAction2)(class PeekImplementationAction extends $48e5d411b2010803$var$ImplementationAction {
    static{
        this.ID = 'editor.action.peekImplementation';
    }
    constructor(){
        super({
            openToSide: false,
            openInPeek: true,
            muteMessage: false
        }, {
            id: PeekImplementationAction.ID,
            title: $4dEdH.localize2('actions.peekImplementation.label', "Peek Implementations"),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasImplementationProvider, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).notInPeekEditor, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            keybinding: {
                when: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3142 /* KeyCode.F12 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menu: {
                id: (0, $g4v7E.MenuId).EditorContextPeek,
                group: 'peek',
                order: 5
            }
        });
    }
});
//#endregion
//#region --- REFERENCES
class $48e5d411b2010803$var$ReferencesAction extends $48e5d411b2010803$export$858184cc1f739c5d {
    _getNoResultFoundMessage(info) {
        return info ? $4dEdH.localize('references.no', "No references found for '{0}'", info.word) : $4dEdH.localize('references.noGeneric', "No references found");
    }
    _getAlternativeCommand(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).alternativeReferenceCommand;
    }
    _getGoToPreference(editor) {
        return editor.getOption(58 /* EditorOption.gotoLocation */ ).multipleReferences;
    }
}
(0, $g4v7E.registerAction2)(class GoToReferencesAction extends $48e5d411b2010803$var$ReferencesAction {
    constructor(){
        super({
            openToSide: false,
            openInPeek: false,
            muteMessage: false
        }, {
            id: 'editor.action.goToReferences',
            title: {
                ...$4dEdH.localize2('goToReferences.label', "Go to References"),
                mnemonicTitle: $4dEdH.localize({
                    key: 'miGotoReference',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Go to &&References")
            },
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasReferenceProvider, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).notInPeekEditor, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            keybinding: {
                when: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1094 /* KeyCode.F12 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menu: [
                {
                    id: (0, $g4v7E.MenuId).EditorContext,
                    group: 'navigation',
                    order: 1.45
                },
                {
                    id: (0, $g4v7E.MenuId).MenubarGoMenu,
                    precondition: null,
                    group: '4_symbol_nav',
                    order: 5
                }
            ]
        });
    }
    async _getLocationModel(languageFeaturesService, model, position, token) {
        return new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(await (0, $398bbabbcbf6b57c$export$2bb33a4e47554443)(languageFeaturesService.referenceProvider, model, position, true, false, token), $4dEdH.localize('ref.title', 'References'));
    }
});
(0, $g4v7E.registerAction2)(class PeekReferencesAction extends $48e5d411b2010803$var$ReferencesAction {
    constructor(){
        super({
            openToSide: false,
            openInPeek: true,
            muteMessage: false
        }, {
            id: 'editor.action.referenceSearch.trigger',
            title: $4dEdH.localize2('references.action.label', "Peek References"),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).hasReferenceProvider, (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).notInPeekEditor, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated()),
            menu: {
                id: (0, $g4v7E.MenuId).EditorContextPeek,
                group: 'peek',
                order: 6
            }
        });
    }
    async _getLocationModel(languageFeaturesService, model, position, token) {
        return new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(await (0, $398bbabbcbf6b57c$export$2bb33a4e47554443)(languageFeaturesService.referenceProvider, model, position, false, false, token), $4dEdH.localize('ref.title', 'References'));
    }
});
//#endregion
//#region --- GENERIC goto symbols command
class $48e5d411b2010803$var$GenericGoToLocationAction extends $48e5d411b2010803$export$858184cc1f739c5d {
    constructor(config, _references, _gotoMultipleBehaviour){
        super(config, {
            id: 'editor.action.goToLocation',
            title: $4dEdH.localize2('label.generic', "Go to Any Symbol"),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $fb5054a30d54157b$export$5afd50a7c05ff96a).notInPeekEditor, (0, $ibKGQ.EditorContextKeys).isInEmbeddedEditor.toNegated())
        });
        this._references = _references;
        this._gotoMultipleBehaviour = _gotoMultipleBehaviour;
    }
    async _getLocationModel(languageFeaturesService, _model, _position, _token) {
        return new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(this._references, $4dEdH.localize('generic.title', 'Locations'));
    }
    _getNoResultFoundMessage(info) {
        return info && $4dEdH.localize('generic.noResult', "No results for '{0}'", info.word) || '';
    }
    _getGoToPreference(editor) {
        return this._gotoMultipleBehaviour ?? editor.getOption(58 /* EditorOption.gotoLocation */ ).multipleReferences;
    }
    _getAlternativeCommand() {
        return '';
    }
}
(0, $8tcMz.CommandsRegistry).registerCommand({
    id: 'editor.action.goToLocations',
    metadata: {
        description: 'Go to locations from a position in a file',
        args: [
            {
                name: 'uri',
                description: 'The text document in which to start',
                constraint: (0, $5OJ54.URI)
            },
            {
                name: 'position',
                description: 'The position at which to start',
                constraint: $dcxQ7.Position.isIPosition
            },
            {
                name: 'locations',
                description: 'An array of locations.',
                constraint: Array
            },
            {
                name: 'multiple',
                description: 'Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`'
            },
            {
                name: 'noResultsMessage',
                description: 'Human readable message that shows when locations is empty.'
            }
        ]
    },
    handler: async (accessor, resource, position, references, multiple, noResultsMessage, openInPeek)=>{
        (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(resource));
        (0, $bxBg7.assertType)($dcxQ7.Position.isIPosition(position));
        (0, $bxBg7.assertType)(Array.isArray(references));
        (0, $bxBg7.assertType)(typeof multiple === 'undefined' || typeof multiple === 'string');
        (0, $bxBg7.assertType)(typeof openInPeek === 'undefined' || typeof openInPeek === 'boolean');
        const editorService = accessor.get((0, $2Qfl0.ICodeEditorService));
        const editor = await editorService.openCodeEditor({
            resource: resource
        }, editorService.getFocusedCodeEditor());
        if ((0, $7UXLG.isCodeEditor)(editor)) {
            editor.setPosition(position);
            editor.revealPositionInCenterIfOutsideViewport(position, 0 /* ScrollType.Smooth */ );
            return editor.invokeWithinContext((accessor)=>{
                const command = new class extends $48e5d411b2010803$var$GenericGoToLocationAction {
                    _getNoResultFoundMessage(info) {
                        return noResultsMessage || super._getNoResultFoundMessage(info);
                    }
                }({
                    muteMessage: !Boolean(noResultsMessage),
                    openInPeek: Boolean(openInPeek),
                    openToSide: false
                }, references, multiple);
                accessor.get((0, $fdGPu.IInstantiationService)).invokeFunction(command.run.bind(command), editor);
            });
        }
    }
});
(0, $8tcMz.CommandsRegistry).registerCommand({
    id: 'editor.action.peekLocations',
    metadata: {
        description: 'Peek locations from a position in a file',
        args: [
            {
                name: 'uri',
                description: 'The text document in which to start',
                constraint: (0, $5OJ54.URI)
            },
            {
                name: 'position',
                description: 'The position at which to start',
                constraint: $dcxQ7.Position.isIPosition
            },
            {
                name: 'locations',
                description: 'An array of locations.',
                constraint: Array
            },
            {
                name: 'multiple',
                description: 'Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`'
            }
        ]
    },
    handler: async (accessor, resource, position, references, multiple)=>{
        accessor.get((0, $8tcMz.ICommandService)).executeCommand('editor.action.goToLocations', resource, position, references, multiple, undefined, true);
    }
});
//#endregion
//#region --- REFERENCE search special commands
(0, $8tcMz.CommandsRegistry).registerCommand({
    id: 'editor.action.findReferences',
    handler: (accessor, resource, position)=>{
        (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(resource));
        (0, $bxBg7.assertType)($dcxQ7.Position.isIPosition(position));
        const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
        const codeEditorService = accessor.get((0, $2Qfl0.ICodeEditorService));
        return codeEditorService.openCodeEditor({
            resource: resource
        }, codeEditorService.getFocusedCodeEditor()).then((control)=>{
            if (!(0, $7UXLG.isCodeEditor)(control) || !control.hasModel()) return undefined;
            const controller = (0, $cbeaa13ed7da71f5$export$60e6f978b59c492d).get(control);
            if (!controller) return undefined;
            const references = (0, $6bXyA.createCancelablePromise)((token)=>(0, $398bbabbcbf6b57c$export$2bb33a4e47554443)(languageFeaturesService.referenceProvider, control.getModel(), $dcxQ7.Position.lift(position), false, false, token).then((references)=>new (0, $5b460a97be6401b7$export$f3299b77f3be0450)(references, $4dEdH.localize('ref.title', 'References'))));
            const range = new (0, $d00il.Range)(position.lineNumber, position.column, position.lineNumber, position.column);
            return Promise.resolve(controller.toggleWidget(range, references, false));
        });
    }
});
// use NEW command
(0, $8tcMz.CommandsRegistry).registerCommandAlias('editor.action.showReferences', 'editor.action.peekLocations'); //#endregion




var $g4v7E = parcelRequire("g4v7E");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $d6K7e = parcelRequire("d6K7e");

var $fdGPu = parcelRequire("fdGPu");

var $kCOKl = parcelRequire("kCOKl");
async function $e5dd2bc6a42a00f0$export$2ee3c93b258041ab(accessor, editor, anchor, part) {
    const resolverService = accessor.get((0, $aTkrt.ITextModelService));
    const contextMenuService = accessor.get((0, $d6K7e.IContextMenuService));
    const commandService = accessor.get((0, $8tcMz.ICommandService));
    const instaService = accessor.get((0, $fdGPu.IInstantiationService));
    const notificationService = accessor.get((0, $kCOKl.INotificationService));
    await part.item.resolve((0, $giPcZ.CancellationToken).None);
    if (!part.part.location) return;
    const location = part.part.location;
    const menuActions = [];
    // from all registered (not active) context menu actions select those
    // that are a symbol navigation actions
    const filter = new Set((0, $g4v7E.MenuRegistry).getMenuItems((0, $g4v7E.MenuId).EditorContext).map((item)=>(0, $g4v7E.isIMenuItem)(item) ? item.command.id : (0, $0805a875738ca87e$export$1c3aefb711c3a4cc)()));
    for (const delegate of (0, $48e5d411b2010803$export$858184cc1f739c5d).all())if (filter.has(delegate.desc.id)) menuActions.push(new (0, $cVfMQ.Action)(delegate.desc.id, (0, $g4v7E.MenuItemAction).label(delegate.desc, {
        renderShortTitle: true
    }), undefined, true, async ()=>{
        const ref = await resolverService.createModelReference(location.uri);
        try {
            const symbolAnchor = new (0, $48e5d411b2010803$export$9e187f320a7b361f)(ref.object.textEditorModel, (0, $d00il.Range).getStartPosition(location.range));
            const range = part.item.anchor.range;
            await instaService.invokeFunction(delegate.runEditorCommand.bind(delegate), editor, symbolAnchor, range);
        } finally{
            ref.dispose();
        }
    }));
    if (part.part.command) {
        const { command: command } = part.part;
        menuActions.push(new (0, $cVfMQ.Separator)());
        menuActions.push(new (0, $cVfMQ.Action)(command.id, command.title, undefined, true, async ()=>{
            try {
                await commandService.executeCommand(command.id, ...command.arguments ?? []);
            } catch (err) {
                notificationService.notify({
                    severity: (0, $kCOKl.Severity).Error,
                    source: part.item.provider.displayName,
                    message: err
                });
            }
        }));
    }
    // show context menu
    const useShadowDOM = editor.getOption(128 /* EditorOption.useShadowDOM */ );
    contextMenuService.showContextMenu({
        domForShadowRoot: useShadowDOM ? editor.getDomNode() ?? undefined : undefined,
        getAnchor: ()=>{
            const box = $bDzmQ.getDomNodePagePosition(anchor);
            return {
                x: box.left,
                y: box.top + box.height + 8
            };
        },
        getActions: ()=>menuActions,
        onHide: ()=>{
            editor.focus();
        },
        autoSelectFirstItem: true
    });
}
async function $e5dd2bc6a42a00f0$export$6b268345d6f19f36(accessor, event, editor, location) {
    const resolverService = accessor.get((0, $aTkrt.ITextModelService));
    const ref = await resolverService.createModelReference(location.uri);
    await editor.invokeWithinContext(async (accessor)=>{
        const openToSide = event.hasSideBySideModifier;
        const contextKeyService = accessor.get((0, $cxCeF.IContextKeyService));
        const isInPeek = (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).inPeekEditor.getValue(contextKeyService);
        const canPeek = !openToSide && editor.getOption(89 /* EditorOption.definitionLinkOpensInPeek */ ) && !isInPeek;
        const action = new (0, $48e5d411b2010803$export$5aed1003b9513172)({
            openToSide: openToSide,
            openInPeek: canPeek,
            muteMessage: true
        }, {
            title: {
                value: '',
                original: ''
            },
            id: '',
            precondition: undefined
        });
        return action.run(accessor, new (0, $48e5d411b2010803$export$9e187f320a7b361f)(ref.object.textEditorModel, (0, $d00il.Range).getStartPosition(location.range)), (0, $d00il.Range).lift(location.range));
    });
    ref.dispose();
}



var $8tcMz = parcelRequire("8tcMz");

var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

var $kCOKl = parcelRequire("kCOKl");

var $gaWeX = parcelRequire("gaWeX");

var $azIPz = parcelRequire("azIPz");
var $c1123d6baa54d7d8$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c1123d6baa54d7d8$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $c1123d6baa54d7d8$var$InlayHintsController_1;
// --- hint caching service (per session)
class $c1123d6baa54d7d8$var$InlayHintsCache {
    constructor(){
        this._entries = new (0, $askDf.LRUCache)(50);
    }
    get(model) {
        const key = $c1123d6baa54d7d8$var$InlayHintsCache._key(model);
        return this._entries.get(key);
    }
    set(model, value) {
        const key = $c1123d6baa54d7d8$var$InlayHintsCache._key(model);
        this._entries.set(key, value);
    }
    static _key(model) {
        return `${model.uri.toString()}/${model.getVersionId()}`;
    }
}
const $c1123d6baa54d7d8$var$IInlayHintsCache = (0, $fdGPu.createDecorator)('IInlayHintsCache');
(0, $lf2vF.registerSingleton)($c1123d6baa54d7d8$var$IInlayHintsCache, $c1123d6baa54d7d8$var$InlayHintsCache, 1 /* InstantiationType.Delayed */ );
class $c1123d6baa54d7d8$export$8b5f0aeb191c23cd {
    constructor(item, index){
        this.item = item;
        this.index = index;
    }
    get part() {
        const label = this.item.hint.label;
        if (typeof label === 'string') return {
            label: label
        };
        else return label[this.index];
    }
}
class $c1123d6baa54d7d8$var$ActiveInlayHintInfo {
    constructor(part, hasTriggerModifier){
        this.part = part;
        this.hasTriggerModifier = hasTriggerModifier;
    }
}
// --- controller
let $c1123d6baa54d7d8$export$c42ac128db3942ca = class InlayHintsController {
    static{
        $c1123d6baa54d7d8$var$InlayHintsController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.InlayHints';
    }
    static{
        this._MAX_DECORATORS = 1500;
    }
    static{
        this._MAX_LABEL_LEN = 43;
    }
    static get(editor) {
        return editor.getContribution($c1123d6baa54d7d8$var$InlayHintsController_1.ID) ?? undefined;
    }
    constructor(_editor, _languageFeaturesService, _featureDebounce, _inlayHintsCache, _commandService, _notificationService, _instaService){
        this._editor = _editor;
        this._languageFeaturesService = _languageFeaturesService;
        this._inlayHintsCache = _inlayHintsCache;
        this._commandService = _commandService;
        this._notificationService = _notificationService;
        this._instaService = _instaService;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._sessionDisposables = new (0, $9cWcn.DisposableStore)();
        this._decorationsMetadata = new Map();
        this._ruleFactory = new (0, $loznH.DynamicCssRules)(this._editor);
        this._activeRenderMode = 0 /* RenderMode.Normal */ ;
        this._debounceInfo = _featureDebounce.for(_languageFeaturesService.inlayHintsProvider, 'InlayHint', {
            min: 25
        });
        this._disposables.add(_languageFeaturesService.inlayHintsProvider.onDidChange(()=>this._update()));
        this._disposables.add(_editor.onDidChangeModel(()=>this._update()));
        this._disposables.add(_editor.onDidChangeModelLanguage(()=>this._update()));
        this._disposables.add(_editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(142 /* EditorOption.inlayHints */ )) this._update();
        }));
        this._update();
    }
    dispose() {
        this._sessionDisposables.dispose();
        this._removeAllDecorations();
        this._disposables.dispose();
    }
    _update() {
        this._sessionDisposables.clear();
        this._removeAllDecorations();
        const options = this._editor.getOption(142 /* EditorOption.inlayHints */ );
        if (options.enabled === 'off') return;
        const model = this._editor.getModel();
        if (!model || !this._languageFeaturesService.inlayHintsProvider.has(model)) return;
        if (options.enabled === 'on') // different "on" modes: always
        this._activeRenderMode = 0 /* RenderMode.Normal */ ;
        else {
            // different "on" modes: offUnlessPressed, or onUnlessPressed
            let defaultMode;
            let altMode;
            if (options.enabled === 'onUnlessPressed') {
                defaultMode = 0 /* RenderMode.Normal */ ;
                altMode = 1 /* RenderMode.Invisible */ ;
            } else {
                defaultMode = 1 /* RenderMode.Invisible */ ;
                altMode = 0 /* RenderMode.Normal */ ;
            }
            this._activeRenderMode = defaultMode;
            this._sessionDisposables.add((0, $bDzmQ.ModifierKeyEmitter).getInstance().event((e)=>{
                if (!this._editor.hasModel()) return;
                const newRenderMode = e.altKey && e.ctrlKey && !(e.shiftKey || e.metaKey) ? altMode : defaultMode;
                if (newRenderMode !== this._activeRenderMode) {
                    this._activeRenderMode = newRenderMode;
                    const model = this._editor.getModel();
                    const copies = this._copyInlayHintsWithCurrentAnchor(model);
                    this._updateHintsDecorators([
                        model.getFullModelRange()
                    ], copies);
                    scheduler.schedule(0);
                }
            }));
        }
        // iff possible, quickly update from cache
        const cached = this._inlayHintsCache.get(model);
        if (cached) this._updateHintsDecorators([
            model.getFullModelRange()
        ], cached);
        this._sessionDisposables.add((0, $9cWcn.toDisposable)(()=>{
            // cache items when switching files etc
            if (!model.isDisposed()) this._cacheHintsForFastRestore(model);
        }));
        let cts;
        const watchedProviders = new Set();
        const scheduler = new (0, $6bXyA.RunOnceScheduler)(async ()=>{
            const t1 = Date.now();
            cts?.dispose(true);
            cts = new (0, $giPcZ.CancellationTokenSource)();
            const listener = model.onWillDispose(()=>cts?.cancel());
            try {
                const myToken = cts.token;
                const inlayHints = await (0, $143e7f0b04cd0b1d$export$a7a5e2275dfc6de6).create(this._languageFeaturesService.inlayHintsProvider, model, this._getHintsRanges(), myToken);
                scheduler.delay = this._debounceInfo.update(model, Date.now() - t1);
                if (myToken.isCancellationRequested) {
                    inlayHints.dispose();
                    return;
                }
                // listen to provider changes
                for (const provider of inlayHints.provider)if (typeof provider.onDidChangeInlayHints === 'function' && !watchedProviders.has(provider)) {
                    watchedProviders.add(provider);
                    this._sessionDisposables.add(provider.onDidChangeInlayHints(()=>{
                        if (!scheduler.isScheduled()) scheduler.schedule();
                    }));
                }
                this._sessionDisposables.add(inlayHints);
                this._updateHintsDecorators(inlayHints.ranges, inlayHints.items);
                this._cacheHintsForFastRestore(model);
            } catch (err) {
                (0, $gPkHZ.onUnexpectedError)(err);
            } finally{
                cts.dispose();
                listener.dispose();
            }
        }, this._debounceInfo.get(model));
        this._sessionDisposables.add(scheduler);
        this._sessionDisposables.add((0, $9cWcn.toDisposable)(()=>cts?.dispose(true)));
        scheduler.schedule(0);
        this._sessionDisposables.add(this._editor.onDidScrollChange((e)=>{
            // update when scroll position changes
            // uses scrollTopChanged has weak heuristic to differenatiate between scrolling due to
            // typing or due to "actual" scrolling
            if (e.scrollTopChanged || !scheduler.isScheduled()) scheduler.schedule();
        }));
        this._sessionDisposables.add(this._editor.onDidChangeModelContent((e)=>{
            cts?.cancel();
            // update less aggressive when typing
            const delay = Math.max(scheduler.delay, 1250);
            scheduler.schedule(delay);
        }));
        // mouse gestures
        this._sessionDisposables.add(this._installDblClickGesture(()=>scheduler.schedule(0)));
        this._sessionDisposables.add(this._installLinkGesture());
        this._sessionDisposables.add(this._installContextMenu());
    }
    _installLinkGesture() {
        const store = new (0, $9cWcn.DisposableStore)();
        const gesture = store.add(new (0, $485c48732062cc95$export$e5a83b5c609cb4bb)(this._editor));
        // let removeHighlight = () => { };
        const sessionStore = new (0, $9cWcn.DisposableStore)();
        store.add(sessionStore);
        store.add(gesture.onMouseMoveOrRelevantKeyDown((e)=>{
            const [mouseEvent] = e;
            const labelPart = this._getInlayHintLabelPart(mouseEvent);
            const model = this._editor.getModel();
            if (!labelPart || !model) {
                sessionStore.clear();
                return;
            }
            // resolve the item
            const cts = new (0, $giPcZ.CancellationTokenSource)();
            sessionStore.add((0, $9cWcn.toDisposable)(()=>cts.dispose(true)));
            labelPart.item.resolve(cts.token);
            // render link => when the modifier is pressed and when there is a command or location
            this._activeInlayHintPart = labelPart.part.command || labelPart.part.location ? new $c1123d6baa54d7d8$var$ActiveInlayHintInfo(labelPart, mouseEvent.hasTriggerModifier) : undefined;
            const lineNumber = model.validatePosition(labelPart.item.hint.position).lineNumber;
            const range = new (0, $d00il.Range)(lineNumber, 1, lineNumber, model.getLineMaxColumn(lineNumber));
            const lineHints = this._getInlineHintsForRange(range);
            this._updateHintsDecorators([
                range
            ], lineHints);
            sessionStore.add((0, $9cWcn.toDisposable)(()=>{
                this._activeInlayHintPart = undefined;
                this._updateHintsDecorators([
                    range
                ], lineHints);
            }));
        }));
        store.add(gesture.onCancel(()=>sessionStore.clear()));
        store.add(gesture.onExecute(async (e)=>{
            const label = this._getInlayHintLabelPart(e);
            if (label) {
                const part = label.part;
                if (part.location) // location -> execute go to def
                this._instaService.invokeFunction((0, $e5dd2bc6a42a00f0$export$6b268345d6f19f36), e, this._editor, part.location);
                else if ($kzNQX.Command.is(part.command)) // command -> execute it
                await this._invokeCommand(part.command, label.item);
            }
        }));
        return store;
    }
    _getInlineHintsForRange(range) {
        const lineHints = new Set();
        for (const data of this._decorationsMetadata.values())if (range.containsRange(data.item.anchor.range)) lineHints.add(data.item);
        return Array.from(lineHints);
    }
    _installDblClickGesture(updateInlayHints) {
        return this._editor.onMouseUp(async (e)=>{
            if (e.event.detail !== 2) return;
            const part = this._getInlayHintLabelPart(e);
            if (!part) return;
            e.event.preventDefault();
            await part.item.resolve((0, $giPcZ.CancellationToken).None);
            if ((0, $kJ8UG.isNonEmptyArray)(part.item.hint.textEdits)) {
                const edits = part.item.hint.textEdits.map((edit)=>(0, $kHJv6.EditOperation).replace((0, $d00il.Range).lift(edit.range), edit.text));
                this._editor.executeEdits('inlayHint.default', edits);
                updateInlayHints();
            }
        });
    }
    _installContextMenu() {
        return this._editor.onContextMenu(async (e)=>{
            if (!(0, $bDzmQ.isHTMLElement)(e.event.target)) return;
            const part = this._getInlayHintLabelPart(e);
            if (part) await this._instaService.invokeFunction((0, $e5dd2bc6a42a00f0$export$2ee3c93b258041ab), this._editor, e.event.target, part);
        });
    }
    _getInlayHintLabelPart(e) {
        if (e.target.type !== 6 /* MouseTargetType.CONTENT_TEXT */ ) return undefined;
        const options = e.target.detail.injectedText?.options;
        if (options instanceof (0, $91ntV.ModelDecorationInjectedTextOptions) && options?.attachedData instanceof $c1123d6baa54d7d8$export$8b5f0aeb191c23cd) return options.attachedData;
        return undefined;
    }
    async _invokeCommand(command, item) {
        try {
            await this._commandService.executeCommand(command.id, ...command.arguments ?? []);
        } catch (err) {
            this._notificationService.notify({
                severity: (0, $kCOKl.Severity).Error,
                source: item.provider.displayName,
                message: err
            });
        }
    }
    _cacheHintsForFastRestore(model) {
        const hints = this._copyInlayHintsWithCurrentAnchor(model);
        this._inlayHintsCache.set(model, hints);
    }
    // return inlay hints but with an anchor that reflects "updates"
    // that happened after receiving them, e.g adding new lines before a hint
    _copyInlayHintsWithCurrentAnchor(model) {
        const items = new Map();
        for (const [id, obj] of this._decorationsMetadata){
            if (items.has(obj.item)) continue;
            const range = model.getDecorationRange(id);
            if (range) {
                // update range with whatever the editor has tweaked it to
                const anchor = new (0, $143e7f0b04cd0b1d$export$7f6a0555505c92c6)(range, obj.item.anchor.direction);
                const copy = obj.item.with({
                    anchor: anchor
                });
                items.set(obj.item, copy);
            }
        }
        return Array.from(items.values());
    }
    _getHintsRanges() {
        const extra = 30;
        const model = this._editor.getModel();
        const visibleRanges = this._editor.getVisibleRangesPlusViewportAboveBelow();
        const result = [];
        for (const range of visibleRanges.sort((0, $d00il.Range).compareRangesUsingStarts)){
            const extendedRange = model.validateRange(new (0, $d00il.Range)(range.startLineNumber - extra, range.startColumn, range.endLineNumber + extra, range.endColumn));
            if (result.length === 0 || !(0, $d00il.Range).areIntersectingOrTouching(result[result.length - 1], extendedRange)) result.push(extendedRange);
            else result[result.length - 1] = (0, $d00il.Range).plusRange(result[result.length - 1], extendedRange);
        }
        return result;
    }
    _updateHintsDecorators(ranges, items) {
        // utils to collect/create injected text decorations
        const newDecorationsData = [];
        const addInjectedText = (item, ref, content, cursorStops, attachedData)=>{
            const opts = {
                content: content,
                inlineClassNameAffectsLetterSpacing: true,
                inlineClassName: ref.className,
                cursorStops: cursorStops,
                attachedData: attachedData
            };
            newDecorationsData.push({
                item: item,
                classNameRef: ref,
                decoration: {
                    range: item.anchor.range,
                    options: {
                        // className: "rangeHighlight", // DEBUG highlight to see to what range a hint is attached
                        description: 'InlayHint',
                        showIfCollapsed: item.anchor.range.isEmpty(),
                        collapseOnReplaceEdit: !item.anchor.range.isEmpty(),
                        stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
                        [item.anchor.direction]: this._activeRenderMode === 0 /* RenderMode.Normal */  ? opts : undefined
                    }
                }
            });
        };
        const addInjectedWhitespace = (item, isLast)=>{
            const marginRule = this._ruleFactory.createClassNameRef({
                width: `${fontSize / 3 | 0}px`,
                display: 'inline-block'
            });
            addInjectedText(item, marginRule, '\u200a', isLast ? (0, $1Y4vr.InjectedTextCursorStops).Right : (0, $1Y4vr.InjectedTextCursorStops).None);
        };
        //
        const { fontSize: fontSize, fontFamily: fontFamily, padding: padding, isUniform: isUniform } = this._getLayoutInfo();
        const fontFamilyVar = '--code-editorInlayHintsFontFamily';
        this._editor.getContainerDomNode().style.setProperty(fontFamilyVar, fontFamily);
        let currentLineInfo = {
            line: 0,
            totalLen: 0
        };
        for (const item of items){
            if (currentLineInfo.line !== item.anchor.range.startLineNumber) currentLineInfo = {
                line: item.anchor.range.startLineNumber,
                totalLen: 0
            };
            if (currentLineInfo.totalLen > $c1123d6baa54d7d8$var$InlayHintsController_1._MAX_LABEL_LEN) continue;
            // whitespace leading the actual label
            if (item.hint.paddingLeft) addInjectedWhitespace(item, false);
            // the label with its parts
            const parts = typeof item.hint.label === 'string' ? [
                {
                    label: item.hint.label
                }
            ] : item.hint.label;
            for(let i = 0; i < parts.length; i++){
                const part = parts[i];
                const isFirst = i === 0;
                const isLast = i === parts.length - 1;
                const cssProperties = {
                    fontSize: `${fontSize}px`,
                    fontFamily: `var(${fontFamilyVar}), ${(0, $cd4KD.EDITOR_FONT_DEFAULTS).fontFamily}`,
                    verticalAlign: isUniform ? 'baseline' : 'middle',
                    unicodeBidi: 'isolate'
                };
                if ((0, $kJ8UG.isNonEmptyArray)(item.hint.textEdits)) cssProperties.cursor = 'default';
                this._fillInColors(cssProperties, item.hint);
                if ((part.command || part.location) && this._activeInlayHintPart?.part.item === item && this._activeInlayHintPart.part.index === i) {
                    // active link!
                    cssProperties.textDecoration = 'underline';
                    if (this._activeInlayHintPart.hasTriggerModifier) {
                        cssProperties.color = (0, $azIPz.themeColorFromId)($gaWeX.editorActiveLinkForeground);
                        cssProperties.cursor = 'pointer';
                    }
                }
                if (padding) {
                    if (isFirst && isLast) {
                        // only element
                        cssProperties.padding = `1px ${Math.max(1, fontSize / 4) | 0}px`;
                        cssProperties.borderRadius = `${fontSize / 4 | 0}px`;
                    } else if (isFirst) {
                        // first element
                        cssProperties.padding = `1px 0 1px ${Math.max(1, fontSize / 4) | 0}px`;
                        cssProperties.borderRadius = `${fontSize / 4 | 0}px 0 0 ${fontSize / 4 | 0}px`;
                    } else if (isLast) {
                        // last element
                        cssProperties.padding = `1px ${Math.max(1, fontSize / 4) | 0}px 1px 0`;
                        cssProperties.borderRadius = `0 ${fontSize / 4 | 0}px ${fontSize / 4 | 0}px 0`;
                    } else cssProperties.padding = `1px 0 1px 0`;
                }
                let textlabel = part.label;
                currentLineInfo.totalLen += textlabel.length;
                let tooLong = false;
                const over = currentLineInfo.totalLen - $c1123d6baa54d7d8$var$InlayHintsController_1._MAX_LABEL_LEN;
                if (over > 0) {
                    textlabel = textlabel.slice(0, -over) + "\u2026";
                    tooLong = true;
                }
                addInjectedText(item, this._ruleFactory.createClassNameRef(cssProperties), $c1123d6baa54d7d8$var$fixSpace(textlabel), isLast && !item.hint.paddingRight ? (0, $1Y4vr.InjectedTextCursorStops).Right : (0, $1Y4vr.InjectedTextCursorStops).None, new $c1123d6baa54d7d8$export$8b5f0aeb191c23cd(item, i));
                if (tooLong) break;
            }
            // whitespace trailing the actual label
            if (item.hint.paddingRight) addInjectedWhitespace(item, true);
            if (newDecorationsData.length > $c1123d6baa54d7d8$var$InlayHintsController_1._MAX_DECORATORS) break;
        }
        // collect all decoration ids that are affected by the ranges
        // and only update those decorations
        const decorationIdsToReplace = [];
        for (const [id, metadata] of this._decorationsMetadata){
            const range = this._editor.getModel()?.getDecorationRange(id);
            if (range && ranges.some((r)=>r.containsRange(range))) {
                decorationIdsToReplace.push(id);
                metadata.classNameRef.dispose();
                this._decorationsMetadata.delete(id);
            }
        }
        const scrollState = (0, $1RlHY.StableEditorScrollState).capture(this._editor);
        this._editor.changeDecorations((accessor)=>{
            const newDecorationIds = accessor.deltaDecorations(decorationIdsToReplace, newDecorationsData.map((d)=>d.decoration));
            for(let i = 0; i < newDecorationIds.length; i++){
                const data = newDecorationsData[i];
                this._decorationsMetadata.set(newDecorationIds[i], data);
            }
        });
        scrollState.restore(this._editor);
    }
    _fillInColors(props, hint) {
        if (hint.kind === $kzNQX.InlayHintKind.Parameter) {
            props.backgroundColor = (0, $azIPz.themeColorFromId)($gaWeX.editorInlayHintParameterBackground);
            props.color = (0, $azIPz.themeColorFromId)($gaWeX.editorInlayHintParameterForeground);
        } else if (hint.kind === $kzNQX.InlayHintKind.Type) {
            props.backgroundColor = (0, $azIPz.themeColorFromId)($gaWeX.editorInlayHintTypeBackground);
            props.color = (0, $azIPz.themeColorFromId)($gaWeX.editorInlayHintTypeForeground);
        } else {
            props.backgroundColor = (0, $azIPz.themeColorFromId)($gaWeX.editorInlayHintBackground);
            props.color = (0, $azIPz.themeColorFromId)($gaWeX.editorInlayHintForeground);
        }
    }
    _getLayoutInfo() {
        const options = this._editor.getOption(142 /* EditorOption.inlayHints */ );
        const padding = options.padding;
        const editorFontSize = this._editor.getOption(52 /* EditorOption.fontSize */ );
        const editorFontFamily = this._editor.getOption(49 /* EditorOption.fontFamily */ );
        let fontSize = options.fontSize;
        if (!fontSize || fontSize < 5 || fontSize > editorFontSize) fontSize = editorFontSize;
        const fontFamily = options.fontFamily || editorFontFamily;
        const isUniform = !padding && fontFamily === editorFontFamily && fontSize === editorFontSize;
        return {
            fontSize: fontSize,
            fontFamily: fontFamily,
            padding: padding,
            isUniform: isUniform
        };
    }
    _removeAllDecorations() {
        this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));
        for (const obj of this._decorationsMetadata.values())obj.classNameRef.dispose();
        this._decorationsMetadata.clear();
    }
};
$c1123d6baa54d7d8$export$c42ac128db3942ca = $c1123d6baa54d7d8$var$InlayHintsController_1 = $c1123d6baa54d7d8$var$__decorate([
    $c1123d6baa54d7d8$var$__param(1, (0, $4J6fu.ILanguageFeaturesService)),
    $c1123d6baa54d7d8$var$__param(2, (0, $goG89.ILanguageFeatureDebounceService)),
    $c1123d6baa54d7d8$var$__param(3, $c1123d6baa54d7d8$var$IInlayHintsCache),
    $c1123d6baa54d7d8$var$__param(4, (0, $8tcMz.ICommandService)),
    $c1123d6baa54d7d8$var$__param(5, (0, $kCOKl.INotificationService)),
    $c1123d6baa54d7d8$var$__param(6, (0, $fdGPu.IInstantiationService))
], $c1123d6baa54d7d8$export$c42ac128db3942ca);
// Prevents the view from potentially visible whitespace
function $c1123d6baa54d7d8$var$fixSpace(str) {
    const noBreakWhitespace = '\xa0';
    return str.replace(/[ \t]/g, noBreakWhitespace);
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeInlayHintProvider', async (accessor, ...args)=>{
    const [uri, range] = args;
    (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(uri));
    (0, $bxBg7.assertType)((0, $d00il.Range).isIRange(range));
    const { inlayHintsProvider: inlayHintsProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const ref = await accessor.get((0, $aTkrt.ITextModelService)).createModelReference(uri);
    try {
        const model = await (0, $143e7f0b04cd0b1d$export$a7a5e2275dfc6de6).create(inlayHintsProvider, ref.object.textEditorModel, [
            (0, $d00il.Range).lift(range)
        ], (0, $giPcZ.CancellationToken).None);
        const result = model.items.map((i)=>i.hint);
        setTimeout(()=>model.dispose(), 0); // dispose after sending to ext host
        return result;
    } finally{
        ref.dispose();
    }
});



var $35IZ9 = parcelRequire("35IZ9");

var $iAi3o = parcelRequire("iAi3o");

var $4J6fu = parcelRequire("4J6fu");

var $4dEdH = parcelRequire("4dEdH");

var $lb0Ah = parcelRequire("lb0Ah");


var $kJ8UG = parcelRequire("kJ8UG");

var $7IxGd = parcelRequire("7IxGd");

var $lc5DL = parcelRequire("lc5DL");

var $8tcMz = parcelRequire("8tcMz");
var $fc2677ebb06de358$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $fc2677ebb06de358$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $fc2677ebb06de358$var$InlayHintsHoverAnchor extends (0, $4760294cb1bcf994$export$cadc11e524c92809) {
    constructor(part, owner, initialMousePosX, initialMousePosY){
        super(10, owner, part.item.anchor.range, initialMousePosX, initialMousePosY, true);
        this.part = part;
    }
}
let $fc2677ebb06de358$export$a81360d5e6af0e81 = class InlayHintsHover extends (0, $9195b2d03426c505$export$db7233c4b0ae81a2) {
    constructor(editor, languageService, openerService, keybindingService, hoverService, configurationService, _resolverService, languageFeaturesService, commandService){
        super(editor, languageService, openerService, configurationService, languageFeaturesService, keybindingService, hoverService, commandService);
        this._resolverService = _resolverService;
        this.hoverOrdinal = 6;
    }
    suggestHoverAnchor(mouseEvent) {
        const controller = (0, $c1123d6baa54d7d8$export$c42ac128db3942ca).get(this._editor);
        if (!controller) return null;
        if (mouseEvent.target.type !== 6 /* MouseTargetType.CONTENT_TEXT */ ) return null;
        const options = mouseEvent.target.detail.injectedText?.options;
        if (!(options instanceof (0, $91ntV.ModelDecorationInjectedTextOptions) && options.attachedData instanceof (0, $c1123d6baa54d7d8$export$8b5f0aeb191c23cd))) return null;
        return new $fc2677ebb06de358$var$InlayHintsHoverAnchor(options.attachedData, this, mouseEvent.event.posx, mouseEvent.event.posy);
    }
    computeSync() {
        return [];
    }
    computeAsync(anchor, _lineDecorations, token) {
        if (!(anchor instanceof $fc2677ebb06de358$var$InlayHintsHoverAnchor)) return (0, $6bXyA.AsyncIterableObject).EMPTY;
        return new (0, $6bXyA.AsyncIterableObject)(async (executor)=>{
            const { part: part } = anchor;
            await part.item.resolve(token);
            if (token.isCancellationRequested) return;
            // (1) Inlay Tooltip
            let itemTooltip;
            if (typeof part.item.hint.tooltip === 'string') itemTooltip = new (0, $iGmb0.MarkdownString)().appendText(part.item.hint.tooltip);
            else if (part.item.hint.tooltip) itemTooltip = part.item.hint.tooltip;
            if (itemTooltip) executor.emitOne(new (0, $9195b2d03426c505$export$de5210377542b3f9)(this, anchor.range, [
                itemTooltip
            ], false, 0));
            // (1.2) Inlay dbl-click gesture
            if ((0, $kJ8UG.isNonEmptyArray)(part.item.hint.textEdits)) executor.emitOne(new (0, $9195b2d03426c505$export$de5210377542b3f9)(this, anchor.range, [
                new (0, $iGmb0.MarkdownString)().appendText((0, $4dEdH.localize)('hint.dbl', "Double-click to insert"))
            ], false, 10001));
            // (2) Inlay Label Part Tooltip
            let partTooltip;
            if (typeof part.part.tooltip === 'string') partTooltip = new (0, $iGmb0.MarkdownString)().appendText(part.part.tooltip);
            else if (part.part.tooltip) partTooltip = part.part.tooltip;
            if (partTooltip) executor.emitOne(new (0, $9195b2d03426c505$export$de5210377542b3f9)(this, anchor.range, [
                partTooltip
            ], false, 1));
            // (2.2) Inlay Label Part Help Hover
            if (part.part.location || part.part.command) {
                let linkHint;
                const useMetaKey = this._editor.getOption(78 /* EditorOption.multiCursorModifier */ ) === 'altKey';
                const kb = useMetaKey ? $lb0Ah.isMacintosh ? (0, $4dEdH.localize)('links.navigate.kb.meta.mac', "cmd + click") : (0, $4dEdH.localize)('links.navigate.kb.meta', "ctrl + click") : $lb0Ah.isMacintosh ? (0, $4dEdH.localize)('links.navigate.kb.alt.mac', "option + click") : (0, $4dEdH.localize)('links.navigate.kb.alt', "alt + click");
                if (part.part.location && part.part.command) linkHint = new (0, $iGmb0.MarkdownString)().appendText((0, $4dEdH.localize)('hint.defAndCommand', 'Go to Definition ({0}), right click for more', kb));
                else if (part.part.location) linkHint = new (0, $iGmb0.MarkdownString)().appendText((0, $4dEdH.localize)('hint.def', 'Go to Definition ({0})', kb));
                else if (part.part.command) linkHint = new (0, $iGmb0.MarkdownString)(`[${(0, $4dEdH.localize)('hint.cmd', "Execute Command")}](${(0, $143e7f0b04cd0b1d$export$2bd95c79fcb29f)(part.part.command)} "${part.part.command.title}") (${kb})`, {
                    isTrusted: true
                });
                if (linkHint) executor.emitOne(new (0, $9195b2d03426c505$export$de5210377542b3f9)(this, anchor.range, [
                    linkHint
                ], false, 10000));
            }
            // (3) Inlay Label Part Location tooltip
            const iterable = await this._resolveInlayHintLabelPartHover(part, token);
            for await (const item of iterable)executor.emitOne(item);
        });
    }
    async _resolveInlayHintLabelPartHover(part, token) {
        if (!part.part.location) return (0, $6bXyA.AsyncIterableObject).EMPTY;
        const { uri: uri, range: range } = part.part.location;
        const ref = await this._resolverService.createModelReference(uri);
        try {
            const model = ref.object.textEditorModel;
            if (!this._languageFeaturesService.hoverProvider.has(model)) return (0, $6bXyA.AsyncIterableObject).EMPTY;
            return (0, $f5c90efe5bc3f5fb$export$fe317e31968a65d8)(this._languageFeaturesService.hoverProvider, model, new (0, $dcxQ7.Position)(range.startLineNumber, range.startColumn), token).filter((item)=>!(0, $iGmb0.isEmptyMarkdownString)(item.hover.contents)).map((item)=>new (0, $9195b2d03426c505$export$de5210377542b3f9)(this, part.item.anchor.range, item.hover.contents, false, 2 + item.ordinal));
        } finally{
            ref.dispose();
        }
    }
};
$fc2677ebb06de358$export$a81360d5e6af0e81 = $fc2677ebb06de358$var$__decorate([
    $fc2677ebb06de358$var$__param(1, (0, $h9Xpp.ILanguageService)),
    $fc2677ebb06de358$var$__param(2, (0, $iAi3o.IOpenerService)),
    $fc2677ebb06de358$var$__param(3, (0, $7IxGd.IKeybindingService)),
    $fc2677ebb06de358$var$__param(4, (0, $lc5DL.IHoverService)),
    $fc2677ebb06de358$var$__param(5, (0, $35IZ9.IConfigurationService)),
    $fc2677ebb06de358$var$__param(6, (0, $aTkrt.ITextModelService)),
    $fc2677ebb06de358$var$__param(7, (0, $4J6fu.ILanguageFeaturesService)),
    $fc2677ebb06de358$var$__param(8, (0, $8tcMz.ICommandService))
], $fc2677ebb06de358$export$a81360d5e6af0e81);



var $gPkHZ = parcelRequire("gPkHZ");
class $2b5dc67fdfd17ced$export$217bc83fd9ba5220 extends (0, $9cWcn.Disposable) {
    constructor(editor, hoverResult, participants, computer, context, keybindingService){
        super();
        const anchor = hoverResult.anchor;
        const parts = hoverResult.hoverParts;
        this._renderedHoverParts = this._register(new $2b5dc67fdfd17ced$var$RenderedContentHoverParts(editor, participants, parts, keybindingService, context));
        const { showAtPosition: showAtPosition, showAtSecondaryPosition: showAtSecondaryPosition } = $2b5dc67fdfd17ced$export$217bc83fd9ba5220.computeHoverPositions(editor, anchor.range, parts);
        this.shouldAppearBeforeContent = parts.some((m)=>m.isBeforeContent);
        this.showAtPosition = showAtPosition;
        this.showAtSecondaryPosition = showAtSecondaryPosition;
        this.initialMousePosX = anchor.initialMousePosX;
        this.initialMousePosY = anchor.initialMousePosY;
        this.shouldFocus = computer.shouldFocus;
        this.source = computer.source;
    }
    get domNode() {
        return this._renderedHoverParts.domNode;
    }
    get domNodeHasChildren() {
        return this._renderedHoverParts.domNodeHasChildren;
    }
    get focusedHoverPartIndex() {
        return this._renderedHoverParts.focusedHoverPartIndex;
    }
    async updateHoverVerbosityLevel(action, index, focus) {
        this._renderedHoverParts.updateHoverVerbosityLevel(action, index, focus);
    }
    isColorPickerVisible() {
        return this._renderedHoverParts.isColorPickerVisible();
    }
    static computeHoverPositions(editor, anchorRange, hoverParts) {
        let startColumnBoundary = 1;
        if (editor.hasModel()) {
            // Ensure the range is on the current view line
            const viewModel = editor._getViewModel();
            const coordinatesConverter = viewModel.coordinatesConverter;
            const anchorViewRange = coordinatesConverter.convertModelRangeToViewRange(anchorRange);
            const anchorViewMinColumn = viewModel.getLineMinColumn(anchorViewRange.startLineNumber);
            const anchorViewRangeStart = new (0, $dcxQ7.Position)(anchorViewRange.startLineNumber, anchorViewMinColumn);
            startColumnBoundary = coordinatesConverter.convertViewPositionToModelPosition(anchorViewRangeStart).column;
        }
        // The anchor range is always on a single line
        const anchorStartLineNumber = anchorRange.startLineNumber;
        let secondaryPositionColumn = anchorRange.startColumn;
        let forceShowAtRange;
        for (const hoverPart of hoverParts){
            const hoverPartRange = hoverPart.range;
            const hoverPartRangeOnAnchorStartLine = hoverPartRange.startLineNumber === anchorStartLineNumber;
            const hoverPartRangeOnAnchorEndLine = hoverPartRange.endLineNumber === anchorStartLineNumber;
            const hoverPartRangeIsOnAnchorLine = hoverPartRangeOnAnchorStartLine && hoverPartRangeOnAnchorEndLine;
            if (hoverPartRangeIsOnAnchorLine) {
                // this message has a range that is completely sitting on the line of the anchor
                const hoverPartStartColumn = hoverPartRange.startColumn;
                const minSecondaryPositionColumn = Math.min(secondaryPositionColumn, hoverPartStartColumn);
                secondaryPositionColumn = Math.max(minSecondaryPositionColumn, startColumnBoundary);
            }
            if (hoverPart.forceShowAtRange) forceShowAtRange = hoverPartRange;
        }
        let showAtPosition;
        let showAtSecondaryPosition;
        if (forceShowAtRange) {
            const forceShowAtPosition = forceShowAtRange.getStartPosition();
            showAtPosition = forceShowAtPosition;
            showAtSecondaryPosition = forceShowAtPosition;
        } else {
            showAtPosition = anchorRange.getStartPosition();
            showAtSecondaryPosition = new (0, $dcxQ7.Position)(anchorStartLineNumber, secondaryPositionColumn);
        }
        return {
            showAtPosition: showAtPosition,
            showAtSecondaryPosition: showAtSecondaryPosition
        };
    }
}
class $2b5dc67fdfd17ced$var$RenderedStatusBar {
    constructor(fragment, _statusBar){
        this._statusBar = _statusBar;
        fragment.appendChild(this._statusBar.hoverElement);
    }
    get hoverElement() {
        return this._statusBar.hoverElement;
    }
    get actions() {
        return this._statusBar.actions;
    }
    dispose() {
        this._statusBar.dispose();
    }
}
class $2b5dc67fdfd17ced$var$RenderedContentHoverParts extends (0, $9cWcn.Disposable) {
    static{
        this._DECORATION_OPTIONS = (0, $91ntV.ModelDecorationOptions).register({
            description: 'content-hover-highlight',
            className: 'hoverHighlight'
        });
    }
    constructor(editor, participants, hoverParts, keybindingService, context){
        super();
        this._renderedParts = [];
        this._focusedHoverPartIndex = -1;
        this._context = context;
        this._fragment = document.createDocumentFragment();
        this._register(this._renderParts(participants, hoverParts, context, keybindingService));
        this._register(this._registerListenersOnRenderedParts());
        this._register(this._createEditorDecorations(editor, hoverParts));
        this._updateMarkdownAndColorParticipantInfo(participants);
    }
    _createEditorDecorations(editor, hoverParts) {
        if (hoverParts.length === 0) return (0, $9cWcn.Disposable).None;
        let highlightRange = hoverParts[0].range;
        for (const hoverPart of hoverParts){
            const hoverPartRange = hoverPart.range;
            highlightRange = (0, $d00il.Range).plusRange(highlightRange, hoverPartRange);
        }
        const highlightDecoration = editor.createDecorationsCollection();
        highlightDecoration.set([
            {
                range: highlightRange,
                options: $2b5dc67fdfd17ced$var$RenderedContentHoverParts._DECORATION_OPTIONS
            }
        ]);
        return (0, $9cWcn.toDisposable)(()=>{
            highlightDecoration.clear();
        });
    }
    _renderParts(participants, hoverParts, hoverContext, keybindingService) {
        const statusBar = new (0, $9559ba32f7b69229$export$b3dad84b67c8b2c0)(keybindingService);
        const hoverRenderingContext = {
            fragment: this._fragment,
            statusBar: statusBar,
            ...hoverContext
        };
        const disposables = new (0, $9cWcn.DisposableStore)();
        for (const participant of participants){
            const renderedHoverParts = this._renderHoverPartsForParticipant(hoverParts, participant, hoverRenderingContext);
            disposables.add(renderedHoverParts);
            for (const renderedHoverPart of renderedHoverParts.renderedHoverParts)this._renderedParts.push({
                type: 'hoverPart',
                participant: participant,
                hoverPart: renderedHoverPart.hoverPart,
                hoverElement: renderedHoverPart.hoverElement
            });
        }
        const renderedStatusBar = this._renderStatusBar(this._fragment, statusBar);
        if (renderedStatusBar) {
            disposables.add(renderedStatusBar);
            this._renderedParts.push({
                type: 'statusBar',
                hoverElement: renderedStatusBar.hoverElement,
                actions: renderedStatusBar.actions
            });
        }
        return (0, $9cWcn.toDisposable)(()=>{
            disposables.dispose();
        });
    }
    _renderHoverPartsForParticipant(hoverParts, participant, hoverRenderingContext) {
        const hoverPartsForParticipant = hoverParts.filter((hoverPart)=>hoverPart.owner === participant);
        const hasHoverPartsForParticipant = hoverPartsForParticipant.length > 0;
        if (!hasHoverPartsForParticipant) return new (0, $4760294cb1bcf994$export$637327e7f36b9c4a)([]);
        return participant.renderHoverParts(hoverRenderingContext, hoverPartsForParticipant);
    }
    _renderStatusBar(fragment, statusBar) {
        if (!statusBar.hasContent) return undefined;
        return new $2b5dc67fdfd17ced$var$RenderedStatusBar(fragment, statusBar);
    }
    _registerListenersOnRenderedParts() {
        const disposables = new (0, $9cWcn.DisposableStore)();
        this._renderedParts.forEach((renderedPart, index)=>{
            const element = renderedPart.hoverElement;
            element.tabIndex = 0;
            disposables.add($bDzmQ.addDisposableListener(element, $bDzmQ.EventType.FOCUS_IN, (event)=>{
                event.stopPropagation();
                this._focusedHoverPartIndex = index;
            }));
            disposables.add($bDzmQ.addDisposableListener(element, $bDzmQ.EventType.FOCUS_OUT, (event)=>{
                event.stopPropagation();
                this._focusedHoverPartIndex = -1;
            }));
        });
        return disposables;
    }
    _updateMarkdownAndColorParticipantInfo(participants) {
        const markdownHoverParticipant = participants.find((p)=>{
            return p instanceof (0, $9195b2d03426c505$export$db7233c4b0ae81a2) && !(p instanceof (0, $fc2677ebb06de358$export$a81360d5e6af0e81));
        });
        if (markdownHoverParticipant) this._markdownHoverParticipant = markdownHoverParticipant;
        this._colorHoverParticipant = participants.find((p)=>p instanceof (0, $6d075c31a65fd2a0$export$c4145a38e12cf25c));
    }
    async updateHoverVerbosityLevel(action, index, focus) {
        if (!this._markdownHoverParticipant) return;
        const normalizedMarkdownHoverIndex = this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant, index);
        if (normalizedMarkdownHoverIndex === undefined) return;
        const renderedPart = await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(action, normalizedMarkdownHoverIndex, focus);
        if (!renderedPart) return;
        this._renderedParts[index] = {
            type: 'hoverPart',
            participant: this._markdownHoverParticipant,
            hoverPart: renderedPart.hoverPart,
            hoverElement: renderedPart.hoverElement
        };
        this._context.onContentsChanged();
    }
    isColorPickerVisible() {
        return this._colorHoverParticipant?.isColorPickerVisible() ?? false;
    }
    _normalizedIndexToMarkdownHoverIndexRange(markdownHoverParticipant, index) {
        const renderedPart = this._renderedParts[index];
        if (!renderedPart || renderedPart.type !== 'hoverPart') return undefined;
        const isHoverPartMarkdownHover = renderedPart.participant === markdownHoverParticipant;
        if (!isHoverPartMarkdownHover) return undefined;
        const firstIndexOfMarkdownHovers = this._renderedParts.findIndex((renderedPart)=>renderedPart.type === 'hoverPart' && renderedPart.participant === markdownHoverParticipant);
        if (firstIndexOfMarkdownHovers === -1) throw new (0, $gPkHZ.BugIndicatingError)();
        return index - firstIndexOfMarkdownHovers;
    }
    get domNode() {
        return this._fragment;
    }
    get domNodeHasChildren() {
        return this._fragment.hasChildNodes();
    }
    get focusedHoverPartIndex() {
        return this._focusedHoverPartIndex;
    }
}



var $6ea699b0e8a55a52$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $6ea699b0e8a55a52$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $6ea699b0e8a55a52$export$d57864329c122a65 = class ContentHoverWidgetWrapper extends (0, $9cWcn.Disposable) {
    constructor(_editor, _instantiationService, _keybindingService){
        super();
        this._editor = _editor;
        this._instantiationService = _instantiationService;
        this._keybindingService = _keybindingService;
        this._currentResult = null;
        this._onContentsChanged = this._register(new (0, $5YaSO.Emitter)());
        this.onContentsChanged = this._onContentsChanged.event;
        this._contentHoverWidget = this._register(this._instantiationService.createInstance((0, $135295b01e910bfa$export$ea089e382ccfc912), this._editor));
        this._participants = this._initializeHoverParticipants();
        this._computer = new (0, $8d5623b7ba9c7d0d$export$ffa69eebf1b99b98)(this._editor, this._participants);
        this._hoverOperation = this._register(new (0, $161a8a25a79256cc$export$35fb423ab90fde65)(this._editor, this._computer));
        this._registerListeners();
    }
    _initializeHoverParticipants() {
        const participants = [];
        for (const participant of (0, $4760294cb1bcf994$export$fc2e2429672a46bc).getAll()){
            const participantInstance = this._instantiationService.createInstance(participant, this._editor);
            participants.push(participantInstance);
        }
        participants.sort((p1, p2)=>p1.hoverOrdinal - p2.hoverOrdinal);
        this._register(this._contentHoverWidget.onDidResize(()=>{
            this._participants.forEach((participant)=>participant.handleResize?.());
        }));
        return participants;
    }
    _registerListeners() {
        this._register(this._hoverOperation.onResult((result)=>{
            if (!this._computer.anchor) // invalid state, ignore result
            return;
            const messages = result.hasLoadingMessage ? this._addLoadingMessage(result.value) : result.value;
            this._withResult(new (0, $dbb6eb9d9c9f17dc$export$f0be135662da9b6)(this._computer.anchor, messages, result.isComplete));
        }));
        const contentHoverWidgetNode = this._contentHoverWidget.getDomNode();
        this._register($bDzmQ.addStandardDisposableListener(contentHoverWidgetNode, 'keydown', (e)=>{
            if (e.equals(9 /* KeyCode.Escape */ )) this.hide();
        }));
        this._register($bDzmQ.addStandardDisposableListener(contentHoverWidgetNode, 'mouseleave', (e)=>{
            this._onMouseLeave(e);
        }));
        this._register((0, $kzNQX.TokenizationRegistry).onDidChange(()=>{
            if (this._contentHoverWidget.position && this._currentResult) this._setCurrentResult(this._currentResult); // render again
        }));
    }
    /**
     * Returns true if the hover shows now or will show.
     */ _startShowingOrUpdateHover(anchor, mode, source, focus, mouseEvent) {
        const contentHoverIsVisible = this._contentHoverWidget.position && this._currentResult;
        if (!contentHoverIsVisible) {
            if (anchor) {
                this._startHoverOperationIfNecessary(anchor, mode, source, focus, false);
                return true;
            }
            return false;
        }
        const isHoverSticky = this._editor.getOption(60 /* EditorOption.hover */ ).sticky;
        const isMouseGettingCloser = mouseEvent && this._contentHoverWidget.isMouseGettingCloser(mouseEvent.event.posx, mouseEvent.event.posy);
        const isHoverStickyAndIsMouseGettingCloser = isHoverSticky && isMouseGettingCloser;
        // The mouse is getting closer to the hover, so we will keep the hover untouched
        // But we will kick off a hover update at the new anchor, insisting on keeping the hover visible.
        if (isHoverStickyAndIsMouseGettingCloser) {
            if (anchor) this._startHoverOperationIfNecessary(anchor, mode, source, focus, true);
            return true;
        }
        // If mouse is not getting closer and anchor not defined, hide the hover
        if (!anchor) {
            this._setCurrentResult(null);
            return false;
        }
        // If mouse if not getting closer and anchor is defined, and the new anchor is the same as the previous anchor
        const currentAnchorEqualsPreviousAnchor = this._currentResult.anchor.equals(anchor);
        if (currentAnchorEqualsPreviousAnchor) return true;
        // If mouse if not getting closer and anchor is defined, and the new anchor is not compatible with the previous anchor
        const currentAnchorCompatibleWithPreviousAnchor = anchor.canAdoptVisibleHover(this._currentResult.anchor, this._contentHoverWidget.position);
        if (!currentAnchorCompatibleWithPreviousAnchor) {
            this._setCurrentResult(null);
            this._startHoverOperationIfNecessary(anchor, mode, source, focus, false);
            return true;
        }
        // We aren't getting any closer to the hover, so we will filter existing results
        // and keep those which also apply to the new anchor.
        this._setCurrentResult(this._currentResult.filter(anchor));
        this._startHoverOperationIfNecessary(anchor, mode, source, focus, false);
        return true;
    }
    _startHoverOperationIfNecessary(anchor, mode, source, focus, insistOnKeepingHoverVisible) {
        const currentAnchorEqualToPreviousHover = this._computer.anchor && this._computer.anchor.equals(anchor);
        if (currentAnchorEqualToPreviousHover) return;
        this._hoverOperation.cancel();
        this._computer.anchor = anchor;
        this._computer.shouldFocus = focus;
        this._computer.source = source;
        this._computer.insistOnKeepingHoverVisible = insistOnKeepingHoverVisible;
        this._hoverOperation.start(mode);
    }
    _setCurrentResult(hoverResult) {
        let currentHoverResult = hoverResult;
        const currentResultEqualToPreviousResult = this._currentResult === currentHoverResult;
        if (currentResultEqualToPreviousResult) return;
        const currentHoverResultIsEmpty = currentHoverResult && currentHoverResult.hoverParts.length === 0;
        if (currentHoverResultIsEmpty) currentHoverResult = null;
        this._currentResult = currentHoverResult;
        if (this._currentResult) this._showHover(this._currentResult);
        else this._hideHover();
    }
    _addLoadingMessage(result) {
        if (!this._computer.anchor) return result;
        for (const participant of this._participants){
            if (!participant.createLoadingMessage) continue;
            const loadingMessage = participant.createLoadingMessage(this._computer.anchor);
            if (!loadingMessage) continue;
            return result.slice(0).concat([
                loadingMessage
            ]);
        }
        return result;
    }
    _withResult(hoverResult) {
        const previousHoverIsVisibleWithCompleteResult = this._contentHoverWidget.position && this._currentResult && this._currentResult.isComplete;
        if (!previousHoverIsVisibleWithCompleteResult) this._setCurrentResult(hoverResult);
        // The hover is visible with a previous complete result.
        const isCurrentHoverResultComplete = hoverResult.isComplete;
        if (!isCurrentHoverResultComplete) // Instead of rendering the new partial result, we wait for the result to be complete.
        return;
        const currentHoverResultIsEmpty = hoverResult.hoverParts.length === 0;
        const insistOnKeepingPreviousHoverVisible = this._computer.insistOnKeepingHoverVisible;
        const shouldKeepPreviousHoverVisible = currentHoverResultIsEmpty && insistOnKeepingPreviousHoverVisible;
        if (shouldKeepPreviousHoverVisible) // The hover would now hide normally, so we'll keep the previous messages
        return;
        this._setCurrentResult(hoverResult);
    }
    _showHover(hoverResult) {
        const context = this._getHoverContext();
        this._renderedContentHover = new (0, $2b5dc67fdfd17ced$export$217bc83fd9ba5220)(this._editor, hoverResult, this._participants, this._computer, context, this._keybindingService);
        if (this._renderedContentHover.domNodeHasChildren) this._contentHoverWidget.show(this._renderedContentHover);
        else this._renderedContentHover.dispose();
    }
    _hideHover() {
        this._contentHoverWidget.hide();
    }
    _getHoverContext() {
        const hide = ()=>{
            this.hide();
        };
        const onContentsChanged = ()=>{
            this._onContentsChanged.fire();
            this._contentHoverWidget.onContentsChanged();
        };
        const setMinimumDimensions = (dimensions)=>{
            this._contentHoverWidget.setMinimumDimensions(dimensions);
        };
        return {
            hide: hide,
            onContentsChanged: onContentsChanged,
            setMinimumDimensions: setMinimumDimensions
        };
    }
    showsOrWillShow(mouseEvent) {
        const isContentWidgetResizing = this._contentHoverWidget.isResizing;
        if (isContentWidgetResizing) return true;
        const anchorCandidates = this._findHoverAnchorCandidates(mouseEvent);
        const anchorCandidatesExist = anchorCandidates.length > 0;
        if (!anchorCandidatesExist) return this._startShowingOrUpdateHover(null, 0 /* HoverStartMode.Delayed */ , 0 /* HoverStartSource.Mouse */ , false, mouseEvent);
        const anchor = anchorCandidates[0];
        return this._startShowingOrUpdateHover(anchor, 0 /* HoverStartMode.Delayed */ , 0 /* HoverStartSource.Mouse */ , false, mouseEvent);
    }
    _findHoverAnchorCandidates(mouseEvent) {
        const anchorCandidates = [];
        for (const participant of this._participants){
            if (!participant.suggestHoverAnchor) continue;
            const anchor = participant.suggestHoverAnchor(mouseEvent);
            if (!anchor) continue;
            anchorCandidates.push(anchor);
        }
        const target = mouseEvent.target;
        switch(target.type){
            case 6 /* MouseTargetType.CONTENT_TEXT */ :
                anchorCandidates.push(new (0, $4760294cb1bcf994$export$2a967524099ecc2c)(0, target.range, mouseEvent.event.posx, mouseEvent.event.posy));
                break;
            case 7 /* MouseTargetType.CONTENT_EMPTY */ :
                {
                    const epsilon = this._editor.getOption(50 /* EditorOption.fontInfo */ ).typicalHalfwidthCharacterWidth / 2;
                    // Let hover kick in even when the mouse is technically in the empty area after a line, given the distance is small enough
                    const mouseIsWithinLinesAndCloseToHover = !target.detail.isAfterLines && typeof target.detail.horizontalDistanceToText === 'number' && target.detail.horizontalDistanceToText < epsilon;
                    if (!mouseIsWithinLinesAndCloseToHover) break;
                    anchorCandidates.push(new (0, $4760294cb1bcf994$export$2a967524099ecc2c)(0, target.range, mouseEvent.event.posx, mouseEvent.event.posy));
                    break;
                }
        }
        anchorCandidates.sort((a, b)=>b.priority - a.priority);
        return anchorCandidates;
    }
    _onMouseLeave(e) {
        const editorDomNode = this._editor.getDomNode();
        const isMousePositionOutsideOfEditor = !editorDomNode || !(0, $d0df60e44163b9d6$export$23bb0db67a9f6e2f)(editorDomNode, e.x, e.y);
        if (isMousePositionOutsideOfEditor) this.hide();
    }
    startShowingAtRange(range, mode, source, focus) {
        this._startShowingOrUpdateHover(new (0, $4760294cb1bcf994$export$2a967524099ecc2c)(0, range, undefined, undefined), mode, source, focus, null);
    }
    async updateHoverVerbosityLevel(action, index, focus) {
        this._renderedContentHover?.updateHoverVerbosityLevel(action, index, focus);
    }
    focusedHoverPartIndex() {
        return this._renderedContentHover?.focusedHoverPartIndex ?? -1;
    }
    containsNode(node) {
        return node ? this._contentHoverWidget.getDomNode().contains(node) : false;
    }
    focus() {
        this._contentHoverWidget.focus();
    }
    scrollUp() {
        this._contentHoverWidget.scrollUp();
    }
    scrollDown() {
        this._contentHoverWidget.scrollDown();
    }
    scrollLeft() {
        this._contentHoverWidget.scrollLeft();
    }
    scrollRight() {
        this._contentHoverWidget.scrollRight();
    }
    pageUp() {
        this._contentHoverWidget.pageUp();
    }
    pageDown() {
        this._contentHoverWidget.pageDown();
    }
    goToTop() {
        this._contentHoverWidget.goToTop();
    }
    goToBottom() {
        this._contentHoverWidget.goToBottom();
    }
    hide() {
        this._computer.anchor = null;
        this._hoverOperation.cancel();
        this._setCurrentResult(null);
    }
    getDomNode() {
        return this._contentHoverWidget.getDomNode();
    }
    get isColorPickerVisible() {
        return this._renderedContentHover?.isColorPickerVisible() ?? false;
    }
    get isVisibleFromKeyboard() {
        return this._contentHoverWidget.isVisibleFromKeyboard;
    }
    get isVisible() {
        return this._contentHoverWidget.isVisible;
    }
    get isFocused() {
        return this._contentHoverWidget.isFocused;
    }
    get isResizing() {
        return this._contentHoverWidget.isResizing;
    }
    get widget() {
        return this._contentHoverWidget;
    }
};
$6ea699b0e8a55a52$export$d57864329c122a65 = $6ea699b0e8a55a52$var$__decorate([
    $6ea699b0e8a55a52$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $6ea699b0e8a55a52$var$__param(2, (0, $7IxGd.IKeybindingService))
], $6ea699b0e8a55a52$export$d57864329c122a65);




var $5YaSO = parcelRequire("5YaSO");
var $174d42e875580d53$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $174d42e875580d53$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $174d42e875580d53$var$ContentHoverController_1;
// sticky hover widget which doesn't disappear on focus out and such
const $174d42e875580d53$var$_sticky = false;
let $174d42e875580d53$export$df69c8e8290b334c = class ContentHoverController extends (0, $9cWcn.Disposable) {
    static{
        $174d42e875580d53$var$ContentHoverController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.contentHover';
    }
    constructor(_editor, _instantiationService, _keybindingService){
        super();
        this._editor = _editor;
        this._instantiationService = _instantiationService;
        this._keybindingService = _keybindingService;
        this._onHoverContentsChanged = this._register(new (0, $5YaSO.Emitter)());
        this.shouldKeepOpenOnEditorMouseMoveOrLeave = false;
        this._listenersStore = new (0, $9cWcn.DisposableStore)();
        this._hoverState = {
            mouseDown: false,
            activatedByDecoratorClick: false
        };
        this._reactToEditorMouseMoveRunner = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._reactToEditorMouseMove(this._mouseMoveEvent), 0));
        this._hookListeners();
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(60 /* EditorOption.hover */ )) {
                this._unhookListeners();
                this._hookListeners();
            }
        }));
    }
    static get(editor) {
        return editor.getContribution($174d42e875580d53$var$ContentHoverController_1.ID);
    }
    _hookListeners() {
        const hoverOpts = this._editor.getOption(60 /* EditorOption.hover */ );
        this._hoverSettings = {
            enabled: hoverOpts.enabled,
            sticky: hoverOpts.sticky,
            hidingDelay: hoverOpts.hidingDelay
        };
        if (hoverOpts.enabled) {
            this._listenersStore.add(this._editor.onMouseDown((e)=>this._onEditorMouseDown(e)));
            this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp()));
            this._listenersStore.add(this._editor.onMouseMove((e)=>this._onEditorMouseMove(e)));
            this._listenersStore.add(this._editor.onKeyDown((e)=>this._onKeyDown(e)));
        } else {
            this._listenersStore.add(this._editor.onMouseMove((e)=>this._onEditorMouseMove(e)));
            this._listenersStore.add(this._editor.onKeyDown((e)=>this._onKeyDown(e)));
        }
        this._listenersStore.add(this._editor.onMouseLeave((e)=>this._onEditorMouseLeave(e)));
        this._listenersStore.add(this._editor.onDidChangeModel(()=>{
            this._cancelScheduler();
            this._hideWidgets();
        }));
        this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler()));
        this._listenersStore.add(this._editor.onDidScrollChange((e)=>this._onEditorScrollChanged(e)));
    }
    _unhookListeners() {
        this._listenersStore.clear();
    }
    _cancelScheduler() {
        this._mouseMoveEvent = undefined;
        this._reactToEditorMouseMoveRunner.cancel();
    }
    _onEditorScrollChanged(e) {
        if (e.scrollTopChanged || e.scrollLeftChanged) this._hideWidgets();
    }
    _onEditorMouseDown(mouseEvent) {
        this._hoverState.mouseDown = true;
        const shouldNotHideCurrentHoverWidget = this._shouldNotHideCurrentHoverWidget(mouseEvent);
        if (shouldNotHideCurrentHoverWidget) return;
        this._hideWidgets();
    }
    _shouldNotHideCurrentHoverWidget(mouseEvent) {
        return this._isMouseOnContentHoverWidget(mouseEvent) || this._isContentWidgetResizing();
    }
    _isMouseOnContentHoverWidget(mouseEvent) {
        const contentWidgetNode = this._contentWidget?.getDomNode();
        if (contentWidgetNode) return (0, $d0df60e44163b9d6$export$23bb0db67a9f6e2f)(contentWidgetNode, mouseEvent.event.posx, mouseEvent.event.posy);
        return false;
    }
    _onEditorMouseUp() {
        this._hoverState.mouseDown = false;
    }
    _onEditorMouseLeave(mouseEvent) {
        if (this.shouldKeepOpenOnEditorMouseMoveOrLeave) return;
        this._cancelScheduler();
        const shouldNotHideCurrentHoverWidget = this._shouldNotHideCurrentHoverWidget(mouseEvent);
        if (shouldNotHideCurrentHoverWidget) return;
        if ($174d42e875580d53$var$_sticky) return;
        this._hideWidgets();
    }
    _shouldNotRecomputeCurrentHoverWidget(mouseEvent) {
        const isHoverSticky = this._hoverSettings.sticky;
        const isMouseOnStickyContentHoverWidget = (mouseEvent, isHoverSticky)=>{
            const isMouseOnContentHoverWidget = this._isMouseOnContentHoverWidget(mouseEvent);
            return isHoverSticky && isMouseOnContentHoverWidget;
        };
        const isMouseOnColorPicker = (mouseEvent)=>{
            const isMouseOnContentHoverWidget = this._isMouseOnContentHoverWidget(mouseEvent);
            const isColorPickerVisible = this._contentWidget?.isColorPickerVisible ?? false;
            return isMouseOnContentHoverWidget && isColorPickerVisible;
        };
        // TODO@aiday-mar verify if the following is necessary code
        const isTextSelectedWithinContentHoverWidget = (mouseEvent, sticky)=>{
            return (sticky && this._contentWidget?.containsNode(mouseEvent.event.browserEvent.view?.document.activeElement) && !mouseEvent.event.browserEvent.view?.getSelection()?.isCollapsed) ?? false;
        };
        return isMouseOnStickyContentHoverWidget(mouseEvent, isHoverSticky) || isMouseOnColorPicker(mouseEvent) || isTextSelectedWithinContentHoverWidget(mouseEvent, isHoverSticky);
    }
    _onEditorMouseMove(mouseEvent) {
        if (this.shouldKeepOpenOnEditorMouseMoveOrLeave) return;
        this._mouseMoveEvent = mouseEvent;
        if (this._contentWidget?.isFocused || this._contentWidget?.isResizing) return;
        const sticky = this._hoverSettings.sticky;
        if (sticky && this._contentWidget?.isVisibleFromKeyboard) // Sticky mode is on and the hover has been shown via keyboard
        // so moving the mouse has no effect
        return;
        const shouldNotRecomputeCurrentHoverWidget = this._shouldNotRecomputeCurrentHoverWidget(mouseEvent);
        if (shouldNotRecomputeCurrentHoverWidget) {
            this._reactToEditorMouseMoveRunner.cancel();
            return;
        }
        const hidingDelay = this._hoverSettings.hidingDelay;
        const isContentHoverWidgetVisible = this._contentWidget?.isVisible;
        // If the mouse is not over the widget, and if sticky is on,
        // then give it a grace period before reacting to the mouse event
        const shouldRescheduleHoverComputation = isContentHoverWidgetVisible && sticky && hidingDelay > 0;
        if (shouldRescheduleHoverComputation) {
            if (!this._reactToEditorMouseMoveRunner.isScheduled()) this._reactToEditorMouseMoveRunner.schedule(hidingDelay);
            return;
        }
        this._reactToEditorMouseMove(mouseEvent);
    }
    _reactToEditorMouseMove(mouseEvent) {
        if (!mouseEvent) return;
        const target = mouseEvent.target;
        const mouseOnDecorator = target.element?.classList.contains('colorpicker-color-decoration');
        const decoratorActivatedOn = this._editor.getOption(149 /* EditorOption.colorDecoratorsActivatedOn */ );
        const enabled = this._hoverSettings.enabled;
        const activatedByDecoratorClick = this._hoverState.activatedByDecoratorClick;
        if (mouseOnDecorator && (decoratorActivatedOn === 'click' && !activatedByDecoratorClick || decoratorActivatedOn === 'hover' && !enabled && !$174d42e875580d53$var$_sticky || decoratorActivatedOn === 'clickAndHover' && !enabled && !activatedByDecoratorClick) || !mouseOnDecorator && !enabled && !activatedByDecoratorClick) {
            this._hideWidgets();
            return;
        }
        const contentHoverShowsOrWillShow = this._tryShowHoverWidget(mouseEvent);
        if (contentHoverShowsOrWillShow) return;
        if ($174d42e875580d53$var$_sticky) return;
        this._hideWidgets();
    }
    _tryShowHoverWidget(mouseEvent) {
        const contentWidget = this._getOrCreateContentWidget();
        return contentWidget.showsOrWillShow(mouseEvent);
    }
    _onKeyDown(e) {
        if (!this._editor.hasModel()) return;
        const resolvedKeyboardEvent = this._keybindingService.softDispatch(e, this._editor.getDomNode());
        // If the beginning of a multi-chord keybinding is pressed,
        // or the command aims to focus the hover,
        // set the variable to true, otherwise false
        const shouldKeepHoverVisible = resolvedKeyboardEvent.kind === 1 /* ResultKind.MoreChordsNeeded */  || resolvedKeyboardEvent.kind === 2 /* ResultKind.KbFound */  && (resolvedKeyboardEvent.commandId === (0, $12f419b3d72893f8$export$62786f1070e2cbd1) || resolvedKeyboardEvent.commandId === (0, $12f419b3d72893f8$export$876e0bba4925f0cd) || resolvedKeyboardEvent.commandId === (0, $12f419b3d72893f8$export$cb7016f65e6be5ca)) && this._contentWidget?.isVisible;
        if (e.keyCode === 5 /* KeyCode.Ctrl */  || e.keyCode === 6 /* KeyCode.Alt */  || e.keyCode === 57 /* KeyCode.Meta */  || e.keyCode === 4 /* KeyCode.Shift */  || shouldKeepHoverVisible) // Do not hide hover when a modifier key is pressed
        return;
        this._hideWidgets();
    }
    _hideWidgets() {
        if ($174d42e875580d53$var$_sticky) return;
        if (this._hoverState.mouseDown && this._contentWidget?.isColorPickerVisible || (0, $b8b03009035a1e69$export$4773b7ce527dcc8e).dropDownVisible) return;
        this._hoverState.activatedByDecoratorClick = false;
        this._contentWidget?.hide();
    }
    _getOrCreateContentWidget() {
        if (!this._contentWidget) {
            this._contentWidget = this._instantiationService.createInstance((0, $6ea699b0e8a55a52$export$d57864329c122a65), this._editor);
            this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()));
        }
        return this._contentWidget;
    }
    showContentHover(range, mode, source, focus, activatedByColorDecoratorClick = false) {
        this._hoverState.activatedByDecoratorClick = activatedByColorDecoratorClick;
        this._getOrCreateContentWidget().startShowingAtRange(range, mode, source, focus);
    }
    _isContentWidgetResizing() {
        return this._contentWidget?.widget.isResizing || false;
    }
    focusedHoverPartIndex() {
        return this._getOrCreateContentWidget().focusedHoverPartIndex();
    }
    updateHoverVerbosityLevel(action, index, focus) {
        this._getOrCreateContentWidget().updateHoverVerbosityLevel(action, index, focus);
    }
    focus() {
        this._contentWidget?.focus();
    }
    scrollUp() {
        this._contentWidget?.scrollUp();
    }
    scrollDown() {
        this._contentWidget?.scrollDown();
    }
    scrollLeft() {
        this._contentWidget?.scrollLeft();
    }
    scrollRight() {
        this._contentWidget?.scrollRight();
    }
    pageUp() {
        this._contentWidget?.pageUp();
    }
    pageDown() {
        this._contentWidget?.pageDown();
    }
    goToTop() {
        this._contentWidget?.goToTop();
    }
    goToBottom() {
        this._contentWidget?.goToBottom();
    }
    get isColorPickerVisible() {
        return this._contentWidget?.isColorPickerVisible;
    }
    get isHoverVisible() {
        return this._contentWidget?.isVisible;
    }
    dispose() {
        super.dispose();
        this._unhookListeners();
        this._listenersStore.dispose();
        this._contentWidget?.dispose();
    }
};
$174d42e875580d53$export$df69c8e8290b334c = $174d42e875580d53$var$ContentHoverController_1 = $174d42e875580d53$var$__decorate([
    $174d42e875580d53$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $174d42e875580d53$var$__param(2, (0, $7IxGd.IKeybindingService))
], $174d42e875580d53$export$df69c8e8290b334c);



class $81f73243898b733f$export$207d84fc3451c066 extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.colorContribution';
    }
    constructor(_editor){
        super();
        this._editor = _editor;
        this._register(_editor.onMouseDown((e)=>this.onMouseDown(e)));
    }
    dispose() {
        super.dispose();
    }
    onMouseDown(mouseEvent) {
        const colorDecoratorsActivatedOn = this._editor.getOption(149 /* EditorOption.colorDecoratorsActivatedOn */ );
        if (colorDecoratorsActivatedOn !== 'click' && colorDecoratorsActivatedOn !== 'clickAndHover') return;
        const target = mouseEvent.target;
        if (target.type !== 6 /* MouseTargetType.CONTENT_TEXT */ ) return;
        if (!target.detail.injectedText) return;
        if (target.detail.injectedText.options.attachedData !== (0, $dafa37c57c56cca4$export$f3ca1233c9ea131e)) return;
        if (!target.range) return;
        const hoverController = this._editor.getContribution((0, $174d42e875580d53$export$df69c8e8290b334c).ID);
        if (!hoverController) return;
        if (!hoverController.isColorPickerVisible) {
            const range = new (0, $d00il.Range)(target.range.startLineNumber, target.range.startColumn + 1, target.range.endLineNumber, target.range.endColumn + 1);
            hoverController.showContentHover(range, 1 /* HoverStartMode.Immediate */ , 0 /* HoverStartSource.Mouse */ , false, true);
        }
    }
}
(0, $2iJTi.registerEditorContribution)($81f73243898b733f$export$207d84fc3451c066.ID, $81f73243898b733f$export$207d84fc3451c066, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $4760294cb1bcf994$export$fc2e2429672a46bc).register((0, $6d075c31a65fd2a0$export$c4145a38e12cf25c));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $4dEdH = parcelRequire("4dEdH");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");


var $fdGPu = parcelRequire("fdGPu");


var $7IxGd = parcelRequire("7IxGd");

var $5YaSO = parcelRequire("5YaSO");

var $4J6fu = parcelRequire("4J6fu");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $cxCeF = parcelRequire("cxCeF");


var $bDzmQ = parcelRequire("bDzmQ");


var $zvLvK = parcelRequire("zvLvK");
var $ef272ff3a9685307$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $ef272ff3a9685307$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $ef272ff3a9685307$var$StandaloneColorPickerController_1, $ef272ff3a9685307$var$StandaloneColorPickerWidget_1;
let $ef272ff3a9685307$export$862ed976a91148e = class StandaloneColorPickerController extends (0, $9cWcn.Disposable) {
    static{
        $ef272ff3a9685307$var$StandaloneColorPickerController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.standaloneColorPickerController';
    }
    constructor(_editor, _contextKeyService, _instantiationService){
        super();
        this._editor = _editor;
        this._instantiationService = _instantiationService;
        this._standaloneColorPickerWidget = null;
        this._standaloneColorPickerVisible = (0, $ibKGQ.EditorContextKeys).standaloneColorPickerVisible.bindTo(_contextKeyService);
        this._standaloneColorPickerFocused = (0, $ibKGQ.EditorContextKeys).standaloneColorPickerFocused.bindTo(_contextKeyService);
    }
    showOrFocus() {
        if (!this._editor.hasModel()) return;
        if (!this._standaloneColorPickerVisible.get()) this._standaloneColorPickerWidget = this._instantiationService.createInstance($ef272ff3a9685307$export$606e34d3f567ca1e, this._editor, this._standaloneColorPickerVisible, this._standaloneColorPickerFocused);
        else if (!this._standaloneColorPickerFocused.get()) this._standaloneColorPickerWidget?.focus();
    }
    hide() {
        this._standaloneColorPickerFocused.set(false);
        this._standaloneColorPickerVisible.set(false);
        this._standaloneColorPickerWidget?.hide();
        this._editor.focus();
    }
    insertColor() {
        this._standaloneColorPickerWidget?.updateEditor();
        this.hide();
    }
    static get(editor) {
        return editor.getContribution($ef272ff3a9685307$var$StandaloneColorPickerController_1.ID);
    }
};
$ef272ff3a9685307$export$862ed976a91148e = $ef272ff3a9685307$var$StandaloneColorPickerController_1 = $ef272ff3a9685307$var$__decorate([
    $ef272ff3a9685307$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $ef272ff3a9685307$var$__param(2, (0, $fdGPu.IInstantiationService))
], $ef272ff3a9685307$export$862ed976a91148e);
(0, $2iJTi.registerEditorContribution)($ef272ff3a9685307$export$862ed976a91148e.ID, $ef272ff3a9685307$export$862ed976a91148e, 1 /* EditorContributionInstantiation.AfterFirstRender */ );
const $ef272ff3a9685307$var$PADDING = 8;
const $ef272ff3a9685307$var$CLOSE_BUTTON_WIDTH = 22;
let $ef272ff3a9685307$export$606e34d3f567ca1e = class StandaloneColorPickerWidget extends (0, $9cWcn.Disposable) {
    static{
        $ef272ff3a9685307$var$StandaloneColorPickerWidget_1 = this;
    }
    static{
        this.ID = 'editor.contrib.standaloneColorPickerWidget';
    }
    constructor(_editor, _standaloneColorPickerVisible, _standaloneColorPickerFocused, _instantiationService, _keybindingService, _languageFeaturesService, _editorWorkerService){
        super();
        this._editor = _editor;
        this._standaloneColorPickerVisible = _standaloneColorPickerVisible;
        this._standaloneColorPickerFocused = _standaloneColorPickerFocused;
        this._keybindingService = _keybindingService;
        this._languageFeaturesService = _languageFeaturesService;
        this._editorWorkerService = _editorWorkerService;
        this.allowEditorOverflow = true;
        this._position = undefined;
        this._body = document.createElement('div');
        this._colorHover = null;
        this._selectionSetInEditor = false;
        this._onResult = this._register(new (0, $5YaSO.Emitter)());
        this.onResult = this._onResult.event;
        this._standaloneColorPickerVisible.set(true);
        this._standaloneColorPickerParticipant = _instantiationService.createInstance((0, $6d075c31a65fd2a0$export$32cb5245d7be00c7), this._editor);
        this._position = this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;
        const editorSelection = this._editor.getSelection();
        const selection = editorSelection ? {
            startLineNumber: editorSelection.startLineNumber,
            startColumn: editorSelection.startColumn,
            endLineNumber: editorSelection.endLineNumber,
            endColumn: editorSelection.endColumn
        } : {
            startLineNumber: 0,
            endLineNumber: 0,
            endColumn: 0,
            startColumn: 0
        };
        const focusTracker = this._register($bDzmQ.trackFocus(this._body));
        this._register(focusTracker.onDidBlur((_)=>{
            this.hide();
        }));
        this._register(focusTracker.onDidFocus((_)=>{
            this.focus();
        }));
        // When the cursor position changes, hide the color picker
        this._register(this._editor.onDidChangeCursorPosition(()=>{
            // Do not hide the color picker when the cursor changes position due to the keybindings
            if (!this._selectionSetInEditor) this.hide();
            else this._selectionSetInEditor = false;
        }));
        this._register(this._editor.onMouseMove((e)=>{
            const classList = e.target.element?.classList;
            if (classList && classList.contains('colorpicker-color-decoration')) this.hide();
        }));
        this._register(this.onResult((result)=>{
            this._render(result.value, result.foundInEditor);
        }));
        this._start(selection);
        this._body.style.zIndex = '50';
        this._editor.addContentWidget(this);
    }
    updateEditor() {
        if (this._colorHover) this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover);
    }
    getId() {
        return $ef272ff3a9685307$var$StandaloneColorPickerWidget_1.ID;
    }
    getDomNode() {
        return this._body;
    }
    getPosition() {
        if (!this._position) return null;
        const positionPreference = this._editor.getOption(60 /* EditorOption.hover */ ).above;
        return {
            position: this._position,
            secondaryPosition: this._position,
            preference: positionPreference ? [
                1 /* ContentWidgetPositionPreference.ABOVE */ ,
                2 /* ContentWidgetPositionPreference.BELOW */ 
            ] : [
                2 /* ContentWidgetPositionPreference.BELOW */ ,
                1 /* ContentWidgetPositionPreference.ABOVE */ 
            ],
            positionAffinity: 2 /* PositionAffinity.None */ 
        };
    }
    hide() {
        this.dispose();
        this._standaloneColorPickerVisible.set(false);
        this._standaloneColorPickerFocused.set(false);
        this._editor.removeContentWidget(this);
        this._editor.focus();
    }
    focus() {
        this._standaloneColorPickerFocused.set(true);
        this._body.focus();
    }
    async _start(selection) {
        const computeAsyncResult = await this._computeAsync(selection);
        if (!computeAsyncResult) return;
        this._onResult.fire(new $ef272ff3a9685307$var$StandaloneColorPickerResult(computeAsyncResult.result, computeAsyncResult.foundInEditor));
    }
    async _computeAsync(range) {
        if (!this._editor.hasModel()) return null;
        const colorInfo = {
            range: range,
            color: {
                red: 0,
                green: 0,
                blue: 0,
                alpha: 1
            }
        };
        const colorHoverResult = await this._standaloneColorPickerParticipant.createColorHover(colorInfo, new (0, $fbfb5a95eda13a12$export$2ca312b7c8c08c1e)(this._editorWorkerService), this._languageFeaturesService.colorProvider);
        if (!colorHoverResult) return null;
        return {
            result: colorHoverResult.colorHover,
            foundInEditor: colorHoverResult.foundInEditor
        };
    }
    _render(colorHover, foundInEditor) {
        const fragment = document.createDocumentFragment();
        const statusBar = this._register(new (0, $9559ba32f7b69229$export$b3dad84b67c8b2c0)(this._keybindingService));
        const context = {
            fragment: fragment,
            statusBar: statusBar,
            onContentsChanged: ()=>{},
            hide: ()=>this.hide()
        };
        this._colorHover = colorHover;
        const renderedHoverPart = this._standaloneColorPickerParticipant.renderHoverParts(context, [
            colorHover
        ]);
        if (!renderedHoverPart) return;
        this._register(renderedHoverPart.disposables);
        const colorPicker = renderedHoverPart.colorPicker;
        this._body.classList.add('standalone-colorpicker-body');
        this._body.style.maxHeight = Math.max(this._editor.getLayoutInfo().height / 4, 250) + 'px';
        this._body.style.maxWidth = Math.max(this._editor.getLayoutInfo().width * 0.66, 500) + 'px';
        this._body.tabIndex = 0;
        this._body.appendChild(fragment);
        colorPicker.layout();
        const colorPickerBody = colorPicker.body;
        const saturationBoxWidth = colorPickerBody.saturationBox.domNode.clientWidth;
        const widthOfOriginalColorBox = colorPickerBody.domNode.clientWidth - saturationBoxWidth - $ef272ff3a9685307$var$CLOSE_BUTTON_WIDTH - $ef272ff3a9685307$var$PADDING;
        const enterButton = colorPicker.body.enterButton;
        enterButton?.onClicked(()=>{
            this.updateEditor();
            this.hide();
        });
        const colorPickerHeader = colorPicker.header;
        const pickedColorNode = colorPickerHeader.pickedColorNode;
        pickedColorNode.style.width = saturationBoxWidth + $ef272ff3a9685307$var$PADDING + 'px';
        const originalColorNode = colorPickerHeader.originalColorNode;
        originalColorNode.style.width = widthOfOriginalColorBox + 'px';
        const closeButton = colorPicker.header.closeButton;
        closeButton?.onClicked(()=>{
            this.hide();
        });
        // When found in the editor, highlight the selection in the editor
        if (foundInEditor) {
            if (enterButton) enterButton.button.textContent = 'Replace';
            this._selectionSetInEditor = true;
            this._editor.setSelection(colorHover.range);
        }
        this._editor.layoutContentWidget(this);
    }
};
$ef272ff3a9685307$export$606e34d3f567ca1e = $ef272ff3a9685307$var$StandaloneColorPickerWidget_1 = $ef272ff3a9685307$var$__decorate([
    $ef272ff3a9685307$var$__param(3, (0, $fdGPu.IInstantiationService)),
    $ef272ff3a9685307$var$__param(4, (0, $7IxGd.IKeybindingService)),
    $ef272ff3a9685307$var$__param(5, (0, $4J6fu.ILanguageFeaturesService)),
    $ef272ff3a9685307$var$__param(6, (0, $zvLvK.IEditorWorkerService))
], $ef272ff3a9685307$export$606e34d3f567ca1e);
class $ef272ff3a9685307$var$StandaloneColorPickerResult {
    // The color picker result consists of: an array of color results and a boolean indicating if the color was found in the editor
    constructor(value, foundInEditor){
        this.value = value;
        this.foundInEditor = foundInEditor;
    }
}



var $ibKGQ = parcelRequire("ibKGQ");

var $g4v7E = parcelRequire("g4v7E");

class $363a20dd63b8c54a$export$2049c7e6ddd7b08b extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'editor.action.showOrFocusStandaloneColorPicker',
            title: {
                ...(0, $4dEdH.localize2)('showOrFocusStandaloneColorPicker', "Show or Focus Standalone Color Picker"),
                mnemonicTitle: (0, $4dEdH.localize)({
                    key: 'mishowOrFocusStandaloneColorPicker',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Show or Focus Standalone Color Picker")
            },
            precondition: undefined,
            menu: [
                {
                    id: (0, $g4v7E.MenuId).CommandPalette
                }
            ],
            metadata: {
                description: (0, $4dEdH.localize2)('showOrFocusStandaloneColorPickerDescription', "Show or focus a standalone color picker which uses the default color provider. It displays hex/rgb/hsl colors.")
            }
        });
    }
    runEditorCommand(_accessor, editor) {
        (0, $ef272ff3a9685307$export$862ed976a91148e).get(editor)?.showOrFocus();
    }
}
class $363a20dd63b8c54a$var$HideStandaloneColorPicker extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.hideColorPicker',
            label: (0, $4dEdH.localize)({
                key: 'hideColorPicker',
                comment: [
                    'Action that hides the color picker'
                ]
            }, "Hide the Color Picker"),
            alias: 'Hide the Color Picker',
            precondition: (0, $ibKGQ.EditorContextKeys).standaloneColorPickerVisible.isEqualTo(true),
            kbOpts: {
                primary: 9 /* KeyCode.Escape */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: (0, $4dEdH.localize2)('hideColorPickerDescription', "Hide the standalone color picker.")
            }
        });
    }
    run(_accessor, editor) {
        (0, $ef272ff3a9685307$export$862ed976a91148e).get(editor)?.hide();
    }
}
class $363a20dd63b8c54a$var$InsertColorWithStandaloneColorPicker extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.insertColorWithStandaloneColorPicker',
            label: (0, $4dEdH.localize)({
                key: 'insertColorWithStandaloneColorPicker',
                comment: [
                    'Action that inserts color with standalone color picker'
                ]
            }, "Insert Color with Standalone Color Picker"),
            alias: 'Insert Color with Standalone Color Picker',
            precondition: (0, $ibKGQ.EditorContextKeys).standaloneColorPickerFocused.isEqualTo(true),
            kbOpts: {
                primary: 3 /* KeyCode.Enter */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: (0, $4dEdH.localize2)('insertColorWithStandaloneColorPickerDescription', "Insert hex/rgb/hsl colors with the focused standalone color picker.")
            }
        });
    }
    run(_accessor, editor) {
        (0, $ef272ff3a9685307$export$862ed976a91148e).get(editor)?.insertColor();
    }
}
(0, $2iJTi.registerEditorAction)($363a20dd63b8c54a$var$HideStandaloneColorPicker);
(0, $2iJTi.registerEditorAction)($363a20dd63b8c54a$var$InsertColorWithStandaloneColorPicker);
(0, $g4v7E.registerAction2)($363a20dd63b8c54a$export$2049c7e6ddd7b08b);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $fuc8X = parcelRequire("fuc8X");

var $2iJTi = parcelRequire("2iJTi");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $1qkuR = parcelRequire("1qkuR");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kHJv6 = parcelRequire("kHJv6");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");
class $eac28d11e0642b68$export$889a1441dfb5fa88 {
    constructor(selection, insertSpace, languageConfigurationService){
        this.languageConfigurationService = languageConfigurationService;
        this._selection = selection;
        this._insertSpace = insertSpace;
        this._usedEndToken = null;
    }
    static _haystackHasNeedleAtOffset(haystack, needle, offset) {
        if (offset < 0) return false;
        const needleLength = needle.length;
        const haystackLength = haystack.length;
        if (offset + needleLength > haystackLength) return false;
        for(let i = 0; i < needleLength; i++){
            const codeA = haystack.charCodeAt(offset + i);
            const codeB = needle.charCodeAt(i);
            if (codeA === codeB) continue;
            if (codeA >= 65 /* CharCode.A */  && codeA <= 90 /* CharCode.Z */  && codeA + 32 === codeB) continue;
            if (codeB >= 65 /* CharCode.A */  && codeB <= 90 /* CharCode.Z */  && codeB + 32 === codeA) continue;
            return false;
        }
        return true;
    }
    _createOperationsForBlockComment(selection, startToken, endToken, insertSpace, model, builder) {
        const startLineNumber = selection.startLineNumber;
        const startColumn = selection.startColumn;
        const endLineNumber = selection.endLineNumber;
        const endColumn = selection.endColumn;
        const startLineText = model.getLineContent(startLineNumber);
        const endLineText = model.getLineContent(endLineNumber);
        let startTokenIndex = startLineText.lastIndexOf(startToken, startColumn - 1 + startToken.length);
        let endTokenIndex = endLineText.indexOf(endToken, endColumn - 1 - endToken.length);
        if (startTokenIndex !== -1 && endTokenIndex !== -1) {
            if (startLineNumber === endLineNumber) {
                const lineBetweenTokens = startLineText.substring(startTokenIndex + startToken.length, endTokenIndex);
                if (lineBetweenTokens.indexOf(endToken) >= 0) {
                    // force to add a block comment
                    startTokenIndex = -1;
                    endTokenIndex = -1;
                }
            } else {
                const startLineAfterStartToken = startLineText.substring(startTokenIndex + startToken.length);
                const endLineBeforeEndToken = endLineText.substring(0, endTokenIndex);
                if (startLineAfterStartToken.indexOf(endToken) >= 0 || endLineBeforeEndToken.indexOf(endToken) >= 0) {
                    // force to add a block comment
                    startTokenIndex = -1;
                    endTokenIndex = -1;
                }
            }
        }
        let ops;
        if (startTokenIndex !== -1 && endTokenIndex !== -1) {
            // Consider spaces as part of the comment tokens
            if (insertSpace && startTokenIndex + startToken.length < startLineText.length && startLineText.charCodeAt(startTokenIndex + startToken.length) === 32 /* CharCode.Space */ ) // Pretend the start token contains a trailing space
            startToken = startToken + ' ';
            if (insertSpace && endTokenIndex > 0 && endLineText.charCodeAt(endTokenIndex - 1) === 32 /* CharCode.Space */ ) {
                // Pretend the end token contains a leading space
                endToken = ' ' + endToken;
                endTokenIndex -= 1;
            }
            ops = $eac28d11e0642b68$export$889a1441dfb5fa88._createRemoveBlockCommentOperations(new (0, $d00il.Range)(startLineNumber, startTokenIndex + startToken.length + 1, endLineNumber, endTokenIndex + 1), startToken, endToken);
        } else {
            ops = $eac28d11e0642b68$export$889a1441dfb5fa88._createAddBlockCommentOperations(selection, startToken, endToken, this._insertSpace);
            this._usedEndToken = ops.length === 1 ? endToken : null;
        }
        for (const op of ops)builder.addTrackedEditOperation(op.range, op.text);
    }
    static _createRemoveBlockCommentOperations(r, startToken, endToken) {
        const res = [];
        if (!(0, $d00il.Range).isEmpty(r)) {
            // Remove block comment start
            res.push((0, $kHJv6.EditOperation).delete(new (0, $d00il.Range)(r.startLineNumber, r.startColumn - startToken.length, r.startLineNumber, r.startColumn)));
            // Remove block comment end
            res.push((0, $kHJv6.EditOperation).delete(new (0, $d00il.Range)(r.endLineNumber, r.endColumn, r.endLineNumber, r.endColumn + endToken.length)));
        } else // Remove both continuously
        res.push((0, $kHJv6.EditOperation).delete(new (0, $d00il.Range)(r.startLineNumber, r.startColumn - startToken.length, r.endLineNumber, r.endColumn + endToken.length)));
        return res;
    }
    static _createAddBlockCommentOperations(r, startToken, endToken, insertSpace) {
        const res = [];
        if (!(0, $d00il.Range).isEmpty(r)) {
            // Insert block comment start
            res.push((0, $kHJv6.EditOperation).insert(new (0, $dcxQ7.Position)(r.startLineNumber, r.startColumn), startToken + (insertSpace ? ' ' : '')));
            // Insert block comment end
            res.push((0, $kHJv6.EditOperation).insert(new (0, $dcxQ7.Position)(r.endLineNumber, r.endColumn), (insertSpace ? ' ' : '') + endToken));
        } else // Insert both continuously
        res.push((0, $kHJv6.EditOperation).replace(new (0, $d00il.Range)(r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn), startToken + '  ' + endToken));
        return res;
    }
    getEditOperations(model, builder) {
        const startLineNumber = this._selection.startLineNumber;
        const startColumn = this._selection.startColumn;
        model.tokenization.tokenizeIfCheap(startLineNumber);
        const languageId = model.getLanguageIdAtPosition(startLineNumber, startColumn);
        const config = this.languageConfigurationService.getLanguageConfiguration(languageId).comments;
        if (!config || !config.blockCommentStartToken || !config.blockCommentEndToken) // Mode does not support block comments
        return;
        this._createOperationsForBlockComment(this._selection, config.blockCommentStartToken, config.blockCommentEndToken, this._insertSpace, model, builder);
    }
    computeCursorState(model, helper) {
        const inverseEditOperations = helper.getInverseEditOperations();
        if (inverseEditOperations.length === 2) {
            const startTokenEditOperation = inverseEditOperations[0];
            const endTokenEditOperation = inverseEditOperations[1];
            return new (0, $jzicX.Selection)(startTokenEditOperation.range.endLineNumber, startTokenEditOperation.range.endColumn, endTokenEditOperation.range.startLineNumber, endTokenEditOperation.range.startColumn);
        } else {
            const srcRange = inverseEditOperations[0].range;
            const deltaColumn = this._usedEndToken ? -this._usedEndToken.length - 1 : 0; // minus 1 space before endToken
            return new (0, $jzicX.Selection)(srcRange.endLineNumber, srcRange.endColumn + deltaColumn, srcRange.endLineNumber, srcRange.endColumn + deltaColumn);
        }
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $jcr1R = parcelRequire("jcr1R");

var $kHJv6 = parcelRequire("kHJv6");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

class $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9 {
    constructor(languageConfigurationService, selection, indentSize, type, insertSpace, ignoreEmptyLines, ignoreFirstLine){
        this.languageConfigurationService = languageConfigurationService;
        this._selection = selection;
        this._indentSize = indentSize;
        this._type = type;
        this._insertSpace = insertSpace;
        this._selectionId = null;
        this._deltaColumn = 0;
        this._moveEndPositionDown = false;
        this._ignoreEmptyLines = ignoreEmptyLines;
        this._ignoreFirstLine = ignoreFirstLine || false;
    }
    /**
     * Do an initial pass over the lines and gather info about the line comment string.
     * Returns null if any of the lines doesn't support a line comment string.
     */ static _gatherPreflightCommentStrings(model, startLineNumber, endLineNumber, languageConfigurationService) {
        model.tokenization.tokenizeIfCheap(startLineNumber);
        const languageId = model.getLanguageIdAtPosition(startLineNumber, 1);
        const config = languageConfigurationService.getLanguageConfiguration(languageId).comments;
        const commentStr = config ? config.lineCommentToken : null;
        if (!commentStr) // Mode does not support line comments
        return null;
        const lines = [];
        for(let i = 0, lineCount = endLineNumber - startLineNumber + 1; i < lineCount; i++)lines[i] = {
            ignore: false,
            commentStr: commentStr,
            commentStrOffset: 0,
            commentStrLength: commentStr.length
        };
        return lines;
    }
    /**
     * Analyze lines and decide which lines are relevant and what the toggle should do.
     * Also, build up several offsets and lengths useful in the generation of editor operations.
     */ static _analyzeLines(type, insertSpace, model, lines, startLineNumber, ignoreEmptyLines, ignoreFirstLine, languageConfigurationService) {
        let onlyWhitespaceLines = true;
        let shouldRemoveComments;
        if (type === 0 /* Type.Toggle */ ) shouldRemoveComments = true;
        else if (type === 1 /* Type.ForceAdd */ ) shouldRemoveComments = false;
        else shouldRemoveComments = true;
        for(let i = 0, lineCount = lines.length; i < lineCount; i++){
            const lineData = lines[i];
            const lineNumber = startLineNumber + i;
            if (lineNumber === startLineNumber && ignoreFirstLine) {
                // first line ignored
                lineData.ignore = true;
                continue;
            }
            const lineContent = model.getLineContent(lineNumber);
            const lineContentStartOffset = $jcr1R.firstNonWhitespaceIndex(lineContent);
            if (lineContentStartOffset === -1) {
                // Empty or whitespace only line
                lineData.ignore = ignoreEmptyLines;
                lineData.commentStrOffset = lineContent.length;
                continue;
            }
            onlyWhitespaceLines = false;
            lineData.ignore = false;
            lineData.commentStrOffset = lineContentStartOffset;
            if (shouldRemoveComments && !(0, $eac28d11e0642b68$export$889a1441dfb5fa88)._haystackHasNeedleAtOffset(lineContent, lineData.commentStr, lineContentStartOffset)) {
                if (type === 0 /* Type.Toggle */ ) // Every line so far has been a line comment, but this one is not
                shouldRemoveComments = false;
                else if (type === 1 /* Type.ForceAdd */ ) ;
                else lineData.ignore = true;
            }
            if (shouldRemoveComments && insertSpace) {
                // Remove a following space if present
                const commentStrEndOffset = lineContentStartOffset + lineData.commentStrLength;
                if (commentStrEndOffset < lineContent.length && lineContent.charCodeAt(commentStrEndOffset) === 32 /* CharCode.Space */ ) lineData.commentStrLength += 1;
            }
        }
        if (type === 0 /* Type.Toggle */  && onlyWhitespaceLines) {
            // For only whitespace lines, we insert comments
            shouldRemoveComments = false;
            // Also, no longer ignore them
            for(let i = 0, lineCount = lines.length; i < lineCount; i++)lines[i].ignore = false;
        }
        return {
            supported: true,
            shouldRemoveComments: shouldRemoveComments,
            lines: lines
        };
    }
    /**
     * Analyze all lines and decide exactly what to do => not supported | insert line comments | remove line comments
     */ static _gatherPreflightData(type, insertSpace, model, startLineNumber, endLineNumber, ignoreEmptyLines, ignoreFirstLine, languageConfigurationService) {
        const lines = $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9._gatherPreflightCommentStrings(model, startLineNumber, endLineNumber, languageConfigurationService);
        if (lines === null) return {
            supported: false
        };
        return $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9._analyzeLines(type, insertSpace, model, lines, startLineNumber, ignoreEmptyLines, ignoreFirstLine, languageConfigurationService);
    }
    /**
     * Given a successful analysis, execute either insert line comments, either remove line comments
     */ _executeLineComments(model, builder, data, s) {
        let ops;
        if (data.shouldRemoveComments) ops = $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9._createRemoveLineCommentsOperations(data.lines, s.startLineNumber);
        else {
            $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9._normalizeInsertionPoint(model, data.lines, s.startLineNumber, this._indentSize);
            ops = this._createAddLineCommentsOperations(data.lines, s.startLineNumber);
        }
        const cursorPosition = new (0, $dcxQ7.Position)(s.positionLineNumber, s.positionColumn);
        for(let i = 0, len = ops.length; i < len; i++){
            builder.addEditOperation(ops[i].range, ops[i].text);
            if ((0, $d00il.Range).isEmpty(ops[i].range) && (0, $d00il.Range).getStartPosition(ops[i].range).equals(cursorPosition)) {
                const lineContent = model.getLineContent(cursorPosition.lineNumber);
                if (lineContent.length + 1 === cursorPosition.column) this._deltaColumn = (ops[i].text || '').length;
            }
        }
        this._selectionId = builder.trackSelection(s);
    }
    _attemptRemoveBlockComment(model, s, startToken, endToken) {
        let startLineNumber = s.startLineNumber;
        let endLineNumber = s.endLineNumber;
        const startTokenAllowedBeforeColumn = endToken.length + Math.max(model.getLineFirstNonWhitespaceColumn(s.startLineNumber), s.startColumn);
        let startTokenIndex = model.getLineContent(startLineNumber).lastIndexOf(startToken, startTokenAllowedBeforeColumn - 1);
        let endTokenIndex = model.getLineContent(endLineNumber).indexOf(endToken, s.endColumn - 1 - startToken.length);
        if (startTokenIndex !== -1 && endTokenIndex === -1) {
            endTokenIndex = model.getLineContent(startLineNumber).indexOf(endToken, startTokenIndex + startToken.length);
            endLineNumber = startLineNumber;
        }
        if (startTokenIndex === -1 && endTokenIndex !== -1) {
            startTokenIndex = model.getLineContent(endLineNumber).lastIndexOf(startToken, endTokenIndex);
            startLineNumber = endLineNumber;
        }
        if (s.isEmpty() && (startTokenIndex === -1 || endTokenIndex === -1)) {
            startTokenIndex = model.getLineContent(startLineNumber).indexOf(startToken);
            if (startTokenIndex !== -1) endTokenIndex = model.getLineContent(startLineNumber).indexOf(endToken, startTokenIndex + startToken.length);
        }
        // We have to adjust to possible inner white space.
        // For Space after startToken, add Space to startToken - range math will work out.
        if (startTokenIndex !== -1 && model.getLineContent(startLineNumber).charCodeAt(startTokenIndex + startToken.length) === 32 /* CharCode.Space */ ) startToken += ' ';
        // For Space before endToken, add Space before endToken and shift index one left.
        if (endTokenIndex !== -1 && model.getLineContent(endLineNumber).charCodeAt(endTokenIndex - 1) === 32 /* CharCode.Space */ ) {
            endToken = ' ' + endToken;
            endTokenIndex -= 1;
        }
        if (startTokenIndex !== -1 && endTokenIndex !== -1) return (0, $eac28d11e0642b68$export$889a1441dfb5fa88)._createRemoveBlockCommentOperations(new (0, $d00il.Range)(startLineNumber, startTokenIndex + startToken.length + 1, endLineNumber, endTokenIndex + 1), startToken, endToken);
        return null;
    }
    /**
     * Given an unsuccessful analysis, delegate to the block comment command
     */ _executeBlockComment(model, builder, s) {
        model.tokenization.tokenizeIfCheap(s.startLineNumber);
        const languageId = model.getLanguageIdAtPosition(s.startLineNumber, 1);
        const config = this.languageConfigurationService.getLanguageConfiguration(languageId).comments;
        if (!config || !config.blockCommentStartToken || !config.blockCommentEndToken) // Mode does not support block comments
        return;
        const startToken = config.blockCommentStartToken;
        const endToken = config.blockCommentEndToken;
        let ops = this._attemptRemoveBlockComment(model, s, startToken, endToken);
        if (!ops) {
            if (s.isEmpty()) {
                const lineContent = model.getLineContent(s.startLineNumber);
                let firstNonWhitespaceIndex = $jcr1R.firstNonWhitespaceIndex(lineContent);
                if (firstNonWhitespaceIndex === -1) // Line is empty or contains only whitespace
                firstNonWhitespaceIndex = lineContent.length;
                ops = (0, $eac28d11e0642b68$export$889a1441dfb5fa88)._createAddBlockCommentOperations(new (0, $d00il.Range)(s.startLineNumber, firstNonWhitespaceIndex + 1, s.startLineNumber, lineContent.length + 1), startToken, endToken, this._insertSpace);
            } else ops = (0, $eac28d11e0642b68$export$889a1441dfb5fa88)._createAddBlockCommentOperations(new (0, $d00il.Range)(s.startLineNumber, model.getLineFirstNonWhitespaceColumn(s.startLineNumber), s.endLineNumber, model.getLineMaxColumn(s.endLineNumber)), startToken, endToken, this._insertSpace);
            if (ops.length === 1) // Leave cursor after token and Space
            this._deltaColumn = startToken.length + 1;
        }
        this._selectionId = builder.trackSelection(s);
        for (const op of ops)builder.addEditOperation(op.range, op.text);
    }
    getEditOperations(model, builder) {
        let s = this._selection;
        this._moveEndPositionDown = false;
        if (s.startLineNumber === s.endLineNumber && this._ignoreFirstLine) {
            builder.addEditOperation(new (0, $d00il.Range)(s.startLineNumber, model.getLineMaxColumn(s.startLineNumber), s.startLineNumber + 1, 1), s.startLineNumber === model.getLineCount() ? '' : '\n');
            this._selectionId = builder.trackSelection(s);
            return;
        }
        if (s.startLineNumber < s.endLineNumber && s.endColumn === 1) {
            this._moveEndPositionDown = true;
            s = s.setEndPosition(s.endLineNumber - 1, model.getLineMaxColumn(s.endLineNumber - 1));
        }
        const data = $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9._gatherPreflightData(this._type, this._insertSpace, model, s.startLineNumber, s.endLineNumber, this._ignoreEmptyLines, this._ignoreFirstLine, this.languageConfigurationService);
        if (data.supported) return this._executeLineComments(model, builder, data, s);
        return this._executeBlockComment(model, builder, s);
    }
    computeCursorState(model, helper) {
        let result = helper.getTrackedSelection(this._selectionId);
        if (this._moveEndPositionDown) result = result.setEndPosition(result.endLineNumber + 1, 1);
        return new (0, $jzicX.Selection)(result.selectionStartLineNumber, result.selectionStartColumn + this._deltaColumn, result.positionLineNumber, result.positionColumn + this._deltaColumn);
    }
    /**
     * Generate edit operations in the remove line comment case
     */ static _createRemoveLineCommentsOperations(lines, startLineNumber) {
        const res = [];
        for(let i = 0, len = lines.length; i < len; i++){
            const lineData = lines[i];
            if (lineData.ignore) continue;
            res.push((0, $kHJv6.EditOperation).delete(new (0, $d00il.Range)(startLineNumber + i, lineData.commentStrOffset + 1, startLineNumber + i, lineData.commentStrOffset + lineData.commentStrLength + 1)));
        }
        return res;
    }
    /**
     * Generate edit operations in the add line comment case
     */ _createAddLineCommentsOperations(lines, startLineNumber) {
        const res = [];
        const afterCommentStr = this._insertSpace ? ' ' : '';
        for(let i = 0, len = lines.length; i < len; i++){
            const lineData = lines[i];
            if (lineData.ignore) continue;
            res.push((0, $kHJv6.EditOperation).insert(new (0, $dcxQ7.Position)(startLineNumber + i, lineData.commentStrOffset + 1), lineData.commentStr + afterCommentStr));
        }
        return res;
    }
    static nextVisibleColumn(currentVisibleColumn, indentSize, isTab, columnSize) {
        if (isTab) return currentVisibleColumn + (indentSize - currentVisibleColumn % indentSize);
        return currentVisibleColumn + columnSize;
    }
    /**
     * Adjust insertion points to have them vertically aligned in the add line comment case
     */ static _normalizeInsertionPoint(model, lines, startLineNumber, indentSize) {
        let minVisibleColumn = 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ ;
        let j;
        let lenJ;
        for(let i = 0, len = lines.length; i < len; i++){
            if (lines[i].ignore) continue;
            const lineContent = model.getLineContent(startLineNumber + i);
            let currentVisibleColumn = 0;
            for(let j = 0, lenJ = lines[i].commentStrOffset; currentVisibleColumn < minVisibleColumn && j < lenJ; j++)currentVisibleColumn = $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9.nextVisibleColumn(currentVisibleColumn, indentSize, lineContent.charCodeAt(j) === 9 /* CharCode.Tab */ , 1);
            if (currentVisibleColumn < minVisibleColumn) minVisibleColumn = currentVisibleColumn;
        }
        minVisibleColumn = Math.floor(minVisibleColumn / indentSize) * indentSize;
        for(let i = 0, len = lines.length; i < len; i++){
            if (lines[i].ignore) continue;
            const lineContent = model.getLineContent(startLineNumber + i);
            let currentVisibleColumn = 0;
            for(j = 0, lenJ = lines[i].commentStrOffset; currentVisibleColumn < minVisibleColumn && j < lenJ; j++)currentVisibleColumn = $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9.nextVisibleColumn(currentVisibleColumn, indentSize, lineContent.charCodeAt(j) === 9 /* CharCode.Tab */ , 1);
            if (currentVisibleColumn > minVisibleColumn) lines[i].commentStrOffset = j - 1;
            else lines[i].commentStrOffset = j;
        }
    }
}



var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");
class $845550b7ecbcd32f$var$CommentLineAction extends (0, $2iJTi.EditorAction) {
    constructor(type, opts){
        super(opts);
        this._type = type;
    }
    run(accessor, editor) {
        const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
        if (!editor.hasModel()) return;
        const model = editor.getModel();
        const commands = [];
        const modelOptions = model.getOptions();
        const commentsOptions = editor.getOption(23 /* EditorOption.comments */ );
        const selections = editor.getSelections().map((selection, index)=>({
                selection: selection,
                index: index,
                ignoreFirstLine: false
            }));
        selections.sort((a, b)=>(0, $d00il.Range).compareRangesUsingStarts(a.selection, b.selection));
        // Remove selections that would result in copying the same line
        let prev = selections[0];
        for(let i = 1; i < selections.length; i++){
            const curr = selections[i];
            if (prev.selection.endLineNumber === curr.selection.startLineNumber) {
                // these two selections would copy the same line
                if (prev.index < curr.index) // prev wins
                curr.ignoreFirstLine = true;
                else {
                    // curr wins
                    prev.ignoreFirstLine = true;
                    prev = curr;
                }
            }
        }
        for (const selection of selections)commands.push(new (0, $f72a2b9ae3d2d8eb$export$da3e0fab717c9ef9)(languageConfigurationService, selection.selection, modelOptions.indentSize, this._type, commentsOptions.insertSpace, commentsOptions.ignoreEmptyLines, selection.ignoreFirstLine));
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
class $845550b7ecbcd32f$var$ToggleCommentLineAction extends $845550b7ecbcd32f$var$CommentLineAction {
    constructor(){
        super(0 /* Type.Toggle */ , {
            id: 'editor.action.commentLine',
            label: $4dEdH.localize('comment.line', "Toggle Line Comment"),
            alias: 'Toggle Line Comment',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2138 /* KeyCode.Slash */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarEditMenu,
                group: '5_insert',
                title: $4dEdH.localize({
                    key: 'miToggleLineComment',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Toggle Line Comment"),
                order: 1
            }
        });
    }
}
class $845550b7ecbcd32f$var$AddLineCommentAction extends $845550b7ecbcd32f$var$CommentLineAction {
    constructor(){
        super(1 /* Type.ForceAdd */ , {
            id: 'editor.action.addCommentLine',
            label: $4dEdH.localize('comment.line.add', "Add Line Comment"),
            alias: 'Add Line Comment',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2081 /* KeyCode.KeyC */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $845550b7ecbcd32f$var$RemoveLineCommentAction extends $845550b7ecbcd32f$var$CommentLineAction {
    constructor(){
        super(2 /* Type.ForceRemove */ , {
            id: 'editor.action.removeCommentLine',
            label: $4dEdH.localize('comment.line.remove', "Remove Line Comment"),
            alias: 'Remove Line Comment',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2099 /* KeyCode.KeyU */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $845550b7ecbcd32f$var$BlockCommentAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.blockComment',
            label: $4dEdH.localize('comment.block', "Toggle Block Comment"),
            alias: 'Toggle Block Comment',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1567 /* KeyCode.KeyA */ ,
                linux: {
                    primary: 3103 /* KeyCode.KeyA */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarEditMenu,
                group: '5_insert',
                title: $4dEdH.localize({
                    key: 'miToggleBlockComment',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Toggle &&Block Comment"),
                order: 2
            }
        });
    }
    run(accessor, editor) {
        const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
        if (!editor.hasModel()) return;
        const commentsOptions = editor.getOption(23 /* EditorOption.comments */ );
        const commands = [];
        const selections = editor.getSelections();
        for (const selection of selections)commands.push(new (0, $eac28d11e0642b68$export$889a1441dfb5fa88)(selection, commentsOptions.insertSpace, languageConfigurationService));
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
(0, $2iJTi.registerEditorAction)($845550b7ecbcd32f$var$ToggleCommentLineAction);
(0, $2iJTi.registerEditorAction)($845550b7ecbcd32f$var$AddLineCommentAction);
(0, $2iJTi.registerEditorAction)($845550b7ecbcd32f$var$RemoveLineCommentAction);
(0, $2iJTi.registerEditorAction)($845550b7ecbcd32f$var$BlockCommentAction);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $6nSvp = parcelRequire("6nSvp");

var $cVfMQ = parcelRequire("cVfMQ");

var $9cWcn = parcelRequire("9cWcn");

var $lb0Ah = parcelRequire("lb0Ah");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");

var $d6K7e = parcelRequire("d6K7e");

var $7IxGd = parcelRequire("7IxGd");

var $35IZ9 = parcelRequire("35IZ9");

var $6c7bv = parcelRequire("6c7bv");
var $5545e172cd36db6d$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $5545e172cd36db6d$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $5545e172cd36db6d$var$ContextMenuController_1;
let $5545e172cd36db6d$export$4b3a61d923941f77 = class ContextMenuController {
    static{
        $5545e172cd36db6d$var$ContextMenuController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.contextmenu';
    }
    static get(editor) {
        return editor.getContribution($5545e172cd36db6d$var$ContextMenuController_1.ID);
    }
    constructor(editor, _contextMenuService, _contextViewService, _contextKeyService, _keybindingService, _menuService, _configurationService, _workspaceContextService){
        this._contextMenuService = _contextMenuService;
        this._contextViewService = _contextViewService;
        this._contextKeyService = _contextKeyService;
        this._keybindingService = _keybindingService;
        this._menuService = _menuService;
        this._configurationService = _configurationService;
        this._workspaceContextService = _workspaceContextService;
        this._toDispose = new (0, $9cWcn.DisposableStore)();
        this._contextMenuIsBeingShownCount = 0;
        this._editor = editor;
        this._toDispose.add(this._editor.onContextMenu((e)=>this._onContextMenu(e)));
        this._toDispose.add(this._editor.onMouseWheel((e)=>{
            if (this._contextMenuIsBeingShownCount > 0) {
                const view = this._contextViewService.getContextViewElement();
                const target = e.srcElement;
                // Event triggers on shadow root host first
                // Check if the context view is under this host before hiding it #103169
                if (!(target.shadowRoot && $bDzmQ.getShadowRoot(view) === target.shadowRoot)) this._contextViewService.hideContextView();
            }
        }));
        this._toDispose.add(this._editor.onKeyDown((e)=>{
            if (!this._editor.getOption(24 /* EditorOption.contextmenu */ )) return; // Context menu is turned off through configuration
            if (e.keyCode === 58 /* KeyCode.ContextMenu */ ) {
                // Chrome is funny like that
                e.preventDefault();
                e.stopPropagation();
                this.showContextMenu();
            }
        }));
    }
    _onContextMenu(e) {
        if (!this._editor.hasModel()) return;
        if (!this._editor.getOption(24 /* EditorOption.contextmenu */ )) {
            this._editor.focus();
            // Ensure the cursor is at the position of the mouse click
            if (e.target.position && !this._editor.getSelection().containsPosition(e.target.position)) this._editor.setPosition(e.target.position);
            return; // Context menu is turned off through configuration
        }
        if (e.target.type === 12 /* MouseTargetType.OVERLAY_WIDGET */ ) return; // allow native menu on widgets to support right click on input field for example in find
        if (e.target.type === 6 /* MouseTargetType.CONTENT_TEXT */  && e.target.detail.injectedText) return; // allow native menu on injected text
        e.event.preventDefault();
        e.event.stopPropagation();
        if (e.target.type === 11 /* MouseTargetType.SCROLLBAR */ ) return this._showScrollbarContextMenu(e.event);
        if (e.target.type !== 6 /* MouseTargetType.CONTENT_TEXT */  && e.target.type !== 7 /* MouseTargetType.CONTENT_EMPTY */  && e.target.type !== 1 /* MouseTargetType.TEXTAREA */ ) return; // only support mouse click into text or native context menu key for now
        // Ensure the editor gets focus if it hasn't, so the right events are being sent to other contributions
        this._editor.focus();
        // Ensure the cursor is at the position of the mouse click
        if (e.target.position) {
            let hasSelectionAtPosition = false;
            for (const selection of this._editor.getSelections())if (selection.containsPosition(e.target.position)) {
                hasSelectionAtPosition = true;
                break;
            }
            if (!hasSelectionAtPosition) this._editor.setPosition(e.target.position);
        }
        // Unless the user triggerd the context menu through Shift+F10, use the mouse position as menu position
        let anchor = null;
        if (e.target.type !== 1 /* MouseTargetType.TEXTAREA */ ) anchor = e.event;
        // Show the context menu
        this.showContextMenu(anchor);
    }
    showContextMenu(anchor) {
        if (!this._editor.getOption(24 /* EditorOption.contextmenu */ )) return; // Context menu is turned off through configuration
        if (!this._editor.hasModel()) return;
        // Find actions available for menu
        const menuActions = this._getMenuActions(this._editor.getModel(), this._editor.contextMenuId);
        // Show menu if we have actions to show
        if (menuActions.length > 0) this._doShowContextMenu(menuActions, anchor);
    }
    _getMenuActions(model, menuId) {
        const result = [];
        // get menu groups
        const groups = this._menuService.getMenuActions(menuId, this._contextKeyService, {
            arg: model.uri
        });
        // translate them into other actions
        for (const group of groups){
            const [, actions] = group;
            let addedItems = 0;
            for (const action of actions)if (action instanceof (0, $g4v7E.SubmenuItemAction)) {
                const subActions = this._getMenuActions(model, action.item.submenu);
                if (subActions.length > 0) {
                    result.push(new (0, $cVfMQ.SubmenuAction)(action.id, action.label, subActions));
                    addedItems++;
                }
            } else {
                result.push(action);
                addedItems++;
            }
            if (addedItems) result.push(new (0, $cVfMQ.Separator)());
        }
        if (result.length) result.pop(); // remove last separator
        return result;
    }
    _doShowContextMenu(actions, event = null) {
        if (!this._editor.hasModel()) return;
        // Disable hover
        const oldHoverSetting = this._editor.getOption(60 /* EditorOption.hover */ );
        this._editor.updateOptions({
            hover: {
                enabled: false
            }
        });
        let anchor = event;
        if (!anchor) {
            // Ensure selection is visible
            this._editor.revealPosition(this._editor.getPosition(), 1 /* ScrollType.Immediate */ );
            this._editor.render();
            const cursorCoords = this._editor.getScrolledVisiblePosition(this._editor.getPosition());
            // Translate to absolute editor position
            const editorCoords = $bDzmQ.getDomNodePagePosition(this._editor.getDomNode());
            const posx = editorCoords.left + cursorCoords.left;
            const posy = editorCoords.top + cursorCoords.top + cursorCoords.height;
            anchor = {
                x: posx,
                y: posy
            };
        }
        const useShadowDOM = this._editor.getOption(128 /* EditorOption.useShadowDOM */ ) && !(0, $lb0Ah.isIOS); // Do not use shadow dom on IOS #122035
        // Show menu
        this._contextMenuIsBeingShownCount++;
        this._contextMenuService.showContextMenu({
            domForShadowRoot: useShadowDOM ? this._editor.getOverflowWidgetsDomNode() ?? this._editor.getDomNode() : undefined,
            getAnchor: ()=>anchor,
            getActions: ()=>actions,
            getActionViewItem: (action)=>{
                const keybinding = this._keybindingFor(action);
                if (keybinding) return new (0, $6nSvp.ActionViewItem)(action, action, {
                    label: true,
                    keybinding: keybinding.getLabel(),
                    isMenu: true
                });
                const customActionViewItem = action;
                if (typeof customActionViewItem.getActionViewItem === 'function') return customActionViewItem.getActionViewItem();
                return new (0, $6nSvp.ActionViewItem)(action, action, {
                    icon: true,
                    label: true,
                    isMenu: true
                });
            },
            getKeyBinding: (action)=>{
                return this._keybindingFor(action);
            },
            onHide: (wasCancelled)=>{
                this._contextMenuIsBeingShownCount--;
                this._editor.updateOptions({
                    hover: oldHoverSetting
                });
            }
        });
    }
    _showScrollbarContextMenu(anchor) {
        if (!this._editor.hasModel()) return;
        if ((0, $6c7bv.isStandaloneEditorWorkspace)(this._workspaceContextService.getWorkspace())) // can't update the configuration properly in the standalone editor
        return;
        const minimapOptions = this._editor.getOption(73 /* EditorOption.minimap */ );
        let lastId = 0;
        const createAction = (opts)=>{
            return {
                id: `menu-action-${++lastId}`,
                label: opts.label,
                tooltip: '',
                class: undefined,
                enabled: typeof opts.enabled === 'undefined' ? true : opts.enabled,
                checked: opts.checked,
                run: opts.run
            };
        };
        const createSubmenuAction = (label, actions)=>{
            return new (0, $cVfMQ.SubmenuAction)(`menu-action-${++lastId}`, label, actions, undefined);
        };
        const createEnumAction = (label, enabled, configName, configuredValue, options)=>{
            if (!enabled) return createAction({
                label: label,
                enabled: enabled,
                run: ()=>{}
            });
            const createRunner = (value)=>{
                return ()=>{
                    this._configurationService.updateValue(configName, value);
                };
            };
            const actions = [];
            for (const option of options)actions.push(createAction({
                label: option.label,
                checked: configuredValue === option.value,
                run: createRunner(option.value)
            }));
            return createSubmenuAction(label, actions);
        };
        const actions = [];
        actions.push(createAction({
            label: $4dEdH.localize('context.minimap.minimap', "Minimap"),
            checked: minimapOptions.enabled,
            run: ()=>{
                this._configurationService.updateValue(`editor.minimap.enabled`, !minimapOptions.enabled);
            }
        }));
        actions.push(new (0, $cVfMQ.Separator)());
        actions.push(createAction({
            label: $4dEdH.localize('context.minimap.renderCharacters', "Render Characters"),
            enabled: minimapOptions.enabled,
            checked: minimapOptions.renderCharacters,
            run: ()=>{
                this._configurationService.updateValue(`editor.minimap.renderCharacters`, !minimapOptions.renderCharacters);
            }
        }));
        actions.push(createEnumAction($4dEdH.localize('context.minimap.size', "Vertical size"), minimapOptions.enabled, 'editor.minimap.size', minimapOptions.size, [
            {
                label: $4dEdH.localize('context.minimap.size.proportional', "Proportional"),
                value: 'proportional'
            },
            {
                label: $4dEdH.localize('context.minimap.size.fill', "Fill"),
                value: 'fill'
            },
            {
                label: $4dEdH.localize('context.minimap.size.fit', "Fit"),
                value: 'fit'
            }
        ]));
        actions.push(createEnumAction($4dEdH.localize('context.minimap.slider', "Slider"), minimapOptions.enabled, 'editor.minimap.showSlider', minimapOptions.showSlider, [
            {
                label: $4dEdH.localize('context.minimap.slider.mouseover', "Mouse Over"),
                value: 'mouseover'
            },
            {
                label: $4dEdH.localize('context.minimap.slider.always', "Always"),
                value: 'always'
            }
        ]));
        const useShadowDOM = this._editor.getOption(128 /* EditorOption.useShadowDOM */ ) && !(0, $lb0Ah.isIOS); // Do not use shadow dom on IOS #122035
        this._contextMenuIsBeingShownCount++;
        this._contextMenuService.showContextMenu({
            domForShadowRoot: useShadowDOM ? this._editor.getDomNode() : undefined,
            getAnchor: ()=>anchor,
            getActions: ()=>actions,
            onHide: (wasCancelled)=>{
                this._contextMenuIsBeingShownCount--;
                this._editor.focus();
            }
        });
    }
    _keybindingFor(action) {
        return this._keybindingService.lookupKeybinding(action.id);
    }
    dispose() {
        if (this._contextMenuIsBeingShownCount > 0) this._contextViewService.hideContextView();
        this._toDispose.dispose();
    }
};
$5545e172cd36db6d$export$4b3a61d923941f77 = $5545e172cd36db6d$var$ContextMenuController_1 = $5545e172cd36db6d$var$__decorate([
    $5545e172cd36db6d$var$__param(1, (0, $d6K7e.IContextMenuService)),
    $5545e172cd36db6d$var$__param(2, (0, $d6K7e.IContextViewService)),
    $5545e172cd36db6d$var$__param(3, (0, $cxCeF.IContextKeyService)),
    $5545e172cd36db6d$var$__param(4, (0, $7IxGd.IKeybindingService)),
    $5545e172cd36db6d$var$__param(5, (0, $g4v7E.IMenuService)),
    $5545e172cd36db6d$var$__param(6, (0, $35IZ9.IConfigurationService)),
    $5545e172cd36db6d$var$__param(7, (0, $6c7bv.IWorkspaceContextService))
], $5545e172cd36db6d$export$4b3a61d923941f77);
class $5545e172cd36db6d$var$ShowContextMenu extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.showContextMenu',
            label: $4dEdH.localize('action.showContextMenu.label', "Show Editor Context Menu"),
            alias: 'Show Editor Context Menu',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 1092 /* KeyCode.F10 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        $5545e172cd36db6d$export$4b3a61d923941f77.get(editor)?.showContextMenu();
    }
}
(0, $2iJTi.registerEditorContribution)($5545e172cd36db6d$export$4b3a61d923941f77.ID, $5545e172cd36db6d$export$4b3a61d923941f77, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorAction)($5545e172cd36db6d$var$ShowContextMenu);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $4dEdH = parcelRequire("4dEdH");
class $d83c47a8301d214b$var$CursorState {
    constructor(selections){
        this.selections = selections;
    }
    equals(other) {
        const thisLen = this.selections.length;
        const otherLen = other.selections.length;
        if (thisLen !== otherLen) return false;
        for(let i = 0; i < thisLen; i++){
            if (!this.selections[i].equalsSelection(other.selections[i])) return false;
        }
        return true;
    }
}
class $d83c47a8301d214b$var$StackElement {
    constructor(cursorState, scrollTop, scrollLeft){
        this.cursorState = cursorState;
        this.scrollTop = scrollTop;
        this.scrollLeft = scrollLeft;
    }
}
class $d83c47a8301d214b$export$74eff563205978ea extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.cursorUndoRedoController';
    }
    static get(editor) {
        return editor.getContribution($d83c47a8301d214b$export$74eff563205978ea.ID);
    }
    constructor(editor){
        super();
        this._editor = editor;
        this._isCursorUndoRedo = false;
        this._undoStack = [];
        this._redoStack = [];
        this._register(editor.onDidChangeModel((e)=>{
            this._undoStack = [];
            this._redoStack = [];
        }));
        this._register(editor.onDidChangeModelContent((e)=>{
            this._undoStack = [];
            this._redoStack = [];
        }));
        this._register(editor.onDidChangeCursorSelection((e)=>{
            if (this._isCursorUndoRedo) return;
            if (!e.oldSelections) return;
            if (e.oldModelVersionId !== e.modelVersionId) return;
            const prevState = new $d83c47a8301d214b$var$CursorState(e.oldSelections);
            const isEqualToLastUndoStack = this._undoStack.length > 0 && this._undoStack[this._undoStack.length - 1].cursorState.equals(prevState);
            if (!isEqualToLastUndoStack) {
                this._undoStack.push(new $d83c47a8301d214b$var$StackElement(prevState, editor.getScrollTop(), editor.getScrollLeft()));
                this._redoStack = [];
                if (this._undoStack.length > 50) // keep the cursor undo stack bounded
                this._undoStack.shift();
            }
        }));
    }
    cursorUndo() {
        if (!this._editor.hasModel() || this._undoStack.length === 0) return;
        this._redoStack.push(new $d83c47a8301d214b$var$StackElement(new $d83c47a8301d214b$var$CursorState(this._editor.getSelections()), this._editor.getScrollTop(), this._editor.getScrollLeft()));
        this._applyState(this._undoStack.pop());
    }
    cursorRedo() {
        if (!this._editor.hasModel() || this._redoStack.length === 0) return;
        this._undoStack.push(new $d83c47a8301d214b$var$StackElement(new $d83c47a8301d214b$var$CursorState(this._editor.getSelections()), this._editor.getScrollTop(), this._editor.getScrollLeft()));
        this._applyState(this._redoStack.pop());
    }
    _applyState(stackElement) {
        this._isCursorUndoRedo = true;
        this._editor.setSelections(stackElement.cursorState.selections);
        this._editor.setScrollPosition({
            scrollTop: stackElement.scrollTop,
            scrollLeft: stackElement.scrollLeft
        });
        this._isCursorUndoRedo = false;
    }
}
class $d83c47a8301d214b$export$3118bf0ed8b65899 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'cursorUndo',
            label: $4dEdH.localize('cursor.undo', "Cursor Undo"),
            alias: 'Cursor Undo',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 2099 /* KeyCode.KeyU */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor, args) {
        $d83c47a8301d214b$export$74eff563205978ea.get(editor)?.cursorUndo();
    }
}
class $d83c47a8301d214b$export$d501f63aca5a7669 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'cursorRedo',
            label: $4dEdH.localize('cursor.redo', "Cursor Redo"),
            alias: 'Cursor Redo',
            precondition: undefined
        });
    }
    run(accessor, editor, args) {
        $d83c47a8301d214b$export$74eff563205978ea.get(editor)?.cursorRedo();
    }
}
(0, $2iJTi.registerEditorContribution)($d83c47a8301d214b$export$74eff563205978ea.ID, $d83c47a8301d214b$export$74eff563205978ea, 0 /* EditorContributionInstantiation.Eager */ ); // eager because it needs to listen to record cursor state ASAP
(0, $2iJTi.registerEditorAction)($d83c47a8301d214b$export$3118bf0ed8b65899);
(0, $2iJTi.registerEditorAction)($d83c47a8301d214b$export$d501f63aca5a7669);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $lb0Ah = parcelRequire("lb0Ah");


var $2iJTi = parcelRequire("2iJTi");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $91ntV = parcelRequire("91ntV");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");
class $b99fbe9ae2a0658e$export$eb6766de171f86ab {
    constructor(selection, targetPosition, copy){
        this.selection = selection;
        this.targetPosition = targetPosition;
        this.copy = copy;
        this.targetSelection = null;
    }
    getEditOperations(model, builder) {
        const text = model.getValueInRange(this.selection);
        if (!this.copy) builder.addEditOperation(this.selection, null);
        builder.addEditOperation(new (0, $d00il.Range)(this.targetPosition.lineNumber, this.targetPosition.column, this.targetPosition.lineNumber, this.targetPosition.column), text);
        if (this.selection.containsPosition(this.targetPosition) && !(this.copy && (this.selection.getEndPosition().equals(this.targetPosition) || this.selection.getStartPosition().equals(this.targetPosition) // we allow users to paste content beside the selection
        ))) {
            this.targetSelection = this.selection;
            return;
        }
        if (this.copy) {
            this.targetSelection = new (0, $jzicX.Selection)(this.targetPosition.lineNumber, this.targetPosition.column, this.selection.endLineNumber - this.selection.startLineNumber + this.targetPosition.lineNumber, this.selection.startLineNumber === this.selection.endLineNumber ? this.targetPosition.column + this.selection.endColumn - this.selection.startColumn : this.selection.endColumn);
            return;
        }
        if (this.targetPosition.lineNumber > this.selection.endLineNumber) {
            // Drag the selection downwards
            this.targetSelection = new (0, $jzicX.Selection)(this.targetPosition.lineNumber - this.selection.endLineNumber + this.selection.startLineNumber, this.targetPosition.column, this.targetPosition.lineNumber, this.selection.startLineNumber === this.selection.endLineNumber ? this.targetPosition.column + this.selection.endColumn - this.selection.startColumn : this.selection.endColumn);
            return;
        }
        if (this.targetPosition.lineNumber < this.selection.endLineNumber) {
            // Drag the selection upwards
            this.targetSelection = new (0, $jzicX.Selection)(this.targetPosition.lineNumber, this.targetPosition.column, this.targetPosition.lineNumber + this.selection.endLineNumber - this.selection.startLineNumber, this.selection.startLineNumber === this.selection.endLineNumber ? this.targetPosition.column + this.selection.endColumn - this.selection.startColumn : this.selection.endColumn);
            return;
        }
        // The target position is at the same line as the selection's end position.
        if (this.selection.endColumn <= this.targetPosition.column) // The target position is after the selection's end position
        this.targetSelection = new (0, $jzicX.Selection)(this.targetPosition.lineNumber - this.selection.endLineNumber + this.selection.startLineNumber, this.selection.startLineNumber === this.selection.endLineNumber ? this.targetPosition.column - this.selection.endColumn + this.selection.startColumn : this.targetPosition.column - this.selection.endColumn + this.selection.startColumn, this.targetPosition.lineNumber, this.selection.startLineNumber === this.selection.endLineNumber ? this.targetPosition.column : this.selection.endColumn);
        else // The target position is before the selection's end position. Since the selection doesn't contain the target position, the selection is one-line and target position is before this selection.
        this.targetSelection = new (0, $jzicX.Selection)(this.targetPosition.lineNumber - this.selection.endLineNumber + this.selection.startLineNumber, this.targetPosition.column, this.targetPosition.lineNumber, this.targetPosition.column + this.selection.endColumn - this.selection.startColumn);
    }
    computeCursorState(model, helper) {
        return this.targetSelection;
    }
}


function $e55ecbc32b5ba628$var$hasTriggerModifier(e) {
    if (0, $lb0Ah.isMacintosh) return e.altKey;
    else return e.ctrlKey;
}
class $e55ecbc32b5ba628$export$809c28265265f08e extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.dragAndDrop';
    }
    static{
        this.TRIGGER_KEY_VALUE = (0, $lb0Ah.isMacintosh) ? 6 /* KeyCode.Alt */  : 5 /* KeyCode.Ctrl */ ;
    }
    constructor(editor){
        super();
        this._editor = editor;
        this._dndDecorationIds = this._editor.createDecorationsCollection();
        this._register(this._editor.onMouseDown((e)=>this._onEditorMouseDown(e)));
        this._register(this._editor.onMouseUp((e)=>this._onEditorMouseUp(e)));
        this._register(this._editor.onMouseDrag((e)=>this._onEditorMouseDrag(e)));
        this._register(this._editor.onMouseDrop((e)=>this._onEditorMouseDrop(e)));
        this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled()));
        this._register(this._editor.onKeyDown((e)=>this.onEditorKeyDown(e)));
        this._register(this._editor.onKeyUp((e)=>this.onEditorKeyUp(e)));
        this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur()));
        this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur()));
        this._mouseDown = false;
        this._modifierPressed = false;
        this._dragSelection = null;
    }
    onEditorBlur() {
        this._removeDecoration();
        this._dragSelection = null;
        this._mouseDown = false;
        this._modifierPressed = false;
    }
    onEditorKeyDown(e) {
        if (!this._editor.getOption(35 /* EditorOption.dragAndDrop */ ) || this._editor.getOption(22 /* EditorOption.columnSelection */ )) return;
        if ($e55ecbc32b5ba628$var$hasTriggerModifier(e)) this._modifierPressed = true;
        if (this._mouseDown && $e55ecbc32b5ba628$var$hasTriggerModifier(e)) this._editor.updateOptions({
            mouseStyle: 'copy'
        });
    }
    onEditorKeyUp(e) {
        if (!this._editor.getOption(35 /* EditorOption.dragAndDrop */ ) || this._editor.getOption(22 /* EditorOption.columnSelection */ )) return;
        if ($e55ecbc32b5ba628$var$hasTriggerModifier(e)) this._modifierPressed = false;
        if (this._mouseDown && e.keyCode === $e55ecbc32b5ba628$export$809c28265265f08e.TRIGGER_KEY_VALUE) this._editor.updateOptions({
            mouseStyle: 'default'
        });
    }
    _onEditorMouseDown(mouseEvent) {
        this._mouseDown = true;
    }
    _onEditorMouseUp(mouseEvent) {
        this._mouseDown = false;
        // Whenever users release the mouse, the drag and drop operation should finish and the cursor should revert to text.
        this._editor.updateOptions({
            mouseStyle: 'text'
        });
    }
    _onEditorMouseDrag(mouseEvent) {
        const target = mouseEvent.target;
        if (this._dragSelection === null) {
            const selections = this._editor.getSelections() || [];
            const possibleSelections = selections.filter((selection)=>target.position && selection.containsPosition(target.position));
            if (possibleSelections.length === 1) this._dragSelection = possibleSelections[0];
            else return;
        }
        if ($e55ecbc32b5ba628$var$hasTriggerModifier(mouseEvent.event)) this._editor.updateOptions({
            mouseStyle: 'copy'
        });
        else this._editor.updateOptions({
            mouseStyle: 'default'
        });
        if (target.position) {
            if (this._dragSelection.containsPosition(target.position)) this._removeDecoration();
            else this.showAt(target.position);
        }
    }
    _onEditorMouseDropCanceled() {
        this._editor.updateOptions({
            mouseStyle: 'text'
        });
        this._removeDecoration();
        this._dragSelection = null;
        this._mouseDown = false;
    }
    _onEditorMouseDrop(mouseEvent) {
        if (mouseEvent.target && (this._hitContent(mouseEvent.target) || this._hitMargin(mouseEvent.target)) && mouseEvent.target.position) {
            const newCursorPosition = new (0, $dcxQ7.Position)(mouseEvent.target.position.lineNumber, mouseEvent.target.position.column);
            if (this._dragSelection === null) {
                let newSelections = null;
                if (mouseEvent.event.shiftKey) {
                    const primarySelection = this._editor.getSelection();
                    if (primarySelection) {
                        const { selectionStartLineNumber: selectionStartLineNumber, selectionStartColumn: selectionStartColumn } = primarySelection;
                        newSelections = [
                            new (0, $jzicX.Selection)(selectionStartLineNumber, selectionStartColumn, newCursorPosition.lineNumber, newCursorPosition.column)
                        ];
                    }
                } else newSelections = (this._editor.getSelections() || []).map((selection)=>{
                    if (selection.containsPosition(newCursorPosition)) return new (0, $jzicX.Selection)(newCursorPosition.lineNumber, newCursorPosition.column, newCursorPosition.lineNumber, newCursorPosition.column);
                    else return selection;
                });
                // Use `mouse` as the source instead of `api` and setting the reason to explicit (to behave like any other mouse operation).
                this._editor.setSelections(newSelections || [], 'mouse', 3 /* CursorChangeReason.Explicit */ );
            } else if (!this._dragSelection.containsPosition(newCursorPosition) || ($e55ecbc32b5ba628$var$hasTriggerModifier(mouseEvent.event) || this._modifierPressed) && (this._dragSelection.getEndPosition().equals(newCursorPosition) || this._dragSelection.getStartPosition().equals(newCursorPosition) // we allow users to paste content beside the selection
            )) {
                this._editor.pushUndoStop();
                this._editor.executeCommand($e55ecbc32b5ba628$export$809c28265265f08e.ID, new (0, $b99fbe9ae2a0658e$export$eb6766de171f86ab)(this._dragSelection, newCursorPosition, $e55ecbc32b5ba628$var$hasTriggerModifier(mouseEvent.event) || this._modifierPressed));
                this._editor.pushUndoStop();
            }
        }
        this._editor.updateOptions({
            mouseStyle: 'text'
        });
        this._removeDecoration();
        this._dragSelection = null;
        this._mouseDown = false;
    }
    static{
        this._DECORATION_OPTIONS = (0, $91ntV.ModelDecorationOptions).register({
            description: 'dnd-target',
            className: 'dnd-target'
        });
    }
    showAt(position) {
        this._dndDecorationIds.set([
            {
                range: new (0, $d00il.Range)(position.lineNumber, position.column, position.lineNumber, position.column),
                options: $e55ecbc32b5ba628$export$809c28265265f08e._DECORATION_OPTIONS
            }
        ]);
        this._editor.revealPosition(position, 1 /* ScrollType.Immediate */ );
    }
    _removeDecoration() {
        this._dndDecorationIds.clear();
    }
    _hitContent(target) {
        return target.type === 6 /* MouseTargetType.CONTENT_TEXT */  || target.type === 7 /* MouseTargetType.CONTENT_EMPTY */ ;
    }
    _hitMargin(target) {
        return target.type === 2 /* MouseTargetType.GUTTER_GLYPH_MARGIN */  || target.type === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */  || target.type === 4 /* MouseTargetType.GUTTER_LINE_DECORATIONS */ ;
    }
    dispose() {
        this._removeDecoration();
        this._dragSelection = null;
        this._mouseDown = false;
        this._modifierPressed = false;
        super.dispose();
    }
}
(0, $2iJTi.registerEditorContribution)($e55ecbc32b5ba628$export$809c28265265f08e.ID, $e55ecbc32b5ba628$export$809c28265265f08e, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $54y8R = parcelRequire("54y8R");



var $4dEdH = parcelRequire("4dEdH");
(0, $2iJTi.registerEditorContribution)((0, $a6fdbc9846d042ed$export$893fe501c8c7105b).ID, (0, $a6fdbc9846d042ed$export$893fe501c8c7105b), 0 /* EditorContributionInstantiation.Eager */ ); // eager because it listens to events on the container dom node of the editor
(0, $54y8R.registerEditorFeature)((0, $e022cc124da90514$export$32088b9ed51e56d2));
(0, $2iJTi.registerEditorCommand)(new class extends (0, $2iJTi.EditorCommand) {
    constructor(){
        super({
            id: (0, $a6fdbc9846d042ed$export$909be6e4634cecc7),
            precondition: (0, $a6fdbc9846d042ed$export$b69af44cc2bc25b8),
            kbOpts: {
                weight: 100 /* KeybindingWeight.EditorContrib */ ,
                primary: 2137 /* KeyCode.Period */ 
            }
        });
    }
    runEditorCommand(_accessor, editor) {
        return (0, $a6fdbc9846d042ed$export$893fe501c8c7105b).get(editor)?.changePasteType();
    }
});
(0, $2iJTi.registerEditorCommand)(new class extends (0, $2iJTi.EditorCommand) {
    constructor(){
        super({
            id: 'editor.hidePasteWidget',
            precondition: (0, $a6fdbc9846d042ed$export$b69af44cc2bc25b8),
            kbOpts: {
                weight: 100 /* KeybindingWeight.EditorContrib */ ,
                primary: 9 /* KeyCode.Escape */ 
            }
        });
    }
    runEditorCommand(_accessor, editor) {
        (0, $a6fdbc9846d042ed$export$893fe501c8c7105b).get(editor)?.clearWidgets();
    }
});
(0, $2iJTi.registerEditorAction)(class PasteAsAction extends (0, $2iJTi.EditorAction) {
    static{
        this.argsSchema = {
            type: 'object',
            properties: {
                kind: {
                    type: 'string',
                    description: $4dEdH.localize('pasteAs.kind', "The kind of the paste edit to try applying. If not provided or there are multiple edits for this kind, the editor will show a picker.")
                }
            }
        };
    }
    constructor(){
        super({
            id: 'editor.action.pasteAs',
            label: $4dEdH.localize('pasteAs', "Paste As..."),
            alias: 'Paste As...',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            metadata: {
                description: 'Paste as',
                args: [
                    {
                        name: 'args',
                        schema: PasteAsAction.argsSchema
                    }
                ]
            }
        });
    }
    run(_accessor, editor, args) {
        let kind = typeof args?.kind === 'string' ? args.kind : undefined;
        if (!kind && args) // Support old id property
        // TODO: remove this in the future
        kind = typeof args.id === 'string' ? args.id : undefined;
        return (0, $a6fdbc9846d042ed$export$893fe501c8c7105b).get(editor)?.pasteAs(kind ? new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(kind) : undefined);
    }
});
(0, $2iJTi.registerEditorAction)(class extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.pasteAsText',
            label: $4dEdH.localize('pasteAsText', "Paste as Text"),
            alias: 'Paste as Text',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    run(_accessor, editor) {
        return (0, $a6fdbc9846d042ed$export$893fe501c8c7105b).get(editor)?.pasteAs({
            providerId: (0, $e022cc124da90514$export$6744a7017d142b99).id
        });
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $drPnH = parcelRequire("drPnH");

var $54y8R = parcelRequire("54y8R");


var $4dEdH = parcelRequire("4dEdH");

var $eWLlf = parcelRequire("eWLlf");

var $TezJS = parcelRequire("TezJS");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");



var $9cWcn = parcelRequire("9cWcn");


var $d00il = parcelRequire("d00il");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ class $ceb505b8045a2c23$export$3eef00c70c975550 {
    constructor(){
        this._dragOperations = new Map();
    }
    removeDragOperationTransfer(uuid) {
        if (uuid && this._dragOperations.has(uuid)) {
            const operation = this._dragOperations.get(uuid);
            this._dragOperations.delete(uuid);
            return operation;
        }
        return undefined;
    }
}
class $ceb505b8045a2c23$export$26c386df6281bc0 {
    constructor(identifier){
        this.identifier = identifier;
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

const $423a79f9c11400cd$export$1d68cbf9c9cf74be = (0, $fdGPu.createDecorator)('treeViewsDndService');
(0, $lf2vF.registerSingleton)($423a79f9c11400cd$export$1d68cbf9c9cf74be, (0, $ceb505b8045a2c23$export$3eef00c70c975550), 1 /* InstantiationType.Delayed */ );



var $lgoyH = parcelRequire("lgoyH");


var $4dEdH = parcelRequire("4dEdH");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");


var $fdGPu = parcelRequire("fdGPu");


var $a82dd87ed27ae1c7$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $a82dd87ed27ae1c7$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $a82dd87ed27ae1c7$var$DropIntoEditorController_1;
const $a82dd87ed27ae1c7$export$268e3fe4daa0a7f6 = 'editor.experimental.dropIntoEditor.defaultProvider';
const $a82dd87ed27ae1c7$export$79e16078de1bb1e8 = 'editor.changeDropType';
const $a82dd87ed27ae1c7$export$854117bc94b22f0d = new (0, $cxCeF.RawContextKey)('dropWidgetVisible', false, (0, $4dEdH.localize)('dropWidgetVisible', "Whether the drop widget is showing"));
let $a82dd87ed27ae1c7$export$b8963798473a2361 = class DropIntoEditorController extends (0, $9cWcn.Disposable) {
    static{
        $a82dd87ed27ae1c7$var$DropIntoEditorController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.dropIntoEditorController';
    }
    static get(editor) {
        return editor.getContribution($a82dd87ed27ae1c7$var$DropIntoEditorController_1.ID);
    }
    constructor(editor, instantiationService, _configService, _languageFeaturesService, _treeViewsDragAndDropService){
        super();
        this._configService = _configService;
        this._languageFeaturesService = _languageFeaturesService;
        this._treeViewsDragAndDropService = _treeViewsDragAndDropService;
        this.treeItemsTransfer = (0, $409d1f9a6eb890df$export$146c7b2699ebcd2).getInstance();
        this._dropProgressManager = this._register(instantiationService.createInstance((0, $a2685003e93fe7e1$export$8913023249b8bb0c), 'dropIntoEditor', editor));
        this._postDropWidgetManager = this._register(instantiationService.createInstance((0, $3e7ef88e407e6e66$export$6814fa815658cc4e), 'dropIntoEditor', editor, $a82dd87ed27ae1c7$export$854117bc94b22f0d, {
            id: $a82dd87ed27ae1c7$export$79e16078de1bb1e8,
            label: (0, $4dEdH.localize)('postDropWidgetTitle', "Show drop options...")
        }));
        this._register(editor.onDropIntoEditor((e)=>this.onDropIntoEditor(editor, e.position, e.event)));
    }
    clearWidgets() {
        this._postDropWidgetManager.clear();
    }
    changeDropType() {
        this._postDropWidgetManager.tryShowSelector();
    }
    async onDropIntoEditor(editor, position, dragEvent) {
        if (!dragEvent.dataTransfer || !editor.hasModel()) return;
        this._currentOperation?.cancel();
        editor.focus();
        editor.setPosition(position);
        const p = (0, $6bXyA.createCancelablePromise)(async (token)=>{
            const disposables = new (0, $9cWcn.DisposableStore)();
            const tokenSource = disposables.add(new (0, $lgoyH.EditorStateCancellationTokenSource)(editor, 1 /* CodeEditorStateFlag.Value */ , undefined, token));
            try {
                const ourDataTransfer = await this.extractDataTransferData(dragEvent);
                if (ourDataTransfer.size === 0 || tokenSource.token.isCancellationRequested) return;
                const model = editor.getModel();
                if (!model) return;
                const providers = this._languageFeaturesService.documentDropEditProvider.ordered(model).filter((provider)=>{
                    if (!provider.dropMimeTypes) // Keep all providers that don't specify mime types
                    return true;
                    return provider.dropMimeTypes.some((mime)=>ourDataTransfer.matches(mime));
                });
                const editSession = disposables.add(await this.getDropEdits(providers, model, position, ourDataTransfer, tokenSource));
                if (tokenSource.token.isCancellationRequested) return;
                if (editSession.edits.length) {
                    const activeEditIndex = this.getInitialActiveEditIndex(model, editSession.edits);
                    const canShowWidget = editor.getOption(36 /* EditorOption.dropIntoEditor */ ).showDropSelector === 'afterDrop';
                    // Pass in the parent token here as it tracks cancelling the entire drop operation
                    await this._postDropWidgetManager.applyEditAndShowIfNeeded([
                        (0, $d00il.Range).fromPositions(position)
                    ], {
                        activeEditIndex: activeEditIndex,
                        allEdits: editSession.edits
                    }, canShowWidget, async (edit)=>edit, token);
                }
            } finally{
                disposables.dispose();
                if (this._currentOperation === p) this._currentOperation = undefined;
            }
        });
        this._dropProgressManager.showWhile(position, (0, $4dEdH.localize)('dropIntoEditorProgress', "Running drop handlers. Click to cancel"), p, {
            cancel: ()=>p.cancel()
        });
        this._currentOperation = p;
    }
    async getDropEdits(providers, model, position, dataTransfer, tokenSource) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        const results = await (0, $6bXyA.raceCancellation)(Promise.all(providers.map(async (provider)=>{
            try {
                const edits = await provider.provideDocumentDropEdits(model, position, dataTransfer, tokenSource.token);
                if (edits) disposables.add(edits);
                return edits?.edits.map((edit)=>({
                        ...edit,
                        providerId: provider.id
                    }));
            } catch (err) {
                console.error(err);
            }
            return undefined;
        })), tokenSource.token);
        const edits = (0, $kJ8UG.coalesce)(results ?? []).flat();
        return {
            edits: (0, $d30380705d7d29a5$export$6e2fd12dccb2585)(edits),
            dispose: ()=>disposables.dispose()
        };
    }
    getInitialActiveEditIndex(model, edits) {
        const preferredProviders = this._configService.getValue($a82dd87ed27ae1c7$export$268e3fe4daa0a7f6, {
            resource: model.uri
        });
        for (const [configMime, desiredKindStr] of Object.entries(preferredProviders)){
            const desiredKind = new (0, $b9104f11117b1d0a$export$f06724c61e87d9db)(desiredKindStr);
            const editIndex = edits.findIndex((edit)=>desiredKind.value === edit.providerId && edit.handledMimeType && (0, $72c3141703bedf97$export$13f6505549b70d23)(configMime, [
                    edit.handledMimeType
                ]));
            if (editIndex >= 0) return editIndex;
        }
        return 0;
    }
    async extractDataTransferData(dragEvent) {
        if (!dragEvent.dataTransfer) return new (0, $72c3141703bedf97$export$f4115e29f15ca54f)();
        const dataTransfer = (0, $d334260af69d4b41$export$8766d539024a36bd)(dragEvent.dataTransfer);
        if (this.treeItemsTransfer.hasData((0, $ceb505b8045a2c23$export$26c386df6281bc0).prototype)) {
            const data = this.treeItemsTransfer.getData((0, $ceb505b8045a2c23$export$26c386df6281bc0).prototype);
            if (Array.isArray(data)) for (const id of data){
                const treeDataTransfer = await this._treeViewsDragAndDropService.removeDragOperationTransfer(id.identifier);
                if (treeDataTransfer) for (const [type, value] of treeDataTransfer)dataTransfer.replace(type, value);
            }
        }
        return dataTransfer;
    }
};
$a82dd87ed27ae1c7$export$b8963798473a2361 = $a82dd87ed27ae1c7$var$DropIntoEditorController_1 = $a82dd87ed27ae1c7$var$__decorate([
    $a82dd87ed27ae1c7$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $a82dd87ed27ae1c7$var$__param(2, (0, $35IZ9.IConfigurationService)),
    $a82dd87ed27ae1c7$var$__param(3, (0, $4J6fu.ILanguageFeaturesService)),
    $a82dd87ed27ae1c7$var$__param(4, (0, $423a79f9c11400cd$export$1d68cbf9c9cf74be))
], $a82dd87ed27ae1c7$export$b8963798473a2361);


(0, $2iJTi.registerEditorContribution)((0, $a82dd87ed27ae1c7$export$b8963798473a2361).ID, (0, $a82dd87ed27ae1c7$export$b8963798473a2361), 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $54y8R.registerEditorFeature)((0, $e022cc124da90514$export$e8c24bf4c5a3f458));
(0, $2iJTi.registerEditorCommand)(new class extends (0, $2iJTi.EditorCommand) {
    constructor(){
        super({
            id: (0, $a82dd87ed27ae1c7$export$79e16078de1bb1e8),
            precondition: (0, $a82dd87ed27ae1c7$export$854117bc94b22f0d),
            kbOpts: {
                weight: 100 /* KeybindingWeight.EditorContrib */ ,
                primary: 2137 /* KeyCode.Period */ 
            }
        });
    }
    runEditorCommand(_accessor, editor, _args) {
        (0, $a82dd87ed27ae1c7$export$b8963798473a2361).get(editor)?.changeDropType();
    }
});
(0, $2iJTi.registerEditorCommand)(new class extends (0, $2iJTi.EditorCommand) {
    constructor(){
        super({
            id: 'editor.hideDropWidget',
            precondition: (0, $a82dd87ed27ae1c7$export$854117bc94b22f0d),
            kbOpts: {
                weight: 100 /* KeybindingWeight.EditorContrib */ ,
                primary: 9 /* KeyCode.Escape */ 
            }
        });
    }
    runEditorCommand(_accessor, editor, _args) {
        (0, $a82dd87ed27ae1c7$export$b8963798473a2361).get(editor)?.clearWidgets();
    }
});
(0, $TezJS.Registry).as((0, $eWLlf.Extensions).Configuration).registerConfiguration({
    ...(0, $drPnH.editorConfigurationBaseNode),
    properties: {
        [(0, $a82dd87ed27ae1c7$export$268e3fe4daa0a7f6)]: {
            type: 'object',
            scope: 5 /* ConfigurationScope.LANGUAGE_OVERRIDABLE */ ,
            description: $4dEdH.localize('defaultProviderDescription', "Configures the default drop provider to use for content of a given mime type."),
            default: {},
            additionalProperties: {
                type: 'string'
            }
        }
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $2iJTi = parcelRequire("2iJTi");

var $cw0ys = parcelRequire("cw0ys");

var $ibKGQ = parcelRequire("ibKGQ");

var $1Y4vr = parcelRequire("1Y4vr");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $7ysJc = parcelRequire("7ysJc");

var $6bXyA = parcelRequire("6bXyA");

var $9cWcn = parcelRequire("9cWcn");

var $5TVJR = parcelRequire("5TVJR");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $35NkE = parcelRequire("35NkE");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $d00il = parcelRequire("d00il");

var $1Y4vr = parcelRequire("1Y4vr");

var $91ntV = parcelRequire("91ntV");

var $gaWeX = parcelRequire("gaWeX");

var $azIPz = parcelRequire("azIPz");
class $beafd4854646dbd3$export$bd754614700a28d5 {
    constructor(editor){
        this._editor = editor;
        this._decorations = [];
        this._overviewRulerApproximateDecorations = [];
        this._findScopeDecorationIds = [];
        this._rangeHighlightDecorationId = null;
        this._highlightedDecorationId = null;
        this._startPosition = this._editor.getPosition();
    }
    dispose() {
        this._editor.removeDecorations(this._allDecorations());
        this._decorations = [];
        this._overviewRulerApproximateDecorations = [];
        this._findScopeDecorationIds = [];
        this._rangeHighlightDecorationId = null;
        this._highlightedDecorationId = null;
    }
    reset() {
        this._decorations = [];
        this._overviewRulerApproximateDecorations = [];
        this._findScopeDecorationIds = [];
        this._rangeHighlightDecorationId = null;
        this._highlightedDecorationId = null;
    }
    getCount() {
        return this._decorations.length;
    }
    /** @deprecated use getFindScopes to support multiple selections */ getFindScope() {
        if (this._findScopeDecorationIds[0]) return this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]);
        return null;
    }
    getFindScopes() {
        if (this._findScopeDecorationIds.length) {
            const scopes = this._findScopeDecorationIds.map((findScopeDecorationId)=>this._editor.getModel().getDecorationRange(findScopeDecorationId)).filter((element)=>!!element);
            if (scopes.length) return scopes;
        }
        return null;
    }
    getStartPosition() {
        return this._startPosition;
    }
    setStartPosition(newStartPosition) {
        this._startPosition = newStartPosition;
        this.setCurrentFindMatch(null);
    }
    _getDecorationIndex(decorationId) {
        const index = this._decorations.indexOf(decorationId);
        if (index >= 0) return index + 1;
        return 1;
    }
    getDecorationRangeAt(index) {
        const decorationId = index < this._decorations.length ? this._decorations[index] : null;
        if (decorationId) return this._editor.getModel().getDecorationRange(decorationId);
        return null;
    }
    getCurrentMatchesPosition(desiredRange) {
        const candidates = this._editor.getModel().getDecorationsInRange(desiredRange);
        for (const candidate of candidates){
            const candidateOpts = candidate.options;
            if (candidateOpts === $beafd4854646dbd3$export$bd754614700a28d5._FIND_MATCH_DECORATION || candidateOpts === $beafd4854646dbd3$export$bd754614700a28d5._CURRENT_FIND_MATCH_DECORATION) return this._getDecorationIndex(candidate.id);
        }
        // We don't know the current match position, so returns zero to show '?' in find widget
        return 0;
    }
    setCurrentFindMatch(nextMatch) {
        let newCurrentDecorationId = null;
        let matchPosition = 0;
        if (nextMatch) for(let i = 0, len = this._decorations.length; i < len; i++){
            const range = this._editor.getModel().getDecorationRange(this._decorations[i]);
            if (nextMatch.equalsRange(range)) {
                newCurrentDecorationId = this._decorations[i];
                matchPosition = i + 1;
                break;
            }
        }
        if (this._highlightedDecorationId !== null || newCurrentDecorationId !== null) this._editor.changeDecorations((changeAccessor)=>{
            if (this._highlightedDecorationId !== null) {
                changeAccessor.changeDecorationOptions(this._highlightedDecorationId, $beafd4854646dbd3$export$bd754614700a28d5._FIND_MATCH_DECORATION);
                this._highlightedDecorationId = null;
            }
            if (newCurrentDecorationId !== null) {
                this._highlightedDecorationId = newCurrentDecorationId;
                changeAccessor.changeDecorationOptions(this._highlightedDecorationId, $beafd4854646dbd3$export$bd754614700a28d5._CURRENT_FIND_MATCH_DECORATION);
            }
            if (this._rangeHighlightDecorationId !== null) {
                changeAccessor.removeDecoration(this._rangeHighlightDecorationId);
                this._rangeHighlightDecorationId = null;
            }
            if (newCurrentDecorationId !== null) {
                let rng = this._editor.getModel().getDecorationRange(newCurrentDecorationId);
                if (rng.startLineNumber !== rng.endLineNumber && rng.endColumn === 1) {
                    const lineBeforeEnd = rng.endLineNumber - 1;
                    const lineBeforeEndMaxColumn = this._editor.getModel().getLineMaxColumn(lineBeforeEnd);
                    rng = new (0, $d00il.Range)(rng.startLineNumber, rng.startColumn, lineBeforeEnd, lineBeforeEndMaxColumn);
                }
                this._rangeHighlightDecorationId = changeAccessor.addDecoration(rng, $beafd4854646dbd3$export$bd754614700a28d5._RANGE_HIGHLIGHT_DECORATION);
            }
        });
        return matchPosition;
    }
    set(findMatches, findScopes) {
        this._editor.changeDecorations((accessor)=>{
            let findMatchesOptions = $beafd4854646dbd3$export$bd754614700a28d5._FIND_MATCH_DECORATION;
            const newOverviewRulerApproximateDecorations = [];
            if (findMatches.length > 1000) {
                // we go into a mode where the overview ruler gets "approximate" decorations
                // the reason is that the overview ruler paints all the decorations in the file and we don't want to cause freezes
                findMatchesOptions = $beafd4854646dbd3$export$bd754614700a28d5._FIND_MATCH_NO_OVERVIEW_DECORATION;
                // approximate a distance in lines where matches should be merged
                const lineCount = this._editor.getModel().getLineCount();
                const height = this._editor.getLayoutInfo().height;
                const approxPixelsPerLine = height / lineCount;
                const mergeLinesDelta = Math.max(2, Math.ceil(3 / approxPixelsPerLine));
                // merge decorations as much as possible
                let prevStartLineNumber = findMatches[0].range.startLineNumber;
                let prevEndLineNumber = findMatches[0].range.endLineNumber;
                for(let i = 1, len = findMatches.length; i < len; i++){
                    const range = findMatches[i].range;
                    if (prevEndLineNumber + mergeLinesDelta >= range.startLineNumber) {
                        if (range.endLineNumber > prevEndLineNumber) prevEndLineNumber = range.endLineNumber;
                    } else {
                        newOverviewRulerApproximateDecorations.push({
                            range: new (0, $d00il.Range)(prevStartLineNumber, 1, prevEndLineNumber, 1),
                            options: $beafd4854646dbd3$export$bd754614700a28d5._FIND_MATCH_ONLY_OVERVIEW_DECORATION
                        });
                        prevStartLineNumber = range.startLineNumber;
                        prevEndLineNumber = range.endLineNumber;
                    }
                }
                newOverviewRulerApproximateDecorations.push({
                    range: new (0, $d00il.Range)(prevStartLineNumber, 1, prevEndLineNumber, 1),
                    options: $beafd4854646dbd3$export$bd754614700a28d5._FIND_MATCH_ONLY_OVERVIEW_DECORATION
                });
            }
            // Find matches
            const newFindMatchesDecorations = new Array(findMatches.length);
            for(let i = 0, len = findMatches.length; i < len; i++)newFindMatchesDecorations[i] = {
                range: findMatches[i].range,
                options: findMatchesOptions
            };
            this._decorations = accessor.deltaDecorations(this._decorations, newFindMatchesDecorations);
            // Overview ruler approximate decorations
            this._overviewRulerApproximateDecorations = accessor.deltaDecorations(this._overviewRulerApproximateDecorations, newOverviewRulerApproximateDecorations);
            // Range highlight
            if (this._rangeHighlightDecorationId) {
                accessor.removeDecoration(this._rangeHighlightDecorationId);
                this._rangeHighlightDecorationId = null;
            }
            // Find scope
            if (this._findScopeDecorationIds.length) {
                this._findScopeDecorationIds.forEach((findScopeDecorationId)=>accessor.removeDecoration(findScopeDecorationId));
                this._findScopeDecorationIds = [];
            }
            if (findScopes?.length) this._findScopeDecorationIds = findScopes.map((findScope)=>accessor.addDecoration(findScope, $beafd4854646dbd3$export$bd754614700a28d5._FIND_SCOPE_DECORATION));
        });
    }
    matchBeforePosition(position) {
        if (this._decorations.length === 0) return null;
        for(let i = this._decorations.length - 1; i >= 0; i--){
            const decorationId = this._decorations[i];
            const r = this._editor.getModel().getDecorationRange(decorationId);
            if (!r || r.endLineNumber > position.lineNumber) continue;
            if (r.endLineNumber < position.lineNumber) return r;
            if (r.endColumn > position.column) continue;
            return r;
        }
        return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length - 1]);
    }
    matchAfterPosition(position) {
        if (this._decorations.length === 0) return null;
        for(let i = 0, len = this._decorations.length; i < len; i++){
            const decorationId = this._decorations[i];
            const r = this._editor.getModel().getDecorationRange(decorationId);
            if (!r || r.startLineNumber < position.lineNumber) continue;
            if (r.startLineNumber > position.lineNumber) return r;
            if (r.startColumn < position.column) continue;
            return r;
        }
        return this._editor.getModel().getDecorationRange(this._decorations[0]);
    }
    _allDecorations() {
        let result = [];
        result = result.concat(this._decorations);
        result = result.concat(this._overviewRulerApproximateDecorations);
        if (this._findScopeDecorationIds.length) result.push(...this._findScopeDecorationIds);
        if (this._rangeHighlightDecorationId) result.push(this._rangeHighlightDecorationId);
        return result;
    }
    static{
        this._CURRENT_FIND_MATCH_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'current-find-match',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            zIndex: 13,
            className: 'currentFindMatch',
            inlineClassName: 'currentFindMatchInline',
            showIfCollapsed: true,
            overviewRuler: {
                color: (0, $azIPz.themeColorFromId)((0, $gaWeX.overviewRulerFindMatchForeground)),
                position: (0, $1Y4vr.OverviewRulerLane).Center
            },
            minimap: {
                color: (0, $azIPz.themeColorFromId)((0, $gaWeX.minimapFindMatch)),
                position: 1 /* MinimapPosition.Inline */ 
            }
        });
    }
    static{
        this._FIND_MATCH_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'find-match',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            zIndex: 10,
            className: 'findMatch',
            inlineClassName: 'findMatchInline',
            showIfCollapsed: true,
            overviewRuler: {
                color: (0, $azIPz.themeColorFromId)((0, $gaWeX.overviewRulerFindMatchForeground)),
                position: (0, $1Y4vr.OverviewRulerLane).Center
            },
            minimap: {
                color: (0, $azIPz.themeColorFromId)((0, $gaWeX.minimapFindMatch)),
                position: 1 /* MinimapPosition.Inline */ 
            }
        });
    }
    static{
        this._FIND_MATCH_NO_OVERVIEW_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'find-match-no-overview',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            className: 'findMatch',
            showIfCollapsed: true
        });
    }
    static{
        this._FIND_MATCH_ONLY_OVERVIEW_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'find-match-only-overview',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            overviewRuler: {
                color: (0, $azIPz.themeColorFromId)((0, $gaWeX.overviewRulerFindMatchForeground)),
                position: (0, $1Y4vr.OverviewRulerLane).Center
            }
        });
    }
    static{
        this._RANGE_HIGHLIGHT_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'find-range-highlight',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            className: 'rangeHighlight',
            isWholeLine: true
        });
    }
    static{
        this._FIND_SCOPE_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'find-scope',
            className: 'findScope',
            isWholeLine: true
        });
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $d00il = parcelRequire("d00il");
class $4fb781386048aed9$export$3f7edd8e0e87094f {
    constructor(editorSelection, ranges, replaceStrings){
        this._editorSelection = editorSelection;
        this._ranges = ranges;
        this._replaceStrings = replaceStrings;
        this._trackedEditorSelectionId = null;
    }
    getEditOperations(model, builder) {
        if (this._ranges.length > 0) {
            // Collect all edit operations
            const ops = [];
            for(let i = 0; i < this._ranges.length; i++)ops.push({
                range: this._ranges[i],
                text: this._replaceStrings[i]
            });
            // Sort them in ascending order by range starts
            ops.sort((o1, o2)=>{
                return (0, $d00il.Range).compareRangesUsingStarts(o1.range, o2.range);
            });
            // Merge operations that touch each other
            const resultOps = [];
            let previousOp = ops[0];
            for(let i = 1; i < ops.length; i++)if (previousOp.range.endLineNumber === ops[i].range.startLineNumber && previousOp.range.endColumn === ops[i].range.startColumn) {
                // These operations are one after another and can be merged
                previousOp.range = previousOp.range.plusRange(ops[i].range);
                previousOp.text = previousOp.text + ops[i].text;
            } else {
                resultOps.push(previousOp);
                previousOp = ops[i];
            }
            resultOps.push(previousOp);
            for (const op of resultOps)builder.addEditOperation(op.range, op.text);
        }
        this._trackedEditorSelectionId = builder.trackSelection(this._editorSelection);
    }
    computeCursorState(model, helper) {
        return helper.getTrackedSelection(this._trackedEditorSelectionId);
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $jcr1R = parcelRequire("jcr1R");
function $151e1e15dfdcb73e$export$f007c37acc80e042(matches, pattern) {
    if (matches && matches[0] !== '') {
        const containsHyphens = $151e1e15dfdcb73e$var$validateSpecificSpecialCharacter(matches, pattern, '-');
        const containsUnderscores = $151e1e15dfdcb73e$var$validateSpecificSpecialCharacter(matches, pattern, '_');
        if (containsHyphens && !containsUnderscores) return $151e1e15dfdcb73e$var$buildReplaceStringForSpecificSpecialCharacter(matches, pattern, '-');
        else if (!containsHyphens && containsUnderscores) return $151e1e15dfdcb73e$var$buildReplaceStringForSpecificSpecialCharacter(matches, pattern, '_');
        if (matches[0].toUpperCase() === matches[0]) return pattern.toUpperCase();
        else if (matches[0].toLowerCase() === matches[0]) return pattern.toLowerCase();
        else if ($jcr1R.containsUppercaseCharacter(matches[0][0]) && pattern.length > 0) return pattern[0].toUpperCase() + pattern.substr(1);
        else if (matches[0][0].toUpperCase() !== matches[0][0] && pattern.length > 0) return pattern[0].toLowerCase() + pattern.substr(1);
        else // we don't understand its pattern yet.
        return pattern;
    } else return pattern;
}
function $151e1e15dfdcb73e$var$validateSpecificSpecialCharacter(matches, pattern, specialCharacter) {
    const doesContainSpecialCharacter = matches[0].indexOf(specialCharacter) !== -1 && pattern.indexOf(specialCharacter) !== -1;
    return doesContainSpecialCharacter && matches[0].split(specialCharacter).length === pattern.split(specialCharacter).length;
}
function $151e1e15dfdcb73e$var$buildReplaceStringForSpecificSpecialCharacter(matches, pattern, specialCharacter) {
    const splitPatternAtSpecialCharacter = pattern.split(specialCharacter);
    const splitMatchAtSpecialCharacter = matches[0].split(specialCharacter);
    let replaceString = '';
    splitPatternAtSpecialCharacter.forEach((splitValue, index)=>{
        replaceString += $151e1e15dfdcb73e$export$f007c37acc80e042([
            splitMatchAtSpecialCharacter[index]
        ], splitValue) + specialCharacter;
    });
    return replaceString.slice(0, -1);
}


/**
 * Assigned when the replace pattern is entirely static.
 */ class $75b6105e65cddbfd$var$StaticValueReplacePattern {
    constructor(staticValue){
        this.staticValue = staticValue;
        this.kind = 0 /* ReplacePatternKind.StaticValue */ ;
    }
}
/**
 * Assigned when the replace pattern has replacement patterns.
 */ class $75b6105e65cddbfd$var$DynamicPiecesReplacePattern {
    constructor(pieces){
        this.pieces = pieces;
        this.kind = 1 /* ReplacePatternKind.DynamicPieces */ ;
    }
}
class $75b6105e65cddbfd$export$512648940a758bce {
    static fromStaticValue(value) {
        return new $75b6105e65cddbfd$export$512648940a758bce([
            $75b6105e65cddbfd$export$1454288cb32b9472.staticValue(value)
        ]);
    }
    get hasReplacementPatterns() {
        return this._state.kind === 1 /* ReplacePatternKind.DynamicPieces */ ;
    }
    constructor(pieces){
        if (!pieces || pieces.length === 0) this._state = new $75b6105e65cddbfd$var$StaticValueReplacePattern('');
        else if (pieces.length === 1 && pieces[0].staticValue !== null) this._state = new $75b6105e65cddbfd$var$StaticValueReplacePattern(pieces[0].staticValue);
        else this._state = new $75b6105e65cddbfd$var$DynamicPiecesReplacePattern(pieces);
    }
    buildReplaceString(matches, preserveCase) {
        if (this._state.kind === 0 /* ReplacePatternKind.StaticValue */ ) {
            if (preserveCase) return (0, $151e1e15dfdcb73e$export$f007c37acc80e042)(matches, this._state.staticValue);
            else return this._state.staticValue;
        }
        let result = '';
        for(let i = 0, len = this._state.pieces.length; i < len; i++){
            const piece = this._state.pieces[i];
            if (piece.staticValue !== null) {
                // static value ReplacePiece
                result += piece.staticValue;
                continue;
            }
            // match index ReplacePiece
            let match = $75b6105e65cddbfd$export$512648940a758bce._substitute(piece.matchIndex, matches);
            if (piece.caseOps !== null && piece.caseOps.length > 0) {
                const repl = [];
                const lenOps = piece.caseOps.length;
                let opIdx = 0;
                for(let idx = 0, len = match.length; idx < len; idx++){
                    if (opIdx >= lenOps) {
                        repl.push(match.slice(idx));
                        break;
                    }
                    switch(piece.caseOps[opIdx]){
                        case 'U':
                            repl.push(match[idx].toUpperCase());
                            break;
                        case 'u':
                            repl.push(match[idx].toUpperCase());
                            opIdx++;
                            break;
                        case 'L':
                            repl.push(match[idx].toLowerCase());
                            break;
                        case 'l':
                            repl.push(match[idx].toLowerCase());
                            opIdx++;
                            break;
                        default:
                            repl.push(match[idx]);
                    }
                }
                match = repl.join('');
            }
            result += match;
        }
        return result;
    }
    static _substitute(matchIndex, matches) {
        if (matches === null) return '';
        if (matchIndex === 0) return matches[0];
        let remainder = '';
        while(matchIndex > 0){
            if (matchIndex < matches.length) {
                // A match can be undefined
                const match = matches[matchIndex] || '';
                return match + remainder;
            }
            remainder = String(matchIndex % 10) + remainder;
            matchIndex = Math.floor(matchIndex / 10);
        }
        return '$' + remainder;
    }
}
class $75b6105e65cddbfd$export$1454288cb32b9472 {
    static staticValue(value) {
        return new $75b6105e65cddbfd$export$1454288cb32b9472(value, -1, null);
    }
    static caseOps(index, caseOps) {
        return new $75b6105e65cddbfd$export$1454288cb32b9472(null, index, caseOps);
    }
    constructor(staticValue, matchIndex, caseOps){
        this.staticValue = staticValue;
        this.matchIndex = matchIndex;
        if (!caseOps || caseOps.length === 0) this.caseOps = null;
        else this.caseOps = caseOps.slice(0);
    }
}
class $75b6105e65cddbfd$var$ReplacePieceBuilder {
    constructor(source){
        this._source = source;
        this._lastCharIndex = 0;
        this._result = [];
        this._resultLen = 0;
        this._currentStaticPiece = '';
    }
    emitUnchanged(toCharIndex) {
        this._emitStatic(this._source.substring(this._lastCharIndex, toCharIndex));
        this._lastCharIndex = toCharIndex;
    }
    emitStatic(value, toCharIndex) {
        this._emitStatic(value);
        this._lastCharIndex = toCharIndex;
    }
    _emitStatic(value) {
        if (value.length === 0) return;
        this._currentStaticPiece += value;
    }
    emitMatchIndex(index, toCharIndex, caseOps) {
        if (this._currentStaticPiece.length !== 0) {
            this._result[this._resultLen++] = $75b6105e65cddbfd$export$1454288cb32b9472.staticValue(this._currentStaticPiece);
            this._currentStaticPiece = '';
        }
        this._result[this._resultLen++] = $75b6105e65cddbfd$export$1454288cb32b9472.caseOps(index, caseOps);
        this._lastCharIndex = toCharIndex;
    }
    finalize() {
        this.emitUnchanged(this._source.length);
        if (this._currentStaticPiece.length !== 0) {
            this._result[this._resultLen++] = $75b6105e65cddbfd$export$1454288cb32b9472.staticValue(this._currentStaticPiece);
            this._currentStaticPiece = '';
        }
        return new $75b6105e65cddbfd$export$512648940a758bce(this._result);
    }
}
function $75b6105e65cddbfd$export$ca668b7a7924cbca(replaceString) {
    if (!replaceString || replaceString.length === 0) return new $75b6105e65cddbfd$export$512648940a758bce(null);
    const caseOps = [];
    const result = new $75b6105e65cddbfd$var$ReplacePieceBuilder(replaceString);
    for(let i = 0, len = replaceString.length; i < len; i++){
        const chCode = replaceString.charCodeAt(i);
        if (chCode === 92 /* CharCode.Backslash */ ) {
            // move to next char
            i++;
            if (i >= len) break;
            const nextChCode = replaceString.charCodeAt(i);
            // let replaceWithCharacter: string | null = null;
            switch(nextChCode){
                case 92 /* CharCode.Backslash */ :
                    // \\ => inserts a "\"
                    result.emitUnchanged(i - 1);
                    result.emitStatic('\\', i + 1);
                    break;
                case 110 /* CharCode.n */ :
                    // \n => inserts a LF
                    result.emitUnchanged(i - 1);
                    result.emitStatic('\n', i + 1);
                    break;
                case 116 /* CharCode.t */ :
                    // \t => inserts a TAB
                    result.emitUnchanged(i - 1);
                    result.emitStatic('\t', i + 1);
                    break;
                // Case modification of string replacements, patterned after Boost, but only applied
                // to the replacement text, not subsequent content.
                case 117 /* CharCode.u */ :
                // \u => upper-cases one character.
                case 85 /* CharCode.U */ :
                // \U => upper-cases ALL following characters.
                case 108 /* CharCode.l */ :
                // \l => lower-cases one character.
                case 76 /* CharCode.L */ :
                    // \L => lower-cases ALL following characters.
                    result.emitUnchanged(i - 1);
                    result.emitStatic('', i + 1);
                    caseOps.push(String.fromCharCode(nextChCode));
                    break;
            }
            continue;
        }
        if (chCode === 36 /* CharCode.DollarSign */ ) {
            // move to next char
            i++;
            if (i >= len) break;
            const nextChCode = replaceString.charCodeAt(i);
            if (nextChCode === 36 /* CharCode.DollarSign */ ) {
                // $$ => inserts a "$"
                result.emitUnchanged(i - 1);
                result.emitStatic('$', i + 1);
                continue;
            }
            if (nextChCode === 48 /* CharCode.Digit0 */  || nextChCode === 38 /* CharCode.Ampersand */ ) {
                // $& and $0 => inserts the matched substring.
                result.emitUnchanged(i - 1);
                result.emitMatchIndex(0, i + 1, caseOps);
                caseOps.length = 0;
                continue;
            }
            if (49 /* CharCode.Digit1 */  <= nextChCode && nextChCode <= 57 /* CharCode.Digit9 */ ) {
                // $n
                let matchIndex = nextChCode - 48 /* CharCode.Digit0 */ ;
                // peek next char to probe for $nn
                if (i + 1 < len) {
                    const nextNextChCode = replaceString.charCodeAt(i + 1);
                    if (48 /* CharCode.Digit0 */  <= nextNextChCode && nextNextChCode <= 57 /* CharCode.Digit9 */ ) {
                        // $nn
                        // move to next char
                        i++;
                        matchIndex = matchIndex * 10 + (nextNextChCode - 48 /* CharCode.Digit0 */ );
                        result.emitUnchanged(i - 2);
                        result.emitMatchIndex(matchIndex, i + 1, caseOps);
                        caseOps.length = 0;
                        continue;
                    }
                }
                result.emitUnchanged(i - 1);
                result.emitMatchIndex(matchIndex, i + 1, caseOps);
                caseOps.length = 0;
                continue;
            }
        }
    }
    return result.finalize();
}



var $cxCeF = parcelRequire("cxCeF");
const $5f870f89a0356425$export$bc27e4192c4ca2b8 = new (0, $cxCeF.RawContextKey)('findWidgetVisible', false);
const $5f870f89a0356425$export$ee1a044baab7813d = $5f870f89a0356425$export$bc27e4192c4ca2b8.toNegated();
const $5f870f89a0356425$export$1bcc3ed82148a8b9 = new (0, $cxCeF.RawContextKey)('findInputFocussed', false);
const $5f870f89a0356425$export$1b9f123cc9b71d78 = new (0, $cxCeF.RawContextKey)('replaceInputFocussed', false);
const $5f870f89a0356425$export$2fe068521df792d6 = {
    primary: 545 /* KeyCode.KeyC */ ,
    mac: {
        primary: 2593 /* KeyCode.KeyC */ 
    }
};
const $5f870f89a0356425$export$cc2b8eb9ab15ca30 = {
    primary: 565 /* KeyCode.KeyW */ ,
    mac: {
        primary: 2613 /* KeyCode.KeyW */ 
    }
};
const $5f870f89a0356425$export$7c479f7cdbb6d55e = {
    primary: 560 /* KeyCode.KeyR */ ,
    mac: {
        primary: 2608 /* KeyCode.KeyR */ 
    }
};
const $5f870f89a0356425$export$a02b1f674b6f16d3 = {
    primary: 554 /* KeyCode.KeyL */ ,
    mac: {
        primary: 2602 /* KeyCode.KeyL */ 
    }
};
const $5f870f89a0356425$export$68ae9fdc5844d61a = {
    primary: 558 /* KeyCode.KeyP */ ,
    mac: {
        primary: 2606 /* KeyCode.KeyP */ 
    }
};
const $5f870f89a0356425$export$a4fc1be778636938 = {
    StartFindAction: 'actions.find',
    StartFindWithSelection: 'actions.findWithSelection',
    StartFindWithArgs: 'editor.actions.findWithArgs',
    NextMatchFindAction: 'editor.action.nextMatchFindAction',
    PreviousMatchFindAction: 'editor.action.previousMatchFindAction',
    GoToMatchFindAction: 'editor.action.goToMatchFindAction',
    NextSelectionMatchFindAction: 'editor.action.nextSelectionMatchFindAction',
    PreviousSelectionMatchFindAction: 'editor.action.previousSelectionMatchFindAction',
    StartFindReplaceAction: 'editor.action.startFindReplaceAction',
    CloseFindWidgetCommand: 'closeFindWidget',
    ToggleCaseSensitiveCommand: 'toggleFindCaseSensitive',
    ToggleWholeWordCommand: 'toggleFindWholeWord',
    ToggleRegexCommand: 'toggleFindRegex',
    ToggleSearchScopeCommand: 'toggleFindInSelection',
    TogglePreserveCaseCommand: 'togglePreserveCase',
    ReplaceOneAction: 'editor.action.replaceOne',
    ReplaceAllAction: 'editor.action.replaceAll',
    SelectAllMatchesAction: 'editor.action.selectAllMatches'
};
const $5f870f89a0356425$export$79640dbfb07f50a4 = 19999;
const $5f870f89a0356425$var$RESEARCH_DELAY = 240;
class $5f870f89a0356425$export$2aaa4f42000d804d {
    constructor(editor, state){
        this._toDispose = new (0, $9cWcn.DisposableStore)();
        this._editor = editor;
        this._state = state;
        this._isDisposed = false;
        this._startSearchingTimer = new (0, $6bXyA.TimeoutTimer)();
        this._decorations = new (0, $beafd4854646dbd3$export$bd754614700a28d5)(editor);
        this._toDispose.add(this._decorations);
        this._updateDecorationsScheduler = new (0, $6bXyA.RunOnceScheduler)(()=>{
            if (!this._editor.hasModel()) return;
            return this.research(false);
        }, 100);
        this._toDispose.add(this._updateDecorationsScheduler);
        this._toDispose.add(this._editor.onDidChangeCursorPosition((e)=>{
            if (e.reason === 3 /* CursorChangeReason.Explicit */  || e.reason === 5 /* CursorChangeReason.Undo */  || e.reason === 6 /* CursorChangeReason.Redo */ ) this._decorations.setStartPosition(this._editor.getPosition());
        }));
        this._ignoreModelContentChanged = false;
        this._toDispose.add(this._editor.onDidChangeModelContent((e)=>{
            if (this._ignoreModelContentChanged) return;
            if (e.isFlush) // a model.setValue() was called
            this._decorations.reset();
            this._decorations.setStartPosition(this._editor.getPosition());
            this._updateDecorationsScheduler.schedule();
        }));
        this._toDispose.add(this._state.onFindReplaceStateChange((e)=>this._onStateChanged(e)));
        this.research(false, this._state.searchScope);
    }
    dispose() {
        this._isDisposed = true;
        (0, $9cWcn.dispose)(this._startSearchingTimer);
        this._toDispose.dispose();
    }
    _onStateChanged(e) {
        if (this._isDisposed) // The find model is disposed during a find state changed event
        return;
        if (!this._editor.hasModel()) // The find model will be disposed momentarily
        return;
        if (e.searchString || e.isReplaceRevealed || e.isRegex || e.wholeWord || e.matchCase || e.searchScope) {
            const model = this._editor.getModel();
            if (model.isTooLargeForSyncing()) {
                this._startSearchingTimer.cancel();
                this._startSearchingTimer.setIfNotSet(()=>{
                    if (e.searchScope) this.research(e.moveCursor, this._state.searchScope);
                    else this.research(e.moveCursor);
                }, $5f870f89a0356425$var$RESEARCH_DELAY);
            } else if (e.searchScope) this.research(e.moveCursor, this._state.searchScope);
            else this.research(e.moveCursor);
        }
    }
    static _getSearchRange(model, findScope) {
        // If we have set now or before a find scope, use it for computing the search range
        if (findScope) return findScope;
        return model.getFullModelRange();
    }
    research(moveCursor, newFindScope) {
        let findScopes = null;
        if (typeof newFindScope !== 'undefined') {
            if (newFindScope !== null) {
                if (!Array.isArray(newFindScope)) findScopes = [
                    newFindScope
                ];
                else findScopes = newFindScope;
            }
        } else findScopes = this._decorations.getFindScopes();
        if (findScopes !== null) findScopes = findScopes.map((findScope)=>{
            if (findScope.startLineNumber !== findScope.endLineNumber) {
                let endLineNumber = findScope.endLineNumber;
                if (findScope.endColumn === 1) endLineNumber = endLineNumber - 1;
                return new (0, $d00il.Range)(findScope.startLineNumber, 1, endLineNumber, this._editor.getModel().getLineMaxColumn(endLineNumber));
            }
            return findScope;
        });
        const findMatches = this._findMatches(findScopes, false, $5f870f89a0356425$export$79640dbfb07f50a4);
        this._decorations.set(findMatches, findScopes);
        const editorSelection = this._editor.getSelection();
        let currentMatchesPosition = this._decorations.getCurrentMatchesPosition(editorSelection);
        if (currentMatchesPosition === 0 && findMatches.length > 0) {
            // current selection is not on top of a match
            // try to find its nearest result from the top of the document
            const matchAfterSelection = (0, $7ysJc.findFirstIdxMonotonousOrArrLen)(findMatches.map((match)=>match.range), (range)=>(0, $d00il.Range).compareRangesUsingStarts(range, editorSelection) >= 0);
            currentMatchesPosition = matchAfterSelection > 0 ? matchAfterSelection - 1 + 1 /** match position is one based */  : currentMatchesPosition;
        }
        this._state.changeMatchInfo(currentMatchesPosition, this._decorations.getCount(), undefined);
        if (moveCursor && this._editor.getOption(41 /* EditorOption.find */ ).cursorMoveOnType) this._moveToNextMatch(this._decorations.getStartPosition());
    }
    _hasMatches() {
        return this._state.matchesCount > 0;
    }
    _cannotFind() {
        if (!this._hasMatches()) {
            const findScope = this._decorations.getFindScope();
            if (findScope) // Reveal the selection so user is reminded that 'selection find' is on.
            this._editor.revealRangeInCenterIfOutsideViewport(findScope, 0 /* ScrollType.Smooth */ );
            return true;
        }
        return false;
    }
    _setCurrentFindMatch(match) {
        const matchesPosition = this._decorations.setCurrentFindMatch(match);
        this._state.changeMatchInfo(matchesPosition, this._decorations.getCount(), match);
        this._editor.setSelection(match);
        this._editor.revealRangeInCenterIfOutsideViewport(match, 0 /* ScrollType.Smooth */ );
    }
    _prevSearchPosition(before) {
        const isUsingLineStops = this._state.isRegex && (this._state.searchString.indexOf('^') >= 0 || this._state.searchString.indexOf('$') >= 0);
        let { lineNumber: lineNumber, column: column } = before;
        const model = this._editor.getModel();
        if (isUsingLineStops || column === 1) {
            if (lineNumber === 1) lineNumber = model.getLineCount();
            else lineNumber--;
            column = model.getLineMaxColumn(lineNumber);
        } else column--;
        return new (0, $dcxQ7.Position)(lineNumber, column);
    }
    _moveToPrevMatch(before, isRecursed = false) {
        if (!this._state.canNavigateBack()) {
            // we are beyond the first matched find result
            // instead of doing nothing, we should refocus the first item
            const nextMatchRange = this._decorations.matchAfterPosition(before);
            if (nextMatchRange) this._setCurrentFindMatch(nextMatchRange);
            return;
        }
        if (this._decorations.getCount() < $5f870f89a0356425$export$79640dbfb07f50a4) {
            let prevMatchRange = this._decorations.matchBeforePosition(before);
            if (prevMatchRange && prevMatchRange.isEmpty() && prevMatchRange.getStartPosition().equals(before)) {
                before = this._prevSearchPosition(before);
                prevMatchRange = this._decorations.matchBeforePosition(before);
            }
            if (prevMatchRange) this._setCurrentFindMatch(prevMatchRange);
            return;
        }
        if (this._cannotFind()) return;
        const findScope = this._decorations.getFindScope();
        const searchRange = $5f870f89a0356425$export$2aaa4f42000d804d._getSearchRange(this._editor.getModel(), findScope);
        // ...(----)...|...
        if (searchRange.getEndPosition().isBefore(before)) before = searchRange.getEndPosition();
        // ...|...(----)...
        if (before.isBefore(searchRange.getStartPosition())) before = searchRange.getEndPosition();
        const { lineNumber: lineNumber, column: column } = before;
        const model = this._editor.getModel();
        let position = new (0, $dcxQ7.Position)(lineNumber, column);
        let prevMatch = model.findPreviousMatch(this._state.searchString, position, this._state.isRegex, this._state.matchCase, this._state.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false);
        if (prevMatch && prevMatch.range.isEmpty() && prevMatch.range.getStartPosition().equals(position)) {
            // Looks like we're stuck at this position, unacceptable!
            position = this._prevSearchPosition(position);
            prevMatch = model.findPreviousMatch(this._state.searchString, position, this._state.isRegex, this._state.matchCase, this._state.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false);
        }
        if (!prevMatch) // there is precisely one match and selection is on top of it
        return;
        if (!isRecursed && !searchRange.containsRange(prevMatch.range)) return this._moveToPrevMatch(prevMatch.range.getStartPosition(), true);
        this._setCurrentFindMatch(prevMatch.range);
    }
    moveToPrevMatch() {
        this._moveToPrevMatch(this._editor.getSelection().getStartPosition());
    }
    _nextSearchPosition(after) {
        const isUsingLineStops = this._state.isRegex && (this._state.searchString.indexOf('^') >= 0 || this._state.searchString.indexOf('$') >= 0);
        let { lineNumber: lineNumber, column: column } = after;
        const model = this._editor.getModel();
        if (isUsingLineStops || column === model.getLineMaxColumn(lineNumber)) {
            if (lineNumber === model.getLineCount()) lineNumber = 1;
            else lineNumber++;
            column = 1;
        } else column++;
        return new (0, $dcxQ7.Position)(lineNumber, column);
    }
    _moveToNextMatch(after) {
        if (!this._state.canNavigateForward()) {
            // we are beyond the last matched find result
            // instead of doing nothing, we should refocus the last item
            const prevMatchRange = this._decorations.matchBeforePosition(after);
            if (prevMatchRange) this._setCurrentFindMatch(prevMatchRange);
            return;
        }
        if (this._decorations.getCount() < $5f870f89a0356425$export$79640dbfb07f50a4) {
            let nextMatchRange = this._decorations.matchAfterPosition(after);
            if (nextMatchRange && nextMatchRange.isEmpty() && nextMatchRange.getStartPosition().equals(after)) {
                // Looks like we're stuck at this position, unacceptable!
                after = this._nextSearchPosition(after);
                nextMatchRange = this._decorations.matchAfterPosition(after);
            }
            if (nextMatchRange) this._setCurrentFindMatch(nextMatchRange);
            return;
        }
        const nextMatch = this._getNextMatch(after, false, true);
        if (nextMatch) this._setCurrentFindMatch(nextMatch.range);
    }
    _getNextMatch(after, captureMatches, forceMove, isRecursed = false) {
        if (this._cannotFind()) return null;
        const findScope = this._decorations.getFindScope();
        const searchRange = $5f870f89a0356425$export$2aaa4f42000d804d._getSearchRange(this._editor.getModel(), findScope);
        // ...(----)...|...
        if (searchRange.getEndPosition().isBefore(after)) after = searchRange.getStartPosition();
        // ...|...(----)...
        if (after.isBefore(searchRange.getStartPosition())) after = searchRange.getStartPosition();
        const { lineNumber: lineNumber, column: column } = after;
        const model = this._editor.getModel();
        let position = new (0, $dcxQ7.Position)(lineNumber, column);
        let nextMatch = model.findNextMatch(this._state.searchString, position, this._state.isRegex, this._state.matchCase, this._state.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, captureMatches);
        if (forceMove && nextMatch && nextMatch.range.isEmpty() && nextMatch.range.getStartPosition().equals(position)) {
            // Looks like we're stuck at this position, unacceptable!
            position = this._nextSearchPosition(position);
            nextMatch = model.findNextMatch(this._state.searchString, position, this._state.isRegex, this._state.matchCase, this._state.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, captureMatches);
        }
        if (!nextMatch) // there is precisely one match and selection is on top of it
        return null;
        if (!isRecursed && !searchRange.containsRange(nextMatch.range)) return this._getNextMatch(nextMatch.range.getEndPosition(), captureMatches, forceMove, true);
        return nextMatch;
    }
    moveToNextMatch() {
        this._moveToNextMatch(this._editor.getSelection().getEndPosition());
    }
    _moveToMatch(index) {
        const decorationRange = this._decorations.getDecorationRangeAt(index);
        if (decorationRange) this._setCurrentFindMatch(decorationRange);
    }
    moveToMatch(index) {
        this._moveToMatch(index);
    }
    _getReplacePattern() {
        if (this._state.isRegex) return (0, $75b6105e65cddbfd$export$ca668b7a7924cbca)(this._state.replaceString);
        return (0, $75b6105e65cddbfd$export$512648940a758bce).fromStaticValue(this._state.replaceString);
    }
    replace() {
        if (!this._hasMatches()) return;
        const replacePattern = this._getReplacePattern();
        const selection = this._editor.getSelection();
        const nextMatch = this._getNextMatch(selection.getStartPosition(), true, false);
        if (nextMatch) {
            if (selection.equalsRange(nextMatch.range)) {
                // selection sits on a find match => replace it!
                const replaceString = replacePattern.buildReplaceString(nextMatch.matches, this._state.preserveCase);
                const command = new (0, $5TVJR.ReplaceCommand)(selection, replaceString);
                this._executeEditorCommand('replace', command);
                this._decorations.setStartPosition(new (0, $dcxQ7.Position)(selection.startLineNumber, selection.startColumn + replaceString.length));
                this.research(true);
            } else {
                this._decorations.setStartPosition(this._editor.getPosition());
                this._setCurrentFindMatch(nextMatch.range);
            }
        }
    }
    _findMatches(findScopes, captureMatches, limitResultCount) {
        const searchRanges = (findScopes || [
            null
        ]).map((scope)=>$5f870f89a0356425$export$2aaa4f42000d804d._getSearchRange(this._editor.getModel(), scope));
        return this._editor.getModel().findMatches(this._state.searchString, searchRanges, this._state.isRegex, this._state.matchCase, this._state.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, captureMatches, limitResultCount);
    }
    replaceAll() {
        if (!this._hasMatches()) return;
        const findScopes = this._decorations.getFindScopes();
        if (findScopes === null && this._state.matchesCount >= $5f870f89a0356425$export$79640dbfb07f50a4) // Doing a replace on the entire file that is over ${MATCHES_LIMIT} matches
        this._largeReplaceAll();
        else this._regularReplaceAll(findScopes);
        this.research(false);
    }
    _largeReplaceAll() {
        const searchParams = new (0, $35NkE.SearchParams)(this._state.searchString, this._state.isRegex, this._state.matchCase, this._state.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null);
        const searchData = searchParams.parseSearchRequest();
        if (!searchData) return;
        let searchRegex = searchData.regex;
        if (!searchRegex.multiline) {
            let mod = 'mu';
            if (searchRegex.ignoreCase) mod += 'i';
            if (searchRegex.global) mod += 'g';
            searchRegex = new RegExp(searchRegex.source, mod);
        }
        const model = this._editor.getModel();
        const modelText = model.getValue(1 /* EndOfLinePreference.LF */ );
        const fullModelRange = model.getFullModelRange();
        const replacePattern = this._getReplacePattern();
        let resultText;
        const preserveCase = this._state.preserveCase;
        if (replacePattern.hasReplacementPatterns || preserveCase) resultText = modelText.replace(searchRegex, function() {
            return replacePattern.buildReplaceString(arguments, preserveCase);
        });
        else resultText = modelText.replace(searchRegex, replacePattern.buildReplaceString(null, preserveCase));
        const command = new (0, $5TVJR.ReplaceCommandThatPreservesSelection)(fullModelRange, resultText, this._editor.getSelection());
        this._executeEditorCommand('replaceAll', command);
    }
    _regularReplaceAll(findScopes) {
        const replacePattern = this._getReplacePattern();
        // Get all the ranges (even more than the highlighted ones)
        const matches = this._findMatches(findScopes, replacePattern.hasReplacementPatterns || this._state.preserveCase, 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ );
        const replaceStrings = [];
        for(let i = 0, len = matches.length; i < len; i++)replaceStrings[i] = replacePattern.buildReplaceString(matches[i].matches, this._state.preserveCase);
        const command = new (0, $4fb781386048aed9$export$3f7edd8e0e87094f)(this._editor.getSelection(), matches.map((m)=>m.range), replaceStrings);
        this._executeEditorCommand('replaceAll', command);
    }
    selectAllMatches() {
        if (!this._hasMatches()) return;
        const findScopes = this._decorations.getFindScopes();
        // Get all the ranges (even more than the highlighted ones)
        const matches = this._findMatches(findScopes, false, 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ );
        let selections = matches.map((m)=>new (0, $jzicX.Selection)(m.range.startLineNumber, m.range.startColumn, m.range.endLineNumber, m.range.endColumn));
        // If one of the ranges is the editor selection, then maintain it as primary
        const editorSelection = this._editor.getSelection();
        for(let i = 0, len = selections.length; i < len; i++){
            const sel = selections[i];
            if (sel.equalsRange(editorSelection)) {
                selections = [
                    editorSelection
                ].concat(selections.slice(0, i)).concat(selections.slice(i + 1));
                break;
            }
        }
        this._editor.setSelections(selections);
    }
    _executeEditorCommand(source, command) {
        try {
            this._ignoreModelContentChanged = true;
            this._editor.pushUndoStop();
            this._editor.executeCommand(source, command);
            this._editor.pushUndoStop();
        } finally{
            this._ignoreModelContentChanged = false;
        }
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");


var $3vvpi = parcelRequire("3vvpi");

var $fxJYg = parcelRequire("fxJYg");

var $6bXyA = parcelRequire("6bXyA");


var $gaWeX = parcelRequire("gaWeX");

var $b97Zr = parcelRequire("b97Zr");
class $ec60578d0867c64a$export$2ff720b27319038e extends (0, $fxJYg.Widget) {
    static{
        this.ID = 'editor.contrib.findOptionsWidget';
    }
    constructor(editor, state, keybindingService){
        super();
        this._hideSoon = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._hide(), 2000));
        this._isVisible = false;
        this._editor = editor;
        this._state = state;
        this._keybindingService = keybindingService;
        this._domNode = document.createElement('div');
        this._domNode.className = 'findOptionsWidget';
        this._domNode.style.display = 'none';
        this._domNode.style.top = '10px';
        this._domNode.style.zIndex = '12';
        this._domNode.setAttribute('role', 'presentation');
        this._domNode.setAttribute('aria-hidden', 'true');
        const toggleStyles = {
            inputActiveOptionBorder: (0, $gaWeX.asCssVariable)((0, $gaWeX.inputActiveOptionBorder)),
            inputActiveOptionForeground: (0, $gaWeX.asCssVariable)((0, $gaWeX.inputActiveOptionForeground)),
            inputActiveOptionBackground: (0, $gaWeX.asCssVariable)((0, $gaWeX.inputActiveOptionBackground))
        };
        const hoverDelegate = this._register((0, $b97Zr.createInstantHoverDelegate)());
        this.caseSensitive = this._register(new (0, $3vvpi.CaseSensitiveToggle)({
            appendTitle: this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ToggleCaseSensitiveCommand),
            isChecked: this._state.matchCase,
            hoverDelegate: hoverDelegate,
            ...toggleStyles
        }));
        this._domNode.appendChild(this.caseSensitive.domNode);
        this._register(this.caseSensitive.onChange(()=>{
            this._state.change({
                matchCase: this.caseSensitive.checked
            }, false);
        }));
        this.wholeWords = this._register(new (0, $3vvpi.WholeWordsToggle)({
            appendTitle: this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ToggleWholeWordCommand),
            isChecked: this._state.wholeWord,
            hoverDelegate: hoverDelegate,
            ...toggleStyles
        }));
        this._domNode.appendChild(this.wholeWords.domNode);
        this._register(this.wholeWords.onChange(()=>{
            this._state.change({
                wholeWord: this.wholeWords.checked
            }, false);
        }));
        this.regex = this._register(new (0, $3vvpi.RegexToggle)({
            appendTitle: this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ToggleRegexCommand),
            isChecked: this._state.isRegex,
            hoverDelegate: hoverDelegate,
            ...toggleStyles
        }));
        this._domNode.appendChild(this.regex.domNode);
        this._register(this.regex.onChange(()=>{
            this._state.change({
                isRegex: this.regex.checked
            }, false);
        }));
        this._editor.addOverlayWidget(this);
        this._register(this._state.onFindReplaceStateChange((e)=>{
            let somethingChanged = false;
            if (e.isRegex) {
                this.regex.checked = this._state.isRegex;
                somethingChanged = true;
            }
            if (e.wholeWord) {
                this.wholeWords.checked = this._state.wholeWord;
                somethingChanged = true;
            }
            if (e.matchCase) {
                this.caseSensitive.checked = this._state.matchCase;
                somethingChanged = true;
            }
            if (!this._state.isRevealed && somethingChanged) this._revealTemporarily();
        }));
        this._register($bDzmQ.addDisposableListener(this._domNode, $bDzmQ.EventType.MOUSE_LEAVE, (e)=>this._onMouseLeave()));
        this._register($bDzmQ.addDisposableListener(this._domNode, 'mouseover', (e)=>this._onMouseOver()));
    }
    _keybindingLabelFor(actionId) {
        const kb = this._keybindingService.lookupKeybinding(actionId);
        if (!kb) return '';
        return ` (${kb.getLabel()})`;
    }
    dispose() {
        this._editor.removeOverlayWidget(this);
        super.dispose();
    }
    // ----- IOverlayWidget API
    getId() {
        return $ec60578d0867c64a$export$2ff720b27319038e.ID;
    }
    getDomNode() {
        return this._domNode;
    }
    getPosition() {
        return {
            preference: 0 /* OverlayWidgetPositionPreference.TOP_RIGHT_CORNER */ 
        };
    }
    highlightFindOptions() {
        this._revealTemporarily();
    }
    _revealTemporarily() {
        this._show();
        this._hideSoon.schedule();
    }
    _onMouseLeave() {
        this._hideSoon.schedule();
    }
    _onMouseOver() {
        this._hideSoon.cancel();
    }
    _show() {
        if (this._isVisible) return;
        this._isVisible = true;
        this._domNode.style.display = 'block';
    }
    _hide() {
        if (!this._isVisible) return;
        this._isVisible = false;
        this._domNode.style.display = 'none';
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $d00il = parcelRequire("d00il");

function $18fac37ef2468281$var$effectiveOptionValue(override, value) {
    if (override === 1 /* FindOptionOverride.True */ ) return true;
    if (override === 2 /* FindOptionOverride.False */ ) return false;
    return value;
}
class $18fac37ef2468281$export$134b1d8b9bc10076 extends (0, $9cWcn.Disposable) {
    get searchString() {
        return this._searchString;
    }
    get replaceString() {
        return this._replaceString;
    }
    get isRevealed() {
        return this._isRevealed;
    }
    get isReplaceRevealed() {
        return this._isReplaceRevealed;
    }
    get isRegex() {
        return $18fac37ef2468281$var$effectiveOptionValue(this._isRegexOverride, this._isRegex);
    }
    get wholeWord() {
        return $18fac37ef2468281$var$effectiveOptionValue(this._wholeWordOverride, this._wholeWord);
    }
    get matchCase() {
        return $18fac37ef2468281$var$effectiveOptionValue(this._matchCaseOverride, this._matchCase);
    }
    get preserveCase() {
        return $18fac37ef2468281$var$effectiveOptionValue(this._preserveCaseOverride, this._preserveCase);
    }
    get actualIsRegex() {
        return this._isRegex;
    }
    get actualWholeWord() {
        return this._wholeWord;
    }
    get actualMatchCase() {
        return this._matchCase;
    }
    get actualPreserveCase() {
        return this._preserveCase;
    }
    get searchScope() {
        return this._searchScope;
    }
    get matchesPosition() {
        return this._matchesPosition;
    }
    get matchesCount() {
        return this._matchesCount;
    }
    get currentMatch() {
        return this._currentMatch;
    }
    constructor(){
        super();
        this._onFindReplaceStateChange = this._register(new (0, $5YaSO.Emitter)());
        this.onFindReplaceStateChange = this._onFindReplaceStateChange.event;
        this._searchString = '';
        this._replaceString = '';
        this._isRevealed = false;
        this._isReplaceRevealed = false;
        this._isRegex = false;
        this._isRegexOverride = 0 /* FindOptionOverride.NotSet */ ;
        this._wholeWord = false;
        this._wholeWordOverride = 0 /* FindOptionOverride.NotSet */ ;
        this._matchCase = false;
        this._matchCaseOverride = 0 /* FindOptionOverride.NotSet */ ;
        this._preserveCase = false;
        this._preserveCaseOverride = 0 /* FindOptionOverride.NotSet */ ;
        this._searchScope = null;
        this._matchesPosition = 0;
        this._matchesCount = 0;
        this._currentMatch = null;
        this._loop = true;
        this._isSearching = false;
        this._filters = null;
    }
    changeMatchInfo(matchesPosition, matchesCount, currentMatch) {
        const changeEvent = {
            moveCursor: false,
            updateHistory: false,
            searchString: false,
            replaceString: false,
            isRevealed: false,
            isReplaceRevealed: false,
            isRegex: false,
            wholeWord: false,
            matchCase: false,
            preserveCase: false,
            searchScope: false,
            matchesPosition: false,
            matchesCount: false,
            currentMatch: false,
            loop: false,
            isSearching: false,
            filters: false
        };
        let somethingChanged = false;
        if (matchesCount === 0) matchesPosition = 0;
        if (matchesPosition > matchesCount) matchesPosition = matchesCount;
        if (this._matchesPosition !== matchesPosition) {
            this._matchesPosition = matchesPosition;
            changeEvent.matchesPosition = true;
            somethingChanged = true;
        }
        if (this._matchesCount !== matchesCount) {
            this._matchesCount = matchesCount;
            changeEvent.matchesCount = true;
            somethingChanged = true;
        }
        if (typeof currentMatch !== 'undefined') {
            if (!(0, $d00il.Range).equalsRange(this._currentMatch, currentMatch)) {
                this._currentMatch = currentMatch;
                changeEvent.currentMatch = true;
                somethingChanged = true;
            }
        }
        if (somethingChanged) this._onFindReplaceStateChange.fire(changeEvent);
    }
    change(newState, moveCursor, updateHistory = true) {
        const changeEvent = {
            moveCursor: moveCursor,
            updateHistory: updateHistory,
            searchString: false,
            replaceString: false,
            isRevealed: false,
            isReplaceRevealed: false,
            isRegex: false,
            wholeWord: false,
            matchCase: false,
            preserveCase: false,
            searchScope: false,
            matchesPosition: false,
            matchesCount: false,
            currentMatch: false,
            loop: false,
            isSearching: false,
            filters: false
        };
        let somethingChanged = false;
        const oldEffectiveIsRegex = this.isRegex;
        const oldEffectiveWholeWords = this.wholeWord;
        const oldEffectiveMatchCase = this.matchCase;
        const oldEffectivePreserveCase = this.preserveCase;
        if (typeof newState.searchString !== 'undefined') {
            if (this._searchString !== newState.searchString) {
                this._searchString = newState.searchString;
                changeEvent.searchString = true;
                somethingChanged = true;
            }
        }
        if (typeof newState.replaceString !== 'undefined') {
            if (this._replaceString !== newState.replaceString) {
                this._replaceString = newState.replaceString;
                changeEvent.replaceString = true;
                somethingChanged = true;
            }
        }
        if (typeof newState.isRevealed !== 'undefined') {
            if (this._isRevealed !== newState.isRevealed) {
                this._isRevealed = newState.isRevealed;
                changeEvent.isRevealed = true;
                somethingChanged = true;
            }
        }
        if (typeof newState.isReplaceRevealed !== 'undefined') {
            if (this._isReplaceRevealed !== newState.isReplaceRevealed) {
                this._isReplaceRevealed = newState.isReplaceRevealed;
                changeEvent.isReplaceRevealed = true;
                somethingChanged = true;
            }
        }
        if (typeof newState.isRegex !== 'undefined') this._isRegex = newState.isRegex;
        if (typeof newState.wholeWord !== 'undefined') this._wholeWord = newState.wholeWord;
        if (typeof newState.matchCase !== 'undefined') this._matchCase = newState.matchCase;
        if (typeof newState.preserveCase !== 'undefined') this._preserveCase = newState.preserveCase;
        if (typeof newState.searchScope !== 'undefined') {
            if (!newState.searchScope?.every((newSearchScope)=>{
                return this._searchScope?.some((existingSearchScope)=>{
                    return !(0, $d00il.Range).equalsRange(existingSearchScope, newSearchScope);
                });
            })) {
                this._searchScope = newState.searchScope;
                changeEvent.searchScope = true;
                somethingChanged = true;
            }
        }
        if (typeof newState.loop !== 'undefined') {
            if (this._loop !== newState.loop) {
                this._loop = newState.loop;
                changeEvent.loop = true;
                somethingChanged = true;
            }
        }
        if (typeof newState.isSearching !== 'undefined') {
            if (this._isSearching !== newState.isSearching) {
                this._isSearching = newState.isSearching;
                changeEvent.isSearching = true;
                somethingChanged = true;
            }
        }
        if (typeof newState.filters !== 'undefined') {
            if (this._filters) this._filters.update(newState.filters);
            else this._filters = newState.filters;
            changeEvent.filters = true;
            somethingChanged = true;
        }
        // Overrides get set when they explicitly come in and get reset anytime something else changes
        this._isRegexOverride = typeof newState.isRegexOverride !== 'undefined' ? newState.isRegexOverride : 0 /* FindOptionOverride.NotSet */ ;
        this._wholeWordOverride = typeof newState.wholeWordOverride !== 'undefined' ? newState.wholeWordOverride : 0 /* FindOptionOverride.NotSet */ ;
        this._matchCaseOverride = typeof newState.matchCaseOverride !== 'undefined' ? newState.matchCaseOverride : 0 /* FindOptionOverride.NotSet */ ;
        this._preserveCaseOverride = typeof newState.preserveCaseOverride !== 'undefined' ? newState.preserveCaseOverride : 0 /* FindOptionOverride.NotSet */ ;
        if (oldEffectiveIsRegex !== this.isRegex) {
            somethingChanged = true;
            changeEvent.isRegex = true;
        }
        if (oldEffectiveWholeWords !== this.wholeWord) {
            somethingChanged = true;
            changeEvent.wholeWord = true;
        }
        if (oldEffectiveMatchCase !== this.matchCase) {
            somethingChanged = true;
            changeEvent.matchCase = true;
        }
        if (oldEffectivePreserveCase !== this.preserveCase) {
            somethingChanged = true;
            changeEvent.preserveCase = true;
        }
        if (somethingChanged) this._onFindReplaceStateChange.fire(changeEvent);
    }
    canNavigateBack() {
        return this.canNavigateInLoop() || this.matchesPosition !== 1;
    }
    canNavigateForward() {
        return this.canNavigateInLoop() || this.matchesPosition < this.matchesCount;
    }
    canNavigateInLoop() {
        return this._loop || this.matchesCount >= (0, $5f870f89a0356425$export$79640dbfb07f50a4);
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $aIbUW = parcelRequire("aIbUW");

var $jyuUf = parcelRequire("jyuUf");

var $9lxpu = parcelRequire("9lxpu");

var $fxJYg = parcelRequire("fxJYg");

var $6bXyA = parcelRequire("6bXyA");

var $awgRE = parcelRequire("awgRE");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $lb0Ah = parcelRequire("lb0Ah");

var $jcr1R = parcelRequire("jcr1R");


var $d00il = parcelRequire("d00il");


var $4dEdH = parcelRequire("4dEdH");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5AbY3 = parcelRequire("5AbY3");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $jyuUf = parcelRequire("jyuUf");

var $3AI9u = parcelRequire("3AI9u");

var $fxJYg = parcelRequire("fxJYg");

var $awgRE = parcelRequire("awgRE");

var $5YaSO = parcelRequire("5YaSO");


var $4dEdH = parcelRequire("4dEdH");

var $b97Zr = parcelRequire("b97Zr");
const $364838f2693d9d76$var$NLS_DEFAULT_LABEL = $4dEdH.localize('defaultLabel', "input");
const $364838f2693d9d76$var$NLS_PRESERVE_CASE_LABEL = $4dEdH.localize('label.preserveCaseToggle', "Preserve Case");
class $364838f2693d9d76$var$PreserveCaseToggle extends (0, $jyuUf.Toggle) {
    constructor(opts){
        super({
            // TODO: does this need its own icon?
            icon: (0, $awgRE.Codicon).preserveCase,
            title: $364838f2693d9d76$var$NLS_PRESERVE_CASE_LABEL + opts.appendTitle,
            isChecked: opts.isChecked,
            hoverDelegate: opts.hoverDelegate ?? (0, $b97Zr.getDefaultHoverDelegate)('element'),
            inputActiveOptionBorder: opts.inputActiveOptionBorder,
            inputActiveOptionForeground: opts.inputActiveOptionForeground,
            inputActiveOptionBackground: opts.inputActiveOptionBackground
        });
    }
}
class $364838f2693d9d76$export$3bdc90548a25210c extends (0, $fxJYg.Widget) {
    constructor(parent, contextViewProvider, _showOptionButtons, options){
        super();
        this._showOptionButtons = _showOptionButtons;
        this.fixFocusOnOptionClickEnabled = true;
        this.cachedOptionsWidth = 0;
        this._onDidOptionChange = this._register(new (0, $5YaSO.Emitter)());
        this.onDidOptionChange = this._onDidOptionChange.event;
        this._onKeyDown = this._register(new (0, $5YaSO.Emitter)());
        this.onKeyDown = this._onKeyDown.event;
        this._onMouseDown = this._register(new (0, $5YaSO.Emitter)());
        this._onInput = this._register(new (0, $5YaSO.Emitter)());
        this._onKeyUp = this._register(new (0, $5YaSO.Emitter)());
        this._onPreserveCaseKeyDown = this._register(new (0, $5YaSO.Emitter)());
        this.onPreserveCaseKeyDown = this._onPreserveCaseKeyDown.event;
        this.contextViewProvider = contextViewProvider;
        this.placeholder = options.placeholder || '';
        this.validation = options.validation;
        this.label = options.label || $364838f2693d9d76$var$NLS_DEFAULT_LABEL;
        const appendPreserveCaseLabel = options.appendPreserveCaseLabel || '';
        const history = options.history || [];
        const flexibleHeight = !!options.flexibleHeight;
        const flexibleWidth = !!options.flexibleWidth;
        const flexibleMaxHeight = options.flexibleMaxHeight;
        this.domNode = document.createElement('div');
        this.domNode.classList.add('monaco-findInput');
        this.inputBox = this._register(new (0, $3AI9u.HistoryInputBox)(this.domNode, this.contextViewProvider, {
            ariaLabel: this.label || '',
            placeholder: this.placeholder || '',
            validationOptions: {
                validation: this.validation
            },
            history: history,
            showHistoryHint: options.showHistoryHint,
            flexibleHeight: flexibleHeight,
            flexibleWidth: flexibleWidth,
            flexibleMaxHeight: flexibleMaxHeight,
            inputBoxStyles: options.inputBoxStyles
        }));
        this.preserveCase = this._register(new $364838f2693d9d76$var$PreserveCaseToggle({
            appendTitle: appendPreserveCaseLabel,
            isChecked: false,
            ...options.toggleStyles
        }));
        this._register(this.preserveCase.onChange((viaKeyboard)=>{
            this._onDidOptionChange.fire(viaKeyboard);
            if (!viaKeyboard && this.fixFocusOnOptionClickEnabled) this.inputBox.focus();
            this.validate();
        }));
        this._register(this.preserveCase.onKeyDown((e)=>{
            this._onPreserveCaseKeyDown.fire(e);
        }));
        if (this._showOptionButtons) this.cachedOptionsWidth = this.preserveCase.width();
        else this.cachedOptionsWidth = 0;
        // Arrow-Key support to navigate between options
        const indexes = [
            this.preserveCase.domNode
        ];
        this.onkeydown(this.domNode, (event)=>{
            if (event.equals(15 /* KeyCode.LeftArrow */ ) || event.equals(17 /* KeyCode.RightArrow */ ) || event.equals(9 /* KeyCode.Escape */ )) {
                const index = indexes.indexOf(this.domNode.ownerDocument.activeElement);
                if (index >= 0) {
                    let newIndex = -1;
                    if (event.equals(17 /* KeyCode.RightArrow */ )) newIndex = (index + 1) % indexes.length;
                    else if (event.equals(15 /* KeyCode.LeftArrow */ )) {
                        if (index === 0) newIndex = indexes.length - 1;
                        else newIndex = index - 1;
                    }
                    if (event.equals(9 /* KeyCode.Escape */ )) {
                        indexes[index].blur();
                        this.inputBox.focus();
                    } else if (newIndex >= 0) indexes[newIndex].focus();
                    $bDzmQ.EventHelper.stop(event, true);
                }
            }
        });
        const controls = document.createElement('div');
        controls.className = 'controls';
        controls.style.display = this._showOptionButtons ? 'block' : 'none';
        controls.appendChild(this.preserveCase.domNode);
        this.domNode.appendChild(controls);
        parent?.appendChild(this.domNode);
        this.onkeydown(this.inputBox.inputElement, (e)=>this._onKeyDown.fire(e));
        this.onkeyup(this.inputBox.inputElement, (e)=>this._onKeyUp.fire(e));
        this.oninput(this.inputBox.inputElement, (e)=>this._onInput.fire());
        this.onmousedown(this.inputBox.inputElement, (e)=>this._onMouseDown.fire(e));
    }
    enable() {
        this.domNode.classList.remove('disabled');
        this.inputBox.enable();
        this.preserveCase.enable();
    }
    disable() {
        this.domNode.classList.add('disabled');
        this.inputBox.disable();
        this.preserveCase.disable();
    }
    setEnabled(enabled) {
        if (enabled) this.enable();
        else this.disable();
    }
    select() {
        this.inputBox.select();
    }
    focus() {
        this.inputBox.focus();
    }
    getPreserveCase() {
        return this.preserveCase.checked;
    }
    setPreserveCase(value) {
        this.preserveCase.checked = value;
    }
    focusOnPreserve() {
        this.preserveCase.focus();
    }
    validate() {
        this.inputBox?.validate();
    }
    set width(newWidth) {
        this.inputBox.paddingRight = this.cachedOptionsWidth;
        this.domNode.style.width = newWidth + 'px';
    }
    dispose() {
        super.dispose();
    }
}



var $cxCeF = parcelRequire("cxCeF");

var $6AWYG = parcelRequire("6AWYG");

var $4dEdH = parcelRequire("4dEdH");

var $9cWcn = parcelRequire("9cWcn");

var $bDzmQ = parcelRequire("bDzmQ");
var $36d223a3753fe003$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $36d223a3753fe003$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $36d223a3753fe003$export$deb80e61ead33ac5 = new (0, $cxCeF.RawContextKey)('suggestWidgetVisible', false, (0, $4dEdH.localize)('suggestWidgetVisible', "Whether suggestion are visible"));
const $36d223a3753fe003$var$HistoryNavigationWidgetFocusContext = 'historyNavigationWidgetFocus';
const $36d223a3753fe003$var$HistoryNavigationForwardsEnablementContext = 'historyNavigationForwardsEnabled';
const $36d223a3753fe003$var$HistoryNavigationBackwardsEnablementContext = 'historyNavigationBackwardsEnabled';
let $36d223a3753fe003$var$lastFocusedWidget = undefined;
const $36d223a3753fe003$var$widgets = [];
function $36d223a3753fe003$export$37932054b4b926c0(scopedContextKeyService, widget) {
    if ($36d223a3753fe003$var$widgets.includes(widget)) throw new Error('Cannot register the same widget multiple times');
    $36d223a3753fe003$var$widgets.push(widget);
    const disposableStore = new (0, $9cWcn.DisposableStore)();
    const historyNavigationWidgetFocus = new (0, $cxCeF.RawContextKey)($36d223a3753fe003$var$HistoryNavigationWidgetFocusContext, false).bindTo(scopedContextKeyService);
    const historyNavigationForwardsEnablement = new (0, $cxCeF.RawContextKey)($36d223a3753fe003$var$HistoryNavigationForwardsEnablementContext, true).bindTo(scopedContextKeyService);
    const historyNavigationBackwardsEnablement = new (0, $cxCeF.RawContextKey)($36d223a3753fe003$var$HistoryNavigationBackwardsEnablementContext, true).bindTo(scopedContextKeyService);
    const onDidFocus = ()=>{
        historyNavigationWidgetFocus.set(true);
        $36d223a3753fe003$var$lastFocusedWidget = widget;
    };
    const onDidBlur = ()=>{
        historyNavigationWidgetFocus.set(false);
        if ($36d223a3753fe003$var$lastFocusedWidget === widget) $36d223a3753fe003$var$lastFocusedWidget = undefined;
    };
    // Check for currently being focused
    if ((0, $bDzmQ.isActiveElement)(widget.element)) onDidFocus();
    disposableStore.add(widget.onDidFocus(()=>onDidFocus()));
    disposableStore.add(widget.onDidBlur(()=>onDidBlur()));
    disposableStore.add((0, $9cWcn.toDisposable)(()=>{
        $36d223a3753fe003$var$widgets.splice($36d223a3753fe003$var$widgets.indexOf(widget), 1);
        onDidBlur();
    }));
    return {
        historyNavigationForwardsEnablement: historyNavigationForwardsEnablement,
        historyNavigationBackwardsEnablement: historyNavigationBackwardsEnablement,
        dispose () {
            disposableStore.dispose();
        }
    };
}
let $36d223a3753fe003$export$8b5d5813b2156e74 = class ContextScopedFindInput extends (0, $5AbY3.FindInput) {
    constructor(container, contextViewProvider, options, contextKeyService){
        super(container, contextViewProvider, options);
        const scopedContextKeyService = this._register(contextKeyService.createScoped(this.inputBox.element));
        this._register($36d223a3753fe003$export$37932054b4b926c0(scopedContextKeyService, this.inputBox));
    }
};
$36d223a3753fe003$export$8b5d5813b2156e74 = $36d223a3753fe003$var$__decorate([
    $36d223a3753fe003$var$__param(3, (0, $cxCeF.IContextKeyService))
], $36d223a3753fe003$export$8b5d5813b2156e74);
let $36d223a3753fe003$export$da3bae0145835d60 = class ContextScopedReplaceInput extends (0, $364838f2693d9d76$export$3bdc90548a25210c) {
    constructor(container, contextViewProvider, options, contextKeyService, showReplaceOptions = false){
        super(container, contextViewProvider, showReplaceOptions, options);
        const scopedContextKeyService = this._register(contextKeyService.createScoped(this.inputBox.element));
        this._register($36d223a3753fe003$export$37932054b4b926c0(scopedContextKeyService, this.inputBox));
    }
};
$36d223a3753fe003$export$da3bae0145835d60 = $36d223a3753fe003$var$__decorate([
    $36d223a3753fe003$var$__param(3, (0, $cxCeF.IContextKeyService))
], $36d223a3753fe003$export$da3bae0145835d60);
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'history.showPrevious',
    weight: 200 /* KeybindingWeight.WorkbenchContrib */ ,
    when: (0, $cxCeF.ContextKeyExpr).and((0, $cxCeF.ContextKeyExpr).has($36d223a3753fe003$var$HistoryNavigationWidgetFocusContext), (0, $cxCeF.ContextKeyExpr).equals($36d223a3753fe003$var$HistoryNavigationBackwardsEnablementContext, true), (0, $cxCeF.ContextKeyExpr).not('isComposing'), $36d223a3753fe003$export$deb80e61ead33ac5.isEqualTo(false)),
    primary: 16 /* KeyCode.UpArrow */ ,
    secondary: [
        528 /* KeyCode.UpArrow */ 
    ],
    handler: (accessor)=>{
        $36d223a3753fe003$var$lastFocusedWidget?.showPreviousValue();
    }
});
(0, $6AWYG.KeybindingsRegistry).registerCommandAndKeybindingRule({
    id: 'history.showNext',
    weight: 200 /* KeybindingWeight.WorkbenchContrib */ ,
    when: (0, $cxCeF.ContextKeyExpr).and((0, $cxCeF.ContextKeyExpr).has($36d223a3753fe003$var$HistoryNavigationWidgetFocusContext), (0, $cxCeF.ContextKeyExpr).equals($36d223a3753fe003$var$HistoryNavigationForwardsEnablementContext, true), (0, $cxCeF.ContextKeyExpr).not('isComposing'), $36d223a3753fe003$export$deb80e61ead33ac5.isEqualTo(false)),
    primary: 18 /* KeyCode.DownArrow */ ,
    secondary: [
        530 /* KeyCode.DownArrow */ 
    ],
    handler: (accessor)=>{
        $36d223a3753fe003$var$lastFocusedWidget?.showNextValue();
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ function $4499d9bd118faeec$export$94614604caa08aab(keybindingService) {
    return keybindingService.lookupKeybinding('history.showPrevious')?.getElectronAccelerator() === 'Up' && keybindingService.lookupKeybinding('history.showNext')?.getElectronAccelerator() === 'Down';
}



var $gaWeX = parcelRequire("gaWeX");

var $hEsmQ = parcelRequire("hEsmQ");

var $azIPz = parcelRequire("azIPz");

var $5rADe = parcelRequire("5rADe");

var $95ky9 = parcelRequire("95ky9");

var $bxBg7 = parcelRequire("bxBg7");

var $l1XLO = parcelRequire("l1XLO");

var $b97Zr = parcelRequire("b97Zr");
const $5680bcb7e8208779$var$findCollapsedIcon = (0, $hEsmQ.registerIcon)('find-collapsed', (0, $awgRE.Codicon).chevronRight, $4dEdH.localize('findCollapsedIcon', 'Icon to indicate that the editor find widget is collapsed.'));
const $5680bcb7e8208779$var$findExpandedIcon = (0, $hEsmQ.registerIcon)('find-expanded', (0, $awgRE.Codicon).chevronDown, $4dEdH.localize('findExpandedIcon', 'Icon to indicate that the editor find widget is expanded.'));
const $5680bcb7e8208779$export$a483578e53277a13 = (0, $hEsmQ.registerIcon)('find-selection', (0, $awgRE.Codicon).selection, $4dEdH.localize('findSelectionIcon', 'Icon for \'Find in Selection\' in the editor find widget.'));
const $5680bcb7e8208779$export$83ee554109a27042 = (0, $hEsmQ.registerIcon)('find-replace', (0, $awgRE.Codicon).replace, $4dEdH.localize('findReplaceIcon', 'Icon for \'Replace\' in the editor find widget.'));
const $5680bcb7e8208779$export$9c63c939bdf63145 = (0, $hEsmQ.registerIcon)('find-replace-all', (0, $awgRE.Codicon).replaceAll, $4dEdH.localize('findReplaceAllIcon', 'Icon for \'Replace All\' in the editor find widget.'));
const $5680bcb7e8208779$export$cd8ded1ad8462604 = (0, $hEsmQ.registerIcon)('find-previous-match', (0, $awgRE.Codicon).arrowUp, $4dEdH.localize('findPreviousMatchIcon', 'Icon for \'Find Previous\' in the editor find widget.'));
const $5680bcb7e8208779$export$3b49e6223142e6cb = (0, $hEsmQ.registerIcon)('find-next-match', (0, $awgRE.Codicon).arrowDown, $4dEdH.localize('findNextMatchIcon', 'Icon for \'Find Next\' in the editor find widget.'));
const $5680bcb7e8208779$var$NLS_FIND_DIALOG_LABEL = $4dEdH.localize('label.findDialog', "Find / Replace");
const $5680bcb7e8208779$var$NLS_FIND_INPUT_LABEL = $4dEdH.localize('label.find', "Find");
const $5680bcb7e8208779$var$NLS_FIND_INPUT_PLACEHOLDER = $4dEdH.localize('placeholder.find', "Find");
const $5680bcb7e8208779$var$NLS_PREVIOUS_MATCH_BTN_LABEL = $4dEdH.localize('label.previousMatchButton', "Previous Match");
const $5680bcb7e8208779$var$NLS_NEXT_MATCH_BTN_LABEL = $4dEdH.localize('label.nextMatchButton', "Next Match");
const $5680bcb7e8208779$var$NLS_TOGGLE_SELECTION_FIND_TITLE = $4dEdH.localize('label.toggleSelectionFind', "Find in Selection");
const $5680bcb7e8208779$var$NLS_CLOSE_BTN_LABEL = $4dEdH.localize('label.closeButton', "Close");
const $5680bcb7e8208779$var$NLS_REPLACE_INPUT_LABEL = $4dEdH.localize('label.replace', "Replace");
const $5680bcb7e8208779$var$NLS_REPLACE_INPUT_PLACEHOLDER = $4dEdH.localize('placeholder.replace', "Replace");
const $5680bcb7e8208779$var$NLS_REPLACE_BTN_LABEL = $4dEdH.localize('label.replaceButton', "Replace");
const $5680bcb7e8208779$var$NLS_REPLACE_ALL_BTN_LABEL = $4dEdH.localize('label.replaceAllButton', "Replace All");
const $5680bcb7e8208779$var$NLS_TOGGLE_REPLACE_MODE_BTN_LABEL = $4dEdH.localize('label.toggleReplaceButton', "Toggle Replace");
const $5680bcb7e8208779$var$NLS_MATCHES_COUNT_LIMIT_TITLE = $4dEdH.localize('title.matchesCountLimit', "Only the first {0} results are highlighted, but all find operations work on the entire text.", (0, $5f870f89a0356425$export$79640dbfb07f50a4));
const $5680bcb7e8208779$export$db048e36c0077c43 = $4dEdH.localize('label.matchesLocation', "{0} of {1}");
const $5680bcb7e8208779$export$5e23834a190f34c5 = $4dEdH.localize('label.noResults', "No results");
const $5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH = 419;
const $5680bcb7e8208779$var$PART_WIDTH = 275;
const $5680bcb7e8208779$var$FIND_INPUT_AREA_WIDTH = $5680bcb7e8208779$var$PART_WIDTH - 54;
let $5680bcb7e8208779$var$MAX_MATCHES_COUNT_WIDTH = 69;
// let FIND_ALL_CONTROLS_WIDTH = 17/** Find Input margin-left */ + (MAX_MATCHES_COUNT_WIDTH + 3 + 1) /** Match Results */ + 23 /** Button */ * 4 + 2/** sash */;
const $5680bcb7e8208779$var$FIND_INPUT_AREA_HEIGHT = 33; // The height of Find Widget when Replace Input is not visible.
const $5680bcb7e8208779$var$ctrlEnterReplaceAllWarningPromptedKey = 'ctrlEnterReplaceAll.windows.donotask';
const $5680bcb7e8208779$var$ctrlKeyMod = $lb0Ah.isMacintosh ? 256 /* KeyMod.WinCtrl */  : 2048 /* KeyMod.CtrlCmd */ ;
class $5680bcb7e8208779$export$70830c157adafe3e {
    constructor(afterLineNumber){
        this.afterLineNumber = afterLineNumber;
        this.heightInPx = $5680bcb7e8208779$var$FIND_INPUT_AREA_HEIGHT;
        this.suppressMouseDown = false;
        this.domNode = document.createElement('div');
        this.domNode.className = 'dock-find-viewzone';
    }
}
function $5680bcb7e8208779$var$stopPropagationForMultiLineUpwards(event, value, textarea) {
    const isMultiline = !!value.match(/\n/);
    if (textarea && isMultiline && textarea.selectionStart > 0) {
        event.stopPropagation();
        return;
    }
}
function $5680bcb7e8208779$var$stopPropagationForMultiLineDownwards(event, value, textarea) {
    const isMultiline = !!value.match(/\n/);
    if (textarea && isMultiline && textarea.selectionEnd < textarea.value.length) {
        event.stopPropagation();
        return;
    }
}
class $5680bcb7e8208779$export$94cf213bcf83d48e extends (0, $fxJYg.Widget) {
    static{
        this.ID = 'editor.contrib.findWidget';
    }
    constructor(codeEditor, controller, state, contextViewProvider, keybindingService, contextKeyService, themeService, storageService, notificationService, _hoverService){
        super();
        this._hoverService = _hoverService;
        this._cachedHeight = null;
        this._revealTimeouts = [];
        this._codeEditor = codeEditor;
        this._controller = controller;
        this._state = state;
        this._contextViewProvider = contextViewProvider;
        this._keybindingService = keybindingService;
        this._contextKeyService = contextKeyService;
        this._storageService = storageService;
        this._notificationService = notificationService;
        this._ctrlEnterReplaceAllWarningPrompted = !!storageService.getBoolean($5680bcb7e8208779$var$ctrlEnterReplaceAllWarningPromptedKey, 0 /* StorageScope.PROFILE */ );
        this._isVisible = false;
        this._isReplaceVisible = false;
        this._ignoreChangeEvent = false;
        this._updateHistoryDelayer = new (0, $6bXyA.Delayer)(500);
        this._register((0, $9cWcn.toDisposable)(()=>this._updateHistoryDelayer.cancel()));
        this._register(this._state.onFindReplaceStateChange((e)=>this._onStateChanged(e)));
        this._buildDomNode();
        this._updateButtons();
        this._tryUpdateWidgetWidth();
        this._findInput.inputBox.layout();
        this._register(this._codeEditor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(92 /* EditorOption.readOnly */ )) {
                if (this._codeEditor.getOption(92 /* EditorOption.readOnly */ )) // Hide replace part if editor becomes read only
                this._state.change({
                    isReplaceRevealed: false
                }, false);
                this._updateButtons();
            }
            if (e.hasChanged(146 /* EditorOption.layoutInfo */ )) this._tryUpdateWidgetWidth();
            if (e.hasChanged(2 /* EditorOption.accessibilitySupport */ )) this.updateAccessibilitySupport();
            if (e.hasChanged(41 /* EditorOption.find */ )) {
                const supportLoop = this._codeEditor.getOption(41 /* EditorOption.find */ ).loop;
                this._state.change({
                    loop: supportLoop
                }, false);
                const addExtraSpaceOnTop = this._codeEditor.getOption(41 /* EditorOption.find */ ).addExtraSpaceOnTop;
                if (addExtraSpaceOnTop && !this._viewZone) {
                    this._viewZone = new $5680bcb7e8208779$export$70830c157adafe3e(0);
                    this._showViewZone();
                }
                if (!addExtraSpaceOnTop && this._viewZone) this._removeViewZone();
            }
        }));
        this.updateAccessibilitySupport();
        this._register(this._codeEditor.onDidChangeCursorSelection(()=>{
            if (this._isVisible) this._updateToggleSelectionFindButton();
        }));
        this._register(this._codeEditor.onDidFocusEditorWidget(async ()=>{
            if (this._isVisible) {
                const globalBufferTerm = await this._controller.getGlobalBufferTerm();
                if (globalBufferTerm && globalBufferTerm !== this._state.searchString) {
                    this._state.change({
                        searchString: globalBufferTerm
                    }, false);
                    this._findInput.select();
                }
            }
        }));
        this._findInputFocused = (0, $5f870f89a0356425$export$1bcc3ed82148a8b9).bindTo(contextKeyService);
        this._findFocusTracker = this._register($bDzmQ.trackFocus(this._findInput.inputBox.inputElement));
        this._register(this._findFocusTracker.onDidFocus(()=>{
            this._findInputFocused.set(true);
            this._updateSearchScope();
        }));
        this._register(this._findFocusTracker.onDidBlur(()=>{
            this._findInputFocused.set(false);
        }));
        this._replaceInputFocused = (0, $5f870f89a0356425$export$1b9f123cc9b71d78).bindTo(contextKeyService);
        this._replaceFocusTracker = this._register($bDzmQ.trackFocus(this._replaceInput.inputBox.inputElement));
        this._register(this._replaceFocusTracker.onDidFocus(()=>{
            this._replaceInputFocused.set(true);
            this._updateSearchScope();
        }));
        this._register(this._replaceFocusTracker.onDidBlur(()=>{
            this._replaceInputFocused.set(false);
        }));
        this._codeEditor.addOverlayWidget(this);
        if (this._codeEditor.getOption(41 /* EditorOption.find */ ).addExtraSpaceOnTop) this._viewZone = new $5680bcb7e8208779$export$70830c157adafe3e(0); // Put it before the first line then users can scroll beyond the first line.
        this._register(this._codeEditor.onDidChangeModel(()=>{
            if (!this._isVisible) return;
            this._viewZoneId = undefined;
        }));
        this._register(this._codeEditor.onDidScrollChange((e)=>{
            if (e.scrollTopChanged) {
                this._layoutViewZone();
                return;
            }
            // for other scroll changes, layout the viewzone in next tick to avoid ruining current rendering.
            setTimeout(()=>{
                this._layoutViewZone();
            }, 0);
        }));
    }
    // ----- IOverlayWidget API
    getId() {
        return $5680bcb7e8208779$export$94cf213bcf83d48e.ID;
    }
    getDomNode() {
        return this._domNode;
    }
    getPosition() {
        if (this._isVisible) return {
            preference: 0 /* OverlayWidgetPositionPreference.TOP_RIGHT_CORNER */ 
        };
        return null;
    }
    // ----- React to state changes
    _onStateChanged(e) {
        if (e.searchString) {
            try {
                this._ignoreChangeEvent = true;
                this._findInput.setValue(this._state.searchString);
            } finally{
                this._ignoreChangeEvent = false;
            }
            this._updateButtons();
        }
        if (e.replaceString) this._replaceInput.inputBox.value = this._state.replaceString;
        if (e.isRevealed) {
            if (this._state.isRevealed) this._reveal();
            else this._hide(true);
        }
        if (e.isReplaceRevealed) {
            if (this._state.isReplaceRevealed) {
                if (!this._codeEditor.getOption(92 /* EditorOption.readOnly */ ) && !this._isReplaceVisible) {
                    this._isReplaceVisible = true;
                    this._replaceInput.width = $bDzmQ.getTotalWidth(this._findInput.domNode);
                    this._updateButtons();
                    this._replaceInput.inputBox.layout();
                }
            } else if (this._isReplaceVisible) {
                this._isReplaceVisible = false;
                this._updateButtons();
            }
        }
        if ((e.isRevealed || e.isReplaceRevealed) && (this._state.isRevealed || this._state.isReplaceRevealed)) {
            if (this._tryUpdateHeight()) this._showViewZone();
        }
        if (e.isRegex) this._findInput.setRegex(this._state.isRegex);
        if (e.wholeWord) this._findInput.setWholeWords(this._state.wholeWord);
        if (e.matchCase) this._findInput.setCaseSensitive(this._state.matchCase);
        if (e.preserveCase) this._replaceInput.setPreserveCase(this._state.preserveCase);
        if (e.searchScope) {
            if (this._state.searchScope) this._toggleSelectionFind.checked = true;
            else this._toggleSelectionFind.checked = false;
            this._updateToggleSelectionFindButton();
        }
        if (e.searchString || e.matchesCount || e.matchesPosition) {
            const showRedOutline = this._state.searchString.length > 0 && this._state.matchesCount === 0;
            this._domNode.classList.toggle('no-results', showRedOutline);
            this._updateMatchesCount();
            this._updateButtons();
        }
        if (e.searchString || e.currentMatch) this._layoutViewZone();
        if (e.updateHistory) this._delayedUpdateHistory();
        if (e.loop) this._updateButtons();
    }
    _delayedUpdateHistory() {
        this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(undefined, (0, $gPkHZ.onUnexpectedError));
    }
    _updateHistory() {
        if (this._state.searchString) this._findInput.inputBox.addToHistory();
        if (this._state.replaceString) this._replaceInput.inputBox.addToHistory();
    }
    _updateMatchesCount() {
        this._matchesCount.style.minWidth = $5680bcb7e8208779$var$MAX_MATCHES_COUNT_WIDTH + 'px';
        if (this._state.matchesCount >= (0, $5f870f89a0356425$export$79640dbfb07f50a4)) this._matchesCount.title = $5680bcb7e8208779$var$NLS_MATCHES_COUNT_LIMIT_TITLE;
        else this._matchesCount.title = '';
        // remove previous content
        this._matchesCount.firstChild?.remove();
        let label;
        if (this._state.matchesCount > 0) {
            let matchesCount = String(this._state.matchesCount);
            if (this._state.matchesCount >= (0, $5f870f89a0356425$export$79640dbfb07f50a4)) matchesCount += '+';
            let matchesPosition = String(this._state.matchesPosition);
            if (matchesPosition === '0') matchesPosition = '?';
            label = $jcr1R.format($5680bcb7e8208779$export$db048e36c0077c43, matchesPosition, matchesCount);
        } else label = $5680bcb7e8208779$export$5e23834a190f34c5;
        this._matchesCount.appendChild(document.createTextNode(label));
        (0, $aIbUW.alert)(this._getAriaLabel(label, this._state.currentMatch, this._state.searchString));
        $5680bcb7e8208779$var$MAX_MATCHES_COUNT_WIDTH = Math.max($5680bcb7e8208779$var$MAX_MATCHES_COUNT_WIDTH, this._matchesCount.clientWidth);
    }
    // ----- actions
    _getAriaLabel(label, currentMatch, searchString) {
        if (label === $5680bcb7e8208779$export$5e23834a190f34c5) return searchString === '' ? $4dEdH.localize('ariaSearchNoResultEmpty', "{0} found", label) : $4dEdH.localize('ariaSearchNoResult', "{0} found for '{1}'", label, searchString);
        if (currentMatch) {
            const ariaLabel = $4dEdH.localize('ariaSearchNoResultWithLineNum', "{0} found for '{1}', at {2}", label, searchString, currentMatch.startLineNumber + ':' + currentMatch.startColumn);
            const model = this._codeEditor.getModel();
            if (model && currentMatch.startLineNumber <= model.getLineCount() && currentMatch.startLineNumber >= 1) {
                const lineContent = model.getLineContent(currentMatch.startLineNumber);
                return `${lineContent}, ${ariaLabel}`;
            }
            return ariaLabel;
        }
        return $4dEdH.localize('ariaSearchNoResultWithLineNumNoCurrentMatch', "{0} found for '{1}'", label, searchString);
    }
    /**
     * If 'selection find' is ON we should not disable the button (its function is to cancel 'selection find').
     * If 'selection find' is OFF we enable the button only if there is a selection.
     */ _updateToggleSelectionFindButton() {
        const selection = this._codeEditor.getSelection();
        const isSelection = selection ? selection.startLineNumber !== selection.endLineNumber || selection.startColumn !== selection.endColumn : false;
        const isChecked = this._toggleSelectionFind.checked;
        if (this._isVisible && (isChecked || isSelection)) this._toggleSelectionFind.enable();
        else this._toggleSelectionFind.disable();
    }
    _updateButtons() {
        this._findInput.setEnabled(this._isVisible);
        this._replaceInput.setEnabled(this._isVisible && this._isReplaceVisible);
        this._updateToggleSelectionFindButton();
        this._closeBtn.setEnabled(this._isVisible);
        const findInputIsNonEmpty = this._state.searchString.length > 0;
        const matchesCount = this._state.matchesCount ? true : false;
        this._prevBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount && this._state.canNavigateBack());
        this._nextBtn.setEnabled(this._isVisible && findInputIsNonEmpty && matchesCount && this._state.canNavigateForward());
        this._replaceBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);
        this._replaceAllBtn.setEnabled(this._isVisible && this._isReplaceVisible && findInputIsNonEmpty);
        this._domNode.classList.toggle('replaceToggled', this._isReplaceVisible);
        this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);
        const canReplace = !this._codeEditor.getOption(92 /* EditorOption.readOnly */ );
        this._toggleReplaceBtn.setEnabled(this._isVisible && canReplace);
    }
    _reveal() {
        this._revealTimeouts.forEach((e)=>{
            clearTimeout(e);
        });
        this._revealTimeouts = [];
        if (!this._isVisible) {
            this._isVisible = true;
            const selection = this._codeEditor.getSelection();
            switch(this._codeEditor.getOption(41 /* EditorOption.find */ ).autoFindInSelection){
                case 'always':
                    this._toggleSelectionFind.checked = true;
                    break;
                case 'never':
                    this._toggleSelectionFind.checked = false;
                    break;
                case 'multiline':
                    {
                        const isSelectionMultipleLine = !!selection && selection.startLineNumber !== selection.endLineNumber;
                        this._toggleSelectionFind.checked = isSelectionMultipleLine;
                        break;
                    }
                default:
                    break;
            }
            this._tryUpdateWidgetWidth();
            this._updateButtons();
            this._revealTimeouts.push(setTimeout(()=>{
                this._domNode.classList.add('visible');
                this._domNode.setAttribute('aria-hidden', 'false');
            }, 0));
            // validate query again as it's being dismissed when we hide the find widget.
            this._revealTimeouts.push(setTimeout(()=>{
                this._findInput.validate();
            }, 200));
            this._codeEditor.layoutOverlayWidget(this);
            let adjustEditorScrollTop = true;
            if (this._codeEditor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection && selection) {
                const domNode = this._codeEditor.getDomNode();
                if (domNode) {
                    const editorCoords = $bDzmQ.getDomNodePagePosition(domNode);
                    const startCoords = this._codeEditor.getScrolledVisiblePosition(selection.getStartPosition());
                    const startLeft = editorCoords.left + (startCoords ? startCoords.left : 0);
                    const startTop = startCoords ? startCoords.top : 0;
                    if (this._viewZone && startTop < this._viewZone.heightInPx) {
                        if (selection.endLineNumber > selection.startLineNumber) adjustEditorScrollTop = false;
                        const leftOfFindWidget = $bDzmQ.getTopLeftOffset(this._domNode).left;
                        if (startLeft > leftOfFindWidget) adjustEditorScrollTop = false;
                        const endCoords = this._codeEditor.getScrolledVisiblePosition(selection.getEndPosition());
                        const endLeft = editorCoords.left + (endCoords ? endCoords.left : 0);
                        if (endLeft > leftOfFindWidget) adjustEditorScrollTop = false;
                    }
                }
            }
            this._showViewZone(adjustEditorScrollTop);
        }
    }
    _hide(focusTheEditor) {
        this._revealTimeouts.forEach((e)=>{
            clearTimeout(e);
        });
        this._revealTimeouts = [];
        if (this._isVisible) {
            this._isVisible = false;
            this._updateButtons();
            this._domNode.classList.remove('visible');
            this._domNode.setAttribute('aria-hidden', 'true');
            this._findInput.clearMessage();
            if (focusTheEditor) this._codeEditor.focus();
            this._codeEditor.layoutOverlayWidget(this);
            this._removeViewZone();
        }
    }
    _layoutViewZone(targetScrollTop) {
        const addExtraSpaceOnTop = this._codeEditor.getOption(41 /* EditorOption.find */ ).addExtraSpaceOnTop;
        if (!addExtraSpaceOnTop) {
            this._removeViewZone();
            return;
        }
        if (!this._isVisible) return;
        const viewZone = this._viewZone;
        if (this._viewZoneId !== undefined || !viewZone) return;
        this._codeEditor.changeViewZones((accessor)=>{
            viewZone.heightInPx = this._getHeight();
            this._viewZoneId = accessor.addZone(viewZone);
            // scroll top adjust to make sure the editor doesn't scroll when adding viewzone at the beginning.
            this._codeEditor.setScrollTop(targetScrollTop || this._codeEditor.getScrollTop() + viewZone.heightInPx);
        });
    }
    _showViewZone(adjustScroll = true) {
        if (!this._isVisible) return;
        const addExtraSpaceOnTop = this._codeEditor.getOption(41 /* EditorOption.find */ ).addExtraSpaceOnTop;
        if (!addExtraSpaceOnTop) return;
        if (this._viewZone === undefined) this._viewZone = new $5680bcb7e8208779$export$70830c157adafe3e(0);
        const viewZone = this._viewZone;
        this._codeEditor.changeViewZones((accessor)=>{
            if (this._viewZoneId !== undefined) {
                // the view zone already exists, we need to update the height
                const newHeight = this._getHeight();
                if (newHeight === viewZone.heightInPx) return;
                const scrollAdjustment = newHeight - viewZone.heightInPx;
                viewZone.heightInPx = newHeight;
                accessor.layoutZone(this._viewZoneId);
                if (adjustScroll) this._codeEditor.setScrollTop(this._codeEditor.getScrollTop() + scrollAdjustment);
                return;
            } else {
                let scrollAdjustment = this._getHeight();
                // if the editor has top padding, factor that into the zone height
                scrollAdjustment -= this._codeEditor.getOption(84 /* EditorOption.padding */ ).top;
                if (scrollAdjustment <= 0) return;
                viewZone.heightInPx = scrollAdjustment;
                this._viewZoneId = accessor.addZone(viewZone);
                if (adjustScroll) this._codeEditor.setScrollTop(this._codeEditor.getScrollTop() + scrollAdjustment);
            }
        });
    }
    _removeViewZone() {
        this._codeEditor.changeViewZones((accessor)=>{
            if (this._viewZoneId !== undefined) {
                accessor.removeZone(this._viewZoneId);
                this._viewZoneId = undefined;
                if (this._viewZone) {
                    this._codeEditor.setScrollTop(this._codeEditor.getScrollTop() - this._viewZone.heightInPx);
                    this._viewZone = undefined;
                }
            }
        });
    }
    _tryUpdateWidgetWidth() {
        if (!this._isVisible) return;
        if (!this._domNode.isConnected) // the widget is not in the DOM
        return;
        const layoutInfo = this._codeEditor.getLayoutInfo();
        const editorContentWidth = layoutInfo.contentWidth;
        if (editorContentWidth <= 0) {
            // for example, diff view original editor
            this._domNode.classList.add('hiddenEditor');
            return;
        } else if (this._domNode.classList.contains('hiddenEditor')) this._domNode.classList.remove('hiddenEditor');
        const editorWidth = layoutInfo.width;
        const minimapWidth = layoutInfo.minimap.minimapWidth;
        let collapsedFindWidget = false;
        let reducedFindWidget = false;
        let narrowFindWidget = false;
        if (this._resized) {
            const widgetWidth = $bDzmQ.getTotalWidth(this._domNode);
            if (widgetWidth > $5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH) {
                // as the widget is resized by users, we may need to change the max width of the widget as the editor width changes.
                this._domNode.style.maxWidth = `${editorWidth - 28 - minimapWidth - 15}px`;
                this._replaceInput.width = $bDzmQ.getTotalWidth(this._findInput.domNode);
                return;
            }
        }
        if ($5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth >= editorWidth) reducedFindWidget = true;
        if ($5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - $5680bcb7e8208779$var$MAX_MATCHES_COUNT_WIDTH >= editorWidth) narrowFindWidget = true;
        if ($5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH + 28 + minimapWidth - $5680bcb7e8208779$var$MAX_MATCHES_COUNT_WIDTH >= editorWidth + 50) collapsedFindWidget = true;
        this._domNode.classList.toggle('collapsed-find-widget', collapsedFindWidget);
        this._domNode.classList.toggle('narrow-find-widget', narrowFindWidget);
        this._domNode.classList.toggle('reduced-find-widget', reducedFindWidget);
        if (!narrowFindWidget && !collapsedFindWidget) // the minimal left offset of findwidget is 15px.
        this._domNode.style.maxWidth = `${editorWidth - 28 - minimapWidth - 15}px`;
        this._findInput.layout({
            collapsedFindWidget: collapsedFindWidget,
            narrowFindWidget: narrowFindWidget,
            reducedFindWidget: reducedFindWidget
        });
        if (this._resized) {
            const findInputWidth = this._findInput.inputBox.element.clientWidth;
            if (findInputWidth > 0) this._replaceInput.width = findInputWidth;
        } else if (this._isReplaceVisible) this._replaceInput.width = $bDzmQ.getTotalWidth(this._findInput.domNode);
    }
    _getHeight() {
        let totalheight = 0;
        // find input margin top
        totalheight += 4;
        // find input height
        totalheight += this._findInput.inputBox.height + 2 /** input box border */ ;
        if (this._isReplaceVisible) {
            // replace input margin
            totalheight += 4;
            totalheight += this._replaceInput.inputBox.height + 2 /** input box border */ ;
        }
        // margin bottom
        totalheight += 4;
        return totalheight;
    }
    _tryUpdateHeight() {
        const totalHeight = this._getHeight();
        if (this._cachedHeight !== null && this._cachedHeight === totalHeight) return false;
        this._cachedHeight = totalHeight;
        this._domNode.style.height = `${totalHeight}px`;
        return true;
    }
    // ----- Public
    focusFindInput() {
        this._findInput.select();
        // Edge browser requires focus() in addition to select()
        this._findInput.focus();
    }
    focusReplaceInput() {
        this._replaceInput.select();
        // Edge browser requires focus() in addition to select()
        this._replaceInput.focus();
    }
    highlightFindOptions() {
        this._findInput.highlightFindOptions();
    }
    _updateSearchScope() {
        if (!this._codeEditor.hasModel()) return;
        if (this._toggleSelectionFind.checked) {
            const selections = this._codeEditor.getSelections();
            selections.map((selection)=>{
                if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) selection = selection.setEndPosition(selection.endLineNumber - 1, this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));
                const currentMatch = this._state.currentMatch;
                if (selection.startLineNumber !== selection.endLineNumber) {
                    if (!(0, $d00il.Range).equalsRange(selection, currentMatch)) return selection;
                }
                return null;
            }).filter((element)=>!!element);
            if (selections.length) this._state.change({
                searchScope: selections
            }, true);
        }
    }
    _onFindInputMouseDown(e) {
        // on linux, middle key does pasting.
        if (e.middleButton) e.stopPropagation();
    }
    _onFindInputKeyDown(e) {
        if (e.equals($5680bcb7e8208779$var$ctrlKeyMod | 3 /* KeyCode.Enter */ )) {
            if (this._keybindingService.dispatchEvent(e, e.target)) {
                e.preventDefault();
                return;
            } else {
                this._findInput.inputBox.insertAtCursor('\n');
                e.preventDefault();
                return;
            }
        }
        if (e.equals(2 /* KeyCode.Tab */ )) {
            if (this._isReplaceVisible) this._replaceInput.focus();
            else this._findInput.focusOnCaseSensitive();
            e.preventDefault();
            return;
        }
        if (e.equals(2066 /* KeyCode.DownArrow */ )) {
            this._codeEditor.focus();
            e.preventDefault();
            return;
        }
        if (e.equals(16 /* KeyCode.UpArrow */ )) return $5680bcb7e8208779$var$stopPropagationForMultiLineUpwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));
        if (e.equals(18 /* KeyCode.DownArrow */ )) return $5680bcb7e8208779$var$stopPropagationForMultiLineDownwards(e, this._findInput.getValue(), this._findInput.domNode.querySelector('textarea'));
    }
    _onReplaceInputKeyDown(e) {
        if (e.equals($5680bcb7e8208779$var$ctrlKeyMod | 3 /* KeyCode.Enter */ )) {
            if (this._keybindingService.dispatchEvent(e, e.target)) {
                e.preventDefault();
                return;
            } else {
                if ($lb0Ah.isWindows && $lb0Ah.isNative && !this._ctrlEnterReplaceAllWarningPrompted) {
                    // this is the first time when users press Ctrl + Enter to replace all
                    this._notificationService.info($4dEdH.localize('ctrlEnter.keybindingChanged', 'Ctrl+Enter now inserts line break instead of replacing all. You can modify the keybinding for editor.action.replaceAll to override this behavior.'));
                    this._ctrlEnterReplaceAllWarningPrompted = true;
                    this._storageService.store($5680bcb7e8208779$var$ctrlEnterReplaceAllWarningPromptedKey, true, 0 /* StorageScope.PROFILE */ , 0 /* StorageTarget.USER */ );
                }
                this._replaceInput.inputBox.insertAtCursor('\n');
                e.preventDefault();
                return;
            }
        }
        if (e.equals(2 /* KeyCode.Tab */ )) {
            this._findInput.focusOnCaseSensitive();
            e.preventDefault();
            return;
        }
        if (e.equals(1026 /* KeyCode.Tab */ )) {
            this._findInput.focus();
            e.preventDefault();
            return;
        }
        if (e.equals(2066 /* KeyCode.DownArrow */ )) {
            this._codeEditor.focus();
            e.preventDefault();
            return;
        }
        if (e.equals(16 /* KeyCode.UpArrow */ )) return $5680bcb7e8208779$var$stopPropagationForMultiLineUpwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));
        if (e.equals(18 /* KeyCode.DownArrow */ )) return $5680bcb7e8208779$var$stopPropagationForMultiLineDownwards(e, this._replaceInput.inputBox.value, this._replaceInput.inputBox.element.querySelector('textarea'));
    }
    // ----- sash
    getVerticalSashLeft(_sash) {
        return 0;
    }
    // ----- initialization
    _keybindingLabelFor(actionId) {
        const kb = this._keybindingService.lookupKeybinding(actionId);
        if (!kb) return '';
        return ` (${kb.getLabel()})`;
    }
    _buildDomNode() {
        const flexibleHeight = true;
        const flexibleWidth = true;
        // Find input
        this._findInput = this._register(new (0, $36d223a3753fe003$export$8b5d5813b2156e74)(null, this._contextViewProvider, {
            width: $5680bcb7e8208779$var$FIND_INPUT_AREA_WIDTH,
            label: $5680bcb7e8208779$var$NLS_FIND_INPUT_LABEL,
            placeholder: $5680bcb7e8208779$var$NLS_FIND_INPUT_PLACEHOLDER,
            appendCaseSensitiveLabel: this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ToggleCaseSensitiveCommand),
            appendWholeWordsLabel: this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ToggleWholeWordCommand),
            appendRegexLabel: this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ToggleRegexCommand),
            validation: (value)=>{
                if (value.length === 0 || !this._findInput.getRegex()) return null;
                try {
                    // use `g` and `u` which are also used by the TextModel search
                    new RegExp(value, 'gu');
                    return null;
                } catch (e) {
                    return {
                        content: e.message
                    };
                }
            },
            flexibleHeight: flexibleHeight,
            flexibleWidth: flexibleWidth,
            flexibleMaxHeight: 118,
            showCommonFindToggles: true,
            showHistoryHint: ()=>(0, $4499d9bd118faeec$export$94614604caa08aab)(this._keybindingService),
            inputBoxStyles: (0, $l1XLO.defaultInputBoxStyles),
            toggleStyles: (0, $l1XLO.defaultToggleStyles)
        }, this._contextKeyService));
        this._findInput.setRegex(!!this._state.isRegex);
        this._findInput.setCaseSensitive(!!this._state.matchCase);
        this._findInput.setWholeWords(!!this._state.wholeWord);
        this._register(this._findInput.onKeyDown((e)=>this._onFindInputKeyDown(e)));
        this._register(this._findInput.inputBox.onDidChange(()=>{
            if (this._ignoreChangeEvent) return;
            this._state.change({
                searchString: this._findInput.getValue()
            }, true);
        }));
        this._register(this._findInput.onDidOptionChange(()=>{
            this._state.change({
                isRegex: this._findInput.getRegex(),
                wholeWord: this._findInput.getWholeWords(),
                matchCase: this._findInput.getCaseSensitive()
            }, true);
        }));
        this._register(this._findInput.onCaseSensitiveKeyDown((e)=>{
            if (e.equals(1026 /* KeyCode.Tab */ )) {
                if (this._isReplaceVisible) {
                    this._replaceInput.focus();
                    e.preventDefault();
                }
            }
        }));
        this._register(this._findInput.onRegexKeyDown((e)=>{
            if (e.equals(2 /* KeyCode.Tab */ )) {
                if (this._isReplaceVisible) {
                    this._replaceInput.focusOnPreserve();
                    e.preventDefault();
                }
            }
        }));
        this._register(this._findInput.inputBox.onDidHeightChange((e)=>{
            if (this._tryUpdateHeight()) this._showViewZone();
        }));
        if ($lb0Ah.isLinux) this._register(this._findInput.onMouseDown((e)=>this._onFindInputMouseDown(e)));
        this._matchesCount = document.createElement('div');
        this._matchesCount.className = 'matchesCount';
        this._updateMatchesCount();
        // Create a scoped hover delegate for all find related buttons
        const hoverDelegate = this._register((0, $b97Zr.createInstantHoverDelegate)());
        // Previous button
        this._prevBtn = this._register(new $5680bcb7e8208779$export$627052cf4bde93a4({
            label: $5680bcb7e8208779$var$NLS_PREVIOUS_MATCH_BTN_LABEL + this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).PreviousMatchFindAction),
            icon: $5680bcb7e8208779$export$cd8ded1ad8462604,
            hoverDelegate: hoverDelegate,
            onTrigger: ()=>{
                (0, $bxBg7.assertIsDefined)(this._codeEditor.getAction((0, $5f870f89a0356425$export$a4fc1be778636938).PreviousMatchFindAction)).run().then(undefined, (0, $gPkHZ.onUnexpectedError));
            }
        }, this._hoverService));
        // Next button
        this._nextBtn = this._register(new $5680bcb7e8208779$export$627052cf4bde93a4({
            label: $5680bcb7e8208779$var$NLS_NEXT_MATCH_BTN_LABEL + this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).NextMatchFindAction),
            icon: $5680bcb7e8208779$export$3b49e6223142e6cb,
            hoverDelegate: hoverDelegate,
            onTrigger: ()=>{
                (0, $bxBg7.assertIsDefined)(this._codeEditor.getAction((0, $5f870f89a0356425$export$a4fc1be778636938).NextMatchFindAction)).run().then(undefined, (0, $gPkHZ.onUnexpectedError));
            }
        }, this._hoverService));
        const findPart = document.createElement('div');
        findPart.className = 'find-part';
        findPart.appendChild(this._findInput.domNode);
        const actionsContainer = document.createElement('div');
        actionsContainer.className = 'find-actions';
        findPart.appendChild(actionsContainer);
        actionsContainer.appendChild(this._matchesCount);
        actionsContainer.appendChild(this._prevBtn.domNode);
        actionsContainer.appendChild(this._nextBtn.domNode);
        // Toggle selection button
        this._toggleSelectionFind = this._register(new (0, $jyuUf.Toggle)({
            icon: $5680bcb7e8208779$export$a483578e53277a13,
            title: $5680bcb7e8208779$var$NLS_TOGGLE_SELECTION_FIND_TITLE + this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ToggleSearchScopeCommand),
            isChecked: false,
            hoverDelegate: hoverDelegate,
            inputActiveOptionBackground: (0, $gaWeX.asCssVariable)((0, $gaWeX.inputActiveOptionBackground)),
            inputActiveOptionBorder: (0, $gaWeX.asCssVariable)((0, $gaWeX.inputActiveOptionBorder)),
            inputActiveOptionForeground: (0, $gaWeX.asCssVariable)((0, $gaWeX.inputActiveOptionForeground))
        }));
        this._register(this._toggleSelectionFind.onChange(()=>{
            if (this._toggleSelectionFind.checked) {
                if (this._codeEditor.hasModel()) {
                    let selections = this._codeEditor.getSelections();
                    selections = selections.map((selection)=>{
                        if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) selection = selection.setEndPosition(selection.endLineNumber - 1, this._codeEditor.getModel().getLineMaxColumn(selection.endLineNumber - 1));
                        if (!selection.isEmpty()) return selection;
                        return null;
                    }).filter((element)=>!!element);
                    if (selections.length) this._state.change({
                        searchScope: selections
                    }, true);
                }
            } else this._state.change({
                searchScope: null
            }, true);
        }));
        actionsContainer.appendChild(this._toggleSelectionFind.domNode);
        // Close button
        this._closeBtn = this._register(new $5680bcb7e8208779$export$627052cf4bde93a4({
            label: $5680bcb7e8208779$var$NLS_CLOSE_BTN_LABEL + this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).CloseFindWidgetCommand),
            icon: (0, $hEsmQ.widgetClose),
            hoverDelegate: hoverDelegate,
            onTrigger: ()=>{
                this._state.change({
                    isRevealed: false,
                    searchScope: null
                }, false);
            },
            onKeyDown: (e)=>{
                if (e.equals(2 /* KeyCode.Tab */ )) {
                    if (this._isReplaceVisible) {
                        if (this._replaceBtn.isEnabled()) this._replaceBtn.focus();
                        else this._codeEditor.focus();
                        e.preventDefault();
                    }
                }
            }
        }, this._hoverService));
        // Replace input
        this._replaceInput = this._register(new (0, $36d223a3753fe003$export$da3bae0145835d60)(null, undefined, {
            label: $5680bcb7e8208779$var$NLS_REPLACE_INPUT_LABEL,
            placeholder: $5680bcb7e8208779$var$NLS_REPLACE_INPUT_PLACEHOLDER,
            appendPreserveCaseLabel: this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).TogglePreserveCaseCommand),
            history: [],
            flexibleHeight: flexibleHeight,
            flexibleWidth: flexibleWidth,
            flexibleMaxHeight: 118,
            showHistoryHint: ()=>(0, $4499d9bd118faeec$export$94614604caa08aab)(this._keybindingService),
            inputBoxStyles: (0, $l1XLO.defaultInputBoxStyles),
            toggleStyles: (0, $l1XLO.defaultToggleStyles)
        }, this._contextKeyService, true));
        this._replaceInput.setPreserveCase(!!this._state.preserveCase);
        this._register(this._replaceInput.onKeyDown((e)=>this._onReplaceInputKeyDown(e)));
        this._register(this._replaceInput.inputBox.onDidChange(()=>{
            this._state.change({
                replaceString: this._replaceInput.inputBox.value
            }, false);
        }));
        this._register(this._replaceInput.inputBox.onDidHeightChange((e)=>{
            if (this._isReplaceVisible && this._tryUpdateHeight()) this._showViewZone();
        }));
        this._register(this._replaceInput.onDidOptionChange(()=>{
            this._state.change({
                preserveCase: this._replaceInput.getPreserveCase()
            }, true);
        }));
        this._register(this._replaceInput.onPreserveCaseKeyDown((e)=>{
            if (e.equals(2 /* KeyCode.Tab */ )) {
                if (this._prevBtn.isEnabled()) this._prevBtn.focus();
                else if (this._nextBtn.isEnabled()) this._nextBtn.focus();
                else if (this._toggleSelectionFind.enabled) this._toggleSelectionFind.focus();
                else if (this._closeBtn.isEnabled()) this._closeBtn.focus();
                e.preventDefault();
            }
        }));
        // Create scoped hover delegate for replace actions
        const replaceHoverDelegate = this._register((0, $b97Zr.createInstantHoverDelegate)());
        // Replace one button
        this._replaceBtn = this._register(new $5680bcb7e8208779$export$627052cf4bde93a4({
            label: $5680bcb7e8208779$var$NLS_REPLACE_BTN_LABEL + this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ReplaceOneAction),
            icon: $5680bcb7e8208779$export$83ee554109a27042,
            hoverDelegate: replaceHoverDelegate,
            onTrigger: ()=>{
                this._controller.replace();
            },
            onKeyDown: (e)=>{
                if (e.equals(1026 /* KeyCode.Tab */ )) {
                    this._closeBtn.focus();
                    e.preventDefault();
                }
            }
        }, this._hoverService));
        // Replace all button
        this._replaceAllBtn = this._register(new $5680bcb7e8208779$export$627052cf4bde93a4({
            label: $5680bcb7e8208779$var$NLS_REPLACE_ALL_BTN_LABEL + this._keybindingLabelFor((0, $5f870f89a0356425$export$a4fc1be778636938).ReplaceAllAction),
            icon: $5680bcb7e8208779$export$9c63c939bdf63145,
            hoverDelegate: replaceHoverDelegate,
            onTrigger: ()=>{
                this._controller.replaceAll();
            }
        }, this._hoverService));
        const replacePart = document.createElement('div');
        replacePart.className = 'replace-part';
        replacePart.appendChild(this._replaceInput.domNode);
        const replaceActionsContainer = document.createElement('div');
        replaceActionsContainer.className = 'replace-actions';
        replacePart.appendChild(replaceActionsContainer);
        replaceActionsContainer.appendChild(this._replaceBtn.domNode);
        replaceActionsContainer.appendChild(this._replaceAllBtn.domNode);
        // Toggle replace button
        this._toggleReplaceBtn = this._register(new $5680bcb7e8208779$export$627052cf4bde93a4({
            label: $5680bcb7e8208779$var$NLS_TOGGLE_REPLACE_MODE_BTN_LABEL,
            className: 'codicon toggle left',
            onTrigger: ()=>{
                this._state.change({
                    isReplaceRevealed: !this._isReplaceVisible
                }, false);
                if (this._isReplaceVisible) {
                    this._replaceInput.width = $bDzmQ.getTotalWidth(this._findInput.domNode);
                    this._replaceInput.inputBox.layout();
                }
                this._showViewZone();
            }
        }, this._hoverService));
        this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);
        // Widget
        this._domNode = document.createElement('div');
        this._domNode.className = 'editor-widget find-widget';
        this._domNode.setAttribute('aria-hidden', 'true');
        this._domNode.ariaLabel = $5680bcb7e8208779$var$NLS_FIND_DIALOG_LABEL;
        this._domNode.role = 'dialog';
        // We need to set this explicitly, otherwise on IE11, the width inheritence of flex doesn't work.
        this._domNode.style.width = `${$5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH}px`;
        this._domNode.appendChild(this._toggleReplaceBtn.domNode);
        this._domNode.appendChild(findPart);
        this._domNode.appendChild(this._closeBtn.domNode);
        this._domNode.appendChild(replacePart);
        this._resizeSash = this._register(new (0, $9lxpu.Sash)(this._domNode, this, {
            orientation: 0 /* Orientation.VERTICAL */ ,
            size: 2
        }));
        this._resized = false;
        let originalWidth = $5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH;
        this._register(this._resizeSash.onDidStart(()=>{
            originalWidth = $bDzmQ.getTotalWidth(this._domNode);
        }));
        this._register(this._resizeSash.onDidChange((evt)=>{
            this._resized = true;
            const width = originalWidth + evt.startX - evt.currentX;
            if (width < $5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH) // narrow down the find widget should be handled by CSS.
            return;
            const maxWidth = parseFloat($bDzmQ.getComputedStyle(this._domNode).maxWidth) || 0;
            if (width > maxWidth) return;
            this._domNode.style.width = `${width}px`;
            if (this._isReplaceVisible) this._replaceInput.width = $bDzmQ.getTotalWidth(this._findInput.domNode);
            this._findInput.inputBox.layout();
            this._tryUpdateHeight();
        }));
        this._register(this._resizeSash.onDidReset(()=>{
            // users double click on the sash
            const currentWidth = $bDzmQ.getTotalWidth(this._domNode);
            if (currentWidth < $5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH) // The editor is narrow and the width of the find widget is controlled fully by CSS.
            return;
            let width = $5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH;
            if (!this._resized || currentWidth === $5680bcb7e8208779$var$FIND_WIDGET_INITIAL_WIDTH) {
                // 1. never resized before, double click should maximizes it
                // 2. users resized it already but its width is the same as default
                const layoutInfo = this._codeEditor.getLayoutInfo();
                width = layoutInfo.width - 28 - layoutInfo.minimap.minimapWidth - 15;
                this._resized = true;
            }
            this._domNode.style.width = `${width}px`;
            if (this._isReplaceVisible) this._replaceInput.width = $bDzmQ.getTotalWidth(this._findInput.domNode);
            this._findInput.inputBox.layout();
        }));
    }
    updateAccessibilitySupport() {
        const value = this._codeEditor.getOption(2 /* EditorOption.accessibilitySupport */ );
        this._findInput.setFocusInputOnOptionClick(value !== 2 /* AccessibilitySupport.Enabled */ );
    }
}
class $5680bcb7e8208779$export$627052cf4bde93a4 extends (0, $fxJYg.Widget) {
    constructor(opts, hoverService){
        super();
        this._opts = opts;
        let className = 'button';
        if (this._opts.className) className = className + ' ' + this._opts.className;
        if (this._opts.icon) className = className + ' ' + (0, $5rADe.ThemeIcon).asClassName(this._opts.icon);
        this._domNode = document.createElement('div');
        this._domNode.tabIndex = 0;
        this._domNode.className = className;
        this._domNode.setAttribute('role', 'button');
        this._domNode.setAttribute('aria-label', this._opts.label);
        this._register(hoverService.setupManagedHover(opts.hoverDelegate ?? (0, $b97Zr.getDefaultHoverDelegate)('element'), this._domNode, this._opts.label));
        this.onclick(this._domNode, (e)=>{
            this._opts.onTrigger();
            e.preventDefault();
        });
        this.onkeydown(this._domNode, (e)=>{
            if (e.equals(10 /* KeyCode.Space */ ) || e.equals(3 /* KeyCode.Enter */ )) {
                this._opts.onTrigger();
                e.preventDefault();
                return;
            }
            this._opts.onKeyDown?.(e);
        });
    }
    get domNode() {
        return this._domNode;
    }
    isEnabled() {
        return this._domNode.tabIndex >= 0;
    }
    focus() {
        this._domNode.focus();
    }
    setEnabled(enabled) {
        this._domNode.classList.toggle('disabled', !enabled);
        this._domNode.setAttribute('aria-disabled', String(!enabled));
        this._domNode.tabIndex = enabled ? 0 : -1;
    }
    setExpanded(expanded) {
        this._domNode.setAttribute('aria-expanded', String(!!expanded));
        if (expanded) {
            this._domNode.classList.remove(...(0, $5rADe.ThemeIcon).asClassNameArray($5680bcb7e8208779$var$findCollapsedIcon));
            this._domNode.classList.add(...(0, $5rADe.ThemeIcon).asClassNameArray($5680bcb7e8208779$var$findExpandedIcon));
        } else {
            this._domNode.classList.remove(...(0, $5rADe.ThemeIcon).asClassNameArray($5680bcb7e8208779$var$findExpandedIcon));
            this._domNode.classList.add(...(0, $5rADe.ThemeIcon).asClassNameArray($5680bcb7e8208779$var$findCollapsedIcon));
        }
    }
}
// theming
(0, $azIPz.registerThemingParticipant)((theme, collector)=>{
    const findMatchHighlightBorder = theme.getColor((0, $gaWeX.editorFindMatchHighlightBorder));
    if (findMatchHighlightBorder) collector.addRule(`.monaco-editor .findMatch { border: 1px ${(0, $95ky9.isHighContrast)(theme.type) ? 'dotted' : 'solid'} ${findMatchHighlightBorder}; box-sizing: border-box; }`);
    const findRangeHighlightBorder = theme.getColor((0, $gaWeX.editorFindRangeHighlightBorder));
    if (findRangeHighlightBorder) collector.addRule(`.monaco-editor .findScope { border: 1px ${(0, $95ky9.isHighContrast)(theme.type) ? 'dashed' : 'solid'} ${findRangeHighlightBorder}; }`);
    const hcBorder = theme.getColor((0, $gaWeX.contrastBorder));
    if (hcBorder) collector.addRule(`.monaco-editor .find-widget { border: 1px solid ${hcBorder}; }`);
    const findMatchForeground = theme.getColor((0, $gaWeX.editorFindMatchForeground));
    if (findMatchForeground) collector.addRule(`.monaco-editor .findMatchInline { color: ${findMatchForeground}; }`);
    const findMatchHighlightForeground = theme.getColor((0, $gaWeX.editorFindMatchHighlightForeground));
    if (findMatchHighlightForeground) collector.addRule(`.monaco-editor .currentFindMatchInline { color: ${findMatchHighlightForeground}; }`);
});



var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $8QSW4 = parcelRequire("8QSW4");

var $cxCeF = parcelRequire("cxCeF");

var $d6K7e = parcelRequire("d6K7e");

var $7IxGd = parcelRequire("7IxGd");

var $kCOKl = parcelRequire("kCOKl");

var $3XkzC = parcelRequire("3XkzC");

var $2AUoS = parcelRequire("2AUoS");

var $azIPz = parcelRequire("azIPz");

var $lc5DL = parcelRequire("lc5DL");
var $ccce32ec99de83e9$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $ccce32ec99de83e9$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $ccce32ec99de83e9$var$CommonFindController_1;
const $ccce32ec99de83e9$var$SEARCH_STRING_MAX_LENGTH = 524288;
function $ccce32ec99de83e9$export$422517c0cd4e3d9f(editor, seedSearchStringFromSelection = 'single', seedSearchStringFromNonEmptySelection = false) {
    if (!editor.hasModel()) return null;
    const selection = editor.getSelection();
    // if selection spans multiple lines, default search string to empty
    if (seedSearchStringFromSelection === 'single' && selection.startLineNumber === selection.endLineNumber || seedSearchStringFromSelection === 'multiple') {
        if (selection.isEmpty()) {
            const wordAtPosition = editor.getConfiguredWordAtPosition(selection.getStartPosition());
            if (wordAtPosition && false === seedSearchStringFromNonEmptySelection) return wordAtPosition.word;
        } else {
            if (editor.getModel().getValueLengthInRange(selection) < $ccce32ec99de83e9$var$SEARCH_STRING_MAX_LENGTH) return editor.getModel().getValueInRange(selection);
        }
    }
    return null;
}
let $ccce32ec99de83e9$export$3190f9a23ad62166 = class CommonFindController extends (0, $9cWcn.Disposable) {
    static{
        $ccce32ec99de83e9$var$CommonFindController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.findController';
    }
    get editor() {
        return this._editor;
    }
    static get(editor) {
        return editor.getContribution($ccce32ec99de83e9$var$CommonFindController_1.ID);
    }
    constructor(editor, contextKeyService, storageService, clipboardService, notificationService, hoverService){
        super();
        this._editor = editor;
        this._findWidgetVisible = (0, $5f870f89a0356425$export$bc27e4192c4ca2b8).bindTo(contextKeyService);
        this._contextKeyService = contextKeyService;
        this._storageService = storageService;
        this._clipboardService = clipboardService;
        this._notificationService = notificationService;
        this._hoverService = hoverService;
        this._updateHistoryDelayer = new (0, $6bXyA.Delayer)(500);
        this._state = this._register(new (0, $18fac37ef2468281$export$134b1d8b9bc10076)());
        this.loadQueryState();
        this._register(this._state.onFindReplaceStateChange((e)=>this._onStateChanged(e)));
        this._model = null;
        this._register(this._editor.onDidChangeModel(()=>{
            const shouldRestartFind = this._editor.getModel() && this._state.isRevealed;
            this.disposeModel();
            this._state.change({
                searchScope: null,
                matchCase: this._storageService.getBoolean('editor.matchCase', 1 /* StorageScope.WORKSPACE */ , false),
                wholeWord: this._storageService.getBoolean('editor.wholeWord', 1 /* StorageScope.WORKSPACE */ , false),
                isRegex: this._storageService.getBoolean('editor.isRegex', 1 /* StorageScope.WORKSPACE */ , false),
                preserveCase: this._storageService.getBoolean('editor.preserveCase', 1 /* StorageScope.WORKSPACE */ , false)
            }, false);
            if (shouldRestartFind) this._start({
                forceRevealReplace: false,
                seedSearchStringFromSelection: 'none',
                seedSearchStringFromNonEmptySelection: false,
                seedSearchStringFromGlobalClipboard: false,
                shouldFocus: 0 /* FindStartFocusAction.NoFocusChange */ ,
                shouldAnimate: false,
                updateSearchScope: false,
                loop: this._editor.getOption(41 /* EditorOption.find */ ).loop
            });
        }));
    }
    dispose() {
        this.disposeModel();
        super.dispose();
    }
    disposeModel() {
        if (this._model) {
            this._model.dispose();
            this._model = null;
        }
    }
    _onStateChanged(e) {
        this.saveQueryState(e);
        if (e.isRevealed) {
            if (this._state.isRevealed) this._findWidgetVisible.set(true);
            else {
                this._findWidgetVisible.reset();
                this.disposeModel();
            }
        }
        if (e.searchString) this.setGlobalBufferTerm(this._state.searchString);
    }
    saveQueryState(e) {
        if (e.isRegex) this._storageService.store('editor.isRegex', this._state.actualIsRegex, 1 /* StorageScope.WORKSPACE */ , 1 /* StorageTarget.MACHINE */ );
        if (e.wholeWord) this._storageService.store('editor.wholeWord', this._state.actualWholeWord, 1 /* StorageScope.WORKSPACE */ , 1 /* StorageTarget.MACHINE */ );
        if (e.matchCase) this._storageService.store('editor.matchCase', this._state.actualMatchCase, 1 /* StorageScope.WORKSPACE */ , 1 /* StorageTarget.MACHINE */ );
        if (e.preserveCase) this._storageService.store('editor.preserveCase', this._state.actualPreserveCase, 1 /* StorageScope.WORKSPACE */ , 1 /* StorageTarget.MACHINE */ );
    }
    loadQueryState() {
        this._state.change({
            matchCase: this._storageService.getBoolean('editor.matchCase', 1 /* StorageScope.WORKSPACE */ , this._state.matchCase),
            wholeWord: this._storageService.getBoolean('editor.wholeWord', 1 /* StorageScope.WORKSPACE */ , this._state.wholeWord),
            isRegex: this._storageService.getBoolean('editor.isRegex', 1 /* StorageScope.WORKSPACE */ , this._state.isRegex),
            preserveCase: this._storageService.getBoolean('editor.preserveCase', 1 /* StorageScope.WORKSPACE */ , this._state.preserveCase)
        }, false);
    }
    isFindInputFocused() {
        return !!(0, $5f870f89a0356425$export$1bcc3ed82148a8b9).getValue(this._contextKeyService);
    }
    getState() {
        return this._state;
    }
    closeFindWidget() {
        this._state.change({
            isRevealed: false,
            searchScope: null
        }, false);
        this._editor.focus();
    }
    toggleCaseSensitive() {
        this._state.change({
            matchCase: !this._state.matchCase
        }, false);
        if (!this._state.isRevealed) this.highlightFindOptions();
    }
    toggleWholeWords() {
        this._state.change({
            wholeWord: !this._state.wholeWord
        }, false);
        if (!this._state.isRevealed) this.highlightFindOptions();
    }
    toggleRegex() {
        this._state.change({
            isRegex: !this._state.isRegex
        }, false);
        if (!this._state.isRevealed) this.highlightFindOptions();
    }
    togglePreserveCase() {
        this._state.change({
            preserveCase: !this._state.preserveCase
        }, false);
        if (!this._state.isRevealed) this.highlightFindOptions();
    }
    toggleSearchScope() {
        if (this._state.searchScope) this._state.change({
            searchScope: null
        }, true);
        else if (this._editor.hasModel()) {
            let selections = this._editor.getSelections();
            selections = selections.map((selection)=>{
                if (selection.endColumn === 1 && selection.endLineNumber > selection.startLineNumber) selection = selection.setEndPosition(selection.endLineNumber - 1, this._editor.getModel().getLineMaxColumn(selection.endLineNumber - 1));
                if (!selection.isEmpty()) return selection;
                return null;
            }).filter((element)=>!!element);
            if (selections.length) this._state.change({
                searchScope: selections
            }, true);
        }
    }
    setSearchString(searchString) {
        if (this._state.isRegex) searchString = $jcr1R.escapeRegExpCharacters(searchString);
        this._state.change({
            searchString: searchString
        }, false);
    }
    highlightFindOptions(ignoreWhenVisible = false) {
    // overwritten in subclass
    }
    async _start(opts, newState) {
        this.disposeModel();
        if (!this._editor.hasModel()) // cannot do anything with an editor that doesn't have a model...
        return;
        const stateChanges = {
            ...newState,
            isRevealed: true
        };
        if (opts.seedSearchStringFromSelection === 'single') {
            const selectionSearchString = $ccce32ec99de83e9$export$422517c0cd4e3d9f(this._editor, opts.seedSearchStringFromSelection, opts.seedSearchStringFromNonEmptySelection);
            if (selectionSearchString) {
                if (this._state.isRegex) stateChanges.searchString = $jcr1R.escapeRegExpCharacters(selectionSearchString);
                else stateChanges.searchString = selectionSearchString;
            }
        } else if (opts.seedSearchStringFromSelection === 'multiple' && !opts.updateSearchScope) {
            const selectionSearchString = $ccce32ec99de83e9$export$422517c0cd4e3d9f(this._editor, opts.seedSearchStringFromSelection);
            if (selectionSearchString) stateChanges.searchString = selectionSearchString;
        }
        if (!stateChanges.searchString && opts.seedSearchStringFromGlobalClipboard) {
            const selectionSearchString = await this.getGlobalBufferTerm();
            if (!this._editor.hasModel()) // the editor has lost its model in the meantime
            return;
            if (selectionSearchString) stateChanges.searchString = selectionSearchString;
        }
        // Overwrite isReplaceRevealed
        if (opts.forceRevealReplace || stateChanges.isReplaceRevealed) stateChanges.isReplaceRevealed = true;
        else if (!this._findWidgetVisible.get()) stateChanges.isReplaceRevealed = false;
        if (opts.updateSearchScope) {
            const currentSelections = this._editor.getSelections();
            if (currentSelections.some((selection)=>!selection.isEmpty())) stateChanges.searchScope = currentSelections;
        }
        stateChanges.loop = opts.loop;
        this._state.change(stateChanges, false);
        if (!this._model) this._model = new (0, $5f870f89a0356425$export$2aaa4f42000d804d)(this._editor, this._state);
    }
    start(opts, newState) {
        return this._start(opts, newState);
    }
    moveToNextMatch() {
        if (this._model) {
            this._model.moveToNextMatch();
            return true;
        }
        return false;
    }
    moveToPrevMatch() {
        if (this._model) {
            this._model.moveToPrevMatch();
            return true;
        }
        return false;
    }
    goToMatch(index) {
        if (this._model) {
            this._model.moveToMatch(index);
            return true;
        }
        return false;
    }
    replace() {
        if (this._model) {
            this._model.replace();
            return true;
        }
        return false;
    }
    replaceAll() {
        if (this._model) {
            if (this._editor.getModel()?.isTooLargeForHeapOperation()) {
                this._notificationService.warn($4dEdH.localize('too.large.for.replaceall', "The file is too large to perform a replace all operation."));
                return false;
            }
            this._model.replaceAll();
            return true;
        }
        return false;
    }
    selectAllMatches() {
        if (this._model) {
            this._model.selectAllMatches();
            this._editor.focus();
            return true;
        }
        return false;
    }
    async getGlobalBufferTerm() {
        if (this._editor.getOption(41 /* EditorOption.find */ ).globalFindClipboard && this._editor.hasModel() && !this._editor.getModel().isTooLargeForSyncing()) return this._clipboardService.readFindText();
        return '';
    }
    setGlobalBufferTerm(text) {
        if (this._editor.getOption(41 /* EditorOption.find */ ).globalFindClipboard && this._editor.hasModel() && !this._editor.getModel().isTooLargeForSyncing()) // intentionally not awaited
        this._clipboardService.writeFindText(text);
    }
};
$ccce32ec99de83e9$export$3190f9a23ad62166 = $ccce32ec99de83e9$var$CommonFindController_1 = $ccce32ec99de83e9$var$__decorate([
    $ccce32ec99de83e9$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $ccce32ec99de83e9$var$__param(2, (0, $2AUoS.IStorageService)),
    $ccce32ec99de83e9$var$__param(3, (0, $8QSW4.IClipboardService)),
    $ccce32ec99de83e9$var$__param(4, (0, $kCOKl.INotificationService)),
    $ccce32ec99de83e9$var$__param(5, (0, $lc5DL.IHoverService))
], $ccce32ec99de83e9$export$3190f9a23ad62166);
let $ccce32ec99de83e9$export$dbc27728234951c5 = class FindController extends $ccce32ec99de83e9$export$3190f9a23ad62166 {
    constructor(editor, _contextViewService, _contextKeyService, _keybindingService, _themeService, notificationService, _storageService, clipboardService, hoverService){
        super(editor, _contextKeyService, _storageService, clipboardService, notificationService, hoverService);
        this._contextViewService = _contextViewService;
        this._keybindingService = _keybindingService;
        this._themeService = _themeService;
        this._widget = null;
        this._findOptionsWidget = null;
    }
    async _start(opts, newState) {
        if (!this._widget) this._createFindWidget();
        const selection = this._editor.getSelection();
        let updateSearchScope = false;
        switch(this._editor.getOption(41 /* EditorOption.find */ ).autoFindInSelection){
            case 'always':
                updateSearchScope = true;
                break;
            case 'never':
                updateSearchScope = false;
                break;
            case 'multiline':
                {
                    const isSelectionMultipleLine = !!selection && selection.startLineNumber !== selection.endLineNumber;
                    updateSearchScope = isSelectionMultipleLine;
                    break;
                }
            default:
                break;
        }
        opts.updateSearchScope = opts.updateSearchScope || updateSearchScope;
        await super._start(opts, newState);
        if (this._widget) {
            if (opts.shouldFocus === 2 /* FindStartFocusAction.FocusReplaceInput */ ) this._widget.focusReplaceInput();
            else if (opts.shouldFocus === 1 /* FindStartFocusAction.FocusFindInput */ ) this._widget.focusFindInput();
        }
    }
    highlightFindOptions(ignoreWhenVisible = false) {
        if (!this._widget) this._createFindWidget();
        if (this._state.isRevealed && !ignoreWhenVisible) this._widget.highlightFindOptions();
        else this._findOptionsWidget.highlightFindOptions();
    }
    _createFindWidget() {
        this._widget = this._register(new (0, $5680bcb7e8208779$export$94cf213bcf83d48e)(this._editor, this, this._state, this._contextViewService, this._keybindingService, this._contextKeyService, this._themeService, this._storageService, this._notificationService, this._hoverService));
        this._findOptionsWidget = this._register(new (0, $ec60578d0867c64a$export$2ff720b27319038e)(this._editor, this._state, this._keybindingService));
    }
};
$ccce32ec99de83e9$export$dbc27728234951c5 = $ccce32ec99de83e9$var$__decorate([
    $ccce32ec99de83e9$var$__param(1, (0, $d6K7e.IContextViewService)),
    $ccce32ec99de83e9$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $ccce32ec99de83e9$var$__param(3, (0, $7IxGd.IKeybindingService)),
    $ccce32ec99de83e9$var$__param(4, (0, $azIPz.IThemeService)),
    $ccce32ec99de83e9$var$__param(5, (0, $kCOKl.INotificationService)),
    $ccce32ec99de83e9$var$__param(6, (0, $2AUoS.IStorageService)),
    $ccce32ec99de83e9$var$__param(7, (0, $8QSW4.IClipboardService)),
    $ccce32ec99de83e9$var$__param(8, (0, $lc5DL.IHoverService))
], $ccce32ec99de83e9$export$dbc27728234951c5);
const $ccce32ec99de83e9$export$ad7d9d55cc8c7ec4 = (0, $2iJTi.registerMultiEditorAction)(new (0, $2iJTi.MultiEditorAction)({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).StartFindAction,
    label: $4dEdH.localize('startFindAction', "Find"),
    alias: 'Find',
    precondition: (0, $cxCeF.ContextKeyExpr).or((0, $ibKGQ.EditorContextKeys).focus, (0, $cxCeF.ContextKeyExpr).has('editorIsOpen')),
    kbOpts: {
        kbExpr: null,
        primary: 2084 /* KeyCode.KeyF */ ,
        weight: 100 /* KeybindingWeight.EditorContrib */ 
    },
    menuOpts: {
        menuId: (0, $g4v7E.MenuId).MenubarEditMenu,
        group: '3_find',
        title: $4dEdH.localize({
            key: 'miFind',
            comment: [
                '&& denotes a mnemonic'
            ]
        }, "&&Find"),
        order: 1
    }
}));
$ccce32ec99de83e9$export$ad7d9d55cc8c7ec4.addImplementation(0, (accessor, editor, args)=>{
    const controller = $ccce32ec99de83e9$export$3190f9a23ad62166.get(editor);
    if (!controller) return false;
    return controller.start({
        forceRevealReplace: false,
        seedSearchStringFromSelection: editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection !== 'never' ? 'single' : 'none',
        seedSearchStringFromNonEmptySelection: editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection === 'selection',
        seedSearchStringFromGlobalClipboard: editor.getOption(41 /* EditorOption.find */ ).globalFindClipboard,
        shouldFocus: 1 /* FindStartFocusAction.FocusFindInput */ ,
        shouldAnimate: true,
        updateSearchScope: false,
        loop: editor.getOption(41 /* EditorOption.find */ ).loop
    });
});
const $ccce32ec99de83e9$var$findArgDescription = {
    description: 'Open a new In-Editor Find Widget.',
    args: [
        {
            name: 'Open a new In-Editor Find Widget args',
            schema: {
                properties: {
                    searchString: {
                        type: 'string'
                    },
                    replaceString: {
                        type: 'string'
                    },
                    isRegex: {
                        type: 'boolean'
                    },
                    matchWholeWord: {
                        type: 'boolean'
                    },
                    isCaseSensitive: {
                        type: 'boolean'
                    },
                    preserveCase: {
                        type: 'boolean'
                    },
                    findInSelection: {
                        type: 'boolean'
                    }
                }
            }
        }
    ]
};
class $ccce32ec99de83e9$export$50897d92f96d7044 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $5f870f89a0356425$export$a4fc1be778636938).StartFindWithArgs,
            label: $4dEdH.localize('startFindWithArgsAction', "Find With Arguments"),
            alias: 'Find With Arguments',
            precondition: undefined,
            kbOpts: {
                kbExpr: null,
                primary: 0,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: $ccce32ec99de83e9$var$findArgDescription
        });
    }
    async run(accessor, editor, args) {
        const controller = $ccce32ec99de83e9$export$3190f9a23ad62166.get(editor);
        if (controller) {
            const newState = args ? {
                searchString: args.searchString,
                replaceString: args.replaceString,
                isReplaceRevealed: args.replaceString !== undefined,
                isRegex: args.isRegex,
                // isRegexOverride: args.regexOverride,
                wholeWord: args.matchWholeWord,
                // wholeWordOverride: args.wholeWordOverride,
                matchCase: args.isCaseSensitive,
                // matchCaseOverride: args.matchCaseOverride,
                preserveCase: args.preserveCase
            } : {};
            await controller.start({
                forceRevealReplace: false,
                seedSearchStringFromSelection: controller.getState().searchString.length === 0 && editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection !== 'never' ? 'single' : 'none',
                seedSearchStringFromNonEmptySelection: editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection === 'selection',
                seedSearchStringFromGlobalClipboard: true,
                shouldFocus: 1 /* FindStartFocusAction.FocusFindInput */ ,
                shouldAnimate: true,
                updateSearchScope: args?.findInSelection || false,
                loop: editor.getOption(41 /* EditorOption.find */ ).loop
            }, newState);
            controller.setGlobalBufferTerm(controller.getState().searchString);
        }
    }
}
class $ccce32ec99de83e9$export$10b87301fa70db4b extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $5f870f89a0356425$export$a4fc1be778636938).StartFindWithSelection,
            label: $4dEdH.localize('startFindWithSelectionAction', "Find With Selection"),
            alias: 'Find With Selection',
            precondition: undefined,
            kbOpts: {
                kbExpr: null,
                primary: 0,
                mac: {
                    primary: 2083 /* KeyCode.KeyE */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    async run(accessor, editor) {
        const controller = $ccce32ec99de83e9$export$3190f9a23ad62166.get(editor);
        if (controller) {
            await controller.start({
                forceRevealReplace: false,
                seedSearchStringFromSelection: 'multiple',
                seedSearchStringFromNonEmptySelection: false,
                seedSearchStringFromGlobalClipboard: false,
                shouldFocus: 0 /* FindStartFocusAction.NoFocusChange */ ,
                shouldAnimate: true,
                updateSearchScope: false,
                loop: editor.getOption(41 /* EditorOption.find */ ).loop
            });
            controller.setGlobalBufferTerm(controller.getState().searchString);
        }
    }
}
class $ccce32ec99de83e9$export$c8e1d3a731dd2486 extends (0, $2iJTi.EditorAction) {
    async run(accessor, editor) {
        const controller = $ccce32ec99de83e9$export$3190f9a23ad62166.get(editor);
        if (controller && !this._run(controller)) {
            await controller.start({
                forceRevealReplace: false,
                seedSearchStringFromSelection: controller.getState().searchString.length === 0 && editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection !== 'never' ? 'single' : 'none',
                seedSearchStringFromNonEmptySelection: editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection === 'selection',
                seedSearchStringFromGlobalClipboard: true,
                shouldFocus: 0 /* FindStartFocusAction.NoFocusChange */ ,
                shouldAnimate: true,
                updateSearchScope: false,
                loop: editor.getOption(41 /* EditorOption.find */ ).loop
            });
            this._run(controller);
        }
    }
}
class $ccce32ec99de83e9$export$bb259a3f5c713849 extends $ccce32ec99de83e9$export$c8e1d3a731dd2486 {
    constructor(){
        super({
            id: (0, $5f870f89a0356425$export$a4fc1be778636938).NextMatchFindAction,
            label: $4dEdH.localize('findNextMatchAction', "Find Next"),
            alias: 'Find Next',
            precondition: undefined,
            kbOpts: [
                {
                    kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                    primary: 61 /* KeyCode.F3 */ ,
                    mac: {
                        primary: 2085 /* KeyCode.KeyG */ ,
                        secondary: [
                            61 /* KeyCode.F3 */ 
                        ]
                    },
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                },
                {
                    kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).focus, (0, $5f870f89a0356425$export$1bcc3ed82148a8b9)),
                    primary: 3 /* KeyCode.Enter */ ,
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                }
            ]
        });
    }
    _run(controller) {
        const result = controller.moveToNextMatch();
        if (result) {
            controller.editor.pushUndoStop();
            return true;
        }
        return false;
    }
}
class $ccce32ec99de83e9$export$8a68aa4082c051b6 extends $ccce32ec99de83e9$export$c8e1d3a731dd2486 {
    constructor(){
        super({
            id: (0, $5f870f89a0356425$export$a4fc1be778636938).PreviousMatchFindAction,
            label: $4dEdH.localize('findPreviousMatchAction', "Find Previous"),
            alias: 'Find Previous',
            precondition: undefined,
            kbOpts: [
                {
                    kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                    primary: 1085 /* KeyCode.F3 */ ,
                    mac: {
                        primary: 3109 /* KeyCode.KeyG */ ,
                        secondary: [
                            1085 /* KeyCode.F3 */ 
                        ]
                    },
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                },
                {
                    kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).focus, (0, $5f870f89a0356425$export$1bcc3ed82148a8b9)),
                    primary: 1027 /* KeyCode.Enter */ ,
                    weight: 100 /* KeybindingWeight.EditorContrib */ 
                }
            ]
        });
    }
    _run(controller) {
        return controller.moveToPrevMatch();
    }
}
class $ccce32ec99de83e9$export$8b9338537a27ae23 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $5f870f89a0356425$export$a4fc1be778636938).GoToMatchFindAction,
            label: $4dEdH.localize('findMatchAction.goToMatch', "Go to Match..."),
            alias: 'Go to Match...',
            precondition: (0, $5f870f89a0356425$export$bc27e4192c4ca2b8)
        });
        this._highlightDecorations = [];
    }
    run(accessor, editor, args) {
        const controller = $ccce32ec99de83e9$export$3190f9a23ad62166.get(editor);
        if (!controller) return;
        const matchesCount = controller.getState().matchesCount;
        if (matchesCount < 1) {
            const notificationService = accessor.get((0, $kCOKl.INotificationService));
            notificationService.notify({
                severity: (0, $kCOKl.Severity).Warning,
                message: $4dEdH.localize('findMatchAction.noResults', "No matches. Try searching for something else.")
            });
            return;
        }
        const quickInputService = accessor.get((0, $3XkzC.IQuickInputService));
        const disposables = new (0, $9cWcn.DisposableStore)();
        const inputBox = disposables.add(quickInputService.createInputBox());
        inputBox.placeholder = $4dEdH.localize('findMatchAction.inputPlaceHolder', "Type a number to go to a specific match (between 1 and {0})", matchesCount);
        const toFindMatchIndex = (value)=>{
            const index = parseInt(value);
            if (isNaN(index)) return undefined;
            const matchCount = controller.getState().matchesCount;
            if (index > 0 && index <= matchCount) return index - 1; // zero based
            else if (index < 0 && index >= -matchCount) return matchCount + index;
            return undefined;
        };
        const updatePickerAndEditor = (value)=>{
            const index = toFindMatchIndex(value);
            if (typeof index === 'number') {
                // valid
                inputBox.validationMessage = undefined;
                controller.goToMatch(index);
                const currentMatch = controller.getState().currentMatch;
                if (currentMatch) this.addDecorations(editor, currentMatch);
            } else {
                inputBox.validationMessage = $4dEdH.localize('findMatchAction.inputValidationMessage', "Please type a number between 1 and {0}", controller.getState().matchesCount);
                this.clearDecorations(editor);
            }
        };
        disposables.add(inputBox.onDidChangeValue((value)=>{
            updatePickerAndEditor(value);
        }));
        disposables.add(inputBox.onDidAccept(()=>{
            const index = toFindMatchIndex(inputBox.value);
            if (typeof index === 'number') {
                controller.goToMatch(index);
                inputBox.hide();
            } else inputBox.validationMessage = $4dEdH.localize('findMatchAction.inputValidationMessage', "Please type a number between 1 and {0}", controller.getState().matchesCount);
        }));
        disposables.add(inputBox.onDidHide(()=>{
            this.clearDecorations(editor);
            disposables.dispose();
        }));
        inputBox.show();
    }
    clearDecorations(editor) {
        editor.changeDecorations((changeAccessor)=>{
            this._highlightDecorations = changeAccessor.deltaDecorations(this._highlightDecorations, []);
        });
    }
    addDecorations(editor, range) {
        editor.changeDecorations((changeAccessor)=>{
            this._highlightDecorations = changeAccessor.deltaDecorations(this._highlightDecorations, [
                {
                    range: range,
                    options: {
                        description: 'find-match-quick-access-range-highlight',
                        className: 'rangeHighlight',
                        isWholeLine: true
                    }
                },
                {
                    range: range,
                    options: {
                        description: 'find-match-quick-access-range-highlight-overview',
                        overviewRuler: {
                            color: (0, $azIPz.themeColorFromId)((0, $cw0ys.overviewRulerRangeHighlight)),
                            position: (0, $1Y4vr.OverviewRulerLane).Full
                        }
                    }
                }
            ]);
        });
    }
}
class $ccce32ec99de83e9$export$f33491a7c7af78c3 extends (0, $2iJTi.EditorAction) {
    async run(accessor, editor) {
        const controller = $ccce32ec99de83e9$export$3190f9a23ad62166.get(editor);
        if (!controller) return;
        const selectionSearchString = $ccce32ec99de83e9$export$422517c0cd4e3d9f(editor, 'single', false);
        if (selectionSearchString) controller.setSearchString(selectionSearchString);
        if (!this._run(controller)) {
            await controller.start({
                forceRevealReplace: false,
                seedSearchStringFromSelection: 'none',
                seedSearchStringFromNonEmptySelection: false,
                seedSearchStringFromGlobalClipboard: false,
                shouldFocus: 0 /* FindStartFocusAction.NoFocusChange */ ,
                shouldAnimate: true,
                updateSearchScope: false,
                loop: editor.getOption(41 /* EditorOption.find */ ).loop
            });
            this._run(controller);
        }
    }
}
class $ccce32ec99de83e9$export$8d1cf515c2a7b450 extends $ccce32ec99de83e9$export$f33491a7c7af78c3 {
    constructor(){
        super({
            id: (0, $5f870f89a0356425$export$a4fc1be778636938).NextSelectionMatchFindAction,
            label: $4dEdH.localize('nextSelectionMatchFindAction', "Find Next Selection"),
            alias: 'Find Next Selection',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 2109 /* KeyCode.F3 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    _run(controller) {
        return controller.moveToNextMatch();
    }
}
class $ccce32ec99de83e9$export$d9df193ecc80bb53 extends $ccce32ec99de83e9$export$f33491a7c7af78c3 {
    constructor(){
        super({
            id: (0, $5f870f89a0356425$export$a4fc1be778636938).PreviousSelectionMatchFindAction,
            label: $4dEdH.localize('previousSelectionMatchFindAction', "Find Previous Selection"),
            alias: 'Find Previous Selection',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 3133 /* KeyCode.F3 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    _run(controller) {
        return controller.moveToPrevMatch();
    }
}
const $ccce32ec99de83e9$export$134326ec389b328d = (0, $2iJTi.registerMultiEditorAction)(new (0, $2iJTi.MultiEditorAction)({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).StartFindReplaceAction,
    label: $4dEdH.localize('startReplace', "Replace"),
    alias: 'Replace',
    precondition: (0, $cxCeF.ContextKeyExpr).or((0, $ibKGQ.EditorContextKeys).focus, (0, $cxCeF.ContextKeyExpr).has('editorIsOpen')),
    kbOpts: {
        kbExpr: null,
        primary: 2086 /* KeyCode.KeyH */ ,
        mac: {
            primary: 2596 /* KeyCode.KeyF */ 
        },
        weight: 100 /* KeybindingWeight.EditorContrib */ 
    },
    menuOpts: {
        menuId: (0, $g4v7E.MenuId).MenubarEditMenu,
        group: '3_find',
        title: $4dEdH.localize({
            key: 'miReplace',
            comment: [
                '&& denotes a mnemonic'
            ]
        }, "&&Replace"),
        order: 2
    }
}));
$ccce32ec99de83e9$export$134326ec389b328d.addImplementation(0, (accessor, editor, args)=>{
    if (!editor.hasModel() || editor.getOption(92 /* EditorOption.readOnly */ )) return false;
    const controller = $ccce32ec99de83e9$export$3190f9a23ad62166.get(editor);
    if (!controller) return false;
    const currentSelection = editor.getSelection();
    const findInputFocused = controller.isFindInputFocused();
    // we only seed search string from selection when the current selection is single line and not empty,
    // + the find input is not focused
    const seedSearchStringFromSelection = !currentSelection.isEmpty() && currentSelection.startLineNumber === currentSelection.endLineNumber && editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection !== 'never' && !findInputFocused;
    /*
    * if the existing search string in find widget is empty and we don't seed search string from selection, it means the Find Input is still empty, so we should focus the Find Input instead of Replace Input.

    * findInputFocused true -> seedSearchStringFromSelection false, FocusReplaceInput
    * findInputFocused false, seedSearchStringFromSelection true FocusReplaceInput
    * findInputFocused false seedSearchStringFromSelection false FocusFindInput
    */ const shouldFocus = findInputFocused || seedSearchStringFromSelection ? 2 /* FindStartFocusAction.FocusReplaceInput */  : 1 /* FindStartFocusAction.FocusFindInput */ ;
    return controller.start({
        forceRevealReplace: true,
        seedSearchStringFromSelection: seedSearchStringFromSelection ? 'single' : 'none',
        seedSearchStringFromNonEmptySelection: editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection === 'selection',
        seedSearchStringFromGlobalClipboard: editor.getOption(41 /* EditorOption.find */ ).seedSearchStringFromSelection !== 'never',
        shouldFocus: shouldFocus,
        shouldAnimate: true,
        updateSearchScope: false,
        loop: editor.getOption(41 /* EditorOption.find */ ).loop
    });
});
(0, $2iJTi.registerEditorContribution)($ccce32ec99de83e9$export$3190f9a23ad62166.ID, $ccce32ec99de83e9$export$dbc27728234951c5, 0 /* EditorContributionInstantiation.Eager */ ); // eager because it uses `saveViewState`/`restoreViewState`
(0, $2iJTi.registerEditorAction)($ccce32ec99de83e9$export$50897d92f96d7044);
(0, $2iJTi.registerEditorAction)($ccce32ec99de83e9$export$10b87301fa70db4b);
(0, $2iJTi.registerEditorAction)($ccce32ec99de83e9$export$bb259a3f5c713849);
(0, $2iJTi.registerEditorAction)($ccce32ec99de83e9$export$8a68aa4082c051b6);
(0, $2iJTi.registerEditorAction)($ccce32ec99de83e9$export$8b9338537a27ae23);
(0, $2iJTi.registerEditorAction)($ccce32ec99de83e9$export$8d1cf515c2a7b450);
(0, $2iJTi.registerEditorAction)($ccce32ec99de83e9$export$d9df193ecc80bb53);
const $ccce32ec99de83e9$var$FindCommand = (0, $2iJTi.EditorCommand).bindToContribution($ccce32ec99de83e9$export$3190f9a23ad62166.get);
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).CloseFindWidgetCommand,
    precondition: (0, $5f870f89a0356425$export$bc27e4192c4ca2b8),
    handler: (x)=>x.closeFindWidget(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).focus, (0, $cxCeF.ContextKeyExpr).not('isComposing')),
        primary: 9 /* KeyCode.Escape */ ,
        secondary: [
            1033 /* KeyCode.Escape */ 
        ]
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ToggleCaseSensitiveCommand,
    precondition: undefined,
    handler: (x)=>x.toggleCaseSensitive(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: (0, $5f870f89a0356425$export$2fe068521df792d6).primary,
        mac: (0, $5f870f89a0356425$export$2fe068521df792d6).mac,
        win: (0, $5f870f89a0356425$export$2fe068521df792d6).win,
        linux: (0, $5f870f89a0356425$export$2fe068521df792d6).linux
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ToggleWholeWordCommand,
    precondition: undefined,
    handler: (x)=>x.toggleWholeWords(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: (0, $5f870f89a0356425$export$cc2b8eb9ab15ca30).primary,
        mac: (0, $5f870f89a0356425$export$cc2b8eb9ab15ca30).mac,
        win: (0, $5f870f89a0356425$export$cc2b8eb9ab15ca30).win,
        linux: (0, $5f870f89a0356425$export$cc2b8eb9ab15ca30).linux
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ToggleRegexCommand,
    precondition: undefined,
    handler: (x)=>x.toggleRegex(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: (0, $5f870f89a0356425$export$7c479f7cdbb6d55e).primary,
        mac: (0, $5f870f89a0356425$export$7c479f7cdbb6d55e).mac,
        win: (0, $5f870f89a0356425$export$7c479f7cdbb6d55e).win,
        linux: (0, $5f870f89a0356425$export$7c479f7cdbb6d55e).linux
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ToggleSearchScopeCommand,
    precondition: undefined,
    handler: (x)=>x.toggleSearchScope(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: (0, $5f870f89a0356425$export$a02b1f674b6f16d3).primary,
        mac: (0, $5f870f89a0356425$export$a02b1f674b6f16d3).mac,
        win: (0, $5f870f89a0356425$export$a02b1f674b6f16d3).win,
        linux: (0, $5f870f89a0356425$export$a02b1f674b6f16d3).linux
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).TogglePreserveCaseCommand,
    precondition: undefined,
    handler: (x)=>x.togglePreserveCase(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: (0, $5f870f89a0356425$export$68ae9fdc5844d61a).primary,
        mac: (0, $5f870f89a0356425$export$68ae9fdc5844d61a).mac,
        win: (0, $5f870f89a0356425$export$68ae9fdc5844d61a).win,
        linux: (0, $5f870f89a0356425$export$68ae9fdc5844d61a).linux
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ReplaceOneAction,
    precondition: (0, $5f870f89a0356425$export$bc27e4192c4ca2b8),
    handler: (x)=>x.replace(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 3094 /* KeyCode.Digit1 */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ReplaceOneAction,
    precondition: (0, $5f870f89a0356425$export$bc27e4192c4ca2b8),
    handler: (x)=>x.replace(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).focus, (0, $5f870f89a0356425$export$1b9f123cc9b71d78)),
        primary: 3 /* KeyCode.Enter */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ReplaceAllAction,
    precondition: (0, $5f870f89a0356425$export$bc27e4192c4ca2b8),
    handler: (x)=>x.replaceAll(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 2563 /* KeyCode.Enter */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).ReplaceAllAction,
    precondition: (0, $5f870f89a0356425$export$bc27e4192c4ca2b8),
    handler: (x)=>x.replaceAll(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).focus, (0, $5f870f89a0356425$export$1b9f123cc9b71d78)),
        primary: undefined,
        mac: {
            primary: 2051 /* KeyCode.Enter */ 
        }
    }
}));
(0, $2iJTi.registerEditorCommand)(new $ccce32ec99de83e9$var$FindCommand({
    id: (0, $5f870f89a0356425$export$a4fc1be778636938).SelectAllMatchesAction,
    precondition: (0, $5f870f89a0356425$export$bc27e4192c4ca2b8),
    handler: (x)=>x.selectAllMatches(),
    kbOpts: {
        weight: 105,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 515 /* KeyCode.Enter */ 
    }
}));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $fuc8X = parcelRequire("fuc8X");

var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $bxBg7 = parcelRequire("bxBg7");


var $1RlHY = parcelRequire("1RlHY");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $kzNQX = parcelRequire("kzNQX");

var $1qkuR = parcelRequire("1qkuR");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5YaSO = parcelRequire("5YaSO");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ const $8c013aba2f73f7e1$export$d7951322d01a638a = {
    [0 /* FoldSource.provider */ ]: ' ',
    [1 /* FoldSource.userDefined */ ]: 'u',
    [2 /* FoldSource.recovered */ ]: 'r'
};
const $8c013aba2f73f7e1$export$4dac98cf97cec411 = 0xFFFF;
const $8c013aba2f73f7e1$export$ccaa8b63109dc601 = 0xFFFFFF;
const $8c013aba2f73f7e1$var$MASK_INDENT = 0xFF000000;
class $8c013aba2f73f7e1$var$BitField {
    constructor(size){
        const numWords = Math.ceil(size / 32);
        this._states = new Uint32Array(numWords);
    }
    get(index) {
        const arrayIndex = index / 32 | 0;
        const bit = index % 32;
        return (this._states[arrayIndex] & 1 << bit) !== 0;
    }
    set(index, newState) {
        const arrayIndex = index / 32 | 0;
        const bit = index % 32;
        const value = this._states[arrayIndex];
        if (newState) this._states[arrayIndex] = value | 1 << bit;
        else this._states[arrayIndex] = value & ~(1 << bit);
    }
}
class $8c013aba2f73f7e1$export$79a27591b52924cb {
    constructor(startIndexes, endIndexes, types){
        if (startIndexes.length !== endIndexes.length || startIndexes.length > $8c013aba2f73f7e1$export$4dac98cf97cec411) throw new Error('invalid startIndexes or endIndexes size');
        this._startIndexes = startIndexes;
        this._endIndexes = endIndexes;
        this._collapseStates = new $8c013aba2f73f7e1$var$BitField(startIndexes.length);
        this._userDefinedStates = new $8c013aba2f73f7e1$var$BitField(startIndexes.length);
        this._recoveredStates = new $8c013aba2f73f7e1$var$BitField(startIndexes.length);
        this._types = types;
        this._parentsComputed = false;
    }
    ensureParentIndices() {
        if (!this._parentsComputed) {
            this._parentsComputed = true;
            const parentIndexes = [];
            const isInsideLast = (startLineNumber, endLineNumber)=>{
                const index = parentIndexes[parentIndexes.length - 1];
                return this.getStartLineNumber(index) <= startLineNumber && this.getEndLineNumber(index) >= endLineNumber;
            };
            for(let i = 0, len = this._startIndexes.length; i < len; i++){
                const startLineNumber = this._startIndexes[i];
                const endLineNumber = this._endIndexes[i];
                if (startLineNumber > $8c013aba2f73f7e1$export$ccaa8b63109dc601 || endLineNumber > $8c013aba2f73f7e1$export$ccaa8b63109dc601) throw new Error('startLineNumber or endLineNumber must not exceed ' + $8c013aba2f73f7e1$export$ccaa8b63109dc601);
                while(parentIndexes.length > 0 && !isInsideLast(startLineNumber, endLineNumber))parentIndexes.pop();
                const parentIndex = parentIndexes.length > 0 ? parentIndexes[parentIndexes.length - 1] : -1;
                parentIndexes.push(i);
                this._startIndexes[i] = startLineNumber + ((parentIndex & 0xFF) << 24);
                this._endIndexes[i] = endLineNumber + ((parentIndex & 0xFF00) << 16);
            }
        }
    }
    get length() {
        return this._startIndexes.length;
    }
    getStartLineNumber(index) {
        return this._startIndexes[index] & $8c013aba2f73f7e1$export$ccaa8b63109dc601;
    }
    getEndLineNumber(index) {
        return this._endIndexes[index] & $8c013aba2f73f7e1$export$ccaa8b63109dc601;
    }
    getType(index) {
        return this._types ? this._types[index] : undefined;
    }
    hasTypes() {
        return !!this._types;
    }
    isCollapsed(index) {
        return this._collapseStates.get(index);
    }
    setCollapsed(index, newState) {
        this._collapseStates.set(index, newState);
    }
    isUserDefined(index) {
        return this._userDefinedStates.get(index);
    }
    setUserDefined(index, newState) {
        return this._userDefinedStates.set(index, newState);
    }
    isRecovered(index) {
        return this._recoveredStates.get(index);
    }
    setRecovered(index, newState) {
        return this._recoveredStates.set(index, newState);
    }
    getSource(index) {
        if (this.isUserDefined(index)) return 1 /* FoldSource.userDefined */ ;
        else if (this.isRecovered(index)) return 2 /* FoldSource.recovered */ ;
        return 0 /* FoldSource.provider */ ;
    }
    setSource(index, source) {
        if (source === 1 /* FoldSource.userDefined */ ) {
            this.setUserDefined(index, true);
            this.setRecovered(index, false);
        } else if (source === 2 /* FoldSource.recovered */ ) {
            this.setUserDefined(index, false);
            this.setRecovered(index, true);
        } else {
            this.setUserDefined(index, false);
            this.setRecovered(index, false);
        }
    }
    setCollapsedAllOfType(type, newState) {
        let hasChanged = false;
        if (this._types) {
            for(let i = 0; i < this._types.length; i++)if (this._types[i] === type) {
                this.setCollapsed(i, newState);
                hasChanged = true;
            }
        }
        return hasChanged;
    }
    toRegion(index) {
        return new $8c013aba2f73f7e1$export$6b90bd4afbaa93a9(this, index);
    }
    getParentIndex(index) {
        this.ensureParentIndices();
        const parent = ((this._startIndexes[index] & $8c013aba2f73f7e1$var$MASK_INDENT) >>> 24) + ((this._endIndexes[index] & $8c013aba2f73f7e1$var$MASK_INDENT) >>> 16);
        if (parent === $8c013aba2f73f7e1$export$4dac98cf97cec411) return -1;
        return parent;
    }
    contains(index, line) {
        return this.getStartLineNumber(index) <= line && this.getEndLineNumber(index) >= line;
    }
    findIndex(line) {
        let low = 0, high = this._startIndexes.length;
        if (high === 0) return -1; // no children
        while(low < high){
            const mid = Math.floor((low + high) / 2);
            if (line < this.getStartLineNumber(mid)) high = mid;
            else low = mid + 1;
        }
        return low - 1;
    }
    findRange(line) {
        let index = this.findIndex(line);
        if (index >= 0) {
            const endLineNumber = this.getEndLineNumber(index);
            if (endLineNumber >= line) return index;
            index = this.getParentIndex(index);
            while(index !== -1){
                if (this.contains(index, line)) return index;
                index = this.getParentIndex(index);
            }
        }
        return -1;
    }
    toString() {
        const res = [];
        for(let i = 0; i < this.length; i++)res[i] = `[${$8c013aba2f73f7e1$export$d7951322d01a638a[this.getSource(i)]}${this.isCollapsed(i) ? '+' : '-'}] ${this.getStartLineNumber(i)}/${this.getEndLineNumber(i)}`;
        return res.join(', ');
    }
    toFoldRange(index) {
        return {
            startLineNumber: this._startIndexes[index] & $8c013aba2f73f7e1$export$ccaa8b63109dc601,
            endLineNumber: this._endIndexes[index] & $8c013aba2f73f7e1$export$ccaa8b63109dc601,
            type: this._types ? this._types[index] : undefined,
            isCollapsed: this.isCollapsed(index),
            source: this.getSource(index)
        };
    }
    static fromFoldRanges(ranges) {
        const rangesLength = ranges.length;
        const startIndexes = new Uint32Array(rangesLength);
        const endIndexes = new Uint32Array(rangesLength);
        let types = [];
        let gotTypes = false;
        for(let i = 0; i < rangesLength; i++){
            const range = ranges[i];
            startIndexes[i] = range.startLineNumber;
            endIndexes[i] = range.endLineNumber;
            types.push(range.type);
            if (range.type) gotTypes = true;
        }
        if (!gotTypes) types = undefined;
        const regions = new $8c013aba2f73f7e1$export$79a27591b52924cb(startIndexes, endIndexes, types);
        for(let i = 0; i < rangesLength; i++){
            if (ranges[i].isCollapsed) regions.setCollapsed(i, true);
            regions.setSource(i, ranges[i].source);
        }
        return regions;
    }
    /**
     * Two inputs, each a FoldingRegions or a FoldRange[], are merged.
     * Each input must be pre-sorted on startLineNumber.
     * The first list is assumed to always include all regions currently defined by range providers.
     * The second list only contains the previously collapsed and all manual ranges.
     * If the line position matches, the range of the new range is taken, and the range is no longer manual
     * When an entry in one list overlaps an entry in the other, the second list's entry "wins" and
     * overlapping entries in the first list are discarded.
     * Invalid entries are discarded. An entry is invalid if:
     * 		the start and end line numbers aren't a valid range of line numbers,
     * 		it is out of sequence or has the same start line as a preceding entry,
     * 		it overlaps a preceding entry and is not fully contained by that entry.
     */ static sanitizeAndMerge(rangesA, rangesB, maxLineNumber, selection) {
        maxLineNumber = maxLineNumber ?? Number.MAX_VALUE;
        const getIndexedFunction = (r, limit)=>{
            return Array.isArray(r) ? (i)=>{
                return i < limit ? r[i] : undefined;
            } : (i)=>{
                return i < limit ? r.toFoldRange(i) : undefined;
            };
        };
        const getA = getIndexedFunction(rangesA, rangesA.length);
        const getB = getIndexedFunction(rangesB, rangesB.length);
        let indexA = 0;
        let indexB = 0;
        let nextA = getA(0);
        let nextB = getB(0);
        const stackedRanges = [];
        let topStackedRange;
        let prevLineNumber = 0;
        const resultRanges = [];
        while(nextA || nextB){
            let useRange = undefined;
            if (nextB && (!nextA || nextA.startLineNumber >= nextB.startLineNumber)) {
                if (nextA && nextA.startLineNumber === nextB.startLineNumber) {
                    if (nextB.source === 1 /* FoldSource.userDefined */ ) // a user defined range (possibly unfolded)
                    useRange = nextB;
                    else {
                        // a previously folded range or a (possibly unfolded) recovered range
                        useRange = nextA;
                        // stays collapsed if the range still has the same number of lines or the selection is not in the range or after it
                        useRange.isCollapsed = nextB.isCollapsed && (nextA.endLineNumber === nextB.endLineNumber || !selection?.startsInside(nextA.startLineNumber + 1, nextA.endLineNumber + 1));
                        useRange.source = 0 /* FoldSource.provider */ ;
                    }
                    nextA = getA(++indexA); // not necessary, just for speed
                } else {
                    useRange = nextB;
                    if (nextB.isCollapsed && nextB.source === 0 /* FoldSource.provider */ ) // a previously collapsed range
                    useRange.source = 2 /* FoldSource.recovered */ ;
                }
                nextB = getB(++indexB);
            } else {
                // nextA is next. The user folded B set takes precedence and we sometimes need to look
                // ahead in it to check for an upcoming conflict.
                let scanIndex = indexB;
                let prescanB = nextB;
                while(true){
                    if (!prescanB || prescanB.startLineNumber > nextA.endLineNumber) {
                        useRange = nextA;
                        break; // no conflict, use this nextA
                    }
                    if (prescanB.source === 1 /* FoldSource.userDefined */  && prescanB.endLineNumber > nextA.endLineNumber) break; // without setting nextResult, so this nextA gets skipped
                    prescanB = getB(++scanIndex);
                }
                nextA = getA(++indexA);
            }
            if (useRange) {
                while(topStackedRange && topStackedRange.endLineNumber < useRange.startLineNumber)topStackedRange = stackedRanges.pop();
                if (useRange.endLineNumber > useRange.startLineNumber && useRange.startLineNumber > prevLineNumber && useRange.endLineNumber <= maxLineNumber && (!topStackedRange || topStackedRange.endLineNumber >= useRange.endLineNumber)) {
                    resultRanges.push(useRange);
                    prevLineNumber = useRange.startLineNumber;
                    if (topStackedRange) stackedRanges.push(topStackedRange);
                    topStackedRange = useRange;
                }
            }
        }
        return resultRanges;
    }
}
class $8c013aba2f73f7e1$export$6b90bd4afbaa93a9 {
    constructor(ranges, index){
        this.ranges = ranges;
        this.index = index;
    }
    get startLineNumber() {
        return this.ranges.getStartLineNumber(this.index);
    }
    get endLineNumber() {
        return this.ranges.getEndLineNumber(this.index);
    }
    get regionIndex() {
        return this.index;
    }
    get parentIndex() {
        return this.ranges.getParentIndex(this.index);
    }
    get isCollapsed() {
        return this.ranges.isCollapsed(this.index);
    }
    containedBy(range) {
        return range.startLineNumber <= this.startLineNumber && range.endLineNumber >= this.endLineNumber;
    }
    containsLine(lineNumber) {
        return this.startLineNumber <= lineNumber && lineNumber <= this.endLineNumber;
    }
}



var $n7820 = parcelRequire("n7820");
class $20b0c2d6437739df$export$342aae847b5a9075 {
    get regions() {
        return this._regions;
    }
    get textModel() {
        return this._textModel;
    }
    constructor(textModel, decorationProvider){
        this._updateEventEmitter = new (0, $5YaSO.Emitter)();
        this.onDidChange = this._updateEventEmitter.event;
        this._textModel = textModel;
        this._decorationProvider = decorationProvider;
        this._regions = new (0, $8c013aba2f73f7e1$export$79a27591b52924cb)(new Uint32Array(0), new Uint32Array(0));
        this._editorDecorationIds = [];
    }
    toggleCollapseState(toggledRegions) {
        if (!toggledRegions.length) return;
        toggledRegions = toggledRegions.sort((r1, r2)=>r1.regionIndex - r2.regionIndex);
        const processed = {};
        this._decorationProvider.changeDecorations((accessor)=>{
            let k = 0; // index from [0 ... this.regions.length]
            let dirtyRegionEndLine = -1; // end of the range where decorations need to be updated
            let lastHiddenLine = -1; // the end of the last hidden lines
            const updateDecorationsUntil = (index)=>{
                while(k < index){
                    const endLineNumber = this._regions.getEndLineNumber(k);
                    const isCollapsed = this._regions.isCollapsed(k);
                    if (endLineNumber <= dirtyRegionEndLine) {
                        const isManual = this.regions.getSource(k) !== 0 /* FoldSource.provider */ ;
                        accessor.changeDecorationOptions(this._editorDecorationIds[k], this._decorationProvider.getDecorationOption(isCollapsed, endLineNumber <= lastHiddenLine, isManual));
                    }
                    if (isCollapsed && endLineNumber > lastHiddenLine) lastHiddenLine = endLineNumber;
                    k++;
                }
            };
            for (const region of toggledRegions){
                const index = region.regionIndex;
                const editorDecorationId = this._editorDecorationIds[index];
                if (editorDecorationId && !processed[editorDecorationId]) {
                    processed[editorDecorationId] = true;
                    updateDecorationsUntil(index); // update all decorations up to current index using the old dirtyRegionEndLine
                    const newCollapseState = !this._regions.isCollapsed(index);
                    this._regions.setCollapsed(index, newCollapseState);
                    dirtyRegionEndLine = Math.max(dirtyRegionEndLine, this._regions.getEndLineNumber(index));
                }
            }
            updateDecorationsUntil(this._regions.length);
        });
        this._updateEventEmitter.fire({
            model: this,
            collapseStateChanged: toggledRegions
        });
    }
    removeManualRanges(ranges) {
        const newFoldingRanges = new Array();
        const intersects = (foldRange)=>{
            for (const range of ranges){
                if (!(range.startLineNumber > foldRange.endLineNumber || foldRange.startLineNumber > range.endLineNumber)) return true;
            }
            return false;
        };
        for(let i = 0; i < this._regions.length; i++){
            const foldRange = this._regions.toFoldRange(i);
            if (foldRange.source === 0 /* FoldSource.provider */  || !intersects(foldRange)) newFoldingRanges.push(foldRange);
        }
        this.updatePost((0, $8c013aba2f73f7e1$export$79a27591b52924cb).fromFoldRanges(newFoldingRanges));
    }
    update(newRegions, selection) {
        const foldedOrManualRanges = this._currentFoldedOrManualRanges(selection);
        const newRanges = (0, $8c013aba2f73f7e1$export$79a27591b52924cb).sanitizeAndMerge(newRegions, foldedOrManualRanges, this._textModel.getLineCount(), selection);
        this.updatePost((0, $8c013aba2f73f7e1$export$79a27591b52924cb).fromFoldRanges(newRanges));
    }
    updatePost(newRegions) {
        const newEditorDecorations = [];
        let lastHiddenLine = -1;
        for(let index = 0, limit = newRegions.length; index < limit; index++){
            const startLineNumber = newRegions.getStartLineNumber(index);
            const endLineNumber = newRegions.getEndLineNumber(index);
            const isCollapsed = newRegions.isCollapsed(index);
            const isManual = newRegions.getSource(index) !== 0 /* FoldSource.provider */ ;
            const decorationRange = {
                startLineNumber: startLineNumber,
                startColumn: this._textModel.getLineMaxColumn(startLineNumber),
                endLineNumber: endLineNumber,
                endColumn: this._textModel.getLineMaxColumn(endLineNumber) + 1
            };
            newEditorDecorations.push({
                range: decorationRange,
                options: this._decorationProvider.getDecorationOption(isCollapsed, endLineNumber <= lastHiddenLine, isManual)
            });
            if (isCollapsed && endLineNumber > lastHiddenLine) lastHiddenLine = endLineNumber;
        }
        this._decorationProvider.changeDecorations((accessor)=>this._editorDecorationIds = accessor.deltaDecorations(this._editorDecorationIds, newEditorDecorations));
        this._regions = newRegions;
        this._updateEventEmitter.fire({
            model: this
        });
    }
    _currentFoldedOrManualRanges(selection) {
        const foldedRanges = [];
        for(let i = 0, limit = this._regions.length; i < limit; i++){
            let isCollapsed = this.regions.isCollapsed(i);
            const source = this.regions.getSource(i);
            if (isCollapsed || source !== 0 /* FoldSource.provider */ ) {
                const foldRange = this._regions.toFoldRange(i);
                const decRange = this._textModel.getDecorationRange(this._editorDecorationIds[i]);
                if (decRange) {
                    if (isCollapsed && selection?.startsInside(decRange.startLineNumber + 1, decRange.endLineNumber)) isCollapsed = false; // uncollapse is the range is blocked
                    foldedRanges.push({
                        startLineNumber: decRange.startLineNumber,
                        endLineNumber: decRange.endLineNumber,
                        type: foldRange.type,
                        isCollapsed: isCollapsed,
                        source: source
                    });
                }
            }
        }
        return foldedRanges;
    }
    /**
     * Collapse state memento, for persistence only
     */ getMemento() {
        const foldedOrManualRanges = this._currentFoldedOrManualRanges();
        const result = [];
        const maxLineNumber = this._textModel.getLineCount();
        for(let i = 0, limit = foldedOrManualRanges.length; i < limit; i++){
            const range = foldedOrManualRanges[i];
            if (range.startLineNumber >= range.endLineNumber || range.startLineNumber < 1 || range.endLineNumber > maxLineNumber) continue;
            const checksum = this._getLinesChecksum(range.startLineNumber + 1, range.endLineNumber);
            result.push({
                startLineNumber: range.startLineNumber,
                endLineNumber: range.endLineNumber,
                isCollapsed: range.isCollapsed,
                source: range.source,
                checksum: checksum
            });
        }
        return result.length > 0 ? result : undefined;
    }
    /**
     * Apply persisted state, for persistence only
     */ applyMemento(state) {
        if (!Array.isArray(state)) return;
        const rangesToRestore = [];
        const maxLineNumber = this._textModel.getLineCount();
        for (const range of state){
            if (range.startLineNumber >= range.endLineNumber || range.startLineNumber < 1 || range.endLineNumber > maxLineNumber) continue;
            const checksum = this._getLinesChecksum(range.startLineNumber + 1, range.endLineNumber);
            if (!range.checksum || checksum === range.checksum) rangesToRestore.push({
                startLineNumber: range.startLineNumber,
                endLineNumber: range.endLineNumber,
                type: undefined,
                isCollapsed: range.isCollapsed ?? true,
                source: range.source ?? 0 /* FoldSource.provider */ 
            });
        }
        const newRanges = (0, $8c013aba2f73f7e1$export$79a27591b52924cb).sanitizeAndMerge(this._regions, rangesToRestore, maxLineNumber);
        this.updatePost((0, $8c013aba2f73f7e1$export$79a27591b52924cb).fromFoldRanges(newRanges));
    }
    _getLinesChecksum(lineNumber1, lineNumber2) {
        const h = (0, $n7820.hash)(this._textModel.getLineContent(lineNumber1) + this._textModel.getLineContent(lineNumber2));
        return h % 1000000; // 6 digits is plenty
    }
    dispose() {
        this._decorationProvider.removeDecorations(this._editorDecorationIds);
    }
    getAllRegionsAtLine(lineNumber, filter) {
        const result = [];
        if (this._regions) {
            let index = this._regions.findRange(lineNumber);
            let level = 1;
            while(index >= 0){
                const current = this._regions.toRegion(index);
                if (!filter || filter(current, level)) result.push(current);
                level++;
                index = current.parentIndex;
            }
        }
        return result;
    }
    getRegionAtLine(lineNumber) {
        if (this._regions) {
            const index = this._regions.findRange(lineNumber);
            if (index >= 0) return this._regions.toRegion(index);
        }
        return null;
    }
    getRegionsInside(region, filter) {
        const result = [];
        const index = region ? region.regionIndex + 1 : 0;
        const endLineNumber = region ? region.endLineNumber : Number.MAX_VALUE;
        if (filter && filter.length === 2) {
            const levelStack = [];
            for(let i = index, len = this._regions.length; i < len; i++){
                const current = this._regions.toRegion(i);
                if (this._regions.getStartLineNumber(i) < endLineNumber) {
                    while(levelStack.length > 0 && !current.containedBy(levelStack[levelStack.length - 1]))levelStack.pop();
                    levelStack.push(current);
                    if (filter(current, levelStack.length)) result.push(current);
                } else break;
            }
        } else for(let i = index, len = this._regions.length; i < len; i++){
            const current = this._regions.toRegion(i);
            if (this._regions.getStartLineNumber(i) < endLineNumber) {
                if (!filter || filter(current)) result.push(current);
            } else break;
        }
        return result;
    }
}
function $20b0c2d6437739df$export$6008f8f734d0336a(foldingModel, levels, lineNumbers) {
    const toToggle = [];
    for (const lineNumber of lineNumbers){
        const region = foldingModel.getRegionAtLine(lineNumber);
        if (region) {
            const doCollapse = !region.isCollapsed;
            toToggle.push(region);
            if (levels > 1) {
                const regionsInside = foldingModel.getRegionsInside(region, (r, level)=>r.isCollapsed !== doCollapse && level < levels);
                toToggle.push(...regionsInside);
            }
        }
    }
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$1ef41fe66cd8530(foldingModel, doCollapse, levels = Number.MAX_VALUE, lineNumbers) {
    const toToggle = [];
    if (lineNumbers && lineNumbers.length > 0) for (const lineNumber of lineNumbers){
        const region = foldingModel.getRegionAtLine(lineNumber);
        if (region) {
            if (region.isCollapsed !== doCollapse) toToggle.push(region);
            if (levels > 1) {
                const regionsInside = foldingModel.getRegionsInside(region, (r, level)=>r.isCollapsed !== doCollapse && level < levels);
                toToggle.push(...regionsInside);
            }
        }
    }
    else {
        const regionsInside = foldingModel.getRegionsInside(null, (r, level)=>r.isCollapsed !== doCollapse && level < levels);
        toToggle.push(...regionsInside);
    }
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$50a013aaf999fe15(foldingModel, doCollapse, levels, lineNumbers) {
    const toToggle = [];
    for (const lineNumber of lineNumbers){
        const regions = foldingModel.getAllRegionsAtLine(lineNumber, (region, level)=>region.isCollapsed !== doCollapse && level <= levels);
        toToggle.push(...regions);
    }
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$e1cae19974cbbf8b(foldingModel, doCollapse, lineNumbers) {
    const toToggle = [];
    for (const lineNumber of lineNumbers){
        const regions = foldingModel.getAllRegionsAtLine(lineNumber, (region)=>region.isCollapsed !== doCollapse);
        if (regions.length > 0) toToggle.push(regions[0]);
    }
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$3f9d91c844738bc6(foldingModel, foldLevel, doCollapse, blockedLineNumbers) {
    const filter = (region, level)=>level === foldLevel && region.isCollapsed !== doCollapse && !blockedLineNumbers.some((line)=>region.containsLine(line));
    const toToggle = foldingModel.getRegionsInside(null, filter);
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$13292d9dd11d6b4f(foldingModel, doCollapse, blockedLineNumbers) {
    const filteredRegions = [];
    for (const lineNumber of blockedLineNumbers){
        const regions = foldingModel.getAllRegionsAtLine(lineNumber, undefined);
        if (regions.length > 0) filteredRegions.push(regions[0]);
    }
    const filter = (region)=>filteredRegions.every((filteredRegion)=>!filteredRegion.containedBy(region) && !region.containedBy(filteredRegion)) && region.isCollapsed !== doCollapse;
    const toToggle = foldingModel.getRegionsInside(null, filter);
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$acbcc757d0e877b(foldingModel, regExp, doCollapse) {
    const editorModel = foldingModel.textModel;
    const regions = foldingModel.regions;
    const toToggle = [];
    for(let i = regions.length - 1; i >= 0; i--)if (doCollapse !== regions.isCollapsed(i)) {
        const startLineNumber = regions.getStartLineNumber(i);
        if (regExp.test(editorModel.getLineContent(startLineNumber))) toToggle.push(regions.toRegion(i));
    }
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$ce3950edac996729(foldingModel, type, doCollapse) {
    const regions = foldingModel.regions;
    const toToggle = [];
    for(let i = regions.length - 1; i >= 0; i--)if (doCollapse !== regions.isCollapsed(i) && type === regions.getType(i)) toToggle.push(regions.toRegion(i));
    foldingModel.toggleCollapseState(toToggle);
}
function $20b0c2d6437739df$export$19eab21a9895dbc4(lineNumber, foldingModel) {
    let startLineNumber = null;
    const foldingRegion = foldingModel.getRegionAtLine(lineNumber);
    if (foldingRegion !== null) {
        startLineNumber = foldingRegion.startLineNumber;
        // If current line is not the start of the current fold, go to top line of current fold. If not, go to parent fold
        if (lineNumber === startLineNumber) {
            const parentFoldingIdx = foldingRegion.parentIndex;
            if (parentFoldingIdx !== -1) startLineNumber = foldingModel.regions.getStartLineNumber(parentFoldingIdx);
            else startLineNumber = null;
        }
    }
    return startLineNumber;
}
function $20b0c2d6437739df$export$9e804e9f47adba4e(lineNumber, foldingModel) {
    let foldingRegion = foldingModel.getRegionAtLine(lineNumber);
    // If on the folding range start line, go to previous sibling.
    if (foldingRegion !== null && foldingRegion.startLineNumber === lineNumber) {
        // If current line is not the start of the current fold, go to top line of current fold. If not, go to previous fold.
        if (lineNumber !== foldingRegion.startLineNumber) return foldingRegion.startLineNumber;
        else {
            // Find min line number to stay within parent.
            const expectedParentIndex = foldingRegion.parentIndex;
            let minLineNumber = 0;
            if (expectedParentIndex !== -1) minLineNumber = foldingModel.regions.getStartLineNumber(foldingRegion.parentIndex);
            // Find fold at same level.
            while(foldingRegion !== null){
                if (foldingRegion.regionIndex > 0) {
                    foldingRegion = foldingModel.regions.toRegion(foldingRegion.regionIndex - 1);
                    // Keep at same level.
                    if (foldingRegion.startLineNumber <= minLineNumber) return null;
                    else if (foldingRegion.parentIndex === expectedParentIndex) return foldingRegion.startLineNumber;
                } else return null;
            }
        }
    } else // Go to last fold that's before the current line.
    if (foldingModel.regions.length > 0) {
        foldingRegion = foldingModel.regions.toRegion(foldingModel.regions.length - 1);
        while(foldingRegion !== null){
            // Found fold before current line.
            if (foldingRegion.startLineNumber < lineNumber) return foldingRegion.startLineNumber;
            if (foldingRegion.regionIndex > 0) foldingRegion = foldingModel.regions.toRegion(foldingRegion.regionIndex - 1);
            else foldingRegion = null;
        }
    }
    return null;
}
function $20b0c2d6437739df$export$3164a73fda220264(lineNumber, foldingModel) {
    let foldingRegion = foldingModel.getRegionAtLine(lineNumber);
    // If on the folding range start line, go to next sibling.
    if (foldingRegion !== null && foldingRegion.startLineNumber === lineNumber) {
        // Find max line number to stay within parent.
        const expectedParentIndex = foldingRegion.parentIndex;
        let maxLineNumber = 0;
        if (expectedParentIndex !== -1) maxLineNumber = foldingModel.regions.getEndLineNumber(foldingRegion.parentIndex);
        else if (foldingModel.regions.length === 0) return null;
        else maxLineNumber = foldingModel.regions.getEndLineNumber(foldingModel.regions.length - 1);
        // Find fold at same level.
        while(foldingRegion !== null){
            if (foldingRegion.regionIndex < foldingModel.regions.length) {
                foldingRegion = foldingModel.regions.toRegion(foldingRegion.regionIndex + 1);
                // Keep at same level.
                if (foldingRegion.startLineNumber >= maxLineNumber) return null;
                else if (foldingRegion.parentIndex === expectedParentIndex) return foldingRegion.startLineNumber;
            } else return null;
        }
    } else // Go to first fold that's after the current line.
    if (foldingModel.regions.length > 0) {
        foldingRegion = foldingModel.regions.toRegion(0);
        while(foldingRegion !== null){
            // Found fold after current line.
            if (foldingRegion.startLineNumber > lineNumber) return foldingRegion.startLineNumber;
            if (foldingRegion.regionIndex < foldingModel.regions.length) foldingRegion = foldingModel.regions.toRegion(foldingRegion.regionIndex + 1);
            else foldingRegion = null;
        }
    }
    return null;
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $7ysJc = parcelRequire("7ysJc");

var $5YaSO = parcelRequire("5YaSO");

var $d00il = parcelRequire("d00il");

var $5z4Qk = parcelRequire("5z4Qk");
class $985c4282f998d8a5$export$87e89ef1cf49f2d {
    get onDidChange() {
        return this._updateEventEmitter.event;
    }
    get hiddenRanges() {
        return this._hiddenRanges;
    }
    constructor(model){
        this._updateEventEmitter = new (0, $5YaSO.Emitter)();
        this._hasLineChanges = false;
        this._foldingModel = model;
        this._foldingModelListener = model.onDidChange((_)=>this.updateHiddenRanges());
        this._hiddenRanges = [];
        if (model.regions.length) this.updateHiddenRanges();
    }
    notifyChangeModelContent(e) {
        if (this._hiddenRanges.length && !this._hasLineChanges) this._hasLineChanges = e.changes.some((change)=>{
            return change.range.endLineNumber !== change.range.startLineNumber || (0, $5z4Qk.countEOL)(change.text)[0] !== 0;
        });
    }
    updateHiddenRanges() {
        let updateHiddenAreas = false;
        const newHiddenAreas = [];
        let i = 0; // index into hidden
        let k = 0;
        let lastCollapsedStart = Number.MAX_VALUE;
        let lastCollapsedEnd = -1;
        const ranges = this._foldingModel.regions;
        for(; i < ranges.length; i++){
            if (!ranges.isCollapsed(i)) continue;
            const startLineNumber = ranges.getStartLineNumber(i) + 1; // the first line is not hidden
            const endLineNumber = ranges.getEndLineNumber(i);
            if (lastCollapsedStart <= startLineNumber && endLineNumber <= lastCollapsedEnd) continue;
            if (!updateHiddenAreas && k < this._hiddenRanges.length && this._hiddenRanges[k].startLineNumber === startLineNumber && this._hiddenRanges[k].endLineNumber === endLineNumber) {
                // reuse the old ranges
                newHiddenAreas.push(this._hiddenRanges[k]);
                k++;
            } else {
                updateHiddenAreas = true;
                newHiddenAreas.push(new (0, $d00il.Range)(startLineNumber, 1, endLineNumber, 1));
            }
            lastCollapsedStart = startLineNumber;
            lastCollapsedEnd = endLineNumber;
        }
        if (this._hasLineChanges || updateHiddenAreas || k < this._hiddenRanges.length) this.applyHiddenRanges(newHiddenAreas);
    }
    applyHiddenRanges(newHiddenAreas) {
        this._hiddenRanges = newHiddenAreas;
        this._hasLineChanges = false;
        this._updateEventEmitter.fire(newHiddenAreas);
    }
    hasRanges() {
        return this._hiddenRanges.length > 0;
    }
    isHidden(line) {
        return $985c4282f998d8a5$var$findRange(this._hiddenRanges, line) !== null;
    }
    adjustSelections(selections) {
        let hasChanges = false;
        const editorModel = this._foldingModel.textModel;
        let lastRange = null;
        const adjustLine = (line)=>{
            if (!lastRange || !$985c4282f998d8a5$var$isInside(line, lastRange)) lastRange = $985c4282f998d8a5$var$findRange(this._hiddenRanges, line);
            if (lastRange) return lastRange.startLineNumber - 1;
            return null;
        };
        for(let i = 0, len = selections.length; i < len; i++){
            let selection = selections[i];
            const adjustedStartLine = adjustLine(selection.startLineNumber);
            if (adjustedStartLine) {
                selection = selection.setStartPosition(adjustedStartLine, editorModel.getLineMaxColumn(adjustedStartLine));
                hasChanges = true;
            }
            const adjustedEndLine = adjustLine(selection.endLineNumber);
            if (adjustedEndLine) {
                selection = selection.setEndPosition(adjustedEndLine, editorModel.getLineMaxColumn(adjustedEndLine));
                hasChanges = true;
            }
            selections[i] = selection;
        }
        return hasChanges;
    }
    dispose() {
        if (this.hiddenRanges.length > 0) {
            this._hiddenRanges = [];
            this._updateEventEmitter.fire(this._hiddenRanges);
        }
        if (this._foldingModelListener) {
            this._foldingModelListener.dispose();
            this._foldingModelListener = null;
        }
    }
}
function $985c4282f998d8a5$var$isInside(line, range) {
    return line >= range.startLineNumber && line <= range.endLineNumber;
}
function $985c4282f998d8a5$var$findRange(ranges, line) {
    const i = (0, $7ysJc.findFirstIdxMonotonousOrArrLen)(ranges, (r)=>line < r.startLineNumber) - 1;
    if (i >= 0 && ranges[i].endLineNumber >= line) return ranges[i];
    return null;
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $a47jW = parcelRequire("a47jW");

const $b63b4c5971ab4df6$var$MAX_FOLDING_REGIONS_FOR_INDENT_DEFAULT = 5000;
const $b63b4c5971ab4df6$var$ID_INDENT_PROVIDER = 'indent';
class $b63b4c5971ab4df6$export$c6761242dbde8f79 {
    constructor(editorModel, languageConfigurationService, foldingRangesLimit){
        this.editorModel = editorModel;
        this.languageConfigurationService = languageConfigurationService;
        this.foldingRangesLimit = foldingRangesLimit;
        this.id = $b63b4c5971ab4df6$var$ID_INDENT_PROVIDER;
    }
    dispose() {}
    compute(cancelationToken) {
        const foldingRules = this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules;
        const offSide = foldingRules && !!foldingRules.offSide;
        const markers = foldingRules && foldingRules.markers;
        return Promise.resolve($b63b4c5971ab4df6$export$a7fcbe01d14a5fd9(this.editorModel, offSide, markers, this.foldingRangesLimit));
    }
}
class $b63b4c5971ab4df6$export$eb0bed8ad121fa0e {
    constructor(foldingRangesLimit){
        this._startIndexes = [];
        this._endIndexes = [];
        this._indentOccurrences = [];
        this._length = 0;
        this._foldingRangesLimit = foldingRangesLimit;
    }
    insertFirst(startLineNumber, endLineNumber, indent) {
        if (startLineNumber > (0, $8c013aba2f73f7e1$export$ccaa8b63109dc601) || endLineNumber > (0, $8c013aba2f73f7e1$export$ccaa8b63109dc601)) return;
        const index = this._length;
        this._startIndexes[index] = startLineNumber;
        this._endIndexes[index] = endLineNumber;
        this._length++;
        if (indent < 1000) this._indentOccurrences[indent] = (this._indentOccurrences[indent] || 0) + 1;
    }
    toIndentRanges(model) {
        const limit = this._foldingRangesLimit.limit;
        if (this._length <= limit) {
            this._foldingRangesLimit.update(this._length, false);
            // reverse and create arrays of the exact length
            const startIndexes = new Uint32Array(this._length);
            const endIndexes = new Uint32Array(this._length);
            for(let i = this._length - 1, k = 0; i >= 0; i--, k++){
                startIndexes[k] = this._startIndexes[i];
                endIndexes[k] = this._endIndexes[i];
            }
            return new (0, $8c013aba2f73f7e1$export$79a27591b52924cb)(startIndexes, endIndexes);
        } else {
            this._foldingRangesLimit.update(this._length, limit);
            let entries = 0;
            let maxIndent = this._indentOccurrences.length;
            for(let i = 0; i < this._indentOccurrences.length; i++){
                const n = this._indentOccurrences[i];
                if (n) {
                    if (n + entries > limit) {
                        maxIndent = i;
                        break;
                    }
                    entries += n;
                }
            }
            const tabSize = model.getOptions().tabSize;
            // reverse and create arrays of the exact length
            const startIndexes = new Uint32Array(limit);
            const endIndexes = new Uint32Array(limit);
            for(let i = this._length - 1, k = 0; i >= 0; i--){
                const startIndex = this._startIndexes[i];
                const lineContent = model.getLineContent(startIndex);
                const indent = (0, $a47jW.computeIndentLevel)(lineContent, tabSize);
                if (indent < maxIndent || indent === maxIndent && entries++ < limit) {
                    startIndexes[k] = startIndex;
                    endIndexes[k] = this._endIndexes[i];
                    k++;
                }
            }
            return new (0, $8c013aba2f73f7e1$export$79a27591b52924cb)(startIndexes, endIndexes);
        }
    }
}
const $b63b4c5971ab4df6$var$foldingRangesLimitDefault = {
    limit: $b63b4c5971ab4df6$var$MAX_FOLDING_REGIONS_FOR_INDENT_DEFAULT,
    update: ()=>{}
};
function $b63b4c5971ab4df6$export$a7fcbe01d14a5fd9(model, offSide, markers, foldingRangesLimit = $b63b4c5971ab4df6$var$foldingRangesLimitDefault) {
    const tabSize = model.getOptions().tabSize;
    const result = new $b63b4c5971ab4df6$export$eb0bed8ad121fa0e(foldingRangesLimit);
    let pattern = undefined;
    if (markers) pattern = new RegExp(`(${markers.start.source})|(?:${markers.end.source})`);
    const previousRegions = [];
    const line = model.getLineCount() + 1;
    previousRegions.push({
        indent: -1,
        endAbove: line,
        line: line
    }); // sentinel, to make sure there's at least one entry
    for(let line = model.getLineCount(); line > 0; line--){
        const lineContent = model.getLineContent(line);
        const indent = (0, $a47jW.computeIndentLevel)(lineContent, tabSize);
        let previous = previousRegions[previousRegions.length - 1];
        if (indent === -1) {
            if (offSide) // for offSide languages, empty lines are associated to the previous block
            // note: the next block is already written to the results, so this only
            // impacts the end position of the block before
            previous.endAbove = line;
            continue; // only whitespace
        }
        let m;
        if (pattern && (m = lineContent.match(pattern))) {
            // folding pattern match
            if (m[1]) {
                // discard all regions until the folding pattern
                let i = previousRegions.length - 1;
                while(i > 0 && previousRegions[i].indent !== -2)i--;
                if (i > 0) {
                    previousRegions.length = i + 1;
                    previous = previousRegions[i];
                    // new folding range from pattern, includes the end line
                    result.insertFirst(line, previous.line, indent);
                    previous.line = line;
                    previous.indent = indent;
                    previous.endAbove = line;
                    continue;
                }
            } else {
                previousRegions.push({
                    indent: -2,
                    endAbove: line,
                    line: line
                });
                continue;
            }
        }
        if (previous.indent > indent) {
            // discard all regions with larger indent
            do {
                previousRegions.pop();
                previous = previousRegions[previousRegions.length - 1];
            }while (previous.indent > indent);
            // new folding range
            const endLineNumber = previous.endAbove - 1;
            if (endLineNumber - line >= 1) result.insertFirst(line, endLineNumber, indent);
        }
        if (previous.indent === indent) previous.endAbove = line;
        else // new region with a bigger indent
        previousRegions.push({
            indent: indent,
            endAbove: line,
            line: line
        });
    }
    return result.toIndentRanges(model);
}



var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $awgRE = parcelRequire("awgRE");

var $91ntV = parcelRequire("91ntV");

var $4dEdH = parcelRequire("4dEdH");

var $gaWeX = parcelRequire("gaWeX");

var $hEsmQ = parcelRequire("hEsmQ");

var $azIPz = parcelRequire("azIPz");

var $5rADe = parcelRequire("5rADe");
const $c635953bb01ef0ba$var$foldBackground = (0, $gaWeX.registerColor)('editor.foldBackground', {
    light: (0, $gaWeX.transparent)((0, $gaWeX.editorSelectionBackground), 0.3),
    dark: (0, $gaWeX.transparent)((0, $gaWeX.editorSelectionBackground), 0.3),
    hcDark: null,
    hcLight: null
}, (0, $4dEdH.localize)('foldBackgroundBackground', "Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations."), true);
(0, $gaWeX.registerColor)('editor.foldPlaceholderForeground', {
    light: '#808080',
    dark: '#808080',
    hcDark: null,
    hcLight: null
}, (0, $4dEdH.localize)('collapsedTextColor', "Color of the collapsed text after the first line of a folded range."));
(0, $gaWeX.registerColor)('editorGutter.foldingControlForeground', (0, $gaWeX.iconForeground), (0, $4dEdH.localize)('editorGutter.foldingControlForeground', 'Color of the folding control in the editor gutter.'));
const $c635953bb01ef0ba$export$885051cbe6b7e954 = (0, $hEsmQ.registerIcon)('folding-expanded', (0, $awgRE.Codicon).chevronDown, (0, $4dEdH.localize)('foldingExpandedIcon', 'Icon for expanded ranges in the editor glyph margin.'));
const $c635953bb01ef0ba$export$91aea75f1008558b = (0, $hEsmQ.registerIcon)('folding-collapsed', (0, $awgRE.Codicon).chevronRight, (0, $4dEdH.localize)('foldingCollapsedIcon', 'Icon for collapsed ranges in the editor glyph margin.'));
const $c635953bb01ef0ba$export$627381edb035075e = (0, $hEsmQ.registerIcon)('folding-manual-collapsed', $c635953bb01ef0ba$export$91aea75f1008558b, (0, $4dEdH.localize)('foldingManualCollapedIcon', 'Icon for manually collapsed ranges in the editor glyph margin.'));
const $c635953bb01ef0ba$export$b77e5dde50b05fa8 = (0, $hEsmQ.registerIcon)('folding-manual-expanded', $c635953bb01ef0ba$export$885051cbe6b7e954, (0, $4dEdH.localize)('foldingManualExpandedIcon', 'Icon for manually expanded ranges in the editor glyph margin.'));
const $c635953bb01ef0ba$var$foldedBackgroundMinimap = {
    color: (0, $azIPz.themeColorFromId)($c635953bb01ef0ba$var$foldBackground),
    position: 1 /* MinimapPosition.Inline */ 
};
const $c635953bb01ef0ba$var$collapsed = (0, $4dEdH.localize)('linesCollapsed', "Click to expand the range.");
const $c635953bb01ef0ba$var$expanded = (0, $4dEdH.localize)('linesExpanded', "Click to collapse the range.");
class $c635953bb01ef0ba$export$efeea4b4f3021f6b {
    static{
        this.COLLAPSED_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-collapsed-visual-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            afterContentClassName: 'inline-folded',
            isWholeLine: true,
            linesDecorationsTooltip: $c635953bb01ef0ba$var$collapsed,
            firstLineDecorationClassName: (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$91aea75f1008558b)
        });
    }
    static{
        this.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-collapsed-highlighted-visual-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            afterContentClassName: 'inline-folded',
            className: 'folded-background',
            minimap: $c635953bb01ef0ba$var$foldedBackgroundMinimap,
            isWholeLine: true,
            linesDecorationsTooltip: $c635953bb01ef0ba$var$collapsed,
            firstLineDecorationClassName: (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$91aea75f1008558b)
        });
    }
    static{
        this.MANUALLY_COLLAPSED_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-manually-collapsed-visual-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            afterContentClassName: 'inline-folded',
            isWholeLine: true,
            linesDecorationsTooltip: $c635953bb01ef0ba$var$collapsed,
            firstLineDecorationClassName: (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$627381edb035075e)
        });
    }
    static{
        this.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-manually-collapsed-highlighted-visual-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            afterContentClassName: 'inline-folded',
            className: 'folded-background',
            minimap: $c635953bb01ef0ba$var$foldedBackgroundMinimap,
            isWholeLine: true,
            linesDecorationsTooltip: $c635953bb01ef0ba$var$collapsed,
            firstLineDecorationClassName: (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$627381edb035075e)
        });
    }
    static{
        this.NO_CONTROLS_COLLAPSED_RANGE_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-no-controls-range-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            afterContentClassName: 'inline-folded',
            isWholeLine: true,
            linesDecorationsTooltip: $c635953bb01ef0ba$var$collapsed
        });
    }
    static{
        this.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-no-controls-range-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            afterContentClassName: 'inline-folded',
            className: 'folded-background',
            minimap: $c635953bb01ef0ba$var$foldedBackgroundMinimap,
            isWholeLine: true,
            linesDecorationsTooltip: $c635953bb01ef0ba$var$collapsed
        });
    }
    static{
        this.EXPANDED_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-expanded-visual-decoration',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            isWholeLine: true,
            firstLineDecorationClassName: 'alwaysShowFoldIcons ' + (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$885051cbe6b7e954),
            linesDecorationsTooltip: $c635953bb01ef0ba$var$expanded
        });
    }
    static{
        this.EXPANDED_AUTO_HIDE_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-expanded-auto-hide-visual-decoration',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
            isWholeLine: true,
            firstLineDecorationClassName: (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$885051cbe6b7e954),
            linesDecorationsTooltip: $c635953bb01ef0ba$var$expanded
        });
    }
    static{
        this.MANUALLY_EXPANDED_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-manually-expanded-visual-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            isWholeLine: true,
            firstLineDecorationClassName: 'alwaysShowFoldIcons ' + (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$b77e5dde50b05fa8),
            linesDecorationsTooltip: $c635953bb01ef0ba$var$expanded
        });
    }
    static{
        this.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-manually-expanded-auto-hide-visual-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            isWholeLine: true,
            firstLineDecorationClassName: (0, $5rADe.ThemeIcon).asClassName($c635953bb01ef0ba$export$b77e5dde50b05fa8),
            linesDecorationsTooltip: $c635953bb01ef0ba$var$expanded
        });
    }
    static{
        this.NO_CONTROLS_EXPANDED_RANGE_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-no-controls-range-decoration',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            isWholeLine: true
        });
    }
    static{
        this.HIDDEN_RANGE_DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'folding-hidden-range-decoration',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ 
        });
    }
    constructor(editor){
        this.editor = editor;
        this.showFoldingControls = 'mouseover';
        this.showFoldingHighlights = true;
    }
    getDecorationOption(isCollapsed, isHidden, isManual) {
        if (isHidden) return $c635953bb01ef0ba$export$efeea4b4f3021f6b.HIDDEN_RANGE_DECORATION;
        if (this.showFoldingControls === 'never') {
            if (isCollapsed) return this.showFoldingHighlights ? $c635953bb01ef0ba$export$efeea4b4f3021f6b.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION : $c635953bb01ef0ba$export$efeea4b4f3021f6b.NO_CONTROLS_COLLAPSED_RANGE_DECORATION;
            return $c635953bb01ef0ba$export$efeea4b4f3021f6b.NO_CONTROLS_EXPANDED_RANGE_DECORATION;
        }
        if (isCollapsed) return isManual ? this.showFoldingHighlights ? $c635953bb01ef0ba$export$efeea4b4f3021f6b.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION : $c635953bb01ef0ba$export$efeea4b4f3021f6b.MANUALLY_COLLAPSED_VISUAL_DECORATION : this.showFoldingHighlights ? $c635953bb01ef0ba$export$efeea4b4f3021f6b.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION : $c635953bb01ef0ba$export$efeea4b4f3021f6b.COLLAPSED_VISUAL_DECORATION;
        else if (this.showFoldingControls === 'mouseover') return isManual ? $c635953bb01ef0ba$export$efeea4b4f3021f6b.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION : $c635953bb01ef0ba$export$efeea4b4f3021f6b.EXPANDED_AUTO_HIDE_VISUAL_DECORATION;
        else return isManual ? $c635953bb01ef0ba$export$efeea4b4f3021f6b.MANUALLY_EXPANDED_VISUAL_DECORATION : $c635953bb01ef0ba$export$efeea4b4f3021f6b.EXPANDED_VISUAL_DECORATION;
    }
    changeDecorations(callback) {
        return this.editor.changeDecorations(callback);
    }
    removeDecorations(decorationIds) {
        this.editor.removeDecorations(decorationIds);
    }
}



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

const $c72542064e6cf486$var$foldingContext = {};
const $c72542064e6cf486$var$ID_SYNTAX_PROVIDER = 'syntax';
class $c72542064e6cf486$export$409cdd7e50053250 {
    constructor(editorModel, providers, handleFoldingRangesChange, foldingRangesLimit, fallbackRangeProvider // used when all providers return null
    ){
        this.editorModel = editorModel;
        this.providers = providers;
        this.handleFoldingRangesChange = handleFoldingRangesChange;
        this.foldingRangesLimit = foldingRangesLimit;
        this.fallbackRangeProvider = fallbackRangeProvider;
        this.id = $c72542064e6cf486$var$ID_SYNTAX_PROVIDER;
        this.disposables = new (0, $9cWcn.DisposableStore)();
        if (fallbackRangeProvider) this.disposables.add(fallbackRangeProvider);
        for (const provider of providers)if (typeof provider.onDidChange === 'function') this.disposables.add(provider.onDidChange(handleFoldingRangesChange));
    }
    compute(cancellationToken) {
        return $c72542064e6cf486$var$collectSyntaxRanges(this.providers, this.editorModel, cancellationToken).then((ranges)=>{
            if (ranges) {
                const res = $c72542064e6cf486$export$468fc32e82949676(ranges, this.foldingRangesLimit);
                return res;
            }
            return this.fallbackRangeProvider?.compute(cancellationToken) ?? null;
        });
    }
    dispose() {
        this.disposables.dispose();
    }
}
function $c72542064e6cf486$var$collectSyntaxRanges(providers, model, cancellationToken) {
    let rangeData = null;
    const promises = providers.map((provider, i)=>{
        return Promise.resolve(provider.provideFoldingRanges(model, $c72542064e6cf486$var$foldingContext, cancellationToken)).then((ranges)=>{
            if (cancellationToken.isCancellationRequested) return;
            if (Array.isArray(ranges)) {
                if (!Array.isArray(rangeData)) rangeData = [];
                const nLines = model.getLineCount();
                for (const r of ranges)if (r.start > 0 && r.end > r.start && r.end <= nLines) rangeData.push({
                    start: r.start,
                    end: r.end,
                    rank: i,
                    kind: r.kind
                });
            }
        }, (0, $gPkHZ.onUnexpectedExternalError));
    });
    return Promise.all(promises).then((_)=>{
        return rangeData;
    });
}
class $c72542064e6cf486$var$RangesCollector {
    constructor(foldingRangesLimit){
        this._startIndexes = [];
        this._endIndexes = [];
        this._nestingLevels = [];
        this._nestingLevelCounts = [];
        this._types = [];
        this._length = 0;
        this._foldingRangesLimit = foldingRangesLimit;
    }
    add(startLineNumber, endLineNumber, type, nestingLevel) {
        if (startLineNumber > (0, $8c013aba2f73f7e1$export$ccaa8b63109dc601) || endLineNumber > (0, $8c013aba2f73f7e1$export$ccaa8b63109dc601)) return;
        const index = this._length;
        this._startIndexes[index] = startLineNumber;
        this._endIndexes[index] = endLineNumber;
        this._nestingLevels[index] = nestingLevel;
        this._types[index] = type;
        this._length++;
        if (nestingLevel < 30) this._nestingLevelCounts[nestingLevel] = (this._nestingLevelCounts[nestingLevel] || 0) + 1;
    }
    toIndentRanges() {
        const limit = this._foldingRangesLimit.limit;
        if (this._length <= limit) {
            this._foldingRangesLimit.update(this._length, false);
            const startIndexes = new Uint32Array(this._length);
            const endIndexes = new Uint32Array(this._length);
            for(let i = 0; i < this._length; i++){
                startIndexes[i] = this._startIndexes[i];
                endIndexes[i] = this._endIndexes[i];
            }
            return new (0, $8c013aba2f73f7e1$export$79a27591b52924cb)(startIndexes, endIndexes, this._types);
        } else {
            this._foldingRangesLimit.update(this._length, limit);
            let entries = 0;
            let maxLevel = this._nestingLevelCounts.length;
            for(let i = 0; i < this._nestingLevelCounts.length; i++){
                const n = this._nestingLevelCounts[i];
                if (n) {
                    if (n + entries > limit) {
                        maxLevel = i;
                        break;
                    }
                    entries += n;
                }
            }
            const startIndexes = new Uint32Array(limit);
            const endIndexes = new Uint32Array(limit);
            const types = [];
            for(let i = 0, k = 0; i < this._length; i++){
                const level = this._nestingLevels[i];
                if (level < maxLevel || level === maxLevel && entries++ < limit) {
                    startIndexes[k] = this._startIndexes[i];
                    endIndexes[k] = this._endIndexes[i];
                    types[k] = this._types[i];
                    k++;
                }
            }
            return new (0, $8c013aba2f73f7e1$export$79a27591b52924cb)(startIndexes, endIndexes, types);
        }
    }
}
function $c72542064e6cf486$export$468fc32e82949676(rangeData, foldingRangesLimit) {
    const sorted = rangeData.sort((d1, d2)=>{
        let diff = d1.start - d2.start;
        if (diff === 0) diff = d1.rank - d2.rank;
        return diff;
    });
    const collector = new $c72542064e6cf486$var$RangesCollector(foldingRangesLimit);
    let top = undefined;
    const previous = [];
    for (const entry of sorted){
        if (!top) {
            top = entry;
            collector.add(entry.start, entry.end, entry.kind && entry.kind.value, previous.length);
        } else if (entry.start > top.start) {
            if (entry.end <= top.end) {
                previous.push(top);
                top = entry;
                collector.add(entry.start, entry.end, entry.kind && entry.kind.value, previous.length);
            } else {
                if (entry.start > top.end) {
                    do top = previous.pop();
                    while (top && entry.start > top.end);
                    if (top) previous.push(top);
                    top = entry;
                }
                collector.add(entry.start, entry.end, entry.kind && entry.kind.value, previous.length);
            }
        }
    }
    return collector.toIndentRanges();
}



var $kCOKl = parcelRequire("kCOKl");

var $goG89 = parcelRequire("goG89");

var $eUQTM = parcelRequire("eUQTM");

var $4J6fu = parcelRequire("4J6fu");

var $5YaSO = parcelRequire("5YaSO");

var $8tcMz = parcelRequire("8tcMz");

var $5OJ54 = parcelRequire("5OJ54");

var $cKKJT = parcelRequire("cKKJT");

var $35IZ9 = parcelRequire("35IZ9");
var $bd09b69eb5b6e36a$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $bd09b69eb5b6e36a$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $bd09b69eb5b6e36a$var$FoldingController_1;
const $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED = new (0, $cxCeF.RawContextKey)('foldingEnabled', false);
let $bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8 = class FoldingController extends (0, $9cWcn.Disposable) {
    static{
        $bd09b69eb5b6e36a$var$FoldingController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.folding';
    }
    static get(editor) {
        return editor.getContribution($bd09b69eb5b6e36a$var$FoldingController_1.ID);
    }
    static getFoldingRangeProviders(languageFeaturesService, model) {
        const foldingRangeProviders = languageFeaturesService.foldingRangeProvider.ordered(model);
        return $bd09b69eb5b6e36a$var$FoldingController_1._foldingRangeSelector?.(foldingRangeProviders, model) ?? foldingRangeProviders;
    }
    constructor(editor, contextKeyService, languageConfigurationService, notificationService, languageFeatureDebounceService, languageFeaturesService){
        super();
        this.contextKeyService = contextKeyService;
        this.languageConfigurationService = languageConfigurationService;
        this.languageFeaturesService = languageFeaturesService;
        this.localToDispose = this._register(new (0, $9cWcn.DisposableStore)());
        this.editor = editor;
        this._foldingLimitReporter = new $bd09b69eb5b6e36a$export$361d9ddbbcafe779(editor);
        const options = this.editor.getOptions();
        this._isEnabled = options.get(43 /* EditorOption.folding */ );
        this._useFoldingProviders = options.get(44 /* EditorOption.foldingStrategy */ ) !== 'indentation';
        this._unfoldOnClickAfterEndOfLine = options.get(48 /* EditorOption.unfoldOnClickAfterEndOfLine */ );
        this._restoringViewState = false;
        this._currentModelHasFoldedImports = false;
        this._foldingImportsByDefault = options.get(46 /* EditorOption.foldingImportsByDefault */ );
        this.updateDebounceInfo = languageFeatureDebounceService.for(languageFeaturesService.foldingRangeProvider, 'Folding', {
            min: 200
        });
        this.foldingModel = null;
        this.hiddenRangeModel = null;
        this.rangeProvider = null;
        this.foldingRegionPromise = null;
        this.foldingModelPromise = null;
        this.updateScheduler = null;
        this.cursorChangedScheduler = null;
        this.mouseDownInfo = null;
        this.foldingDecorationProvider = new (0, $c635953bb01ef0ba$export$efeea4b4f3021f6b)(editor);
        this.foldingDecorationProvider.showFoldingControls = options.get(111 /* EditorOption.showFoldingControls */ );
        this.foldingDecorationProvider.showFoldingHighlights = options.get(45 /* EditorOption.foldingHighlight */ );
        this.foldingEnabled = $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED.bindTo(this.contextKeyService);
        this.foldingEnabled.set(this._isEnabled);
        this._register(this.editor.onDidChangeModel(()=>this.onModelChanged()));
        this._register(this.editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(43 /* EditorOption.folding */ )) {
                this._isEnabled = this.editor.getOptions().get(43 /* EditorOption.folding */ );
                this.foldingEnabled.set(this._isEnabled);
                this.onModelChanged();
            }
            if (e.hasChanged(47 /* EditorOption.foldingMaximumRegions */ )) this.onModelChanged();
            if (e.hasChanged(111 /* EditorOption.showFoldingControls */ ) || e.hasChanged(45 /* EditorOption.foldingHighlight */ )) {
                const options = this.editor.getOptions();
                this.foldingDecorationProvider.showFoldingControls = options.get(111 /* EditorOption.showFoldingControls */ );
                this.foldingDecorationProvider.showFoldingHighlights = options.get(45 /* EditorOption.foldingHighlight */ );
                this.triggerFoldingModelChanged();
            }
            if (e.hasChanged(44 /* EditorOption.foldingStrategy */ )) {
                this._useFoldingProviders = this.editor.getOptions().get(44 /* EditorOption.foldingStrategy */ ) !== 'indentation';
                this.onFoldingStrategyChanged();
            }
            if (e.hasChanged(48 /* EditorOption.unfoldOnClickAfterEndOfLine */ )) this._unfoldOnClickAfterEndOfLine = this.editor.getOptions().get(48 /* EditorOption.unfoldOnClickAfterEndOfLine */ );
            if (e.hasChanged(46 /* EditorOption.foldingImportsByDefault */ )) this._foldingImportsByDefault = this.editor.getOptions().get(46 /* EditorOption.foldingImportsByDefault */ );
        }));
        this.onModelChanged();
    }
    /**
     * Store view state.
     */ saveViewState() {
        const model = this.editor.getModel();
        if (!model || !this._isEnabled || model.isTooLargeForTokenization()) return {};
        if (this.foldingModel) {
            const collapsedRegions = this.foldingModel.getMemento();
            const provider = this.rangeProvider ? this.rangeProvider.id : undefined;
            return {
                collapsedRegions: collapsedRegions,
                lineCount: model.getLineCount(),
                provider: provider,
                foldedImports: this._currentModelHasFoldedImports
            };
        }
        return undefined;
    }
    /**
     * Restore view state.
     */ restoreViewState(state) {
        const model = this.editor.getModel();
        if (!model || !this._isEnabled || model.isTooLargeForTokenization() || !this.hiddenRangeModel) return;
        if (!state) return;
        this._currentModelHasFoldedImports = !!state.foldedImports;
        if (state.collapsedRegions && state.collapsedRegions.length > 0 && this.foldingModel) {
            this._restoringViewState = true;
            try {
                this.foldingModel.applyMemento(state.collapsedRegions);
            } finally{
                this._restoringViewState = false;
            }
        }
    }
    onModelChanged() {
        this.localToDispose.clear();
        const model = this.editor.getModel();
        if (!this._isEnabled || !model || model.isTooLargeForTokenization()) // huge files get no view model, so they cannot support hidden areas
        return;
        this._currentModelHasFoldedImports = false;
        this.foldingModel = new (0, $20b0c2d6437739df$export$342aae847b5a9075)(model, this.foldingDecorationProvider);
        this.localToDispose.add(this.foldingModel);
        this.hiddenRangeModel = new (0, $985c4282f998d8a5$export$87e89ef1cf49f2d)(this.foldingModel);
        this.localToDispose.add(this.hiddenRangeModel);
        this.localToDispose.add(this.hiddenRangeModel.onDidChange((hr)=>this.onHiddenRangesChanges(hr)));
        this.updateScheduler = new (0, $6bXyA.Delayer)(this.updateDebounceInfo.get(model));
        this.cursorChangedScheduler = new (0, $6bXyA.RunOnceScheduler)(()=>this.revealCursor(), 200);
        this.localToDispose.add(this.cursorChangedScheduler);
        this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange(()=>this.onFoldingStrategyChanged()));
        this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(()=>this.onFoldingStrategyChanged())); // covers model language changes as well
        this.localToDispose.add(this.editor.onDidChangeModelContent((e)=>this.onDidChangeModelContent(e)));
        this.localToDispose.add(this.editor.onDidChangeCursorPosition(()=>this.onCursorPositionChanged()));
        this.localToDispose.add(this.editor.onMouseDown((e)=>this.onEditorMouseDown(e)));
        this.localToDispose.add(this.editor.onMouseUp((e)=>this.onEditorMouseUp(e)));
        this.localToDispose.add({
            dispose: ()=>{
                if (this.foldingRegionPromise) {
                    this.foldingRegionPromise.cancel();
                    this.foldingRegionPromise = null;
                }
                this.updateScheduler?.cancel();
                this.updateScheduler = null;
                this.foldingModel = null;
                this.foldingModelPromise = null;
                this.hiddenRangeModel = null;
                this.cursorChangedScheduler = null;
                this.rangeProvider?.dispose();
                this.rangeProvider = null;
            }
        });
        this.triggerFoldingModelChanged();
    }
    onFoldingStrategyChanged() {
        this.rangeProvider?.dispose();
        this.rangeProvider = null;
        this.triggerFoldingModelChanged();
    }
    getRangeProvider(editorModel) {
        if (this.rangeProvider) return this.rangeProvider;
        const indentRangeProvider = new (0, $b63b4c5971ab4df6$export$c6761242dbde8f79)(editorModel, this.languageConfigurationService, this._foldingLimitReporter);
        this.rangeProvider = indentRangeProvider; // fallback
        if (this._useFoldingProviders && this.foldingModel) {
            const selectedProviders = $bd09b69eb5b6e36a$var$FoldingController_1.getFoldingRangeProviders(this.languageFeaturesService, editorModel);
            if (selectedProviders.length > 0) this.rangeProvider = new (0, $c72542064e6cf486$export$409cdd7e50053250)(editorModel, selectedProviders, ()=>this.triggerFoldingModelChanged(), this._foldingLimitReporter, indentRangeProvider);
        }
        return this.rangeProvider;
    }
    getFoldingModel() {
        return this.foldingModelPromise;
    }
    onDidChangeModelContent(e) {
        this.hiddenRangeModel?.notifyChangeModelContent(e);
        this.triggerFoldingModelChanged();
    }
    triggerFoldingModelChanged() {
        if (this.updateScheduler) {
            if (this.foldingRegionPromise) {
                this.foldingRegionPromise.cancel();
                this.foldingRegionPromise = null;
            }
            this.foldingModelPromise = this.updateScheduler.trigger(()=>{
                const foldingModel = this.foldingModel;
                if (!foldingModel) return null;
                const sw = new (0, $eUQTM.StopWatch)();
                const provider = this.getRangeProvider(foldingModel.textModel);
                const foldingRegionPromise = this.foldingRegionPromise = (0, $6bXyA.createCancelablePromise)((token)=>provider.compute(token));
                return foldingRegionPromise.then((foldingRanges)=>{
                    if (foldingRanges && foldingRegionPromise === this.foldingRegionPromise) {
                        let scrollState;
                        if (this._foldingImportsByDefault && !this._currentModelHasFoldedImports) {
                            const hasChanges = foldingRanges.setCollapsedAllOfType((0, $kzNQX.FoldingRangeKind).Imports.value, true);
                            if (hasChanges) {
                                scrollState = (0, $1RlHY.StableEditorScrollState).capture(this.editor);
                                this._currentModelHasFoldedImports = hasChanges;
                            }
                        }
                        // some cursors might have moved into hidden regions, make sure they are in expanded regions
                        const selections = this.editor.getSelections();
                        foldingModel.update(foldingRanges, $bd09b69eb5b6e36a$export$aa0d99447bbf20d6(selections));
                        scrollState?.restore(this.editor);
                        // update debounce info
                        const newValue = this.updateDebounceInfo.update(foldingModel.textModel, sw.elapsed());
                        if (this.updateScheduler) this.updateScheduler.defaultDelay = newValue;
                    }
                    return foldingModel;
                });
            }).then(undefined, (err)=>{
                (0, $gPkHZ.onUnexpectedError)(err);
                return null;
            });
        }
    }
    onHiddenRangesChanges(hiddenRanges) {
        if (this.hiddenRangeModel && hiddenRanges.length && !this._restoringViewState) {
            const selections = this.editor.getSelections();
            if (selections) {
                if (this.hiddenRangeModel.adjustSelections(selections)) this.editor.setSelections(selections);
            }
        }
        this.editor.setHiddenAreas(hiddenRanges, this);
    }
    onCursorPositionChanged() {
        if (this.hiddenRangeModel && this.hiddenRangeModel.hasRanges()) this.cursorChangedScheduler.schedule();
    }
    revealCursor() {
        const foldingModel = this.getFoldingModel();
        if (!foldingModel) return;
        foldingModel.then((foldingModel)=>{
            if (foldingModel) {
                const selections = this.editor.getSelections();
                if (selections && selections.length > 0) {
                    const toToggle = [];
                    for (const selection of selections){
                        const lineNumber = selection.selectionStartLineNumber;
                        if (this.hiddenRangeModel && this.hiddenRangeModel.isHidden(lineNumber)) toToggle.push(...foldingModel.getAllRegionsAtLine(lineNumber, (r)=>r.isCollapsed && lineNumber > r.startLineNumber));
                    }
                    if (toToggle.length) {
                        foldingModel.toggleCollapseState(toToggle);
                        this.reveal(selections[0].getPosition());
                    }
                }
            }
        }).then(undefined, (0, $gPkHZ.onUnexpectedError));
    }
    onEditorMouseDown(e) {
        this.mouseDownInfo = null;
        if (!this.hiddenRangeModel || !e.target || !e.target.range) return;
        if (!e.event.leftButton && !e.event.middleButton) return;
        const range = e.target.range;
        let iconClicked = false;
        switch(e.target.type){
            case 4 /* MouseTargetType.GUTTER_LINE_DECORATIONS */ :
                {
                    const data = e.target.detail;
                    const offsetLeftInGutter = e.target.element.offsetLeft;
                    const gutterOffsetX = data.offsetX - offsetLeftInGutter;
                    // const gutterOffsetX = data.offsetX - data.glyphMarginWidth - data.lineNumbersWidth - data.glyphMarginLeft;
                    // TODO@joao TODO@alex TODO@martin this is such that we don't collide with dirty diff
                    if (gutterOffsetX < 4) return;
                    iconClicked = true;
                    break;
                }
            case 7 /* MouseTargetType.CONTENT_EMPTY */ :
                if (this._unfoldOnClickAfterEndOfLine && this.hiddenRangeModel.hasRanges()) {
                    const data = e.target.detail;
                    if (!data.isAfterLines) break;
                }
                return;
            case 6 /* MouseTargetType.CONTENT_TEXT */ :
                if (this.hiddenRangeModel.hasRanges()) {
                    const model = this.editor.getModel();
                    if (model && range.startColumn === model.getLineMaxColumn(range.startLineNumber)) break;
                }
                return;
            default:
                return;
        }
        this.mouseDownInfo = {
            lineNumber: range.startLineNumber,
            iconClicked: iconClicked
        };
    }
    onEditorMouseUp(e) {
        const foldingModel = this.foldingModel;
        if (!foldingModel || !this.mouseDownInfo || !e.target) return;
        const lineNumber = this.mouseDownInfo.lineNumber;
        const iconClicked = this.mouseDownInfo.iconClicked;
        const range = e.target.range;
        if (!range || range.startLineNumber !== lineNumber) return;
        if (iconClicked) {
            if (e.target.type !== 4 /* MouseTargetType.GUTTER_LINE_DECORATIONS */ ) return;
        } else {
            const model = this.editor.getModel();
            if (!model || range.startColumn !== model.getLineMaxColumn(lineNumber)) return;
        }
        const region = foldingModel.getRegionAtLine(lineNumber);
        if (region && region.startLineNumber === lineNumber) {
            const isCollapsed = region.isCollapsed;
            if (iconClicked || isCollapsed) {
                const surrounding = e.event.altKey;
                let toToggle = [];
                if (surrounding) {
                    const filter = (otherRegion)=>!otherRegion.containedBy(region) && !region.containedBy(otherRegion);
                    const toMaybeToggle = foldingModel.getRegionsInside(null, filter);
                    for (const r of toMaybeToggle)if (r.isCollapsed) toToggle.push(r);
                    // if any surrounding regions are folded, unfold those. Otherwise, fold all surrounding
                    if (toToggle.length === 0) toToggle = toMaybeToggle;
                } else {
                    const recursive = e.event.middleButton || e.event.shiftKey;
                    if (recursive) {
                        for (const r of foldingModel.getRegionsInside(region))if (r.isCollapsed === isCollapsed) toToggle.push(r);
                    }
                    // when recursive, first only collapse all children. If all are already folded or there are no children, also fold parent.
                    if (isCollapsed || !recursive || toToggle.length === 0) toToggle.push(region);
                }
                foldingModel.toggleCollapseState(toToggle);
                this.reveal({
                    lineNumber: lineNumber,
                    column: 1
                });
            }
        }
    }
    reveal(position) {
        this.editor.revealPositionInCenterIfOutsideViewport(position, 0 /* ScrollType.Smooth */ );
    }
};
$bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8 = $bd09b69eb5b6e36a$var$FoldingController_1 = $bd09b69eb5b6e36a$var$__decorate([
    $bd09b69eb5b6e36a$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $bd09b69eb5b6e36a$var$__param(2, (0, $1qkuR.ILanguageConfigurationService)),
    $bd09b69eb5b6e36a$var$__param(3, (0, $kCOKl.INotificationService)),
    $bd09b69eb5b6e36a$var$__param(4, (0, $goG89.ILanguageFeatureDebounceService)),
    $bd09b69eb5b6e36a$var$__param(5, (0, $4J6fu.ILanguageFeaturesService))
], $bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8);
class $bd09b69eb5b6e36a$export$361d9ddbbcafe779 {
    constructor(editor){
        this.editor = editor;
        this._onDidChange = new (0, $5YaSO.Emitter)();
        this._computed = 0;
        this._limited = false;
    }
    get limit() {
        return this.editor.getOptions().get(47 /* EditorOption.foldingMaximumRegions */ );
    }
    update(computed, limited) {
        if (computed !== this._computed || limited !== this._limited) {
            this._computed = computed;
            this._limited = limited;
            this._onDidChange.fire();
        }
    }
}
class $bd09b69eb5b6e36a$var$FoldingAction extends (0, $2iJTi.EditorAction) {
    runEditorCommand(accessor, editor, args) {
        const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
        const foldingController = $bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8.get(editor);
        if (!foldingController) return;
        const foldingModelPromise = foldingController.getFoldingModel();
        if (foldingModelPromise) {
            this.reportTelemetry(accessor, editor);
            return foldingModelPromise.then((foldingModel)=>{
                if (foldingModel) {
                    this.invoke(foldingController, foldingModel, editor, args, languageConfigurationService);
                    const selection = editor.getSelection();
                    if (selection) foldingController.reveal(selection.getStartPosition());
                }
            });
        }
    }
    getSelectedLines(editor) {
        const selections = editor.getSelections();
        return selections ? selections.map((s)=>s.startLineNumber) : [];
    }
    getLineNumbers(args, editor) {
        if (args && args.selectionLines) return args.selectionLines.map((l)=>l + 1); // to 0-bases line numbers
        return this.getSelectedLines(editor);
    }
    run(_accessor, _editor) {}
}
function $bd09b69eb5b6e36a$export$aa0d99447bbf20d6(selections) {
    if (!selections || selections.length === 0) return {
        startsInside: ()=>false
    };
    return {
        startsInside (startLine, endLine) {
            for (const s of selections){
                const line = s.startLineNumber;
                if (line >= startLine && line <= endLine) return true;
            }
            return false;
        }
    };
}
function $bd09b69eb5b6e36a$var$foldingArgumentsConstraint(args) {
    if (!$bxBg7.isUndefined(args)) {
        if (!$bxBg7.isObject(args)) return false;
        const foldingArgs = args;
        if (!$bxBg7.isUndefined(foldingArgs.levels) && !$bxBg7.isNumber(foldingArgs.levels)) return false;
        if (!$bxBg7.isUndefined(foldingArgs.direction) && !$bxBg7.isString(foldingArgs.direction)) return false;
        if (!$bxBg7.isUndefined(foldingArgs.selectionLines) && (!Array.isArray(foldingArgs.selectionLines) || !foldingArgs.selectionLines.every($bxBg7.isNumber))) return false;
    }
    return true;
}
class $bd09b69eb5b6e36a$var$UnfoldAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.unfold',
            label: $4dEdH.localize('unfoldAction.label', "Unfold"),
            alias: 'Unfold',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3166 /* KeyCode.BracketRight */ ,
                mac: {
                    primary: 2654 /* KeyCode.BracketRight */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: 'Unfold the content in the editor',
                args: [
                    {
                        name: 'Unfold editor argument',
                        description: `Property-value pairs that can be passed through this argument:
						* 'levels': Number of levels to unfold. If not set, defaults to 1.
						* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.
						* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.
						`,
                        constraint: $bd09b69eb5b6e36a$var$foldingArgumentsConstraint,
                        schema: {
                            'type': 'object',
                            'properties': {
                                'levels': {
                                    'type': 'number',
                                    'default': 1
                                },
                                'direction': {
                                    'type': 'string',
                                    'enum': [
                                        'up',
                                        'down'
                                    ],
                                    'default': 'down'
                                },
                                'selectionLines': {
                                    'type': 'array',
                                    'items': {
                                        'type': 'number'
                                    }
                                }
                            }
                        }
                    }
                ]
            }
        });
    }
    invoke(_foldingController, foldingModel, editor, args) {
        const levels = args && args.levels || 1;
        const lineNumbers = this.getLineNumbers(args, editor);
        if (args && args.direction === 'up') (0, $20b0c2d6437739df$export$50a013aaf999fe15)(foldingModel, false, levels, lineNumbers);
        else (0, $20b0c2d6437739df$export$1ef41fe66cd8530)(foldingModel, false, levels, lineNumbers);
    }
}
class $bd09b69eb5b6e36a$var$UnFoldRecursivelyAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.unfoldRecursively',
            label: $4dEdH.localize('unFoldRecursivelyAction.label', "Unfold Recursively"),
            alias: 'Unfold Recursively',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2142 /* KeyCode.BracketRight */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor, _args) {
        (0, $20b0c2d6437739df$export$1ef41fe66cd8530)(foldingModel, false, Number.MAX_VALUE, this.getSelectedLines(editor));
    }
}
class $bd09b69eb5b6e36a$var$FoldAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.fold',
            label: $4dEdH.localize('foldAction.label', "Fold"),
            alias: 'Fold',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3164 /* KeyCode.BracketLeft */ ,
                mac: {
                    primary: 2652 /* KeyCode.BracketLeft */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: 'Fold the content in the editor',
                args: [
                    {
                        name: 'Fold editor argument',
                        description: `Property-value pairs that can be passed through this argument:
							* 'levels': Number of levels to fold.
							* 'direction': If 'up', folds given number of levels up otherwise folds down.
							* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.
							If no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.
						`,
                        constraint: $bd09b69eb5b6e36a$var$foldingArgumentsConstraint,
                        schema: {
                            'type': 'object',
                            'properties': {
                                'levels': {
                                    'type': 'number'
                                },
                                'direction': {
                                    'type': 'string',
                                    'enum': [
                                        'up',
                                        'down'
                                    ]
                                },
                                'selectionLines': {
                                    'type': 'array',
                                    'items': {
                                        'type': 'number'
                                    }
                                }
                            }
                        }
                    }
                ]
            }
        });
    }
    invoke(_foldingController, foldingModel, editor, args) {
        const lineNumbers = this.getLineNumbers(args, editor);
        const levels = args && args.levels;
        const direction = args && args.direction;
        if (typeof levels !== 'number' && typeof direction !== 'string') // fold the region at the location or if already collapsed, the first uncollapsed parent instead.
        (0, $20b0c2d6437739df$export$e1cae19974cbbf8b)(foldingModel, true, lineNumbers);
        else if (direction === 'up') (0, $20b0c2d6437739df$export$50a013aaf999fe15)(foldingModel, true, levels || 1, lineNumbers);
        else (0, $20b0c2d6437739df$export$1ef41fe66cd8530)(foldingModel, true, levels || 1, lineNumbers);
    }
}
class $bd09b69eb5b6e36a$var$ToggleFoldAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.toggleFold',
            label: $4dEdH.localize('toggleFoldAction.label', "Toggle Fold"),
            alias: 'Toggle Fold',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2090 /* KeyCode.KeyL */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        (0, $20b0c2d6437739df$export$6008f8f734d0336a)(foldingModel, 1, selectedLines);
    }
}
class $bd09b69eb5b6e36a$var$FoldRecursivelyAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.foldRecursively',
            label: $4dEdH.localize('foldRecursivelyAction.label', "Fold Recursively"),
            alias: 'Fold Recursively',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2140 /* KeyCode.BracketLeft */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        (0, $20b0c2d6437739df$export$1ef41fe66cd8530)(foldingModel, true, Number.MAX_VALUE, selectedLines);
    }
}
class $bd09b69eb5b6e36a$var$ToggleFoldRecursivelyAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.toggleFoldRecursively',
            label: $4dEdH.localize('toggleFoldRecursivelyAction.label', "Toggle Fold Recursively"),
            alias: 'Toggle Fold Recursively',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 3114 /* KeyCode.KeyL */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        (0, $20b0c2d6437739df$export$6008f8f734d0336a)(foldingModel, Number.MAX_VALUE, selectedLines);
    }
}
class $bd09b69eb5b6e36a$var$FoldAllBlockCommentsAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.foldAllBlockComments',
            label: $4dEdH.localize('foldAllBlockComments.label', "Fold All Block Comments"),
            alias: 'Fold All Block Comments',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2138 /* KeyCode.Slash */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor, args, languageConfigurationService) {
        if (foldingModel.regions.hasTypes()) (0, $20b0c2d6437739df$export$ce3950edac996729)(foldingModel, (0, $kzNQX.FoldingRangeKind).Comment.value, true);
        else {
            const editorModel = editor.getModel();
            if (!editorModel) return;
            const comments = languageConfigurationService.getLanguageConfiguration(editorModel.getLanguageId()).comments;
            if (comments && comments.blockCommentStartToken) {
                const regExp = new RegExp('^\\s*' + (0, $jcr1R.escapeRegExpCharacters)(comments.blockCommentStartToken));
                (0, $20b0c2d6437739df$export$acbcc757d0e877b)(foldingModel, regExp, true);
            }
        }
    }
}
class $bd09b69eb5b6e36a$var$FoldAllRegionsAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.foldAllMarkerRegions',
            label: $4dEdH.localize('foldAllMarkerRegions.label', "Fold All Regions"),
            alias: 'Fold All Regions',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2077 /* KeyCode.Digit8 */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor, args, languageConfigurationService) {
        if (foldingModel.regions.hasTypes()) (0, $20b0c2d6437739df$export$ce3950edac996729)(foldingModel, (0, $kzNQX.FoldingRangeKind).Region.value, true);
        else {
            const editorModel = editor.getModel();
            if (!editorModel) return;
            const foldingRules = languageConfigurationService.getLanguageConfiguration(editorModel.getLanguageId()).foldingRules;
            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {
                const regExp = new RegExp(foldingRules.markers.start);
                (0, $20b0c2d6437739df$export$acbcc757d0e877b)(foldingModel, regExp, true);
            }
        }
    }
}
class $bd09b69eb5b6e36a$var$UnfoldAllRegionsAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.unfoldAllMarkerRegions',
            label: $4dEdH.localize('unfoldAllMarkerRegions.label', "Unfold All Regions"),
            alias: 'Unfold All Regions',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2078 /* KeyCode.Digit9 */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor, args, languageConfigurationService) {
        if (foldingModel.regions.hasTypes()) (0, $20b0c2d6437739df$export$ce3950edac996729)(foldingModel, (0, $kzNQX.FoldingRangeKind).Region.value, false);
        else {
            const editorModel = editor.getModel();
            if (!editorModel) return;
            const foldingRules = languageConfigurationService.getLanguageConfiguration(editorModel.getLanguageId()).foldingRules;
            if (foldingRules && foldingRules.markers && foldingRules.markers.start) {
                const regExp = new RegExp(foldingRules.markers.start);
                (0, $20b0c2d6437739df$export$acbcc757d0e877b)(foldingModel, regExp, false);
            }
        }
    }
}
class $bd09b69eb5b6e36a$var$FoldAllExceptAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.foldAllExcept',
            label: $4dEdH.localize('foldAllExcept.label', "Fold All Except Selected"),
            alias: 'Fold All Except Selected',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2136 /* KeyCode.Minus */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        (0, $20b0c2d6437739df$export$13292d9dd11d6b4f)(foldingModel, true, selectedLines);
    }
}
class $bd09b69eb5b6e36a$var$UnfoldAllExceptAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.unfoldAllExcept',
            label: $4dEdH.localize('unfoldAllExcept.label', "Unfold All Except Selected"),
            alias: 'Unfold All Except Selected',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2134 /* KeyCode.Equal */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        (0, $20b0c2d6437739df$export$13292d9dd11d6b4f)(foldingModel, false, selectedLines);
    }
}
class $bd09b69eb5b6e36a$var$FoldAllAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.foldAll',
            label: $4dEdH.localize('foldAllAction.label', "Fold All"),
            alias: 'Fold All',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2069 /* KeyCode.Digit0 */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, _editor) {
        (0, $20b0c2d6437739df$export$1ef41fe66cd8530)(foldingModel, true);
    }
}
class $bd09b69eb5b6e36a$var$UnfoldAllAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.unfoldAll',
            label: $4dEdH.localize('unfoldAllAction.label', "Unfold All"),
            alias: 'Unfold All',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2088 /* KeyCode.KeyJ */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, _editor) {
        (0, $20b0c2d6437739df$export$1ef41fe66cd8530)(foldingModel, false);
    }
}
class $bd09b69eb5b6e36a$var$FoldLevelAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    static{
        this.ID_PREFIX = 'editor.foldLevel';
    }
    static{
        this.ID = (level)=>$bd09b69eb5b6e36a$var$FoldLevelAction.ID_PREFIX + level;
    }
    getFoldingLevel() {
        return parseInt(this.id.substr($bd09b69eb5b6e36a$var$FoldLevelAction.ID_PREFIX.length));
    }
    invoke(_foldingController, foldingModel, editor) {
        (0, $20b0c2d6437739df$export$3f9d91c844738bc6)(foldingModel, this.getFoldingLevel(), true, this.getSelectedLines(editor));
    }
}
/** Action to go to the parent fold of current line */ class $bd09b69eb5b6e36a$var$GotoParentFoldAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.gotoParentFold',
            label: $4dEdH.localize('gotoParentFold.label', "Go to Parent Fold"),
            alias: 'Go to Parent Fold',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        if (selectedLines.length > 0) {
            const startLineNumber = (0, $20b0c2d6437739df$export$19eab21a9895dbc4)(selectedLines[0], foldingModel);
            if (startLineNumber !== null) editor.setSelection({
                startLineNumber: startLineNumber,
                startColumn: 1,
                endLineNumber: startLineNumber,
                endColumn: 1
            });
        }
    }
}
/** Action to go to the previous fold of current line */ class $bd09b69eb5b6e36a$var$GotoPreviousFoldAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.gotoPreviousFold',
            label: $4dEdH.localize('gotoPreviousFold.label', "Go to Previous Folding Range"),
            alias: 'Go to Previous Folding Range',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        if (selectedLines.length > 0) {
            const startLineNumber = (0, $20b0c2d6437739df$export$9e804e9f47adba4e)(selectedLines[0], foldingModel);
            if (startLineNumber !== null) editor.setSelection({
                startLineNumber: startLineNumber,
                startColumn: 1,
                endLineNumber: startLineNumber,
                endColumn: 1
            });
        }
    }
}
/** Action to go to the next fold of current line */ class $bd09b69eb5b6e36a$var$GotoNextFoldAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.gotoNextFold',
            label: $4dEdH.localize('gotoNextFold.label', "Go to Next Folding Range"),
            alias: 'Go to Next Folding Range',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const selectedLines = this.getSelectedLines(editor);
        if (selectedLines.length > 0) {
            const startLineNumber = (0, $20b0c2d6437739df$export$3164a73fda220264)(selectedLines[0], foldingModel);
            if (startLineNumber !== null) editor.setSelection({
                startLineNumber: startLineNumber,
                startColumn: 1,
                endLineNumber: startLineNumber,
                endColumn: 1
            });
        }
    }
}
class $bd09b69eb5b6e36a$var$FoldRangeFromSelectionAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.createFoldingRangeFromSelection',
            label: $4dEdH.localize('createManualFoldRange.label', "Create Folding Range from Selection"),
            alias: 'Create Folding Range from Selection',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2135 /* KeyCode.Comma */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(_foldingController, foldingModel, editor) {
        const collapseRanges = [];
        const selections = editor.getSelections();
        if (selections) {
            for (const selection of selections){
                let endLineNumber = selection.endLineNumber;
                if (selection.endColumn === 1) --endLineNumber;
                if (endLineNumber > selection.startLineNumber) {
                    collapseRanges.push({
                        startLineNumber: selection.startLineNumber,
                        endLineNumber: endLineNumber,
                        type: undefined,
                        isCollapsed: true,
                        source: 1 /* FoldSource.userDefined */ 
                    });
                    editor.setSelection({
                        startLineNumber: selection.startLineNumber,
                        startColumn: 1,
                        endLineNumber: selection.startLineNumber,
                        endColumn: 1
                    });
                }
            }
            if (collapseRanges.length > 0) {
                collapseRanges.sort((a, b)=>{
                    return a.startLineNumber - b.startLineNumber;
                });
                const newRanges = (0, $8c013aba2f73f7e1$export$79a27591b52924cb).sanitizeAndMerge(foldingModel.regions, collapseRanges, editor.getModel()?.getLineCount());
                foldingModel.updatePost((0, $8c013aba2f73f7e1$export$79a27591b52924cb).fromFoldRanges(newRanges));
            }
        }
    }
}
class $bd09b69eb5b6e36a$var$RemoveFoldRangeFromSelectionAction extends $bd09b69eb5b6e36a$var$FoldingAction {
    constructor(){
        super({
            id: 'editor.removeManualFoldingRanges',
            label: $4dEdH.localize('removeManualFoldingRanges.label', "Remove Manual Folding Ranges"),
            alias: 'Remove Manual Folding Ranges',
            precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2137 /* KeyCode.Period */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    invoke(foldingController, foldingModel, editor) {
        const selections = editor.getSelections();
        if (selections) {
            const ranges = [];
            for (const selection of selections){
                const { startLineNumber: startLineNumber, endLineNumber: endLineNumber } = selection;
                ranges.push(endLineNumber >= startLineNumber ? {
                    startLineNumber: startLineNumber,
                    endLineNumber: endLineNumber
                } : {
                    endLineNumber: endLineNumber,
                    startLineNumber: startLineNumber
                });
            }
            foldingModel.removeManualRanges(ranges);
            foldingController.triggerFoldingModelChanged();
        }
    }
}
(0, $2iJTi.registerEditorContribution)($bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8.ID, $bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8, 0 /* EditorContributionInstantiation.Eager */ ); // eager because it uses `saveViewState`/`restoreViewState`
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$UnfoldAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$UnFoldRecursivelyAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$FoldAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$FoldRecursivelyAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$ToggleFoldRecursivelyAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$FoldAllAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$UnfoldAllAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$FoldAllBlockCommentsAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$FoldAllRegionsAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$UnfoldAllRegionsAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$FoldAllExceptAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$UnfoldAllExceptAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$ToggleFoldAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$GotoParentFoldAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$GotoPreviousFoldAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$GotoNextFoldAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$FoldRangeFromSelectionAction);
(0, $2iJTi.registerEditorAction)($bd09b69eb5b6e36a$var$RemoveFoldRangeFromSelectionAction);
for(let i = 1; i <= 7; i++)(0, $2iJTi.registerInstantiatedEditorAction)(new $bd09b69eb5b6e36a$var$FoldLevelAction({
    id: $bd09b69eb5b6e36a$var$FoldLevelAction.ID(i),
    label: $4dEdH.localize('foldLevelAction.label', "Fold Level {0}", i),
    alias: `Fold Level ${i}`,
    precondition: $bd09b69eb5b6e36a$var$CONTEXT_FOLDING_ENABLED,
    kbOpts: {
        kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
        primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2048 /* KeyMod.CtrlCmd */  | 21 /* KeyCode.Digit0 */  + i),
        weight: 100 /* KeybindingWeight.EditorContrib */ 
    }
}));
(0, $8tcMz.CommandsRegistry).registerCommand('_executeFoldingRangeProvider', async function(accessor, ...args) {
    const [resource] = args;
    if (!(resource instanceof (0, $5OJ54.URI))) throw (0, $gPkHZ.illegalArgument)();
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(resource);
    if (!model) throw (0, $gPkHZ.illegalArgument)();
    const configurationService = accessor.get((0, $35IZ9.IConfigurationService));
    if (!configurationService.getValue('editor.folding', {
        resource: resource
    })) return [];
    const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
    const strategy = configurationService.getValue('editor.foldingStrategy', {
        resource: resource
    });
    const foldingLimitReporter = {
        get limit () {
            return configurationService.getValue('editor.foldingMaximumRegions', {
                resource: resource
            });
        },
        update: (computed, limited)=>{}
    };
    const indentRangeProvider = new (0, $b63b4c5971ab4df6$export$c6761242dbde8f79)(model, languageConfigurationService, foldingLimitReporter);
    let rangeProvider = indentRangeProvider;
    if (strategy !== 'indentation') {
        const providers = $bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8.getFoldingRangeProviders(languageFeaturesService, model);
        if (providers.length) rangeProvider = new (0, $c72542064e6cf486$export$409cdd7e50053250)(model, providers, ()=>{}, foldingLimitReporter, indentRangeProvider);
    }
    const ranges = await rangeProvider.compute((0, $giPcZ.CancellationToken).None);
    const result = [];
    try {
        if (ranges) for(let i = 0; i < ranges.length; i++){
            const type = ranges.getType(i);
            result.push({
                start: ranges.getStartLineNumber(i),
                end: ranges.getEndLineNumber(i),
                kind: type ? (0, $kzNQX.FoldingRangeKind).fromValue(type) : undefined
            });
        }
        return result;
    } finally{
        rangeProvider.dispose();
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $kNF1e = parcelRequire("kNF1e");

var $4dEdH = parcelRequire("4dEdH");
class $0641c82b274aa55a$var$EditorFontZoomIn extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.fontZoomIn',
            label: $4dEdH.localize('EditorFontZoomIn.label', "Increase Editor Font Size"),
            alias: 'Increase Editor Font Size',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        (0, $kNF1e.EditorZoom).setZoomLevel((0, $kNF1e.EditorZoom).getZoomLevel() + 1);
    }
}
class $0641c82b274aa55a$var$EditorFontZoomOut extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.fontZoomOut',
            label: $4dEdH.localize('EditorFontZoomOut.label', "Decrease Editor Font Size"),
            alias: 'Decrease Editor Font Size',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        (0, $kNF1e.EditorZoom).setZoomLevel((0, $kNF1e.EditorZoom).getZoomLevel() - 1);
    }
}
class $0641c82b274aa55a$var$EditorFontZoomReset extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.fontZoomReset',
            label: $4dEdH.localize('EditorFontZoomReset.label', "Reset Editor Font Size"),
            alias: 'Reset Editor Font Size',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        (0, $kNF1e.EditorZoom).setZoomLevel(0);
    }
}
(0, $2iJTi.registerEditorAction)($0641c82b274aa55a$var$EditorFontZoomIn);
(0, $2iJTi.registerEditorAction)($0641c82b274aa55a$var$EditorFontZoomOut);
(0, $2iJTi.registerEditorAction)($0641c82b274aa55a$var$EditorFontZoomReset);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $fuc8X = parcelRequire("fuc8X");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $kNeNo = parcelRequire("kNeNo");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $zvLvK = parcelRequire("zvLvK");

var $4J6fu = parcelRequire("4J6fu");

var $2NhuV = parcelRequire("2NhuV");

var $2iGkV = parcelRequire("2iGkV");

var $4dEdH = parcelRequire("4dEdH");

var $aF3f5 = parcelRequire("aF3f5");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $4E7vx = parcelRequire("4E7vx");
var $342a66c5f80c95c5$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $342a66c5f80c95c5$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $342a66c5f80c95c5$export$5568bcf6992cdc01 = class FormatOnType {
    static{
        this.ID = 'editor.contrib.autoFormat';
    }
    constructor(_editor, _languageFeaturesService, _workerService, _accessibilitySignalService){
        this._editor = _editor;
        this._languageFeaturesService = _languageFeaturesService;
        this._workerService = _workerService;
        this._accessibilitySignalService = _accessibilitySignalService;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._sessionDisposables = new (0, $9cWcn.DisposableStore)();
        this._disposables.add(_languageFeaturesService.onTypeFormattingEditProvider.onDidChange(this._update, this));
        this._disposables.add(_editor.onDidChangeModel(()=>this._update()));
        this._disposables.add(_editor.onDidChangeModelLanguage(()=>this._update()));
        this._disposables.add(_editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(56 /* EditorOption.formatOnType */ )) this._update();
        }));
        this._update();
    }
    dispose() {
        this._disposables.dispose();
        this._sessionDisposables.dispose();
    }
    _update() {
        // clean up
        this._sessionDisposables.clear();
        // we are disabled
        if (!this._editor.getOption(56 /* EditorOption.formatOnType */ )) return;
        // no model
        if (!this._editor.hasModel()) return;
        const model = this._editor.getModel();
        // no support
        const [support] = this._languageFeaturesService.onTypeFormattingEditProvider.ordered(model);
        if (!support || !support.autoFormatTriggerCharacters) return;
        // register typing listeners that will trigger the format
        const triggerChars = new (0, $kNeNo.CharacterSet)();
        for (const ch of support.autoFormatTriggerCharacters)triggerChars.add(ch.charCodeAt(0));
        this._sessionDisposables.add(this._editor.onDidType((text)=>{
            const lastCharCode = text.charCodeAt(text.length - 1);
            if (triggerChars.has(lastCharCode)) this._trigger(String.fromCharCode(lastCharCode));
        }));
    }
    _trigger(ch) {
        if (!this._editor.hasModel()) return;
        if (this._editor.getSelections().length > 1 || !this._editor.getSelection().isEmpty()) return;
        const model = this._editor.getModel();
        const position = this._editor.getPosition();
        const cts = new (0, $giPcZ.CancellationTokenSource)();
        // install a listener that checks if edits happens before the
        // position on which we format right now. If so, we won't
        // apply the format edits
        const unbind = this._editor.onDidChangeModelContent((e)=>{
            if (e.isFlush) {
                // a model.setValue() was called
                // cancel only once
                cts.cancel();
                unbind.dispose();
                return;
            }
            for(let i = 0, len = e.changes.length; i < len; i++){
                const change = e.changes[i];
                if (change.range.endLineNumber <= position.lineNumber) {
                    // cancel only once
                    cts.cancel();
                    unbind.dispose();
                    return;
                }
            }
        });
        (0, $2NhuV.getOnTypeFormattingEdits)(this._workerService, this._languageFeaturesService, model, position, ch, model.getFormattingOptions(), cts.token).then((edits)=>{
            if (cts.token.isCancellationRequested) return;
            if ((0, $kJ8UG.isNonEmptyArray)(edits)) {
                this._accessibilitySignalService.playSignal((0, $aF3f5.AccessibilitySignal).format, {
                    userGesture: false
                });
                (0, $2iGkV.FormattingEdit).execute(this._editor, edits, true);
            }
        }).finally(()=>{
            unbind.dispose();
        });
    }
};
$342a66c5f80c95c5$export$5568bcf6992cdc01 = $342a66c5f80c95c5$var$__decorate([
    $342a66c5f80c95c5$var$__param(1, (0, $4J6fu.ILanguageFeaturesService)),
    $342a66c5f80c95c5$var$__param(2, (0, $zvLvK.IEditorWorkerService)),
    $342a66c5f80c95c5$var$__param(3, (0, $aF3f5.IAccessibilitySignalService))
], $342a66c5f80c95c5$export$5568bcf6992cdc01);
let $342a66c5f80c95c5$var$FormatOnPaste = class FormatOnPaste {
    static{
        this.ID = 'editor.contrib.formatOnPaste';
    }
    constructor(editor, _languageFeaturesService, _instantiationService){
        this.editor = editor;
        this._languageFeaturesService = _languageFeaturesService;
        this._instantiationService = _instantiationService;
        this._callOnDispose = new (0, $9cWcn.DisposableStore)();
        this._callOnModel = new (0, $9cWcn.DisposableStore)();
        this._callOnDispose.add(editor.onDidChangeConfiguration(()=>this._update()));
        this._callOnDispose.add(editor.onDidChangeModel(()=>this._update()));
        this._callOnDispose.add(editor.onDidChangeModelLanguage(()=>this._update()));
        this._callOnDispose.add(_languageFeaturesService.documentRangeFormattingEditProvider.onDidChange(this._update, this));
    }
    dispose() {
        this._callOnDispose.dispose();
        this._callOnModel.dispose();
    }
    _update() {
        // clean up
        this._callOnModel.clear();
        // we are disabled
        if (!this.editor.getOption(55 /* EditorOption.formatOnPaste */ )) return;
        // no model
        if (!this.editor.hasModel()) return;
        // no formatter
        if (!this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())) return;
        this._callOnModel.add(this.editor.onDidPaste(({ range: range })=>this._trigger(range)));
    }
    _trigger(range) {
        if (!this.editor.hasModel()) return;
        if (this.editor.getSelections().length > 1) return;
        this._instantiationService.invokeFunction((0, $2NhuV.formatDocumentRangesWithSelectedProvider), this.editor, range, 2 /* FormattingMode.Silent */ , (0, $4E7vx.Progress).None, (0, $giPcZ.CancellationToken).None, false).catch((0, $gPkHZ.onUnexpectedError));
    }
};
$342a66c5f80c95c5$var$FormatOnPaste = $342a66c5f80c95c5$var$__decorate([
    $342a66c5f80c95c5$var$__param(1, (0, $4J6fu.ILanguageFeaturesService)),
    $342a66c5f80c95c5$var$__param(2, (0, $fdGPu.IInstantiationService))
], $342a66c5f80c95c5$var$FormatOnPaste);
class $342a66c5f80c95c5$var$FormatDocumentAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.formatDocument',
            label: $4dEdH.localize('formatDocument.label', "Format Document"),
            alias: 'Format Document',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).notInCompositeEditor, (0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasDocumentFormattingProvider),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1572 /* KeyCode.KeyF */ ,
                linux: {
                    primary: 3111 /* KeyCode.KeyI */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            contextMenuOpts: {
                group: '1_modification',
                order: 1.3
            }
        });
    }
    async run(accessor, editor) {
        if (editor.hasModel()) {
            const instaService = accessor.get((0, $fdGPu.IInstantiationService));
            const progressService = accessor.get((0, $4E7vx.IEditorProgressService));
            await progressService.showWhile(instaService.invokeFunction((0, $2NhuV.formatDocumentWithSelectedProvider), editor, 1 /* FormattingMode.Explicit */ , (0, $4E7vx.Progress).None, (0, $giPcZ.CancellationToken).None, true), 250);
        }
    }
}
class $342a66c5f80c95c5$var$FormatSelectionAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.formatSelection',
            label: $4dEdH.localize('formatSelection.label', "Format Selection"),
            alias: 'Format Selection',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasDocumentSelectionFormattingProvider),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2084 /* KeyCode.KeyF */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            contextMenuOpts: {
                when: (0, $ibKGQ.EditorContextKeys).hasNonEmptySelection,
                group: '1_modification',
                order: 1.31
            }
        });
    }
    async run(accessor, editor) {
        if (!editor.hasModel()) return;
        const instaService = accessor.get((0, $fdGPu.IInstantiationService));
        const model = editor.getModel();
        const ranges = editor.getSelections().map((range)=>{
            return range.isEmpty() ? new (0, $d00il.Range)(range.startLineNumber, 1, range.startLineNumber, model.getLineMaxColumn(range.startLineNumber)) : range;
        });
        const progressService = accessor.get((0, $4E7vx.IEditorProgressService));
        await progressService.showWhile(instaService.invokeFunction((0, $2NhuV.formatDocumentRangesWithSelectedProvider), editor, ranges, 1 /* FormattingMode.Explicit */ , (0, $4E7vx.Progress).None, (0, $giPcZ.CancellationToken).None, true), 250);
    }
}
(0, $2iJTi.registerEditorContribution)($342a66c5f80c95c5$export$5568bcf6992cdc01.ID, $342a66c5f80c95c5$export$5568bcf6992cdc01, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorContribution)($342a66c5f80c95c5$var$FormatOnPaste.ID, $342a66c5f80c95c5$var$FormatOnPaste, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorAction)($342a66c5f80c95c5$var$FormatDocumentAction);
(0, $2iJTi.registerEditorAction)($342a66c5f80c95c5$var$FormatSelectionAction);
// this is the old format action that does both (format document OR format selection)
// and we keep it here such that existing keybinding configurations etc will still work
(0, $8tcMz.CommandsRegistry).registerCommand('editor.action.format', async (accessor)=>{
    const editor = accessor.get((0, $2Qfl0.ICodeEditorService)).getFocusedCodeEditor();
    if (!editor || !editor.hasModel()) return;
    const commandService = accessor.get((0, $8tcMz.ICommandService));
    if (editor.getSelection().isEmpty()) await commandService.executeCommand('editor.action.formatDocument');
    else await commandService.executeCommand('editor.action.formatSelection');
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $aTkrt = parcelRequire("aTkrt");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $6CAkM = parcelRequire("6CAkM");

var $askDf = parcelRequire("askDf");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $goG89 = parcelRequire("goG89");

var $fdGPu = parcelRequire("fdGPu");

var $lf2vF = parcelRequire("lf2vF");

var $cKKJT = parcelRequire("cKKJT");

var $9cWcn = parcelRequire("9cWcn");

var $4J6fu = parcelRequire("4J6fu");
var $7f863e6a161b6d9f$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $7f863e6a161b6d9f$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $7f863e6a161b6d9f$export$3d0d7bb22e2f1e43 {
    remove() {
        this.parent?.children.delete(this.id);
    }
    static findId(candidate, container) {
        // complex id-computation which contains the origin/extension,
        // the parent path, and some dedupe logic when names collide
        let candidateId;
        if (typeof candidate === 'string') candidateId = `${container.id}/${candidate}`;
        else {
            candidateId = `${container.id}/${candidate.name}`;
            if (container.children.get(candidateId) !== undefined) candidateId = `${container.id}/${candidate.name}_${candidate.range.startLineNumber}_${candidate.range.startColumn}`;
        }
        let id = candidateId;
        for(let i = 0; container.children.get(id) !== undefined; i++)id = `${candidateId}_${i}`;
        return id;
    }
    static empty(element) {
        return element.children.size === 0;
    }
}
class $7f863e6a161b6d9f$export$116fbcc3cc8d593 extends $7f863e6a161b6d9f$export$3d0d7bb22e2f1e43 {
    constructor(id, parent, symbol){
        super();
        this.id = id;
        this.parent = parent;
        this.symbol = symbol;
        this.children = new Map();
    }
}
class $7f863e6a161b6d9f$export$7979c5ef85019928 extends $7f863e6a161b6d9f$export$3d0d7bb22e2f1e43 {
    constructor(id, parent, label, order){
        super();
        this.id = id;
        this.parent = parent;
        this.label = label;
        this.order = order;
        this.children = new Map();
    }
}
class $7f863e6a161b6d9f$export$23911836525ed42c extends $7f863e6a161b6d9f$export$3d0d7bb22e2f1e43 {
    static create(registry, textModel, token) {
        const cts = new (0, $giPcZ.CancellationTokenSource)(token);
        const result = new $7f863e6a161b6d9f$export$23911836525ed42c(textModel.uri);
        const provider = registry.ordered(textModel);
        const promises = provider.map((provider, index)=>{
            const id = $7f863e6a161b6d9f$export$3d0d7bb22e2f1e43.findId(`provider_${index}`, result);
            const group = new $7f863e6a161b6d9f$export$7979c5ef85019928(id, result, provider.displayName ?? 'Unknown Outline Provider', index);
            return Promise.resolve(provider.provideDocumentSymbols(textModel, cts.token)).then((result)=>{
                for (const info of result || [])$7f863e6a161b6d9f$export$23911836525ed42c._makeOutlineElement(info, group);
                return group;
            }, (err)=>{
                (0, $gPkHZ.onUnexpectedExternalError)(err);
                return group;
            }).then((group)=>{
                if (!$7f863e6a161b6d9f$export$3d0d7bb22e2f1e43.empty(group)) result._groups.set(id, group);
                else group.remove();
            });
        });
        const listener = registry.onDidChange(()=>{
            const newProvider = registry.ordered(textModel);
            if (!(0, $kJ8UG.equals)(newProvider, provider)) cts.cancel();
        });
        return Promise.all(promises).then(()=>{
            if (cts.token.isCancellationRequested && !token.isCancellationRequested) return $7f863e6a161b6d9f$export$23911836525ed42c.create(registry, textModel, token);
            else return result._compact();
        }).finally(()=>{
            cts.dispose();
            listener.dispose();
            cts.dispose();
        });
    }
    static _makeOutlineElement(info, container) {
        const id = $7f863e6a161b6d9f$export$3d0d7bb22e2f1e43.findId(info, container);
        const res = new $7f863e6a161b6d9f$export$116fbcc3cc8d593(id, container, info);
        if (info.children) for (const childInfo of info.children)$7f863e6a161b6d9f$export$23911836525ed42c._makeOutlineElement(childInfo, res);
        container.children.set(res.id, res);
    }
    constructor(uri){
        super();
        this.uri = uri;
        this.id = 'root';
        this.parent = undefined;
        this._groups = new Map();
        this.children = new Map();
        this.id = 'root';
        this.parent = undefined;
    }
    _compact() {
        let count = 0;
        for (const [key, group] of this._groups)if (group.children.size === 0) this._groups.delete(key);
        else count += 1;
        if (count !== 1) //
        this.children = this._groups;
        else {
            // adopt all elements of the first group
            const group = (0, $6CAkM.Iterable).first(this._groups.values());
            for (const [, child] of group.children){
                child.parent = this;
                this.children.set(child.id, child);
            }
        }
        return this;
    }
    getTopLevelSymbols() {
        const roots = [];
        for (const child of this.children.values())if (child instanceof $7f863e6a161b6d9f$export$116fbcc3cc8d593) roots.push(child.symbol);
        else roots.push(...(0, $6CAkM.Iterable).map(child.children.values(), (child)=>child.symbol));
        return roots.sort((a, b)=>(0, $d00il.Range).compareRangesUsingStarts(a.range, b.range));
    }
    asListOfDocumentSymbols() {
        const roots = this.getTopLevelSymbols();
        const bucket = [];
        $7f863e6a161b6d9f$export$23911836525ed42c._flattenDocumentSymbols(bucket, roots, '');
        return bucket.sort((a, b)=>(0, $dcxQ7.Position).compare((0, $d00il.Range).getStartPosition(a.range), (0, $d00il.Range).getStartPosition(b.range)) || (0, $dcxQ7.Position).compare((0, $d00il.Range).getEndPosition(b.range), (0, $d00il.Range).getEndPosition(a.range)));
    }
    static _flattenDocumentSymbols(bucket, entries, overrideContainerLabel) {
        for (const entry of entries){
            bucket.push({
                kind: entry.kind,
                tags: entry.tags,
                name: entry.name,
                detail: entry.detail,
                containerName: entry.containerName || overrideContainerLabel,
                range: entry.range,
                selectionRange: entry.selectionRange,
                children: undefined
            });
            // Recurse over children
            if (entry.children) $7f863e6a161b6d9f$export$23911836525ed42c._flattenDocumentSymbols(bucket, entry.children, entry.name);
        }
    }
}
const $7f863e6a161b6d9f$export$8065412b6c424633 = (0, $fdGPu.createDecorator)('IOutlineModelService');
let $7f863e6a161b6d9f$export$13f9e14d1844b711 = class OutlineModelService {
    constructor(_languageFeaturesService, debounces, modelService){
        this._languageFeaturesService = _languageFeaturesService;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._cache = new (0, $askDf.LRUCache)(10, 0.7);
        this._debounceInformation = debounces.for(_languageFeaturesService.documentSymbolProvider, 'DocumentSymbols', {
            min: 350
        });
        // don't cache outline models longer than their text model
        this._disposables.add(modelService.onModelRemoved((textModel)=>{
            this._cache.delete(textModel.id);
        }));
    }
    dispose() {
        this._disposables.dispose();
    }
    async getOrCreate(textModel, token) {
        const registry = this._languageFeaturesService.documentSymbolProvider;
        const provider = registry.ordered(textModel);
        let data = this._cache.get(textModel.id);
        if (!data || data.versionId !== textModel.getVersionId() || !(0, $kJ8UG.equals)(data.provider, provider)) {
            const source = new (0, $giPcZ.CancellationTokenSource)();
            data = {
                versionId: textModel.getVersionId(),
                provider: provider,
                promiseCnt: 0,
                source: source,
                promise: $7f863e6a161b6d9f$export$23911836525ed42c.create(registry, textModel, source.token),
                model: undefined
            };
            this._cache.set(textModel.id, data);
            const now = Date.now();
            data.promise.then((outlineModel)=>{
                data.model = outlineModel;
                this._debounceInformation.update(textModel, Date.now() - now);
            }).catch((_err)=>{
                this._cache.delete(textModel.id);
            });
        }
        if (data.model) // resolved -> return data
        return data.model;
        // increase usage counter
        data.promiseCnt += 1;
        const listener = token.onCancellationRequested(()=>{
            // last -> cancel provider request, remove cached promise
            if (--data.promiseCnt === 0) {
                data.source.cancel();
                this._cache.delete(textModel.id);
            }
        });
        try {
            return await data.promise;
        } finally{
            listener.dispose();
        }
    }
};
$7f863e6a161b6d9f$export$13f9e14d1844b711 = $7f863e6a161b6d9f$var$__decorate([
    $7f863e6a161b6d9f$var$__param(0, (0, $4J6fu.ILanguageFeaturesService)),
    $7f863e6a161b6d9f$var$__param(1, (0, $goG89.ILanguageFeatureDebounceService)),
    $7f863e6a161b6d9f$var$__param(2, (0, $cKKJT.IModelService))
], $7f863e6a161b6d9f$export$13f9e14d1844b711);
(0, $lf2vF.registerSingleton)($7f863e6a161b6d9f$export$8065412b6c424633, $7f863e6a161b6d9f$export$13f9e14d1844b711, 1 /* InstantiationType.Delayed */ );



var $8tcMz = parcelRequire("8tcMz");
(0, $8tcMz.CommandsRegistry).registerCommand('_executeDocumentSymbolProvider', async function(accessor, ...args) {
    const [resource] = args;
    (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(resource));
    const outlineService = accessor.get((0, $7f863e6a161b6d9f$export$8065412b6c424633));
    const modelService = accessor.get((0, $aTkrt.ITextModelService));
    const reference = await modelService.createModelReference(resource);
    try {
        return (await outlineService.getOrCreate(reference.object.textEditorModel, (0, $giPcZ.CancellationToken).None)).getTopLevelSymbols();
    } finally{
        reference.dispose();
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4fzqs = parcelRequire("4fzqs");

var $fDQAu = parcelRequire("fDQAu");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4fzqs = parcelRequire("4fzqs");

var $jcr1R = parcelRequire("jcr1R");

var $e1imz = parcelRequire("e1imz");

var $cxCeF = parcelRequire("cxCeF");

var $9cWcn = parcelRequire("9cWcn");

var $4dEdH = parcelRequire("4dEdH");
class $fdd9e34afddebc6c$export$59492a7812ea15ae extends (0, $9cWcn.Disposable) {
    static{
        this.inlineSuggestionVisible = new (0, $cxCeF.RawContextKey)('inlineSuggestionVisible', false, (0, $4dEdH.localize)('inlineSuggestionVisible', "Whether an inline suggestion is visible"));
    }
    static{
        this.inlineSuggestionHasIndentation = new (0, $cxCeF.RawContextKey)('inlineSuggestionHasIndentation', false, (0, $4dEdH.localize)('inlineSuggestionHasIndentation', "Whether the inline suggestion starts with whitespace"));
    }
    static{
        this.inlineSuggestionHasIndentationLessThanTabSize = new (0, $cxCeF.RawContextKey)('inlineSuggestionHasIndentationLessThanTabSize', true, (0, $4dEdH.localize)('inlineSuggestionHasIndentationLessThanTabSize', "Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab"));
    }
    static{
        this.suppressSuggestions = new (0, $cxCeF.RawContextKey)('inlineSuggestionSuppressSuggestions', undefined, (0, $4dEdH.localize)('suppressSuggestions', "Whether suggestions should be suppressed for the current suggestion"));
    }
    constructor(contextKeyService, model){
        super();
        this.contextKeyService = contextKeyService;
        this.model = model;
        this.inlineCompletionVisible = $fdd9e34afddebc6c$export$59492a7812ea15ae.inlineSuggestionVisible.bindTo(this.contextKeyService);
        this.inlineCompletionSuggestsIndentation = $fdd9e34afddebc6c$export$59492a7812ea15ae.inlineSuggestionHasIndentation.bindTo(this.contextKeyService);
        this.inlineCompletionSuggestsIndentationLessThanTabSize = $fdd9e34afddebc6c$export$59492a7812ea15ae.inlineSuggestionHasIndentationLessThanTabSize.bindTo(this.contextKeyService);
        this.suppressSuggestions = $fdd9e34afddebc6c$export$59492a7812ea15ae.suppressSuggestions.bindTo(this.contextKeyService);
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description update context key: inlineCompletionVisible, suppressSuggestions */ const model = this.model.read(reader);
            const state = model?.state.read(reader);
            const isInlineCompletionVisible = !!state?.inlineCompletion && state?.primaryGhostText !== undefined && !state?.primaryGhostText.isEmpty();
            this.inlineCompletionVisible.set(isInlineCompletionVisible);
            if (state?.primaryGhostText && state?.inlineCompletion) this.suppressSuggestions.set(state.inlineCompletion.inlineCompletion.source.inlineCompletions.suppressSuggestions);
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description update context key: inlineCompletionSuggestsIndentation, inlineCompletionSuggestsIndentationLessThanTabSize */ const model = this.model.read(reader);
            let startsWithIndentation = false;
            let startsWithIndentationLessThanTabSize = true;
            const ghostText = model?.primaryGhostText.read(reader);
            if (!!model?.selectedSuggestItem && ghostText && ghostText.parts.length > 0) {
                const { column: column, lines: lines } = ghostText.parts[0];
                const firstLine = lines[0];
                const indentationEndColumn = model.textModel.getLineIndentColumn(ghostText.lineNumber);
                const inIndentation = column <= indentationEndColumn;
                if (inIndentation) {
                    let firstNonWsIdx = (0, $jcr1R.firstNonWhitespaceIndex)(firstLine);
                    if (firstNonWsIdx === -1) firstNonWsIdx = firstLine.length - 1;
                    startsWithIndentation = firstNonWsIdx > 0;
                    const tabSize = model.textModel.getOptions().tabSize;
                    const visibleColumnIndentation = (0, $e1imz.CursorColumns).visibleColumnFromColumn(firstLine, firstNonWsIdx + 1, tabSize);
                    startsWithIndentationLessThanTabSize = visibleColumnIndentation < tabSize;
                }
            }
            this.inlineCompletionSuggestsIndentation.set(startsWithIndentation);
            this.inlineCompletionSuggestsIndentationLessThanTabSize.set(startsWithIndentationLessThanTabSize);
        }));
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");
function $fb10494e6ac976db$export$376f1bc31a70e750(css) {
    const store = new (0, $9cWcn.DisposableStore)();
    const w = store.add((0, $bDzmQ.createStyleSheet2)());
    store.add((0, $4fzqs.autorun)((reader)=>{
        w.setStyle(css.read(reader));
    }));
    return store;
}



var $aIbUW = parcelRequire("aIbUW");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $5Gd0V = parcelRequire("5Gd0V");

var $7QKTG = parcelRequire("7QKTG");

var $bxBg7 = parcelRequire("bxBg7");

var $1uQAu = parcelRequire("1uQAu");

var $iEpUY = parcelRequire("iEpUY");

var $dcxQ7 = parcelRequire("dcxQ7");

var $goG89 = parcelRequire("goG89");

var $4J6fu = parcelRequire("4J6fu");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $i8wPi = parcelRequire("i8wPi");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $jcr1R = parcelRequire("jcr1R");


var $84zMl = parcelRequire("84zMl");

var $cd4KD = parcelRequire("cd4KD");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $deseY = parcelRequire("deseY");

var $h9Xpp = parcelRequire("h9Xpp");

var $1Y4vr = parcelRequire("1Y4vr");

var $eoigl = parcelRequire("eoigl");

var $k6oYA = parcelRequire("k6oYA");

var $edrMT = parcelRequire("edrMT");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $jcr1R = parcelRequire("jcr1R");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $13Zrd = parcelRequire("13Zrd");
class $3d1b516e94b9053f$export$9415a6e27591b584 {
    constructor(lineNumber, parts){
        this.lineNumber = lineNumber;
        this.parts = parts;
    }
    equals(other) {
        return this.lineNumber === other.lineNumber && this.parts.length === other.parts.length && this.parts.every((part, index)=>part.equals(other.parts[index]));
    }
    renderForScreenReader(lineText) {
        if (this.parts.length === 0) return '';
        const lastPart = this.parts[this.parts.length - 1];
        const cappedLineText = lineText.substr(0, lastPart.column - 1);
        const text = new (0, $13Zrd.TextEdit)([
            ...this.parts.map((p)=>new (0, $13Zrd.SingleTextEdit)((0, $d00il.Range).fromPositions(new (0, $dcxQ7.Position)(1, p.column)), p.lines.join('\n')))
        ]).applyToString(cappedLineText);
        return text.substring(this.parts[0].column - 1);
    }
    isEmpty() {
        return this.parts.every((p)=>p.lines.length === 0);
    }
    get lineCount() {
        return 1 + this.parts.reduce((r, p)=>r + p.lines.length - 1, 0);
    }
}
class $3d1b516e94b9053f$export$cd17cedf46fe2f2 {
    constructor(column, text, /**
     * Indicates if this part is a preview of an inline suggestion when a suggestion is previewed.
    */ preview){
        this.column = column;
        this.text = text;
        this.preview = preview;
        this.lines = (0, $jcr1R.splitLines)(this.text);
    }
    equals(other) {
        return this.column === other.column && this.lines.length === other.lines.length && this.lines.every((line, index)=>line === other.lines[index]);
    }
}
class $3d1b516e94b9053f$export$5722336d2bdbeca {
    constructor(lineNumber, columnRange, text, additionalReservedLineCount = 0){
        this.lineNumber = lineNumber;
        this.columnRange = columnRange;
        this.text = text;
        this.additionalReservedLineCount = additionalReservedLineCount;
        this.parts = [
            new $3d1b516e94b9053f$export$cd17cedf46fe2f2(this.columnRange.endColumnExclusive, this.text, false)
        ];
        this.newLines = (0, $jcr1R.splitLines)(this.text);
    }
    renderForScreenReader(_lineText) {
        return this.newLines.join('\n');
    }
    get lineCount() {
        return this.newLines.length;
    }
    isEmpty() {
        return this.parts.every((p)=>p.lines.length === 0);
    }
    equals(other) {
        return this.lineNumber === other.lineNumber && this.columnRange.equals(other.columnRange) && this.newLines.length === other.newLines.length && this.newLines.every((line, index)=>line === other.newLines[index]) && this.additionalReservedLineCount === other.additionalReservedLineCount;
    }
}
function $3d1b516e94b9053f$export$ed40ee230145e7ab(a, b) {
    return (0, $kJ8UG.equals)(a, b, $3d1b516e94b9053f$export$12a6600d5ea8b253);
}
function $3d1b516e94b9053f$export$12a6600d5ea8b253(a, b) {
    if (a === b) return true;
    if (!a || !b) return false;
    if (a instanceof $3d1b516e94b9053f$export$9415a6e27591b584 && b instanceof $3d1b516e94b9053f$export$9415a6e27591b584) return a.equals(b);
    if (a instanceof $3d1b516e94b9053f$export$5722336d2bdbeca && b instanceof $3d1b516e94b9053f$export$5722336d2bdbeca) return a.equals(b);
    return false;
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");
const $5176a6fee772219a$var$array = [];
function $5176a6fee772219a$export$2784f46407682a6() {
    return $5176a6fee772219a$var$array;
}
class $5176a6fee772219a$export$dbf33034d7f3ab1 {
    constructor(startColumn, endColumnExclusive){
        this.startColumn = startColumn;
        this.endColumnExclusive = endColumnExclusive;
        if (startColumn > endColumnExclusive) throw new (0, $gPkHZ.BugIndicatingError)(`startColumn ${startColumn} cannot be after endColumnExclusive ${endColumnExclusive}`);
    }
    toRange(lineNumber) {
        return new (0, $d00il.Range)(lineNumber, this.startColumn, lineNumber, this.endColumnExclusive);
    }
    equals(other) {
        return this.startColumn === other.startColumn && this.endColumnExclusive === other.endColumnExclusive;
    }
}
function $5176a6fee772219a$export$826e152505a9989e(editor, decorations) {
    const d = new (0, $9cWcn.DisposableStore)();
    const decorationsCollection = editor.createDecorationsCollection();
    d.add((0, $4fzqs.autorunOpts)({
        debugName: ()=>`Apply decorations from ${decorations.debugName}`
    }, (reader)=>{
        const d = decorations.read(reader);
        decorationsCollection.set(d);
    }));
    d.add({
        dispose: ()=>{
            decorationsCollection.clear();
        }
    });
    return d;
}
function $5176a6fee772219a$export$416cdac2a5b34419(pos1, pos2) {
    return new (0, $dcxQ7.Position)(pos1.lineNumber + pos2.lineNumber - 1, pos2.lineNumber === 1 ? pos1.column + pos2.column - 1 : pos2.column);
}
function $5176a6fee772219a$export$f7a5d075cbdc3006(pos1, pos2) {
    return new (0, $dcxQ7.Position)(pos1.lineNumber - pos2.lineNumber + 1, pos1.lineNumber - pos2.lineNumber === 0 ? pos1.column - pos2.column + 1 : pos1.column);
}


var $ab4da55af03f6f3f$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $ab4da55af03f6f3f$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $ab4da55af03f6f3f$export$8a503edbbba3fd11 = 'ghost-text';
let $ab4da55af03f6f3f$export$215a91d8a8f2824a = class GhostTextView extends (0, $9cWcn.Disposable) {
    constructor(editor, model, languageService){
        super();
        this.editor = editor;
        this.model = model;
        this.languageService = languageService;
        this.isDisposed = (0, $4fzqs.observableValue)(this, false);
        this.currentTextModel = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeModel, ()=>/** @description editor.model */ this.editor.getModel());
        this.uiState = (0, $4fzqs.derived)(this, (reader)=>{
            if (this.isDisposed.read(reader)) return undefined;
            const textModel = this.currentTextModel.read(reader);
            if (textModel !== this.model.targetTextModel.read(reader)) return undefined;
            const ghostText = this.model.ghostText.read(reader);
            if (!ghostText) return undefined;
            const replacedRange = ghostText instanceof (0, $3d1b516e94b9053f$export$5722336d2bdbeca) ? ghostText.columnRange : undefined;
            const inlineTexts = [];
            const additionalLines = [];
            function addToAdditionalLines(lines, className) {
                if (additionalLines.length > 0) {
                    const lastLine = additionalLines[additionalLines.length - 1];
                    if (className) lastLine.decorations.push(new (0, $k6oYA.LineDecoration)(lastLine.content.length + 1, lastLine.content.length + 1 + lines[0].length, className, 0 /* InlineDecorationType.Regular */ ));
                    lastLine.content += lines[0];
                    lines = lines.slice(1);
                }
                for (const line of lines)additionalLines.push({
                    content: line,
                    decorations: className ? [
                        new (0, $k6oYA.LineDecoration)(1, line.length + 1, className, 0 /* InlineDecorationType.Regular */ )
                    ] : []
                });
            }
            const textBufferLine = textModel.getLineContent(ghostText.lineNumber);
            let hiddenTextStartColumn = undefined;
            let lastIdx = 0;
            for (const part of ghostText.parts){
                let lines = part.lines;
                if (hiddenTextStartColumn === undefined) {
                    inlineTexts.push({
                        column: part.column,
                        text: lines[0],
                        preview: part.preview
                    });
                    lines = lines.slice(1);
                } else addToAdditionalLines([
                    textBufferLine.substring(lastIdx, part.column - 1)
                ], undefined);
                if (lines.length > 0) {
                    addToAdditionalLines(lines, $ab4da55af03f6f3f$export$8a503edbbba3fd11);
                    if (hiddenTextStartColumn === undefined && part.column <= textBufferLine.length) hiddenTextStartColumn = part.column;
                }
                lastIdx = part.column - 1;
            }
            if (hiddenTextStartColumn !== undefined) addToAdditionalLines([
                textBufferLine.substring(lastIdx)
            ], undefined);
            const hiddenRange = hiddenTextStartColumn !== undefined ? new (0, $5176a6fee772219a$export$dbf33034d7f3ab1)(hiddenTextStartColumn, textBufferLine.length + 1) : undefined;
            return {
                replacedRange: replacedRange,
                inlineTexts: inlineTexts,
                additionalLines: additionalLines,
                hiddenRange: hiddenRange,
                lineNumber: ghostText.lineNumber,
                additionalReservedLineCount: this.model.minReservedLineCount.read(reader),
                targetTextModel: textModel
            };
        });
        this.decorations = (0, $4fzqs.derived)(this, (reader)=>{
            const uiState = this.uiState.read(reader);
            if (!uiState) return [];
            const decorations = [];
            if (uiState.replacedRange) decorations.push({
                range: uiState.replacedRange.toRange(uiState.lineNumber),
                options: {
                    inlineClassName: 'inline-completion-text-to-replace',
                    description: 'GhostTextReplacement'
                }
            });
            if (uiState.hiddenRange) decorations.push({
                range: uiState.hiddenRange.toRange(uiState.lineNumber),
                options: {
                    inlineClassName: 'ghost-text-hidden',
                    description: 'ghost-text-hidden'
                }
            });
            for (const p of uiState.inlineTexts)decorations.push({
                range: (0, $d00il.Range).fromPositions(new (0, $dcxQ7.Position)(uiState.lineNumber, p.column)),
                options: {
                    description: $ab4da55af03f6f3f$export$8a503edbbba3fd11,
                    after: {
                        content: p.text,
                        inlineClassName: p.preview ? 'ghost-text-decoration-preview' : 'ghost-text-decoration',
                        cursorStops: (0, $1Y4vr.InjectedTextCursorStops).Left
                    },
                    showIfCollapsed: true
                }
            });
            return decorations;
        });
        this.additionalLinesWidget = this._register(new $ab4da55af03f6f3f$export$5a6cd8c7fa611235(this.editor, this.languageService.languageIdCodec, (0, $4fzqs.derived)((reader)=>{
            /** @description lines */ const uiState = this.uiState.read(reader);
            return uiState ? {
                lineNumber: uiState.lineNumber,
                additionalLines: uiState.additionalLines,
                minReservedLineCount: uiState.additionalReservedLineCount,
                targetTextModel: uiState.targetTextModel
            } : undefined;
        })));
        this._register((0, $9cWcn.toDisposable)(()=>{
            this.isDisposed.set(true, undefined);
        }));
        this._register((0, $5176a6fee772219a$export$826e152505a9989e)(this.editor, this.decorations));
    }
    ownsViewZone(viewZoneId) {
        return this.additionalLinesWidget.viewZoneId === viewZoneId;
    }
};
$ab4da55af03f6f3f$export$215a91d8a8f2824a = $ab4da55af03f6f3f$var$__decorate([
    $ab4da55af03f6f3f$var$__param(2, (0, $h9Xpp.ILanguageService))
], $ab4da55af03f6f3f$export$215a91d8a8f2824a);
class $ab4da55af03f6f3f$export$5a6cd8c7fa611235 extends (0, $9cWcn.Disposable) {
    get viewZoneId() {
        return this._viewZoneId;
    }
    constructor(editor, languageIdCodec, lines){
        super();
        this.editor = editor;
        this.languageIdCodec = languageIdCodec;
        this.lines = lines;
        this._viewZoneId = undefined;
        this.editorOptionsChanged = (0, $4fzqs.observableSignalFromEvent)('editorOptionChanged', (0, $5YaSO.Event).filter(this.editor.onDidChangeConfiguration, (e)=>e.hasChanged(33 /* EditorOption.disableMonospaceOptimizations */ ) || e.hasChanged(118 /* EditorOption.stopRenderingLineAfter */ ) || e.hasChanged(100 /* EditorOption.renderWhitespace */ ) || e.hasChanged(95 /* EditorOption.renderControlCharacters */ ) || e.hasChanged(51 /* EditorOption.fontLigatures */ ) || e.hasChanged(50 /* EditorOption.fontInfo */ ) || e.hasChanged(67 /* EditorOption.lineHeight */ )));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description update view zone */ const lines = this.lines.read(reader);
            this.editorOptionsChanged.read(reader);
            if (lines) this.updateLines(lines.lineNumber, lines.additionalLines, lines.minReservedLineCount);
            else this.clear();
        }));
    }
    dispose() {
        super.dispose();
        this.clear();
    }
    clear() {
        this.editor.changeViewZones((changeAccessor)=>{
            if (this._viewZoneId) {
                changeAccessor.removeZone(this._viewZoneId);
                this._viewZoneId = undefined;
            }
        });
    }
    updateLines(lineNumber, additionalLines, minReservedLineCount) {
        const textModel = this.editor.getModel();
        if (!textModel) return;
        const { tabSize: tabSize } = textModel.getOptions();
        this.editor.changeViewZones((changeAccessor)=>{
            if (this._viewZoneId) {
                changeAccessor.removeZone(this._viewZoneId);
                this._viewZoneId = undefined;
            }
            const heightInLines = Math.max(additionalLines.length, minReservedLineCount);
            if (heightInLines > 0) {
                const domNode = document.createElement('div');
                $ab4da55af03f6f3f$var$renderLines(domNode, tabSize, additionalLines, this.editor.getOptions(), this.languageIdCodec);
                this._viewZoneId = changeAccessor.addZone({
                    afterLineNumber: lineNumber,
                    heightInLines: heightInLines,
                    domNode: domNode,
                    afterColumnAffinity: 1 /* PositionAffinity.Right */ 
                });
            }
        });
    }
}
function $ab4da55af03f6f3f$var$renderLines(domNode, tabSize, lines, opts, languageIdCodec) {
    const disableMonospaceOptimizations = opts.get(33 /* EditorOption.disableMonospaceOptimizations */ );
    const stopRenderingLineAfter = opts.get(118 /* EditorOption.stopRenderingLineAfter */ );
    // To avoid visual confusion, we don't want to render visible whitespace
    const renderWhitespace = 'none';
    const renderControlCharacters = opts.get(95 /* EditorOption.renderControlCharacters */ );
    const fontLigatures = opts.get(51 /* EditorOption.fontLigatures */ );
    const fontInfo = opts.get(50 /* EditorOption.fontInfo */ );
    const lineHeight = opts.get(67 /* EditorOption.lineHeight */ );
    const sb = new (0, $deseY.StringBuilder)(10000);
    sb.appendString('<div class="suggest-preview-text">');
    for(let i = 0, len = lines.length; i < len; i++){
        const lineData = lines[i];
        const line = lineData.content;
        sb.appendString('<div class="view-line');
        sb.appendString('" style="top:');
        sb.appendString(String(i * lineHeight));
        sb.appendString('px;width:1000000px;">');
        const isBasicASCII = $jcr1R.isBasicASCII(line);
        const containsRTL = $jcr1R.containsRTL(line);
        const lineTokens = (0, $eoigl.LineTokens).createEmpty(line, languageIdCodec);
        (0, $edrMT.renderViewLine)(new (0, $edrMT.RenderLineInput)(fontInfo.isMonospace && !disableMonospaceOptimizations, fontInfo.canUseHalfwidthRightwardsArrow, line, false, isBasicASCII, containsRTL, 0, lineTokens, lineData.decorations, tabSize, 0, fontInfo.spaceWidth, fontInfo.middotWidth, fontInfo.wsmiddotWidth, stopRenderingLineAfter, renderWhitespace, renderControlCharacters, fontLigatures !== (0, $cd4KD.EditorFontLigatures).OFF, null), sb);
        sb.appendString('</div>');
    }
    sb.appendString('</div>');
    (0, $84zMl.applyFontInfo)(domNode, fontInfo);
    const html = sb.build();
    const trustedhtml = $ab4da55af03f6f3f$export$e7d82cf15320f77e ? $ab4da55af03f6f3f$export$e7d82cf15320f77e.createHTML(html) : html;
    domNode.innerHTML = trustedhtml;
}
const $ab4da55af03f6f3f$export$e7d82cf15320f77e = (0, $i8wPi.createTrustedTypesPolicy)('editorGhostText', {
    createHTML: (value)=>value
});




/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $7ysJc = parcelRequire("7ysJc");

var $a0vti = parcelRequire("a0vti");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $jcr1R = parcelRequire("jcr1R");

var $bxBg7 = parcelRequire("bxBg7");

var $kHJv6 = parcelRequire("kHJv6");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $13Zrd = parcelRequire("13Zrd");

var $baQJ3 = parcelRequire("baQJ3");

var $kzNQX = parcelRequire("kzNQX");

var $1qkuR = parcelRequire("1qkuR");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $a0vti = parcelRequire("a0vti");

var $lk06m = parcelRequire("lk06m");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $d00il = parcelRequire("d00il");

var $13Zrd = parcelRequire("13Zrd");

var $baQJ3 = parcelRequire("baQJ3");

var $kzNQX = parcelRequire("kzNQX");

var $1qkuR = parcelRequire("1qkuR");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $hWWBa = parcelRequire("hWWBa");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $askDf = parcelRequire("askDf");

var $gPkHZ = parcelRequire("gPkHZ");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $7lhpy = parcelRequire("7lhpy");

var $iAAC9 = parcelRequire("iAAC9");

var $fRBQe = parcelRequire("fRBQe");

var $2CGp0 = parcelRequire("2CGp0");

var $eRZ3m = parcelRequire("eRZ3m");
function $de74ec1f1cb3c45f$export$b0b9afc2efae8f81(tokens, languageConfigurationService) {
    const denseKeyProvider = new (0, $2CGp0.DenseKeyProvider)();
    const bracketTokens = new (0, $7lhpy.LanguageAgnosticBracketTokens)(denseKeyProvider, (languageId)=>languageConfigurationService.getLanguageConfiguration(languageId));
    const tokenizer = new (0, $eRZ3m.TextBufferTokenizer)(new $de74ec1f1cb3c45f$var$StaticTokenizerSource([
        tokens
    ]), bracketTokens);
    const node = (0, $fRBQe.parseDocument)(tokenizer, [], undefined, true);
    let str = '';
    const line = tokens.getLineContent();
    function processNode(node, offset) {
        if (node.kind === 2 /* AstNodeKind.Pair */ ) {
            processNode(node.openingBracket, offset);
            offset = (0, $iAAC9.lengthAdd)(offset, node.openingBracket.length);
            if (node.child) {
                processNode(node.child, offset);
                offset = (0, $iAAC9.lengthAdd)(offset, node.child.length);
            }
            if (node.closingBracket) {
                processNode(node.closingBracket, offset);
                offset = (0, $iAAC9.lengthAdd)(offset, node.closingBracket.length);
            } else {
                const singleLangBracketTokens = bracketTokens.getSingleLanguageBracketTokens(node.openingBracket.languageId);
                const closingTokenText = singleLangBracketTokens.findClosingTokenText(node.openingBracket.bracketIds);
                str += closingTokenText;
            }
        } else if (node.kind === 3 /* AstNodeKind.UnexpectedClosingBracket */ ) ;
        else if (node.kind === 0 /* AstNodeKind.Text */  || node.kind === 1 /* AstNodeKind.Bracket */ ) str += line.substring((0, $iAAC9.lengthGetColumnCountIfZeroLineCount)(offset), (0, $iAAC9.lengthGetColumnCountIfZeroLineCount)((0, $iAAC9.lengthAdd)(offset, node.length)));
        else if (node.kind === 4 /* AstNodeKind.List */ ) for (const child of node.children){
            processNode(child, offset);
            offset = (0, $iAAC9.lengthAdd)(offset, child.length);
        }
    }
    processNode(node, (0, $iAAC9.lengthZero));
    return str;
}
class $de74ec1f1cb3c45f$var$StaticTokenizerSource {
    constructor(lines){
        this.lines = lines;
        this.tokenization = {
            getLineTokens: (lineNumber)=>{
                return this.lines[lineNumber - 1];
            }
        };
    }
    getLineCount() {
        return this.lines.length;
    }
    getLineLength(lineNumber) {
        return this.lines[lineNumber - 1].getLineContent().length;
    }
}



var $13Zrd = parcelRequire("13Zrd");


async function $2dee656271dcbcaa$export$eb35bd557f596021(registry, positionOrRange, model, context, token = (0, $giPcZ.CancellationToken).None, languageConfigurationService) {
    // Important: Don't use position after the await calls, as the model could have been changed in the meantime!
    const defaultReplaceRange = positionOrRange instanceof (0, $dcxQ7.Position) ? $2dee656271dcbcaa$var$getDefaultRange(positionOrRange, model) : positionOrRange;
    const providers = registry.all(model);
    const multiMap = new (0, $askDf.SetMap)();
    for (const provider of providers)if (provider.groupId) multiMap.add(provider.groupId, provider);
    function getPreferredProviders(provider) {
        if (!provider.yieldsToGroupIds) return [];
        const result = [];
        for (const groupId of provider.yieldsToGroupIds || []){
            const providers = multiMap.get(groupId);
            for (const p of providers)result.push(p);
        }
        return result;
    }
    const states = new Map();
    const seen = new Set();
    function findPreferredProviderCircle(provider, stack) {
        stack = [
            ...stack,
            provider
        ];
        if (seen.has(provider)) return stack;
        seen.add(provider);
        try {
            const preferred = getPreferredProviders(provider);
            for (const p of preferred){
                const c = findPreferredProviderCircle(p, stack);
                if (c) return c;
            }
        } finally{
            seen.delete(provider);
        }
        return undefined;
    }
    function processProvider(provider) {
        const state = states.get(provider);
        if (state) return state;
        const circle = findPreferredProviderCircle(provider, []);
        if (circle) (0, $gPkHZ.onUnexpectedExternalError)(new Error(`Inline completions: cyclic yield-to dependency detected. Path: ${circle.map((s)=>s.toString ? s.toString() : '' + s).join(' -> ')}`));
        const deferredPromise = new (0, $6bXyA.DeferredPromise)();
        states.set(provider, deferredPromise.p);
        (async ()=>{
            if (!circle) {
                const preferred = getPreferredProviders(provider);
                for (const p of preferred){
                    const result = await processProvider(p);
                    if (result && result.items.length > 0) // Skip provider
                    return undefined;
                }
            }
            try {
                if (positionOrRange instanceof (0, $dcxQ7.Position)) {
                    const completions = await provider.provideInlineCompletions(model, positionOrRange, context, token);
                    return completions;
                } else {
                    const completions = await provider.provideInlineEdits?.(model, positionOrRange, context, token);
                    return completions;
                }
            } catch (e) {
                (0, $gPkHZ.onUnexpectedExternalError)(e);
                return undefined;
            }
        })().then((c)=>deferredPromise.complete(c), (e)=>deferredPromise.error(e));
        return deferredPromise.p;
    }
    const providerResults = await Promise.all(providers.map(async (provider)=>({
            provider: provider,
            completions: await processProvider(provider)
        })));
    const itemsByHash = new Map();
    const lists = [];
    for (const result of providerResults){
        const completions = result.completions;
        if (!completions) continue;
        const list = new $2dee656271dcbcaa$export$b52f6415ed232a62(completions, result.provider);
        lists.push(list);
        for (const item of completions.items){
            const inlineCompletionItem = $2dee656271dcbcaa$export$3c2ccf54746a4a6e.from(item, list, defaultReplaceRange, model, languageConfigurationService);
            itemsByHash.set(inlineCompletionItem.hash(), inlineCompletionItem);
        }
    }
    return new $2dee656271dcbcaa$export$8d2c913c5a65fd0e(Array.from(itemsByHash.values()), new Set(itemsByHash.keys()), lists);
}
class $2dee656271dcbcaa$export$8d2c913c5a65fd0e {
    constructor(/**
     * Free of duplicates.
     */ completions, hashs, providerResults){
        this.completions = completions;
        this.hashs = hashs;
        this.providerResults = providerResults;
    }
    has(item) {
        return this.hashs.has(item.hash());
    }
    dispose() {
        for (const result of this.providerResults)result.removeRef();
    }
}
class $2dee656271dcbcaa$export$b52f6415ed232a62 {
    constructor(inlineCompletions, provider){
        this.inlineCompletions = inlineCompletions;
        this.provider = provider;
        this.refCount = 1;
    }
    addRef() {
        this.refCount++;
    }
    removeRef() {
        this.refCount--;
        if (this.refCount === 0) this.provider.freeInlineCompletions(this.inlineCompletions);
    }
}
class $2dee656271dcbcaa$export$3c2ccf54746a4a6e {
    static from(inlineCompletion, source, defaultReplaceRange, textModel, languageConfigurationService) {
        let insertText;
        let snippetInfo;
        let range = inlineCompletion.range ? (0, $d00il.Range).lift(inlineCompletion.range) : defaultReplaceRange;
        if (typeof inlineCompletion.insertText === 'string') {
            insertText = inlineCompletion.insertText;
            if (languageConfigurationService && inlineCompletion.completeBracketPairs) {
                insertText = $2dee656271dcbcaa$var$closeBrackets(insertText, range.getStartPosition(), textModel, languageConfigurationService);
                // Modify range depending on if brackets are added or removed
                const diff = insertText.length - inlineCompletion.insertText.length;
                if (diff !== 0) range = new (0, $d00il.Range)(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn + diff);
            }
            snippetInfo = undefined;
        } else if ('snippet' in inlineCompletion.insertText) {
            const preBracketCompletionLength = inlineCompletion.insertText.snippet.length;
            if (languageConfigurationService && inlineCompletion.completeBracketPairs) {
                inlineCompletion.insertText.snippet = $2dee656271dcbcaa$var$closeBrackets(inlineCompletion.insertText.snippet, range.getStartPosition(), textModel, languageConfigurationService);
                // Modify range depending on if brackets are added or removed
                const diff = inlineCompletion.insertText.snippet.length - preBracketCompletionLength;
                if (diff !== 0) range = new (0, $d00il.Range)(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn + diff);
            }
            const snippet = new (0, $464b8f1057bff784$export$e073bfe8583e8fbf)().parse(inlineCompletion.insertText.snippet);
            if (snippet.children.length === 1 && snippet.children[0] instanceof (0, $464b8f1057bff784$export$5f1af8db9871e1d6)) {
                insertText = snippet.children[0].value;
                snippetInfo = undefined;
            } else {
                insertText = snippet.toString();
                snippetInfo = {
                    snippet: inlineCompletion.insertText.snippet,
                    range: range
                };
            }
        } else (0, $hWWBa.assertNever)(inlineCompletion.insertText);
        return new $2dee656271dcbcaa$export$3c2ccf54746a4a6e(insertText, inlineCompletion.command, range, insertText, snippetInfo, inlineCompletion.additionalTextEdits || (0, $5176a6fee772219a$export$2784f46407682a6)(), inlineCompletion, source);
    }
    constructor(filterText, command, range, insertText, snippetInfo, additionalTextEdits, /**
     * A reference to the original inline completion this inline completion has been constructed from.
     * Used for event data to ensure referential equality.
    */ sourceInlineCompletion, /**
     * A reference to the original inline completion list this inline completion has been constructed from.
     * Used for event data to ensure referential equality.
    */ source){
        this.filterText = filterText;
        this.command = command;
        this.range = range;
        this.insertText = insertText;
        this.snippetInfo = snippetInfo;
        this.additionalTextEdits = additionalTextEdits;
        this.sourceInlineCompletion = sourceInlineCompletion;
        this.source = source;
        filterText = filterText.replace(/\r\n|\r/g, '\n');
        insertText = filterText.replace(/\r\n|\r/g, '\n');
    }
    withRange(updatedRange) {
        return new $2dee656271dcbcaa$export$3c2ccf54746a4a6e(this.filterText, this.command, updatedRange, this.insertText, this.snippetInfo, this.additionalTextEdits, this.sourceInlineCompletion, this.source);
    }
    hash() {
        return JSON.stringify({
            insertText: this.insertText,
            range: this.range.toString()
        });
    }
    toSingleTextEdit() {
        return new (0, $13Zrd.SingleTextEdit)(this.range, this.insertText);
    }
}
function $2dee656271dcbcaa$var$getDefaultRange(position, model) {
    const word = model.getWordAtPosition(position);
    const maxColumn = model.getLineMaxColumn(position.lineNumber);
    // By default, always replace up until the end of the current line.
    // This default might be subject to change!
    return word ? new (0, $d00il.Range)(position.lineNumber, word.startColumn, position.lineNumber, maxColumn) : (0, $d00il.Range).fromPositions(position, position.with(undefined, maxColumn));
}
function $2dee656271dcbcaa$var$closeBrackets(text, position, model, languageConfigurationService) {
    const lineStart = model.getLineContent(position.lineNumber).substring(0, position.column - 1);
    const newLine = lineStart + text;
    const newTokens = model.tokenization.tokenizeLineWithEdit(position, newLine.length - (position.column - 1), text);
    const slicedTokens = newTokens?.sliceAndInflate(position.column - 1, newLine.length, 0);
    if (!slicedTokens) return text;
    const newText = (0, $de74ec1f1cb3c45f$export$b0b9afc2efae8f81)(slicedTokens, languageConfigurationService);
    return newText;
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kiSz0 = parcelRequire("kiSz0");

var $jcr1R = parcelRequire("jcr1R");

var $d00il = parcelRequire("d00il");

var $baQJ3 = parcelRequire("baQJ3");

var $13Zrd = parcelRequire("13Zrd");

function $d2b11f15de3b89fe$export$1204549eb57cd077(edit, model, validModelRange) {
    const modelRange = validModelRange ? edit.range.intersectRanges(validModelRange) : edit.range;
    if (!modelRange) return edit;
    const valueToReplace = model.getValueInRange(modelRange, 1 /* EndOfLinePreference.LF */ );
    const commonPrefixLen = (0, $jcr1R.commonPrefixLength)(valueToReplace, edit.text);
    const start = (0, $baQJ3.TextLength).ofText(valueToReplace.substring(0, commonPrefixLen)).addToPosition(edit.range.getStartPosition());
    const text = edit.text.substring(commonPrefixLen);
    const range = (0, $d00il.Range).fromPositions(start, edit.range.getEndPosition());
    return new (0, $13Zrd.SingleTextEdit)(range, text);
}
function $d2b11f15de3b89fe$export$95e36a39a8b20bae(edit, base) {
    // The augmented completion must replace the base range, but can replace even more
    return edit.text.startsWith(base.text) && $d2b11f15de3b89fe$var$rangeExtends(edit.range, base.range);
}
function $d2b11f15de3b89fe$export$2f8a3ebbe6972b3e(edit, model, mode, cursorPosition, previewSuffixLength = 0) {
    let e = $d2b11f15de3b89fe$export$1204549eb57cd077(edit, model);
    if (e.range.endLineNumber !== e.range.startLineNumber) // This edit might span multiple lines, but the first lines must be a common prefix.
    return undefined;
    const sourceLine = model.getLineContent(e.range.startLineNumber);
    const sourceIndentationLength = (0, $jcr1R.getLeadingWhitespace)(sourceLine).length;
    const suggestionTouchesIndentation = e.range.startColumn - 1 <= sourceIndentationLength;
    if (suggestionTouchesIndentation) {
        // source:      ··········[······abc]
        //                         ^^^^^^^^^ inlineCompletion.range
        //              ^^^^^^^^^^ ^^^^^^ sourceIndentationLength
        //                         ^^^^^^ replacedIndentation.length
        //                               ^^^ rangeThatDoesNotReplaceIndentation
        // inlineCompletion.text: '··foo'
        //                         ^^ suggestionAddedIndentationLength
        const suggestionAddedIndentationLength = (0, $jcr1R.getLeadingWhitespace)(e.text).length;
        const replacedIndentation = sourceLine.substring(e.range.startColumn - 1, sourceIndentationLength);
        const [startPosition, endPosition] = [
            e.range.getStartPosition(),
            e.range.getEndPosition()
        ];
        const newStartPosition = startPosition.column + replacedIndentation.length <= endPosition.column ? startPosition.delta(0, replacedIndentation.length) : endPosition;
        const rangeThatDoesNotReplaceIndentation = (0, $d00il.Range).fromPositions(newStartPosition, endPosition);
        const suggestionWithoutIndentationChange = e.text.startsWith(replacedIndentation) ? e.text.substring(replacedIndentation.length) : e.text.substring(suggestionAddedIndentationLength);
        e = new (0, $13Zrd.SingleTextEdit)(rangeThatDoesNotReplaceIndentation, suggestionWithoutIndentationChange);
    }
    // This is a single line string
    const valueToBeReplaced = model.getValueInRange(e.range);
    const changes = $d2b11f15de3b89fe$var$cachingDiff(valueToBeReplaced, e.text);
    if (!changes) // No ghost text in case the diff would be too slow to compute
    return undefined;
    const lineNumber = e.range.startLineNumber;
    const parts = new Array();
    if (mode === 'prefix') {
        const filteredChanges = changes.filter((c)=>c.originalLength === 0);
        if (filteredChanges.length > 1 || filteredChanges.length === 1 && filteredChanges[0].originalStart !== valueToBeReplaced.length) // Prefixes only have a single change.
        return undefined;
    }
    const previewStartInCompletionText = e.text.length - previewSuffixLength;
    for (const c of changes){
        const insertColumn = e.range.startColumn + c.originalStart + c.originalLength;
        if (mode === 'subwordSmart' && cursorPosition && cursorPosition.lineNumber === e.range.startLineNumber && insertColumn < cursorPosition.column) // No ghost text before cursor
        return undefined;
        if (c.originalLength > 0) return undefined;
        if (c.modifiedLength === 0) continue;
        const modifiedEnd = c.modifiedStart + c.modifiedLength;
        const nonPreviewTextEnd = Math.max(c.modifiedStart, Math.min(modifiedEnd, previewStartInCompletionText));
        const nonPreviewText = e.text.substring(c.modifiedStart, nonPreviewTextEnd);
        const italicText = e.text.substring(nonPreviewTextEnd, Math.max(c.modifiedStart, modifiedEnd));
        if (nonPreviewText.length > 0) parts.push(new (0, $3d1b516e94b9053f$export$cd17cedf46fe2f2)(insertColumn, nonPreviewText, false));
        if (italicText.length > 0) parts.push(new (0, $3d1b516e94b9053f$export$cd17cedf46fe2f2)(insertColumn, italicText, true));
    }
    return new (0, $3d1b516e94b9053f$export$9415a6e27591b584)(lineNumber, parts);
}
function $d2b11f15de3b89fe$var$rangeExtends(extendingRange, rangeToExtend) {
    return rangeToExtend.getStartPosition().equals(extendingRange.getStartPosition()) && rangeToExtend.getEndPosition().isBeforeOrEqual(extendingRange.getEndPosition());
}
let $d2b11f15de3b89fe$var$lastRequest = undefined;
function $d2b11f15de3b89fe$var$cachingDiff(originalValue, newValue) {
    if ($d2b11f15de3b89fe$var$lastRequest?.originalValue === originalValue && $d2b11f15de3b89fe$var$lastRequest?.newValue === newValue) return $d2b11f15de3b89fe$var$lastRequest?.changes;
    else {
        let changes = $d2b11f15de3b89fe$var$smartDiff(originalValue, newValue, true);
        if (changes) {
            const deletedChars = $d2b11f15de3b89fe$var$deletedCharacters(changes);
            if (deletedChars > 0) {
                // For performance reasons, don't compute diff if there is nothing to improve
                const newChanges = $d2b11f15de3b89fe$var$smartDiff(originalValue, newValue, false);
                if (newChanges && $d2b11f15de3b89fe$var$deletedCharacters(newChanges) < deletedChars) // Disabling smartness seems to be better here
                changes = newChanges;
            }
        }
        $d2b11f15de3b89fe$var$lastRequest = {
            originalValue: originalValue,
            newValue: newValue,
            changes: changes
        };
        return changes;
    }
}
function $d2b11f15de3b89fe$var$deletedCharacters(changes) {
    let sum = 0;
    for (const c of changes)sum += c.originalLength;
    return sum;
}
/**
 * When matching `if ()` with `if (f() = 1) { g(); }`,
 * align it like this:        `if (       )`
 * Not like this:			  `if (  )`
 * Also not like this:		  `if (             )`.
 *
 * The parenthesis are preprocessed to ensure that they match correctly.
 */ function $d2b11f15de3b89fe$var$smartDiff(originalValue, newValue, smartBracketMatching) {
    if (originalValue.length > 5000 || newValue.length > 5000) // We don't want to work on strings that are too big
    return undefined;
    function getMaxCharCode(val) {
        let maxCharCode = 0;
        for(let i = 0, len = val.length; i < len; i++){
            const charCode = val.charCodeAt(i);
            if (charCode > maxCharCode) maxCharCode = charCode;
        }
        return maxCharCode;
    }
    const maxCharCode = Math.max(getMaxCharCode(originalValue), getMaxCharCode(newValue));
    function getUniqueCharCode(id) {
        if (id < 0) throw new Error('unexpected');
        return maxCharCode + id + 1;
    }
    function getElements(source) {
        let level = 0;
        let group = 0;
        const characters = new Int32Array(source.length);
        for(let i = 0, len = source.length; i < len; i++){
            // TODO support more brackets
            if (smartBracketMatching && source[i] === '(') {
                const id = group * 100 + level;
                characters[i] = getUniqueCharCode(2 * id);
                level++;
            } else if (smartBracketMatching && source[i] === ')') {
                level = Math.max(level - 1, 0);
                const id = group * 100 + level;
                characters[i] = getUniqueCharCode(2 * id + 1);
                if (level === 0) group++;
            } else characters[i] = source.charCodeAt(i);
        }
        return characters;
    }
    const elements1 = getElements(originalValue);
    const elements2 = getElements(newValue);
    return new (0, $kiSz0.LcsDiff)({
        getElements: ()=>elements1
    }, {
        getElements: ()=>elements2
    }).ComputeDiff(false).changes;
}


var $810fca5866eccfec$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $810fca5866eccfec$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $810fca5866eccfec$export$7bd92176df4e9460 = class InlineCompletionsSource extends (0, $9cWcn.Disposable) {
    constructor(textModel, versionId, _debounceValue, languageFeaturesService, languageConfigurationService){
        super();
        this.textModel = textModel;
        this.versionId = versionId;
        this._debounceValue = _debounceValue;
        this.languageFeaturesService = languageFeaturesService;
        this.languageConfigurationService = languageConfigurationService;
        this._updateOperation = this._register(new (0, $9cWcn.MutableDisposable)());
        this.inlineCompletions = (0, $4fzqs.disposableObservableValue)('inlineCompletions', undefined);
        this.suggestWidgetInlineCompletions = (0, $4fzqs.disposableObservableValue)('suggestWidgetInlineCompletions', undefined);
        this._register(this.textModel.onDidChangeContent(()=>{
            this._updateOperation.clear();
        }));
    }
    fetch(position, context, activeInlineCompletion) {
        const request = new $810fca5866eccfec$var$UpdateRequest(position, context, this.textModel.getVersionId());
        const target = context.selectedSuggestionInfo ? this.suggestWidgetInlineCompletions : this.inlineCompletions;
        if (this._updateOperation.value?.request.satisfies(request)) return this._updateOperation.value.promise;
        else if (target.get()?.request.satisfies(request)) return Promise.resolve(true);
        const updateOngoing = !!this._updateOperation.value;
        this._updateOperation.clear();
        const source = new (0, $giPcZ.CancellationTokenSource)();
        const promise = (async ()=>{
            const shouldDebounce = updateOngoing || context.triggerKind === (0, $kzNQX.InlineCompletionTriggerKind).Automatic;
            if (shouldDebounce) // This debounces the operation
            await $810fca5866eccfec$var$wait(this._debounceValue.get(this.textModel), source.token);
            if (source.token.isCancellationRequested || this._store.isDisposed || this.textModel.getVersionId() !== request.versionId) return false;
            const startTime = new Date();
            const updatedCompletions = await (0, $2dee656271dcbcaa$export$eb35bd557f596021)(this.languageFeaturesService.inlineCompletionsProvider, position, this.textModel, context, source.token, this.languageConfigurationService);
            if (source.token.isCancellationRequested || this._store.isDisposed || this.textModel.getVersionId() !== request.versionId) return false;
            const endTime = new Date();
            this._debounceValue.update(this.textModel, endTime.getTime() - startTime.getTime());
            const completions = new $810fca5866eccfec$export$e45f5559e0ca8e07(updatedCompletions, request, this.textModel, this.versionId);
            if (activeInlineCompletion) {
                const asInlineCompletion = activeInlineCompletion.toInlineCompletion(undefined);
                if (activeInlineCompletion.canBeReused(this.textModel, position) && !updatedCompletions.has(asInlineCompletion)) completions.prepend(activeInlineCompletion.inlineCompletion, asInlineCompletion.range, true);
            }
            this._updateOperation.clear();
            (0, $4fzqs.transaction)((tx)=>{
                /** @description Update completions with provider result */ target.set(completions, tx);
            });
            return true;
        })();
        const updateOperation = new $810fca5866eccfec$var$UpdateOperation(request, source, promise);
        this._updateOperation.value = updateOperation;
        return promise;
    }
    clear(tx) {
        this._updateOperation.clear();
        this.inlineCompletions.set(undefined, tx);
        this.suggestWidgetInlineCompletions.set(undefined, tx);
    }
    clearSuggestWidgetInlineCompletions(tx) {
        if (this._updateOperation.value?.request.context.selectedSuggestionInfo) this._updateOperation.clear();
        this.suggestWidgetInlineCompletions.set(undefined, tx);
    }
    cancelUpdate() {
        this._updateOperation.clear();
    }
};
$810fca5866eccfec$export$7bd92176df4e9460 = $810fca5866eccfec$var$__decorate([
    $810fca5866eccfec$var$__param(3, (0, $4J6fu.ILanguageFeaturesService)),
    $810fca5866eccfec$var$__param(4, (0, $1qkuR.ILanguageConfigurationService))
], $810fca5866eccfec$export$7bd92176df4e9460);
function $810fca5866eccfec$var$wait(ms, cancellationToken) {
    return new Promise((resolve)=>{
        let d = undefined;
        const handle = setTimeout(()=>{
            if (d) d.dispose();
            resolve();
        }, ms);
        if (cancellationToken) d = cancellationToken.onCancellationRequested(()=>{
            clearTimeout(handle);
            if (d) d.dispose();
            resolve();
        });
    });
}
class $810fca5866eccfec$var$UpdateRequest {
    constructor(position, context, versionId){
        this.position = position;
        this.context = context;
        this.versionId = versionId;
    }
    satisfies(other) {
        return this.position.equals(other.position) && (0, $a0vti.equalsIfDefined)(this.context.selectedSuggestionInfo, other.context.selectedSuggestionInfo, (0, $a0vti.itemEquals)()) && (other.context.triggerKind === (0, $kzNQX.InlineCompletionTriggerKind).Automatic || this.context.triggerKind === (0, $kzNQX.InlineCompletionTriggerKind).Explicit) && this.versionId === other.versionId;
    }
}
class $810fca5866eccfec$var$UpdateOperation {
    constructor(request, cancellationTokenSource, promise){
        this.request = request;
        this.cancellationTokenSource = cancellationTokenSource;
        this.promise = promise;
    }
    dispose() {
        this.cancellationTokenSource.cancel();
    }
}
class $810fca5866eccfec$export$e45f5559e0ca8e07 {
    get inlineCompletions() {
        return this._inlineCompletions;
    }
    constructor(inlineCompletionProviderResult, request, _textModel, _versionId){
        this.inlineCompletionProviderResult = inlineCompletionProviderResult;
        this.request = request;
        this._textModel = _textModel;
        this._versionId = _versionId;
        this._refCount = 1;
        this._prependedInlineCompletionItems = [];
        const ids = _textModel.deltaDecorations([], inlineCompletionProviderResult.completions.map((i)=>({
                range: i.range,
                options: {
                    description: 'inline-completion-tracking-range'
                }
            })));
        this._inlineCompletions = inlineCompletionProviderResult.completions.map((i, index)=>new $810fca5866eccfec$export$d698c08c624c6564(i, ids[index], this._textModel, this._versionId));
    }
    clone() {
        this._refCount++;
        return this;
    }
    dispose() {
        this._refCount--;
        if (this._refCount === 0) {
            setTimeout(()=>{
                // To fix https://github.com/microsoft/vscode/issues/188348
                if (!this._textModel.isDisposed()) // This is just cleanup. It's ok if it happens with a delay.
                this._textModel.deltaDecorations(this._inlineCompletions.map((i)=>i.decorationId), []);
            }, 0);
            this.inlineCompletionProviderResult.dispose();
            for (const i of this._prependedInlineCompletionItems)i.source.removeRef();
        }
    }
    prepend(inlineCompletion, range, addRefToSource) {
        if (addRefToSource) inlineCompletion.source.addRef();
        const id = this._textModel.deltaDecorations([], [
            {
                range: range,
                options: {
                    description: 'inline-completion-tracking-range'
                }
            }
        ])[0];
        this._inlineCompletions.unshift(new $810fca5866eccfec$export$d698c08c624c6564(inlineCompletion, id, this._textModel, this._versionId));
        this._prependedInlineCompletionItems.push(inlineCompletion);
    }
}
class $810fca5866eccfec$export$d698c08c624c6564 {
    get forwardStable() {
        return this.inlineCompletion.source.inlineCompletions.enableForwardStability ?? false;
    }
    constructor(inlineCompletion, decorationId, _textModel, _modelVersion){
        this.inlineCompletion = inlineCompletion;
        this.decorationId = decorationId;
        this._textModel = _textModel;
        this._modelVersion = _modelVersion;
        this.semanticId = JSON.stringify([
            this.inlineCompletion.filterText,
            this.inlineCompletion.insertText,
            this.inlineCompletion.range.getStartPosition().toString()
        ]);
        this._updatedRange = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $d00il.Range).equalsRange
        }, (reader)=>{
            this._modelVersion.read(reader);
            return this._textModel.getDecorationRange(this.decorationId);
        });
    }
    toInlineCompletion(reader) {
        return this.inlineCompletion.withRange(this._updatedRange.read(reader) ?? $810fca5866eccfec$var$emptyRange);
    }
    toSingleTextEdit(reader) {
        return new (0, $13Zrd.SingleTextEdit)(this._updatedRange.read(reader) ?? $810fca5866eccfec$var$emptyRange, this.inlineCompletion.insertText);
    }
    isVisible(model, cursorPosition, reader) {
        const minimizedReplacement = (0, $d2b11f15de3b89fe$export$1204549eb57cd077)(this._toFilterTextReplacement(reader), model);
        const updatedRange = this._updatedRange.read(reader);
        if (!updatedRange || !this.inlineCompletion.range.getStartPosition().equals(updatedRange.getStartPosition()) || cursorPosition.lineNumber !== minimizedReplacement.range.startLineNumber) return false;
        // We might consider comparing by .toLowerText, but this requires GhostTextReplacement
        const originalValue = model.getValueInRange(minimizedReplacement.range, 1 /* EndOfLinePreference.LF */ );
        const filterText = minimizedReplacement.text;
        const cursorPosIndex = Math.max(0, cursorPosition.column - minimizedReplacement.range.startColumn);
        let filterTextBefore = filterText.substring(0, cursorPosIndex);
        let filterTextAfter = filterText.substring(cursorPosIndex);
        let originalValueBefore = originalValue.substring(0, cursorPosIndex);
        let originalValueAfter = originalValue.substring(cursorPosIndex);
        const originalValueIndent = model.getLineIndentColumn(minimizedReplacement.range.startLineNumber);
        if (minimizedReplacement.range.startColumn <= originalValueIndent) {
            // Remove indentation
            originalValueBefore = originalValueBefore.trimStart();
            if (originalValueBefore.length === 0) originalValueAfter = originalValueAfter.trimStart();
            filterTextBefore = filterTextBefore.trimStart();
            if (filterTextBefore.length === 0) filterTextAfter = filterTextAfter.trimStart();
        }
        return filterTextBefore.startsWith(originalValueBefore) && !!(0, $lk06m.matchesSubString)(originalValueAfter, filterTextAfter);
    }
    canBeReused(model, position) {
        const updatedRange = this._updatedRange.read(undefined);
        const result = !!updatedRange && updatedRange.containsPosition(position) && this.isVisible(model, position, undefined) && (0, $baQJ3.TextLength).ofRange(updatedRange).isGreaterThanOrEqualTo((0, $baQJ3.TextLength).ofRange(this.inlineCompletion.range));
        return result;
    }
    _toFilterTextReplacement(reader) {
        return new (0, $13Zrd.SingleTextEdit)(this._updatedRange.read(reader) ?? $810fca5866eccfec$var$emptyRange, this.inlineCompletion.filterText);
    }
}
const $810fca5866eccfec$var$emptyRange = new (0, $d00il.Range)(1, 1, 1, 1);




/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $bxBg7 = parcelRequire("bxBg7");

var $2iJTi = parcelRequire("2iJTi");

var $dcxQ7 = parcelRequire("dcxQ7");

var $ibKGQ = parcelRequire("ibKGQ");

var $1qkuR = parcelRequire("1qkuR");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $lk06m = parcelRequire("lk06m");

var $9cWcn = parcelRequire("9cWcn");

var $eUQTM = parcelRequire("eUQTM");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $aTkrt = parcelRequire("aTkrt");


var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $4J6fu = parcelRequire("4J6fu");

const $46671b3f02f7e7cd$export$841858b892ce1f4c = {
    Visible: (0, $36d223a3753fe003$export$deb80e61ead33ac5),
    HasFocusedSuggestion: new (0, $cxCeF.RawContextKey)('suggestWidgetHasFocusedSuggestion', false, (0, $4dEdH.localize)('suggestWidgetHasSelection', "Whether any suggestion is focused")),
    DetailsVisible: new (0, $cxCeF.RawContextKey)('suggestWidgetDetailsVisible', false, (0, $4dEdH.localize)('suggestWidgetDetailsVisible', "Whether suggestion details are visible")),
    MultipleSuggestions: new (0, $cxCeF.RawContextKey)('suggestWidgetMultipleSuggestions', false, (0, $4dEdH.localize)('suggestWidgetMultipleSuggestions', "Whether there are multiple suggestions to pick from")),
    MakesTextEdit: new (0, $cxCeF.RawContextKey)('suggestionMakesTextEdit', true, (0, $4dEdH.localize)('suggestionMakesTextEdit', "Whether inserting the current suggestion yields in a change or has everything already been typed")),
    AcceptSuggestionsOnEnter: new (0, $cxCeF.RawContextKey)('acceptSuggestionOnEnter', true, (0, $4dEdH.localize)('acceptSuggestionOnEnter', "Whether suggestions are inserted when pressing Enter")),
    HasInsertAndReplaceRange: new (0, $cxCeF.RawContextKey)('suggestionHasInsertAndReplaceRange', false, (0, $4dEdH.localize)('suggestionHasInsertAndReplaceRange', "Whether the current suggestion has insert and replace behaviour")),
    InsertMode: new (0, $cxCeF.RawContextKey)('suggestionInsertMode', undefined, {
        type: 'string',
        description: (0, $4dEdH.localize)('suggestionInsertMode', "Whether the default behaviour is to insert or replace")
    }),
    CanResolve: new (0, $cxCeF.RawContextKey)('suggestionCanResolve', false, (0, $4dEdH.localize)('suggestionCanResolve', "Whether the current suggestion supports to resolve further details"))
};
const $46671b3f02f7e7cd$export$c2ae6207654f3cab = new (0, $g4v7E.MenuId)('suggestWidgetStatusBar');
class $46671b3f02f7e7cd$export$c290c60b00019a8b {
    constructor(position, completion, container, provider){
        this.position = position;
        this.completion = completion;
        this.container = container;
        this.provider = provider;
        // validation
        this.isInvalid = false;
        // sorting, filtering
        this.score = (0, $lk06m.FuzzyScore).Default;
        this.distance = 0;
        this.textLabel = typeof completion.label === 'string' ? completion.label : completion.label?.label;
        // ensure lower-variants (perf)
        this.labelLow = this.textLabel.toLowerCase();
        // validate label
        this.isInvalid = !this.textLabel;
        this.sortTextLow = completion.sortText && completion.sortText.toLowerCase();
        this.filterTextLow = completion.filterText && completion.filterText.toLowerCase();
        this.extensionId = completion.extensionId;
        // normalize ranges
        if ((0, $d00il.Range).isIRange(completion.range)) {
            this.editStart = new (0, $dcxQ7.Position)(completion.range.startLineNumber, completion.range.startColumn);
            this.editInsertEnd = new (0, $dcxQ7.Position)(completion.range.endLineNumber, completion.range.endColumn);
            this.editReplaceEnd = new (0, $dcxQ7.Position)(completion.range.endLineNumber, completion.range.endColumn);
            // validate range
            this.isInvalid = this.isInvalid || (0, $d00il.Range).spansMultipleLines(completion.range) || completion.range.startLineNumber !== position.lineNumber;
        } else {
            this.editStart = new (0, $dcxQ7.Position)(completion.range.insert.startLineNumber, completion.range.insert.startColumn);
            this.editInsertEnd = new (0, $dcxQ7.Position)(completion.range.insert.endLineNumber, completion.range.insert.endColumn);
            this.editReplaceEnd = new (0, $dcxQ7.Position)(completion.range.replace.endLineNumber, completion.range.replace.endColumn);
            // validate ranges
            this.isInvalid = this.isInvalid || (0, $d00il.Range).spansMultipleLines(completion.range.insert) || (0, $d00il.Range).spansMultipleLines(completion.range.replace) || completion.range.insert.startLineNumber !== position.lineNumber || completion.range.replace.startLineNumber !== position.lineNumber || completion.range.insert.startColumn !== completion.range.replace.startColumn;
        }
        // create the suggestion resolver
        if (typeof provider.resolveCompletionItem !== 'function') {
            this._resolveCache = Promise.resolve();
            this._resolveDuration = 0;
        }
    }
    // ---- resolving
    get isResolved() {
        return this._resolveDuration !== undefined;
    }
    get resolveDuration() {
        return this._resolveDuration !== undefined ? this._resolveDuration : -1;
    }
    async resolve(token) {
        if (!this._resolveCache) {
            const sub = token.onCancellationRequested(()=>{
                this._resolveCache = undefined;
                this._resolveDuration = undefined;
            });
            const sw = new (0, $eUQTM.StopWatch)(true);
            this._resolveCache = Promise.resolve(this.provider.resolveCompletionItem(this.completion, token)).then((value)=>{
                Object.assign(this.completion, value);
                this._resolveDuration = sw.elapsed();
            }, (err)=>{
                if ((0, $gPkHZ.isCancellationError)(err)) {
                    // the IPC queue will reject the request with the
                    // cancellation error -> reset cached
                    this._resolveCache = undefined;
                    this._resolveDuration = undefined;
                }
            }).finally(()=>{
                sub.dispose();
            });
        }
        return this._resolveCache;
    }
}
class $46671b3f02f7e7cd$export$6e9613987176d8af {
    static{
        this.default = new $46671b3f02f7e7cd$export$6e9613987176d8af();
    }
    constructor(snippetSortOrder = 2 /* SnippetSortOrder.Bottom */ , kindFilter = new Set(), providerFilter = new Set(), providerItemsToReuse = new Map(), showDeprecated = true){
        this.snippetSortOrder = snippetSortOrder;
        this.kindFilter = kindFilter;
        this.providerFilter = providerFilter;
        this.providerItemsToReuse = providerItemsToReuse;
        this.showDeprecated = showDeprecated;
    }
}
let $46671b3f02f7e7cd$var$_snippetSuggestSupport;
function $46671b3f02f7e7cd$export$72a35c372a05fbe1() {
    return $46671b3f02f7e7cd$var$_snippetSuggestSupport;
}
class $46671b3f02f7e7cd$export$5bba491290954073 {
    constructor(items, needsClipboard, durations, disposable){
        this.items = items;
        this.needsClipboard = needsClipboard;
        this.durations = durations;
        this.disposable = disposable;
    }
}
async function $46671b3f02f7e7cd$export$c34b3fef967c72b0(registry, model, position, options = $46671b3f02f7e7cd$export$6e9613987176d8af.default, context = {
    triggerKind: 0 /* languages.CompletionTriggerKind.Invoke */ 
}, token = (0, $giPcZ.CancellationToken).None) {
    const sw = new (0, $eUQTM.StopWatch)();
    position = position.clone();
    const word = model.getWordAtPosition(position);
    const defaultReplaceRange = word ? new (0, $d00il.Range)(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn) : (0, $d00il.Range).fromPositions(position);
    const defaultRange = {
        replace: defaultReplaceRange,
        insert: defaultReplaceRange.setEndPosition(position.lineNumber, position.column)
    };
    const result = [];
    const disposables = new (0, $9cWcn.DisposableStore)();
    const durations = [];
    let needsClipboard = false;
    const onCompletionList = (provider, container, sw)=>{
        let didAddResult = false;
        if (!container) return didAddResult;
        for (const suggestion of container.suggestions)if (!options.kindFilter.has(suggestion.kind)) {
            // skip if not showing deprecated suggestions
            if (!options.showDeprecated && suggestion?.tags?.includes(1 /* languages.CompletionItemTag.Deprecated */ )) continue;
            // fill in default range when missing
            if (!suggestion.range) suggestion.range = defaultRange;
            // fill in default sortText when missing
            if (!suggestion.sortText) suggestion.sortText = typeof suggestion.label === 'string' ? suggestion.label : suggestion.label.label;
            if (!needsClipboard && suggestion.insertTextRules && suggestion.insertTextRules & 4 /* languages.CompletionItemInsertTextRule.InsertAsSnippet */ ) needsClipboard = (0, $464b8f1057bff784$export$e073bfe8583e8fbf).guessNeedsClipboard(suggestion.insertText);
            result.push(new $46671b3f02f7e7cd$export$c290c60b00019a8b(position, suggestion, container, provider));
            didAddResult = true;
        }
        if ((0, $9cWcn.isDisposable)(container)) disposables.add(container);
        durations.push({
            providerName: provider._debugDisplayName ?? 'unknown_provider',
            elapsedProvider: container.duration ?? -1,
            elapsedOverall: sw.elapsed()
        });
        return didAddResult;
    };
    // ask for snippets in parallel to asking "real" providers. Only do something if configured to
    // do so - no snippet filter, no special-providers-only request
    const snippetCompletions = (async ()=>{
        if (!$46671b3f02f7e7cd$var$_snippetSuggestSupport || options.kindFilter.has(27 /* languages.CompletionItemKind.Snippet */ )) return;
        // we have items from a previous session that we can reuse
        const reuseItems = options.providerItemsToReuse.get($46671b3f02f7e7cd$var$_snippetSuggestSupport);
        if (reuseItems) {
            reuseItems.forEach((item)=>result.push(item));
            return;
        }
        if (options.providerFilter.size > 0 && !options.providerFilter.has($46671b3f02f7e7cd$var$_snippetSuggestSupport)) return;
        const sw = new (0, $eUQTM.StopWatch)();
        const list = await $46671b3f02f7e7cd$var$_snippetSuggestSupport.provideCompletionItems(model, position, context, token);
        onCompletionList($46671b3f02f7e7cd$var$_snippetSuggestSupport, list, sw);
    })();
    // add suggestions from contributed providers - providers are ordered in groups of
    // equal score and once a group produces a result the process stops
    // get provider groups, always add snippet suggestion provider
    for (const providerGroup of registry.orderedGroups(model)){
        // for each support in the group ask for suggestions
        let didAddResult = false;
        await Promise.all(providerGroup.map(async (provider)=>{
            // we have items from a previous session that we can reuse
            if (options.providerItemsToReuse.has(provider)) {
                const items = options.providerItemsToReuse.get(provider);
                items.forEach((item)=>result.push(item));
                didAddResult = didAddResult || items.length > 0;
                return;
            }
            // check if this provider is filtered out
            if (options.providerFilter.size > 0 && !options.providerFilter.has(provider)) return;
            try {
                const sw = new (0, $eUQTM.StopWatch)();
                const list = await provider.provideCompletionItems(model, position, context, token);
                didAddResult = onCompletionList(provider, list, sw) || didAddResult;
            } catch (err) {
                (0, $gPkHZ.onUnexpectedExternalError)(err);
            }
        }));
        if (didAddResult || token.isCancellationRequested) break;
    }
    await snippetCompletions;
    if (token.isCancellationRequested) {
        disposables.dispose();
        return Promise.reject(new (0, $gPkHZ.CancellationError)());
    }
    return new $46671b3f02f7e7cd$export$5bba491290954073(result.sort($46671b3f02f7e7cd$export$2537afb96e75f997(options.snippetSortOrder)), needsClipboard, {
        entries: durations,
        elapsed: sw.elapsed()
    }, disposables);
}
function $46671b3f02f7e7cd$var$defaultComparator(a, b) {
    // check with 'sortText'
    if (a.sortTextLow && b.sortTextLow) {
        if (a.sortTextLow < b.sortTextLow) return -1;
        else if (a.sortTextLow > b.sortTextLow) return 1;
    }
    // check with 'label'
    if (a.textLabel < b.textLabel) return -1;
    else if (a.textLabel > b.textLabel) return 1;
    // check with 'type'
    return a.completion.kind - b.completion.kind;
}
function $46671b3f02f7e7cd$var$snippetUpComparator(a, b) {
    if (a.completion.kind !== b.completion.kind) {
        if (a.completion.kind === 27 /* languages.CompletionItemKind.Snippet */ ) return -1;
        else if (b.completion.kind === 27 /* languages.CompletionItemKind.Snippet */ ) return 1;
    }
    return $46671b3f02f7e7cd$var$defaultComparator(a, b);
}
function $46671b3f02f7e7cd$var$snippetDownComparator(a, b) {
    if (a.completion.kind !== b.completion.kind) {
        if (a.completion.kind === 27 /* languages.CompletionItemKind.Snippet */ ) return 1;
        else if (b.completion.kind === 27 /* languages.CompletionItemKind.Snippet */ ) return -1;
    }
    return $46671b3f02f7e7cd$var$defaultComparator(a, b);
}
const $46671b3f02f7e7cd$var$_snippetComparators = new Map();
$46671b3f02f7e7cd$var$_snippetComparators.set(0 /* SnippetSortOrder.Top */ , $46671b3f02f7e7cd$var$snippetUpComparator);
$46671b3f02f7e7cd$var$_snippetComparators.set(2 /* SnippetSortOrder.Bottom */ , $46671b3f02f7e7cd$var$snippetDownComparator);
$46671b3f02f7e7cd$var$_snippetComparators.set(1 /* SnippetSortOrder.Inline */ , $46671b3f02f7e7cd$var$defaultComparator);
function $46671b3f02f7e7cd$export$2537afb96e75f997(snippetConfig) {
    return $46671b3f02f7e7cd$var$_snippetComparators.get(snippetConfig);
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeCompletionItemProvider', async (accessor, ...args)=>{
    const [uri, position, triggerCharacter, maxItemsToResolve] = args;
    (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(uri));
    (0, $bxBg7.assertType)((0, $dcxQ7.Position).isIPosition(position));
    (0, $bxBg7.assertType)(typeof triggerCharacter === 'string' || !triggerCharacter);
    (0, $bxBg7.assertType)(typeof maxItemsToResolve === 'number' || !maxItemsToResolve);
    const { completionProvider: completionProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const ref = await accessor.get((0, $aTkrt.ITextModelService)).createModelReference(uri);
    try {
        const result = {
            incomplete: false,
            suggestions: []
        };
        const resolving = [];
        const actualPosition = ref.object.textEditorModel.validatePosition(position);
        const completions = await $46671b3f02f7e7cd$export$c34b3fef967c72b0(completionProvider, ref.object.textEditorModel, actualPosition, undefined, {
            triggerCharacter: triggerCharacter ?? undefined,
            triggerKind: triggerCharacter ? 1 /* languages.CompletionTriggerKind.TriggerCharacter */  : 0 /* languages.CompletionTriggerKind.Invoke */ 
        });
        for (const item of completions.items){
            if (resolving.length < (maxItemsToResolve ?? 0)) resolving.push(item.resolve((0, $giPcZ.CancellationToken).None));
            result.incomplete = result.incomplete || item.container.incomplete;
            result.suggestions.push(item.completion);
        }
        try {
            await Promise.all(resolving);
            return result;
        } finally{
            setTimeout(()=>completions.disposable.dispose(), 100);
        }
    } finally{
        ref.dispose();
    }
});
function $46671b3f02f7e7cd$export$88d43510c0fc4cc4(editor, provider) {
    editor.getContribution('editor.contrib.suggestController')?.triggerSuggest(new Set().add(provider), undefined, true);
}
class $46671b3f02f7e7cd$export$8cddbe8aa50feac1 {
    static isAllOff(config) {
        return config.other === 'off' && config.comments === 'off' && config.strings === 'off';
    }
    static isAllOn(config) {
        return config.other === 'on' && config.comments === 'on' && config.strings === 'on';
    }
    static valueFor(config, tokenType) {
        switch(tokenType){
            case 1 /* StandardTokenType.Comment */ :
                return config.comments;
            case 2 /* StandardTokenType.String */ :
                return config.strings;
            default:
                return config.other;
        }
    }
}



var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $dvEeB = parcelRequire("dvEeB");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");


var $kHJv6 = parcelRequire("kHJv6");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $1qkuR = parcelRequire("1qkuR");

var $91ntV = parcelRequire("91ntV");

var $8GcbM = parcelRequire("8GcbM");

var $6c7bv = parcelRequire("6c7bv");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $fGpwm = parcelRequire("fGpwm");

var $lb0Ah = parcelRequire("lb0Ah");
function $41077bc526ea28e1$export$86de3c9238cdb7b7(path, isWindowsOS = (0, $lb0Ah.isWindows)) {
    if ((0, $fGpwm.hasDriveLetter)(path, isWindowsOS)) return path.charAt(0).toUpperCase() + path.slice(1);
    return path;
}
let $41077bc526ea28e1$var$normalizedUserHomeCached = Object.create(null);



var $a4dH7 = parcelRequire("a4dH7");

var $5Aea5 = parcelRequire("5Aea5");

var $jcr1R = parcelRequire("jcr1R");


var $1qkuR = parcelRequire("1qkuR");


var $4dEdH = parcelRequire("4dEdH");

var $6c7bv = parcelRequire("6c7bv");
var $d249e942ccf2edd7$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $d249e942ccf2edd7$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $d249e942ccf2edd7$export$d9f63a18e880ec91 = Object.freeze({
    'CURRENT_YEAR': true,
    'CURRENT_YEAR_SHORT': true,
    'CURRENT_MONTH': true,
    'CURRENT_DATE': true,
    'CURRENT_HOUR': true,
    'CURRENT_MINUTE': true,
    'CURRENT_SECOND': true,
    'CURRENT_DAY_NAME': true,
    'CURRENT_DAY_NAME_SHORT': true,
    'CURRENT_MONTH_NAME': true,
    'CURRENT_MONTH_NAME_SHORT': true,
    'CURRENT_SECONDS_UNIX': true,
    'CURRENT_TIMEZONE_OFFSET': true,
    'SELECTION': true,
    'CLIPBOARD': true,
    'TM_SELECTED_TEXT': true,
    'TM_CURRENT_LINE': true,
    'TM_CURRENT_WORD': true,
    'TM_LINE_INDEX': true,
    'TM_LINE_NUMBER': true,
    'TM_FILENAME': true,
    'TM_FILENAME_BASE': true,
    'TM_DIRECTORY': true,
    'TM_FILEPATH': true,
    'CURSOR_INDEX': true,
    'CURSOR_NUMBER': true,
    'RELATIVE_FILEPATH': true,
    'BLOCK_COMMENT_START': true,
    'BLOCK_COMMENT_END': true,
    'LINE_COMMENT': true,
    'WORKSPACE_NAME': true,
    'WORKSPACE_FOLDER': true,
    'RANDOM': true,
    'RANDOM_HEX': true,
    'UUID': true
});
class $d249e942ccf2edd7$export$e3a7bd665cf54cee {
    constructor(_delegates){
        this._delegates = _delegates;
    //
    }
    resolve(variable) {
        for (const delegate of this._delegates){
            const value = delegate.resolve(variable);
            if (value !== undefined) return value;
        }
        return undefined;
    }
}
class $d249e942ccf2edd7$export$d2ecf5fbc0b88e32 {
    constructor(_model, _selection, _selectionIdx, _overtypingCapturer){
        this._model = _model;
        this._selection = _selection;
        this._selectionIdx = _selectionIdx;
        this._overtypingCapturer = _overtypingCapturer;
    //
    }
    resolve(variable) {
        const { name: name } = variable;
        if (name === 'SELECTION' || name === 'TM_SELECTED_TEXT') {
            let value = this._model.getValueInRange(this._selection) || undefined;
            let isMultiline = this._selection.startLineNumber !== this._selection.endLineNumber;
            // If there was no selected text, try to get last overtyped text
            if (!value && this._overtypingCapturer) {
                const info = this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);
                if (info) {
                    value = info.value;
                    isMultiline = info.multiline;
                }
            }
            if (value && isMultiline && variable.snippet) {
                // Selection is a multiline string which we indentation we now
                // need to adjust. We compare the indentation of this variable
                // with the indentation at the editor position and add potential
                // extra indentation to the value
                const line = this._model.getLineContent(this._selection.startLineNumber);
                const lineLeadingWhitespace = (0, $jcr1R.getLeadingWhitespace)(line, 0, this._selection.startColumn - 1);
                let varLeadingWhitespace = lineLeadingWhitespace;
                variable.snippet.walk((marker)=>{
                    if (marker === variable) return false;
                    if (marker instanceof (0, $464b8f1057bff784$export$5f1af8db9871e1d6)) varLeadingWhitespace = (0, $jcr1R.getLeadingWhitespace)((0, $jcr1R.splitLines)(marker.value).pop());
                    return true;
                });
                const whitespaceCommonLength = (0, $jcr1R.commonPrefixLength)(varLeadingWhitespace, lineLeadingWhitespace);
                value = value.replace(/(\r\n|\r|\n)(.*)/g, (m, newline, rest)=>`${newline}${varLeadingWhitespace.substr(whitespaceCommonLength)}${rest}`);
            }
            return value;
        } else if (name === 'TM_CURRENT_LINE') return this._model.getLineContent(this._selection.positionLineNumber);
        else if (name === 'TM_CURRENT_WORD') {
            const info = this._model.getWordAtPosition({
                lineNumber: this._selection.positionLineNumber,
                column: this._selection.positionColumn
            });
            return info && info.word || undefined;
        } else if (name === 'TM_LINE_INDEX') return String(this._selection.positionLineNumber - 1);
        else if (name === 'TM_LINE_NUMBER') return String(this._selection.positionLineNumber);
        else if (name === 'CURSOR_INDEX') return String(this._selectionIdx);
        else if (name === 'CURSOR_NUMBER') return String(this._selectionIdx + 1);
        return undefined;
    }
}
class $d249e942ccf2edd7$export$23aa3af8f3bd9e57 {
    constructor(_labelService, _model){
        this._labelService = _labelService;
        this._model = _model;
    //
    }
    resolve(variable) {
        const { name: name } = variable;
        if (name === 'TM_FILENAME') return $a4dH7.basename(this._model.uri.fsPath);
        else if (name === 'TM_FILENAME_BASE') {
            const name = $a4dH7.basename(this._model.uri.fsPath);
            const idx = name.lastIndexOf('.');
            if (idx <= 0) return name;
            else return name.slice(0, idx);
        } else if (name === 'TM_DIRECTORY') {
            if ($a4dH7.dirname(this._model.uri.fsPath) === '.') return '';
            return this._labelService.getUriLabel((0, $5Aea5.dirname)(this._model.uri));
        } else if (name === 'TM_FILEPATH') return this._labelService.getUriLabel(this._model.uri);
        else if (name === 'RELATIVE_FILEPATH') return this._labelService.getUriLabel(this._model.uri, {
            relative: true,
            noPrefix: true
        });
        return undefined;
    }
}
class $d249e942ccf2edd7$export$51fb631a281a1cb7 {
    constructor(_readClipboardText, _selectionIdx, _selectionCount, _spread){
        this._readClipboardText = _readClipboardText;
        this._selectionIdx = _selectionIdx;
        this._selectionCount = _selectionCount;
        this._spread = _spread;
    //
    }
    resolve(variable) {
        if (variable.name !== 'CLIPBOARD') return undefined;
        const clipboardText = this._readClipboardText();
        if (!clipboardText) return undefined;
        // `spread` is assigning each cursor a line of the clipboard
        // text whenever there the line count equals the cursor count
        // and when enabled
        if (this._spread) {
            const lines = clipboardText.split(/\r\n|\n|\r/).filter((s)=>!(0, $jcr1R.isFalsyOrWhitespace)(s));
            if (lines.length === this._selectionCount) return lines[this._selectionIdx];
        }
        return clipboardText;
    }
}
let $d249e942ccf2edd7$export$93486f5d6db748c0 = class CommentBasedVariableResolver {
    constructor(_model, _selection, _languageConfigurationService){
        this._model = _model;
        this._selection = _selection;
        this._languageConfigurationService = _languageConfigurationService;
    //
    }
    resolve(variable) {
        const { name: name } = variable;
        const langId = this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber, this._selection.selectionStartColumn);
        const config = this._languageConfigurationService.getLanguageConfiguration(langId).comments;
        if (!config) return undefined;
        if (name === 'LINE_COMMENT') return config.lineCommentToken || undefined;
        else if (name === 'BLOCK_COMMENT_START') return config.blockCommentStartToken || undefined;
        else if (name === 'BLOCK_COMMENT_END') return config.blockCommentEndToken || undefined;
        return undefined;
    }
};
$d249e942ccf2edd7$export$93486f5d6db748c0 = $d249e942ccf2edd7$var$__decorate([
    $d249e942ccf2edd7$var$__param(2, (0, $1qkuR.ILanguageConfigurationService))
], $d249e942ccf2edd7$export$93486f5d6db748c0);
class $d249e942ccf2edd7$export$3c8bf74f3a7220f9 {
    constructor(){
        this._date = new Date();
    }
    static{
        this.dayNames = [
            $4dEdH.localize('Sunday', "Sunday"),
            $4dEdH.localize('Monday', "Monday"),
            $4dEdH.localize('Tuesday', "Tuesday"),
            $4dEdH.localize('Wednesday', "Wednesday"),
            $4dEdH.localize('Thursday', "Thursday"),
            $4dEdH.localize('Friday', "Friday"),
            $4dEdH.localize('Saturday', "Saturday")
        ];
    }
    static{
        this.dayNamesShort = [
            $4dEdH.localize('SundayShort', "Sun"),
            $4dEdH.localize('MondayShort', "Mon"),
            $4dEdH.localize('TuesdayShort', "Tue"),
            $4dEdH.localize('WednesdayShort', "Wed"),
            $4dEdH.localize('ThursdayShort', "Thu"),
            $4dEdH.localize('FridayShort', "Fri"),
            $4dEdH.localize('SaturdayShort', "Sat")
        ];
    }
    static{
        this.monthNames = [
            $4dEdH.localize('January', "January"),
            $4dEdH.localize('February', "February"),
            $4dEdH.localize('March', "March"),
            $4dEdH.localize('April', "April"),
            $4dEdH.localize('May', "May"),
            $4dEdH.localize('June', "June"),
            $4dEdH.localize('July', "July"),
            $4dEdH.localize('August', "August"),
            $4dEdH.localize('September', "September"),
            $4dEdH.localize('October', "October"),
            $4dEdH.localize('November', "November"),
            $4dEdH.localize('December', "December")
        ];
    }
    static{
        this.monthNamesShort = [
            $4dEdH.localize('JanuaryShort', "Jan"),
            $4dEdH.localize('FebruaryShort', "Feb"),
            $4dEdH.localize('MarchShort', "Mar"),
            $4dEdH.localize('AprilShort', "Apr"),
            $4dEdH.localize('MayShort', "May"),
            $4dEdH.localize('JuneShort', "Jun"),
            $4dEdH.localize('JulyShort', "Jul"),
            $4dEdH.localize('AugustShort', "Aug"),
            $4dEdH.localize('SeptemberShort', "Sep"),
            $4dEdH.localize('OctoberShort', "Oct"),
            $4dEdH.localize('NovemberShort', "Nov"),
            $4dEdH.localize('DecemberShort', "Dec")
        ];
    }
    resolve(variable) {
        const { name: name } = variable;
        if (name === 'CURRENT_YEAR') return String(this._date.getFullYear());
        else if (name === 'CURRENT_YEAR_SHORT') return String(this._date.getFullYear()).slice(-2);
        else if (name === 'CURRENT_MONTH') return String(this._date.getMonth().valueOf() + 1).padStart(2, '0');
        else if (name === 'CURRENT_DATE') return String(this._date.getDate().valueOf()).padStart(2, '0');
        else if (name === 'CURRENT_HOUR') return String(this._date.getHours().valueOf()).padStart(2, '0');
        else if (name === 'CURRENT_MINUTE') return String(this._date.getMinutes().valueOf()).padStart(2, '0');
        else if (name === 'CURRENT_SECOND') return String(this._date.getSeconds().valueOf()).padStart(2, '0');
        else if (name === 'CURRENT_DAY_NAME') return $d249e942ccf2edd7$export$3c8bf74f3a7220f9.dayNames[this._date.getDay()];
        else if (name === 'CURRENT_DAY_NAME_SHORT') return $d249e942ccf2edd7$export$3c8bf74f3a7220f9.dayNamesShort[this._date.getDay()];
        else if (name === 'CURRENT_MONTH_NAME') return $d249e942ccf2edd7$export$3c8bf74f3a7220f9.monthNames[this._date.getMonth()];
        else if (name === 'CURRENT_MONTH_NAME_SHORT') return $d249e942ccf2edd7$export$3c8bf74f3a7220f9.monthNamesShort[this._date.getMonth()];
        else if (name === 'CURRENT_SECONDS_UNIX') return String(Math.floor(this._date.getTime() / 1000));
        else if (name === 'CURRENT_TIMEZONE_OFFSET') {
            const rawTimeOffset = this._date.getTimezoneOffset();
            const sign = rawTimeOffset > 0 ? '-' : '+';
            const hours = Math.trunc(Math.abs(rawTimeOffset / 60));
            const hoursString = hours < 10 ? '0' + hours : hours;
            const minutes = Math.abs(rawTimeOffset) - hours * 60;
            const minutesString = minutes < 10 ? '0' + minutes : minutes;
            return sign + hoursString + ':' + minutesString;
        }
        return undefined;
    }
}
class $d249e942ccf2edd7$export$f1d01458dc99b68c {
    constructor(_workspaceService){
        this._workspaceService = _workspaceService;
    //
    }
    resolve(variable) {
        if (!this._workspaceService) return undefined;
        const workspaceIdentifier = (0, $6c7bv.toWorkspaceIdentifier)(this._workspaceService.getWorkspace());
        if ((0, $6c7bv.isEmptyWorkspaceIdentifier)(workspaceIdentifier)) return undefined;
        if (variable.name === 'WORKSPACE_NAME') return this._resolveWorkspaceName(workspaceIdentifier);
        else if (variable.name === 'WORKSPACE_FOLDER') return this._resoveWorkspacePath(workspaceIdentifier);
        return undefined;
    }
    _resolveWorkspaceName(workspaceIdentifier) {
        if ((0, $6c7bv.isSingleFolderWorkspaceIdentifier)(workspaceIdentifier)) return $a4dH7.basename(workspaceIdentifier.uri.path);
        let filename = $a4dH7.basename(workspaceIdentifier.configPath.path);
        if (filename.endsWith((0, $6c7bv.WORKSPACE_EXTENSION))) filename = filename.substr(0, filename.length - (0, $6c7bv.WORKSPACE_EXTENSION).length - 1);
        return filename;
    }
    _resoveWorkspacePath(workspaceIdentifier) {
        if ((0, $6c7bv.isSingleFolderWorkspaceIdentifier)(workspaceIdentifier)) return (0, $41077bc526ea28e1$export$86de3c9238cdb7b7)(workspaceIdentifier.uri.fsPath);
        const filename = $a4dH7.basename(workspaceIdentifier.configPath.path);
        let folderpath = workspaceIdentifier.configPath.fsPath;
        if (folderpath.endsWith(filename)) folderpath = folderpath.substr(0, folderpath.length - filename.length - 1);
        return folderpath ? (0, $41077bc526ea28e1$export$86de3c9238cdb7b7)(folderpath) : '/';
    }
}
class $d249e942ccf2edd7$export$35234542a316122e {
    resolve(variable) {
        const { name: name } = variable;
        if (name === 'RANDOM') return Math.random().toString().slice(-6);
        else if (name === 'RANDOM_HEX') return Math.random().toString(16).slice(-6);
        else if (name === 'UUID') return (0, $0805a875738ca87e$export$1c3aefb711c3a4cc)();
        return undefined;
    }
}


var $54ac6892e512fa7e$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $54ac6892e512fa7e$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $54ac6892e512fa7e$var$SnippetSession_1;
class $54ac6892e512fa7e$export$c14aba13900af0fa {
    static{
        this._decor = {
            active: (0, $91ntV.ModelDecorationOptions).register({
                description: 'snippet-placeholder-1',
                stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
                className: 'snippet-placeholder'
            }),
            inactive: (0, $91ntV.ModelDecorationOptions).register({
                description: 'snippet-placeholder-2',
                stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
                className: 'snippet-placeholder'
            }),
            activeFinal: (0, $91ntV.ModelDecorationOptions).register({
                description: 'snippet-placeholder-3',
                stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
                className: 'finish-snippet-placeholder'
            }),
            inactiveFinal: (0, $91ntV.ModelDecorationOptions).register({
                description: 'snippet-placeholder-4',
                stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
                className: 'finish-snippet-placeholder'
            })
        };
    }
    constructor(_editor, _snippet, _snippetLineLeadingWhitespace){
        this._editor = _editor;
        this._snippet = _snippet;
        this._snippetLineLeadingWhitespace = _snippetLineLeadingWhitespace;
        this._offset = -1;
        this._nestingLevel = 1;
        this._placeholderGroups = (0, $kJ8UG.groupBy)(_snippet.placeholders, (0, $464b8f1057bff784$export$84712d0562a614b8).compareByIndex);
        this._placeholderGroupsIdx = -1;
    }
    initialize(textChange) {
        this._offset = textChange.newPosition;
    }
    dispose() {
        if (this._placeholderDecorations) this._editor.removeDecorations([
            ...this._placeholderDecorations.values()
        ]);
        this._placeholderGroups.length = 0;
    }
    _initDecorations() {
        if (this._offset === -1) throw new Error(`Snippet not initialized!`);
        if (this._placeholderDecorations) // already initialized
        return;
        this._placeholderDecorations = new Map();
        const model = this._editor.getModel();
        this._editor.changeDecorations((accessor)=>{
            // create a decoration for each placeholder
            for (const placeholder of this._snippet.placeholders){
                const placeholderOffset = this._snippet.offset(placeholder);
                const placeholderLen = this._snippet.fullLen(placeholder);
                const range = (0, $d00il.Range).fromPositions(model.getPositionAt(this._offset + placeholderOffset), model.getPositionAt(this._offset + placeholderOffset + placeholderLen));
                const options = placeholder.isFinalTabstop ? $54ac6892e512fa7e$export$c14aba13900af0fa._decor.inactiveFinal : $54ac6892e512fa7e$export$c14aba13900af0fa._decor.inactive;
                const handle = accessor.addDecoration(range, options);
                this._placeholderDecorations.set(placeholder, handle);
            }
        });
    }
    move(fwd) {
        if (!this._editor.hasModel()) return [];
        this._initDecorations();
        // Transform placeholder text if necessary
        if (this._placeholderGroupsIdx >= 0) {
            const operations = [];
            for (const placeholder of this._placeholderGroups[this._placeholderGroupsIdx])// Check if the placeholder has a transformation
            if (placeholder.transform) {
                const id = this._placeholderDecorations.get(placeholder);
                const range = this._editor.getModel().getDecorationRange(id);
                const currentValue = this._editor.getModel().getValueInRange(range);
                const transformedValueLines = placeholder.transform.resolve(currentValue).split(/\r\n|\r|\n/);
                // fix indentation for transformed lines
                for(let i = 1; i < transformedValueLines.length; i++)transformedValueLines[i] = this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace + transformedValueLines[i]);
                operations.push((0, $kHJv6.EditOperation).replace(range, transformedValueLines.join(this._editor.getModel().getEOL())));
            }
            if (operations.length > 0) this._editor.executeEdits('snippet.placeholderTransform', operations);
        }
        let couldSkipThisPlaceholder = false;
        if (fwd === true && this._placeholderGroupsIdx < this._placeholderGroups.length - 1) {
            this._placeholderGroupsIdx += 1;
            couldSkipThisPlaceholder = true;
        } else if (fwd === false && this._placeholderGroupsIdx > 0) {
            this._placeholderGroupsIdx -= 1;
            couldSkipThisPlaceholder = true;
        }
        const newSelections = this._editor.getModel().changeDecorations((accessor)=>{
            const activePlaceholders = new Set();
            // change stickiness to always grow when typing at its edges
            // because these decorations represent the currently active
            // tabstop.
            // Special case #1: reaching the final tabstop
            // Special case #2: placeholders enclosing active placeholders
            const selections = [];
            for (const placeholder of this._placeholderGroups[this._placeholderGroupsIdx]){
                const id = this._placeholderDecorations.get(placeholder);
                const range = this._editor.getModel().getDecorationRange(id);
                selections.push(new (0, $jzicX.Selection)(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn));
                // consider to skip this placeholder index when the decoration
                // range is empty but when the placeholder wasn't. that's a strong
                // hint that the placeholder has been deleted. (all placeholder must match this)
                couldSkipThisPlaceholder = couldSkipThisPlaceholder && this._hasPlaceholderBeenCollapsed(placeholder);
                accessor.changeDecorationOptions(id, placeholder.isFinalTabstop ? $54ac6892e512fa7e$export$c14aba13900af0fa._decor.activeFinal : $54ac6892e512fa7e$export$c14aba13900af0fa._decor.active);
                activePlaceholders.add(placeholder);
                for (const enclosingPlaceholder of this._snippet.enclosingPlaceholders(placeholder)){
                    const id = this._placeholderDecorations.get(enclosingPlaceholder);
                    accessor.changeDecorationOptions(id, enclosingPlaceholder.isFinalTabstop ? $54ac6892e512fa7e$export$c14aba13900af0fa._decor.activeFinal : $54ac6892e512fa7e$export$c14aba13900af0fa._decor.active);
                    activePlaceholders.add(enclosingPlaceholder);
                }
            }
            // change stickness to never grow when typing at its edges
            // so that in-active tabstops never grow
            for (const [placeholder, id] of this._placeholderDecorations)if (!activePlaceholders.has(placeholder)) accessor.changeDecorationOptions(id, placeholder.isFinalTabstop ? $54ac6892e512fa7e$export$c14aba13900af0fa._decor.inactiveFinal : $54ac6892e512fa7e$export$c14aba13900af0fa._decor.inactive);
            return selections;
        });
        return !couldSkipThisPlaceholder ? newSelections ?? [] : this.move(fwd);
    }
    _hasPlaceholderBeenCollapsed(placeholder) {
        // A placeholder is empty when it wasn't empty when authored but
        // when its tracking decoration is empty. This also applies to all
        // potential parent placeholders
        let marker = placeholder;
        while(marker){
            if (marker instanceof (0, $464b8f1057bff784$export$84712d0562a614b8)) {
                const id = this._placeholderDecorations.get(marker);
                const range = this._editor.getModel().getDecorationRange(id);
                if (range.isEmpty() && marker.toString().length > 0) return true;
            }
            marker = marker.parent;
        }
        return false;
    }
    get isAtFirstPlaceholder() {
        return this._placeholderGroupsIdx <= 0 || this._placeholderGroups.length === 0;
    }
    get isAtLastPlaceholder() {
        return this._placeholderGroupsIdx === this._placeholderGroups.length - 1;
    }
    get hasPlaceholder() {
        return this._snippet.placeholders.length > 0;
    }
    /**
     * A snippet is trivial when it has no placeholder or only a final placeholder at
     * its very end
     */ get isTrivialSnippet() {
        if (this._snippet.placeholders.length === 0) return true;
        if (this._snippet.placeholders.length === 1) {
            const [placeholder] = this._snippet.placeholders;
            if (placeholder.isFinalTabstop) {
                if (this._snippet.rightMostDescendant === placeholder) return true;
            }
        }
        return false;
    }
    computePossibleSelections() {
        const result = new Map();
        for (const placeholdersWithEqualIndex of this._placeholderGroups){
            let ranges;
            for (const placeholder of placeholdersWithEqualIndex){
                if (placeholder.isFinalTabstop) break;
                if (!ranges) {
                    ranges = [];
                    result.set(placeholder.index, ranges);
                }
                const id = this._placeholderDecorations.get(placeholder);
                const range = this._editor.getModel().getDecorationRange(id);
                if (!range) {
                    // one of the placeholder lost its decoration and
                    // therefore we bail out and pretend the placeholder
                    // (with its mirrors) doesn't exist anymore.
                    result.delete(placeholder.index);
                    break;
                }
                ranges.push(range);
            }
        }
        return result;
    }
    get activeChoice() {
        if (!this._placeholderDecorations) return undefined;
        const placeholder = this._placeholderGroups[this._placeholderGroupsIdx][0];
        if (!placeholder?.choice) return undefined;
        const id = this._placeholderDecorations.get(placeholder);
        if (!id) return undefined;
        const range = this._editor.getModel().getDecorationRange(id);
        if (!range) return undefined;
        return {
            range: range,
            choice: placeholder.choice
        };
    }
    get hasChoice() {
        let result = false;
        this._snippet.walk((marker)=>{
            result = marker instanceof (0, $464b8f1057bff784$export$32a7462f6a06cbd5);
            return !result;
        });
        return result;
    }
    merge(others) {
        const model = this._editor.getModel();
        this._nestingLevel *= 10;
        this._editor.changeDecorations((accessor)=>{
            // For each active placeholder take one snippet and merge it
            // in that the placeholder (can be many for `$1foo$1foo`). Because
            // everything is sorted by editor selection we can simply remove
            // elements from the beginning of the array
            for (const placeholder of this._placeholderGroups[this._placeholderGroupsIdx]){
                const nested = others.shift();
                console.assert(nested._offset !== -1);
                console.assert(!nested._placeholderDecorations);
                // Massage placeholder-indicies of the nested snippet to be
                // sorted right after the insertion point. This ensures we move
                // through the placeholders in the correct order
                const indexLastPlaceholder = nested._snippet.placeholderInfo.last.index;
                for (const nestedPlaceholder of nested._snippet.placeholderInfo.all)if (nestedPlaceholder.isFinalTabstop) nestedPlaceholder.index = placeholder.index + (indexLastPlaceholder + 1) / this._nestingLevel;
                else nestedPlaceholder.index = placeholder.index + nestedPlaceholder.index / this._nestingLevel;
                this._snippet.replace(placeholder, nested._snippet.children);
                // Remove the placeholder at which position are inserting
                // the snippet and also remove its decoration.
                const id = this._placeholderDecorations.get(placeholder);
                accessor.removeDecoration(id);
                this._placeholderDecorations.delete(placeholder);
                // For each *new* placeholder we create decoration to monitor
                // how and if it grows/shrinks.
                for (const placeholder of nested._snippet.placeholders){
                    const placeholderOffset = nested._snippet.offset(placeholder);
                    const placeholderLen = nested._snippet.fullLen(placeholder);
                    const range = (0, $d00il.Range).fromPositions(model.getPositionAt(nested._offset + placeholderOffset), model.getPositionAt(nested._offset + placeholderOffset + placeholderLen));
                    const handle = accessor.addDecoration(range, $54ac6892e512fa7e$export$c14aba13900af0fa._decor.inactive);
                    this._placeholderDecorations.set(placeholder, handle);
                }
            }
            // Last, re-create the placeholder groups by sorting placeholders by their index.
            this._placeholderGroups = (0, $kJ8UG.groupBy)(this._snippet.placeholders, (0, $464b8f1057bff784$export$84712d0562a614b8).compareByIndex);
        });
    }
}
const $54ac6892e512fa7e$var$_defaultOptions = {
    overwriteBefore: 0,
    overwriteAfter: 0,
    adjustWhitespace: true,
    clipboardText: undefined,
    overtypingCapturer: undefined
};
let $54ac6892e512fa7e$export$d334bb6e0f563f7 = $54ac6892e512fa7e$var$SnippetSession_1 = class SnippetSession {
    static adjustWhitespace(model, position, adjustIndentation, snippet, filter) {
        const line = model.getLineContent(position.lineNumber);
        const lineLeadingWhitespace = (0, $jcr1R.getLeadingWhitespace)(line, 0, position.column - 1);
        // the snippet as inserted
        let snippetTextString;
        snippet.walk((marker)=>{
            // all text elements that are not inside choice
            if (!(marker instanceof (0, $464b8f1057bff784$export$5f1af8db9871e1d6)) || marker.parent instanceof (0, $464b8f1057bff784$export$32a7462f6a06cbd5)) return true;
            // check with filter (iff provided)
            if (filter && !filter.has(marker)) return true;
            const lines = marker.value.split(/\r\n|\r|\n/);
            if (adjustIndentation) {
                // adjust indentation of snippet test
                // -the snippet-start doesn't get extra-indented (lineLeadingWhitespace), only normalized
                // -all N+1 lines get extra-indented and normalized
                // -the text start get extra-indented and normalized when following a linebreak
                const offset = snippet.offset(marker);
                if (offset === 0) // snippet start
                lines[0] = model.normalizeIndentation(lines[0]);
                else {
                    // check if text start is after a linebreak
                    snippetTextString = snippetTextString ?? snippet.toString();
                    const prevChar = snippetTextString.charCodeAt(offset - 1);
                    if (prevChar === 10 /* CharCode.LineFeed */  || prevChar === 13 /* CharCode.CarriageReturn */ ) lines[0] = model.normalizeIndentation(lineLeadingWhitespace + lines[0]);
                }
                for(let i = 1; i < lines.length; i++)lines[i] = model.normalizeIndentation(lineLeadingWhitespace + lines[i]);
            }
            const newValue = lines.join(model.getEOL());
            if (newValue !== marker.value) {
                marker.parent.replace(marker, [
                    new (0, $464b8f1057bff784$export$5f1af8db9871e1d6)(newValue)
                ]);
                snippetTextString = undefined;
            }
            return true;
        });
        return lineLeadingWhitespace;
    }
    static adjustSelection(model, selection, overwriteBefore, overwriteAfter) {
        if (overwriteBefore !== 0 || overwriteAfter !== 0) {
            // overwrite[Before|After] is compute using the position, not the whole
            // selection. therefore we adjust the selection around that position
            const { positionLineNumber: positionLineNumber, positionColumn: positionColumn } = selection;
            const positionColumnBefore = positionColumn - overwriteBefore;
            const positionColumnAfter = positionColumn + overwriteAfter;
            const range = model.validateRange({
                startLineNumber: positionLineNumber,
                startColumn: positionColumnBefore,
                endLineNumber: positionLineNumber,
                endColumn: positionColumnAfter
            });
            selection = (0, $jzicX.Selection).createWithDirection(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn, selection.getDirection());
        }
        return selection;
    }
    static createEditsAndSnippetsFromSelections(editor, template, overwriteBefore, overwriteAfter, enforceFinalTabstop, adjustWhitespace, clipboardText, overtypingCapturer, languageConfigurationService) {
        const edits = [];
        const snippets = [];
        if (!editor.hasModel()) return {
            edits: edits,
            snippets: snippets
        };
        const model = editor.getModel();
        const workspaceService = editor.invokeWithinContext((accessor)=>accessor.get((0, $6c7bv.IWorkspaceContextService)));
        const modelBasedVariableResolver = editor.invokeWithinContext((accessor)=>new (0, $d249e942ccf2edd7$export$23aa3af8f3bd9e57)(accessor.get((0, $8GcbM.ILabelService)), model));
        const readClipboardText = ()=>clipboardText;
        // know what text the overwrite[Before|After] extensions
        // of the primary curser have selected because only when
        // secondary selections extend to the same text we can grow them
        const firstBeforeText = model.getValueInRange($54ac6892e512fa7e$var$SnippetSession_1.adjustSelection(model, editor.getSelection(), overwriteBefore, 0));
        const firstAfterText = model.getValueInRange($54ac6892e512fa7e$var$SnippetSession_1.adjustSelection(model, editor.getSelection(), 0, overwriteAfter));
        // remember the first non-whitespace column to decide if
        // `keepWhitespace` should be overruled for secondary selections
        const firstLineFirstNonWhitespace = model.getLineFirstNonWhitespaceColumn(editor.getSelection().positionLineNumber);
        // sort selections by their start position but remeber
        // the original index. that allows you to create correct
        // offset-based selection logic without changing the
        // primary selection
        const indexedSelections = editor.getSelections().map((selection, idx)=>({
                selection: selection,
                idx: idx
            })).sort((a, b)=>(0, $d00il.Range).compareRangesUsingStarts(a.selection, b.selection));
        for (const { selection: selection, idx: idx } of indexedSelections){
            // extend selection with the `overwriteBefore` and `overwriteAfter` and then
            // compare if this matches the extensions of the primary selection
            let extensionBefore = $54ac6892e512fa7e$var$SnippetSession_1.adjustSelection(model, selection, overwriteBefore, 0);
            let extensionAfter = $54ac6892e512fa7e$var$SnippetSession_1.adjustSelection(model, selection, 0, overwriteAfter);
            if (firstBeforeText !== model.getValueInRange(extensionBefore)) extensionBefore = selection;
            if (firstAfterText !== model.getValueInRange(extensionAfter)) extensionAfter = selection;
            // merge the before and after selection into one
            const snippetSelection = selection.setStartPosition(extensionBefore.startLineNumber, extensionBefore.startColumn).setEndPosition(extensionAfter.endLineNumber, extensionAfter.endColumn);
            const snippet = new (0, $464b8f1057bff784$export$e073bfe8583e8fbf)().parse(template, true, enforceFinalTabstop);
            // adjust the template string to match the indentation and
            // whitespace rules of this insert location (can be different for each cursor)
            // happens when being asked for (default) or when this is a secondary
            // cursor and the leading whitespace is different
            const start = snippetSelection.getStartPosition();
            const snippetLineLeadingWhitespace = $54ac6892e512fa7e$var$SnippetSession_1.adjustWhitespace(model, start, adjustWhitespace || idx > 0 && firstLineFirstNonWhitespace !== model.getLineFirstNonWhitespaceColumn(selection.positionLineNumber), snippet);
            snippet.resolveVariables(new (0, $d249e942ccf2edd7$export$e3a7bd665cf54cee)([
                modelBasedVariableResolver,
                new (0, $d249e942ccf2edd7$export$51fb631a281a1cb7)(readClipboardText, idx, indexedSelections.length, editor.getOption(79 /* EditorOption.multiCursorPaste */ ) === 'spread'),
                new (0, $d249e942ccf2edd7$export$d2ecf5fbc0b88e32)(model, selection, idx, overtypingCapturer),
                new (0, $d249e942ccf2edd7$export$93486f5d6db748c0)(model, selection, languageConfigurationService),
                new (0, $d249e942ccf2edd7$export$3c8bf74f3a7220f9),
                new (0, $d249e942ccf2edd7$export$f1d01458dc99b68c)(workspaceService),
                new (0, $d249e942ccf2edd7$export$35234542a316122e)
            ]));
            // store snippets with the index of their originating selection.
            // that ensures the primiary cursor stays primary despite not being
            // the one with lowest start position
            edits[idx] = (0, $kHJv6.EditOperation).replace(snippetSelection, snippet.toString());
            edits[idx].identifier = {
                major: idx,
                minor: 0
            }; // mark the edit so only our undo edits will be used to generate end cursors
            edits[idx]._isTracked = true;
            snippets[idx] = new $54ac6892e512fa7e$export$c14aba13900af0fa(editor, snippet, snippetLineLeadingWhitespace);
        }
        return {
            edits: edits,
            snippets: snippets
        };
    }
    static createEditsAndSnippetsFromEdits(editor, snippetEdits, enforceFinalTabstop, adjustWhitespace, clipboardText, overtypingCapturer, languageConfigurationService) {
        if (!editor.hasModel() || snippetEdits.length === 0) return {
            edits: [],
            snippets: []
        };
        const edits = [];
        const model = editor.getModel();
        const parser = new (0, $464b8f1057bff784$export$e073bfe8583e8fbf)();
        const snippet = new (0, $464b8f1057bff784$export$263a781ea79d9666)();
        // snippet variables resolver
        const resolver = new (0, $d249e942ccf2edd7$export$e3a7bd665cf54cee)([
            editor.invokeWithinContext((accessor)=>new (0, $d249e942ccf2edd7$export$23aa3af8f3bd9e57)(accessor.get((0, $8GcbM.ILabelService)), model)),
            new (0, $d249e942ccf2edd7$export$51fb631a281a1cb7)(()=>clipboardText, 0, editor.getSelections().length, editor.getOption(79 /* EditorOption.multiCursorPaste */ ) === 'spread'),
            new (0, $d249e942ccf2edd7$export$d2ecf5fbc0b88e32)(model, editor.getSelection(), 0, overtypingCapturer),
            new (0, $d249e942ccf2edd7$export$93486f5d6db748c0)(model, editor.getSelection(), languageConfigurationService),
            new (0, $d249e942ccf2edd7$export$3c8bf74f3a7220f9),
            new (0, $d249e942ccf2edd7$export$f1d01458dc99b68c)(editor.invokeWithinContext((accessor)=>accessor.get((0, $6c7bv.IWorkspaceContextService)))),
            new (0, $d249e942ccf2edd7$export$35234542a316122e)
        ]);
        //
        snippetEdits = snippetEdits.sort((a, b)=>(0, $d00il.Range).compareRangesUsingStarts(a.range, b.range));
        let offset = 0;
        for(let i = 0; i < snippetEdits.length; i++){
            const { range: range, template: template } = snippetEdits[i];
            // gaps between snippet edits are appended as text nodes. this
            // ensures placeholder-offsets are later correct
            if (i > 0) {
                const lastRange = snippetEdits[i - 1].range;
                const textRange = (0, $d00il.Range).fromPositions(lastRange.getEndPosition(), range.getStartPosition());
                const textNode = new (0, $464b8f1057bff784$export$5f1af8db9871e1d6)(model.getValueInRange(textRange));
                snippet.appendChild(textNode);
                offset += textNode.value.length;
            }
            const newNodes = parser.parseFragment(template, snippet);
            $54ac6892e512fa7e$var$SnippetSession_1.adjustWhitespace(model, range.getStartPosition(), true, snippet, new Set(newNodes));
            snippet.resolveVariables(resolver);
            const snippetText = snippet.toString();
            const snippetFragmentText = snippetText.slice(offset);
            offset = snippetText.length;
            // make edit
            const edit = (0, $kHJv6.EditOperation).replace(range, snippetFragmentText);
            edit.identifier = {
                major: i,
                minor: 0
            }; // mark the edit so only our undo edits will be used to generate end cursors
            edit._isTracked = true;
            edits.push(edit);
        }
        //
        parser.ensureFinalTabstop(snippet, enforceFinalTabstop, true);
        return {
            edits: edits,
            snippets: [
                new $54ac6892e512fa7e$export$c14aba13900af0fa(editor, snippet, '')
            ]
        };
    }
    constructor(_editor, _template, _options = $54ac6892e512fa7e$var$_defaultOptions, _languageConfigurationService){
        this._editor = _editor;
        this._template = _template;
        this._options = _options;
        this._languageConfigurationService = _languageConfigurationService;
        this._templateMerges = [];
        this._snippets = [];
    }
    dispose() {
        (0, $9cWcn.dispose)(this._snippets);
    }
    _logInfo() {
        return `template="${this._template}", merged_templates="${this._templateMerges.join(' -> ')}"`;
    }
    insert() {
        if (!this._editor.hasModel()) return;
        // make insert edit and start with first selections
        const { edits: edits, snippets: snippets } = typeof this._template === 'string' ? $54ac6892e512fa7e$var$SnippetSession_1.createEditsAndSnippetsFromSelections(this._editor, this._template, this._options.overwriteBefore, this._options.overwriteAfter, false, this._options.adjustWhitespace, this._options.clipboardText, this._options.overtypingCapturer, this._languageConfigurationService) : $54ac6892e512fa7e$var$SnippetSession_1.createEditsAndSnippetsFromEdits(this._editor, this._template, false, this._options.adjustWhitespace, this._options.clipboardText, this._options.overtypingCapturer, this._languageConfigurationService);
        this._snippets = snippets;
        this._editor.executeEdits('snippet', edits, (_undoEdits)=>{
            // Sometimes, the text buffer will remove automatic whitespace when doing any edits,
            // so we need to look only at the undo edits relevant for us.
            // Our edits have an identifier set so that's how we can distinguish them
            const undoEdits = _undoEdits.filter((edit)=>!!edit.identifier);
            for(let idx = 0; idx < snippets.length; idx++)snippets[idx].initialize(undoEdits[idx].textChange);
            if (this._snippets[0].hasPlaceholder) return this._move(true);
            else return undoEdits.map((edit)=>(0, $jzicX.Selection).fromPositions(edit.range.getEndPosition()));
        });
        this._editor.revealRange(this._editor.getSelections()[0]);
    }
    merge(template, options = $54ac6892e512fa7e$var$_defaultOptions) {
        if (!this._editor.hasModel()) return;
        this._templateMerges.push([
            this._snippets[0]._nestingLevel,
            this._snippets[0]._placeholderGroupsIdx,
            template
        ]);
        const { edits: edits, snippets: snippets } = $54ac6892e512fa7e$var$SnippetSession_1.createEditsAndSnippetsFromSelections(this._editor, template, options.overwriteBefore, options.overwriteAfter, true, options.adjustWhitespace, options.clipboardText, options.overtypingCapturer, this._languageConfigurationService);
        this._editor.executeEdits('snippet', edits, (_undoEdits)=>{
            // Sometimes, the text buffer will remove automatic whitespace when doing any edits,
            // so we need to look only at the undo edits relevant for us.
            // Our edits have an identifier set so that's how we can distinguish them
            const undoEdits = _undoEdits.filter((edit)=>!!edit.identifier);
            for(let idx = 0; idx < snippets.length; idx++)snippets[idx].initialize(undoEdits[idx].textChange);
            // Trivial snippets have no placeholder or are just the final placeholder. That means they
            // are just text insertions and we don't need to merge the nested snippet into the existing
            // snippet
            const isTrivialSnippet = snippets[0].isTrivialSnippet;
            if (!isTrivialSnippet) {
                for (const snippet of this._snippets)snippet.merge(snippets);
                console.assert(snippets.length === 0);
            }
            if (this._snippets[0].hasPlaceholder && !isTrivialSnippet) return this._move(undefined);
            else return undoEdits.map((edit)=>(0, $jzicX.Selection).fromPositions(edit.range.getEndPosition()));
        });
    }
    next() {
        const newSelections = this._move(true);
        this._editor.setSelections(newSelections);
        this._editor.revealPositionInCenterIfOutsideViewport(newSelections[0].getPosition());
    }
    prev() {
        const newSelections = this._move(false);
        this._editor.setSelections(newSelections);
        this._editor.revealPositionInCenterIfOutsideViewport(newSelections[0].getPosition());
    }
    _move(fwd) {
        const selections = [];
        for (const snippet of this._snippets){
            const oneSelection = snippet.move(fwd);
            selections.push(...oneSelection);
        }
        return selections;
    }
    get isAtFirstPlaceholder() {
        return this._snippets[0].isAtFirstPlaceholder;
    }
    get isAtLastPlaceholder() {
        return this._snippets[0].isAtLastPlaceholder;
    }
    get hasPlaceholder() {
        return this._snippets[0].hasPlaceholder;
    }
    get hasChoice() {
        return this._snippets[0].hasChoice;
    }
    get activeChoice() {
        return this._snippets[0].activeChoice;
    }
    isSelectionWithinPlaceholders() {
        if (!this.hasPlaceholder) return false;
        const selections = this._editor.getSelections();
        if (selections.length < this._snippets.length) // this means we started snippet mode with N
        // selections and have M (N > M) selections.
        // So one snippet is without selection -> cancel
        return false;
        const allPossibleSelections = new Map();
        for (const snippet of this._snippets){
            const possibleSelections = snippet.computePossibleSelections();
            // for the first snippet find the placeholder (and its ranges)
            // that contain at least one selection. for all remaining snippets
            // the same placeholder (and their ranges) must be used.
            if (allPossibleSelections.size === 0) for (const [index, ranges] of possibleSelections){
                ranges.sort((0, $d00il.Range).compareRangesUsingStarts);
                for (const selection of selections)if (ranges[0].containsRange(selection)) {
                    allPossibleSelections.set(index, []);
                    break;
                }
            }
            if (allPossibleSelections.size === 0) // return false if we couldn't associate a selection to
            // this (the first) snippet
            return false;
            // add selections from 'this' snippet so that we know all
            // selections for this placeholder
            allPossibleSelections.forEach((array, index)=>{
                array.push(...possibleSelections.get(index));
            });
        }
        // sort selections (and later placeholder-ranges). then walk both
        // arrays and make sure the placeholder-ranges contain the corresponding
        // selection
        selections.sort((0, $d00il.Range).compareRangesUsingStarts);
        for (const [index, ranges] of allPossibleSelections){
            if (ranges.length !== selections.length) {
                allPossibleSelections.delete(index);
                continue;
            }
            ranges.sort((0, $d00il.Range).compareRangesUsingStarts);
            for(let i = 0; i < ranges.length; i++)if (!ranges[i].containsRange(selections[i])) {
                allPossibleSelections.delete(index);
                continue;
            }
        }
        // from all possible selections we have deleted those
        // that don't match with the current selection. if we don't
        // have any left, we don't have a selection anymore
        return allPossibleSelections.size > 0;
    }
};
$54ac6892e512fa7e$export$d334bb6e0f563f7 = $54ac6892e512fa7e$var$SnippetSession_1 = $54ac6892e512fa7e$var$__decorate([
    $54ac6892e512fa7e$var$__param(3, (0, $1qkuR.ILanguageConfigurationService))
], $54ac6892e512fa7e$export$d334bb6e0f563f7);


var $3a01f53014eb6282$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $3a01f53014eb6282$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $3a01f53014eb6282$var$SnippetController2_1;
const $3a01f53014eb6282$var$_defaultOptions = {
    overwriteBefore: 0,
    overwriteAfter: 0,
    undoStopBefore: true,
    undoStopAfter: true,
    adjustWhitespace: true,
    clipboardText: undefined,
    overtypingCapturer: undefined
};
let $3a01f53014eb6282$export$d27b4f7e5ea418b0 = class SnippetController2 {
    static{
        $3a01f53014eb6282$var$SnippetController2_1 = this;
    }
    static{
        this.ID = 'snippetController2';
    }
    static get(editor) {
        return editor.getContribution($3a01f53014eb6282$var$SnippetController2_1.ID);
    }
    static{
        this.InSnippetMode = new (0, $cxCeF.RawContextKey)('inSnippetMode', false, (0, $4dEdH.localize)('inSnippetMode', "Whether the editor in current in snippet mode"));
    }
    static{
        this.HasNextTabstop = new (0, $cxCeF.RawContextKey)('hasNextTabstop', false, (0, $4dEdH.localize)('hasNextTabstop', "Whether there is a next tab stop when in snippet mode"));
    }
    static{
        this.HasPrevTabstop = new (0, $cxCeF.RawContextKey)('hasPrevTabstop', false, (0, $4dEdH.localize)('hasPrevTabstop', "Whether there is a previous tab stop when in snippet mode"));
    }
    constructor(_editor, _logService, _languageFeaturesService, contextKeyService, _languageConfigurationService){
        this._editor = _editor;
        this._logService = _logService;
        this._languageFeaturesService = _languageFeaturesService;
        this._languageConfigurationService = _languageConfigurationService;
        this._snippetListener = new (0, $9cWcn.DisposableStore)();
        this._modelVersionId = -1;
        this._inSnippet = $3a01f53014eb6282$var$SnippetController2_1.InSnippetMode.bindTo(contextKeyService);
        this._hasNextTabstop = $3a01f53014eb6282$var$SnippetController2_1.HasNextTabstop.bindTo(contextKeyService);
        this._hasPrevTabstop = $3a01f53014eb6282$var$SnippetController2_1.HasPrevTabstop.bindTo(contextKeyService);
    }
    dispose() {
        this._inSnippet.reset();
        this._hasPrevTabstop.reset();
        this._hasNextTabstop.reset();
        this._session?.dispose();
        this._snippetListener.dispose();
    }
    insert(template, opts) {
        // this is here to find out more about the yet-not-understood
        // error that sometimes happens when we fail to inserted a nested
        // snippet
        try {
            this._doInsert(template, typeof opts === 'undefined' ? $3a01f53014eb6282$var$_defaultOptions : {
                ...$3a01f53014eb6282$var$_defaultOptions,
                ...opts
            });
        } catch (e) {
            this.cancel();
            this._logService.error(e);
            this._logService.error('snippet_error');
            this._logService.error('insert_template=', template);
            this._logService.error('existing_template=', this._session ? this._session._logInfo() : '<no_session>');
        }
    }
    _doInsert(template, opts) {
        if (!this._editor.hasModel()) return;
        // don't listen while inserting the snippet
        // as that is the inflight state causing cancelation
        this._snippetListener.clear();
        if (opts.undoStopBefore) this._editor.getModel().pushStackElement();
        // don't merge
        if (this._session && typeof template !== 'string') this.cancel();
        if (!this._session) {
            this._modelVersionId = this._editor.getModel().getAlternativeVersionId();
            this._session = new (0, $54ac6892e512fa7e$export$d334bb6e0f563f7)(this._editor, template, opts, this._languageConfigurationService);
            this._session.insert();
        } else {
            (0, $bxBg7.assertType)(typeof template === 'string');
            this._session.merge(template, opts);
        }
        if (opts.undoStopAfter) this._editor.getModel().pushStackElement();
        // regster completion item provider when there is any choice element
        if (this._session?.hasChoice) {
            const provider = {
                _debugDisplayName: 'snippetChoiceCompletions',
                provideCompletionItems: (model, position)=>{
                    if (!this._session || model !== this._editor.getModel() || !(0, $dcxQ7.Position).equals(this._editor.getPosition(), position)) return undefined;
                    const { activeChoice: activeChoice } = this._session;
                    if (!activeChoice || activeChoice.choice.options.length === 0) return undefined;
                    const word = model.getValueInRange(activeChoice.range);
                    const isAnyOfOptions = Boolean(activeChoice.choice.options.find((o)=>o.value === word));
                    const suggestions = [];
                    for(let i = 0; i < activeChoice.choice.options.length; i++){
                        const option = activeChoice.choice.options[i];
                        suggestions.push({
                            kind: 13 /* CompletionItemKind.Value */ ,
                            label: option.value,
                            insertText: option.value,
                            sortText: 'a'.repeat(i + 1),
                            range: activeChoice.range,
                            filterText: isAnyOfOptions ? `${word}_${option.value}` : undefined,
                            command: {
                                id: 'jumpToNextSnippetPlaceholder',
                                title: (0, $4dEdH.localize)('next', 'Go to next placeholder...')
                            }
                        });
                    }
                    return {
                        suggestions: suggestions
                    };
                }
            };
            const model = this._editor.getModel();
            let registration;
            let isRegistered = false;
            const disable = ()=>{
                registration?.dispose();
                isRegistered = false;
            };
            const enable = ()=>{
                if (!isRegistered) {
                    registration = this._languageFeaturesService.completionProvider.register({
                        language: model.getLanguageId(),
                        pattern: model.uri.fsPath,
                        scheme: model.uri.scheme,
                        exclusive: true
                    }, provider);
                    this._snippetListener.add(registration);
                    isRegistered = true;
                }
            };
            this._choiceCompletions = {
                provider: provider,
                enable: enable,
                disable: disable
            };
        }
        this._updateState();
        this._snippetListener.add(this._editor.onDidChangeModelContent((e)=>e.isFlush && this.cancel()));
        this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel()));
        this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()));
    }
    _updateState() {
        if (!this._session || !this._editor.hasModel()) // canceled in the meanwhile
        return;
        if (this._modelVersionId === this._editor.getModel().getAlternativeVersionId()) // undo until the 'before' state happened
        // and makes use cancel snippet mode
        return this.cancel();
        if (!this._session.hasPlaceholder) // don't listen for selection changes and don't
        // update context keys when the snippet is plain text
        return this.cancel();
        if (this._session.isAtLastPlaceholder || !this._session.isSelectionWithinPlaceholders()) {
            this._editor.getModel().pushStackElement();
            return this.cancel();
        }
        this._inSnippet.set(true);
        this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder);
        this._hasNextTabstop.set(!this._session.isAtLastPlaceholder);
        this._handleChoice();
    }
    _handleChoice() {
        if (!this._session || !this._editor.hasModel()) {
            this._currentChoice = undefined;
            return;
        }
        const { activeChoice: activeChoice } = this._session;
        if (!activeChoice || !this._choiceCompletions) {
            this._choiceCompletions?.disable();
            this._currentChoice = undefined;
            return;
        }
        if (this._currentChoice !== activeChoice.choice) {
            this._currentChoice = activeChoice.choice;
            this._choiceCompletions.enable();
            // trigger suggest with the special choice completion provider
            queueMicrotask(()=>{
                (0, $46671b3f02f7e7cd$export$88d43510c0fc4cc4)(this._editor, this._choiceCompletions.provider);
            });
        }
    }
    finish() {
        while(this._inSnippet.get())this.next();
    }
    cancel(resetSelection = false) {
        this._inSnippet.reset();
        this._hasPrevTabstop.reset();
        this._hasNextTabstop.reset();
        this._snippetListener.clear();
        this._currentChoice = undefined;
        this._session?.dispose();
        this._session = undefined;
        this._modelVersionId = -1;
        if (resetSelection) // reset selection to the primary cursor when being asked
        // for. this happens when explicitly cancelling snippet mode,
        // e.g. when pressing ESC
        this._editor.setSelections([
            this._editor.getSelection()
        ]);
    }
    prev() {
        this._session?.prev();
        this._updateState();
    }
    next() {
        this._session?.next();
        this._updateState();
    }
    isInSnippet() {
        return Boolean(this._inSnippet.get());
    }
};
$3a01f53014eb6282$export$d27b4f7e5ea418b0 = $3a01f53014eb6282$var$SnippetController2_1 = $3a01f53014eb6282$var$__decorate([
    $3a01f53014eb6282$var$__param(1, (0, $dvEeB.ILogService)),
    $3a01f53014eb6282$var$__param(2, (0, $4J6fu.ILanguageFeaturesService)),
    $3a01f53014eb6282$var$__param(3, (0, $cxCeF.IContextKeyService)),
    $3a01f53014eb6282$var$__param(4, (0, $1qkuR.ILanguageConfigurationService))
], $3a01f53014eb6282$export$d27b4f7e5ea418b0);
(0, $2iJTi.registerEditorContribution)($3a01f53014eb6282$export$d27b4f7e5ea418b0.ID, $3a01f53014eb6282$export$d27b4f7e5ea418b0, 4 /* EditorContributionInstantiation.Lazy */ );
const $3a01f53014eb6282$var$CommandCtor = (0, $2iJTi.EditorCommand).bindToContribution($3a01f53014eb6282$export$d27b4f7e5ea418b0.get);
(0, $2iJTi.registerEditorCommand)(new $3a01f53014eb6282$var$CommandCtor({
    id: 'jumpToNextSnippetPlaceholder',
    precondition: (0, $cxCeF.ContextKeyExpr).and($3a01f53014eb6282$export$d27b4f7e5ea418b0.InSnippetMode, $3a01f53014eb6282$export$d27b4f7e5ea418b0.HasNextTabstop),
    handler: (ctrl)=>ctrl.next(),
    kbOpts: {
        weight: 130,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 2 /* KeyCode.Tab */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $3a01f53014eb6282$var$CommandCtor({
    id: 'jumpToPrevSnippetPlaceholder',
    precondition: (0, $cxCeF.ContextKeyExpr).and($3a01f53014eb6282$export$d27b4f7e5ea418b0.InSnippetMode, $3a01f53014eb6282$export$d27b4f7e5ea418b0.HasPrevTabstop),
    handler: (ctrl)=>ctrl.prev(),
    kbOpts: {
        weight: 130,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 1026 /* KeyCode.Tab */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $3a01f53014eb6282$var$CommandCtor({
    id: 'leaveSnippet',
    precondition: $3a01f53014eb6282$export$d27b4f7e5ea418b0.InSnippetMode,
    handler: (ctrl)=>ctrl.cancel(true),
    kbOpts: {
        weight: 130,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 9 /* KeyCode.Escape */ ,
        secondary: [
            1033 /* KeyCode.Escape */ 
        ]
    }
}));
(0, $2iJTi.registerEditorCommand)(new $3a01f53014eb6282$var$CommandCtor({
    id: 'acceptSnippet',
    precondition: $3a01f53014eb6282$export$d27b4f7e5ea418b0.InSnippetMode,
    handler: (ctrl)=>ctrl.finish()
}));



var $8tcMz = parcelRequire("8tcMz");

var $fdGPu = parcelRequire("fdGPu");
var $79602afdde57b712$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $79602afdde57b712$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $79602afdde57b712$export$5323521c789f2485 = class InlineCompletionsModel extends (0, $9cWcn.Disposable) {
    get isAcceptingPartially() {
        return this._isAcceptingPartially;
    }
    constructor(textModel, selectedSuggestItem, _textModelVersionId, _positions, _debounceValue, _suggestPreviewEnabled, _suggestPreviewMode, _inlineSuggestMode, _enabled, _instantiationService, _commandService, _languageConfigurationService){
        super();
        this.textModel = textModel;
        this.selectedSuggestItem = selectedSuggestItem;
        this._textModelVersionId = _textModelVersionId;
        this._positions = _positions;
        this._debounceValue = _debounceValue;
        this._suggestPreviewEnabled = _suggestPreviewEnabled;
        this._suggestPreviewMode = _suggestPreviewMode;
        this._inlineSuggestMode = _inlineSuggestMode;
        this._enabled = _enabled;
        this._instantiationService = _instantiationService;
        this._commandService = _commandService;
        this._languageConfigurationService = _languageConfigurationService;
        this._source = this._register(this._instantiationService.createInstance((0, $810fca5866eccfec$export$7bd92176df4e9460), this.textModel, this._textModelVersionId, this._debounceValue));
        this._isActive = (0, $4fzqs.observableValue)(this, false);
        this._forceUpdateExplicitlySignal = (0, $4fzqs.observableSignal)(this);
        // We use a semantic id to keep the same inline completion selected even if the provider reorders the completions.
        this._selectedInlineCompletionId = (0, $4fzqs.observableValue)(this, undefined);
        this._primaryPosition = (0, $4fzqs.derived)(this, (reader)=>this._positions.read(reader)[0] ?? new (0, $dcxQ7.Position)(1, 1));
        this._isAcceptingPartially = false;
        this._preserveCurrentCompletionReasons = new Set([
            $79602afdde57b712$export$5f9c9ebc7e8c28bc.Redo,
            $79602afdde57b712$export$5f9c9ebc7e8c28bc.Undo,
            $79602afdde57b712$export$5f9c9ebc7e8c28bc.AcceptWord
        ]);
        this._fetchInlineCompletionsPromise = (0, $4fzqs.derivedHandleChanges)({
            owner: this,
            createEmptyChangeSummary: ()=>({
                    preserveCurrentCompletion: false,
                    inlineCompletionTriggerKind: (0, $kzNQX.InlineCompletionTriggerKind).Automatic
                }),
            handleChange: (ctx, changeSummary)=>{
                /** @description fetch inline completions */ if (ctx.didChange(this._textModelVersionId) && this._preserveCurrentCompletionReasons.has(this._getReason(ctx.change))) changeSummary.preserveCurrentCompletion = true;
                else if (ctx.didChange(this._forceUpdateExplicitlySignal)) changeSummary.inlineCompletionTriggerKind = (0, $kzNQX.InlineCompletionTriggerKind).Explicit;
                return true;
            }
        }, (reader, changeSummary)=>{
            this._forceUpdateExplicitlySignal.read(reader);
            const shouldUpdate = this._enabled.read(reader) && this.selectedSuggestItem.read(reader) || this._isActive.read(reader);
            if (!shouldUpdate) {
                this._source.cancelUpdate();
                return undefined;
            }
            this._textModelVersionId.read(reader); // Refetch on text change
            const suggestWidgetInlineCompletions = this._source.suggestWidgetInlineCompletions.get();
            const suggestItem = this.selectedSuggestItem.read(reader);
            if (suggestWidgetInlineCompletions && !suggestItem) {
                const inlineCompletions = this._source.inlineCompletions.get();
                (0, $4fzqs.transaction)((tx)=>{
                    /** @description Seed inline completions with (newer) suggest widget inline completions */ if (!inlineCompletions || suggestWidgetInlineCompletions.request.versionId > inlineCompletions.request.versionId) this._source.inlineCompletions.set(suggestWidgetInlineCompletions.clone(), tx);
                    this._source.clearSuggestWidgetInlineCompletions(tx);
                });
            }
            const cursorPosition = this._primaryPosition.read(reader);
            const context = {
                triggerKind: changeSummary.inlineCompletionTriggerKind,
                selectedSuggestionInfo: suggestItem?.toSelectedSuggestionInfo()
            };
            const itemToPreserveCandidate = this.selectedInlineCompletion.get();
            const itemToPreserve = changeSummary.preserveCurrentCompletion || itemToPreserveCandidate?.forwardStable ? itemToPreserveCandidate : undefined;
            return this._source.fetch(cursorPosition, context, itemToPreserve);
        });
        this._filteredInlineCompletionItems = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $a0vti.itemsEquals)()
        }, (reader)=>{
            const c = this._source.inlineCompletions.read(reader);
            if (!c) return [];
            const cursorPosition = this._primaryPosition.read(reader);
            const filteredCompletions = c.inlineCompletions.filter((c)=>c.isVisible(this.textModel, cursorPosition, reader));
            return filteredCompletions;
        });
        this.selectedInlineCompletionIndex = (0, $4fzqs.derived)(this, (reader)=>{
            const selectedInlineCompletionId = this._selectedInlineCompletionId.read(reader);
            const filteredCompletions = this._filteredInlineCompletionItems.read(reader);
            const idx = this._selectedInlineCompletionId === undefined ? -1 : filteredCompletions.findIndex((v)=>v.semanticId === selectedInlineCompletionId);
            if (idx === -1) {
                // Reset the selection so that the selection does not jump back when it appears again
                this._selectedInlineCompletionId.set(undefined, undefined);
                return 0;
            }
            return idx;
        });
        this.selectedInlineCompletion = (0, $4fzqs.derived)(this, (reader)=>{
            const filteredCompletions = this._filteredInlineCompletionItems.read(reader);
            const idx = this.selectedInlineCompletionIndex.read(reader);
            return filteredCompletions[idx];
        });
        this.activeCommands = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $a0vti.itemsEquals)()
        }, (r)=>this.selectedInlineCompletion.read(r)?.inlineCompletion.source.inlineCompletions.commands ?? []);
        this.lastTriggerKind = this._source.inlineCompletions.map(this, (v)=>v?.request.context.triggerKind);
        this.inlineCompletionsCount = (0, $4fzqs.derived)(this, (reader)=>{
            if (this.lastTriggerKind.read(reader) === (0, $kzNQX.InlineCompletionTriggerKind).Explicit) return this._filteredInlineCompletionItems.read(reader).length;
            else return undefined;
        });
        this.state = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (a, b)=>{
                if (!a || !b) return a === b;
                return (0, $3d1b516e94b9053f$export$ed40ee230145e7ab)(a.ghostTexts, b.ghostTexts) && a.inlineCompletion === b.inlineCompletion && a.suggestItem === b.suggestItem;
            }
        }, (reader)=>{
            const model = this.textModel;
            const suggestItem = this.selectedSuggestItem.read(reader);
            if (suggestItem) {
                const suggestCompletionEdit = (0, $d2b11f15de3b89fe$export$1204549eb57cd077)(suggestItem.toSingleTextEdit(), model);
                const augmentation = this._computeAugmentation(suggestCompletionEdit, reader);
                const isSuggestionPreviewEnabled = this._suggestPreviewEnabled.read(reader);
                if (!isSuggestionPreviewEnabled && !augmentation) return undefined;
                const fullEdit = augmentation?.edit ?? suggestCompletionEdit;
                const fullEditPreviewLength = augmentation ? augmentation.edit.text.length - suggestCompletionEdit.text.length : 0;
                const mode = this._suggestPreviewMode.read(reader);
                const positions = this._positions.read(reader);
                const edits = [
                    fullEdit,
                    ...$79602afdde57b712$export$7a155c84a9c9ce7f(this.textModel, positions, fullEdit)
                ];
                const ghostTexts = edits.map((edit, idx)=>(0, $d2b11f15de3b89fe$export$2f8a3ebbe6972b3e)(edit, model, mode, positions[idx], fullEditPreviewLength)).filter((0, $bxBg7.isDefined));
                const primaryGhostText = ghostTexts[0] ?? new (0, $3d1b516e94b9053f$export$9415a6e27591b584)(fullEdit.range.endLineNumber, []);
                return {
                    edits: edits,
                    primaryGhostText: primaryGhostText,
                    ghostTexts: ghostTexts,
                    inlineCompletion: augmentation?.completion,
                    suggestItem: suggestItem
                };
            } else {
                if (!this._isActive.read(reader)) return undefined;
                const inlineCompletion = this.selectedInlineCompletion.read(reader);
                if (!inlineCompletion) return undefined;
                const replacement = inlineCompletion.toSingleTextEdit(reader);
                const mode = this._inlineSuggestMode.read(reader);
                const positions = this._positions.read(reader);
                const edits = [
                    replacement,
                    ...$79602afdde57b712$export$7a155c84a9c9ce7f(this.textModel, positions, replacement)
                ];
                const ghostTexts = edits.map((edit, idx)=>(0, $d2b11f15de3b89fe$export$2f8a3ebbe6972b3e)(edit, model, mode, positions[idx], 0)).filter((0, $bxBg7.isDefined));
                if (!ghostTexts[0]) return undefined;
                return {
                    edits: edits,
                    primaryGhostText: ghostTexts[0],
                    ghostTexts: ghostTexts,
                    inlineCompletion: inlineCompletion,
                    suggestItem: undefined
                };
            }
        });
        this.ghostTexts = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $3d1b516e94b9053f$export$ed40ee230145e7ab)
        }, (reader)=>{
            const v = this.state.read(reader);
            if (!v) return undefined;
            return v.ghostTexts;
        });
        this.primaryGhostText = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $3d1b516e94b9053f$export$12a6600d5ea8b253)
        }, (reader)=>{
            const v = this.state.read(reader);
            if (!v) return undefined;
            return v?.primaryGhostText;
        });
        this._register((0, $4fzqs.recomputeInitiallyAndOnChange)(this._fetchInlineCompletionsPromise));
        let lastItem = undefined;
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description call handleItemDidShow */ const item = this.state.read(reader);
            const completion = item?.inlineCompletion;
            if (completion?.semanticId !== lastItem?.semanticId) {
                lastItem = completion;
                if (completion) {
                    const i = completion.inlineCompletion;
                    const src = i.source;
                    src.provider.handleItemDidShow?.(src.inlineCompletions, i.sourceInlineCompletion, i.insertText);
                }
            }
        }));
    }
    _getReason(e) {
        if (e?.isUndoing) return $79602afdde57b712$export$5f9c9ebc7e8c28bc.Undo;
        if (e?.isRedoing) return $79602afdde57b712$export$5f9c9ebc7e8c28bc.Redo;
        if (this.isAcceptingPartially) return $79602afdde57b712$export$5f9c9ebc7e8c28bc.AcceptWord;
        return $79602afdde57b712$export$5f9c9ebc7e8c28bc.Other;
    }
    async trigger(tx) {
        this._isActive.set(true, tx);
        await this._fetchInlineCompletionsPromise.get();
    }
    async triggerExplicitly(tx) {
        (0, $4fzqs.subtransaction)(tx, (tx)=>{
            this._isActive.set(true, tx);
            this._forceUpdateExplicitlySignal.trigger(tx);
        });
        await this._fetchInlineCompletionsPromise.get();
    }
    stop(tx) {
        (0, $4fzqs.subtransaction)(tx, (tx)=>{
            this._isActive.set(false, tx);
            this._source.clear(tx);
        });
    }
    _computeAugmentation(suggestCompletion, reader) {
        const model = this.textModel;
        const suggestWidgetInlineCompletions = this._source.suggestWidgetInlineCompletions.read(reader);
        const candidateInlineCompletions = suggestWidgetInlineCompletions ? suggestWidgetInlineCompletions.inlineCompletions : [
            this.selectedInlineCompletion.read(reader)
        ].filter((0, $bxBg7.isDefined));
        const augmentedCompletion = (0, $7ysJc.mapFindFirst)(candidateInlineCompletions, (completion)=>{
            let r = completion.toSingleTextEdit(reader);
            r = (0, $d2b11f15de3b89fe$export$1204549eb57cd077)(r, model, (0, $d00il.Range).fromPositions(r.range.getStartPosition(), suggestCompletion.range.getEndPosition()));
            return (0, $d2b11f15de3b89fe$export$95e36a39a8b20bae)(r, suggestCompletion) ? {
                completion: completion,
                edit: r
            } : undefined;
        });
        return augmentedCompletion;
    }
    async _deltaSelectedInlineCompletionIndex(delta) {
        await this.triggerExplicitly();
        const completions = this._filteredInlineCompletionItems.get() || [];
        if (completions.length > 0) {
            const newIdx = (this.selectedInlineCompletionIndex.get() + delta + completions.length) % completions.length;
            this._selectedInlineCompletionId.set(completions[newIdx].semanticId, undefined);
        } else this._selectedInlineCompletionId.set(undefined, undefined);
    }
    async next() {
        await this._deltaSelectedInlineCompletionIndex(1);
    }
    async previous() {
        await this._deltaSelectedInlineCompletionIndex(-1);
    }
    async accept(editor) {
        if (editor.getModel() !== this.textModel) throw new (0, $gPkHZ.BugIndicatingError)();
        const state = this.state.get();
        if (!state || state.primaryGhostText.isEmpty() || !state.inlineCompletion) return;
        const completion = state.inlineCompletion.toInlineCompletion(undefined);
        if (completion.command) // Make sure the completion list will not be disposed.
        completion.source.addRef();
        editor.pushUndoStop();
        if (completion.snippetInfo) {
            editor.executeEdits('inlineSuggestion.accept', [
                (0, $kHJv6.EditOperation).replace(completion.range, ''),
                ...completion.additionalTextEdits
            ]);
            editor.setPosition(completion.snippetInfo.range.getStartPosition(), 'inlineCompletionAccept');
            (0, $3a01f53014eb6282$export$d27b4f7e5ea418b0).get(editor)?.insert(completion.snippetInfo.snippet, {
                undoStopBefore: false
            });
        } else {
            const edits = state.edits;
            const selections = $79602afdde57b712$var$getEndPositionsAfterApplying(edits).map((p)=>(0, $jzicX.Selection).fromPositions(p));
            editor.executeEdits('inlineSuggestion.accept', [
                ...edits.map((edit)=>(0, $kHJv6.EditOperation).replace(edit.range, edit.text)),
                ...completion.additionalTextEdits
            ]);
            editor.setSelections(selections, 'inlineCompletionAccept');
        }
        // Reset before invoking the command, as the command might cause a follow up trigger (which we don't want to reset).
        this.stop();
        if (completion.command) {
            await this._commandService.executeCommand(completion.command.id, ...completion.command.arguments || []).then(undefined, (0, $gPkHZ.onUnexpectedExternalError));
            completion.source.removeRef();
        }
    }
    async acceptNextWord(editor) {
        await this._acceptNext(editor, (pos, text)=>{
            const langId = this.textModel.getLanguageIdAtPosition(pos.lineNumber, pos.column);
            const config = this._languageConfigurationService.getLanguageConfiguration(langId);
            const wordRegExp = new RegExp(config.wordDefinition.source, config.wordDefinition.flags.replace('g', ''));
            const m1 = text.match(wordRegExp);
            let acceptUntilIndexExclusive = 0;
            if (m1 && m1.index !== undefined) {
                if (m1.index === 0) acceptUntilIndexExclusive = m1[0].length;
                else acceptUntilIndexExclusive = m1.index;
            } else acceptUntilIndexExclusive = text.length;
            const wsRegExp = /\s+/g;
            const m2 = wsRegExp.exec(text);
            if (m2 && m2.index !== undefined) {
                if (m2.index + m2[0].length < acceptUntilIndexExclusive) acceptUntilIndexExclusive = m2.index + m2[0].length;
            }
            return acceptUntilIndexExclusive;
        }, 0 /* PartialAcceptTriggerKind.Word */ );
    }
    async acceptNextLine(editor) {
        await this._acceptNext(editor, (pos, text)=>{
            const m = text.match(/\n/);
            if (m && m.index !== undefined) return m.index + 1;
            return text.length;
        }, 1 /* PartialAcceptTriggerKind.Line */ );
    }
    async _acceptNext(editor, getAcceptUntilIndex, kind) {
        if (editor.getModel() !== this.textModel) throw new (0, $gPkHZ.BugIndicatingError)();
        const state = this.state.get();
        if (!state || state.primaryGhostText.isEmpty() || !state.inlineCompletion) return;
        const ghostText = state.primaryGhostText;
        const completion = state.inlineCompletion.toInlineCompletion(undefined);
        if (completion.snippetInfo || completion.filterText !== completion.insertText) {
            // not in WYSIWYG mode, partial commit might change completion, thus it is not supported
            await this.accept(editor);
            return;
        }
        const firstPart = ghostText.parts[0];
        const ghostTextPos = new (0, $dcxQ7.Position)(ghostText.lineNumber, firstPart.column);
        const ghostTextVal = firstPart.text;
        const acceptUntilIndexExclusive = getAcceptUntilIndex(ghostTextPos, ghostTextVal);
        if (acceptUntilIndexExclusive === ghostTextVal.length && ghostText.parts.length === 1) {
            this.accept(editor);
            return;
        }
        const partialGhostTextVal = ghostTextVal.substring(0, acceptUntilIndexExclusive);
        const positions = this._positions.get();
        const cursorPosition = positions[0];
        // Executing the edit might free the completion, so we have to hold a reference on it.
        completion.source.addRef();
        try {
            this._isAcceptingPartially = true;
            try {
                editor.pushUndoStop();
                const replaceRange = (0, $d00il.Range).fromPositions(cursorPosition, ghostTextPos);
                const newText = editor.getModel().getValueInRange(replaceRange) + partialGhostTextVal;
                const primaryEdit = new (0, $13Zrd.SingleTextEdit)(replaceRange, newText);
                const edits = [
                    primaryEdit,
                    ...$79602afdde57b712$export$7a155c84a9c9ce7f(this.textModel, positions, primaryEdit)
                ];
                const selections = $79602afdde57b712$var$getEndPositionsAfterApplying(edits).map((p)=>(0, $jzicX.Selection).fromPositions(p));
                editor.executeEdits('inlineSuggestion.accept', edits.map((edit)=>(0, $kHJv6.EditOperation).replace(edit.range, edit.text)));
                editor.setSelections(selections, 'inlineCompletionPartialAccept');
                editor.revealPositionInCenterIfOutsideViewport(editor.getPosition(), 1 /* ScrollType.Immediate */ );
            } finally{
                this._isAcceptingPartially = false;
            }
            if (completion.source.provider.handlePartialAccept) {
                const acceptedRange = (0, $d00il.Range).fromPositions(completion.range.getStartPosition(), (0, $baQJ3.TextLength).ofText(partialGhostTextVal).addToPosition(ghostTextPos));
                // This assumes that the inline completion and the model use the same EOL style.
                const text = editor.getModel().getValueInRange(acceptedRange, 1 /* EndOfLinePreference.LF */ );
                completion.source.provider.handlePartialAccept(completion.source.inlineCompletions, completion.sourceInlineCompletion, text.length, {
                    kind: kind
                });
            }
        } finally{
            completion.source.removeRef();
        }
    }
    handleSuggestAccepted(item) {
        const itemEdit = (0, $d2b11f15de3b89fe$export$1204549eb57cd077)(item.toSingleTextEdit(), this.textModel);
        const augmentedCompletion = this._computeAugmentation(itemEdit, undefined);
        if (!augmentedCompletion) return;
        const inlineCompletion = augmentedCompletion.completion.inlineCompletion;
        inlineCompletion.source.provider.handlePartialAccept?.(inlineCompletion.source.inlineCompletions, inlineCompletion.sourceInlineCompletion, itemEdit.text.length, {
            kind: 2 /* PartialAcceptTriggerKind.Suggest */ 
        });
    }
};
$79602afdde57b712$export$5323521c789f2485 = $79602afdde57b712$var$__decorate([
    $79602afdde57b712$var$__param(9, (0, $fdGPu.IInstantiationService)),
    $79602afdde57b712$var$__param(10, (0, $8tcMz.ICommandService)),
    $79602afdde57b712$var$__param(11, (0, $1qkuR.ILanguageConfigurationService))
], $79602afdde57b712$export$5323521c789f2485);
var $79602afdde57b712$export$5f9c9ebc7e8c28bc;
(function(VersionIdChangeReason) {
    VersionIdChangeReason[VersionIdChangeReason["Undo"] = 0] = "Undo";
    VersionIdChangeReason[VersionIdChangeReason["Redo"] = 1] = "Redo";
    VersionIdChangeReason[VersionIdChangeReason["AcceptWord"] = 2] = "AcceptWord";
    VersionIdChangeReason[VersionIdChangeReason["Other"] = 3] = "Other";
})($79602afdde57b712$export$5f9c9ebc7e8c28bc || ($79602afdde57b712$export$5f9c9ebc7e8c28bc = {}));
function $79602afdde57b712$export$7a155c84a9c9ce7f(textModel, positions, primaryEdit) {
    if (positions.length === 1) // No secondary cursor positions
    return [];
    const primaryPosition = positions[0];
    const secondaryPositions = positions.slice(1);
    const primaryEditStartPosition = primaryEdit.range.getStartPosition();
    const primaryEditEndPosition = primaryEdit.range.getEndPosition();
    const replacedTextAfterPrimaryCursor = textModel.getValueInRange((0, $d00il.Range).fromPositions(primaryPosition, primaryEditEndPosition));
    const positionWithinTextEdit = (0, $5176a6fee772219a$export$f7a5d075cbdc3006)(primaryPosition, primaryEditStartPosition);
    if (positionWithinTextEdit.lineNumber < 1) {
        (0, $gPkHZ.onUnexpectedError)(new (0, $gPkHZ.BugIndicatingError)(`positionWithinTextEdit line number should be bigger than 0.
			Invalid subtraction between ${primaryPosition.toString()} and ${primaryEditStartPosition.toString()}`));
        return [];
    }
    const secondaryEditText = $79602afdde57b712$var$substringPos(primaryEdit.text, positionWithinTextEdit);
    return secondaryPositions.map((pos)=>{
        const posEnd = (0, $5176a6fee772219a$export$416cdac2a5b34419)((0, $5176a6fee772219a$export$f7a5d075cbdc3006)(pos, primaryEditStartPosition), primaryEditEndPosition);
        const textAfterSecondaryCursor = textModel.getValueInRange((0, $d00il.Range).fromPositions(pos, posEnd));
        const l = (0, $jcr1R.commonPrefixLength)(replacedTextAfterPrimaryCursor, textAfterSecondaryCursor);
        const range = (0, $d00il.Range).fromPositions(pos, pos.delta(0, l));
        return new (0, $13Zrd.SingleTextEdit)(range, secondaryEditText);
    });
}
function $79602afdde57b712$var$substringPos(text, pos) {
    let subtext = '';
    const lines = (0, $jcr1R.splitLinesIncludeSeparators)(text);
    for(let i = pos.lineNumber - 1; i < lines.length; i++)subtext += lines[i].substring(i === pos.lineNumber - 1 ? pos.column - 1 : 0);
    return subtext;
}
function $79602afdde57b712$var$getEndPositionsAfterApplying(edits) {
    const sortPerm = (0, $kJ8UG.Permutation).createSortPermutation(edits, (0, $kJ8UG.compareBy)((e)=>e.range, (0, $d00il.Range).compareRangesUsingStarts));
    const edit = new (0, $13Zrd.TextEdit)(sortPerm.apply(edits));
    const sortedNewRanges = edit.getNewRanges();
    const newRanges = sortPerm.inverse().apply(sortedNewRanges);
    return newRanges.map((range)=>range.getEndPosition());
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $7ysJc = parcelRequire("7ysJc");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $13Zrd = parcelRequire("13Zrd");

var $kzNQX = parcelRequire("kzNQX");



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $aIbUW = parcelRequire("aIbUW");

var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $cU88k = parcelRequire("cU88k");

var $9cWcn = parcelRequire("9cWcn");

var $lb0Ah = parcelRequire("lb0Ah");

var $eUQTM = parcelRequire("eUQTM");

var $bxBg7 = parcelRequire("bxBg7");

var $1RlHY = parcelRequire("1RlHY");

var $2iJTi = parcelRequire("2iJTi");

var $kHJv6 = parcelRequire("kHJv6");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $9cWcn = parcelRequire("9cWcn");

var $askDf = parcelRequire("askDf");

var $92fFm = parcelRequire("92fFm");

var $kzNQX = parcelRequire("kzNQX");

var $35IZ9 = parcelRequire("35IZ9");

var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

var $2AUoS = parcelRequire("2AUoS");
var $3137e0e4318e8557$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $3137e0e4318e8557$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $3137e0e4318e8557$var$SuggestMemoryService_1;
class $3137e0e4318e8557$export$29d4d7bc03c348a5 {
    constructor(name){
        this.name = name;
    }
    select(model, pos, items) {
        if (items.length === 0) return 0;
        const topScore = items[0].score[0];
        for(let i = 0; i < items.length; i++){
            const { score: score, completion: suggestion } = items[i];
            if (score[0] !== topScore) break;
            if (suggestion.preselect) // stop when seeing an auto-select-item
            return i;
        }
        return 0;
    }
}
class $3137e0e4318e8557$export$f425102ee8def711 extends $3137e0e4318e8557$export$29d4d7bc03c348a5 {
    constructor(){
        super('first');
    }
    memorize(model, pos, item) {
    // no-op
    }
    toJSON() {
        return undefined;
    }
    fromJSON() {
    //
    }
}
class $3137e0e4318e8557$export$ebb88911201cb1d1 extends $3137e0e4318e8557$export$29d4d7bc03c348a5 {
    constructor(){
        super('recentlyUsed');
        this._cache = new (0, $askDf.LRUCache)(300, 0.66);
        this._seq = 0;
    }
    memorize(model, pos, item) {
        const key = `${model.getLanguageId()}/${item.textLabel}`;
        this._cache.set(key, {
            touch: this._seq++,
            type: item.completion.kind,
            insertText: item.completion.insertText
        });
    }
    select(model, pos, items) {
        if (items.length === 0) return 0;
        const lineSuffix = model.getLineContent(pos.lineNumber).substr(pos.column - 10, pos.column - 1);
        if (/\s$/.test(lineSuffix)) return super.select(model, pos, items);
        const topScore = items[0].score[0];
        let indexPreselect = -1;
        let indexRecency = -1;
        let seq = -1;
        for(let i = 0; i < items.length; i++){
            if (items[i].score[0] !== topScore) break;
            const key = `${model.getLanguageId()}/${items[i].textLabel}`;
            const item = this._cache.peek(key);
            if (item && item.touch > seq && item.type === items[i].completion.kind && item.insertText === items[i].completion.insertText) {
                seq = item.touch;
                indexRecency = i;
            }
            if (items[i].completion.preselect && indexPreselect === -1) // stop when seeing an auto-select-item
            return indexPreselect = i;
        }
        if (indexRecency !== -1) return indexRecency;
        else if (indexPreselect !== -1) return indexPreselect;
        else return 0;
    }
    toJSON() {
        return this._cache.toJSON();
    }
    fromJSON(data) {
        this._cache.clear();
        const seq = 0;
        for (const [key, value] of data){
            value.touch = seq;
            value.type = typeof value.type === 'number' ? value.type : (0, $kzNQX.CompletionItemKinds).fromString(value.type);
            this._cache.set(key, value);
        }
        this._seq = this._cache.size;
    }
}
class $3137e0e4318e8557$export$9b0af8db2fb435e5 extends $3137e0e4318e8557$export$29d4d7bc03c348a5 {
    constructor(){
        super('recentlyUsedByPrefix');
        this._trie = (0, $92fFm.TernarySearchTree).forStrings();
        this._seq = 0;
    }
    memorize(model, pos, item) {
        const { word: word } = model.getWordUntilPosition(pos);
        const key = `${model.getLanguageId()}/${word}`;
        this._trie.set(key, {
            type: item.completion.kind,
            insertText: item.completion.insertText,
            touch: this._seq++
        });
    }
    select(model, pos, items) {
        const { word: word } = model.getWordUntilPosition(pos);
        if (!word) return super.select(model, pos, items);
        const key = `${model.getLanguageId()}/${word}`;
        let item = this._trie.get(key);
        if (!item) item = this._trie.findSubstr(key);
        if (item) for(let i = 0; i < items.length; i++){
            const { kind: kind, insertText: insertText } = items[i].completion;
            if (kind === item.type && insertText === item.insertText) return i;
        }
        return super.select(model, pos, items);
    }
    toJSON() {
        const entries = [];
        this._trie.forEach((value, key)=>entries.push([
                key,
                value
            ]));
        // sort by last recently used (touch), then
        // take the top 200 item and normalize their
        // touch
        entries.sort((a, b)=>-(a[1].touch - b[1].touch)).forEach((value, i)=>value[1].touch = i);
        return entries.slice(0, 200);
    }
    fromJSON(data) {
        this._trie.clear();
        if (data.length > 0) {
            this._seq = data[0][1].touch + 1;
            for (const [key, value] of data){
                value.type = typeof value.type === 'number' ? value.type : (0, $kzNQX.CompletionItemKinds).fromString(value.type);
                this._trie.set(key, value);
            }
        }
    }
}
let $3137e0e4318e8557$export$50aa987e170ccef7 = class SuggestMemoryService {
    static{
        $3137e0e4318e8557$var$SuggestMemoryService_1 = this;
    }
    static{
        this._strategyCtors = new Map([
            [
                'recentlyUsedByPrefix',
                $3137e0e4318e8557$export$9b0af8db2fb435e5
            ],
            [
                'recentlyUsed',
                $3137e0e4318e8557$export$ebb88911201cb1d1
            ],
            [
                'first',
                $3137e0e4318e8557$export$f425102ee8def711
            ]
        ]);
    }
    static{
        this._storagePrefix = 'suggest/memories';
    }
    constructor(_storageService, _configService){
        this._storageService = _storageService;
        this._configService = _configService;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._persistSoon = new (0, $6bXyA.RunOnceScheduler)(()=>this._saveState(), 500);
        this._disposables.add(_storageService.onWillSaveState((e)=>{
            if (e.reason === (0, $2AUoS.WillSaveStateReason).SHUTDOWN) this._saveState();
        }));
    }
    dispose() {
        this._disposables.dispose();
        this._persistSoon.dispose();
    }
    memorize(model, pos, item) {
        this._withStrategy(model, pos).memorize(model, pos, item);
        this._persistSoon.schedule();
    }
    select(model, pos, items) {
        return this._withStrategy(model, pos).select(model, pos, items);
    }
    _withStrategy(model, pos) {
        const mode = this._configService.getValue('editor.suggestSelection', {
            overrideIdentifier: model.getLanguageIdAtPosition(pos.lineNumber, pos.column),
            resource: model.uri
        });
        if (this._strategy?.name !== mode) {
            this._saveState();
            const ctor = $3137e0e4318e8557$var$SuggestMemoryService_1._strategyCtors.get(mode) || $3137e0e4318e8557$export$f425102ee8def711;
            this._strategy = new ctor();
            try {
                const share = this._configService.getValue('editor.suggest.shareSuggestSelections');
                const scope = share ? 0 /* StorageScope.PROFILE */  : 1 /* StorageScope.WORKSPACE */ ;
                const raw = this._storageService.get(`${$3137e0e4318e8557$var$SuggestMemoryService_1._storagePrefix}/${mode}`, scope);
                if (raw) this._strategy.fromJSON(JSON.parse(raw));
            } catch (e) {
            // things can go wrong with JSON...
            }
        }
        return this._strategy;
    }
    _saveState() {
        if (this._strategy) {
            const share = this._configService.getValue('editor.suggest.shareSuggestSelections');
            const scope = share ? 0 /* StorageScope.PROFILE */  : 1 /* StorageScope.WORKSPACE */ ;
            const raw = JSON.stringify(this._strategy);
            this._storageService.store(`${$3137e0e4318e8557$var$SuggestMemoryService_1._storagePrefix}/${this._strategy.name}`, raw, scope, 1 /* StorageTarget.MACHINE */ );
        }
    }
};
$3137e0e4318e8557$export$50aa987e170ccef7 = $3137e0e4318e8557$var$SuggestMemoryService_1 = $3137e0e4318e8557$var$__decorate([
    $3137e0e4318e8557$var$__param(0, (0, $2AUoS.IStorageService)),
    $3137e0e4318e8557$var$__param(1, (0, $35IZ9.IConfigurationService))
], $3137e0e4318e8557$export$50aa987e170ccef7);
const $3137e0e4318e8557$export$d66aa79ce7d9c867 = (0, $fdGPu.createDecorator)('ISuggestMemories');
(0, $lf2vF.registerSingleton)($3137e0e4318e8557$export$d66aa79ce7d9c867, $3137e0e4318e8557$export$50aa987e170ccef7, 1 /* InstantiationType.Delayed */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $cxCeF = parcelRequire("cxCeF");
var $a4dbe5e677ee3b54$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $a4dbe5e677ee3b54$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $a4dbe5e677ee3b54$var$WordContextKey_1;
let $a4dbe5e677ee3b54$export$f4d1b9d63b237092 = class WordContextKey {
    static{
        $a4dbe5e677ee3b54$var$WordContextKey_1 = this;
    }
    static{
        this.AtEnd = new (0, $cxCeF.RawContextKey)('atEndOfWord', false);
    }
    constructor(_editor, contextKeyService){
        this._editor = _editor;
        this._enabled = false;
        this._ckAtEnd = $a4dbe5e677ee3b54$var$WordContextKey_1.AtEnd.bindTo(contextKeyService);
        this._configListener = this._editor.onDidChangeConfiguration((e)=>e.hasChanged(124 /* EditorOption.tabCompletion */ ) && this._update());
        this._update();
    }
    dispose() {
        this._configListener.dispose();
        this._selectionListener?.dispose();
        this._ckAtEnd.reset();
    }
    _update() {
        // only update this when tab completions are enabled
        const enabled = this._editor.getOption(124 /* EditorOption.tabCompletion */ ) === 'on';
        if (this._enabled === enabled) return;
        this._enabled = enabled;
        if (this._enabled) {
            const checkForWordEnd = ()=>{
                if (!this._editor.hasModel()) {
                    this._ckAtEnd.set(false);
                    return;
                }
                const model = this._editor.getModel();
                const selection = this._editor.getSelection();
                const word = model.getWordAtPosition(selection.getStartPosition());
                if (!word) {
                    this._ckAtEnd.set(false);
                    return;
                }
                this._ckAtEnd.set(word.endColumn === selection.getStartPosition().column);
            };
            this._selectionListener = this._editor.onDidChangeCursorSelection(checkForWordEnd);
            checkForWordEnd();
        } else if (this._selectionListener) {
            this._ckAtEnd.reset();
            this._selectionListener.dispose();
            this._selectionListener = undefined;
        }
    }
};
$a4dbe5e677ee3b54$export$f4d1b9d63b237092 = $a4dbe5e677ee3b54$var$WordContextKey_1 = $a4dbe5e677ee3b54$var$__decorate([
    $a4dbe5e677ee3b54$var$__param(1, (0, $cxCeF.IContextKeyService))
], $a4dbe5e677ee3b54$export$f4d1b9d63b237092);



var $4dEdH = parcelRequire("4dEdH");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $dvEeB = parcelRequire("dvEeB");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $cxCeF = parcelRequire("cxCeF");
var $bb52a3f8a2ff4d4e$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $bb52a3f8a2ff4d4e$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $bb52a3f8a2ff4d4e$var$SuggestAlternatives_1;
let $bb52a3f8a2ff4d4e$export$26081dcda3428b4d = class SuggestAlternatives {
    static{
        $bb52a3f8a2ff4d4e$var$SuggestAlternatives_1 = this;
    }
    static{
        this.OtherSuggestions = new (0, $cxCeF.RawContextKey)('hasOtherSuggestions', false);
    }
    constructor(_editor, contextKeyService){
        this._editor = _editor;
        this._index = 0;
        this._ckOtherSuggestions = $bb52a3f8a2ff4d4e$var$SuggestAlternatives_1.OtherSuggestions.bindTo(contextKeyService);
    }
    dispose() {
        this.reset();
    }
    reset() {
        this._ckOtherSuggestions.reset();
        this._listener?.dispose();
        this._model = undefined;
        this._acceptNext = undefined;
        this._ignore = false;
    }
    set({ model: model, index: index }, acceptNext) {
        // no suggestions -> nothing to do
        if (model.items.length === 0) {
            this.reset();
            return;
        }
        // no alternative suggestions -> nothing to do
        const nextIndex = $bb52a3f8a2ff4d4e$var$SuggestAlternatives_1._moveIndex(true, model, index);
        if (nextIndex === index) {
            this.reset();
            return;
        }
        this._acceptNext = acceptNext;
        this._model = model;
        this._index = index;
        this._listener = this._editor.onDidChangeCursorPosition(()=>{
            if (!this._ignore) this.reset();
        });
        this._ckOtherSuggestions.set(true);
    }
    static _moveIndex(fwd, model, index) {
        let newIndex = index;
        for(let rounds = model.items.length; rounds > 0; rounds--){
            newIndex = (newIndex + model.items.length + (fwd ? 1 : -1)) % model.items.length;
            if (newIndex === index) break;
            if (!model.items[newIndex].completion.additionalTextEdits) break;
        }
        return newIndex;
    }
    next() {
        this._move(true);
    }
    prev() {
        this._move(false);
    }
    _move(fwd) {
        if (!this._model) // nothing to reason about
        return;
        try {
            this._ignore = true;
            this._index = $bb52a3f8a2ff4d4e$var$SuggestAlternatives_1._moveIndex(fwd, this._model, this._index);
            this._acceptNext({
                index: this._index,
                item: this._model.items[this._index],
                model: this._model
            });
        } finally{
            this._ignore = false;
        }
    }
};
$bb52a3f8a2ff4d4e$export$26081dcda3428b4d = $bb52a3f8a2ff4d4e$var$SuggestAlternatives_1 = $bb52a3f8a2ff4d4e$var$__decorate([
    $bb52a3f8a2ff4d4e$var$__param(1, (0, $cxCeF.IContextKeyService))
], $bb52a3f8a2ff4d4e$export$26081dcda3428b4d);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $9cWcn = parcelRequire("9cWcn");

var $kNeNo = parcelRequire("kNeNo");
class $b9fb9562f95d2dbc$export$1c5a4637a8cc1b47 {
    constructor(editor, widget, model, accept){
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._disposables.add(model.onDidSuggest((e)=>{
            if (e.completionModel.items.length === 0) this.reset();
        }));
        this._disposables.add(model.onDidCancel((e)=>{
            this.reset();
        }));
        this._disposables.add(widget.onDidShow(()=>this._onItem(widget.getFocusedItem())));
        this._disposables.add(widget.onDidFocus(this._onItem, this));
        this._disposables.add(widget.onDidHide(this.reset, this));
        this._disposables.add(editor.onWillType((text)=>{
            if (this._active && !widget.isFrozen() && model.state !== 0 /* State.Idle */ ) {
                const ch = text.charCodeAt(text.length - 1);
                if (this._active.acceptCharacters.has(ch) && editor.getOption(0 /* EditorOption.acceptSuggestionOnCommitCharacter */ )) accept(this._active.item);
            }
        }));
    }
    _onItem(selected) {
        if (!selected || !(0, $kJ8UG.isNonEmptyArray)(selected.item.completion.commitCharacters)) {
            // no item or no commit characters
            this.reset();
            return;
        }
        if (this._active && this._active.item.item === selected.item) // still the same item
        return;
        // keep item and its commit characters
        const acceptCharacters = new (0, $kNeNo.CharacterSet)();
        for (const ch of selected.item.completion.commitCharacters)if (ch.length > 0) acceptCharacters.add(ch.charCodeAt(0));
        this._active = {
            acceptCharacters: acceptCharacters,
            item: selected
        };
    }
    reset() {
        this._active = undefined;
    }
    dispose() {
        this._disposables.dispose();
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $jzicX = parcelRequire("jzicX");

var $zvLvK = parcelRequire("zvLvK");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $d00il = parcelRequire("d00il");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $76Edp = parcelRequire("76Edp");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");
class $f704c2158239256f$export$aa5c9041294ca4c8 {
    async provideSelectionRanges(model, positions) {
        const result = [];
        for (const position of positions){
            const bucket = [];
            result.push(bucket);
            const ranges = new Map();
            await new Promise((resolve)=>$f704c2158239256f$export$aa5c9041294ca4c8._bracketsRightYield(resolve, 0, model, position, ranges));
            await new Promise((resolve)=>$f704c2158239256f$export$aa5c9041294ca4c8._bracketsLeftYield(resolve, 0, model, position, ranges, bucket));
        }
        return result;
    }
    static{
        this._maxDuration = 30;
    }
    static{
        this._maxRounds = 2;
    }
    static _bracketsRightYield(resolve, round, model, pos, ranges) {
        const counts = new Map();
        const t1 = Date.now();
        while(true){
            if (round >= $f704c2158239256f$export$aa5c9041294ca4c8._maxRounds) {
                resolve();
                break;
            }
            if (!pos) {
                resolve();
                break;
            }
            const bracket = model.bracketPairs.findNextBracket(pos);
            if (!bracket) {
                resolve();
                break;
            }
            const d = Date.now() - t1;
            if (d > $f704c2158239256f$export$aa5c9041294ca4c8._maxDuration) {
                setTimeout(()=>$f704c2158239256f$export$aa5c9041294ca4c8._bracketsRightYield(resolve, round + 1, model, pos, ranges));
                break;
            }
            if (bracket.bracketInfo.isOpeningBracket) {
                const key = bracket.bracketInfo.bracketText;
                // wait for closing
                const val = counts.has(key) ? counts.get(key) : 0;
                counts.set(key, val + 1);
            } else {
                const key = bracket.bracketInfo.getOpeningBrackets()[0].bracketText;
                // process closing
                let val = counts.has(key) ? counts.get(key) : 0;
                val -= 1;
                counts.set(key, Math.max(0, val));
                if (val < 0) {
                    let list = ranges.get(key);
                    if (!list) {
                        list = new (0, $76Edp.LinkedList)();
                        ranges.set(key, list);
                    }
                    list.push(bracket.range);
                }
            }
            pos = bracket.range.getEndPosition();
        }
    }
    static _bracketsLeftYield(resolve, round, model, pos, ranges, bucket) {
        const counts = new Map();
        const t1 = Date.now();
        while(true){
            if (round >= $f704c2158239256f$export$aa5c9041294ca4c8._maxRounds && ranges.size === 0) {
                resolve();
                break;
            }
            if (!pos) {
                resolve();
                break;
            }
            const bracket = model.bracketPairs.findPrevBracket(pos);
            if (!bracket) {
                resolve();
                break;
            }
            const d = Date.now() - t1;
            if (d > $f704c2158239256f$export$aa5c9041294ca4c8._maxDuration) {
                setTimeout(()=>$f704c2158239256f$export$aa5c9041294ca4c8._bracketsLeftYield(resolve, round + 1, model, pos, ranges, bucket));
                break;
            }
            if (!bracket.bracketInfo.isOpeningBracket) {
                const key = bracket.bracketInfo.getOpeningBrackets()[0].bracketText;
                // wait for opening
                const val = counts.has(key) ? counts.get(key) : 0;
                counts.set(key, val + 1);
            } else {
                const key = bracket.bracketInfo.bracketText;
                // opening
                let val = counts.has(key) ? counts.get(key) : 0;
                val -= 1;
                counts.set(key, Math.max(0, val));
                if (val < 0) {
                    const list = ranges.get(key);
                    if (list) {
                        const closing = list.shift();
                        if (list.size === 0) ranges.delete(key);
                        const innerBracket = (0, $d00il.Range).fromPositions(bracket.range.getEndPosition(), closing.getStartPosition());
                        const outerBracket = (0, $d00il.Range).fromPositions(bracket.range.getStartPosition(), closing.getEndPosition());
                        bucket.push({
                            range: innerBracket
                        });
                        bucket.push({
                            range: outerBracket
                        });
                        $f704c2158239256f$export$aa5c9041294ca4c8._addBracketLeading(model, outerBracket, bucket);
                    }
                }
            }
            pos = bracket.range.getStartPosition();
        }
    }
    static _addBracketLeading(model, bracket, bucket) {
        if (bracket.startLineNumber === bracket.endLineNumber) return;
        // xxxxxxxx {
        //
        // }
        const startLine = bracket.startLineNumber;
        const column = model.getLineFirstNonWhitespaceColumn(startLine);
        if (column !== 0 && column !== bracket.startColumn) {
            bucket.push({
                range: (0, $d00il.Range).fromPositions(new (0, $dcxQ7.Position)(startLine, column), bracket.getEndPosition())
            });
            bucket.push({
                range: (0, $d00il.Range).fromPositions(new (0, $dcxQ7.Position)(startLine, 1), bracket.getEndPosition())
            });
        }
        // xxxxxxxx
        // {
        //
        // }
        const aboveLine = startLine - 1;
        if (aboveLine > 0) {
            const column = model.getLineFirstNonWhitespaceColumn(aboveLine);
            if (column === bracket.startColumn && column !== model.getLineLastNonWhitespaceColumn(aboveLine)) {
                bucket.push({
                    range: (0, $d00il.Range).fromPositions(new (0, $dcxQ7.Position)(aboveLine, column), bracket.getEndPosition())
                });
                bucket.push({
                    range: (0, $d00il.Range).fromPositions(new (0, $dcxQ7.Position)(aboveLine, 1), bracket.getEndPosition())
                });
            }
        }
    }
}


class $f0635859e8508238$export$620c7fa9f786bff6 {
    static{
        this.None = new class extends $f0635859e8508238$export$620c7fa9f786bff6 {
            distance() {
                return 0;
            }
        };
    }
    static async create(service, editor) {
        if (!editor.getOption(119 /* EditorOption.suggest */ ).localityBonus) return $f0635859e8508238$export$620c7fa9f786bff6.None;
        if (!editor.hasModel()) return $f0635859e8508238$export$620c7fa9f786bff6.None;
        const model = editor.getModel();
        const position = editor.getPosition();
        if (!service.canComputeWordRanges(model.uri)) return $f0635859e8508238$export$620c7fa9f786bff6.None;
        const [ranges] = await new (0, $f704c2158239256f$export$aa5c9041294ca4c8)().provideSelectionRanges(model, [
            position
        ]);
        if (ranges.length === 0) return $f0635859e8508238$export$620c7fa9f786bff6.None;
        const wordRanges = await service.computeWordRanges(model.uri, ranges[0].range);
        if (!wordRanges) return $f0635859e8508238$export$620c7fa9f786bff6.None;
        // remove current word
        const wordUntilPos = model.getWordUntilPosition(position);
        delete wordRanges[wordUntilPos.word];
        return new class extends $f0635859e8508238$export$620c7fa9f786bff6 {
            distance(anchor, item) {
                if (!position.equals(editor.getPosition())) return 0;
                if (item.kind === 17 /* CompletionItemKind.Keyword */ ) return 2097152;
                const word = typeof item.label === 'string' ? item.label : item.label.label;
                const wordLines = wordRanges[word];
                if ((0, $kJ8UG.isFalsyOrEmpty)(wordLines)) return 2097152;
                const idx = (0, $kJ8UG.binarySearch)(wordLines, (0, $d00il.Range).fromPositions(anchor), (0, $d00il.Range).compareRangesUsingStarts);
                const bestWordRange = idx >= 0 ? wordLines[idx] : wordLines[Math.max(0, ~idx - 1)];
                let blockDistance = ranges.length;
                for (const range of ranges){
                    if (!(0, $d00il.Range).containsRange(range.range, bestWordRange)) break;
                    blockDistance -= 1;
                }
                return blockDistance;
            }
        };
    }
}



var $8QSW4 = parcelRequire("8QSW4");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");

var $dvEeB = parcelRequire("dvEeB");

var $lMGba = parcelRequire("lMGba");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $lk06m = parcelRequire("lk06m");

var $jcr1R = parcelRequire("jcr1R");
class $ed4f2b2c2d18e4d1$export$894a84ea03928d60 {
    constructor(leadingLineContent, characterCountDelta){
        this.leadingLineContent = leadingLineContent;
        this.characterCountDelta = characterCountDelta;
    }
}
class $ed4f2b2c2d18e4d1$export$8420ec00c11e432f {
    constructor(items, column, lineContext, wordDistance, options, snippetSuggestions, fuzzyScoreOptions = (0, $lk06m.FuzzyScoreOptions).default, clipboardText){
        this.clipboardText = clipboardText;
        this._snippetCompareFn = $ed4f2b2c2d18e4d1$export$8420ec00c11e432f._compareCompletionItems;
        this._items = items;
        this._column = column;
        this._wordDistance = wordDistance;
        this._options = options;
        this._refilterKind = 1 /* Refilter.All */ ;
        this._lineContext = lineContext;
        this._fuzzyScoreOptions = fuzzyScoreOptions;
        if (snippetSuggestions === 'top') this._snippetCompareFn = $ed4f2b2c2d18e4d1$export$8420ec00c11e432f._compareCompletionItemsSnippetsUp;
        else if (snippetSuggestions === 'bottom') this._snippetCompareFn = $ed4f2b2c2d18e4d1$export$8420ec00c11e432f._compareCompletionItemsSnippetsDown;
    }
    get lineContext() {
        return this._lineContext;
    }
    set lineContext(value) {
        if (this._lineContext.leadingLineContent !== value.leadingLineContent || this._lineContext.characterCountDelta !== value.characterCountDelta) {
            this._refilterKind = this._lineContext.characterCountDelta < value.characterCountDelta && this._filteredItems ? 2 /* Refilter.Incr */  : 1 /* Refilter.All */ ;
            this._lineContext = value;
        }
    }
    get items() {
        this._ensureCachedState();
        return this._filteredItems;
    }
    getItemsByProvider() {
        this._ensureCachedState();
        return this._itemsByProvider;
    }
    getIncompleteProvider() {
        this._ensureCachedState();
        const result = new Set();
        for (const [provider, items] of this.getItemsByProvider())if (items.length > 0 && items[0].container.incomplete) result.add(provider);
        return result;
    }
    get stats() {
        this._ensureCachedState();
        return this._stats;
    }
    _ensureCachedState() {
        if (this._refilterKind !== 0 /* Refilter.Nothing */ ) this._createCachedState();
    }
    _createCachedState() {
        this._itemsByProvider = new Map();
        const labelLengths = [];
        const { leadingLineContent: leadingLineContent, characterCountDelta: characterCountDelta } = this._lineContext;
        let word = '';
        let wordLow = '';
        // incrementally filter less
        const source = this._refilterKind === 1 /* Refilter.All */  ? this._items : this._filteredItems;
        const target = [];
        // picks a score function based on the number of
        // items that we have to score/filter and based on the
        // user-configuration
        const scoreFn = !this._options.filterGraceful || source.length > 2000 ? (0, $lk06m.fuzzyScore) : (0, $lk06m.fuzzyScoreGracefulAggressive);
        for(let i = 0; i < source.length; i++){
            const item = source[i];
            if (item.isInvalid) continue; // SKIP invalid items
            // keep all items by their provider
            const arr = this._itemsByProvider.get(item.provider);
            if (arr) arr.push(item);
            else this._itemsByProvider.set(item.provider, [
                item
            ]);
            // 'word' is that remainder of the current line that we
            // filter and score against. In theory each suggestion uses a
            // different word, but in practice not - that's why we cache
            const overwriteBefore = item.position.column - item.editStart.column;
            const wordLen = overwriteBefore + characterCountDelta - (item.position.column - this._column);
            if (word.length !== wordLen) {
                word = wordLen === 0 ? '' : leadingLineContent.slice(-wordLen);
                wordLow = word.toLowerCase();
            }
            // remember the word against which this item was
            // scored
            item.word = word;
            if (wordLen === 0) // when there is nothing to score against, don't
            // event try to do. Use a const rank and rely on
            // the fallback-sort using the initial sort order.
            // use a score of `-100` because that is out of the
            // bound of values `fuzzyScore` will return
            item.score = (0, $lk06m.FuzzyScore).Default;
            else {
                // skip word characters that are whitespace until
                // we have hit the replace range (overwriteBefore)
                let wordPos = 0;
                while(wordPos < overwriteBefore){
                    const ch = word.charCodeAt(wordPos);
                    if (ch === 32 /* CharCode.Space */  || ch === 9 /* CharCode.Tab */ ) wordPos += 1;
                    else break;
                }
                if (wordPos >= wordLen) // the wordPos at which scoring starts is the whole word
                // and therefore the same rules as not having a word apply
                item.score = (0, $lk06m.FuzzyScore).Default;
                else if (typeof item.completion.filterText === 'string') {
                    // when there is a `filterText` it must match the `word`.
                    // if it matches we check with the label to compute highlights
                    // and if that doesn't yield a result we have no highlights,
                    // despite having the match
                    const match = scoreFn(word, wordLow, wordPos, item.completion.filterText, item.filterTextLow, 0, this._fuzzyScoreOptions);
                    if (!match) continue; // NO match
                    if ((0, $jcr1R.compareIgnoreCase)(item.completion.filterText, item.textLabel) === 0) // filterText and label are actually the same -> use good highlights
                    item.score = match;
                    else {
                        // re-run the scorer on the label in the hope of a result BUT use the rank
                        // of the filterText-match
                        item.score = (0, $lk06m.anyScore)(word, wordLow, wordPos, item.textLabel, item.labelLow, 0);
                        item.score[0] = match[0]; // use score from filterText
                    }
                } else {
                    // by default match `word` against the `label`
                    const match = scoreFn(word, wordLow, wordPos, item.textLabel, item.labelLow, 0, this._fuzzyScoreOptions);
                    if (!match) continue; // NO match
                    item.score = match;
                }
            }
            item.idx = i;
            item.distance = this._wordDistance.distance(item.position, item.completion);
            target.push(item);
            // update stats
            labelLengths.push(item.textLabel.length);
        }
        this._filteredItems = target.sort(this._snippetCompareFn);
        this._refilterKind = 0 /* Refilter.Nothing */ ;
        this._stats = {
            pLabelLen: labelLengths.length ? (0, $kJ8UG.quickSelect)(labelLengths.length - .85, labelLengths, (a, b)=>a - b) : 0
        };
    }
    static _compareCompletionItems(a, b) {
        if (a.score[0] > b.score[0]) return -1;
        else if (a.score[0] < b.score[0]) return 1;
        else if (a.distance < b.distance) return -1;
        else if (a.distance > b.distance) return 1;
        else if (a.idx < b.idx) return -1;
        else if (a.idx > b.idx) return 1;
        else return 0;
    }
    static _compareCompletionItemsSnippetsDown(a, b) {
        if (a.completion.kind !== b.completion.kind) {
            if (a.completion.kind === 27 /* CompletionItemKind.Snippet */ ) return 1;
            else if (b.completion.kind === 27 /* CompletionItemKind.Snippet */ ) return -1;
        }
        return $ed4f2b2c2d18e4d1$export$8420ec00c11e432f._compareCompletionItems(a, b);
    }
    static _compareCompletionItemsSnippetsUp(a, b) {
        if (a.completion.kind !== b.completion.kind) {
            if (a.completion.kind === 27 /* CompletionItemKind.Snippet */ ) return -1;
            else if (b.completion.kind === 27 /* CompletionItemKind.Snippet */ ) return 1;
        }
        return $ed4f2b2c2d18e4d1$export$8420ec00c11e432f._compareCompletionItems(a, b);
    }
}




var $4J6fu = parcelRequire("4J6fu");

var $lk06m = parcelRequire("lk06m");

var $bxBg7 = parcelRequire("bxBg7");



var $hPGxd = parcelRequire("hPGxd");
var $c647ef64fb80ec19$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c647ef64fb80ec19$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $c647ef64fb80ec19$var$SuggestModel_1;
class $c647ef64fb80ec19$export$894a84ea03928d60 {
    static shouldAutoTrigger(editor) {
        if (!editor.hasModel()) return false;
        const model = editor.getModel();
        const pos = editor.getPosition();
        model.tokenization.tokenizeIfCheap(pos.lineNumber);
        const word = model.getWordAtPosition(pos);
        if (!word) return false;
        if (word.endColumn !== pos.column && word.startColumn + 1 !== pos.column /* after typing a single character before a word */ ) return false;
        if (!isNaN(Number(word.word))) return false;
        return true;
    }
    constructor(model, position, triggerOptions){
        this.leadingLineContent = model.getLineContent(position.lineNumber).substr(0, position.column - 1);
        this.leadingWord = model.getWordUntilPosition(position);
        this.lineNumber = position.lineNumber;
        this.column = position.column;
        this.triggerOptions = triggerOptions;
    }
}
function $c647ef64fb80ec19$var$canShowQuickSuggest(editor, contextKeyService, configurationService) {
    if (!Boolean(contextKeyService.getContextKeyValue((0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible.key))) // Allow if there is no inline suggestion.
    return true;
    const suppressSuggestions = contextKeyService.getContextKeyValue((0, $fdd9e34afddebc6c$export$59492a7812ea15ae).suppressSuggestions.key);
    if (suppressSuggestions !== undefined) return !suppressSuggestions;
    return !editor.getOption(62 /* EditorOption.inlineSuggest */ ).suppressSuggestions;
}
function $c647ef64fb80ec19$var$canShowSuggestOnTriggerCharacters(editor, contextKeyService, configurationService) {
    if (!Boolean(contextKeyService.getContextKeyValue('inlineSuggestionVisible'))) // Allow if there is no inline suggestion.
    return true;
    const suppressSuggestions = contextKeyService.getContextKeyValue((0, $fdd9e34afddebc6c$export$59492a7812ea15ae).suppressSuggestions.key);
    if (suppressSuggestions !== undefined) return !suppressSuggestions;
    return !editor.getOption(62 /* EditorOption.inlineSuggest */ ).suppressSuggestions;
}
let $c647ef64fb80ec19$export$bd6d3a37695095d5 = $c647ef64fb80ec19$var$SuggestModel_1 = class SuggestModel {
    constructor(_editor, _editorWorkerService, _clipboardService, _telemetryService, _logService, _contextKeyService, _configurationService, _languageFeaturesService, _envService){
        this._editor = _editor;
        this._editorWorkerService = _editorWorkerService;
        this._clipboardService = _clipboardService;
        this._telemetryService = _telemetryService;
        this._logService = _logService;
        this._contextKeyService = _contextKeyService;
        this._configurationService = _configurationService;
        this._languageFeaturesService = _languageFeaturesService;
        this._envService = _envService;
        this._toDispose = new (0, $9cWcn.DisposableStore)();
        this._triggerCharacterListener = new (0, $9cWcn.DisposableStore)();
        this._triggerQuickSuggest = new (0, $6bXyA.TimeoutTimer)();
        this._triggerState = undefined;
        this._completionDisposables = new (0, $9cWcn.DisposableStore)();
        this._onDidCancel = new (0, $5YaSO.Emitter)();
        this._onDidTrigger = new (0, $5YaSO.Emitter)();
        this._onDidSuggest = new (0, $5YaSO.Emitter)();
        this.onDidCancel = this._onDidCancel.event;
        this.onDidTrigger = this._onDidTrigger.event;
        this.onDidSuggest = this._onDidSuggest.event;
        this._telemetryGate = 0;
        this._currentSelection = this._editor.getSelection() || new (0, $jzicX.Selection)(1, 1, 1, 1);
        // wire up various listeners
        this._toDispose.add(this._editor.onDidChangeModel(()=>{
            this._updateTriggerCharacters();
            this.cancel();
        }));
        this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{
            this._updateTriggerCharacters();
            this.cancel();
        }));
        this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{
            this._updateTriggerCharacters();
        }));
        this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{
            this._updateTriggerCharacters();
            this._updateActiveSuggestSession();
        }));
        let editorIsComposing = false;
        this._toDispose.add(this._editor.onDidCompositionStart(()=>{
            editorIsComposing = true;
        }));
        this._toDispose.add(this._editor.onDidCompositionEnd(()=>{
            editorIsComposing = false;
            this._onCompositionEnd();
        }));
        this._toDispose.add(this._editor.onDidChangeCursorSelection((e)=>{
            // only trigger suggest when the editor isn't composing a character
            if (!editorIsComposing) this._onCursorChange(e);
        }));
        this._toDispose.add(this._editor.onDidChangeModelContent(()=>{
            // only filter completions when the editor isn't composing a character
            // allow-any-unicode-next-line
            // e.g. ¨ + u makes ü but just ¨ cannot be used for filtering
            if (!editorIsComposing && this._triggerState !== undefined) this._refilterCompletionItems();
        }));
        this._updateTriggerCharacters();
    }
    dispose() {
        (0, $9cWcn.dispose)(this._triggerCharacterListener);
        (0, $9cWcn.dispose)([
            this._onDidCancel,
            this._onDidSuggest,
            this._onDidTrigger,
            this._triggerQuickSuggest
        ]);
        this._toDispose.dispose();
        this._completionDisposables.dispose();
        this.cancel();
    }
    _updateTriggerCharacters() {
        this._triggerCharacterListener.clear();
        if (this._editor.getOption(92 /* EditorOption.readOnly */ ) || !this._editor.hasModel() || !this._editor.getOption(122 /* EditorOption.suggestOnTriggerCharacters */ )) return;
        const supportsByTriggerCharacter = new Map();
        for (const support of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for (const ch of support.triggerCharacters || []){
            let set = supportsByTriggerCharacter.get(ch);
            if (!set) {
                set = new Set();
                const suggestSupport = (0, $46671b3f02f7e7cd$export$72a35c372a05fbe1)();
                if (suggestSupport) set.add(suggestSupport);
                supportsByTriggerCharacter.set(ch, set);
            }
            set.add(support);
        }
        const checkTriggerCharacter = (text)=>{
            if (!$c647ef64fb80ec19$var$canShowSuggestOnTriggerCharacters(this._editor, this._contextKeyService, this._configurationService)) return;
            if ($c647ef64fb80ec19$export$894a84ea03928d60.shouldAutoTrigger(this._editor)) // don't trigger by trigger characters when this is a case for quick suggest
            return;
            if (!text) {
                // came here from the compositionEnd-event
                const position = this._editor.getPosition();
                const model = this._editor.getModel();
                text = model.getLineContent(position.lineNumber).substr(0, position.column - 1);
            }
            let lastChar = '';
            if ((0, $jcr1R.isLowSurrogate)(text.charCodeAt(text.length - 1))) {
                if ((0, $jcr1R.isHighSurrogate)(text.charCodeAt(text.length - 2))) lastChar = text.substr(text.length - 2);
            } else lastChar = text.charAt(text.length - 1);
            const supports = supportsByTriggerCharacter.get(lastChar);
            if (supports) {
                // keep existing items that where not computed by the
                // supports/providers that want to trigger now
                const providerItemsToReuse = new Map();
                if (this._completionModel) {
                    for (const [provider, items] of this._completionModel.getItemsByProvider())if (!supports.has(provider)) providerItemsToReuse.set(provider, items);
                }
                this.trigger({
                    auto: true,
                    triggerKind: 1 /* CompletionTriggerKind.TriggerCharacter */ ,
                    triggerCharacter: lastChar,
                    retrigger: Boolean(this._completionModel),
                    clipboardText: this._completionModel?.clipboardText,
                    completionOptions: {
                        providerFilter: supports,
                        providerItemsToReuse: providerItemsToReuse
                    }
                });
            }
        };
        this._triggerCharacterListener.add(this._editor.onDidType(checkTriggerCharacter));
        this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>checkTriggerCharacter()));
    }
    // --- trigger/retrigger/cancel suggest
    get state() {
        if (!this._triggerState) return 0 /* State.Idle */ ;
        else if (!this._triggerState.auto) return 1 /* State.Manual */ ;
        else return 2 /* State.Auto */ ;
    }
    cancel(retrigger = false) {
        if (this._triggerState !== undefined) {
            this._triggerQuickSuggest.cancel();
            this._requestToken?.cancel();
            this._requestToken = undefined;
            this._triggerState = undefined;
            this._completionModel = undefined;
            this._context = undefined;
            this._onDidCancel.fire({
                retrigger: retrigger
            });
        }
    }
    clear() {
        this._completionDisposables.clear();
    }
    _updateActiveSuggestSession() {
        if (this._triggerState !== undefined) {
            if (!this._editor.hasModel() || !this._languageFeaturesService.completionProvider.has(this._editor.getModel())) this.cancel();
            else this.trigger({
                auto: this._triggerState.auto,
                retrigger: true
            });
        }
    }
    _onCursorChange(e) {
        if (!this._editor.hasModel()) return;
        const prevSelection = this._currentSelection;
        this._currentSelection = this._editor.getSelection();
        if (!e.selection.isEmpty() || e.reason !== 0 /* CursorChangeReason.NotSet */  && e.reason !== 3 /* CursorChangeReason.Explicit */  || e.source !== 'keyboard' && e.source !== 'deleteLeft') {
            // Early exit if nothing needs to be done!
            // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)
            this.cancel();
            return;
        }
        if (this._triggerState === undefined && e.reason === 0 /* CursorChangeReason.NotSet */ ) {
            if (prevSelection.containsRange(this._currentSelection) || prevSelection.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition())) // cursor did move RIGHT due to typing -> trigger quick suggest
            this._doTriggerQuickSuggest();
        } else if (this._triggerState !== undefined && e.reason === 3 /* CursorChangeReason.Explicit */ ) // suggest is active and something like cursor keys are used to move
        // the cursor. this means we can refilter at the new position
        this._refilterCompletionItems();
    }
    _onCompositionEnd() {
        // trigger or refilter when composition ends
        if (this._triggerState === undefined) this._doTriggerQuickSuggest();
        else this._refilterCompletionItems();
    }
    _doTriggerQuickSuggest() {
        if ((0, $46671b3f02f7e7cd$export$8cddbe8aa50feac1).isAllOff(this._editor.getOption(90 /* EditorOption.quickSuggestions */ ))) // not enabled
        return;
        if (this._editor.getOption(119 /* EditorOption.suggest */ ).snippetsPreventQuickSuggestions && (0, $3a01f53014eb6282$export$d27b4f7e5ea418b0).get(this._editor)?.isInSnippet()) // no quick suggestion when in snippet mode
        return;
        this.cancel();
        this._triggerQuickSuggest.cancelAndSet(()=>{
            if (this._triggerState !== undefined) return;
            if (!$c647ef64fb80ec19$export$894a84ea03928d60.shouldAutoTrigger(this._editor)) return;
            if (!this._editor.hasModel() || !this._editor.hasWidgetFocus()) return;
            const model = this._editor.getModel();
            const pos = this._editor.getPosition();
            // validate enabled now
            const config = this._editor.getOption(90 /* EditorOption.quickSuggestions */ );
            if ((0, $46671b3f02f7e7cd$export$8cddbe8aa50feac1).isAllOff(config)) return;
            if (!(0, $46671b3f02f7e7cd$export$8cddbe8aa50feac1).isAllOn(config)) {
                // Check the type of the token that triggered this
                model.tokenization.tokenizeIfCheap(pos.lineNumber);
                const lineTokens = model.tokenization.getLineTokens(pos.lineNumber);
                const tokenType = lineTokens.getStandardTokenType(lineTokens.findTokenIndexAtOffset(Math.max(pos.column - 1 - 1, 0)));
                if ((0, $46671b3f02f7e7cd$export$8cddbe8aa50feac1).valueFor(config, tokenType) !== 'on') return;
            }
            if (!$c647ef64fb80ec19$var$canShowQuickSuggest(this._editor, this._contextKeyService, this._configurationService)) // do not trigger quick suggestions if inline suggestions are shown
            return;
            if (!this._languageFeaturesService.completionProvider.has(model)) return;
            // we made it till here -> trigger now
            this.trigger({
                auto: true
            });
        }, this._editor.getOption(91 /* EditorOption.quickSuggestionsDelay */ ));
    }
    _refilterCompletionItems() {
        (0, $bxBg7.assertType)(this._editor.hasModel());
        (0, $bxBg7.assertType)(this._triggerState !== undefined);
        const model = this._editor.getModel();
        const position = this._editor.getPosition();
        const ctx = new $c647ef64fb80ec19$export$894a84ea03928d60(model, position, {
            ...this._triggerState,
            refilter: true
        });
        this._onNewContext(ctx);
    }
    trigger(options) {
        if (!this._editor.hasModel()) return;
        const model = this._editor.getModel();
        const ctx = new $c647ef64fb80ec19$export$894a84ea03928d60(model, this._editor.getPosition(), options);
        // Cancel previous requests, change state & update UI
        this.cancel(options.retrigger);
        this._triggerState = options;
        this._onDidTrigger.fire({
            auto: options.auto,
            shy: options.shy ?? false,
            position: this._editor.getPosition()
        });
        // Capture context when request was sent
        this._context = ctx;
        // Build context for request
        let suggestCtx = {
            triggerKind: options.triggerKind ?? 0 /* CompletionTriggerKind.Invoke */ 
        };
        if (options.triggerCharacter) suggestCtx = {
            triggerKind: 1 /* CompletionTriggerKind.TriggerCharacter */ ,
            triggerCharacter: options.triggerCharacter
        };
        this._requestToken = new (0, $giPcZ.CancellationTokenSource)();
        // kind filter and snippet sort rules
        const snippetSuggestions = this._editor.getOption(113 /* EditorOption.snippetSuggestions */ );
        let snippetSortOrder = 1 /* SnippetSortOrder.Inline */ ;
        switch(snippetSuggestions){
            case 'top':
                snippetSortOrder = 0 /* SnippetSortOrder.Top */ ;
                break;
            // 	↓ that's the default anyways...
            // case 'inline':
            // 	snippetSortOrder = SnippetSortOrder.Inline;
            // 	break;
            case 'bottom':
                snippetSortOrder = 2 /* SnippetSortOrder.Bottom */ ;
                break;
        }
        const { itemKind: itemKindFilter, showDeprecated: showDeprecated } = $c647ef64fb80ec19$var$SuggestModel_1.createSuggestFilter(this._editor);
        const completionOptions = new (0, $46671b3f02f7e7cd$export$6e9613987176d8af)(snippetSortOrder, options.completionOptions?.kindFilter ?? itemKindFilter, options.completionOptions?.providerFilter, options.completionOptions?.providerItemsToReuse, showDeprecated);
        const wordDistance = (0, $f0635859e8508238$export$620c7fa9f786bff6).create(this._editorWorkerService, this._editor);
        const completions = (0, $46671b3f02f7e7cd$export$c34b3fef967c72b0)(this._languageFeaturesService.completionProvider, model, this._editor.getPosition(), completionOptions, suggestCtx, this._requestToken.token);
        Promise.all([
            completions,
            wordDistance
        ]).then(async ([completions, wordDistance])=>{
            this._requestToken?.dispose();
            if (!this._editor.hasModel()) return;
            let clipboardText = options?.clipboardText;
            if (!clipboardText && completions.needsClipboard) clipboardText = await this._clipboardService.readText();
            if (this._triggerState === undefined) return;
            const model = this._editor.getModel();
            // const items = completions.items;
            // if (existing) {
            // 	const cmpFn = getSuggestionComparator(snippetSortOrder);
            // 	items = items.concat(existing.items).sort(cmpFn);
            // }
            const ctx = new $c647ef64fb80ec19$export$894a84ea03928d60(model, this._editor.getPosition(), options);
            const fuzzySearchOptions = {
                ...(0, $lk06m.FuzzyScoreOptions).default,
                firstMatchCanBeWeak: !this._editor.getOption(119 /* EditorOption.suggest */ ).matchOnWordStartOnly
            };
            this._completionModel = new (0, $ed4f2b2c2d18e4d1$export$8420ec00c11e432f)(completions.items, this._context.column, {
                leadingLineContent: ctx.leadingLineContent,
                characterCountDelta: ctx.column - this._context.column
            }, wordDistance, this._editor.getOption(119 /* EditorOption.suggest */ ), this._editor.getOption(113 /* EditorOption.snippetSuggestions */ ), fuzzySearchOptions, clipboardText);
            // store containers so that they can be disposed later
            this._completionDisposables.add(completions.disposable);
            this._onNewContext(ctx);
            // finally report telemetry about durations
            this._reportDurationsTelemetry(completions.durations);
            // report invalid completions by source
            if (!this._envService.isBuilt || this._envService.isExtensionDevelopment) {
                for (const item of completions.items)if (item.isInvalid) this._logService.warn(`[suggest] did IGNORE invalid completion item from ${item.provider._debugDisplayName}`, item.completion);
            }
        }).catch((0, $gPkHZ.onUnexpectedError));
    }
    _reportDurationsTelemetry(durations) {
        if (this._telemetryGate++ % 230 !== 0) return;
        setTimeout(()=>{
            this._telemetryService.publicLog2('suggest.durations.json', {
                data: JSON.stringify(durations)
            });
            this._logService.debug('suggest.durations.json', durations);
        });
    }
    static createSuggestFilter(editor) {
        // kind filter and snippet sort rules
        const result = new Set();
        // snippet setting
        const snippetSuggestions = editor.getOption(113 /* EditorOption.snippetSuggestions */ );
        if (snippetSuggestions === 'none') result.add(27 /* CompletionItemKind.Snippet */ );
        // type setting
        const suggestOptions = editor.getOption(119 /* EditorOption.suggest */ );
        if (!suggestOptions.showMethods) result.add(0 /* CompletionItemKind.Method */ );
        if (!suggestOptions.showFunctions) result.add(1 /* CompletionItemKind.Function */ );
        if (!suggestOptions.showConstructors) result.add(2 /* CompletionItemKind.Constructor */ );
        if (!suggestOptions.showFields) result.add(3 /* CompletionItemKind.Field */ );
        if (!suggestOptions.showVariables) result.add(4 /* CompletionItemKind.Variable */ );
        if (!suggestOptions.showClasses) result.add(5 /* CompletionItemKind.Class */ );
        if (!suggestOptions.showStructs) result.add(6 /* CompletionItemKind.Struct */ );
        if (!suggestOptions.showInterfaces) result.add(7 /* CompletionItemKind.Interface */ );
        if (!suggestOptions.showModules) result.add(8 /* CompletionItemKind.Module */ );
        if (!suggestOptions.showProperties) result.add(9 /* CompletionItemKind.Property */ );
        if (!suggestOptions.showEvents) result.add(10 /* CompletionItemKind.Event */ );
        if (!suggestOptions.showOperators) result.add(11 /* CompletionItemKind.Operator */ );
        if (!suggestOptions.showUnits) result.add(12 /* CompletionItemKind.Unit */ );
        if (!suggestOptions.showValues) result.add(13 /* CompletionItemKind.Value */ );
        if (!suggestOptions.showConstants) result.add(14 /* CompletionItemKind.Constant */ );
        if (!suggestOptions.showEnums) result.add(15 /* CompletionItemKind.Enum */ );
        if (!suggestOptions.showEnumMembers) result.add(16 /* CompletionItemKind.EnumMember */ );
        if (!suggestOptions.showKeywords) result.add(17 /* CompletionItemKind.Keyword */ );
        if (!suggestOptions.showWords) result.add(18 /* CompletionItemKind.Text */ );
        if (!suggestOptions.showColors) result.add(19 /* CompletionItemKind.Color */ );
        if (!suggestOptions.showFiles) result.add(20 /* CompletionItemKind.File */ );
        if (!suggestOptions.showReferences) result.add(21 /* CompletionItemKind.Reference */ );
        if (!suggestOptions.showColors) result.add(22 /* CompletionItemKind.Customcolor */ );
        if (!suggestOptions.showFolders) result.add(23 /* CompletionItemKind.Folder */ );
        if (!suggestOptions.showTypeParameters) result.add(24 /* CompletionItemKind.TypeParameter */ );
        if (!suggestOptions.showSnippets) result.add(27 /* CompletionItemKind.Snippet */ );
        if (!suggestOptions.showUsers) result.add(25 /* CompletionItemKind.User */ );
        if (!suggestOptions.showIssues) result.add(26 /* CompletionItemKind.Issue */ );
        return {
            itemKind: result,
            showDeprecated: suggestOptions.showDeprecated
        };
    }
    _onNewContext(ctx) {
        if (!this._context) // happens when 24x7 IntelliSense is enabled and still in its delay
        return;
        if (ctx.lineNumber !== this._context.lineNumber) {
            // e.g. happens when pressing Enter while IntelliSense is computed
            this.cancel();
            return;
        }
        if ((0, $jcr1R.getLeadingWhitespace)(ctx.leadingLineContent) !== (0, $jcr1R.getLeadingWhitespace)(this._context.leadingLineContent)) {
            // cancel IntelliSense when line start changes
            // happens when the current word gets outdented
            this.cancel();
            return;
        }
        if (ctx.column < this._context.column) {
            // typed -> moved cursor LEFT -> retrigger if still on a word
            if (ctx.leadingWord.word) this.trigger({
                auto: this._context.triggerOptions.auto,
                retrigger: true
            });
            else this.cancel();
            return;
        }
        if (!this._completionModel) // happens when IntelliSense is not yet computed
        return;
        if (ctx.leadingWord.word.length !== 0 && ctx.leadingWord.startColumn > this._context.leadingWord.startColumn) {
            // started a new word while IntelliSense shows -> retrigger but reuse all items that we currently have
            const shouldAutoTrigger = $c647ef64fb80ec19$export$894a84ea03928d60.shouldAutoTrigger(this._editor);
            if (shouldAutoTrigger && this._context) {
                // shouldAutoTrigger forces tokenization, which can cause pending cursor change events to be emitted, which can cause
                // suggestions to be cancelled, which causes `this._context` to be undefined
                const map = this._completionModel.getItemsByProvider();
                this.trigger({
                    auto: this._context.triggerOptions.auto,
                    retrigger: true,
                    clipboardText: this._completionModel.clipboardText,
                    completionOptions: {
                        providerItemsToReuse: map
                    }
                });
            }
            return;
        }
        if (ctx.column > this._context.column && this._completionModel.getIncompleteProvider().size > 0 && ctx.leadingWord.word.length !== 0) {
            // typed -> moved cursor RIGHT & incomple model & still on a word -> retrigger
            const providerItemsToReuse = new Map();
            const providerFilter = new Set();
            for (const [provider, items] of this._completionModel.getItemsByProvider())if (items.length > 0 && items[0].container.incomplete) providerFilter.add(provider);
            else providerItemsToReuse.set(provider, items);
            this.trigger({
                auto: this._context.triggerOptions.auto,
                triggerKind: 2 /* CompletionTriggerKind.TriggerForIncompleteCompletions */ ,
                retrigger: true,
                clipboardText: this._completionModel.clipboardText,
                completionOptions: {
                    providerFilter: providerFilter,
                    providerItemsToReuse: providerItemsToReuse
                }
            });
        } else {
            // typed -> moved cursor RIGHT -> update UI
            const oldLineContext = this._completionModel.lineContext;
            let isFrozen = false;
            this._completionModel.lineContext = {
                leadingLineContent: ctx.leadingLineContent,
                characterCountDelta: ctx.column - this._context.column
            };
            if (this._completionModel.items.length === 0) {
                const shouldAutoTrigger = $c647ef64fb80ec19$export$894a84ea03928d60.shouldAutoTrigger(this._editor);
                if (!this._context) {
                    // shouldAutoTrigger forces tokenization, which can cause pending cursor change events to be emitted, which can cause
                    // suggestions to be cancelled, which causes `this._context` to be undefined
                    this.cancel();
                    return;
                }
                if (shouldAutoTrigger && this._context.leadingWord.endColumn < ctx.leadingWord.startColumn) {
                    // retrigger when heading into a new word
                    this.trigger({
                        auto: this._context.triggerOptions.auto,
                        retrigger: true
                    });
                    return;
                }
                if (!this._context.triggerOptions.auto) {
                    // freeze when IntelliSense was manually requested
                    this._completionModel.lineContext = oldLineContext;
                    isFrozen = this._completionModel.items.length > 0;
                    if (isFrozen && ctx.leadingWord.word.length === 0) {
                        // there were results before but now there aren't
                        // and also we are not on a word anymore -> cancel
                        this.cancel();
                        return;
                    }
                } else {
                    // nothing left
                    this.cancel();
                    return;
                }
            }
            this._onDidSuggest.fire({
                completionModel: this._completionModel,
                triggerOptions: ctx.triggerOptions,
                isFrozen: isFrozen
            });
        }
    }
};
$c647ef64fb80ec19$export$bd6d3a37695095d5 = $c647ef64fb80ec19$var$SuggestModel_1 = $c647ef64fb80ec19$var$__decorate([
    $c647ef64fb80ec19$var$__param(1, (0, $zvLvK.IEditorWorkerService)),
    $c647ef64fb80ec19$var$__param(2, (0, $8QSW4.IClipboardService)),
    $c647ef64fb80ec19$var$__param(3, (0, $lMGba.ITelemetryService)),
    $c647ef64fb80ec19$var$__param(4, (0, $dvEeB.ILogService)),
    $c647ef64fb80ec19$var$__param(5, (0, $cxCeF.IContextKeyService)),
    $c647ef64fb80ec19$var$__param(6, (0, $35IZ9.IConfigurationService)),
    $c647ef64fb80ec19$var$__param(7, (0, $4J6fu.ILanguageFeaturesService)),
    $c647ef64fb80ec19$var$__param(8, (0, $hPGxd.IEnvironmentService))
], $c647ef64fb80ec19$export$bd6d3a37695095d5);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");
class $7a52ec4cd6f9707a$export$4f0a10c40326a303 {
    static{
        this._maxSelectionLength = 51200;
    }
    constructor(editor, suggestModel){
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._lastOvertyped = [];
        this._locked = false;
        this._disposables.add(editor.onWillType(()=>{
            if (this._locked || !editor.hasModel()) return;
            const selections = editor.getSelections();
            const selectionsLength = selections.length;
            // Check if it will overtype any selections
            let willOvertype = false;
            for(let i = 0; i < selectionsLength; i++)if (!selections[i].isEmpty()) {
                willOvertype = true;
                break;
            }
            if (!willOvertype) {
                if (this._lastOvertyped.length !== 0) this._lastOvertyped.length = 0;
                return;
            }
            this._lastOvertyped = [];
            const model = editor.getModel();
            for(let i = 0; i < selectionsLength; i++){
                const selection = selections[i];
                // Check for overtyping capturer restrictions
                if (model.getValueLengthInRange(selection) > $7a52ec4cd6f9707a$export$4f0a10c40326a303._maxSelectionLength) return;
                this._lastOvertyped[i] = {
                    value: model.getValueInRange(selection),
                    multiline: selection.startLineNumber !== selection.endLineNumber
                };
            }
        }));
        this._disposables.add(suggestModel.onDidTrigger((e)=>{
            this._locked = true;
        }));
        this._disposables.add(suggestModel.onDidCancel((e)=>{
            this._locked = false;
        }));
    }
    getLastOvertypedInfo(idx) {
        if (idx >= 0 && idx < this._lastOvertyped.length) return this._lastOvertyped[idx];
        return undefined;
    }
    dispose() {
        this._disposables.dispose();
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");


var $dD2OW = parcelRequire("dD2OW");

var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $7mO4b = parcelRequire("7mO4b");

var $jcr1R = parcelRequire("jcr1R");


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $czr0Q = parcelRequire("czr0Q");

var $9cWcn = parcelRequire("9cWcn");

var $hbDWq = parcelRequire("hbDWq");

var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");
var $5513aee10fd4b6f4$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $5513aee10fd4b6f4$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $5513aee10fd4b6f4$export$59a11735faca49fe = class SuggestWidgetStatus {
    constructor(container, _menuId, instantiationService, _menuService, _contextKeyService){
        this._menuId = _menuId;
        this._menuService = _menuService;
        this._contextKeyService = _contextKeyService;
        this._menuDisposables = new (0, $9cWcn.DisposableStore)();
        this.element = $bDzmQ.append(container, $bDzmQ.$('.suggest-status-bar'));
        const actionViewItemProvider = (action)=>{
            return action instanceof (0, $g4v7E.MenuItemAction) ? instantiationService.createInstance((0, $hbDWq.TextOnlyMenuEntryActionViewItem), action, {
                useComma: true
            }) : undefined;
        };
        this._leftActions = new (0, $czr0Q.ActionBar)(this.element, {
            actionViewItemProvider: actionViewItemProvider
        });
        this._rightActions = new (0, $czr0Q.ActionBar)(this.element, {
            actionViewItemProvider: actionViewItemProvider
        });
        this._leftActions.domNode.classList.add('left');
        this._rightActions.domNode.classList.add('right');
    }
    dispose() {
        this._menuDisposables.dispose();
        this._leftActions.dispose();
        this._rightActions.dispose();
        this.element.remove();
    }
    show() {
        const menu = this._menuService.createMenu(this._menuId, this._contextKeyService);
        const renderMenu = ()=>{
            const left = [];
            const right = [];
            for (const [group, actions] of menu.getActions())if (group === 'left') left.push(...actions);
            else right.push(...actions);
            this._leftActions.clear();
            this._leftActions.push(left);
            this._rightActions.clear();
            this._rightActions.push(right);
        };
        this._menuDisposables.add(menu.onDidChange(()=>renderMenu()));
        this._menuDisposables.add(menu);
    }
    hide() {
        this._menuDisposables.clear();
    }
};
$5513aee10fd4b6f4$export$59a11735faca49fe = $5513aee10fd4b6f4$var$__decorate([
    $5513aee10fd4b6f4$var$__param(2, (0, $fdGPu.IInstantiationService)),
    $5513aee10fd4b6f4$var$__param(3, (0, $g4v7E.IMenuService)),
    $5513aee10fd4b6f4$var$__param(4, (0, $cxCeF.IContextKeyService))
], $5513aee10fd4b6f4$export$59a11735faca49fe);




var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $2AUoS = parcelRequire("2AUoS");

var $gaWeX = parcelRequire("gaWeX");

var $95ky9 = parcelRequire("95ky9");

var $azIPz = parcelRequire("azIPz");


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $2aRJR = parcelRequire("2aRJR");

var $awgRE = parcelRequire("awgRE");

var $5rADe = parcelRequire("5rADe");

var $5YaSO = parcelRequire("5YaSO");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");

var $1vDLP = parcelRequire("1vDLP");


var $4dEdH = parcelRequire("4dEdH");

var $fdGPu = parcelRequire("fdGPu");
var $d231eb0b1777e64b$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $d231eb0b1777e64b$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
function $d231eb0b1777e64b$export$f492f5f48ff8b22b(item) {
    return !!item && Boolean(item.completion.documentation || item.completion.detail && item.completion.detail !== item.completion.label);
}
let $d231eb0b1777e64b$export$61e0dc2df900a441 = class SuggestDetailsWidget {
    constructor(_editor, instaService){
        this._editor = _editor;
        this._onDidClose = new (0, $5YaSO.Emitter)();
        this.onDidClose = this._onDidClose.event;
        this._onDidChangeContents = new (0, $5YaSO.Emitter)();
        this.onDidChangeContents = this._onDidChangeContents.event;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._renderDisposeable = new (0, $9cWcn.DisposableStore)();
        this._borderWidth = 1;
        this._size = new $bDzmQ.Dimension(330, 0);
        this.domNode = $bDzmQ.$('.suggest-details');
        this.domNode.classList.add('no-docs');
        this._markdownRenderer = instaService.createInstance((0, $1vDLP.MarkdownRenderer), {
            editor: _editor
        });
        this._body = $bDzmQ.$('.body');
        this._scrollbar = new (0, $2aRJR.DomScrollableElement)(this._body, {
            alwaysConsumeMouseWheel: true
        });
        $bDzmQ.append(this.domNode, this._scrollbar.getDomNode());
        this._disposables.add(this._scrollbar);
        this._header = $bDzmQ.append(this._body, $bDzmQ.$('.header'));
        this._close = $bDzmQ.append(this._header, $bDzmQ.$('span' + (0, $5rADe.ThemeIcon).asCSSSelector((0, $awgRE.Codicon).close)));
        this._close.title = $4dEdH.localize('details.close', "Close");
        this._type = $bDzmQ.append(this._header, $bDzmQ.$('p.type'));
        this._docs = $bDzmQ.append(this._body, $bDzmQ.$('p.docs'));
        this._configureFont();
        this._disposables.add(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(50 /* EditorOption.fontInfo */ )) this._configureFont();
        }));
    }
    dispose() {
        this._disposables.dispose();
        this._renderDisposeable.dispose();
    }
    _configureFont() {
        const options = this._editor.getOptions();
        const fontInfo = options.get(50 /* EditorOption.fontInfo */ );
        const fontFamily = fontInfo.getMassagedFontFamily();
        const fontSize = options.get(120 /* EditorOption.suggestFontSize */ ) || fontInfo.fontSize;
        const lineHeight = options.get(121 /* EditorOption.suggestLineHeight */ ) || fontInfo.lineHeight;
        const fontWeight = fontInfo.fontWeight;
        const fontSizePx = `${fontSize}px`;
        const lineHeightPx = `${lineHeight}px`;
        this.domNode.style.fontSize = fontSizePx;
        this.domNode.style.lineHeight = `${lineHeight / fontSize}`;
        this.domNode.style.fontWeight = fontWeight;
        this.domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;
        this._type.style.fontFamily = fontFamily;
        this._close.style.height = lineHeightPx;
        this._close.style.width = lineHeightPx;
    }
    getLayoutInfo() {
        const lineHeight = this._editor.getOption(121 /* EditorOption.suggestLineHeight */ ) || this._editor.getOption(50 /* EditorOption.fontInfo */ ).lineHeight;
        const borderWidth = this._borderWidth;
        const borderHeight = borderWidth * 2;
        return {
            lineHeight: lineHeight,
            borderWidth: borderWidth,
            borderHeight: borderHeight,
            verticalPadding: 22,
            horizontalPadding: 14
        };
    }
    renderLoading() {
        this._type.textContent = $4dEdH.localize('loading', "Loading...");
        this._docs.textContent = '';
        this.domNode.classList.remove('no-docs', 'no-type');
        this.layout(this.size.width, this.getLayoutInfo().lineHeight * 2);
        this._onDidChangeContents.fire(this);
    }
    renderItem(item, explainMode) {
        this._renderDisposeable.clear();
        let { detail: detail, documentation: documentation } = item.completion;
        if (explainMode) {
            let md = '';
            md += `score: ${item.score[0]}\n`;
            md += `prefix: ${item.word ?? '(no prefix)'}\n`;
            md += `word: ${item.completion.filterText ? item.completion.filterText + ' (filterText)' : item.textLabel}\n`;
            md += `distance: ${item.distance} (localityBonus-setting)\n`;
            md += `index: ${item.idx}, based on ${item.completion.sortText && `sortText: "${item.completion.sortText}"` || 'label'}\n`;
            md += `commit_chars: ${item.completion.commitCharacters?.join('')}\n`;
            documentation = new (0, $iGmb0.MarkdownString)().appendCodeblock('empty', md);
            detail = `Provider: ${item.provider._debugDisplayName}`;
        }
        if (!explainMode && !$d231eb0b1777e64b$export$f492f5f48ff8b22b(item)) {
            this.clearContents();
            return;
        }
        this.domNode.classList.remove('no-docs', 'no-type');
        // --- details
        if (detail) {
            const cappedDetail = detail.length > 100000 ? `${detail.substr(0, 100000)}\u{2026}` : detail;
            this._type.textContent = cappedDetail;
            this._type.title = cappedDetail;
            $bDzmQ.show(this._type);
            this._type.classList.toggle('auto-wrap', !/\r?\n^\s+/gmi.test(cappedDetail));
        } else {
            $bDzmQ.clearNode(this._type);
            this._type.title = '';
            $bDzmQ.hide(this._type);
            this.domNode.classList.add('no-type');
        }
        // --- documentation
        $bDzmQ.clearNode(this._docs);
        if (typeof documentation === 'string') {
            this._docs.classList.remove('markdown-docs');
            this._docs.textContent = documentation;
        } else if (documentation) {
            this._docs.classList.add('markdown-docs');
            $bDzmQ.clearNode(this._docs);
            const renderedContents = this._markdownRenderer.render(documentation);
            this._docs.appendChild(renderedContents.element);
            this._renderDisposeable.add(renderedContents);
            this._renderDisposeable.add(this._markdownRenderer.onDidRenderAsync(()=>{
                this.layout(this._size.width, this._type.clientHeight + this._docs.clientHeight);
                this._onDidChangeContents.fire(this);
            }));
        }
        this.domNode.style.userSelect = 'text';
        this.domNode.tabIndex = -1;
        this._close.onmousedown = (e)=>{
            e.preventDefault();
            e.stopPropagation();
        };
        this._close.onclick = (e)=>{
            e.preventDefault();
            e.stopPropagation();
            this._onDidClose.fire();
        };
        this._body.scrollTop = 0;
        this.layout(this._size.width, this._type.clientHeight + this._docs.clientHeight);
        this._onDidChangeContents.fire(this);
    }
    clearContents() {
        this.domNode.classList.add('no-docs');
        this._type.textContent = '';
        this._docs.textContent = '';
    }
    get isEmpty() {
        return this.domNode.classList.contains('no-docs');
    }
    get size() {
        return this._size;
    }
    layout(width, height) {
        const newSize = new $bDzmQ.Dimension(width, height);
        if (!$bDzmQ.Dimension.equals(newSize, this._size)) {
            this._size = newSize;
            $bDzmQ.size(this.domNode, width, height);
        }
        this._scrollbar.scanDomNode();
    }
    scrollDown(much = 8) {
        this._body.scrollTop += much;
    }
    scrollUp(much = 8) {
        this._body.scrollTop -= much;
    }
    scrollTop() {
        this._body.scrollTop = 0;
    }
    scrollBottom() {
        this._body.scrollTop = this._body.scrollHeight;
    }
    pageDown() {
        this.scrollDown(80);
    }
    pageUp() {
        this.scrollUp(80);
    }
    set borderWidth(width) {
        this._borderWidth = width;
    }
    get borderWidth() {
        return this._borderWidth;
    }
};
$d231eb0b1777e64b$export$61e0dc2df900a441 = $d231eb0b1777e64b$var$__decorate([
    $d231eb0b1777e64b$var$__param(1, (0, $fdGPu.IInstantiationService))
], $d231eb0b1777e64b$export$61e0dc2df900a441);
class $d231eb0b1777e64b$export$d55abf796289b194 {
    constructor(widget, _editor){
        this.widget = widget;
        this._editor = _editor;
        this.allowEditorOverflow = true;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._added = false;
        this._preferAlignAtTop = true;
        this._resizable = new (0, $0429f67b71a5cf7d$export$f049a29194943609)();
        this._resizable.domNode.classList.add('suggest-details-container');
        this._resizable.domNode.appendChild(widget.domNode);
        this._resizable.enableSashes(false, true, true, false);
        let topLeftNow;
        let sizeNow;
        let deltaTop = 0;
        let deltaLeft = 0;
        this._disposables.add(this._resizable.onDidWillResize(()=>{
            topLeftNow = this._topLeft;
            sizeNow = this._resizable.size;
        }));
        this._disposables.add(this._resizable.onDidResize((e)=>{
            if (topLeftNow && sizeNow) {
                this.widget.layout(e.dimension.width, e.dimension.height);
                let updateTopLeft = false;
                if (e.west) {
                    deltaLeft = sizeNow.width - e.dimension.width;
                    updateTopLeft = true;
                }
                if (e.north) {
                    deltaTop = sizeNow.height - e.dimension.height;
                    updateTopLeft = true;
                }
                if (updateTopLeft) this._applyTopLeft({
                    top: topLeftNow.top + deltaTop,
                    left: topLeftNow.left + deltaLeft
                });
            }
            if (e.done) {
                topLeftNow = undefined;
                sizeNow = undefined;
                deltaTop = 0;
                deltaLeft = 0;
                this._userSize = e.dimension;
            }
        }));
        this._disposables.add(this.widget.onDidChangeContents(()=>{
            if (this._anchorBox) this._placeAtAnchor(this._anchorBox, this._userSize ?? this.widget.size, this._preferAlignAtTop);
        }));
    }
    dispose() {
        this._resizable.dispose();
        this._disposables.dispose();
        this.hide();
    }
    getId() {
        return 'suggest.details';
    }
    getDomNode() {
        return this._resizable.domNode;
    }
    getPosition() {
        return this._topLeft ? {
            preference: this._topLeft
        } : null;
    }
    show() {
        if (!this._added) {
            this._editor.addOverlayWidget(this);
            this._added = true;
        }
    }
    hide(sessionEnded = false) {
        this._resizable.clearSashHoverState();
        if (this._added) {
            this._editor.removeOverlayWidget(this);
            this._added = false;
            this._anchorBox = undefined;
            this._topLeft = undefined;
        }
        if (sessionEnded) {
            this._userSize = undefined;
            this.widget.clearContents();
        }
    }
    placeAtAnchor(anchor, preferAlignAtTop) {
        const anchorBox = anchor.getBoundingClientRect();
        this._anchorBox = anchorBox;
        this._preferAlignAtTop = preferAlignAtTop;
        this._placeAtAnchor(this._anchorBox, this._userSize ?? this.widget.size, preferAlignAtTop);
    }
    _placeAtAnchor(anchorBox, size, preferAlignAtTop) {
        const bodyBox = $bDzmQ.getClientArea(this.getDomNode().ownerDocument.body);
        const info = this.widget.getLayoutInfo();
        const defaultMinSize = new $bDzmQ.Dimension(220, 2 * info.lineHeight);
        const defaultTop = anchorBox.top;
        // EAST
        const eastPlacement = function() {
            const width = bodyBox.width - (anchorBox.left + anchorBox.width + info.borderWidth + info.horizontalPadding);
            const left = -info.borderWidth + anchorBox.left + anchorBox.width;
            const maxSizeTop = new $bDzmQ.Dimension(width, bodyBox.height - anchorBox.top - info.borderHeight - info.verticalPadding);
            const maxSizeBottom = maxSizeTop.with(undefined, anchorBox.top + anchorBox.height - info.borderHeight - info.verticalPadding);
            return {
                top: defaultTop,
                left: left,
                fit: width - size.width,
                maxSizeTop: maxSizeTop,
                maxSizeBottom: maxSizeBottom,
                minSize: defaultMinSize.with(Math.min(width, defaultMinSize.width))
            };
        }();
        // WEST
        const westPlacement = function() {
            const width = anchorBox.left - info.borderWidth - info.horizontalPadding;
            const left = Math.max(info.horizontalPadding, anchorBox.left - size.width - info.borderWidth);
            const maxSizeTop = new $bDzmQ.Dimension(width, bodyBox.height - anchorBox.top - info.borderHeight - info.verticalPadding);
            const maxSizeBottom = maxSizeTop.with(undefined, anchorBox.top + anchorBox.height - info.borderHeight - info.verticalPadding);
            return {
                top: defaultTop,
                left: left,
                fit: width - size.width,
                maxSizeTop: maxSizeTop,
                maxSizeBottom: maxSizeBottom,
                minSize: defaultMinSize.with(Math.min(width, defaultMinSize.width))
            };
        }();
        // SOUTH
        const southPacement = function() {
            const left = anchorBox.left;
            const top = -info.borderWidth + anchorBox.top + anchorBox.height;
            const maxSizeBottom = new $bDzmQ.Dimension(anchorBox.width - info.borderHeight, bodyBox.height - anchorBox.top - anchorBox.height - info.verticalPadding);
            return {
                top: top,
                left: left,
                fit: maxSizeBottom.height - size.height,
                maxSizeBottom: maxSizeBottom,
                maxSizeTop: maxSizeBottom,
                minSize: defaultMinSize.with(maxSizeBottom.width)
            };
        }();
        // take first placement that fits or the first with "least bad" fit
        const placements = [
            eastPlacement,
            westPlacement,
            southPacement
        ];
        const placement = placements.find((p)=>p.fit >= 0) ?? placements.sort((a, b)=>b.fit - a.fit)[0];
        // top/bottom placement
        const bottom = anchorBox.top + anchorBox.height - info.borderHeight;
        let alignAtTop;
        let height = size.height;
        const maxHeight = Math.max(placement.maxSizeTop.height, placement.maxSizeBottom.height);
        if (height > maxHeight) height = maxHeight;
        let maxSize;
        if (preferAlignAtTop) {
            if (height <= placement.maxSizeTop.height) {
                alignAtTop = true;
                maxSize = placement.maxSizeTop;
            } else {
                alignAtTop = false;
                maxSize = placement.maxSizeBottom;
            }
        } else if (height <= placement.maxSizeBottom.height) {
            alignAtTop = false;
            maxSize = placement.maxSizeBottom;
        } else {
            alignAtTop = true;
            maxSize = placement.maxSizeTop;
        }
        let { top: top, left: left } = placement;
        if (!alignAtTop && height > anchorBox.height) top = bottom - height;
        const editorDomNode = this._editor.getDomNode();
        if (editorDomNode) {
            // get bounding rectangle of the suggest widget relative to the editor
            const editorBoundingBox = editorDomNode.getBoundingClientRect();
            top -= editorBoundingBox.top;
            left -= editorBoundingBox.left;
        }
        this._applyTopLeft({
            left: left,
            top: top
        });
        this._resizable.enableSashes(!alignAtTop, placement === eastPlacement, alignAtTop, placement !== eastPlacement);
        this._resizable.minSize = placement.minSize;
        this._resizable.maxSize = maxSize;
        this._resizable.layout(height, Math.min(maxSize.width, size.width));
        this.widget.layout(this._resizable.size.width, this._resizable.size.height);
    }
    _applyTopLeft(topLeft) {
        this._topLeft = topLeft;
        this._editor.layoutOverlayWidget(this);
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $7XjKn = parcelRequire("7XjKn");

var $awgRE = parcelRequire("awgRE");

var $5rADe = parcelRequire("5rADe");

var $5YaSO = parcelRequire("5YaSO");

var $lk06m = parcelRequire("lk06m");

var $9cWcn = parcelRequire("9cWcn");

var $5OJ54 = parcelRequire("5OJ54");

var $kzNQX = parcelRequire("kzNQX");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $8GPp8 = parcelRequire("8GPp8");

var $5Aea5 = parcelRequire("5Aea5");

var $5OJ54 = parcelRequire("5OJ54");

var $9QNEO = parcelRequire("9QNEO");
//#endregion
//#region Utilities
var $0e122e44ede0e86f$export$13c2b15ba9153568;
(function(FileKind) {
    FileKind[FileKind["FILE"] = 0] = "FILE";
    FileKind[FileKind["FOLDER"] = 1] = "FOLDER";
    FileKind[FileKind["ROOT_FOLDER"] = 2] = "ROOT_FOLDER";
})($0e122e44ede0e86f$export$13c2b15ba9153568 || ($0e122e44ede0e86f$export$13c2b15ba9153568 = {})); //#endregion



var $5rADe = parcelRequire("5rADe");
const $50d2342eab50311c$var$fileIconDirectoryRegex = /(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;
function $50d2342eab50311c$export$e27af96b7ae3b008(modelService, languageService, resource, fileKind, icon) {
    if ((0, $5rADe.ThemeIcon).isThemeIcon(icon)) return [
        `codicon-${icon.id}`,
        'predefined-file-icon'
    ];
    if ((0, $5OJ54.URI).isUri(icon)) return [];
    // we always set these base classes even if we do not have a path
    const classes = fileKind === (0, $0e122e44ede0e86f$export$13c2b15ba9153568).ROOT_FOLDER ? [
        'rootfolder-icon'
    ] : fileKind === (0, $0e122e44ede0e86f$export$13c2b15ba9153568).FOLDER ? [
        'folder-icon'
    ] : [
        'file-icon'
    ];
    if (resource) {
        // Get the path and name of the resource. For data-URIs, we need to parse specially
        let name;
        if (resource.scheme === (0, $8GPp8.Schemas).data) {
            const metadata = (0, $5Aea5.DataUri).parseMetaData(resource);
            name = metadata.get((0, $5Aea5.DataUri).META_DATA_LABEL);
        } else {
            const match = resource.path.match($50d2342eab50311c$var$fileIconDirectoryRegex);
            if (match) {
                name = $50d2342eab50311c$var$cssEscape(match[2].toLowerCase());
                if (match[1]) classes.push(`${$50d2342eab50311c$var$cssEscape(match[1].toLowerCase())}-name-dir-icon`); // parent directory
            } else name = $50d2342eab50311c$var$cssEscape(resource.authority.toLowerCase());
        }
        // Root Folders
        if (fileKind === (0, $0e122e44ede0e86f$export$13c2b15ba9153568).ROOT_FOLDER) classes.push(`${name}-root-name-folder-icon`);
        else if (fileKind === (0, $0e122e44ede0e86f$export$13c2b15ba9153568).FOLDER) classes.push(`${name}-name-folder-icon`);
        else {
            // Name & Extension(s)
            if (name) {
                classes.push(`${name}-name-file-icon`);
                classes.push(`name-file-icon`); // extra segment to increase file-name score
                // Avoid doing an explosive combination of extensions for very long filenames
                // (most file systems do not allow files > 255 length) with lots of `.` characters
                // https://github.com/microsoft/vscode/issues/116199
                if (name.length <= 255) {
                    const dotSegments = name.split('.');
                    for(let i = 1; i < dotSegments.length; i++)classes.push(`${dotSegments.slice(i).join('.')}-ext-file-icon`); // add each combination of all found extensions if more than one
                }
                classes.push(`ext-file-icon`); // extra segment to increase file-ext score
            }
            // Detected Mode
            const detectedLanguageId = $50d2342eab50311c$var$detectLanguageId(modelService, languageService, resource);
            if (detectedLanguageId) classes.push(`${$50d2342eab50311c$var$cssEscape(detectedLanguageId)}-lang-file-icon`);
        }
    }
    return classes;
}
function $50d2342eab50311c$var$detectLanguageId(modelService, languageService, resource) {
    if (!resource) return null; // we need a resource at least
    let languageId = null;
    // Data URI: check for encoded metadata
    if (resource.scheme === (0, $8GPp8.Schemas).data) {
        const metadata = (0, $5Aea5.DataUri).parseMetaData(resource);
        const mime = metadata.get((0, $5Aea5.DataUri).META_DATA_MIME);
        if (mime) languageId = languageService.getLanguageIdByMimeType(mime);
    } else {
        const model = modelService.getModel(resource);
        if (model) languageId = model.getLanguageId();
    }
    // only take if the language id is specific (aka no just plain text)
    if (languageId && languageId !== (0, $9QNEO.PLAINTEXT_LANGUAGE_ID)) return languageId;
    // otherwise fallback to path based detection
    return languageService.guessLanguageIdByFilepathOrFirstLine(resource);
}
function $50d2342eab50311c$var$cssEscape(str) {
    return str.replace(/[\s]/g, '/'); // HTML class names can not contain certain whitespace characters (https://dom.spec.whatwg.org/#interface-domtokenlist), use / instead, which doesn't exist in file names.
}



var $cKKJT = parcelRequire("cKKJT");

var $h9Xpp = parcelRequire("h9Xpp");

var $4dEdH = parcelRequire("4dEdH");


var $hEsmQ = parcelRequire("hEsmQ");

var $azIPz = parcelRequire("azIPz");

var $040fb21e6ed4ecb3$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $040fb21e6ed4ecb3$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
function $040fb21e6ed4ecb3$export$1b8419c18a1973d4(index) {
    return `suggest-aria-id:${index}`;
}
const $040fb21e6ed4ecb3$var$suggestMoreInfoIcon = (0, $hEsmQ.registerIcon)('suggest-more-info', (0, $awgRE.Codicon).chevronRight, $4dEdH.localize('suggestMoreInfoIcon', 'Icon for more information in the suggest widget.'));
const $040fb21e6ed4ecb3$var$_completionItemColor = new class ColorExtractor {
    static{
        this._regexRelaxed = /(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/;
    }
    static{
        this._regexStrict = new RegExp(`^${ColorExtractor._regexRelaxed.source}$`, 'i');
    }
    extract(item, out) {
        if (item.textLabel.match(ColorExtractor._regexStrict)) {
            out[0] = item.textLabel;
            return true;
        }
        if (item.completion.detail && item.completion.detail.match(ColorExtractor._regexStrict)) {
            out[0] = item.completion.detail;
            return true;
        }
        if (item.completion.documentation) {
            const value = typeof item.completion.documentation === 'string' ? item.completion.documentation : item.completion.documentation.value;
            const match = ColorExtractor._regexRelaxed.exec(value);
            if (match && (match.index === 0 || match.index + match[0].length === value.length)) {
                out[0] = match[0];
                return true;
            }
        }
        return false;
    }
};
let $040fb21e6ed4ecb3$export$72711cb3319e66a8 = class ItemRenderer {
    constructor(_editor, _modelService, _languageService, _themeService){
        this._editor = _editor;
        this._modelService = _modelService;
        this._languageService = _languageService;
        this._themeService = _themeService;
        this._onDidToggleDetails = new (0, $5YaSO.Emitter)();
        this.onDidToggleDetails = this._onDidToggleDetails.event;
        this.templateId = 'suggestion';
    }
    dispose() {
        this._onDidToggleDetails.dispose();
    }
    renderTemplate(container) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        const root = container;
        root.classList.add('show-file-icons');
        const icon = (0, $bDzmQ.append)(container, (0, $bDzmQ.$)('.icon'));
        const colorspan = (0, $bDzmQ.append)(icon, (0, $bDzmQ.$)('span.colorspan'));
        const text = (0, $bDzmQ.append)(container, (0, $bDzmQ.$)('.contents'));
        const main = (0, $bDzmQ.append)(text, (0, $bDzmQ.$)('.main'));
        const iconContainer = (0, $bDzmQ.append)(main, (0, $bDzmQ.$)('.icon-label.codicon'));
        const left = (0, $bDzmQ.append)(main, (0, $bDzmQ.$)('span.left'));
        const right = (0, $bDzmQ.append)(main, (0, $bDzmQ.$)('span.right'));
        const iconLabel = new (0, $7XjKn.IconLabel)(left, {
            supportHighlights: true,
            supportIcons: true
        });
        disposables.add(iconLabel);
        const parametersLabel = (0, $bDzmQ.append)(left, (0, $bDzmQ.$)('span.signature-label'));
        const qualifierLabel = (0, $bDzmQ.append)(left, (0, $bDzmQ.$)('span.qualifier-label'));
        const detailsLabel = (0, $bDzmQ.append)(right, (0, $bDzmQ.$)('span.details-label'));
        const readMore = (0, $bDzmQ.append)(right, (0, $bDzmQ.$)('span.readMore' + (0, $5rADe.ThemeIcon).asCSSSelector($040fb21e6ed4ecb3$var$suggestMoreInfoIcon)));
        readMore.title = $4dEdH.localize('readMore', "Read More");
        const configureFont = ()=>{
            const options = this._editor.getOptions();
            const fontInfo = options.get(50 /* EditorOption.fontInfo */ );
            const fontFamily = fontInfo.getMassagedFontFamily();
            const fontFeatureSettings = fontInfo.fontFeatureSettings;
            const fontSize = options.get(120 /* EditorOption.suggestFontSize */ ) || fontInfo.fontSize;
            const lineHeight = options.get(121 /* EditorOption.suggestLineHeight */ ) || fontInfo.lineHeight;
            const fontWeight = fontInfo.fontWeight;
            const letterSpacing = fontInfo.letterSpacing;
            const fontSizePx = `${fontSize}px`;
            const lineHeightPx = `${lineHeight}px`;
            const letterSpacingPx = `${letterSpacing}px`;
            root.style.fontSize = fontSizePx;
            root.style.fontWeight = fontWeight;
            root.style.letterSpacing = letterSpacingPx;
            main.style.fontFamily = fontFamily;
            main.style.fontFeatureSettings = fontFeatureSettings;
            main.style.lineHeight = lineHeightPx;
            icon.style.height = lineHeightPx;
            icon.style.width = lineHeightPx;
            readMore.style.height = lineHeightPx;
            readMore.style.width = lineHeightPx;
        };
        return {
            root: root,
            left: left,
            right: right,
            icon: icon,
            colorspan: colorspan,
            iconLabel: iconLabel,
            iconContainer: iconContainer,
            parametersLabel: parametersLabel,
            qualifierLabel: qualifierLabel,
            detailsLabel: detailsLabel,
            readMore: readMore,
            disposables: disposables,
            configureFont: configureFont
        };
    }
    renderElement(element, index, data) {
        data.configureFont();
        const { completion: completion } = element;
        data.root.id = $040fb21e6ed4ecb3$export$1b8419c18a1973d4(index);
        data.colorspan.style.backgroundColor = '';
        const labelOptions = {
            labelEscapeNewLines: true,
            matches: (0, $lk06m.createMatches)(element.score)
        };
        const color = [];
        if (completion.kind === 19 /* CompletionItemKind.Color */  && $040fb21e6ed4ecb3$var$_completionItemColor.extract(element, color)) {
            // special logic for 'color' completion items
            data.icon.className = 'icon customcolor';
            data.iconContainer.className = 'icon hide';
            data.colorspan.style.backgroundColor = color[0];
        } else if (completion.kind === 20 /* CompletionItemKind.File */  && this._themeService.getFileIconTheme().hasFileIcons) {
            // special logic for 'file' completion items
            data.icon.className = 'icon hide';
            data.iconContainer.className = 'icon hide';
            const labelClasses = (0, $50d2342eab50311c$export$e27af96b7ae3b008)(this._modelService, this._languageService, (0, $5OJ54.URI).from({
                scheme: 'fake',
                path: element.textLabel
            }), (0, $0e122e44ede0e86f$export$13c2b15ba9153568).FILE);
            const detailClasses = (0, $50d2342eab50311c$export$e27af96b7ae3b008)(this._modelService, this._languageService, (0, $5OJ54.URI).from({
                scheme: 'fake',
                path: completion.detail
            }), (0, $0e122e44ede0e86f$export$13c2b15ba9153568).FILE);
            labelOptions.extraClasses = labelClasses.length > detailClasses.length ? labelClasses : detailClasses;
        } else if (completion.kind === 23 /* CompletionItemKind.Folder */  && this._themeService.getFileIconTheme().hasFolderIcons) {
            // special logic for 'folder' completion items
            data.icon.className = 'icon hide';
            data.iconContainer.className = 'icon hide';
            labelOptions.extraClasses = [
                (0, $50d2342eab50311c$export$e27af96b7ae3b008)(this._modelService, this._languageService, (0, $5OJ54.URI).from({
                    scheme: 'fake',
                    path: element.textLabel
                }), (0, $0e122e44ede0e86f$export$13c2b15ba9153568).FOLDER),
                (0, $50d2342eab50311c$export$e27af96b7ae3b008)(this._modelService, this._languageService, (0, $5OJ54.URI).from({
                    scheme: 'fake',
                    path: completion.detail
                }), (0, $0e122e44ede0e86f$export$13c2b15ba9153568).FOLDER)
            ].flat();
        } else {
            // normal icon
            data.icon.className = 'icon hide';
            data.iconContainer.className = '';
            data.iconContainer.classList.add('suggest-icon', ...(0, $5rADe.ThemeIcon).asClassNameArray((0, $kzNQX.CompletionItemKinds).toIcon(completion.kind)));
        }
        if (completion.tags && completion.tags.indexOf(1 /* CompletionItemTag.Deprecated */ ) >= 0) {
            labelOptions.extraClasses = (labelOptions.extraClasses || []).concat([
                'deprecated'
            ]);
            labelOptions.matches = [];
        }
        data.iconLabel.setLabel(element.textLabel, undefined, labelOptions);
        if (typeof completion.label === 'string') {
            data.parametersLabel.textContent = '';
            data.detailsLabel.textContent = $040fb21e6ed4ecb3$var$stripNewLines(completion.detail || '');
            data.root.classList.add('string-label');
        } else {
            data.parametersLabel.textContent = $040fb21e6ed4ecb3$var$stripNewLines(completion.label.detail || '');
            data.detailsLabel.textContent = $040fb21e6ed4ecb3$var$stripNewLines(completion.label.description || '');
            data.root.classList.remove('string-label');
        }
        if (this._editor.getOption(119 /* EditorOption.suggest */ ).showInlineDetails) (0, $bDzmQ.show)(data.detailsLabel);
        else (0, $bDzmQ.hide)(data.detailsLabel);
        if ((0, $d231eb0b1777e64b$export$f492f5f48ff8b22b)(element)) {
            data.right.classList.add('can-expand-details');
            (0, $bDzmQ.show)(data.readMore);
            data.readMore.onmousedown = (e)=>{
                e.stopPropagation();
                e.preventDefault();
            };
            data.readMore.onclick = (e)=>{
                e.stopPropagation();
                e.preventDefault();
                this._onDidToggleDetails.fire();
            };
        } else {
            data.right.classList.remove('can-expand-details');
            (0, $bDzmQ.hide)(data.readMore);
            data.readMore.onmousedown = null;
            data.readMore.onclick = null;
        }
    }
    disposeTemplate(templateData) {
        templateData.disposables.dispose();
    }
};
$040fb21e6ed4ecb3$export$72711cb3319e66a8 = $040fb21e6ed4ecb3$var$__decorate([
    $040fb21e6ed4ecb3$var$__param(1, (0, $cKKJT.IModelService)),
    $040fb21e6ed4ecb3$var$__param(2, (0, $h9Xpp.ILanguageService)),
    $040fb21e6ed4ecb3$var$__param(3, (0, $azIPz.IThemeService))
], $040fb21e6ed4ecb3$export$72711cb3319e66a8);
function $040fb21e6ed4ecb3$var$stripNewLines(str) {
    return str.replace(/\r\n|\r|\n/g, '');
}



var $l1XLO = parcelRequire("l1XLO");

var $aIbUW = parcelRequire("aIbUW");
var $b4bf71a7a107deba$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $b4bf71a7a107deba$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $b4bf71a7a107deba$var$SuggestWidget_1;
/**
 * Suggest widget colors
 */ (0, $gaWeX.registerColor)('editorSuggestWidget.background', (0, $gaWeX.editorWidgetBackground), $4dEdH.localize('editorSuggestWidgetBackground', 'Background color of the suggest widget.'));
(0, $gaWeX.registerColor)('editorSuggestWidget.border', (0, $gaWeX.editorWidgetBorder), $4dEdH.localize('editorSuggestWidgetBorder', 'Border color of the suggest widget.'));
const $b4bf71a7a107deba$var$editorSuggestWidgetForeground = (0, $gaWeX.registerColor)('editorSuggestWidget.foreground', (0, $gaWeX.editorForeground), $4dEdH.localize('editorSuggestWidgetForeground', 'Foreground color of the suggest widget.'));
(0, $gaWeX.registerColor)('editorSuggestWidget.selectedForeground', (0, $gaWeX.quickInputListFocusForeground), $4dEdH.localize('editorSuggestWidgetSelectedForeground', 'Foreground color of the selected entry in the suggest widget.'));
(0, $gaWeX.registerColor)('editorSuggestWidget.selectedIconForeground', (0, $gaWeX.quickInputListFocusIconForeground), $4dEdH.localize('editorSuggestWidgetSelectedIconForeground', 'Icon foreground color of the selected entry in the suggest widget.'));
const $b4bf71a7a107deba$export$4e0daeab52f97af3 = (0, $gaWeX.registerColor)('editorSuggestWidget.selectedBackground', (0, $gaWeX.quickInputListFocusBackground), $4dEdH.localize('editorSuggestWidgetSelectedBackground', 'Background color of the selected entry in the suggest widget.'));
(0, $gaWeX.registerColor)('editorSuggestWidget.highlightForeground', (0, $gaWeX.listHighlightForeground), $4dEdH.localize('editorSuggestWidgetHighlightForeground', 'Color of the match highlights in the suggest widget.'));
(0, $gaWeX.registerColor)('editorSuggestWidget.focusHighlightForeground', (0, $gaWeX.listFocusHighlightForeground), $4dEdH.localize('editorSuggestWidgetFocusHighlightForeground', 'Color of the match highlights in the suggest widget when an item is focused.'));
(0, $gaWeX.registerColor)('editorSuggestWidgetStatus.foreground', (0, $gaWeX.transparent)($b4bf71a7a107deba$var$editorSuggestWidgetForeground, .5), $4dEdH.localize('editorSuggestWidgetStatusForeground', 'Foreground color of the suggest widget status.'));
class $b4bf71a7a107deba$var$PersistedWidgetSize {
    constructor(_service, editor){
        this._service = _service;
        this._key = `suggestWidget.size/${editor.getEditorType()}/${editor instanceof (0, $205d91d7661de01d$export$3c7efbd913d316d0)}`;
    }
    restore() {
        const raw = this._service.get(this._key, 0 /* StorageScope.PROFILE */ ) ?? '';
        try {
            const obj = JSON.parse(raw);
            if ($bDzmQ.Dimension.is(obj)) return $bDzmQ.Dimension.lift(obj);
        } catch  {
        // ignore
        }
        return undefined;
    }
    store(size) {
        this._service.store(this._key, JSON.stringify(size), 0 /* StorageScope.PROFILE */ , 1 /* StorageTarget.MACHINE */ );
    }
    reset() {
        this._service.remove(this._key, 0 /* StorageScope.PROFILE */ );
    }
}
let $b4bf71a7a107deba$export$ad1808d575fcd49b = class SuggestWidget {
    static{
        $b4bf71a7a107deba$var$SuggestWidget_1 = this;
    }
    static{
        this.LOADING_MESSAGE = $4dEdH.localize('suggestWidget.loading', "Loading...");
    }
    static{
        this.NO_SUGGESTIONS_MESSAGE = $4dEdH.localize('suggestWidget.noSuggestions', "No suggestions.");
    }
    constructor(editor, _storageService, _contextKeyService, _themeService, instantiationService){
        this.editor = editor;
        this._storageService = _storageService;
        this._state = 0 /* State.Hidden */ ;
        this._isAuto = false;
        this._pendingLayout = new (0, $9cWcn.MutableDisposable)();
        this._pendingShowDetails = new (0, $9cWcn.MutableDisposable)();
        this._ignoreFocusEvents = false;
        this._forceRenderingAbove = false;
        this._explainMode = false;
        this._showTimeout = new (0, $6bXyA.TimeoutTimer)();
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._onDidSelect = new (0, $5YaSO.PauseableEmitter)();
        this._onDidFocus = new (0, $5YaSO.PauseableEmitter)();
        this._onDidHide = new (0, $5YaSO.Emitter)();
        this._onDidShow = new (0, $5YaSO.Emitter)();
        this.onDidSelect = this._onDidSelect.event;
        this.onDidFocus = this._onDidFocus.event;
        this.onDidHide = this._onDidHide.event;
        this.onDidShow = this._onDidShow.event;
        this._onDetailsKeydown = new (0, $5YaSO.Emitter)();
        this.onDetailsKeyDown = this._onDetailsKeydown.event;
        this.element = new (0, $0429f67b71a5cf7d$export$f049a29194943609)();
        this.element.domNode.classList.add('editor-widget', 'suggest-widget');
        this._contentWidget = new $b4bf71a7a107deba$export$335c575f116d83ac(this, editor);
        this._persistedSize = new $b4bf71a7a107deba$var$PersistedWidgetSize(_storageService, editor);
        class ResizeState {
            constructor(persistedSize, currentSize, persistHeight = false, persistWidth = false){
                this.persistedSize = persistedSize;
                this.currentSize = currentSize;
                this.persistHeight = persistHeight;
                this.persistWidth = persistWidth;
            }
        }
        let state;
        this._disposables.add(this.element.onDidWillResize(()=>{
            this._contentWidget.lockPreference();
            state = new ResizeState(this._persistedSize.restore(), this.element.size);
        }));
        this._disposables.add(this.element.onDidResize((e)=>{
            this._resize(e.dimension.width, e.dimension.height);
            if (state) {
                state.persistHeight = state.persistHeight || !!e.north || !!e.south;
                state.persistWidth = state.persistWidth || !!e.east || !!e.west;
            }
            if (!e.done) return;
            if (state) {
                // only store width or height value that have changed and also
                // only store changes that are above a certain threshold
                const { itemHeight: itemHeight, defaultSize: defaultSize } = this.getLayoutInfo();
                const threshold = Math.round(itemHeight / 2);
                let { width: width, height: height } = this.element.size;
                if (!state.persistHeight || Math.abs(state.currentSize.height - height) <= threshold) height = state.persistedSize?.height ?? defaultSize.height;
                if (!state.persistWidth || Math.abs(state.currentSize.width - width) <= threshold) width = state.persistedSize?.width ?? defaultSize.width;
                this._persistedSize.store(new $bDzmQ.Dimension(width, height));
            }
            // reset working state
            this._contentWidget.unlockPreference();
            state = undefined;
        }));
        this._messageElement = $bDzmQ.append(this.element.domNode, $bDzmQ.$('.message'));
        this._listElement = $bDzmQ.append(this.element.domNode, $bDzmQ.$('.tree'));
        const details = this._disposables.add(instantiationService.createInstance((0, $d231eb0b1777e64b$export$61e0dc2df900a441), this.editor));
        details.onDidClose(this.toggleDetails, this, this._disposables);
        this._details = new (0, $d231eb0b1777e64b$export$d55abf796289b194)(details, this.editor);
        const applyIconStyle = ()=>this.element.domNode.classList.toggle('no-icons', !this.editor.getOption(119 /* EditorOption.suggest */ ).showIcons);
        applyIconStyle();
        const renderer = instantiationService.createInstance((0, $040fb21e6ed4ecb3$export$72711cb3319e66a8), this.editor);
        this._disposables.add(renderer);
        this._disposables.add(renderer.onDidToggleDetails(()=>this.toggleDetails()));
        this._list = new (0, $dD2OW.List)('SuggestWidget', this._listElement, {
            getHeight: (_element)=>this.getLayoutInfo().itemHeight,
            getTemplateId: (_element)=>'suggestion'
        }, [
            renderer
        ], {
            alwaysConsumeMouseWheel: true,
            useShadows: false,
            mouseSupport: false,
            multipleSelectionSupport: false,
            accessibilityProvider: {
                getRole: ()=>'option',
                getWidgetAriaLabel: ()=>$4dEdH.localize('suggest', "Suggest"),
                getWidgetRole: ()=>'listbox',
                getAriaLabel: (item)=>{
                    let label = item.textLabel;
                    if (typeof item.completion.label !== 'string') {
                        const { detail: detail, description: description } = item.completion.label;
                        if (detail && description) label = $4dEdH.localize('label.full', '{0} {1}, {2}', label, detail, description);
                        else if (detail) label = $4dEdH.localize('label.detail', '{0} {1}', label, detail);
                        else if (description) label = $4dEdH.localize('label.desc', '{0}, {1}', label, description);
                    }
                    if (!item.isResolved || !this._isDetailsVisible()) return label;
                    const { documentation: documentation, detail: detail } = item.completion;
                    const docs = $jcr1R.format('{0}{1}', detail || '', documentation ? typeof documentation === 'string' ? documentation : documentation.value : '');
                    return $4dEdH.localize('ariaCurrenttSuggestionReadDetails', "{0}, docs: {1}", label, docs);
                }
            }
        });
        this._list.style((0, $l1XLO.getListStyles)({
            listInactiveFocusBackground: $b4bf71a7a107deba$export$4e0daeab52f97af3,
            listInactiveFocusOutline: (0, $gaWeX.activeContrastBorder)
        }));
        this._status = instantiationService.createInstance((0, $5513aee10fd4b6f4$export$59a11735faca49fe), this.element.domNode, (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab));
        const applyStatusBarStyle = ()=>this.element.domNode.classList.toggle('with-status-bar', this.editor.getOption(119 /* EditorOption.suggest */ ).showStatusBar);
        applyStatusBarStyle();
        this._disposables.add(_themeService.onDidColorThemeChange((t)=>this._onThemeChange(t)));
        this._onThemeChange(_themeService.getColorTheme());
        this._disposables.add(this._list.onMouseDown((e)=>this._onListMouseDownOrTap(e)));
        this._disposables.add(this._list.onTap((e)=>this._onListMouseDownOrTap(e)));
        this._disposables.add(this._list.onDidChangeSelection((e)=>this._onListSelection(e)));
        this._disposables.add(this._list.onDidChangeFocus((e)=>this._onListFocus(e)));
        this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged()));
        this._disposables.add(this.editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(119 /* EditorOption.suggest */ )) {
                applyStatusBarStyle();
                applyIconStyle();
            }
            if (this._completionModel && (e.hasChanged(50 /* EditorOption.fontInfo */ ) || e.hasChanged(120 /* EditorOption.suggestFontSize */ ) || e.hasChanged(121 /* EditorOption.suggestLineHeight */ ))) this._list.splice(0, this._list.length, this._completionModel.items);
        }));
        this._ctxSuggestWidgetVisible = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible.bindTo(_contextKeyService);
        this._ctxSuggestWidgetDetailsVisible = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).DetailsVisible.bindTo(_contextKeyService);
        this._ctxSuggestWidgetMultipleSuggestions = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MultipleSuggestions.bindTo(_contextKeyService);
        this._ctxSuggestWidgetHasFocusedSuggestion = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.bindTo(_contextKeyService);
        this._disposables.add($bDzmQ.addStandardDisposableListener(this._details.widget.domNode, 'keydown', (e)=>{
            this._onDetailsKeydown.fire(e);
        }));
        this._disposables.add(this.editor.onMouseDown((e)=>this._onEditorMouseDown(e)));
    }
    dispose() {
        this._details.widget.dispose();
        this._details.dispose();
        this._list.dispose();
        this._status.dispose();
        this._disposables.dispose();
        this._loadingTimeout?.dispose();
        this._pendingLayout.dispose();
        this._pendingShowDetails.dispose();
        this._showTimeout.dispose();
        this._contentWidget.dispose();
        this.element.dispose();
    }
    _onEditorMouseDown(mouseEvent) {
        if (this._details.widget.domNode.contains(mouseEvent.target.element)) // Clicking inside details
        this._details.widget.domNode.focus();
        else // Clicking outside details and inside suggest
        if (this.element.domNode.contains(mouseEvent.target.element)) this.editor.focus();
    }
    _onCursorSelectionChanged() {
        if (this._state !== 0 /* State.Hidden */ ) this._contentWidget.layout();
    }
    _onListMouseDownOrTap(e) {
        if (typeof e.element === 'undefined' || typeof e.index === 'undefined') return;
        // prevent stealing browser focus from the editor
        e.browserEvent.preventDefault();
        e.browserEvent.stopPropagation();
        this._select(e.element, e.index);
    }
    _onListSelection(e) {
        if (e.elements.length) this._select(e.elements[0], e.indexes[0]);
    }
    _select(item, index) {
        const completionModel = this._completionModel;
        if (completionModel) {
            this._onDidSelect.fire({
                item: item,
                index: index,
                model: completionModel
            });
            this.editor.focus();
        }
    }
    _onThemeChange(theme) {
        this._details.widget.borderWidth = (0, $95ky9.isHighContrast)(theme.type) ? 2 : 1;
    }
    _onListFocus(e) {
        if (this._ignoreFocusEvents) return;
        if (!e.elements.length) {
            if (this._currentSuggestionDetails) {
                this._currentSuggestionDetails.cancel();
                this._currentSuggestionDetails = undefined;
                this._focusedItem = undefined;
            }
            this.editor.setAriaOptions({
                activeDescendant: undefined
            });
            this._ctxSuggestWidgetHasFocusedSuggestion.set(false);
            return;
        }
        if (!this._completionModel) return;
        this._ctxSuggestWidgetHasFocusedSuggestion.set(true);
        const item = e.elements[0];
        const index = e.indexes[0];
        if (item !== this._focusedItem) {
            this._currentSuggestionDetails?.cancel();
            this._currentSuggestionDetails = undefined;
            this._focusedItem = item;
            this._list.reveal(index);
            this._currentSuggestionDetails = (0, $6bXyA.createCancelablePromise)(async (token)=>{
                const loading = (0, $6bXyA.disposableTimeout)(()=>{
                    if (this._isDetailsVisible()) this.showDetails(true);
                }, 250);
                const sub = token.onCancellationRequested(()=>loading.dispose());
                try {
                    return await item.resolve(token);
                } finally{
                    loading.dispose();
                    sub.dispose();
                }
            });
            this._currentSuggestionDetails.then(()=>{
                if (index >= this._list.length || item !== this._list.element(index)) return;
                // item can have extra information, so re-render
                this._ignoreFocusEvents = true;
                this._list.splice(index, 1, [
                    item
                ]);
                this._list.setFocus([
                    index
                ]);
                this._ignoreFocusEvents = false;
                if (this._isDetailsVisible()) this.showDetails(false);
                else this.element.domNode.classList.remove('docs-side');
                this.editor.setAriaOptions({
                    activeDescendant: (0, $040fb21e6ed4ecb3$export$1b8419c18a1973d4)(index)
                });
            }).catch((0, $gPkHZ.onUnexpectedError));
        }
        // emit an event
        this._onDidFocus.fire({
            item: item,
            index: index,
            model: this._completionModel
        });
    }
    _setState(state) {
        if (this._state === state) return;
        this._state = state;
        this.element.domNode.classList.toggle('frozen', state === 4 /* State.Frozen */ );
        this.element.domNode.classList.remove('message');
        switch(state){
            case 0 /* State.Hidden */ :
                $bDzmQ.hide(this._messageElement, this._listElement, this._status.element);
                this._details.hide(true);
                this._status.hide();
                this._contentWidget.hide();
                this._ctxSuggestWidgetVisible.reset();
                this._ctxSuggestWidgetMultipleSuggestions.reset();
                this._ctxSuggestWidgetHasFocusedSuggestion.reset();
                this._showTimeout.cancel();
                this.element.domNode.classList.remove('visible');
                this._list.splice(0, this._list.length);
                this._focusedItem = undefined;
                this._cappedHeight = undefined;
                this._explainMode = false;
                break;
            case 1 /* State.Loading */ :
                this.element.domNode.classList.add('message');
                this._messageElement.textContent = $b4bf71a7a107deba$var$SuggestWidget_1.LOADING_MESSAGE;
                $bDzmQ.hide(this._listElement, this._status.element);
                $bDzmQ.show(this._messageElement);
                this._details.hide();
                this._show();
                this._focusedItem = undefined;
                (0, $aIbUW.status)($b4bf71a7a107deba$var$SuggestWidget_1.LOADING_MESSAGE);
                break;
            case 2 /* State.Empty */ :
                this.element.domNode.classList.add('message');
                this._messageElement.textContent = $b4bf71a7a107deba$var$SuggestWidget_1.NO_SUGGESTIONS_MESSAGE;
                $bDzmQ.hide(this._listElement, this._status.element);
                $bDzmQ.show(this._messageElement);
                this._details.hide();
                this._show();
                this._focusedItem = undefined;
                (0, $aIbUW.status)($b4bf71a7a107deba$var$SuggestWidget_1.NO_SUGGESTIONS_MESSAGE);
                break;
            case 3 /* State.Open */ :
                $bDzmQ.hide(this._messageElement);
                $bDzmQ.show(this._listElement, this._status.element);
                this._show();
                break;
            case 4 /* State.Frozen */ :
                $bDzmQ.hide(this._messageElement);
                $bDzmQ.show(this._listElement, this._status.element);
                this._show();
                break;
            case 5 /* State.Details */ :
                $bDzmQ.hide(this._messageElement);
                $bDzmQ.show(this._listElement, this._status.element);
                this._details.show();
                this._show();
                break;
        }
    }
    _show() {
        this._status.show();
        this._contentWidget.show();
        this._layout(this._persistedSize.restore());
        this._ctxSuggestWidgetVisible.set(true);
        this._showTimeout.cancelAndSet(()=>{
            this.element.domNode.classList.add('visible');
            this._onDidShow.fire(this);
        }, 100);
    }
    showTriggered(auto, delay) {
        if (this._state !== 0 /* State.Hidden */ ) return;
        this._contentWidget.setPosition(this.editor.getPosition());
        this._isAuto = !!auto;
        if (!this._isAuto) this._loadingTimeout = (0, $6bXyA.disposableTimeout)(()=>this._setState(1 /* State.Loading */ ), delay);
    }
    showSuggestions(completionModel, selectionIndex, isFrozen, isAuto, noFocus) {
        this._contentWidget.setPosition(this.editor.getPosition());
        this._loadingTimeout?.dispose();
        this._currentSuggestionDetails?.cancel();
        this._currentSuggestionDetails = undefined;
        if (this._completionModel !== completionModel) this._completionModel = completionModel;
        if (isFrozen && this._state !== 2 /* State.Empty */  && this._state !== 0 /* State.Hidden */ ) {
            this._setState(4 /* State.Frozen */ );
            return;
        }
        const visibleCount = this._completionModel.items.length;
        const isEmpty = visibleCount === 0;
        this._ctxSuggestWidgetMultipleSuggestions.set(visibleCount > 1);
        if (isEmpty) {
            this._setState(isAuto ? 0 /* State.Hidden */  : 2 /* State.Empty */ );
            this._completionModel = undefined;
            return;
        }
        this._focusedItem = undefined;
        // calling list.splice triggers focus event which this widget forwards. That can lead to
        // suggestions being cancelled and the widget being cleared (and hidden). All this happens
        // before revealing and focusing is done which means revealing and focusing will fail when
        // they get run.
        this._onDidFocus.pause();
        this._onDidSelect.pause();
        try {
            this._list.splice(0, this._list.length, this._completionModel.items);
            this._setState(isFrozen ? 4 /* State.Frozen */  : 3 /* State.Open */ );
            this._list.reveal(selectionIndex, 0);
            this._list.setFocus(noFocus ? [] : [
                selectionIndex
            ]);
        } finally{
            this._onDidFocus.resume();
            this._onDidSelect.resume();
        }
        this._pendingLayout.value = $bDzmQ.runAtThisOrScheduleAtNextAnimationFrame($bDzmQ.getWindow(this.element.domNode), ()=>{
            this._pendingLayout.clear();
            this._layout(this.element.size);
            // Reset focus border
            this._details.widget.domNode.classList.remove('focused');
        });
    }
    focusSelected() {
        if (this._list.length > 0) this._list.setFocus([
            0
        ]);
    }
    selectNextPage() {
        switch(this._state){
            case 0 /* State.Hidden */ :
                return false;
            case 5 /* State.Details */ :
                this._details.widget.pageDown();
                return true;
            case 1 /* State.Loading */ :
                return !this._isAuto;
            default:
                this._list.focusNextPage();
                return true;
        }
    }
    selectNext() {
        switch(this._state){
            case 0 /* State.Hidden */ :
                return false;
            case 1 /* State.Loading */ :
                return !this._isAuto;
            default:
                this._list.focusNext(1, true);
                return true;
        }
    }
    selectLast() {
        switch(this._state){
            case 0 /* State.Hidden */ :
                return false;
            case 5 /* State.Details */ :
                this._details.widget.scrollBottom();
                return true;
            case 1 /* State.Loading */ :
                return !this._isAuto;
            default:
                this._list.focusLast();
                return true;
        }
    }
    selectPreviousPage() {
        switch(this._state){
            case 0 /* State.Hidden */ :
                return false;
            case 5 /* State.Details */ :
                this._details.widget.pageUp();
                return true;
            case 1 /* State.Loading */ :
                return !this._isAuto;
            default:
                this._list.focusPreviousPage();
                return true;
        }
    }
    selectPrevious() {
        switch(this._state){
            case 0 /* State.Hidden */ :
                return false;
            case 1 /* State.Loading */ :
                return !this._isAuto;
            default:
                this._list.focusPrevious(1, true);
                return false;
        }
    }
    selectFirst() {
        switch(this._state){
            case 0 /* State.Hidden */ :
                return false;
            case 5 /* State.Details */ :
                this._details.widget.scrollTop();
                return true;
            case 1 /* State.Loading */ :
                return !this._isAuto;
            default:
                this._list.focusFirst();
                return true;
        }
    }
    getFocusedItem() {
        if (this._state !== 0 /* State.Hidden */  && this._state !== 2 /* State.Empty */  && this._state !== 1 /* State.Loading */  && this._completionModel && this._list.getFocus().length > 0) return {
            item: this._list.getFocusedElements()[0],
            index: this._list.getFocus()[0],
            model: this._completionModel
        };
        return undefined;
    }
    toggleDetailsFocus() {
        if (this._state === 5 /* State.Details */ ) {
            this._setState(3 /* State.Open */ );
            this._details.widget.domNode.classList.remove('focused');
        } else if (this._state === 3 /* State.Open */  && this._isDetailsVisible()) {
            this._setState(5 /* State.Details */ );
            this._details.widget.domNode.classList.add('focused');
        }
    }
    toggleDetails() {
        if (this._isDetailsVisible()) {
            // hide details widget
            this._pendingShowDetails.clear();
            this._ctxSuggestWidgetDetailsVisible.set(false);
            this._setDetailsVisible(false);
            this._details.hide();
            this.element.domNode.classList.remove('shows-details');
        } else if (((0, $d231eb0b1777e64b$export$f492f5f48ff8b22b)(this._list.getFocusedElements()[0]) || this._explainMode) && (this._state === 3 /* State.Open */  || this._state === 5 /* State.Details */  || this._state === 4 /* State.Frozen */ )) {
            // show details widget (iff possible)
            this._ctxSuggestWidgetDetailsVisible.set(true);
            this._setDetailsVisible(true);
            this.showDetails(false);
        }
    }
    showDetails(loading) {
        this._pendingShowDetails.value = $bDzmQ.runAtThisOrScheduleAtNextAnimationFrame($bDzmQ.getWindow(this.element.domNode), ()=>{
            this._pendingShowDetails.clear();
            this._details.show();
            if (loading) this._details.widget.renderLoading();
            else this._details.widget.renderItem(this._list.getFocusedElements()[0], this._explainMode);
            if (!this._details.widget.isEmpty) {
                this._positionDetails();
                this.element.domNode.classList.add('shows-details');
            } else this._details.hide();
            this.editor.focus();
        });
    }
    toggleExplainMode() {
        if (this._list.getFocusedElements()[0]) {
            this._explainMode = !this._explainMode;
            if (!this._isDetailsVisible()) this.toggleDetails();
            else this.showDetails(false);
        }
    }
    resetPersistedSize() {
        this._persistedSize.reset();
    }
    hideWidget() {
        this._pendingLayout.clear();
        this._pendingShowDetails.clear();
        this._loadingTimeout?.dispose();
        this._setState(0 /* State.Hidden */ );
        this._onDidHide.fire(this);
        this.element.clearSashHoverState();
        // ensure that a reasonable widget height is persisted so that
        // accidential "resize-to-single-items" cases aren't happening
        const dim = this._persistedSize.restore();
        const minPersistedHeight = Math.ceil(this.getLayoutInfo().itemHeight * 4.3);
        if (dim && dim.height < minPersistedHeight) this._persistedSize.store(dim.with(undefined, minPersistedHeight));
    }
    isFrozen() {
        return this._state === 4 /* State.Frozen */ ;
    }
    _afterRender(position) {
        if (position === null) {
            if (this._isDetailsVisible()) this._details.hide(); //todo@jrieken soft-hide
            return;
        }
        if (this._state === 2 /* State.Empty */  || this._state === 1 /* State.Loading */ ) // no special positioning when widget isn't showing list
        return;
        if (this._isDetailsVisible() && !this._details.widget.isEmpty) this._details.show();
        this._positionDetails();
    }
    _layout(size) {
        if (!this.editor.hasModel()) return;
        if (!this.editor.getDomNode()) // happens when running tests
        return;
        const bodyBox = $bDzmQ.getClientArea(this.element.domNode.ownerDocument.body);
        const info = this.getLayoutInfo();
        if (!size) size = info.defaultSize;
        let height = size.height;
        let width = size.width;
        // status bar
        this._status.element.style.height = `${info.itemHeight}px`;
        if (this._state === 2 /* State.Empty */  || this._state === 1 /* State.Loading */ ) {
            // showing a message only
            height = info.itemHeight + info.borderHeight;
            width = info.defaultSize.width / 2;
            this.element.enableSashes(false, false, false, false);
            this.element.minSize = this.element.maxSize = new $bDzmQ.Dimension(width, height);
            this._contentWidget.setPreference(2 /* ContentWidgetPositionPreference.BELOW */ );
        } else {
            // showing items
            // width math
            const maxWidth = bodyBox.width - info.borderHeight - 2 * info.horizontalPadding;
            if (width > maxWidth) width = maxWidth;
            const preferredWidth = this._completionModel ? this._completionModel.stats.pLabelLen * info.typicalHalfwidthCharacterWidth : width;
            // height math
            const fullHeight = info.statusBarHeight + this._list.contentHeight + info.borderHeight;
            const minHeight = info.itemHeight + info.statusBarHeight;
            const editorBox = $bDzmQ.getDomNodePagePosition(this.editor.getDomNode());
            const cursorBox = this.editor.getScrolledVisiblePosition(this.editor.getPosition());
            const cursorBottom = editorBox.top + cursorBox.top + cursorBox.height;
            const maxHeightBelow = Math.min(bodyBox.height - cursorBottom - info.verticalPadding, fullHeight);
            const availableSpaceAbove = editorBox.top + cursorBox.top - info.verticalPadding;
            const maxHeightAbove = Math.min(availableSpaceAbove, fullHeight);
            let maxHeight = Math.min(Math.max(maxHeightAbove, maxHeightBelow) + info.borderHeight, fullHeight);
            if (height === this._cappedHeight?.capped) // Restore the old (wanted) height when the current
            // height is capped to fit
            height = this._cappedHeight.wanted;
            if (height < minHeight) height = minHeight;
            if (height > maxHeight) height = maxHeight;
            const forceRenderingAboveRequiredSpace = 150;
            if (height > maxHeightBelow || this._forceRenderingAbove && availableSpaceAbove > forceRenderingAboveRequiredSpace) {
                this._contentWidget.setPreference(1 /* ContentWidgetPositionPreference.ABOVE */ );
                this.element.enableSashes(true, true, false, false);
                maxHeight = maxHeightAbove;
            } else {
                this._contentWidget.setPreference(2 /* ContentWidgetPositionPreference.BELOW */ );
                this.element.enableSashes(false, true, true, false);
                maxHeight = maxHeightBelow;
            }
            this.element.preferredSize = new $bDzmQ.Dimension(preferredWidth, info.defaultSize.height);
            this.element.maxSize = new $bDzmQ.Dimension(maxWidth, maxHeight);
            this.element.minSize = new $bDzmQ.Dimension(220, minHeight);
            // Know when the height was capped to fit and remember
            // the wanted height for later. This is required when going
            // left to widen suggestions.
            this._cappedHeight = height === fullHeight ? {
                wanted: this._cappedHeight?.wanted ?? size.height,
                capped: height
            } : undefined;
        }
        this._resize(width, height);
    }
    _resize(width, height) {
        const { width: maxWidth, height: maxHeight } = this.element.maxSize;
        width = Math.min(maxWidth, width);
        height = Math.min(maxHeight, height);
        const { statusBarHeight: statusBarHeight } = this.getLayoutInfo();
        this._list.layout(height - statusBarHeight, width);
        this._listElement.style.height = `${height - statusBarHeight}px`;
        this.element.layout(height, width);
        this._contentWidget.layout();
        this._positionDetails();
    }
    _positionDetails() {
        if (this._isDetailsVisible()) this._details.placeAtAnchor(this.element.domNode, this._contentWidget.getPosition()?.preference[0] === 2 /* ContentWidgetPositionPreference.BELOW */ );
    }
    getLayoutInfo() {
        const fontInfo = this.editor.getOption(50 /* EditorOption.fontInfo */ );
        const itemHeight = (0, $7mO4b.clamp)(this.editor.getOption(121 /* EditorOption.suggestLineHeight */ ) || fontInfo.lineHeight, 8, 1000);
        const statusBarHeight = !this.editor.getOption(119 /* EditorOption.suggest */ ).showStatusBar || this._state === 2 /* State.Empty */  || this._state === 1 /* State.Loading */  ? 0 : itemHeight;
        const borderWidth = this._details.widget.borderWidth;
        const borderHeight = 2 * borderWidth;
        return {
            itemHeight: itemHeight,
            statusBarHeight: statusBarHeight,
            borderWidth: borderWidth,
            borderHeight: borderHeight,
            typicalHalfwidthCharacterWidth: fontInfo.typicalHalfwidthCharacterWidth,
            verticalPadding: 22,
            horizontalPadding: 14,
            defaultSize: new $bDzmQ.Dimension(430, statusBarHeight + 12 * itemHeight + borderHeight)
        };
    }
    _isDetailsVisible() {
        return this._storageService.getBoolean('expandSuggestionDocs', 0 /* StorageScope.PROFILE */ , false);
    }
    _setDetailsVisible(value) {
        this._storageService.store('expandSuggestionDocs', value, 0 /* StorageScope.PROFILE */ , 0 /* StorageTarget.USER */ );
    }
    forceRenderingAbove() {
        if (!this._forceRenderingAbove) {
            this._forceRenderingAbove = true;
            this._layout(this._persistedSize.restore());
        }
    }
    stopForceRenderingAbove() {
        this._forceRenderingAbove = false;
    }
};
$b4bf71a7a107deba$export$ad1808d575fcd49b = $b4bf71a7a107deba$var$SuggestWidget_1 = $b4bf71a7a107deba$var$__decorate([
    $b4bf71a7a107deba$var$__param(1, (0, $2AUoS.IStorageService)),
    $b4bf71a7a107deba$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $b4bf71a7a107deba$var$__param(3, (0, $azIPz.IThemeService)),
    $b4bf71a7a107deba$var$__param(4, (0, $fdGPu.IInstantiationService))
], $b4bf71a7a107deba$export$ad1808d575fcd49b);
class $b4bf71a7a107deba$export$335c575f116d83ac {
    constructor(_widget, _editor){
        this._widget = _widget;
        this._editor = _editor;
        this.allowEditorOverflow = true;
        this.suppressMouseDown = false;
        this._preferenceLocked = false;
        this._added = false;
        this._hidden = false;
    }
    dispose() {
        if (this._added) {
            this._added = false;
            this._editor.removeContentWidget(this);
        }
    }
    getId() {
        return 'editor.widget.suggestWidget';
    }
    getDomNode() {
        return this._widget.element.domNode;
    }
    show() {
        this._hidden = false;
        if (!this._added) {
            this._added = true;
            this._editor.addContentWidget(this);
        }
    }
    hide() {
        if (!this._hidden) {
            this._hidden = true;
            this.layout();
        }
    }
    layout() {
        this._editor.layoutContentWidget(this);
    }
    getPosition() {
        if (this._hidden || !this._position || !this._preference) return null;
        return {
            position: this._position,
            preference: [
                this._preference
            ]
        };
    }
    beforeRender() {
        const { height: height, width: width } = this._widget.element.size;
        const { borderWidth: borderWidth, horizontalPadding: horizontalPadding } = this._widget.getLayoutInfo();
        return new $bDzmQ.Dimension(width + 2 * borderWidth + horizontalPadding, height + 2 * borderWidth);
    }
    afterRender(position) {
        this._widget._afterRender(position);
    }
    setPreference(preference) {
        if (!this._preferenceLocked) this._preference = preference;
    }
    lockPreference() {
        this._preferenceLocked = true;
    }
    unlockPreference() {
        this._preferenceLocked = false;
    }
    setPosition(position) {
        this._position = position;
    }
}



var $lMGba = parcelRequire("lMGba");

var $5Aea5 = parcelRequire("5Aea5");

var $n7820 = parcelRequire("n7820");

var $bDzmQ = parcelRequire("bDzmQ");

var $91ntV = parcelRequire("91ntV");
var $0dadf7fc8f08a569$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $0dadf7fc8f08a569$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $0dadf7fc8f08a569$var$SuggestController_1;
// sticky suggest widget which doesn't disappear on focus out and such
const $0dadf7fc8f08a569$var$_sticky = false;
class $0dadf7fc8f08a569$var$LineSuffix {
    constructor(_model, _position){
        this._model = _model;
        this._position = _position;
        this._decorationOptions = (0, $91ntV.ModelDecorationOptions).register({
            description: 'suggest-line-suffix',
            stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ 
        });
        // spy on what's happening right of the cursor. two cases:
        // 1. end of line -> check that it's still end of line
        // 2. mid of line -> add a marker and compute the delta
        const maxColumn = _model.getLineMaxColumn(_position.lineNumber);
        if (maxColumn !== _position.column) {
            const offset = _model.getOffsetAt(_position);
            const end = _model.getPositionAt(offset + 1);
            _model.changeDecorations((accessor)=>{
                if (this._marker) accessor.removeDecoration(this._marker);
                this._marker = accessor.addDecoration((0, $d00il.Range).fromPositions(_position, end), this._decorationOptions);
            });
        }
    }
    dispose() {
        if (this._marker && !this._model.isDisposed()) this._model.changeDecorations((accessor)=>{
            accessor.removeDecoration(this._marker);
            this._marker = undefined;
        });
    }
    delta(position) {
        if (this._model.isDisposed() || this._position.lineNumber !== position.lineNumber) // bail out early if things seems fishy
        return 0;
        // read the marker (in case suggest was triggered at line end) or compare
        // the cursor to the line end.
        if (this._marker) {
            const range = this._model.getDecorationRange(this._marker);
            const end = this._model.getOffsetAt(range.getStartPosition());
            return end - this._model.getOffsetAt(position);
        } else return this._model.getLineMaxColumn(position.lineNumber) - position.column;
    }
}
let $0dadf7fc8f08a569$export$54e1189006f2eb3a = class SuggestController {
    static{
        $0dadf7fc8f08a569$var$SuggestController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.suggestController';
    }
    static get(editor) {
        return editor.getContribution($0dadf7fc8f08a569$var$SuggestController_1.ID);
    }
    constructor(editor, _memoryService, _commandService, _contextKeyService, _instantiationService, _logService, _telemetryService){
        this._memoryService = _memoryService;
        this._commandService = _commandService;
        this._contextKeyService = _contextKeyService;
        this._instantiationService = _instantiationService;
        this._logService = _logService;
        this._telemetryService = _telemetryService;
        this._lineSuffix = new (0, $9cWcn.MutableDisposable)();
        this._toDispose = new (0, $9cWcn.DisposableStore)();
        this._selectors = new $0dadf7fc8f08a569$var$PriorityRegistry((s)=>s.priority);
        this._onWillInsertSuggestItem = new (0, $5YaSO.Emitter)();
        this.onWillInsertSuggestItem = this._onWillInsertSuggestItem.event;
        this.editor = editor;
        this.model = _instantiationService.createInstance((0, $c647ef64fb80ec19$export$bd6d3a37695095d5), this.editor);
        // default selector
        this._selectors.register({
            priority: 0,
            select: (model, pos, items)=>this._memoryService.select(model, pos, items)
        });
        // context key: update insert/replace mode
        const ctxInsertMode = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).InsertMode.bindTo(_contextKeyService);
        ctxInsertMode.set(editor.getOption(119 /* EditorOption.suggest */ ).insertMode);
        this._toDispose.add(this.model.onDidTrigger(()=>ctxInsertMode.set(editor.getOption(119 /* EditorOption.suggest */ ).insertMode)));
        this.widget = this._toDispose.add(new (0, $bDzmQ.WindowIdleValue)((0, $bDzmQ.getWindow)(editor.getDomNode()), ()=>{
            const widget = this._instantiationService.createInstance((0, $b4bf71a7a107deba$export$ad1808d575fcd49b), this.editor);
            this._toDispose.add(widget);
            this._toDispose.add(widget.onDidSelect((item)=>this._insertSuggestion(item, 0 /* InsertFlags.None */ ), this));
            // Wire up logic to accept a suggestion on certain characters
            const commitCharacterController = new (0, $b9fb9562f95d2dbc$export$1c5a4637a8cc1b47)(this.editor, widget, this.model, (item)=>this._insertSuggestion(item, 2 /* InsertFlags.NoAfterUndoStop */ ));
            this._toDispose.add(commitCharacterController);
            // Wire up makes text edit context key
            const ctxMakesTextEdit = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MakesTextEdit.bindTo(this._contextKeyService);
            const ctxHasInsertAndReplace = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasInsertAndReplaceRange.bindTo(this._contextKeyService);
            const ctxCanResolve = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).CanResolve.bindTo(this._contextKeyService);
            this._toDispose.add((0, $9cWcn.toDisposable)(()=>{
                ctxMakesTextEdit.reset();
                ctxHasInsertAndReplace.reset();
                ctxCanResolve.reset();
            }));
            this._toDispose.add(widget.onDidFocus(({ item: item })=>{
                // (ctx: makesTextEdit)
                const position = this.editor.getPosition();
                const startColumn = item.editStart.column;
                const endColumn = position.column;
                let value = true;
                if (this.editor.getOption(1 /* EditorOption.acceptSuggestionOnEnter */ ) === 'smart' && this.model.state === 2 /* State.Auto */  && !item.completion.additionalTextEdits && !(item.completion.insertTextRules & 4 /* CompletionItemInsertTextRule.InsertAsSnippet */ ) && endColumn - startColumn === item.completion.insertText.length) {
                    const oldText = this.editor.getModel().getValueInRange({
                        startLineNumber: position.lineNumber,
                        startColumn: startColumn,
                        endLineNumber: position.lineNumber,
                        endColumn: endColumn
                    });
                    value = oldText !== item.completion.insertText;
                }
                ctxMakesTextEdit.set(value);
                // (ctx: hasInsertAndReplaceRange)
                ctxHasInsertAndReplace.set(!(0, $dcxQ7.Position).equals(item.editInsertEnd, item.editReplaceEnd));
                // (ctx: canResolve)
                ctxCanResolve.set(Boolean(item.provider.resolveCompletionItem) || Boolean(item.completion.documentation) || item.completion.detail !== item.completion.label);
            }));
            this._toDispose.add(widget.onDetailsKeyDown((e)=>{
                // cmd + c on macOS, ctrl + c on Win / Linux
                if (e.toKeyCodeChord().equals(new (0, $cU88k.KeyCodeChord)(true, false, false, false, 33 /* KeyCode.KeyC */ )) || $lb0Ah.isMacintosh && e.toKeyCodeChord().equals(new (0, $cU88k.KeyCodeChord)(false, false, false, true, 33 /* KeyCode.KeyC */ ))) {
                    e.stopPropagation();
                    return;
                }
                if (!e.toKeyCodeChord().isModifierKey()) this.editor.focus();
            }));
            return widget;
        }));
        // Wire up text overtyping capture
        this._overtypingCapturer = this._toDispose.add(new (0, $bDzmQ.WindowIdleValue)((0, $bDzmQ.getWindow)(editor.getDomNode()), ()=>{
            return this._toDispose.add(new (0, $7a52ec4cd6f9707a$export$4f0a10c40326a303)(this.editor, this.model));
        }));
        this._alternatives = this._toDispose.add(new (0, $bDzmQ.WindowIdleValue)((0, $bDzmQ.getWindow)(editor.getDomNode()), ()=>{
            return this._toDispose.add(new (0, $bb52a3f8a2ff4d4e$export$26081dcda3428b4d)(this.editor, this._contextKeyService));
        }));
        this._toDispose.add(_instantiationService.createInstance((0, $a4dbe5e677ee3b54$export$f4d1b9d63b237092), editor));
        this._toDispose.add(this.model.onDidTrigger((e)=>{
            this.widget.value.showTriggered(e.auto, e.shy ? 250 : 50);
            this._lineSuffix.value = new $0dadf7fc8f08a569$var$LineSuffix(this.editor.getModel(), e.position);
        }));
        this._toDispose.add(this.model.onDidSuggest((e)=>{
            if (e.triggerOptions.shy) return;
            let index = -1;
            for (const selector of this._selectors.itemsOrderedByPriorityDesc){
                index = selector.select(this.editor.getModel(), this.editor.getPosition(), e.completionModel.items);
                if (index !== -1) break;
            }
            if (index === -1) index = 0;
            if (this.model.state === 0 /* State.Idle */ ) // selecting an item can "pump" out selection/cursor change events
            // which can cancel suggest halfway through this function. therefore
            // we need to check again and bail if the session has been canceled
            return;
            let noFocus = false;
            if (e.triggerOptions.auto) {
                // don't "focus" item when configured to do
                const options = this.editor.getOption(119 /* EditorOption.suggest */ );
                if (options.selectionMode === 'never' || options.selectionMode === 'always') // simple: always or never
                noFocus = options.selectionMode === 'never';
                else if (options.selectionMode === 'whenTriggerCharacter') // on with trigger character
                noFocus = e.triggerOptions.triggerKind !== 1 /* CompletionTriggerKind.TriggerCharacter */ ;
                else if (options.selectionMode === 'whenQuickSuggestion') // without trigger character or when refiltering
                noFocus = e.triggerOptions.triggerKind === 1 /* CompletionTriggerKind.TriggerCharacter */  && !e.triggerOptions.refilter;
            }
            this.widget.value.showSuggestions(e.completionModel, index, e.isFrozen, e.triggerOptions.auto, noFocus);
        }));
        this._toDispose.add(this.model.onDidCancel((e)=>{
            if (!e.retrigger) this.widget.value.hideWidget();
        }));
        this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{
            if (!$0dadf7fc8f08a569$var$_sticky) {
                this.model.cancel();
                this.model.clear();
            }
        }));
        // Manage the acceptSuggestionsOnEnter context key
        const acceptSuggestionsOnEnter = (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).AcceptSuggestionsOnEnter.bindTo(_contextKeyService);
        const updateFromConfig = ()=>{
            const acceptSuggestionOnEnter = this.editor.getOption(1 /* EditorOption.acceptSuggestionOnEnter */ );
            acceptSuggestionsOnEnter.set(acceptSuggestionOnEnter === 'on' || acceptSuggestionOnEnter === 'smart');
        };
        this._toDispose.add(this.editor.onDidChangeConfiguration(()=>updateFromConfig()));
        updateFromConfig();
    }
    dispose() {
        this._alternatives.dispose();
        this._toDispose.dispose();
        this.widget.dispose();
        this.model.dispose();
        this._lineSuffix.dispose();
        this._onWillInsertSuggestItem.dispose();
    }
    _insertSuggestion(event, flags) {
        if (!event || !event.item) {
            this._alternatives.value.reset();
            this.model.cancel();
            this.model.clear();
            return;
        }
        if (!this.editor.hasModel()) return;
        const snippetController = (0, $3a01f53014eb6282$export$d27b4f7e5ea418b0).get(this.editor);
        if (!snippetController) return;
        this._onWillInsertSuggestItem.fire({
            item: event.item
        });
        const model = this.editor.getModel();
        const modelVersionNow = model.getAlternativeVersionId();
        const { item: item } = event;
        //
        const tasks = [];
        const cts = new (0, $giPcZ.CancellationTokenSource)();
        // pushing undo stops *before* additional text edits and
        // *after* the main edit
        if (!(flags & 1 /* InsertFlags.NoBeforeUndoStop */ )) this.editor.pushUndoStop();
        // compute overwrite[Before|After] deltas BEFORE applying extra edits
        const info = this.getOverwriteInfo(item, Boolean(flags & 8 /* InsertFlags.AlternativeOverwriteConfig */ ));
        // keep item in memory
        this._memoryService.memorize(model, this.editor.getPosition(), item);
        const isResolved = item.isResolved;
        // telemetry data points: duration of command execution, info about async additional edits (-1=n/a, -2=none, 1=success, 0=failed)
        let _commandExectionDuration = -1;
        let _additionalEditsAppliedAsync = -1;
        if (Array.isArray(item.completion.additionalTextEdits)) {
            // cancel -> stops all listening and closes widget
            this.model.cancel();
            // sync additional edits
            const scrollState = (0, $1RlHY.StableEditorScrollState).capture(this.editor);
            this.editor.executeEdits('suggestController.additionalTextEdits.sync', item.completion.additionalTextEdits.map((edit)=>{
                let range = (0, $d00il.Range).lift(edit.range);
                if (range.startLineNumber === item.position.lineNumber && range.startColumn > item.position.column) {
                    // shift additional edit when it is "after" the completion insertion position
                    const columnDelta = this.editor.getPosition().column - item.position.column;
                    const startColumnDelta = columnDelta;
                    const endColumnDelta = (0, $d00il.Range).spansMultipleLines(range) ? 0 : columnDelta;
                    range = new (0, $d00il.Range)(range.startLineNumber, range.startColumn + startColumnDelta, range.endLineNumber, range.endColumn + endColumnDelta);
                }
                return (0, $kHJv6.EditOperation).replaceMove(range, edit.text);
            }));
            scrollState.restoreRelativeVerticalPositionOfCursor(this.editor);
        } else if (!isResolved) {
            // async additional edits
            const sw = new (0, $eUQTM.StopWatch)();
            let position;
            const docListener = model.onDidChangeContent((e)=>{
                if (e.isFlush) {
                    cts.cancel();
                    docListener.dispose();
                    return;
                }
                for (const change of e.changes){
                    const thisPosition = (0, $d00il.Range).getEndPosition(change.range);
                    if (!position || (0, $dcxQ7.Position).isBefore(thisPosition, position)) position = thisPosition;
                }
            });
            const oldFlags = flags;
            flags |= 2 /* InsertFlags.NoAfterUndoStop */ ;
            let didType = false;
            const typeListener = this.editor.onWillType(()=>{
                typeListener.dispose();
                didType = true;
                if (!(oldFlags & 2 /* InsertFlags.NoAfterUndoStop */ )) this.editor.pushUndoStop();
            });
            tasks.push(item.resolve(cts.token).then(()=>{
                if (!item.completion.additionalTextEdits || cts.token.isCancellationRequested) return undefined;
                if (position && item.completion.additionalTextEdits.some((edit)=>(0, $dcxQ7.Position).isBefore(position, (0, $d00il.Range).getStartPosition(edit.range)))) return false;
                if (didType) this.editor.pushUndoStop();
                const scrollState = (0, $1RlHY.StableEditorScrollState).capture(this.editor);
                this.editor.executeEdits('suggestController.additionalTextEdits.async', item.completion.additionalTextEdits.map((edit)=>(0, $kHJv6.EditOperation).replaceMove((0, $d00il.Range).lift(edit.range), edit.text)));
                scrollState.restoreRelativeVerticalPositionOfCursor(this.editor);
                if (didType || !(oldFlags & 2 /* InsertFlags.NoAfterUndoStop */ )) this.editor.pushUndoStop();
                return true;
            }).then((applied)=>{
                this._logService.trace('[suggest] async resolving of edits DONE (ms, applied?)', sw.elapsed(), applied);
                _additionalEditsAppliedAsync = applied === true ? 1 : applied === false ? 0 : -2;
            }).finally(()=>{
                docListener.dispose();
                typeListener.dispose();
            }));
        }
        let { insertText: insertText } = item.completion;
        if (!(item.completion.insertTextRules & 4 /* CompletionItemInsertTextRule.InsertAsSnippet */ )) insertText = (0, $464b8f1057bff784$export$e073bfe8583e8fbf).escape(insertText);
        // cancel -> stops all listening and closes widget
        this.model.cancel();
        snippetController.insert(insertText, {
            overwriteBefore: info.overwriteBefore,
            overwriteAfter: info.overwriteAfter,
            undoStopBefore: false,
            undoStopAfter: false,
            adjustWhitespace: !(item.completion.insertTextRules & 1 /* CompletionItemInsertTextRule.KeepWhitespace */ ),
            clipboardText: event.model.clipboardText,
            overtypingCapturer: this._overtypingCapturer.value
        });
        if (!(flags & 2 /* InsertFlags.NoAfterUndoStop */ )) this.editor.pushUndoStop();
        if (item.completion.command) {
            if (item.completion.command.id === $0dadf7fc8f08a569$export$6adf569aad8e1b71.id) // retigger
            this.model.trigger({
                auto: true,
                retrigger: true
            });
            else {
                // exec command, done
                const sw = new (0, $eUQTM.StopWatch)();
                tasks.push(this._commandService.executeCommand(item.completion.command.id, ...item.completion.command.arguments ? [
                    ...item.completion.command.arguments
                ] : []).catch((e)=>{
                    if (item.completion.extensionId) (0, $gPkHZ.onUnexpectedExternalError)(e);
                    else (0, $gPkHZ.onUnexpectedError)(e);
                }).finally(()=>{
                    _commandExectionDuration = sw.elapsed();
                }));
            }
        }
        if (flags & 4 /* InsertFlags.KeepAlternativeSuggestions */ ) this._alternatives.value.set(event, (next)=>{
            // cancel resolving of additional edits
            cts.cancel();
            // this is not so pretty. when inserting the 'next'
            // suggestion we undo until we are at the state at
            // which we were before inserting the previous suggestion...
            while(model.canUndo()){
                if (modelVersionNow !== model.getAlternativeVersionId()) model.undo();
                this._insertSuggestion(next, 3 /* InsertFlags.NoAfterUndoStop */  | (flags & 8 /* InsertFlags.AlternativeOverwriteConfig */  ? 8 /* InsertFlags.AlternativeOverwriteConfig */  : 0));
                break;
            }
        });
        this._alertCompletionItem(item);
        // clear only now - after all tasks are done
        Promise.all(tasks).finally(()=>{
            this._reportSuggestionAcceptedTelemetry(item, model, isResolved, _commandExectionDuration, _additionalEditsAppliedAsync, event.index, event.model.items);
            this.model.clear();
            cts.dispose();
        });
    }
    _reportSuggestionAcceptedTelemetry(item, model, itemResolved, commandExectionDuration, additionalEditsAppliedAsync, index, completionItems) {
        if (Math.floor(Math.random() * 100) === 0) // throttle telemetry event because accepting completions happens a lot
        return;
        const labelMap = new Map();
        for(let i = 0; i < Math.min(30, completionItems.length); i++){
            const label = completionItems[i].textLabel;
            if (labelMap.has(label)) labelMap.get(label).push(i);
            else labelMap.set(label, [
                i
            ]);
        }
        const firstIndexArray = labelMap.get(item.textLabel);
        const hasDuplicates = firstIndexArray && firstIndexArray.length > 1;
        const firstIndex = hasDuplicates ? firstIndexArray[0] : -1;
        this._telemetryService.publicLog2('suggest.acceptedSuggestion', {
            extensionId: item.extensionId?.value ?? 'unknown',
            providerId: item.provider._debugDisplayName ?? 'unknown',
            kind: item.completion.kind,
            basenameHash: (0, $n7820.hash)((0, $5Aea5.basename)(model.uri)).toString(16),
            languageId: model.getLanguageId(),
            fileExtension: (0, $5Aea5.extname)(model.uri),
            resolveInfo: !item.provider.resolveCompletionItem ? -1 : itemResolved ? 1 : 0,
            resolveDuration: item.resolveDuration,
            commandDuration: commandExectionDuration,
            additionalEditsAsync: additionalEditsAppliedAsync,
            index: index,
            firstIndex: firstIndex
        });
    }
    getOverwriteInfo(item, toggleMode) {
        (0, $bxBg7.assertType)(this.editor.hasModel());
        let replace = this.editor.getOption(119 /* EditorOption.suggest */ ).insertMode === 'replace';
        if (toggleMode) replace = !replace;
        const overwriteBefore = item.position.column - item.editStart.column;
        const overwriteAfter = (replace ? item.editReplaceEnd.column : item.editInsertEnd.column) - item.position.column;
        const columnDelta = this.editor.getPosition().column - item.position.column;
        const suffixDelta = this._lineSuffix.value ? this._lineSuffix.value.delta(this.editor.getPosition()) : 0;
        return {
            overwriteBefore: overwriteBefore + columnDelta,
            overwriteAfter: overwriteAfter + suffixDelta
        };
    }
    _alertCompletionItem(item) {
        if ((0, $kJ8UG.isNonEmptyArray)(item.completion.additionalTextEdits)) {
            const msg = $4dEdH.localize('aria.alert.snippet', "Accepting '{0}' made {1} additional edits", item.textLabel, item.completion.additionalTextEdits.length);
            (0, $aIbUW.alert)(msg);
        }
    }
    triggerSuggest(onlyFrom, auto, noFilter) {
        if (this.editor.hasModel()) {
            this.model.trigger({
                auto: auto ?? false,
                completionOptions: {
                    providerFilter: onlyFrom,
                    kindFilter: noFilter ? new Set() : undefined
                }
            });
            this.editor.revealPosition(this.editor.getPosition(), 0 /* ScrollType.Smooth */ );
            this.editor.focus();
        }
    }
    triggerSuggestAndAcceptBest(arg) {
        if (!this.editor.hasModel()) return;
        const positionNow = this.editor.getPosition();
        const fallback = ()=>{
            if (positionNow.equals(this.editor.getPosition())) this._commandService.executeCommand(arg.fallback);
        };
        const makesTextEdit = (item)=>{
            if (item.completion.insertTextRules & 4 /* CompletionItemInsertTextRule.InsertAsSnippet */  || item.completion.additionalTextEdits) // snippet, other editor -> makes edit
            return true;
            const position = this.editor.getPosition();
            const startColumn = item.editStart.column;
            const endColumn = position.column;
            if (endColumn - startColumn !== item.completion.insertText.length) // unequal lengths -> makes edit
            return true;
            const textNow = this.editor.getModel().getValueInRange({
                startLineNumber: position.lineNumber,
                startColumn: startColumn,
                endLineNumber: position.lineNumber,
                endColumn: endColumn
            });
            // unequal text -> makes edit
            return textNow !== item.completion.insertText;
        };
        (0, $5YaSO.Event).once(this.model.onDidTrigger)((_)=>{
            // wait for trigger because only then the cancel-event is trustworthy
            const listener = [];
            (0, $5YaSO.Event).any(this.model.onDidTrigger, this.model.onDidCancel)(()=>{
                // retrigger or cancel -> try to type default text
                (0, $9cWcn.dispose)(listener);
                fallback();
            }, undefined, listener);
            this.model.onDidSuggest(({ completionModel: completionModel })=>{
                (0, $9cWcn.dispose)(listener);
                if (completionModel.items.length === 0) {
                    fallback();
                    return;
                }
                const index = this._memoryService.select(this.editor.getModel(), this.editor.getPosition(), completionModel.items);
                const item = completionModel.items[index];
                if (!makesTextEdit(item)) {
                    fallback();
                    return;
                }
                this.editor.pushUndoStop();
                this._insertSuggestion({
                    index: index,
                    item: item,
                    model: completionModel
                }, 7 /* InsertFlags.NoAfterUndoStop */ );
            }, undefined, listener);
        });
        this.model.trigger({
            auto: false,
            shy: true
        });
        this.editor.revealPosition(positionNow, 0 /* ScrollType.Smooth */ );
        this.editor.focus();
    }
    acceptSelectedSuggestion(keepAlternativeSuggestions, alternativeOverwriteConfig) {
        const item = this.widget.value.getFocusedItem();
        let flags = 0;
        if (keepAlternativeSuggestions) flags |= 4 /* InsertFlags.KeepAlternativeSuggestions */ ;
        if (alternativeOverwriteConfig) flags |= 8 /* InsertFlags.AlternativeOverwriteConfig */ ;
        this._insertSuggestion(item, flags);
    }
    acceptNextSuggestion() {
        this._alternatives.value.next();
    }
    acceptPrevSuggestion() {
        this._alternatives.value.prev();
    }
    cancelSuggestWidget() {
        this.model.cancel();
        this.model.clear();
        this.widget.value.hideWidget();
    }
    focusSuggestion() {
        this.widget.value.focusSelected();
    }
    selectNextSuggestion() {
        this.widget.value.selectNext();
    }
    selectNextPageSuggestion() {
        this.widget.value.selectNextPage();
    }
    selectLastSuggestion() {
        this.widget.value.selectLast();
    }
    selectPrevSuggestion() {
        this.widget.value.selectPrevious();
    }
    selectPrevPageSuggestion() {
        this.widget.value.selectPreviousPage();
    }
    selectFirstSuggestion() {
        this.widget.value.selectFirst();
    }
    toggleSuggestionDetails() {
        this.widget.value.toggleDetails();
    }
    toggleExplainMode() {
        this.widget.value.toggleExplainMode();
    }
    toggleSuggestionFocus() {
        this.widget.value.toggleDetailsFocus();
    }
    resetWidgetSize() {
        this.widget.value.resetPersistedSize();
    }
    forceRenderingAbove() {
        this.widget.value.forceRenderingAbove();
    }
    stopForceRenderingAbove() {
        if (!this.widget.isInitialized) // This method has no effect if the widget is not initialized yet.
        return;
        this.widget.value.stopForceRenderingAbove();
    }
    registerSelector(selector) {
        return this._selectors.register(selector);
    }
};
$0dadf7fc8f08a569$export$54e1189006f2eb3a = $0dadf7fc8f08a569$var$SuggestController_1 = $0dadf7fc8f08a569$var$__decorate([
    $0dadf7fc8f08a569$var$__param(1, (0, $3137e0e4318e8557$export$d66aa79ce7d9c867)),
    $0dadf7fc8f08a569$var$__param(2, (0, $8tcMz.ICommandService)),
    $0dadf7fc8f08a569$var$__param(3, (0, $cxCeF.IContextKeyService)),
    $0dadf7fc8f08a569$var$__param(4, (0, $fdGPu.IInstantiationService)),
    $0dadf7fc8f08a569$var$__param(5, (0, $dvEeB.ILogService)),
    $0dadf7fc8f08a569$var$__param(6, (0, $lMGba.ITelemetryService))
], $0dadf7fc8f08a569$export$54e1189006f2eb3a);
class $0dadf7fc8f08a569$var$PriorityRegistry {
    constructor(prioritySelector){
        this.prioritySelector = prioritySelector;
        this._items = new Array();
    }
    register(value) {
        if (this._items.indexOf(value) !== -1) throw new Error('Value is already registered');
        this._items.push(value);
        this._items.sort((s1, s2)=>this.prioritySelector(s2) - this.prioritySelector(s1));
        return {
            dispose: ()=>{
                const idx = this._items.indexOf(value);
                if (idx >= 0) this._items.splice(idx, 1);
            }
        };
    }
    get itemsOrderedByPriorityDesc() {
        return this._items;
    }
}
class $0dadf7fc8f08a569$export$6adf569aad8e1b71 extends (0, $2iJTi.EditorAction) {
    static{
        this.id = 'editor.action.triggerSuggest';
    }
    constructor(){
        super({
            id: $0dadf7fc8f08a569$export$6adf569aad8e1b71.id,
            label: $4dEdH.localize('suggest.trigger.label', "Trigger Suggest"),
            alias: 'Trigger Suggest',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasCompletionItemProvider, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible.toNegated()),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 2058 /* KeyCode.Space */ ,
                secondary: [
                    2087 /* KeyCode.KeyI */ 
                ],
                mac: {
                    primary: 266 /* KeyCode.Space */ ,
                    secondary: [
                        521 /* KeyCode.Escape */ ,
                        2087 /* KeyCode.KeyI */ 
                    ]
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor, args) {
        const controller = $0dadf7fc8f08a569$export$54e1189006f2eb3a.get(editor);
        if (!controller) return;
        let auto;
        if (args && typeof args === 'object') {
            if (args.auto === true) auto = true;
        }
        controller.triggerSuggest(undefined, auto, undefined);
    }
}
(0, $2iJTi.registerEditorContribution)($0dadf7fc8f08a569$export$54e1189006f2eb3a.ID, $0dadf7fc8f08a569$export$54e1189006f2eb3a, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorAction)($0dadf7fc8f08a569$export$6adf569aad8e1b71);
const $0dadf7fc8f08a569$var$weight = 190;
const $0dadf7fc8f08a569$var$SuggestCommand = (0, $2iJTi.EditorCommand).bindToContribution($0dadf7fc8f08a569$export$54e1189006f2eb3a.get);
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'acceptSelectedSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion),
    handler (x) {
        x.acceptSelectedSuggestion(true, false);
    },
    kbOpts: [
        {
            // normal tab
            primary: 2 /* KeyCode.Tab */ ,
            kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $ibKGQ.EditorContextKeys).textInputFocus),
            weight: $0dadf7fc8f08a569$var$weight
        },
        {
            // accept on enter has special rules
            primary: 3 /* KeyCode.Enter */ ,
            kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).AcceptSuggestionsOnEnter, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MakesTextEdit),
            weight: $0dadf7fc8f08a569$var$weight
        }
    ],
    menuOpts: [
        {
            menuId: (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab),
            title: $4dEdH.localize('accept.insert', "Insert"),
            group: 'left',
            order: 1,
            when: (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasInsertAndReplaceRange.toNegated()
        },
        {
            menuId: (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab),
            title: $4dEdH.localize('accept.insert', "Insert"),
            group: 'left',
            order: 1,
            when: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasInsertAndReplaceRange, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).InsertMode.isEqualTo('insert'))
        },
        {
            menuId: (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab),
            title: $4dEdH.localize('accept.replace', "Replace"),
            group: 'left',
            order: 1,
            when: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasInsertAndReplaceRange, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).InsertMode.isEqualTo('replace'))
        }
    ]
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'acceptAlternativeSelectedSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 1027 /* KeyCode.Enter */ ,
        secondary: [
            1026 /* KeyCode.Tab */ 
        ]
    },
    handler (x) {
        x.acceptSelectedSuggestion(false, true);
    },
    menuOpts: [
        {
            menuId: (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab),
            group: 'left',
            order: 2,
            when: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasInsertAndReplaceRange, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).InsertMode.isEqualTo('insert')),
            title: $4dEdH.localize('accept.replace', "Replace")
        },
        {
            menuId: (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab),
            group: 'left',
            order: 2,
            when: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasInsertAndReplaceRange, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).InsertMode.isEqualTo('replace')),
            title: $4dEdH.localize('accept.insert', "Insert")
        }
    ]
}));
// continue to support the old command
(0, $8tcMz.CommandsRegistry).registerCommandAlias('acceptSelectedSuggestionOnEnter', 'acceptSelectedSuggestion');
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'hideSuggestWidget',
    precondition: (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible,
    handler: (x)=>x.cancelSuggestWidget(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 9 /* KeyCode.Escape */ ,
        secondary: [
            1033 /* KeyCode.Escape */ 
        ]
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'selectNextSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $cxCeF.ContextKeyExpr).or((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MultipleSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate())),
    handler: (c)=>c.selectNextSuggestion(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 18 /* KeyCode.DownArrow */ ,
        secondary: [
            2066 /* KeyCode.DownArrow */ 
        ],
        mac: {
            primary: 18 /* KeyCode.DownArrow */ ,
            secondary: [
                2066 /* KeyCode.DownArrow */ ,
                300 /* KeyCode.KeyN */ 
            ]
        }
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'selectNextPageSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $cxCeF.ContextKeyExpr).or((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MultipleSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate())),
    handler: (c)=>c.selectNextPageSuggestion(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 12 /* KeyCode.PageDown */ ,
        secondary: [
            2060 /* KeyCode.PageDown */ 
        ]
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'selectLastSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $cxCeF.ContextKeyExpr).or((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MultipleSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate())),
    handler: (c)=>c.selectLastSuggestion()
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'selectPrevSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $cxCeF.ContextKeyExpr).or((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MultipleSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate())),
    handler: (c)=>c.selectPrevSuggestion(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 16 /* KeyCode.UpArrow */ ,
        secondary: [
            2064 /* KeyCode.UpArrow */ 
        ],
        mac: {
            primary: 16 /* KeyCode.UpArrow */ ,
            secondary: [
                2064 /* KeyCode.UpArrow */ ,
                302 /* KeyCode.KeyP */ 
            ]
        }
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'selectPrevPageSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $cxCeF.ContextKeyExpr).or((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MultipleSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate())),
    handler: (c)=>c.selectPrevPageSuggestion(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 11 /* KeyCode.PageUp */ ,
        secondary: [
            2059 /* KeyCode.PageUp */ 
        ]
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'selectFirstSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $cxCeF.ContextKeyExpr).or((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).MultipleSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate())),
    handler: (c)=>c.selectFirstSuggestion()
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'focusSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate()),
    handler: (x)=>x.focusSuggestion(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 2058 /* KeyCode.Space */ ,
        secondary: [
            2087 /* KeyCode.KeyI */ 
        ],
        mac: {
            primary: 266 /* KeyCode.Space */ ,
            secondary: [
                2087 /* KeyCode.KeyI */ 
            ]
        }
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'focusAndAcceptSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion.negate()),
    handler: (c)=>{
        c.focusSuggestion();
        c.acceptSelectedSuggestion(true, false);
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'toggleSuggestionDetails',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).HasFocusedSuggestion),
    handler: (x)=>x.toggleSuggestionDetails(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 2058 /* KeyCode.Space */ ,
        secondary: [
            2087 /* KeyCode.KeyI */ 
        ],
        mac: {
            primary: 266 /* KeyCode.Space */ ,
            secondary: [
                2087 /* KeyCode.KeyI */ 
            ]
        }
    },
    menuOpts: [
        {
            menuId: (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab),
            group: 'right',
            order: 1,
            when: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).DetailsVisible, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).CanResolve),
            title: $4dEdH.localize('detail.more', "Show Less")
        },
        {
            menuId: (0, $46671b3f02f7e7cd$export$c2ae6207654f3cab),
            group: 'right',
            order: 1,
            when: (0, $cxCeF.ContextKeyExpr).and((0, $46671b3f02f7e7cd$export$841858b892ce1f4c).DetailsVisible.toNegated(), (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).CanResolve),
            title: $4dEdH.localize('detail.less', "Show More")
        }
    ]
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'toggleExplainMode',
    precondition: (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible,
    handler: (x)=>x.toggleExplainMode(),
    kbOpts: {
        weight: 100 /* KeybindingWeight.EditorContrib */ ,
        primary: 2138 /* KeyCode.Slash */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'toggleSuggestionFocus',
    precondition: (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible,
    handler: (x)=>x.toggleSuggestionFocus(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 2570 /* KeyCode.Space */ ,
        mac: {
            primary: 778 /* KeyCode.Space */ 
        }
    }
}));
//#region tab completions
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'insertBestCompletion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $cxCeF.ContextKeyExpr).equals('config.editor.tabCompletion', 'on'), (0, $a4dbe5e677ee3b54$export$f4d1b9d63b237092).AtEnd, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible.toNegated(), (0, $bb52a3f8a2ff4d4e$export$26081dcda3428b4d).OtherSuggestions.toNegated(), (0, $3a01f53014eb6282$export$d27b4f7e5ea418b0).InSnippetMode.toNegated()),
    handler: (x, arg)=>{
        x.triggerSuggestAndAcceptBest((0, $bxBg7.isObject)(arg) ? {
            fallback: 'tab',
            ...arg
        } : {
            fallback: 'tab'
        });
    },
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        primary: 2 /* KeyCode.Tab */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'insertNextSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $cxCeF.ContextKeyExpr).equals('config.editor.tabCompletion', 'on'), (0, $bb52a3f8a2ff4d4e$export$26081dcda3428b4d).OtherSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible.toNegated(), (0, $3a01f53014eb6282$export$d27b4f7e5ea418b0).InSnippetMode.toNegated()),
    handler: (x)=>x.acceptNextSuggestion(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 2 /* KeyCode.Tab */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $0dadf7fc8f08a569$var$SuggestCommand({
    id: 'insertPrevSuggestion',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $cxCeF.ContextKeyExpr).equals('config.editor.tabCompletion', 'on'), (0, $bb52a3f8a2ff4d4e$export$26081dcda3428b4d).OtherSuggestions, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible.toNegated(), (0, $3a01f53014eb6282$export$d27b4f7e5ea418b0).InSnippetMode.toNegated()),
    handler: (x)=>x.acceptPrevSuggestion(),
    kbOpts: {
        weight: $0dadf7fc8f08a569$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
        primary: 1026 /* KeyCode.Tab */ 
    }
}));
(0, $2iJTi.registerEditorAction)(class extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.resetSuggestSize',
            label: $4dEdH.localize('suggest.reset.label', "Reset Suggest Widget Size"),
            alias: 'Reset Suggest Widget Size',
            precondition: undefined
        });
    }
    run(_accessor, editor) {
        $0dadf7fc8f08a569$export$54e1189006f2eb3a.get(editor)?.resetWidgetSize();
    }
});


class $d06d7e93c2969e4f$export$2878f71443bbeae8 extends (0, $9cWcn.Disposable) {
    get selectedItem() {
        return this._currentSuggestItemInfo;
    }
    constructor(editor, suggestControllerPreselector, onWillAccept){
        super();
        this.editor = editor;
        this.suggestControllerPreselector = suggestControllerPreselector;
        this.onWillAccept = onWillAccept;
        this.isSuggestWidgetVisible = false;
        this.isShiftKeyPressed = false;
        this._isActive = false;
        this._currentSuggestItemInfo = undefined;
        this._onDidSelectedItemChange = this._register(new (0, $5YaSO.Emitter)());
        this.onDidSelectedItemChange = this._onDidSelectedItemChange.event;
        // See the command acceptAlternativeSelectedSuggestion that is bound to shift+tab
        this._register(editor.onKeyDown((e)=>{
            if (e.shiftKey && !this.isShiftKeyPressed) {
                this.isShiftKeyPressed = true;
                this.update(this._isActive);
            }
        }));
        this._register(editor.onKeyUp((e)=>{
            if (e.shiftKey && this.isShiftKeyPressed) {
                this.isShiftKeyPressed = false;
                this.update(this._isActive);
            }
        }));
        const suggestController = (0, $0dadf7fc8f08a569$export$54e1189006f2eb3a).get(this.editor);
        if (suggestController) {
            this._register(suggestController.registerSelector({
                priority: 100,
                select: (model, pos, suggestItems)=>{
                    const textModel = this.editor.getModel();
                    if (!textModel) // Should not happen
                    return -1;
                    const i = this.suggestControllerPreselector();
                    const itemToPreselect = i ? (0, $d2b11f15de3b89fe$export$1204549eb57cd077)(i, textModel) : undefined;
                    if (!itemToPreselect) return -1;
                    const position = (0, $dcxQ7.Position).lift(pos);
                    const candidates = suggestItems.map((suggestItem, index)=>{
                        const suggestItemInfo = $d06d7e93c2969e4f$export$c777cb4d1b2cf7f4.fromSuggestion(suggestController, textModel, position, suggestItem, this.isShiftKeyPressed);
                        const suggestItemTextEdit = (0, $d2b11f15de3b89fe$export$1204549eb57cd077)(suggestItemInfo.toSingleTextEdit(), textModel);
                        const valid = (0, $d2b11f15de3b89fe$export$95e36a39a8b20bae)(itemToPreselect, suggestItemTextEdit);
                        return {
                            index: index,
                            valid: valid,
                            prefixLength: suggestItemTextEdit.text.length,
                            suggestItem: suggestItem
                        };
                    }).filter((item)=>item && item.valid && item.prefixLength > 0);
                    const result = (0, $7ysJc.findFirstMax)(candidates, (0, $kJ8UG.compareBy)((s)=>s.prefixLength, (0, $kJ8UG.numberComparator)));
                    return result ? result.index : -1;
                }
            }));
            let isBoundToSuggestWidget = false;
            const bindToSuggestWidget = ()=>{
                if (isBoundToSuggestWidget) return;
                isBoundToSuggestWidget = true;
                this._register(suggestController.widget.value.onDidShow(()=>{
                    this.isSuggestWidgetVisible = true;
                    this.update(true);
                }));
                this._register(suggestController.widget.value.onDidHide(()=>{
                    this.isSuggestWidgetVisible = false;
                    this.update(false);
                }));
                this._register(suggestController.widget.value.onDidFocus(()=>{
                    this.isSuggestWidgetVisible = true;
                    this.update(true);
                }));
            };
            this._register((0, $5YaSO.Event).once(suggestController.model.onDidTrigger)((e)=>{
                bindToSuggestWidget();
            }));
            this._register(suggestController.onWillInsertSuggestItem((e)=>{
                const position = this.editor.getPosition();
                const model = this.editor.getModel();
                if (!position || !model) return undefined;
                const suggestItemInfo = $d06d7e93c2969e4f$export$c777cb4d1b2cf7f4.fromSuggestion(suggestController, model, position, e.item, this.isShiftKeyPressed);
                this.onWillAccept(suggestItemInfo);
            }));
        }
        this.update(this._isActive);
    }
    update(newActive) {
        const newInlineCompletion = this.getSuggestItemInfo();
        if (this._isActive !== newActive || !$d06d7e93c2969e4f$var$suggestItemInfoEquals(this._currentSuggestItemInfo, newInlineCompletion)) {
            this._isActive = newActive;
            this._currentSuggestItemInfo = newInlineCompletion;
            this._onDidSelectedItemChange.fire();
        }
    }
    getSuggestItemInfo() {
        const suggestController = (0, $0dadf7fc8f08a569$export$54e1189006f2eb3a).get(this.editor);
        if (!suggestController || !this.isSuggestWidgetVisible) return undefined;
        const focusedItem = suggestController.widget.value.getFocusedItem();
        const position = this.editor.getPosition();
        const model = this.editor.getModel();
        if (!focusedItem || !position || !model) return undefined;
        return $d06d7e93c2969e4f$export$c777cb4d1b2cf7f4.fromSuggestion(suggestController, model, position, focusedItem.item, this.isShiftKeyPressed);
    }
    stopForceRenderingAbove() {
        const suggestController = (0, $0dadf7fc8f08a569$export$54e1189006f2eb3a).get(this.editor);
        suggestController?.stopForceRenderingAbove();
    }
    forceRenderingAbove() {
        const suggestController = (0, $0dadf7fc8f08a569$export$54e1189006f2eb3a).get(this.editor);
        suggestController?.forceRenderingAbove();
    }
}
class $d06d7e93c2969e4f$export$c777cb4d1b2cf7f4 {
    static fromSuggestion(suggestController, model, position, item, toggleMode) {
        let { insertText: insertText } = item.completion;
        let isSnippetText = false;
        if (item.completion.insertTextRules & 4 /* CompletionItemInsertTextRule.InsertAsSnippet */ ) {
            const snippet = new (0, $464b8f1057bff784$export$e073bfe8583e8fbf)().parse(insertText);
            if (snippet.children.length < 100) // Adjust whitespace is expensive.
            (0, $54ac6892e512fa7e$export$d334bb6e0f563f7).adjustWhitespace(model, position, true, snippet);
            insertText = snippet.toString();
            isSnippetText = true;
        }
        const info = suggestController.getOverwriteInfo(item, toggleMode);
        return new $d06d7e93c2969e4f$export$c777cb4d1b2cf7f4((0, $d00il.Range).fromPositions(position.delta(0, -info.overwriteBefore), position.delta(0, Math.max(info.overwriteAfter, 0))), insertText, item.completion.kind, isSnippetText);
    }
    constructor(range, insertText, completionItemKind, isSnippetText){
        this.range = range;
        this.insertText = insertText;
        this.completionItemKind = completionItemKind;
        this.isSnippetText = isSnippetText;
    }
    equals(other) {
        return this.range.equalsRange(other.range) && this.insertText === other.insertText && this.completionItemKind === other.completionItemKind && this.isSnippetText === other.isSnippetText;
    }
    toSelectedSuggestionInfo() {
        return new (0, $kzNQX.SelectedSuggestionInfo)(this.range, this.insertText, this.completionItemKind, this.isSnippetText);
    }
    toSingleTextEdit() {
        return new (0, $13Zrd.SingleTextEdit)(this.range, this.insertText);
    }
}
function $d06d7e93c2969e4f$var$suggestItemInfoEquals(a, b) {
    if (a === b) return true;
    if (!a || !b) return false;
    return a.equals(b);
}



var $4dEdH = parcelRequire("4dEdH");

var $gjaQN = parcelRequire("gjaQN");

var $aF3f5 = parcelRequire("aF3f5");

var $8tcMz = parcelRequire("8tcMz");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");
var $c8db4217024ed538$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c8db4217024ed538$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $c8db4217024ed538$var$InlineCompletionsController_1;
let $c8db4217024ed538$export$7ab2bbdd4fee8a21 = class InlineCompletionsController extends (0, $9cWcn.Disposable) {
    static{
        $c8db4217024ed538$var$InlineCompletionsController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.inlineCompletionsController';
    }
    static get(editor) {
        return editor.getContribution($c8db4217024ed538$var$InlineCompletionsController_1.ID);
    }
    constructor(editor, _instantiationService, _contextKeyService, _configurationService, _commandService, _debounceService, _languageFeaturesService, _accessibilitySignalService, _keybindingService, _accessibilityService){
        super();
        this.editor = editor;
        this._instantiationService = _instantiationService;
        this._contextKeyService = _contextKeyService;
        this._configurationService = _configurationService;
        this._commandService = _commandService;
        this._debounceService = _debounceService;
        this._languageFeaturesService = _languageFeaturesService;
        this._accessibilitySignalService = _accessibilitySignalService;
        this._keybindingService = _keybindingService;
        this._accessibilityService = _accessibilityService;
        this._editorObs = (0, $iEpUY.observableCodeEditor)(this.editor);
        this._positions = (0, $4fzqs.derived)(this, (reader)=>this._editorObs.selections.read(reader)?.map((s)=>s.getEndPosition()) ?? [
                new (0, $dcxQ7.Position)(1, 1)
            ]);
        this._suggestWidgetAdaptor = this._register(new (0, $d06d7e93c2969e4f$export$2878f71443bbeae8)(this.editor, ()=>{
            this._editorObs.forceUpdate();
            return this.model.get()?.selectedInlineCompletion.get()?.toSingleTextEdit(undefined);
        }, (item)=>this._editorObs.forceUpdate((_tx)=>{
                /** @description InlineCompletionsController.handleSuggestAccepted */ this.model.get()?.handleSuggestAccepted(item);
            })));
        this._suggestWidgetSelectedItem = (0, $4fzqs.observableFromEvent)(this, (cb)=>this._suggestWidgetAdaptor.onDidSelectedItemChange(()=>{
                this._editorObs.forceUpdate((_tx)=>cb(undefined));
            }), ()=>this._suggestWidgetAdaptor.selectedItem);
        this._enabledInConfig = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(62 /* EditorOption.inlineSuggest */ ).enabled);
        this._isScreenReaderEnabled = (0, $4fzqs.observableFromEvent)(this, this._accessibilityService.onDidChangeScreenReaderOptimized, ()=>this._accessibilityService.isScreenReaderOptimized());
        this._editorDictationInProgress = (0, $4fzqs.observableFromEvent)(this, this._contextKeyService.onDidChangeContext, ()=>this._contextKeyService.getContext(this.editor.getDomNode()).getValue('editorDictation.inProgress') === true);
        this._enabled = (0, $4fzqs.derived)(this, (reader)=>this._enabledInConfig.read(reader) && (!this._isScreenReaderEnabled.read(reader) || !this._editorDictationInProgress.read(reader)));
        this._debounceValue = this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider, 'InlineCompletionsDebounce', {
            min: 50,
            max: 50
        });
        this.model = (0, $5Gd0V.derivedDisposable)(this, (reader)=>{
            if (this._editorObs.isReadonly.read(reader)) return undefined;
            const textModel = this._editorObs.model.read(reader);
            if (!textModel) return undefined;
            const model = this._instantiationService.createInstance((0, $79602afdde57b712$export$5323521c789f2485), textModel, this._suggestWidgetSelectedItem, this._editorObs.versionId, this._positions, this._debounceValue, (0, $4fzqs.observableFromEvent)(this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(119 /* EditorOption.suggest */ ).preview), (0, $4fzqs.observableFromEvent)(this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(119 /* EditorOption.suggest */ ).previewMode), (0, $4fzqs.observableFromEvent)(this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(62 /* EditorOption.inlineSuggest */ ).mode), this._enabled);
            return model;
        }).recomputeInitiallyAndOnChange(this._store);
        this._ghostTexts = (0, $4fzqs.derived)(this, (reader)=>{
            const model = this.model.read(reader);
            return model?.ghostTexts.read(reader) ?? [];
        });
        this._stablizedGhostTexts = $c8db4217024ed538$var$convertItemsToStableObservables(this._ghostTexts, this._store);
        this._ghostTextWidgets = (0, $7QKTG.mapObservableArrayCached)(this, this._stablizedGhostTexts, (ghostText, store)=>store.add(this._instantiationService.createInstance((0, $ab4da55af03f6f3f$export$215a91d8a8f2824a), this.editor, {
                ghostText: ghostText,
                minReservedLineCount: (0, $4fzqs.constObservable)(0),
                targetTextModel: this.model.map((v)=>v?.textModel)
            }))).recomputeInitiallyAndOnChange(this._store);
        this._playAccessibilitySignal = (0, $4fzqs.observableSignal)(this);
        this._fontFamily = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(62 /* EditorOption.inlineSuggest */ ).fontFamily);
        this._register(new (0, $fdd9e34afddebc6c$export$59492a7812ea15ae)(this._contextKeyService, this.model));
        this._register((0, $iEpUY.reactToChange)(this._editorObs.onDidType, (_value, _changes)=>{
            if (this._enabled.get()) this.model.get()?.trigger();
        }));
        this._register(this._commandService.onDidExecuteCommand((e)=>{
            // These commands don't trigger onDidType.
            const commands = new Set([
                (0, $1uQAu.CoreEditingCommands).Tab.id,
                (0, $1uQAu.CoreEditingCommands).DeleteLeft.id,
                (0, $1uQAu.CoreEditingCommands).DeleteRight.id,
                (0, $385d40f4a712f69a$export$f1235a78c589a102),
                'acceptSelectedSuggestion'
            ]);
            if (commands.has(e.commandId) && editor.hasTextFocus() && this._enabled.get()) this._editorObs.forceUpdate((tx)=>{
                /** @description onDidExecuteCommand */ this.model.get()?.trigger(tx);
            });
        }));
        this._register((0, $iEpUY.reactToChange)(this._editorObs.selections, (_value, changes)=>{
            if (changes.some((e)=>e.reason === 3 /* CursorChangeReason.Explicit */  || e.source === 'api')) this.model.get()?.stop();
        }));
        this._register(this.editor.onDidBlurEditorWidget(()=>{
            // This is a hidden setting very useful for debugging
            if (this._contextKeyService.getContextKeyValue('accessibleViewIsShown') || this._configurationService.getValue('editor.inlineSuggest.keepOnBlur') || editor.getOption(62 /* EditorOption.inlineSuggest */ ).keepOnBlur || (0, $b8b03009035a1e69$export$4773b7ce527dcc8e).dropDownVisible) return;
            (0, $4fzqs.transaction)((tx)=>{
                /** @description InlineCompletionsController.onDidBlurEditorWidget */ this.model.get()?.stop(tx);
            });
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description InlineCompletionsController.forceRenderingAbove */ const state = this.model.read(reader)?.state.read(reader);
            if (state?.suggestItem) {
                if (state.primaryGhostText.lineCount >= 2) this._suggestWidgetAdaptor.forceRenderingAbove();
            } else this._suggestWidgetAdaptor.stopForceRenderingAbove();
        }));
        this._register((0, $9cWcn.toDisposable)(()=>{
            this._suggestWidgetAdaptor.stopForceRenderingAbove();
        }));
        const currentInlineCompletionBySemanticId = (0, $7QKTG.derivedObservableWithCache)(this, (reader, last)=>{
            const model = this.model.read(reader);
            const state = model?.state.read(reader);
            if (this._suggestWidgetSelectedItem.get()) return last;
            return state?.inlineCompletion?.semanticId;
        });
        this._register((0, $iEpUY.reactToChangeWithStore)((0, $4fzqs.derived)((reader)=>{
            this._playAccessibilitySignal.read(reader);
            currentInlineCompletionBySemanticId.read(reader);
            return {};
        }), async (_value, _deltas, store)=>{
            /** @description InlineCompletionsController.playAccessibilitySignalAndReadSuggestion */ const model = this.model.get();
            const state = model?.state.get();
            if (!state || !model) return;
            const lineText = model.textModel.getLineContent(state.primaryGhostText.lineNumber);
            await (0, $6bXyA.timeout)(50, (0, $giPcZ.cancelOnDispose)(store));
            await (0, $4fzqs.waitForState)(this._suggestWidgetSelectedItem, (0, $bxBg7.isUndefined), ()=>false, (0, $giPcZ.cancelOnDispose)(store));
            await this._accessibilitySignalService.playSignal((0, $aF3f5.AccessibilitySignal).inlineSuggestion);
            if (this.editor.getOption(8 /* EditorOption.screenReaderAnnounceInlineSuggestion */ )) this._provideScreenReaderUpdate(state.primaryGhostText.renderForScreenReader(lineText));
        }));
        this._register(new (0, $b8b03009035a1e69$export$3a097b0f53a9c529)(this.editor, this.model, this._instantiationService));
        this._register((0, $fb10494e6ac976db$export$376f1bc31a70e750)((0, $4fzqs.derived)((reader)=>{
            const fontFamily = this._fontFamily.read(reader);
            if (fontFamily === '' || fontFamily === 'default') return '';
            return `
.monaco-editor .ghost-text-decoration,
.monaco-editor .ghost-text-decoration-preview,
.monaco-editor .ghost-text {
	font-family: ${fontFamily};
}`;
        })));
        // TODO@hediet
        this._register(this._configurationService.onDidChangeConfiguration((e)=>{
            if (e.affectsConfiguration('accessibility.verbosity.inlineCompletions')) this.editor.updateOptions({
                inlineCompletionsAccessibilityVerbose: this._configurationService.getValue('accessibility.verbosity.inlineCompletions')
            });
        }));
        this.editor.updateOptions({
            inlineCompletionsAccessibilityVerbose: this._configurationService.getValue('accessibility.verbosity.inlineCompletions')
        });
    }
    playAccessibilitySignal(tx) {
        this._playAccessibilitySignal.trigger(tx);
    }
    _provideScreenReaderUpdate(content) {
        const accessibleViewShowing = this._contextKeyService.getContextKeyValue('accessibleViewIsShown');
        const accessibleViewKeybinding = this._keybindingService.lookupKeybinding('editor.action.accessibleView');
        let hint;
        if (!accessibleViewShowing && accessibleViewKeybinding && this.editor.getOption(150 /* EditorOption.inlineCompletionsAccessibilityVerbose */ )) hint = (0, $4dEdH.localize)('showAccessibleViewHint', "Inspect this in the accessible view ({0})", accessibleViewKeybinding.getAriaLabel());
        (0, $aIbUW.alert)(hint ? content + ', ' + hint : content);
    }
    shouldShowHoverAt(range) {
        const ghostText = this.model.get()?.primaryGhostText.get();
        if (ghostText) return ghostText.parts.some((p)=>range.containsPosition(new (0, $dcxQ7.Position)(ghostText.lineNumber, p.column)));
        return false;
    }
    shouldShowHoverAtViewZone(viewZoneId) {
        return this._ghostTextWidgets.get()[0]?.ownsViewZone(viewZoneId) ?? false;
    }
};
$c8db4217024ed538$export$7ab2bbdd4fee8a21 = $c8db4217024ed538$var$InlineCompletionsController_1 = $c8db4217024ed538$var$__decorate([
    $c8db4217024ed538$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $c8db4217024ed538$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $c8db4217024ed538$var$__param(3, (0, $35IZ9.IConfigurationService)),
    $c8db4217024ed538$var$__param(4, (0, $8tcMz.ICommandService)),
    $c8db4217024ed538$var$__param(5, (0, $goG89.ILanguageFeatureDebounceService)),
    $c8db4217024ed538$var$__param(6, (0, $4J6fu.ILanguageFeaturesService)),
    $c8db4217024ed538$var$__param(7, (0, $aF3f5.IAccessibilitySignalService)),
    $c8db4217024ed538$var$__param(8, (0, $7IxGd.IKeybindingService)),
    $c8db4217024ed538$var$__param(9, (0, $gjaQN.IAccessibilityService))
], $c8db4217024ed538$export$7ab2bbdd4fee8a21);
function $c8db4217024ed538$var$convertItemsToStableObservables(items, store) {
    const result = (0, $4fzqs.observableValue)('result', []);
    const innerObservables = [];
    store.add((0, $4fzqs.autorun)((reader)=>{
        const itemsValue = items.read(reader);
        (0, $4fzqs.transaction)((tx)=>{
            if (itemsValue.length !== innerObservables.length) {
                innerObservables.length = itemsValue.length;
                for(let i = 0; i < innerObservables.length; i++)if (!innerObservables[i]) innerObservables[i] = (0, $4fzqs.observableValue)('item', itemsValue[i]);
                result.set([
                    ...innerObservables
                ], tx);
            }
            innerObservables.forEach((o, i)=>o.set(itemsValue[i], tx));
        });
    }));
    return result;
}




var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");
class $033d501d3bc638c8$export$57edbf9569cc9779 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = (0, $385d40f4a712f69a$export$e1de09bbdbe549c1);
    }
    constructor(){
        super({
            id: $033d501d3bc638c8$export$57edbf9569cc9779.ID,
            label: $4dEdH.localize('action.inlineSuggest.showNext', "Show Next Inline Suggestion"),
            alias: 'Show Next Inline Suggestion',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible),
            kbOpts: {
                weight: 100,
                primary: 606 /* KeyCode.BracketRight */ 
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(editor);
        controller?.model.get()?.next();
    }
}
class $033d501d3bc638c8$export$deb45c643cbebb10 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = (0, $385d40f4a712f69a$export$fa9ae9dbf994df58);
    }
    constructor(){
        super({
            id: $033d501d3bc638c8$export$deb45c643cbebb10.ID,
            label: $4dEdH.localize('action.inlineSuggest.showPrevious', "Show Previous Inline Suggestion"),
            alias: 'Show Previous Inline Suggestion',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible),
            kbOpts: {
                weight: 100,
                primary: 604 /* KeyCode.BracketLeft */ 
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(editor);
        controller?.model.get()?.previous();
    }
}
class $033d501d3bc638c8$export$ba15d049566a3d99 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.inlineSuggest.trigger',
            label: $4dEdH.localize('action.inlineSuggest.trigger', "Trigger Inline Suggestion"),
            alias: 'Trigger Inline Suggestion',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    async run(accessor, editor) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(editor);
        await (0, $fDQAu.asyncTransaction)(async (tx)=>{
            /** @description triggerExplicitly from command */ await controller?.model.get()?.triggerExplicitly(tx);
            controller?.playAccessibilitySignal(tx);
        });
    }
}
class $033d501d3bc638c8$export$ea9d10195e300386 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.inlineSuggest.acceptNextWord',
            label: $4dEdH.localize('action.inlineSuggest.acceptNextWord', "Accept Next Word Of Inline Suggestion"),
            alias: 'Accept Next Word Of Inline Suggestion',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible),
            kbOpts: {
                weight: 101,
                primary: 2065 /* KeyCode.RightArrow */ ,
                kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible)
            },
            menuOpts: [
                {
                    menuId: (0, $g4v7E.MenuId).InlineSuggestionToolbar,
                    title: $4dEdH.localize('acceptWord', 'Accept Word'),
                    group: 'primary',
                    order: 2
                }
            ]
        });
    }
    async run(accessor, editor) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(editor);
        await controller?.model.get()?.acceptNextWord(controller.editor);
    }
}
class $033d501d3bc638c8$export$e07f1afeea0e23ce extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.inlineSuggest.acceptNextLine',
            label: $4dEdH.localize('action.inlineSuggest.acceptNextLine', "Accept Next Line Of Inline Suggestion"),
            alias: 'Accept Next Line Of Inline Suggestion',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible),
            kbOpts: {
                weight: 101
            },
            menuOpts: [
                {
                    menuId: (0, $g4v7E.MenuId).InlineSuggestionToolbar,
                    title: $4dEdH.localize('acceptLine', 'Accept Line'),
                    group: 'secondary',
                    order: 2
                }
            ]
        });
    }
    async run(accessor, editor) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(editor);
        await controller?.model.get()?.acceptNextLine(controller.editor);
    }
}
class $033d501d3bc638c8$export$17231580c12834fd extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $385d40f4a712f69a$export$f1235a78c589a102),
            label: $4dEdH.localize('action.inlineSuggest.accept', "Accept Inline Suggestion"),
            alias: 'Accept Inline Suggestion',
            precondition: (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible,
            menuOpts: [
                {
                    menuId: (0, $g4v7E.MenuId).InlineSuggestionToolbar,
                    title: $4dEdH.localize('accept', "Accept"),
                    group: 'primary',
                    order: 1
                }
            ],
            kbOpts: {
                primary: 2 /* KeyCode.Tab */ ,
                weight: 200,
                kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible, (0, $ibKGQ.EditorContextKeys).tabMovesFocus.toNegated(), (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionHasIndentationLessThanTabSize, (0, $46671b3f02f7e7cd$export$841858b892ce1f4c).Visible.toNegated(), (0, $ibKGQ.EditorContextKeys).hoverFocused.toNegated())
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(editor);
        if (controller) {
            controller.model.get()?.accept(controller.editor);
            controller.editor.focus();
        }
    }
}
class $033d501d3bc638c8$export$e17c339ea040e097 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.inlineSuggest.hide';
    }
    constructor(){
        super({
            id: $033d501d3bc638c8$export$e17c339ea040e097.ID,
            label: $4dEdH.localize('action.inlineSuggest.hide', "Hide Inline Suggestion"),
            alias: 'Hide Inline Suggestion',
            precondition: (0, $fdd9e34afddebc6c$export$59492a7812ea15ae).inlineSuggestionVisible,
            kbOpts: {
                weight: 100,
                primary: 9 /* KeyCode.Escape */ 
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(editor);
        (0, $4fzqs.transaction)((tx)=>{
            controller?.model.get()?.stop(tx);
        });
    }
}
class $033d501d3bc638c8$export$cd9241ed5439a805 extends (0, $g4v7E.Action2) {
    static{
        this.ID = 'editor.action.inlineSuggest.toggleAlwaysShowToolbar';
    }
    constructor(){
        super({
            id: $033d501d3bc638c8$export$cd9241ed5439a805.ID,
            title: $4dEdH.localize('action.inlineSuggest.alwaysShowToolbar', "Always Show Toolbar"),
            f1: false,
            precondition: undefined,
            menu: [
                {
                    id: (0, $g4v7E.MenuId).InlineSuggestionToolbar,
                    group: 'secondary',
                    order: 10
                }
            ],
            toggled: (0, $cxCeF.ContextKeyExpr).equals('config.editor.inlineSuggest.showToolbar', 'always')
        });
    }
    async run(accessor, editor) {
        const configService = accessor.get((0, $35IZ9.IConfigurationService));
        const currentValue = configService.getValue('editor.inlineSuggest.showToolbar');
        const newValue = currentValue === 'always' ? 'onHover' : 'always';
        configService.updateValue('editor.inlineSuggest.showToolbar', newValue);
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $d00il = parcelRequire("d00il");

var $h9Xpp = parcelRequire("h9Xpp");




var $1vDLP = parcelRequire("1vDLP");

var $4dEdH = parcelRequire("4dEdH");

var $gjaQN = parcelRequire("gjaQN");

var $fdGPu = parcelRequire("fdGPu");

var $iAi3o = parcelRequire("iAi3o");

var $lMGba = parcelRequire("lMGba");
var $9f3cc57e70002164$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $9f3cc57e70002164$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $9f3cc57e70002164$export$d54b1f95b394dfe6 {
    constructor(owner, range, controller){
        this.owner = owner;
        this.range = range;
        this.controller = controller;
    }
    isValidForHoverAnchor(anchor) {
        return anchor.type === 1 /* HoverAnchorType.Range */  && this.range.startColumn <= anchor.range.startColumn && this.range.endColumn >= anchor.range.endColumn;
    }
}
let $9f3cc57e70002164$export$85c63d130bb225cb = class InlineCompletionsHoverParticipant {
    constructor(_editor, _languageService, _openerService, accessibilityService, _instantiationService, _telemetryService){
        this._editor = _editor;
        this._languageService = _languageService;
        this._openerService = _openerService;
        this.accessibilityService = accessibilityService;
        this._instantiationService = _instantiationService;
        this._telemetryService = _telemetryService;
        this.hoverOrdinal = 4;
    }
    suggestHoverAnchor(mouseEvent) {
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(this._editor);
        if (!controller) return null;
        const target = mouseEvent.target;
        if (target.type === 8 /* MouseTargetType.CONTENT_VIEW_ZONE */ ) {
            // handle the case where the mouse is over the view zone
            const viewZoneData = target.detail;
            if (controller.shouldShowHoverAtViewZone(viewZoneData.viewZoneId)) return new (0, $4760294cb1bcf994$export$cadc11e524c92809)(1000, this, (0, $d00il.Range).fromPositions(this._editor.getModel().validatePosition(viewZoneData.positionBefore || viewZoneData.position)), mouseEvent.event.posx, mouseEvent.event.posy, false);
        }
        if (target.type === 7 /* MouseTargetType.CONTENT_EMPTY */ ) {
            // handle the case where the mouse is over the empty portion of a line following ghost text
            if (controller.shouldShowHoverAt(target.range)) return new (0, $4760294cb1bcf994$export$cadc11e524c92809)(1000, this, target.range, mouseEvent.event.posx, mouseEvent.event.posy, false);
        }
        if (target.type === 6 /* MouseTargetType.CONTENT_TEXT */ ) {
            // handle the case where the mouse is directly over ghost text
            const mightBeForeignElement = target.detail.mightBeForeignElement;
            if (mightBeForeignElement && controller.shouldShowHoverAt(target.range)) return new (0, $4760294cb1bcf994$export$cadc11e524c92809)(1000, this, target.range, mouseEvent.event.posx, mouseEvent.event.posy, false);
        }
        return null;
    }
    computeSync(anchor, lineDecorations) {
        if (this._editor.getOption(62 /* EditorOption.inlineSuggest */ ).showToolbar !== 'onHover') return [];
        const controller = (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).get(this._editor);
        if (controller && controller.shouldShowHoverAt(anchor.range)) return [
            new $9f3cc57e70002164$export$d54b1f95b394dfe6(this, anchor.range, controller)
        ];
        return [];
    }
    renderHoverParts(context, hoverParts) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        const part = hoverParts[0];
        this._telemetryService.publicLog2('inlineCompletionHover.shown');
        if (this.accessibilityService.isScreenReaderOptimized() && !this._editor.getOption(8 /* EditorOption.screenReaderAnnounceInlineSuggestion */ )) disposables.add(this.renderScreenReaderText(context, part));
        const model = part.controller.model.get();
        const w = this._instantiationService.createInstance((0, $b8b03009035a1e69$export$4773b7ce527dcc8e), this._editor, false, (0, $4fzqs.constObservable)(null), model.selectedInlineCompletionIndex, model.inlineCompletionsCount, model.activeCommands);
        const widgetNode = w.getDomNode();
        context.fragment.appendChild(widgetNode);
        model.triggerExplicitly();
        disposables.add(w);
        const renderedHoverPart = {
            hoverPart: part,
            hoverElement: widgetNode,
            dispose () {
                disposables.dispose();
            }
        };
        return new (0, $4760294cb1bcf994$export$637327e7f36b9c4a)([
            renderedHoverPart
        ]);
    }
    renderScreenReaderText(context, part) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        const $ = $bDzmQ.$;
        const markdownHoverElement = $('div.hover-row.markdown-hover');
        const hoverContentsElement = $bDzmQ.append(markdownHoverElement, $('div.hover-contents', {
            ['aria-live']: 'assertive'
        }));
        const renderer = disposables.add(new (0, $1vDLP.MarkdownRenderer)({
            editor: this._editor
        }, this._languageService, this._openerService));
        const render = (code)=>{
            disposables.add(renderer.onDidRenderAsync(()=>{
                hoverContentsElement.className = 'hover-contents code-hover-contents';
                context.onContentsChanged();
            }));
            const inlineSuggestionAvailable = $4dEdH.localize('inlineSuggestionFollows', "Suggestion:");
            const renderedContents = disposables.add(renderer.render(new (0, $iGmb0.MarkdownString)().appendText(inlineSuggestionAvailable).appendCodeblock('text', code)));
            hoverContentsElement.replaceChildren(renderedContents.element);
        };
        disposables.add((0, $4fzqs.autorun)((reader)=>{
            /** @description update hover */ const ghostText = part.controller.model.read(reader)?.primaryGhostText.read(reader);
            if (ghostText) {
                const lineText = this._editor.getModel().getLineContent(ghostText.lineNumber);
                render(ghostText.renderForScreenReader(lineText));
            } else $bDzmQ.reset(hoverContentsElement);
        }));
        context.fragment.appendChild(markdownHoverElement);
        return disposables;
    }
};
$9f3cc57e70002164$export$85c63d130bb225cb = $9f3cc57e70002164$var$__decorate([
    $9f3cc57e70002164$var$__param(1, (0, $h9Xpp.ILanguageService)),
    $9f3cc57e70002164$var$__param(2, (0, $iAi3o.IOpenerService)),
    $9f3cc57e70002164$var$__param(3, (0, $gjaQN.IAccessibilityService)),
    $9f3cc57e70002164$var$__param(4, (0, $fdGPu.IInstantiationService)),
    $9f3cc57e70002164$var$__param(5, (0, $lMGba.ITelemetryService))
], $9f3cc57e70002164$export$85c63d130bb225cb);


class $7f2c3e40a007509b$export$423b2bf5485345e6 {
}



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ const $e1a6886bff452a3d$export$e8ccd8e62778e333 = new class AccessibleViewRegistry {
    constructor(){
        this._implementations = [];
    }
    register(implementation) {
        this._implementations.push(implementation);
        return {
            dispose: ()=>{
                const idx = this._implementations.indexOf(implementation);
                if (idx !== -1) this._implementations.splice(idx, 1);
            }
        };
    }
    getImplementations() {
        return this._implementations;
    }
};



var $g4v7E = parcelRequire("g4v7E");
(0, $2iJTi.registerEditorContribution)((0, $c8db4217024ed538$export$7ab2bbdd4fee8a21).ID, (0, $c8db4217024ed538$export$7ab2bbdd4fee8a21), 3 /* EditorContributionInstantiation.Eventually */ );
(0, $2iJTi.registerEditorAction)((0, $033d501d3bc638c8$export$ba15d049566a3d99));
(0, $2iJTi.registerEditorAction)((0, $033d501d3bc638c8$export$57edbf9569cc9779));
(0, $2iJTi.registerEditorAction)((0, $033d501d3bc638c8$export$deb45c643cbebb10));
(0, $2iJTi.registerEditorAction)((0, $033d501d3bc638c8$export$ea9d10195e300386));
(0, $2iJTi.registerEditorAction)((0, $033d501d3bc638c8$export$e07f1afeea0e23ce));
(0, $2iJTi.registerEditorAction)((0, $033d501d3bc638c8$export$17231580c12834fd));
(0, $2iJTi.registerEditorAction)((0, $033d501d3bc638c8$export$e17c339ea040e097));
(0, $g4v7E.registerAction2)((0, $033d501d3bc638c8$export$cd9241ed5439a805));
(0, $4760294cb1bcf994$export$fc2e2429672a46bc).register((0, $9f3cc57e70002164$export$85c63d130bb225cb));
(0, $e1a6886bff452a3d$export$e8ccd8e62778e333).register(new (0, $7f2c3e40a007509b$export$423b2bf5485345e6)());




/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");


var $lgoyH = parcelRequire("lgoyH");

var $2iJTi = parcelRequire("2iJTi");

var $d00il = parcelRequire("d00il");

var $h9Xpp = parcelRequire("h9Xpp");

var $aTkrt = parcelRequire("aTkrt");



var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");



var $4J6fu = parcelRequire("4J6fu");

var $91ntV = parcelRequire("91ntV");
var $a8705dfdd22ad282$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $a8705dfdd22ad282$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $a8705dfdd22ad282$var$GotoDefinitionAtPositionEditorContribution_1;
let $a8705dfdd22ad282$export$35cdf6493d1302e = class GotoDefinitionAtPositionEditorContribution {
    static{
        $a8705dfdd22ad282$var$GotoDefinitionAtPositionEditorContribution_1 = this;
    }
    static{
        this.ID = 'editor.contrib.gotodefinitionatposition';
    }
    static{
        this.MAX_SOURCE_PREVIEW_LINES = 8;
    }
    constructor(editor, textModelResolverService, languageService, languageFeaturesService){
        this.textModelResolverService = textModelResolverService;
        this.languageService = languageService;
        this.languageFeaturesService = languageFeaturesService;
        this.toUnhook = new (0, $9cWcn.DisposableStore)();
        this.toUnhookForKeyboard = new (0, $9cWcn.DisposableStore)();
        this.currentWordAtPosition = null;
        this.previousPromise = null;
        this.editor = editor;
        this.linkDecorations = this.editor.createDecorationsCollection();
        const linkGesture = new (0, $485c48732062cc95$export$e5a83b5c609cb4bb)(editor);
        this.toUnhook.add(linkGesture);
        this.toUnhook.add(linkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent])=>{
            this.startFindDefinitionFromMouse(mouseEvent, keyboardEvent ?? undefined);
        }));
        this.toUnhook.add(linkGesture.onExecute((mouseEvent)=>{
            if (this.isEnabled(mouseEvent)) this.gotoDefinition(mouseEvent.target.position, mouseEvent.hasSideBySideModifier).catch((error)=>{
                (0, $gPkHZ.onUnexpectedError)(error);
            }).finally(()=>{
                this.removeLinkDecorations();
            });
        }));
        this.toUnhook.add(linkGesture.onCancel(()=>{
            this.removeLinkDecorations();
            this.currentWordAtPosition = null;
        }));
    }
    static get(editor) {
        return editor.getContribution($a8705dfdd22ad282$var$GotoDefinitionAtPositionEditorContribution_1.ID);
    }
    async startFindDefinitionFromCursor(position) {
        // For issue: https://github.com/microsoft/vscode/issues/46257
        // equivalent to mouse move with meta/ctrl key
        // First find the definition and add decorations
        // to the editor to be shown with the content hover widget
        await this.startFindDefinition(position);
        // Add listeners for editor cursor move and key down events
        // Dismiss the "extended" editor decorations when the user hides
        // the hover widget. There is no event for the widget itself so these
        // serve as a best effort. After removing the link decorations, the hover
        // widget is clean and will only show declarations per next request.
        this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{
            this.currentWordAtPosition = null;
            this.removeLinkDecorations();
            this.toUnhookForKeyboard.clear();
        }));
        this.toUnhookForKeyboard.add(this.editor.onKeyDown((e)=>{
            if (e) {
                this.currentWordAtPosition = null;
                this.removeLinkDecorations();
                this.toUnhookForKeyboard.clear();
            }
        }));
    }
    startFindDefinitionFromMouse(mouseEvent, withKey) {
        // check if we are active and on a content widget
        if (mouseEvent.target.type === 9 /* MouseTargetType.CONTENT_WIDGET */  && this.linkDecorations.length > 0) return;
        if (!this.editor.hasModel() || !this.isEnabled(mouseEvent, withKey)) {
            this.currentWordAtPosition = null;
            this.removeLinkDecorations();
            return;
        }
        const position = mouseEvent.target.position;
        this.startFindDefinition(position);
    }
    async startFindDefinition(position) {
        // Dispose listeners for updating decorations when using keyboard to show definition hover
        this.toUnhookForKeyboard.clear();
        // Find word at mouse position
        const word = position ? this.editor.getModel()?.getWordAtPosition(position) : null;
        if (!word) {
            this.currentWordAtPosition = null;
            this.removeLinkDecorations();
            return;
        }
        // Return early if word at position is still the same
        if (this.currentWordAtPosition && this.currentWordAtPosition.startColumn === word.startColumn && this.currentWordAtPosition.endColumn === word.endColumn && this.currentWordAtPosition.word === word.word) return;
        this.currentWordAtPosition = word;
        // Find definition and decorate word if found
        const state = new (0, $lgoyH.EditorState)(this.editor, 15 /* CodeEditorStateFlag.Scroll */ );
        if (this.previousPromise) {
            this.previousPromise.cancel();
            this.previousPromise = null;
        }
        this.previousPromise = (0, $6bXyA.createCancelablePromise)((token)=>this.findDefinition(position, token));
        let results;
        try {
            results = await this.previousPromise;
        } catch (error) {
            (0, $gPkHZ.onUnexpectedError)(error);
            return;
        }
        if (!results || !results.length || !state.validate(this.editor)) {
            this.removeLinkDecorations();
            return;
        }
        const linkRange = results[0].originSelectionRange ? (0, $d00il.Range).lift(results[0].originSelectionRange) : new (0, $d00il.Range)(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);
        // Multiple results
        if (results.length > 1) {
            let combinedRange = linkRange;
            for (const { originSelectionRange: originSelectionRange } of results)if (originSelectionRange) combinedRange = (0, $d00il.Range).plusRange(combinedRange, originSelectionRange);
            this.addDecoration(combinedRange, new (0, $iGmb0.MarkdownString)().appendText($4dEdH.localize('multipleResults', "Click to show {0} definitions.", results.length)));
        } else {
            // Single result
            const result = results[0];
            if (!result.uri) return;
            this.textModelResolverService.createModelReference(result.uri).then((ref)=>{
                if (!ref.object || !ref.object.textEditorModel) {
                    ref.dispose();
                    return;
                }
                const { object: { textEditorModel: textEditorModel } } = ref;
                const { startLineNumber: startLineNumber } = result.range;
                if (startLineNumber < 1 || startLineNumber > textEditorModel.getLineCount()) {
                    // invalid range
                    ref.dispose();
                    return;
                }
                const previewValue = this.getPreviewValue(textEditorModel, startLineNumber, result);
                const languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(textEditorModel.uri);
                this.addDecoration(linkRange, previewValue ? new (0, $iGmb0.MarkdownString)().appendCodeblock(languageId ? languageId : '', previewValue) : undefined);
                ref.dispose();
            });
        }
    }
    getPreviewValue(textEditorModel, startLineNumber, result) {
        let rangeToUse = result.range;
        const numberOfLinesInRange = rangeToUse.endLineNumber - rangeToUse.startLineNumber;
        if (numberOfLinesInRange >= $a8705dfdd22ad282$var$GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES) rangeToUse = this.getPreviewRangeBasedOnIndentation(textEditorModel, startLineNumber);
        const previewValue = this.stripIndentationFromPreviewRange(textEditorModel, startLineNumber, rangeToUse);
        return previewValue;
    }
    stripIndentationFromPreviewRange(textEditorModel, startLineNumber, previewRange) {
        const startIndent = textEditorModel.getLineFirstNonWhitespaceColumn(startLineNumber);
        let minIndent = startIndent;
        for(let endLineNumber = startLineNumber + 1; endLineNumber < previewRange.endLineNumber; endLineNumber++){
            const endIndent = textEditorModel.getLineFirstNonWhitespaceColumn(endLineNumber);
            minIndent = Math.min(minIndent, endIndent);
        }
        const previewValue = textEditorModel.getValueInRange(previewRange).replace(new RegExp(`^\\s{${minIndent - 1}}`, 'gm'), '').trim();
        return previewValue;
    }
    getPreviewRangeBasedOnIndentation(textEditorModel, startLineNumber) {
        const startIndent = textEditorModel.getLineFirstNonWhitespaceColumn(startLineNumber);
        const maxLineNumber = Math.min(textEditorModel.getLineCount(), startLineNumber + $a8705dfdd22ad282$var$GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES);
        let endLineNumber = startLineNumber + 1;
        for(; endLineNumber < maxLineNumber; endLineNumber++){
            const endIndent = textEditorModel.getLineFirstNonWhitespaceColumn(endLineNumber);
            if (startIndent === endIndent) break;
        }
        return new (0, $d00il.Range)(startLineNumber, 1, endLineNumber + 1, 1);
    }
    addDecoration(range, hoverMessage) {
        const newDecorations = {
            range: range,
            options: {
                description: 'goto-definition-link',
                inlineClassName: 'goto-definition-link',
                hoverMessage: hoverMessage
            }
        };
        this.linkDecorations.set([
            newDecorations
        ]);
    }
    removeLinkDecorations() {
        this.linkDecorations.clear();
    }
    isEnabled(mouseEvent, withKey) {
        return this.editor.hasModel() && mouseEvent.isLeftClick && mouseEvent.isNoneOrSingleMouseDown && mouseEvent.target.type === 6 /* MouseTargetType.CONTENT_TEXT */  && !(mouseEvent.target.detail.injectedText?.options instanceof (0, $91ntV.ModelDecorationInjectedTextOptions)) && (mouseEvent.hasTriggerModifier || (withKey ? withKey.keyCodeIsTriggerKey : false)) && this.languageFeaturesService.definitionProvider.has(this.editor.getModel());
    }
    findDefinition(position, token) {
        const model = this.editor.getModel();
        if (!model) return Promise.resolve(null);
        return (0, $398bbabbcbf6b57c$export$6b9dcdfe32ab3450)(this.languageFeaturesService.definitionProvider, model, position, false, token);
    }
    gotoDefinition(position, openToSide) {
        this.editor.setPosition(position);
        return this.editor.invokeWithinContext((accessor)=>{
            const canPeek = !openToSide && this.editor.getOption(89 /* EditorOption.definitionLinkOpensInPeek */ ) && !this.isInPeekEditor(accessor);
            const action = new (0, $48e5d411b2010803$export$5aed1003b9513172)({
                openToSide: openToSide,
                openInPeek: canPeek,
                muteMessage: true
            }, {
                title: {
                    value: '',
                    original: ''
                },
                id: '',
                precondition: undefined
            });
            return action.run(accessor);
        });
    }
    isInPeekEditor(accessor) {
        const contextKeyService = accessor.get((0, $cxCeF.IContextKeyService));
        return (0, $fb5054a30d54157b$export$5afd50a7c05ff96a).inPeekEditor.getValue(contextKeyService);
    }
    dispose() {
        this.toUnhook.dispose();
        this.toUnhookForKeyboard.dispose();
    }
};
$a8705dfdd22ad282$export$35cdf6493d1302e = $a8705dfdd22ad282$var$GotoDefinitionAtPositionEditorContribution_1 = $a8705dfdd22ad282$var$__decorate([
    $a8705dfdd22ad282$var$__param(1, (0, $aTkrt.ITextModelService)),
    $a8705dfdd22ad282$var$__param(2, (0, $h9Xpp.ILanguageService)),
    $a8705dfdd22ad282$var$__param(3, (0, $4J6fu.ILanguageFeaturesService))
], $a8705dfdd22ad282$export$35cdf6493d1302e);
(0, $2iJTi.registerEditorContribution)($a8705dfdd22ad282$export$35cdf6493d1302e.ID, $a8705dfdd22ad282$export$35cdf6493d1302e, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $awgRE = parcelRequire("awgRE");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $76Edp = parcelRequire("76Edp");

var $jcr1R = parcelRequire("jcr1R");

var $5OJ54 = parcelRequire("5OJ54");

var $d00il = parcelRequire("d00il");

var $lf2vF = parcelRequire("lf2vF");

var $fdGPu = parcelRequire("fdGPu");

var $enNKM = parcelRequire("enNKM");

var $35IZ9 = parcelRequire("35IZ9");
var $ce19ebd4d99e40dd$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $ce19ebd4d99e40dd$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $ce19ebd4d99e40dd$export$184d3b30ff671af4 {
    constructor(marker, index, total){
        this.marker = marker;
        this.index = index;
        this.total = total;
    }
}
let $ce19ebd4d99e40dd$export$b1f920f775feb297 = class MarkerList {
    constructor(resourceFilter, _markerService, _configService){
        this._markerService = _markerService;
        this._configService = _configService;
        this._onDidChange = new (0, $5YaSO.Emitter)();
        this.onDidChange = this._onDidChange.event;
        this._dispoables = new (0, $9cWcn.DisposableStore)();
        this._markers = [];
        this._nextIdx = -1;
        if ((0, $5OJ54.URI).isUri(resourceFilter)) this._resourceFilter = (uri)=>uri.toString() === resourceFilter.toString();
        else if (resourceFilter) this._resourceFilter = resourceFilter;
        const compareOrder = this._configService.getValue('problems.sortOrder');
        const compareMarker = (a, b)=>{
            let res = (0, $jcr1R.compare)(a.resource.toString(), b.resource.toString());
            if (res === 0) {
                if (compareOrder === 'position') res = (0, $d00il.Range).compareRangesUsingStarts(a, b) || (0, $enNKM.MarkerSeverity).compare(a.severity, b.severity);
                else res = (0, $enNKM.MarkerSeverity).compare(a.severity, b.severity) || (0, $d00il.Range).compareRangesUsingStarts(a, b);
            }
            return res;
        };
        const updateMarker = ()=>{
            this._markers = this._markerService.read({
                resource: (0, $5OJ54.URI).isUri(resourceFilter) ? resourceFilter : undefined,
                severities: (0, $enNKM.MarkerSeverity).Error | (0, $enNKM.MarkerSeverity).Warning | (0, $enNKM.MarkerSeverity).Info
            });
            if (typeof resourceFilter === 'function') this._markers = this._markers.filter((m)=>this._resourceFilter(m.resource));
            this._markers.sort(compareMarker);
        };
        updateMarker();
        this._dispoables.add(_markerService.onMarkerChanged((uris)=>{
            if (!this._resourceFilter || uris.some((uri)=>this._resourceFilter(uri))) {
                updateMarker();
                this._nextIdx = -1;
                this._onDidChange.fire();
            }
        }));
    }
    dispose() {
        this._dispoables.dispose();
        this._onDidChange.dispose();
    }
    matches(uri) {
        if (!this._resourceFilter && !uri) return true;
        if (!this._resourceFilter || !uri) return false;
        return this._resourceFilter(uri);
    }
    get selected() {
        const marker = this._markers[this._nextIdx];
        return marker && new $ce19ebd4d99e40dd$export$184d3b30ff671af4(marker, this._nextIdx + 1, this._markers.length);
    }
    _initIdx(model, position, fwd) {
        let found = false;
        let idx = this._markers.findIndex((marker)=>marker.resource.toString() === model.uri.toString());
        if (idx < 0) {
            idx = (0, $kJ8UG.binarySearch)(this._markers, {
                resource: model.uri
            }, (a, b)=>(0, $jcr1R.compare)(a.resource.toString(), b.resource.toString()));
            if (idx < 0) idx = ~idx;
        }
        for(let i = idx; i < this._markers.length; i++){
            let range = (0, $d00il.Range).lift(this._markers[i]);
            if (range.isEmpty()) {
                const word = model.getWordAtPosition(range.getStartPosition());
                if (word) range = new (0, $d00il.Range)(range.startLineNumber, word.startColumn, range.startLineNumber, word.endColumn);
            }
            if (position && (range.containsPosition(position) || position.isBeforeOrEqual(range.getStartPosition()))) {
                this._nextIdx = i;
                found = true;
                break;
            }
            if (this._markers[i].resource.toString() !== model.uri.toString()) break;
        }
        if (!found) // after the last change
        this._nextIdx = fwd ? 0 : this._markers.length - 1;
        if (this._nextIdx < 0) this._nextIdx = this._markers.length - 1;
    }
    resetIndex() {
        this._nextIdx = -1;
    }
    move(fwd, model, position) {
        if (this._markers.length === 0) return false;
        const oldIdx = this._nextIdx;
        if (this._nextIdx === -1) this._initIdx(model, position, fwd);
        else if (fwd) this._nextIdx = (this._nextIdx + 1) % this._markers.length;
        else if (!fwd) this._nextIdx = (this._nextIdx - 1 + this._markers.length) % this._markers.length;
        if (oldIdx !== this._nextIdx) return true;
        return false;
    }
    find(uri, position) {
        let idx = this._markers.findIndex((marker)=>marker.resource.toString() === uri.toString());
        if (idx < 0) return undefined;
        for(; idx < this._markers.length; idx++){
            if ((0, $d00il.Range).containsPosition(this._markers[idx], position)) return new $ce19ebd4d99e40dd$export$184d3b30ff671af4(this._markers[idx], idx + 1, this._markers.length);
        }
        return undefined;
    }
};
$ce19ebd4d99e40dd$export$b1f920f775feb297 = $ce19ebd4d99e40dd$var$__decorate([
    $ce19ebd4d99e40dd$var$__param(1, (0, $enNKM.IMarkerService)),
    $ce19ebd4d99e40dd$var$__param(2, (0, $35IZ9.IConfigurationService))
], $ce19ebd4d99e40dd$export$b1f920f775feb297);
const $ce19ebd4d99e40dd$export$f7ebd4a56ff523fe = (0, $fdGPu.createDecorator)('IMarkerNavigationService');
let $ce19ebd4d99e40dd$var$MarkerNavigationService = class MarkerNavigationService {
    constructor(_markerService, _configService){
        this._markerService = _markerService;
        this._configService = _configService;
        this._provider = new (0, $76Edp.LinkedList)();
    }
    getMarkerList(resource) {
        for (const provider of this._provider){
            const result = provider.getMarkerList(resource);
            if (result) return result;
        }
        // default
        return new $ce19ebd4d99e40dd$export$b1f920f775feb297(resource, this._markerService, this._configService);
    }
};
$ce19ebd4d99e40dd$var$MarkerNavigationService = $ce19ebd4d99e40dd$var$__decorate([
    $ce19ebd4d99e40dd$var$__param(0, (0, $enNKM.IMarkerService)),
    $ce19ebd4d99e40dd$var$__param(1, (0, $35IZ9.IConfigurationService))
], $ce19ebd4d99e40dd$var$MarkerNavigationService);
(0, $lf2vF.registerSingleton)($ce19ebd4d99e40dd$export$f7ebd4a56ff523fe, $ce19ebd4d99e40dd$var$MarkerNavigationService, 1 /* InstantiationType.Delayed */ );



var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $hEsmQ = parcelRequire("hEsmQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $2aRJR = parcelRequire("2aRJR");

var $kJ8UG = parcelRequire("kJ8UG");

var $bjjQO = parcelRequire("bjjQO");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $5Aea5 = parcelRequire("5Aea5");

var $jcr1R = parcelRequire("jcr1R");


var $d00il = parcelRequire("d00il");


var $4dEdH = parcelRequire("4dEdH");

var $hbDWq = parcelRequire("hbDWq");

var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $8GcbM = parcelRequire("8GcbM");

var $enNKM = parcelRequire("enNKM");

var $iAi3o = parcelRequire("iAi3o");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $awgRE = parcelRequire("awgRE");

var $5rADe = parcelRequire("5rADe");

var $2NmM0 = parcelRequire("2NmM0");
var $2de37bcb941dba1c$export$cbca5336efb65586;
(function(SeverityIcon) {
    function className(severity) {
        switch(severity){
            case (0, $2NmM0.default).Ignore:
                return 'severity-ignore ' + (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).info);
            case (0, $2NmM0.default).Info:
                return (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).info);
            case (0, $2NmM0.default).Warning:
                return (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).warning);
            case (0, $2NmM0.default).Error:
                return (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).error);
            default:
                return '';
        }
    }
    SeverityIcon.className = className;
})($2de37bcb941dba1c$export$cbca5336efb65586 || ($2de37bcb941dba1c$export$cbca5336efb65586 = {}));



var $gaWeX = parcelRequire("gaWeX");

var $azIPz = parcelRequire("azIPz");
var $d363cf54db43d106$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $d363cf54db43d106$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $d363cf54db43d106$var$MarkerNavigationWidget_1;
class $d363cf54db43d106$var$MessageWidget {
    constructor(parent, editor, onRelatedInformation, _openerService, _labelService){
        this._openerService = _openerService;
        this._labelService = _labelService;
        this._lines = 0;
        this._longestLineLength = 0;
        this._relatedDiagnostics = new WeakMap();
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._editor = editor;
        const domNode = document.createElement('div');
        domNode.className = 'descriptioncontainer';
        this._messageBlock = document.createElement('div');
        this._messageBlock.classList.add('message');
        this._messageBlock.setAttribute('aria-live', 'assertive');
        this._messageBlock.setAttribute('role', 'alert');
        domNode.appendChild(this._messageBlock);
        this._relatedBlock = document.createElement('div');
        domNode.appendChild(this._relatedBlock);
        this._disposables.add($bDzmQ.addStandardDisposableListener(this._relatedBlock, 'click', (event)=>{
            event.preventDefault();
            const related = this._relatedDiagnostics.get(event.target);
            if (related) onRelatedInformation(related);
        }));
        this._scrollable = new (0, $2aRJR.ScrollableElement)(domNode, {
            horizontal: 1 /* ScrollbarVisibility.Auto */ ,
            vertical: 1 /* ScrollbarVisibility.Auto */ ,
            useShadows: false,
            horizontalScrollbarSize: 6,
            verticalScrollbarSize: 6
        });
        parent.appendChild(this._scrollable.getDomNode());
        this._disposables.add(this._scrollable.onScroll((e)=>{
            domNode.style.left = `-${e.scrollLeft}px`;
            domNode.style.top = `-${e.scrollTop}px`;
        }));
        this._disposables.add(this._scrollable);
    }
    dispose() {
        (0, $9cWcn.dispose)(this._disposables);
    }
    update(marker) {
        const { source: source, message: message, relatedInformation: relatedInformation, code: code } = marker;
        let sourceAndCodeLength = (source?.length || 0) + 2;
        if (code) {
            if (typeof code === 'string') sourceAndCodeLength += code.length;
            else sourceAndCodeLength += code.value.length;
        }
        const lines = (0, $jcr1R.splitLines)(message);
        this._lines = lines.length;
        this._longestLineLength = 0;
        for (const line of lines)this._longestLineLength = Math.max(line.length + sourceAndCodeLength, this._longestLineLength);
        $bDzmQ.clearNode(this._messageBlock);
        this._messageBlock.setAttribute('aria-label', this.getAriaLabel(marker));
        this._editor.applyFontInfo(this._messageBlock);
        let lastLineElement = this._messageBlock;
        for (const line of lines){
            lastLineElement = document.createElement('div');
            lastLineElement.innerText = line;
            if (line === '') lastLineElement.style.height = this._messageBlock.style.lineHeight;
            this._messageBlock.appendChild(lastLineElement);
        }
        if (source || code) {
            const detailsElement = document.createElement('span');
            detailsElement.classList.add('details');
            lastLineElement.appendChild(detailsElement);
            if (source) {
                const sourceElement = document.createElement('span');
                sourceElement.innerText = source;
                sourceElement.classList.add('source');
                detailsElement.appendChild(sourceElement);
            }
            if (code) {
                if (typeof code === 'string') {
                    const codeElement = document.createElement('span');
                    codeElement.innerText = `(${code})`;
                    codeElement.classList.add('code');
                    detailsElement.appendChild(codeElement);
                } else {
                    this._codeLink = $bDzmQ.$('a.code-link');
                    this._codeLink.setAttribute('href', `${code.target.toString()}`);
                    this._codeLink.onclick = (e)=>{
                        this._openerService.open(code.target, {
                            allowCommands: true
                        });
                        e.preventDefault();
                        e.stopPropagation();
                    };
                    const codeElement = $bDzmQ.append(this._codeLink, $bDzmQ.$('span'));
                    codeElement.innerText = code.value;
                    detailsElement.appendChild(this._codeLink);
                }
            }
        }
        $bDzmQ.clearNode(this._relatedBlock);
        this._editor.applyFontInfo(this._relatedBlock);
        if ((0, $kJ8UG.isNonEmptyArray)(relatedInformation)) {
            const relatedInformationNode = this._relatedBlock.appendChild(document.createElement('div'));
            relatedInformationNode.style.paddingTop = `${Math.floor(this._editor.getOption(67 /* EditorOption.lineHeight */ ) * 0.66)}px`;
            this._lines += 1;
            for (const related of relatedInformation){
                const container = document.createElement('div');
                const relatedResource = document.createElement('a');
                relatedResource.classList.add('filename');
                relatedResource.innerText = `${this._labelService.getUriBasenameLabel(related.resource)}(${related.startLineNumber}, ${related.startColumn}): `;
                relatedResource.title = this._labelService.getUriLabel(related.resource);
                this._relatedDiagnostics.set(relatedResource, related);
                const relatedMessage = document.createElement('span');
                relatedMessage.innerText = related.message;
                container.appendChild(relatedResource);
                container.appendChild(relatedMessage);
                this._lines += 1;
                relatedInformationNode.appendChild(container);
            }
        }
        const fontInfo = this._editor.getOption(50 /* EditorOption.fontInfo */ );
        const scrollWidth = Math.ceil(fontInfo.typicalFullwidthCharacterWidth * this._longestLineLength * 0.75);
        const scrollHeight = fontInfo.lineHeight * this._lines;
        this._scrollable.setScrollDimensions({
            scrollWidth: scrollWidth,
            scrollHeight: scrollHeight
        });
    }
    layout(height, width) {
        this._scrollable.getDomNode().style.height = `${height}px`;
        this._scrollable.getDomNode().style.width = `${width}px`;
        this._scrollable.setScrollDimensions({
            width: width,
            height: height
        });
    }
    getHeightInLines() {
        return Math.min(17, this._lines);
    }
    getAriaLabel(marker) {
        let severityLabel = '';
        switch(marker.severity){
            case (0, $enNKM.MarkerSeverity).Error:
                severityLabel = $4dEdH.localize('Error', "Error");
                break;
            case (0, $enNKM.MarkerSeverity).Warning:
                severityLabel = $4dEdH.localize('Warning', "Warning");
                break;
            case (0, $enNKM.MarkerSeverity).Info:
                severityLabel = $4dEdH.localize('Info', "Info");
                break;
            case (0, $enNKM.MarkerSeverity).Hint:
                severityLabel = $4dEdH.localize('Hint', "Hint");
                break;
        }
        let ariaLabel = $4dEdH.localize('marker aria', "{0} at {1}. ", severityLabel, marker.startLineNumber + ':' + marker.startColumn);
        const model = this._editor.getModel();
        if (model && marker.startLineNumber <= model.getLineCount() && marker.startLineNumber >= 1) {
            const lineContent = model.getLineContent(marker.startLineNumber);
            ariaLabel = `${lineContent}, ${ariaLabel}`;
        }
        return ariaLabel;
    }
}
let $d363cf54db43d106$export$8ebf142680ed82d6 = class MarkerNavigationWidget extends (0, $fb5054a30d54157b$export$85acc0ce60f75b9f) {
    static{
        $d363cf54db43d106$var$MarkerNavigationWidget_1 = this;
    }
    static{
        this.TitleMenu = new (0, $g4v7E.MenuId)('gotoErrorTitleMenu');
    }
    constructor(editor, _themeService, _openerService, _menuService, instantiationService, _contextKeyService, _labelService){
        super(editor, {
            showArrow: true,
            showFrame: true,
            isAccessible: true,
            frameWidth: 1
        }, instantiationService);
        this._themeService = _themeService;
        this._openerService = _openerService;
        this._menuService = _menuService;
        this._contextKeyService = _contextKeyService;
        this._labelService = _labelService;
        this._callOnDispose = new (0, $9cWcn.DisposableStore)();
        this._onDidSelectRelatedInformation = new (0, $5YaSO.Emitter)();
        this.onDidSelectRelatedInformation = this._onDidSelectRelatedInformation.event;
        this._severity = (0, $enNKM.MarkerSeverity).Warning;
        this._backgroundColor = (0, $bjjQO.Color).white;
        this._applyTheme(_themeService.getColorTheme());
        this._callOnDispose.add(_themeService.onDidColorThemeChange(this._applyTheme.bind(this)));
        this.create();
    }
    _applyTheme(theme) {
        this._backgroundColor = theme.getColor($d363cf54db43d106$var$editorMarkerNavigationBackground);
        let colorId = $d363cf54db43d106$var$editorMarkerNavigationError;
        let headerBackground = $d363cf54db43d106$var$editorMarkerNavigationErrorHeader;
        if (this._severity === (0, $enNKM.MarkerSeverity).Warning) {
            colorId = $d363cf54db43d106$var$editorMarkerNavigationWarning;
            headerBackground = $d363cf54db43d106$var$editorMarkerNavigationWarningHeader;
        } else if (this._severity === (0, $enNKM.MarkerSeverity).Info) {
            colorId = $d363cf54db43d106$var$editorMarkerNavigationInfo;
            headerBackground = $d363cf54db43d106$var$editorMarkerNavigationInfoHeader;
        }
        const frameColor = theme.getColor(colorId);
        const headerBg = theme.getColor(headerBackground);
        this.style({
            arrowColor: frameColor,
            frameColor: frameColor,
            headerBackgroundColor: headerBg,
            primaryHeadingColor: theme.getColor((0, $fb5054a30d54157b$export$5f7b8e8b47f91ad3)),
            secondaryHeadingColor: theme.getColor((0, $fb5054a30d54157b$export$cdda5f1c5d2481c1))
        }); // style() will trigger _applyStyles
    }
    _applyStyles() {
        if (this._parentContainer) this._parentContainer.style.backgroundColor = this._backgroundColor ? this._backgroundColor.toString() : '';
        super._applyStyles();
    }
    dispose() {
        this._callOnDispose.dispose();
        super.dispose();
    }
    _fillHead(container) {
        super._fillHead(container);
        this._disposables.add(this._actionbarWidget.actionRunner.onWillRun((e)=>this.editor.focus()));
        const actions = [];
        const menu = this._menuService.getMenuActions($d363cf54db43d106$var$MarkerNavigationWidget_1.TitleMenu, this._contextKeyService);
        (0, $hbDWq.createAndFillInActionBarActions)(menu, actions);
        this._actionbarWidget.push(actions, {
            label: false,
            icon: true,
            index: 0
        });
    }
    _fillTitleIcon(container) {
        this._icon = $bDzmQ.append(container, $bDzmQ.$(''));
    }
    _fillBody(container) {
        this._parentContainer = container;
        container.classList.add('marker-widget');
        this._parentContainer.tabIndex = 0;
        this._parentContainer.setAttribute('role', 'tooltip');
        this._container = document.createElement('div');
        container.appendChild(this._container);
        this._message = new $d363cf54db43d106$var$MessageWidget(this._container, this.editor, (related)=>this._onDidSelectRelatedInformation.fire(related), this._openerService, this._labelService);
        this._disposables.add(this._message);
    }
    show() {
        throw new Error('call showAtMarker');
    }
    showAtMarker(marker, markerIdx, markerCount) {
        // update:
        // * title
        // * message
        this._container.classList.remove('stale');
        this._message.update(marker);
        // update frame color (only applied on 'show')
        this._severity = marker.severity;
        this._applyTheme(this._themeService.getColorTheme());
        // show
        const range = (0, $d00il.Range).lift(marker);
        const editorPosition = this.editor.getPosition();
        const position = editorPosition && range.containsPosition(editorPosition) ? editorPosition : range.getStartPosition();
        super.show(position, this.computeRequiredHeight());
        const model = this.editor.getModel();
        if (model) {
            const detail = markerCount > 1 ? $4dEdH.localize('problems', "{0} of {1} problems", markerIdx, markerCount) : $4dEdH.localize('change', "{0} of {1} problem", markerIdx, markerCount);
            this.setTitle((0, $5Aea5.basename)(model.uri), detail);
        }
        this._icon.className = `codicon ${(0, $2de37bcb941dba1c$export$cbca5336efb65586).className((0, $enNKM.MarkerSeverity).toSeverity(this._severity))}`;
        this.editor.revealPositionNearTop(position, 0 /* ScrollType.Smooth */ );
        this.editor.focus();
    }
    updateMarker(marker) {
        this._container.classList.remove('stale');
        this._message.update(marker);
    }
    showStale() {
        this._container.classList.add('stale');
        this._relayout();
    }
    _doLayoutBody(heightInPixel, widthInPixel) {
        super._doLayoutBody(heightInPixel, widthInPixel);
        this._heightInPixel = heightInPixel;
        this._message.layout(heightInPixel, widthInPixel);
        this._container.style.height = `${heightInPixel}px`;
    }
    _onWidth(widthInPixel) {
        this._message.layout(this._heightInPixel, widthInPixel);
    }
    _relayout() {
        super._relayout(this.computeRequiredHeight());
    }
    computeRequiredHeight() {
        return 3 + this._message.getHeightInLines();
    }
};
$d363cf54db43d106$export$8ebf142680ed82d6 = $d363cf54db43d106$var$MarkerNavigationWidget_1 = $d363cf54db43d106$var$__decorate([
    $d363cf54db43d106$var$__param(1, (0, $azIPz.IThemeService)),
    $d363cf54db43d106$var$__param(2, (0, $iAi3o.IOpenerService)),
    $d363cf54db43d106$var$__param(3, (0, $g4v7E.IMenuService)),
    $d363cf54db43d106$var$__param(4, (0, $fdGPu.IInstantiationService)),
    $d363cf54db43d106$var$__param(5, (0, $cxCeF.IContextKeyService)),
    $d363cf54db43d106$var$__param(6, (0, $8GcbM.ILabelService))
], $d363cf54db43d106$export$8ebf142680ed82d6);
// theming
const $d363cf54db43d106$var$errorDefault = (0, $gaWeX.oneOf)((0, $gaWeX.editorErrorForeground), (0, $gaWeX.editorErrorBorder));
const $d363cf54db43d106$var$warningDefault = (0, $gaWeX.oneOf)((0, $gaWeX.editorWarningForeground), (0, $gaWeX.editorWarningBorder));
const $d363cf54db43d106$var$infoDefault = (0, $gaWeX.oneOf)((0, $gaWeX.editorInfoForeground), (0, $gaWeX.editorInfoBorder));
const $d363cf54db43d106$var$editorMarkerNavigationError = (0, $gaWeX.registerColor)('editorMarkerNavigationError.background', {
    dark: $d363cf54db43d106$var$errorDefault,
    light: $d363cf54db43d106$var$errorDefault,
    hcDark: (0, $gaWeX.contrastBorder),
    hcLight: (0, $gaWeX.contrastBorder)
}, $4dEdH.localize('editorMarkerNavigationError', 'Editor marker navigation widget error color.'));
const $d363cf54db43d106$var$editorMarkerNavigationErrorHeader = (0, $gaWeX.registerColor)('editorMarkerNavigationError.headerBackground', {
    dark: (0, $gaWeX.transparent)($d363cf54db43d106$var$editorMarkerNavigationError, .1),
    light: (0, $gaWeX.transparent)($d363cf54db43d106$var$editorMarkerNavigationError, .1),
    hcDark: null,
    hcLight: null
}, $4dEdH.localize('editorMarkerNavigationErrorHeaderBackground', 'Editor marker navigation widget error heading background.'));
const $d363cf54db43d106$var$editorMarkerNavigationWarning = (0, $gaWeX.registerColor)('editorMarkerNavigationWarning.background', {
    dark: $d363cf54db43d106$var$warningDefault,
    light: $d363cf54db43d106$var$warningDefault,
    hcDark: (0, $gaWeX.contrastBorder),
    hcLight: (0, $gaWeX.contrastBorder)
}, $4dEdH.localize('editorMarkerNavigationWarning', 'Editor marker navigation widget warning color.'));
const $d363cf54db43d106$var$editorMarkerNavigationWarningHeader = (0, $gaWeX.registerColor)('editorMarkerNavigationWarning.headerBackground', {
    dark: (0, $gaWeX.transparent)($d363cf54db43d106$var$editorMarkerNavigationWarning, .1),
    light: (0, $gaWeX.transparent)($d363cf54db43d106$var$editorMarkerNavigationWarning, .1),
    hcDark: '#0C141F',
    hcLight: (0, $gaWeX.transparent)($d363cf54db43d106$var$editorMarkerNavigationWarning, .2)
}, $4dEdH.localize('editorMarkerNavigationWarningBackground', 'Editor marker navigation widget warning heading background.'));
const $d363cf54db43d106$var$editorMarkerNavigationInfo = (0, $gaWeX.registerColor)('editorMarkerNavigationInfo.background', {
    dark: $d363cf54db43d106$var$infoDefault,
    light: $d363cf54db43d106$var$infoDefault,
    hcDark: (0, $gaWeX.contrastBorder),
    hcLight: (0, $gaWeX.contrastBorder)
}, $4dEdH.localize('editorMarkerNavigationInfo', 'Editor marker navigation widget info color.'));
const $d363cf54db43d106$var$editorMarkerNavigationInfoHeader = (0, $gaWeX.registerColor)('editorMarkerNavigationInfo.headerBackground', {
    dark: (0, $gaWeX.transparent)($d363cf54db43d106$var$editorMarkerNavigationInfo, .1),
    light: (0, $gaWeX.transparent)($d363cf54db43d106$var$editorMarkerNavigationInfo, .1),
    hcDark: null,
    hcLight: null
}, $4dEdH.localize('editorMarkerNavigationInfoHeaderBackground', 'Editor marker navigation widget info heading background.'));
const $d363cf54db43d106$var$editorMarkerNavigationBackground = (0, $gaWeX.registerColor)('editorMarkerNavigation.background', (0, $gaWeX.editorBackground), $4dEdH.localize('editorMarkerNavigationBackground', 'Editor marker navigation widget background.'));


var $151420bc881268d9$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $151420bc881268d9$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $151420bc881268d9$var$MarkerController_1;
let $151420bc881268d9$export$97b58da131ee49b9 = class MarkerController {
    static{
        $151420bc881268d9$var$MarkerController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.markerController';
    }
    static get(editor) {
        return editor.getContribution($151420bc881268d9$var$MarkerController_1.ID);
    }
    constructor(editor, _markerNavigationService, _contextKeyService, _editorService, _instantiationService){
        this._markerNavigationService = _markerNavigationService;
        this._contextKeyService = _contextKeyService;
        this._editorService = _editorService;
        this._instantiationService = _instantiationService;
        this._sessionDispoables = new (0, $9cWcn.DisposableStore)();
        this._editor = editor;
        this._widgetVisible = $151420bc881268d9$var$CONTEXT_MARKERS_NAVIGATION_VISIBLE.bindTo(this._contextKeyService);
    }
    dispose() {
        this._cleanUp();
        this._sessionDispoables.dispose();
    }
    _cleanUp() {
        this._widgetVisible.reset();
        this._sessionDispoables.clear();
        this._widget = undefined;
        this._model = undefined;
    }
    _getOrCreateModel(uri) {
        if (this._model && this._model.matches(uri)) return this._model;
        let reusePosition = false;
        if (this._model) {
            reusePosition = true;
            this._cleanUp();
        }
        this._model = this._markerNavigationService.getMarkerList(uri);
        if (reusePosition) this._model.move(true, this._editor.getModel(), this._editor.getPosition());
        this._widget = this._instantiationService.createInstance((0, $d363cf54db43d106$export$8ebf142680ed82d6), this._editor);
        this._widget.onDidClose(()=>this.close(), this, this._sessionDispoables);
        this._widgetVisible.set(true);
        this._sessionDispoables.add(this._model);
        this._sessionDispoables.add(this._widget);
        // follow cursor
        this._sessionDispoables.add(this._editor.onDidChangeCursorPosition((e)=>{
            if (!this._model?.selected || !(0, $d00il.Range).containsPosition(this._model?.selected.marker, e.position)) this._model?.resetIndex();
        }));
        // update markers
        this._sessionDispoables.add(this._model.onDidChange(()=>{
            if (!this._widget || !this._widget.position || !this._model) return;
            const info = this._model.find(this._editor.getModel().uri, this._widget.position);
            if (info) this._widget.updateMarker(info.marker);
            else this._widget.showStale();
        }));
        // open related
        this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation((related)=>{
            this._editorService.openCodeEditor({
                resource: related.resource,
                options: {
                    pinned: true,
                    revealIfOpened: true,
                    selection: (0, $d00il.Range).lift(related).collapseToStart()
                }
            }, this._editor);
            this.close(false);
        }));
        this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp()));
        return this._model;
    }
    close(focusEditor = true) {
        this._cleanUp();
        if (focusEditor) this._editor.focus();
    }
    showAtMarker(marker) {
        if (this._editor.hasModel()) {
            const model = this._getOrCreateModel(this._editor.getModel().uri);
            model.resetIndex();
            model.move(true, this._editor.getModel(), new (0, $dcxQ7.Position)(marker.startLineNumber, marker.startColumn));
            if (model.selected) this._widget.showAtMarker(model.selected.marker, model.selected.index, model.selected.total);
        }
    }
    async nagivate(next, multiFile) {
        if (this._editor.hasModel()) {
            const model = this._getOrCreateModel(multiFile ? undefined : this._editor.getModel().uri);
            model.move(next, this._editor.getModel(), this._editor.getPosition());
            if (!model.selected) return;
            if (model.selected.marker.resource.toString() !== this._editor.getModel().uri.toString()) {
                // show in different editor
                this._cleanUp();
                const otherEditor = await this._editorService.openCodeEditor({
                    resource: model.selected.marker.resource,
                    options: {
                        pinned: false,
                        revealIfOpened: true,
                        selectionRevealType: 2 /* TextEditorSelectionRevealType.NearTop */ ,
                        selection: model.selected.marker
                    }
                }, this._editor);
                if (otherEditor) {
                    $151420bc881268d9$var$MarkerController_1.get(otherEditor)?.close();
                    $151420bc881268d9$var$MarkerController_1.get(otherEditor)?.nagivate(next, multiFile);
                }
            } else // show in this editor
            this._widget.showAtMarker(model.selected.marker, model.selected.index, model.selected.total);
        }
    }
};
$151420bc881268d9$export$97b58da131ee49b9 = $151420bc881268d9$var$MarkerController_1 = $151420bc881268d9$var$__decorate([
    $151420bc881268d9$var$__param(1, (0, $ce19ebd4d99e40dd$export$f7ebd4a56ff523fe)),
    $151420bc881268d9$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $151420bc881268d9$var$__param(3, (0, $2Qfl0.ICodeEditorService)),
    $151420bc881268d9$var$__param(4, (0, $fdGPu.IInstantiationService))
], $151420bc881268d9$export$97b58da131ee49b9);
class $151420bc881268d9$var$MarkerNavigationAction extends (0, $2iJTi.EditorAction) {
    constructor(_next, _multiFile, opts){
        super(opts);
        this._next = _next;
        this._multiFile = _multiFile;
    }
    async run(_accessor, editor) {
        if (editor.hasModel()) $151420bc881268d9$export$97b58da131ee49b9.get(editor)?.nagivate(this._next, this._multiFile);
    }
}
class $151420bc881268d9$export$d0f8fc22ad9db3b2 extends $151420bc881268d9$var$MarkerNavigationAction {
    static{
        this.ID = 'editor.action.marker.next';
    }
    static{
        this.LABEL = $4dEdH.localize('markerAction.next.label', "Go to Next Problem (Error, Warning, Info)");
    }
    constructor(){
        super(true, false, {
            id: $151420bc881268d9$export$d0f8fc22ad9db3b2.ID,
            label: $151420bc881268d9$export$d0f8fc22ad9db3b2.LABEL,
            alias: 'Go to Next Problem (Error, Warning, Info)',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 578 /* KeyCode.F8 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $d363cf54db43d106$export$8ebf142680ed82d6).TitleMenu,
                title: $151420bc881268d9$export$d0f8fc22ad9db3b2.LABEL,
                icon: (0, $hEsmQ.registerIcon)('marker-navigation-next', (0, $awgRE.Codicon).arrowDown, $4dEdH.localize('nextMarkerIcon', 'Icon for goto next marker.')),
                group: 'navigation',
                order: 1
            }
        });
    }
}
class $151420bc881268d9$var$PrevMarkerAction extends $151420bc881268d9$var$MarkerNavigationAction {
    static{
        this.ID = 'editor.action.marker.prev';
    }
    static{
        this.LABEL = $4dEdH.localize('markerAction.previous.label', "Go to Previous Problem (Error, Warning, Info)");
    }
    constructor(){
        super(false, false, {
            id: $151420bc881268d9$var$PrevMarkerAction.ID,
            label: $151420bc881268d9$var$PrevMarkerAction.LABEL,
            alias: 'Go to Previous Problem (Error, Warning, Info)',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 1602 /* KeyCode.F8 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $d363cf54db43d106$export$8ebf142680ed82d6).TitleMenu,
                title: $151420bc881268d9$var$PrevMarkerAction.LABEL,
                icon: (0, $hEsmQ.registerIcon)('marker-navigation-previous', (0, $awgRE.Codicon).arrowUp, $4dEdH.localize('previousMarkerIcon', 'Icon for goto previous marker.')),
                group: 'navigation',
                order: 2
            }
        });
    }
}
class $151420bc881268d9$var$NextMarkerInFilesAction extends $151420bc881268d9$var$MarkerNavigationAction {
    constructor(){
        super(true, true, {
            id: 'editor.action.marker.nextInFiles',
            label: $4dEdH.localize('markerAction.nextInFiles.label', "Go to Next Problem in Files (Error, Warning, Info)"),
            alias: 'Go to Next Problem in Files (Error, Warning, Info)',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 66 /* KeyCode.F8 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarGoMenu,
                title: $4dEdH.localize({
                    key: 'miGotoNextProblem',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Next &&Problem"),
                group: '6_problem_nav',
                order: 1
            }
        });
    }
}
class $151420bc881268d9$var$PrevMarkerInFilesAction extends $151420bc881268d9$var$MarkerNavigationAction {
    constructor(){
        super(false, true, {
            id: 'editor.action.marker.prevInFiles',
            label: $4dEdH.localize('markerAction.previousInFiles.label', "Go to Previous Problem in Files (Error, Warning, Info)"),
            alias: 'Go to Previous Problem in Files (Error, Warning, Info)',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 1090 /* KeyCode.F8 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarGoMenu,
                title: $4dEdH.localize({
                    key: 'miGotoPreviousProblem',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Previous &&Problem"),
                group: '6_problem_nav',
                order: 2
            }
        });
    }
}
(0, $2iJTi.registerEditorContribution)($151420bc881268d9$export$97b58da131ee49b9.ID, $151420bc881268d9$export$97b58da131ee49b9, 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorAction)($151420bc881268d9$export$d0f8fc22ad9db3b2);
(0, $2iJTi.registerEditorAction)($151420bc881268d9$var$PrevMarkerAction);
(0, $2iJTi.registerEditorAction)($151420bc881268d9$var$NextMarkerInFilesAction);
(0, $2iJTi.registerEditorAction)($151420bc881268d9$var$PrevMarkerInFilesAction);
const $151420bc881268d9$var$CONTEXT_MARKERS_NAVIGATION_VISIBLE = new (0, $cxCeF.RawContextKey)('markersNavigationVisible', false);
const $151420bc881268d9$var$MarkerCommand = (0, $2iJTi.EditorCommand).bindToContribution($151420bc881268d9$export$97b58da131ee49b9.get);
(0, $2iJTi.registerEditorCommand)(new $151420bc881268d9$var$MarkerCommand({
    id: 'closeMarkersNavigation',
    precondition: $151420bc881268d9$var$CONTEXT_MARKERS_NAVIGATION_VISIBLE,
    handler: (x)=>x.close(),
    kbOpts: {
        weight: 150,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 9 /* KeyCode.Escape */ ,
        secondary: [
            1033 /* KeyCode.Escape */ 
        ]
    }
}));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $fuc8X = parcelRequire("fuc8X");

var $2iJTi = parcelRequire("2iJTi");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");



var $kzNQX = parcelRequire("kzNQX");

var $4dEdH = parcelRequire("4dEdH");

var $15c778b5890a9875$var$HoverFocusBehavior;
(function(HoverFocusBehavior) {
    HoverFocusBehavior["NoAutoFocus"] = "noAutoFocus";
    HoverFocusBehavior["FocusIfVisible"] = "focusIfVisible";
    HoverFocusBehavior["AutoFocusImmediately"] = "autoFocusImmediately";
})($15c778b5890a9875$var$HoverFocusBehavior || ($15c778b5890a9875$var$HoverFocusBehavior = {}));
class $15c778b5890a9875$export$9899cb06aab7de23 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$62786f1070e2cbd1),
            label: $4dEdH.localize({
                key: 'showOrFocusHover',
                comment: [
                    'Label for action that will trigger the showing/focusing of a hover in the editor.',
                    'If the hover is not visible, it will show the hover.',
                    'This allows for users to show the hover without using the mouse.'
                ]
            }, "Show or Focus Hover"),
            metadata: {
                description: $4dEdH.localize2('showOrFocusHoverDescription', 'Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position.'),
                args: [
                    {
                        name: 'args',
                        schema: {
                            type: 'object',
                            properties: {
                                'focus': {
                                    description: 'Controls if and when the hover should take focus upon being triggered by this action.',
                                    enum: [
                                        $15c778b5890a9875$var$HoverFocusBehavior.NoAutoFocus,
                                        $15c778b5890a9875$var$HoverFocusBehavior.FocusIfVisible,
                                        $15c778b5890a9875$var$HoverFocusBehavior.AutoFocusImmediately
                                    ],
                                    enumDescriptions: [
                                        $4dEdH.localize('showOrFocusHover.focus.noAutoFocus', 'The hover will not automatically take focus.'),
                                        $4dEdH.localize('showOrFocusHover.focus.focusIfVisible', 'The hover will take focus only if it is already visible.'),
                                        $4dEdH.localize('showOrFocusHover.focus.autoFocusImmediately', 'The hover will automatically take focus when it appears.')
                                    ],
                                    default: $15c778b5890a9875$var$HoverFocusBehavior.FocusIfVisible
                                }
                            }
                        }
                    }
                ]
            },
            alias: 'Show or Focus Hover',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2087 /* KeyCode.KeyI */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor, args) {
        if (!editor.hasModel()) return;
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        const focusArgument = args?.focus;
        let focusOption = $15c778b5890a9875$var$HoverFocusBehavior.FocusIfVisible;
        if (Object.values($15c778b5890a9875$var$HoverFocusBehavior).includes(focusArgument)) focusOption = focusArgument;
        else if (typeof focusArgument === 'boolean' && focusArgument) focusOption = $15c778b5890a9875$var$HoverFocusBehavior.AutoFocusImmediately;
        const showContentHover = (focus)=>{
            const position = editor.getPosition();
            const range = new (0, $d00il.Range)(position.lineNumber, position.column, position.lineNumber, position.column);
            controller.showContentHover(range, 1 /* HoverStartMode.Immediate */ , 1 /* HoverStartSource.Keyboard */ , focus);
        };
        const accessibilitySupportEnabled = editor.getOption(2 /* EditorOption.accessibilitySupport */ ) === 2 /* AccessibilitySupport.Enabled */ ;
        if (controller.isHoverVisible) {
            if (focusOption !== $15c778b5890a9875$var$HoverFocusBehavior.NoAutoFocus) controller.focus();
            else showContentHover(accessibilitySupportEnabled);
        } else showContentHover(accessibilitySupportEnabled || focusOption === $15c778b5890a9875$var$HoverFocusBehavior.AutoFocusImmediately);
    }
}
class $15c778b5890a9875$export$d20971711f8d51d extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$1a6c7cbea3b39bc2),
            label: $4dEdH.localize({
                key: 'showDefinitionPreviewHover',
                comment: [
                    'Label for action that will trigger the showing of definition preview hover in the editor.',
                    'This allows for users to show the definition preview hover without using the mouse.'
                ]
            }, "Show Definition Preview Hover"),
            alias: 'Show Definition Preview Hover',
            precondition: undefined,
            metadata: {
                description: $4dEdH.localize2('showDefinitionPreviewHoverDescription', 'Show the definition preview hover in the editor.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        const position = editor.getPosition();
        if (!position) return;
        const range = new (0, $d00il.Range)(position.lineNumber, position.column, position.lineNumber, position.column);
        const goto = (0, $a8705dfdd22ad282$export$35cdf6493d1302e).get(editor);
        if (!goto) return;
        const promise = goto.startFindDefinitionFromCursor(position);
        promise.then(()=>{
            controller.showContentHover(range, 1 /* HoverStartMode.Immediate */ , 1 /* HoverStartSource.Keyboard */ , true);
        });
    }
}
class $15c778b5890a9875$export$24cfd96c09fc9484 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$3b6e5fd9ecfb8818),
            label: $4dEdH.localize({
                key: 'scrollUpHover',
                comment: [
                    'Action that allows to scroll up in the hover widget with the up arrow when the hover widget is focused.'
                ]
            }, "Scroll Up Hover"),
            alias: 'Scroll Up Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 16 /* KeyCode.UpArrow */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('scrollUpHoverDescription', 'Scroll up the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.scrollUp();
    }
}
class $15c778b5890a9875$export$521199303e2342f5 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$3aae40ec50cdf518),
            label: $4dEdH.localize({
                key: 'scrollDownHover',
                comment: [
                    'Action that allows to scroll down in the hover widget with the up arrow when the hover widget is focused.'
                ]
            }, "Scroll Down Hover"),
            alias: 'Scroll Down Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 18 /* KeyCode.DownArrow */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('scrollDownHoverDescription', 'Scroll down the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.scrollDown();
    }
}
class $15c778b5890a9875$export$26138e61e4f29e21 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$9ebf83601aac402d),
            label: $4dEdH.localize({
                key: 'scrollLeftHover',
                comment: [
                    'Action that allows to scroll left in the hover widget with the left arrow when the hover widget is focused.'
                ]
            }, "Scroll Left Hover"),
            alias: 'Scroll Left Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 15 /* KeyCode.LeftArrow */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('scrollLeftHoverDescription', 'Scroll left the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.scrollLeft();
    }
}
class $15c778b5890a9875$export$a2aaf5e84fd91bad extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$b3287a0fd661351c),
            label: $4dEdH.localize({
                key: 'scrollRightHover',
                comment: [
                    'Action that allows to scroll right in the hover widget with the right arrow when the hover widget is focused.'
                ]
            }, "Scroll Right Hover"),
            alias: 'Scroll Right Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 17 /* KeyCode.RightArrow */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('scrollRightHoverDescription', 'Scroll right the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.scrollRight();
    }
}
class $15c778b5890a9875$export$c8f9a95f5d98a7cd extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$a2ee82287204c334),
            label: $4dEdH.localize({
                key: 'pageUpHover',
                comment: [
                    'Action that allows to page up in the hover widget with the page up command when the hover widget is focused.'
                ]
            }, "Page Up Hover"),
            alias: 'Page Up Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 11 /* KeyCode.PageUp */ ,
                secondary: [
                    528 /* KeyCode.UpArrow */ 
                ],
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('pageUpHoverDescription', 'Page up the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.pageUp();
    }
}
class $15c778b5890a9875$export$9011892fafc17190 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$fe51d4b753097916),
            label: $4dEdH.localize({
                key: 'pageDownHover',
                comment: [
                    'Action that allows to page down in the hover widget with the page down command when the hover widget is focused.'
                ]
            }, "Page Down Hover"),
            alias: 'Page Down Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 12 /* KeyCode.PageDown */ ,
                secondary: [
                    530 /* KeyCode.DownArrow */ 
                ],
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('pageDownHoverDescription', 'Page down the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.pageDown();
    }
}
class $15c778b5890a9875$export$c962294947cbf095 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$661f13a87001816f),
            label: $4dEdH.localize({
                key: 'goToTopHover',
                comment: [
                    'Action that allows to go to the top of the hover widget with the home command when the hover widget is focused.'
                ]
            }, "Go To Top Hover"),
            alias: 'Go To Bottom Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 14 /* KeyCode.Home */ ,
                secondary: [
                    2064 /* KeyCode.UpArrow */ 
                ],
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('goToTopHoverDescription', 'Go to the top of the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.goToTop();
    }
}
class $15c778b5890a9875$export$9943cf1de9ecfcab extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$686aa8960b1c24f6),
            label: $4dEdH.localize({
                key: 'goToBottomHover',
                comment: [
                    'Action that allows to go to the bottom in the hover widget with the end command when the hover widget is focused.'
                ]
            }, "Go To Bottom Hover"),
            alias: 'Go To Bottom Hover',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverFocused,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).hoverFocused,
                primary: 13 /* KeyCode.End */ ,
                secondary: [
                    2066 /* KeyCode.DownArrow */ 
                ],
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('goToBottomHoverDescription', 'Go to the bottom of the editor hover.')
            }
        });
    }
    run(accessor, editor) {
        const controller = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!controller) return;
        controller.goToBottom();
    }
}
class $15c778b5890a9875$export$ec85527707ce907c extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$876e0bba4925f0cd),
            label: (0, $12f419b3d72893f8$export$11c4eab940ded057),
            alias: 'Increase Hover Verbosity Level',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverVisible
        });
    }
    run(accessor, editor, args) {
        const hoverController = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!hoverController) return;
        const index = args?.index !== undefined ? args.index : hoverController.focusedHoverPartIndex();
        hoverController.updateHoverVerbosityLevel((0, $kzNQX.HoverVerbosityAction).Increase, index, args?.focus);
    }
}
class $15c778b5890a9875$export$f7e8174b4427148a extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $12f419b3d72893f8$export$cb7016f65e6be5ca),
            label: (0, $12f419b3d72893f8$export$c8fd0cdc78f4b697),
            alias: 'Decrease Hover Verbosity Level',
            precondition: (0, $ibKGQ.EditorContextKeys).hoverVisible
        });
    }
    run(accessor, editor, args) {
        const hoverController = (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor);
        if (!hoverController) return;
        const index = args?.index !== undefined ? args.index : hoverController.focusedHoverPartIndex();
        (0, $174d42e875580d53$export$df69c8e8290b334c).get(editor)?.updateHoverVerbosityLevel((0, $kzNQX.HoverVerbosityAction).Decrease, index, args?.focus);
    }
}



var $2iJTi = parcelRequire("2iJTi");

var $gaWeX = parcelRequire("gaWeX");

var $azIPz = parcelRequire("azIPz");


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $5Aea5 = parcelRequire("5Aea5");

var $d00il = parcelRequire("d00il");

var $4J6fu = parcelRequire("4J6fu");

var $3dJaE = parcelRequire("3dJaE");






var $4dEdH = parcelRequire("4dEdH");

var $enNKM = parcelRequire("enNKM");

var $iAi3o = parcelRequire("iAi3o");

var $4E7vx = parcelRequire("4E7vx");
var $d7420456e804a0e3$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $d7420456e804a0e3$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $d7420456e804a0e3$var$$ = $bDzmQ.$;
class $d7420456e804a0e3$export$c0c5b6dfb6f41d44 {
    constructor(owner, range, marker){
        this.owner = owner;
        this.range = range;
        this.marker = marker;
    }
    isValidForHoverAnchor(anchor) {
        return anchor.type === 1 /* HoverAnchorType.Range */  && this.range.startColumn <= anchor.range.startColumn && this.range.endColumn >= anchor.range.endColumn;
    }
}
const $d7420456e804a0e3$var$markerCodeActionTrigger = {
    type: 1 /* CodeActionTriggerType.Invoke */ ,
    filter: {
        include: (0, $fdf474d60745d657$export$c72b5966cfff6b4d).QuickFix
    },
    triggerAction: (0, $fdf474d60745d657$export$f0e69435f2eb5c46).QuickFixHover
};
let $d7420456e804a0e3$export$32a9787b1b5ca518 = class MarkerHoverParticipant {
    constructor(_editor, _markerDecorationsService, _openerService, _languageFeaturesService){
        this._editor = _editor;
        this._markerDecorationsService = _markerDecorationsService;
        this._openerService = _openerService;
        this._languageFeaturesService = _languageFeaturesService;
        this.hoverOrdinal = 1;
        this.recentMarkerCodeActionsInfo = undefined;
    }
    computeSync(anchor, lineDecorations) {
        if (!this._editor.hasModel() || anchor.type !== 1 /* HoverAnchorType.Range */  && !anchor.supportsMarkerHover) return [];
        const model = this._editor.getModel();
        const lineNumber = anchor.range.startLineNumber;
        const maxColumn = model.getLineMaxColumn(lineNumber);
        const result = [];
        for (const d of lineDecorations){
            const startColumn = d.range.startLineNumber === lineNumber ? d.range.startColumn : 1;
            const endColumn = d.range.endLineNumber === lineNumber ? d.range.endColumn : maxColumn;
            const marker = this._markerDecorationsService.getMarker(model.uri, d);
            if (!marker) continue;
            const range = new (0, $d00il.Range)(anchor.range.startLineNumber, startColumn, anchor.range.startLineNumber, endColumn);
            result.push(new $d7420456e804a0e3$export$c0c5b6dfb6f41d44(this, range, marker));
        }
        return result;
    }
    renderHoverParts(context, hoverParts) {
        if (!hoverParts.length) return new (0, $4760294cb1bcf994$export$637327e7f36b9c4a)([]);
        const disposables = new (0, $9cWcn.DisposableStore)();
        const renderedHoverParts = [];
        hoverParts.forEach((hoverPart)=>{
            const renderedMarkerHover = this._renderMarkerHover(hoverPart);
            context.fragment.appendChild(renderedMarkerHover.hoverElement);
            renderedHoverParts.push(renderedMarkerHover);
        });
        const markerHoverForStatusbar = hoverParts.length === 1 ? hoverParts[0] : hoverParts.sort((a, b)=>(0, $enNKM.MarkerSeverity).compare(a.marker.severity, b.marker.severity))[0];
        this.renderMarkerStatusbar(context, markerHoverForStatusbar, disposables);
        return new (0, $4760294cb1bcf994$export$637327e7f36b9c4a)(renderedHoverParts);
    }
    _renderMarkerHover(markerHover) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        const hoverElement = $d7420456e804a0e3$var$$('div.hover-row');
        const markerElement = $bDzmQ.append(hoverElement, $d7420456e804a0e3$var$$('div.marker.hover-contents'));
        const { source: source, message: message, code: code, relatedInformation: relatedInformation } = markerHover.marker;
        this._editor.applyFontInfo(markerElement);
        const messageElement = $bDzmQ.append(markerElement, $d7420456e804a0e3$var$$('span'));
        messageElement.style.whiteSpace = 'pre-wrap';
        messageElement.innerText = message;
        if (source || code) {
            // Code has link
            if (code && typeof code !== 'string') {
                const sourceAndCodeElement = $d7420456e804a0e3$var$$('span');
                if (source) {
                    const sourceElement = $bDzmQ.append(sourceAndCodeElement, $d7420456e804a0e3$var$$('span'));
                    sourceElement.innerText = source;
                }
                const codeLink = $bDzmQ.append(sourceAndCodeElement, $d7420456e804a0e3$var$$('a.code-link'));
                codeLink.setAttribute('href', code.target.toString());
                disposables.add($bDzmQ.addDisposableListener(codeLink, 'click', (e)=>{
                    this._openerService.open(code.target, {
                        allowCommands: true
                    });
                    e.preventDefault();
                    e.stopPropagation();
                }));
                const codeElement = $bDzmQ.append(codeLink, $d7420456e804a0e3$var$$('span'));
                codeElement.innerText = code.value;
                const detailsElement = $bDzmQ.append(markerElement, sourceAndCodeElement);
                detailsElement.style.opacity = '0.6';
                detailsElement.style.paddingLeft = '6px';
            } else {
                const detailsElement = $bDzmQ.append(markerElement, $d7420456e804a0e3$var$$('span'));
                detailsElement.style.opacity = '0.6';
                detailsElement.style.paddingLeft = '6px';
                detailsElement.innerText = source && code ? `${source}(${code})` : source ? source : `(${code})`;
            }
        }
        if ((0, $kJ8UG.isNonEmptyArray)(relatedInformation)) for (const { message: message, resource: resource, startLineNumber: startLineNumber, startColumn: startColumn } of relatedInformation){
            const relatedInfoContainer = $bDzmQ.append(markerElement, $d7420456e804a0e3$var$$('div'));
            relatedInfoContainer.style.marginTop = '8px';
            const a = $bDzmQ.append(relatedInfoContainer, $d7420456e804a0e3$var$$('a'));
            a.innerText = `${(0, $5Aea5.basename)(resource)}(${startLineNumber}, ${startColumn}): `;
            a.style.cursor = 'pointer';
            disposables.add($bDzmQ.addDisposableListener(a, 'click', (e)=>{
                e.stopPropagation();
                e.preventDefault();
                if (this._openerService) {
                    const editorOptions = {
                        selection: {
                            startLineNumber: startLineNumber,
                            startColumn: startColumn
                        }
                    };
                    this._openerService.open(resource, {
                        fromUserGesture: true,
                        editorOptions: editorOptions
                    }).catch((0, $gPkHZ.onUnexpectedError));
                }
            }));
            const messageElement = $bDzmQ.append(relatedInfoContainer, $d7420456e804a0e3$var$$('span'));
            messageElement.innerText = message;
            this._editor.applyFontInfo(messageElement);
        }
        const renderedHoverPart = {
            hoverPart: markerHover,
            hoverElement: hoverElement,
            dispose: ()=>disposables.dispose()
        };
        return renderedHoverPart;
    }
    renderMarkerStatusbar(context, markerHover, disposables) {
        if (markerHover.marker.severity === (0, $enNKM.MarkerSeverity).Error || markerHover.marker.severity === (0, $enNKM.MarkerSeverity).Warning || markerHover.marker.severity === (0, $enNKM.MarkerSeverity).Info) {
            const markerController = (0, $151420bc881268d9$export$97b58da131ee49b9).get(this._editor);
            if (markerController) context.statusBar.addAction({
                label: $4dEdH.localize('view problem', "View Problem"),
                commandId: (0, $151420bc881268d9$export$d0f8fc22ad9db3b2).ID,
                run: ()=>{
                    context.hide();
                    markerController.showAtMarker(markerHover.marker);
                    this._editor.focus();
                }
            });
        }
        if (!this._editor.getOption(92 /* EditorOption.readOnly */ )) {
            const quickfixPlaceholderElement = context.statusBar.append($d7420456e804a0e3$var$$('div'));
            if (this.recentMarkerCodeActionsInfo) {
                if ((0, $enNKM.IMarkerData).makeKey(this.recentMarkerCodeActionsInfo.marker) === (0, $enNKM.IMarkerData).makeKey(markerHover.marker)) {
                    if (!this.recentMarkerCodeActionsInfo.hasCodeActions) quickfixPlaceholderElement.textContent = $4dEdH.localize('noQuickFixes', "No quick fixes available");
                } else this.recentMarkerCodeActionsInfo = undefined;
            }
            const updatePlaceholderDisposable = this.recentMarkerCodeActionsInfo && !this.recentMarkerCodeActionsInfo.hasCodeActions ? (0, $9cWcn.Disposable).None : (0, $6bXyA.disposableTimeout)(()=>quickfixPlaceholderElement.textContent = $4dEdH.localize('checkingForQuickFixes', "Checking for quick fixes..."), 200, disposables);
            if (!quickfixPlaceholderElement.textContent) // Have some content in here to avoid flickering
            quickfixPlaceholderElement.textContent = String.fromCharCode(0xA0); // &nbsp;
            const codeActionsPromise = this.getCodeActions(markerHover.marker);
            disposables.add((0, $9cWcn.toDisposable)(()=>codeActionsPromise.cancel()));
            codeActionsPromise.then((actions)=>{
                updatePlaceholderDisposable.dispose();
                this.recentMarkerCodeActionsInfo = {
                    marker: markerHover.marker,
                    hasCodeActions: actions.validActions.length > 0
                };
                if (!this.recentMarkerCodeActionsInfo.hasCodeActions) {
                    actions.dispose();
                    quickfixPlaceholderElement.textContent = $4dEdH.localize('noQuickFixes', "No quick fixes available");
                    return;
                }
                quickfixPlaceholderElement.style.display = 'none';
                let showing = false;
                disposables.add((0, $9cWcn.toDisposable)(()=>{
                    if (!showing) actions.dispose();
                }));
                context.statusBar.addAction({
                    label: $4dEdH.localize('quick fixes', "Quick Fix..."),
                    commandId: (0, $ccc254bb322a1d5a$export$3db60be65e567c5d),
                    run: (target)=>{
                        showing = true;
                        const controller = (0, $b873d21752bb0e36$export$d5e19c67c7b6551f).get(this._editor);
                        const elementPosition = $bDzmQ.getDomNodePagePosition(target);
                        // Hide the hover pre-emptively, otherwise the editor can close the code actions
                        // context menu as well when using keyboard navigation
                        context.hide();
                        controller?.showCodeActions($d7420456e804a0e3$var$markerCodeActionTrigger, actions, {
                            x: elementPosition.left,
                            y: elementPosition.top,
                            width: elementPosition.width,
                            height: elementPosition.height
                        });
                    }
                });
            }, (0, $gPkHZ.onUnexpectedError));
        }
    }
    getCodeActions(marker) {
        return (0, $6bXyA.createCancelablePromise)((cancellationToken)=>{
            return (0, $ccc254bb322a1d5a$export$52ee0249dd058aac)(this._languageFeaturesService.codeActionProvider, this._editor.getModel(), new (0, $d00il.Range)(marker.startLineNumber, marker.startColumn, marker.endLineNumber, marker.endColumn), $d7420456e804a0e3$var$markerCodeActionTrigger, (0, $4E7vx.Progress).None, cancellationToken);
        });
    }
};
$d7420456e804a0e3$export$32a9787b1b5ca518 = $d7420456e804a0e3$var$__decorate([
    $d7420456e804a0e3$var$__param(1, (0, $3dJaE.IMarkerDecorationsService)),
    $d7420456e804a0e3$var$__param(2, (0, $iAi3o.IOpenerService)),
    $d7420456e804a0e3$var$__param(3, (0, $4J6fu.ILanguageFeaturesService))
], $d7420456e804a0e3$export$32a9787b1b5ca518);



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $fdGPu = parcelRequire("fdGPu");

var $6bXyA = parcelRequire("6bXyA");


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $9cWcn = parcelRequire("9cWcn");

var $1vDLP = parcelRequire("1vDLP");

var $h9Xpp = parcelRequire("h9Xpp");


var $iAi3o = parcelRequire("iAi3o");

var $jsiuM = parcelRequire("jsiuM");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $iGmb0 = parcelRequire("iGmb0");

var $1Y4vr = parcelRequire("1Y4vr");
class $aed63494cbb5bc77$export$d54348ca3817f744 {
    get lineNumber() {
        return this._lineNumber;
    }
    set lineNumber(value) {
        this._lineNumber = value;
    }
    get lane() {
        return this._laneOrLine;
    }
    set lane(value) {
        this._laneOrLine = value;
    }
    constructor(_editor){
        this._editor = _editor;
        this._lineNumber = -1;
        this._laneOrLine = (0, $1Y4vr.GlyphMarginLane).Center;
    }
    computeSync() {
        const toHoverMessage = (contents)=>{
            return {
                value: contents
            };
        };
        const lineDecorations = this._editor.getLineDecorations(this._lineNumber);
        const result = [];
        const isLineHover = this._laneOrLine === 'lineNo';
        if (!lineDecorations) return result;
        for (const d of lineDecorations){
            const lane = d.options.glyphMargin?.position ?? (0, $1Y4vr.GlyphMarginLane).Center;
            if (!isLineHover && lane !== this._laneOrLine) continue;
            const hoverMessage = isLineHover ? d.options.lineNumberHoverMessage : d.options.glyphMarginHoverMessage;
            if (!hoverMessage || (0, $iGmb0.isEmptyMarkdownString)(hoverMessage)) continue;
            result.push(...(0, $kJ8UG.asArray)(hoverMessage).map(toHoverMessage));
        }
        return result;
    }
}



var $48cf8f21cbfd2dbd$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $48cf8f21cbfd2dbd$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $48cf8f21cbfd2dbd$var$MarginHoverWidget_1;
const $48cf8f21cbfd2dbd$var$$ = $bDzmQ.$;
let $48cf8f21cbfd2dbd$export$22916481cf47b38a = class MarginHoverWidget extends (0, $9cWcn.Disposable) {
    static{
        $48cf8f21cbfd2dbd$var$MarginHoverWidget_1 = this;
    }
    static{
        this.ID = 'editor.contrib.modesGlyphHoverWidget';
    }
    constructor(editor, languageService, openerService){
        super();
        this._renderDisposeables = this._register(new (0, $9cWcn.DisposableStore)());
        this._editor = editor;
        this._isVisible = false;
        this._messages = [];
        this._hover = this._register(new (0, $jsiuM.HoverWidget)());
        this._hover.containerDomNode.classList.toggle('hidden', !this._isVisible);
        this._markdownRenderer = this._register(new (0, $1vDLP.MarkdownRenderer)({
            editor: this._editor
        }, languageService, openerService));
        this._computer = new (0, $aed63494cbb5bc77$export$d54348ca3817f744)(this._editor);
        this._hoverOperation = this._register(new (0, $161a8a25a79256cc$export$35fb423ab90fde65)(this._editor, this._computer));
        this._register(this._hoverOperation.onResult((result)=>{
            this._withResult(result.value);
        }));
        this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged()));
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(50 /* EditorOption.fontInfo */ )) this._updateFont();
        }));
        this._register($bDzmQ.addStandardDisposableListener(this._hover.containerDomNode, 'mouseleave', (e)=>{
            this._onMouseLeave(e);
        }));
        this._editor.addOverlayWidget(this);
    }
    dispose() {
        this._editor.removeOverlayWidget(this);
        super.dispose();
    }
    getId() {
        return $48cf8f21cbfd2dbd$var$MarginHoverWidget_1.ID;
    }
    getDomNode() {
        return this._hover.containerDomNode;
    }
    getPosition() {
        return null;
    }
    _updateFont() {
        const codeClasses = Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName('code'));
        codeClasses.forEach((node)=>this._editor.applyFontInfo(node));
    }
    _onModelDecorationsChanged() {
        if (this._isVisible) {
            // The decorations have changed and the hover is visible,
            // we need to recompute the displayed text
            this._hoverOperation.cancel();
            this._hoverOperation.start(0 /* HoverStartMode.Delayed */ );
        }
    }
    showsOrWillShow(mouseEvent) {
        const target = mouseEvent.target;
        if (target.type === 2 /* MouseTargetType.GUTTER_GLYPH_MARGIN */  && target.detail.glyphMarginLane) {
            this._startShowingAt(target.position.lineNumber, target.detail.glyphMarginLane);
            return true;
        }
        if (target.type === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */ ) {
            this._startShowingAt(target.position.lineNumber, 'lineNo');
            return true;
        }
        return false;
    }
    _startShowingAt(lineNumber, laneOrLine) {
        if (this._computer.lineNumber === lineNumber && this._computer.lane === laneOrLine) // We have to show the widget at the exact same line number as before, so no work is needed
        return;
        this._hoverOperation.cancel();
        this.hide();
        this._computer.lineNumber = lineNumber;
        this._computer.lane = laneOrLine;
        this._hoverOperation.start(0 /* HoverStartMode.Delayed */ );
    }
    hide() {
        this._computer.lineNumber = -1;
        this._hoverOperation.cancel();
        if (!this._isVisible) return;
        this._isVisible = false;
        this._hover.containerDomNode.classList.toggle('hidden', !this._isVisible);
    }
    _withResult(result) {
        this._messages = result;
        if (this._messages.length > 0) this._renderMessages(this._computer.lineNumber, this._messages);
        else this.hide();
    }
    _renderMessages(lineNumber, messages) {
        this._renderDisposeables.clear();
        const fragment = document.createDocumentFragment();
        for (const msg of messages){
            const markdownHoverElement = $48cf8f21cbfd2dbd$var$$('div.hover-row.markdown-hover');
            const hoverContentsElement = $bDzmQ.append(markdownHoverElement, $48cf8f21cbfd2dbd$var$$('div.hover-contents'));
            const renderedContents = this._renderDisposeables.add(this._markdownRenderer.render(msg.value));
            hoverContentsElement.appendChild(renderedContents.element);
            fragment.appendChild(markdownHoverElement);
        }
        this._updateContents(fragment);
        this._showAt(lineNumber);
    }
    _updateContents(node) {
        this._hover.contentsDomNode.textContent = '';
        this._hover.contentsDomNode.appendChild(node);
        this._updateFont();
    }
    _showAt(lineNumber) {
        if (!this._isVisible) {
            this._isVisible = true;
            this._hover.containerDomNode.classList.toggle('hidden', !this._isVisible);
        }
        const editorLayout = this._editor.getLayoutInfo();
        const topForLineNumber = this._editor.getTopForLineNumber(lineNumber);
        const editorScrollTop = this._editor.getScrollTop();
        const lineHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ );
        const nodeHeight = this._hover.containerDomNode.clientHeight;
        const top = topForLineNumber - editorScrollTop - (nodeHeight - lineHeight) / 2;
        const left = editorLayout.glyphMarginLeft + editorLayout.glyphMarginWidth + (this._computer.lane === 'lineNo' ? editorLayout.lineNumbersWidth : 0);
        this._hover.containerDomNode.style.left = `${left}px`;
        this._hover.containerDomNode.style.top = `${Math.max(Math.round(top), 0)}px`;
    }
    _onMouseLeave(e) {
        const editorDomNode = this._editor.getDomNode();
        const isMousePositionOutsideOfEditor = !editorDomNode || !(0, $d0df60e44163b9d6$export$23bb0db67a9f6e2f)(editorDomNode, e.x, e.y);
        if (isMousePositionOutsideOfEditor) this.hide();
    }
};
$48cf8f21cbfd2dbd$export$22916481cf47b38a = $48cf8f21cbfd2dbd$var$MarginHoverWidget_1 = $48cf8f21cbfd2dbd$var$__decorate([
    $48cf8f21cbfd2dbd$var$__param(1, (0, $h9Xpp.ILanguageService)),
    $48cf8f21cbfd2dbd$var$__param(2, (0, $iAi3o.IOpenerService))
], $48cf8f21cbfd2dbd$export$22916481cf47b38a);


var $c8ed20cfecfaf3c1$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c8ed20cfecfaf3c1$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
// sticky hover widget which doesn't disappear on focus out and such
const $c8ed20cfecfaf3c1$var$_sticky = false;
let $c8ed20cfecfaf3c1$export$2a25125361bc7922 = class MarginHoverController extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.marginHover';
    }
    constructor(_editor, _instantiationService){
        super();
        this._editor = _editor;
        this._instantiationService = _instantiationService;
        this.shouldKeepOpenOnEditorMouseMoveOrLeave = false;
        this._listenersStore = new (0, $9cWcn.DisposableStore)();
        this._hoverState = {
            mouseDown: false
        };
        this._reactToEditorMouseMoveRunner = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._reactToEditorMouseMove(this._mouseMoveEvent), 0));
        this._hookListeners();
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(60 /* EditorOption.hover */ )) {
                this._unhookListeners();
                this._hookListeners();
            }
        }));
    }
    _hookListeners() {
        const hoverOpts = this._editor.getOption(60 /* EditorOption.hover */ );
        this._hoverSettings = {
            enabled: hoverOpts.enabled,
            sticky: hoverOpts.sticky,
            hidingDelay: hoverOpts.hidingDelay
        };
        if (hoverOpts.enabled) {
            this._listenersStore.add(this._editor.onMouseDown((e)=>this._onEditorMouseDown(e)));
            this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp()));
            this._listenersStore.add(this._editor.onMouseMove((e)=>this._onEditorMouseMove(e)));
            this._listenersStore.add(this._editor.onKeyDown((e)=>this._onKeyDown(e)));
        } else {
            this._listenersStore.add(this._editor.onMouseMove((e)=>this._onEditorMouseMove(e)));
            this._listenersStore.add(this._editor.onKeyDown((e)=>this._onKeyDown(e)));
        }
        this._listenersStore.add(this._editor.onMouseLeave((e)=>this._onEditorMouseLeave(e)));
        this._listenersStore.add(this._editor.onDidChangeModel(()=>{
            this._cancelScheduler();
            this._hideWidgets();
        }));
        this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler()));
        this._listenersStore.add(this._editor.onDidScrollChange((e)=>this._onEditorScrollChanged(e)));
    }
    _unhookListeners() {
        this._listenersStore.clear();
    }
    _cancelScheduler() {
        this._mouseMoveEvent = undefined;
        this._reactToEditorMouseMoveRunner.cancel();
    }
    _onEditorScrollChanged(e) {
        if (e.scrollTopChanged || e.scrollLeftChanged) this._hideWidgets();
    }
    _onEditorMouseDown(mouseEvent) {
        this._hoverState.mouseDown = true;
        const shouldNotHideCurrentHoverWidget = this._isMouseOnMarginHoverWidget(mouseEvent);
        if (shouldNotHideCurrentHoverWidget) return;
        this._hideWidgets();
    }
    _isMouseOnMarginHoverWidget(mouseEvent) {
        const marginHoverWidgetNode = this._glyphWidget?.getDomNode();
        if (marginHoverWidgetNode) return (0, $d0df60e44163b9d6$export$23bb0db67a9f6e2f)(marginHoverWidgetNode, mouseEvent.event.posx, mouseEvent.event.posy);
        return false;
    }
    _onEditorMouseUp() {
        this._hoverState.mouseDown = false;
    }
    _onEditorMouseLeave(mouseEvent) {
        if (this.shouldKeepOpenOnEditorMouseMoveOrLeave) return;
        this._cancelScheduler();
        const shouldNotHideCurrentHoverWidget = this._isMouseOnMarginHoverWidget(mouseEvent);
        if (shouldNotHideCurrentHoverWidget) return;
        if ($c8ed20cfecfaf3c1$var$_sticky) return;
        this._hideWidgets();
    }
    _shouldNotRecomputeCurrentHoverWidget(mouseEvent) {
        const isHoverSticky = this._hoverSettings.sticky;
        const isMouseOnMarginHoverWidget = this._isMouseOnMarginHoverWidget(mouseEvent);
        return isHoverSticky && isMouseOnMarginHoverWidget;
    }
    _onEditorMouseMove(mouseEvent) {
        if (this.shouldKeepOpenOnEditorMouseMoveOrLeave) return;
        this._mouseMoveEvent = mouseEvent;
        const shouldNotRecomputeCurrentHoverWidget = this._shouldNotRecomputeCurrentHoverWidget(mouseEvent);
        if (shouldNotRecomputeCurrentHoverWidget) {
            this._reactToEditorMouseMoveRunner.cancel();
            return;
        }
        this._reactToEditorMouseMove(mouseEvent);
    }
    _reactToEditorMouseMove(mouseEvent) {
        if (!mouseEvent) return;
        const glyphWidgetShowsOrWillShow = this._tryShowHoverWidget(mouseEvent);
        if (glyphWidgetShowsOrWillShow) return;
        if ($c8ed20cfecfaf3c1$var$_sticky) return;
        this._hideWidgets();
    }
    _tryShowHoverWidget(mouseEvent) {
        const glyphWidget = this._getOrCreateGlyphWidget();
        return glyphWidget.showsOrWillShow(mouseEvent);
    }
    _onKeyDown(e) {
        if (!this._editor.hasModel()) return;
        if (e.keyCode === 5 /* KeyCode.Ctrl */  || e.keyCode === 6 /* KeyCode.Alt */  || e.keyCode === 57 /* KeyCode.Meta */  || e.keyCode === 4 /* KeyCode.Shift */ ) // Do not hide hover when a modifier key is pressed
        return;
        this._hideWidgets();
    }
    _hideWidgets() {
        if ($c8ed20cfecfaf3c1$var$_sticky) return;
        this._glyphWidget?.hide();
    }
    _getOrCreateGlyphWidget() {
        if (!this._glyphWidget) this._glyphWidget = this._instantiationService.createInstance((0, $48cf8f21cbfd2dbd$export$22916481cf47b38a), this._editor);
        return this._glyphWidget;
    }
    dispose() {
        super.dispose();
        this._unhookListeners();
        this._listenersStore.dispose();
        this._glyphWidget?.dispose();
    }
};
$c8ed20cfecfaf3c1$export$2a25125361bc7922 = $c8ed20cfecfaf3c1$var$__decorate([
    $c8ed20cfecfaf3c1$var$__param(1, (0, $fdGPu.IInstantiationService))
], $c8ed20cfecfaf3c1$export$2a25125361bc7922);




class $b0ddf71266a5ca54$export$30e3bd46fb773613 {
}
class $b0ddf71266a5ca54$export$fbe132d16c9b086d {
}
class $b0ddf71266a5ca54$export$b3fcb736d1b5f33e {
}


(0, $2iJTi.registerEditorContribution)((0, $174d42e875580d53$export$df69c8e8290b334c).ID, (0, $174d42e875580d53$export$df69c8e8290b334c), 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorContribution)((0, $c8ed20cfecfaf3c1$export$2a25125361bc7922).ID, (0, $c8ed20cfecfaf3c1$export$2a25125361bc7922), 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$9899cb06aab7de23));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$d20971711f8d51d));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$24cfd96c09fc9484));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$521199303e2342f5));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$26138e61e4f29e21));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$a2aaf5e84fd91bad));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$c8f9a95f5d98a7cd));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$9011892fafc17190));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$c962294947cbf095));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$9943cf1de9ecfcab));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$ec85527707ce907c));
(0, $2iJTi.registerEditorAction)((0, $15c778b5890a9875$export$f7e8174b4427148a));
(0, $4760294cb1bcf994$export$fc2e2429672a46bc).register((0, $9195b2d03426c505$export$db7233c4b0ae81a2));
(0, $4760294cb1bcf994$export$fc2e2429672a46bc).register((0, $d7420456e804a0e3$export$32a9787b1b5ca518));
// theming
(0, $azIPz.registerThemingParticipant)((theme, collector)=>{
    const hoverBorder = theme.getColor((0, $gaWeX.editorHoverBorder));
    if (hoverBorder) {
        collector.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${hoverBorder.transparent(0.5)}; }`);
        collector.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${hoverBorder.transparent(0.5)}; }`);
        collector.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${hoverBorder.transparent(0.5)}; }`);
    }
});
(0, $e1a6886bff452a3d$export$e8ccd8e62778e333).register(new (0, $b0ddf71266a5ca54$export$30e3bd46fb773613)());
(0, $e1a6886bff452a3d$export$e8ccd8e62778e333).register(new (0, $b0ddf71266a5ca54$export$fbe132d16c9b086d)());
(0, $e1a6886bff452a3d$export$e8ccd8e62778e333).register(new (0, $b0ddf71266a5ca54$export$b3fcb736d1b5f33e)());


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $2iJTi = parcelRequire("2iJTi");

var $9S8HY = parcelRequire("9S8HY");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $1qkuR = parcelRequire("1qkuR");

var $cKKJT = parcelRequire("cKKJT");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ function $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(str, tabSize) {
    let spacesCnt = 0;
    for(let i = 0; i < str.length; i++)if (str.charAt(i) === '\t') spacesCnt += tabSize;
    else spacesCnt++;
    return spacesCnt;
}
function $85f1c58e99f5ff47$export$f2011d4fc9157d6f(spacesCnt, tabSize, insertSpaces) {
    spacesCnt = spacesCnt < 0 ? 0 : spacesCnt;
    let result = '';
    if (!insertSpaces) {
        const tabsCnt = Math.floor(spacesCnt / tabSize);
        spacesCnt = spacesCnt % tabSize;
        for(let i = 0; i < tabsCnt; i++)result += '\t';
    }
    for(let i = 0; i < spacesCnt; i++)result += ' ';
    return result;
}



var $4dEdH = parcelRequire("4dEdH");

var $3XkzC = parcelRequire("3XkzC");

var $cBY5u = parcelRequire("cBY5u");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $jcr1R = parcelRequire("jcr1R");

var $9S8HY = parcelRequire("9S8HY");

var $kHJv6 = parcelRequire("kHJv6");

var $9k9WY = parcelRequire("9k9WY");

var $jzicX = parcelRequire("jzicX");

var $keDqU = parcelRequire("keDqU");
function $4c31348f0cb85d5e$export$b3e439d1bd7f9479(model, languageConfigurationService, startLineNumber, endLineNumber) {
    if (model.getLineCount() === 1 && model.getLineMaxColumn(1) === 1) // Model is empty
    return [];
    const indentationRulesSupport = languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).indentRulesSupport;
    if (!indentationRulesSupport) return [];
    const processedIndentRulesSupport = new (0, $keDqU.ProcessedIndentRulesSupport)(model, indentationRulesSupport, languageConfigurationService);
    endLineNumber = Math.min(endLineNumber, model.getLineCount());
    // Skip `unIndentedLinePattern` lines
    while(startLineNumber <= endLineNumber){
        if (!processedIndentRulesSupport.shouldIgnore(startLineNumber)) break;
        startLineNumber++;
    }
    if (startLineNumber > endLineNumber - 1) return [];
    const { tabSize: tabSize, indentSize: indentSize, insertSpaces: insertSpaces } = model.getOptions();
    const shiftIndent = (indentation, count)=>{
        count = count || 1;
        return (0, $9S8HY.ShiftCommand).shiftIndent(indentation, indentation.length + count, tabSize, indentSize, insertSpaces);
    };
    const unshiftIndent = (indentation, count)=>{
        count = count || 1;
        return (0, $9S8HY.ShiftCommand).unshiftIndent(indentation, indentation.length + count, tabSize, indentSize, insertSpaces);
    };
    const indentEdits = [];
    // indentation being passed to lines below
    // Calculate indentation for the first line
    // If there is no passed-in indentation, we use the indentation of the first line as base.
    const currentLineText = model.getLineContent(startLineNumber);
    let globalIndent = $jcr1R.getLeadingWhitespace(currentLineText);
    // idealIndentForNextLine doesn't equal globalIndent when there is a line matching `indentNextLinePattern`.
    let idealIndentForNextLine = globalIndent;
    if (processedIndentRulesSupport.shouldIncrease(startLineNumber)) {
        idealIndentForNextLine = shiftIndent(idealIndentForNextLine);
        globalIndent = shiftIndent(globalIndent);
    } else if (processedIndentRulesSupport.shouldIndentNextLine(startLineNumber)) idealIndentForNextLine = shiftIndent(idealIndentForNextLine);
    startLineNumber++;
    // Calculate indentation adjustment for all following lines
    for(let lineNumber = startLineNumber; lineNumber <= endLineNumber; lineNumber++){
        if ($4c31348f0cb85d5e$var$doesLineStartWithString(model, lineNumber)) continue;
        const text = model.getLineContent(lineNumber);
        const oldIndentation = $jcr1R.getLeadingWhitespace(text);
        const currentIdealIndent = idealIndentForNextLine;
        if (processedIndentRulesSupport.shouldDecrease(lineNumber, currentIdealIndent)) {
            idealIndentForNextLine = unshiftIndent(idealIndentForNextLine);
            globalIndent = unshiftIndent(globalIndent);
        }
        if (oldIndentation !== idealIndentForNextLine) indentEdits.push((0, $kHJv6.EditOperation).replaceMove(new (0, $jzicX.Selection)(lineNumber, 1, lineNumber, oldIndentation.length + 1), (0, $9k9WY.normalizeIndentation)(idealIndentForNextLine, indentSize, insertSpaces)));
        // calculate idealIndentForNextLine
        if (processedIndentRulesSupport.shouldIgnore(lineNumber)) continue;
        else if (processedIndentRulesSupport.shouldIncrease(lineNumber, currentIdealIndent)) {
            globalIndent = shiftIndent(globalIndent);
            idealIndentForNextLine = globalIndent;
        } else if (processedIndentRulesSupport.shouldIndentNextLine(lineNumber, currentIdealIndent)) idealIndentForNextLine = shiftIndent(idealIndentForNextLine);
        else idealIndentForNextLine = globalIndent;
    }
    return indentEdits;
}
function $4c31348f0cb85d5e$var$doesLineStartWithString(model, lineNumber) {
    if (!model.tokenization.isCheapToTokenize(lineNumber)) return false;
    const lineTokens = model.tokenization.getLineTokens(lineNumber);
    return lineTokens.getStandardTokenType(0) === 2 /* StandardTokenType.String */ ;
}



var $eoigl = parcelRequire("eoigl");
var $969bfe0712986f94$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $969bfe0712986f94$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $969bfe0712986f94$export$23df39ff30c2cbb4 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.indentationToSpaces';
    }
    constructor(){
        super({
            id: $969bfe0712986f94$export$23df39ff30c2cbb4.ID,
            label: $4dEdH.localize('indentationToSpaces', "Convert Indentation to Spaces"),
            alias: 'Convert Indentation to Spaces',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            metadata: {
                description: $4dEdH.localize2('indentationToSpacesDescription', "Convert the tab indentation to spaces.")
            }
        });
    }
    run(accessor, editor) {
        const model = editor.getModel();
        if (!model) return;
        const modelOpts = model.getOptions();
        const selection = editor.getSelection();
        if (!selection) return;
        const command = new $969bfe0712986f94$export$3085c18d982e32ff(selection, modelOpts.tabSize);
        editor.pushUndoStop();
        editor.executeCommands(this.id, [
            command
        ]);
        editor.pushUndoStop();
        model.updateOptions({
            insertSpaces: true
        });
    }
}
class $969bfe0712986f94$export$2bccca385c69c5fb extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.indentationToTabs';
    }
    constructor(){
        super({
            id: $969bfe0712986f94$export$2bccca385c69c5fb.ID,
            label: $4dEdH.localize('indentationToTabs', "Convert Indentation to Tabs"),
            alias: 'Convert Indentation to Tabs',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            metadata: {
                description: $4dEdH.localize2('indentationToTabsDescription', "Convert the spaces indentation to tabs.")
            }
        });
    }
    run(accessor, editor) {
        const model = editor.getModel();
        if (!model) return;
        const modelOpts = model.getOptions();
        const selection = editor.getSelection();
        if (!selection) return;
        const command = new $969bfe0712986f94$export$2a6e9e59679d870(selection, modelOpts.tabSize);
        editor.pushUndoStop();
        editor.executeCommands(this.id, [
            command
        ]);
        editor.pushUndoStop();
        model.updateOptions({
            insertSpaces: false
        });
    }
}
class $969bfe0712986f94$export$80abaa81d6d4fae0 extends (0, $2iJTi.EditorAction) {
    constructor(insertSpaces, displaySizeOnly, opts){
        super(opts);
        this.insertSpaces = insertSpaces;
        this.displaySizeOnly = displaySizeOnly;
    }
    run(accessor, editor) {
        const quickInputService = accessor.get((0, $3XkzC.IQuickInputService));
        const modelService = accessor.get((0, $cKKJT.IModelService));
        const model = editor.getModel();
        if (!model) return;
        const creationOpts = modelService.getCreationOptions(model.getLanguageId(), model.uri, model.isForSimpleWidget);
        const modelOpts = model.getOptions();
        const picks = [
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8
        ].map((n)=>({
                id: n.toString(),
                label: n.toString(),
                // add description for tabSize value set in the configuration
                description: n === creationOpts.tabSize && n === modelOpts.tabSize ? $4dEdH.localize('configuredTabSize', "Configured Tab Size") : n === creationOpts.tabSize ? $4dEdH.localize('defaultTabSize', "Default Tab Size") : n === modelOpts.tabSize ? $4dEdH.localize('currentTabSize', "Current Tab Size") : undefined
            }));
        // auto focus the tabSize set for the current editor
        const autoFocusIndex = Math.min(model.getOptions().tabSize - 1, 7);
        setTimeout(()=>{
            quickInputService.pick(picks, {
                placeHolder: $4dEdH.localize({
                    key: 'selectTabWidth',
                    comment: [
                        'Tab corresponds to the tab key'
                    ]
                }, "Select Tab Size for Current File"),
                activeItem: picks[autoFocusIndex]
            }).then((pick)=>{
                if (pick) {
                    if (model && !model.isDisposed()) {
                        const pickedVal = parseInt(pick.label, 10);
                        if (this.displaySizeOnly) model.updateOptions({
                            tabSize: pickedVal
                        });
                        else model.updateOptions({
                            tabSize: pickedVal,
                            indentSize: pickedVal,
                            insertSpaces: this.insertSpaces
                        });
                    }
                }
            });
        }, 50 /* quick input is sensitive to being opened so soon after another */ );
    }
}
class $969bfe0712986f94$export$838aef8de6435fda extends $969bfe0712986f94$export$80abaa81d6d4fae0 {
    static{
        this.ID = 'editor.action.indentUsingTabs';
    }
    constructor(){
        super(false, false, {
            id: $969bfe0712986f94$export$838aef8de6435fda.ID,
            label: $4dEdH.localize('indentUsingTabs', "Indent Using Tabs"),
            alias: 'Indent Using Tabs',
            precondition: undefined,
            metadata: {
                description: $4dEdH.localize2('indentUsingTabsDescription', "Use indentation with tabs.")
            }
        });
    }
}
class $969bfe0712986f94$export$63083e2212f94950 extends $969bfe0712986f94$export$80abaa81d6d4fae0 {
    static{
        this.ID = 'editor.action.indentUsingSpaces';
    }
    constructor(){
        super(true, false, {
            id: $969bfe0712986f94$export$63083e2212f94950.ID,
            label: $4dEdH.localize('indentUsingSpaces', "Indent Using Spaces"),
            alias: 'Indent Using Spaces',
            precondition: undefined,
            metadata: {
                description: $4dEdH.localize2('indentUsingSpacesDescription', "Use indentation with spaces.")
            }
        });
    }
}
class $969bfe0712986f94$export$abffc28c62c594ab extends $969bfe0712986f94$export$80abaa81d6d4fae0 {
    static{
        this.ID = 'editor.action.changeTabDisplaySize';
    }
    constructor(){
        super(true, true, {
            id: $969bfe0712986f94$export$abffc28c62c594ab.ID,
            label: $4dEdH.localize('changeTabDisplaySize', "Change Tab Display Size"),
            alias: 'Change Tab Display Size',
            precondition: undefined,
            metadata: {
                description: $4dEdH.localize2('changeTabDisplaySizeDescription', "Change the space size equivalent of the tab.")
            }
        });
    }
}
class $969bfe0712986f94$export$2352183caa01d2b1 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.detectIndentation';
    }
    constructor(){
        super({
            id: $969bfe0712986f94$export$2352183caa01d2b1.ID,
            label: $4dEdH.localize('detectIndentation', "Detect Indentation from Content"),
            alias: 'Detect Indentation from Content',
            precondition: undefined,
            metadata: {
                description: $4dEdH.localize2('detectIndentationDescription', "Detect the indentation from content.")
            }
        });
    }
    run(accessor, editor) {
        const modelService = accessor.get((0, $cKKJT.IModelService));
        const model = editor.getModel();
        if (!model) return;
        const creationOpts = modelService.getCreationOptions(model.getLanguageId(), model.uri, model.isForSimpleWidget);
        model.detectIndentation(creationOpts.insertSpaces, creationOpts.tabSize);
    }
}
class $969bfe0712986f94$export$c4e59949ff243a9f extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.reindentlines',
            label: $4dEdH.localize('editor.reindentlines', "Reindent Lines"),
            alias: 'Reindent Lines',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            metadata: {
                description: $4dEdH.localize2('editor.reindentlinesDescription', "Reindent the lines of the editor.")
            }
        });
    }
    run(accessor, editor) {
        const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
        const model = editor.getModel();
        if (!model) return;
        const edits = (0, $4c31348f0cb85d5e$export$b3e439d1bd7f9479)(model, languageConfigurationService, 1, model.getLineCount());
        if (edits.length > 0) {
            editor.pushUndoStop();
            editor.executeEdits(this.id, edits);
            editor.pushUndoStop();
        }
    }
}
class $969bfe0712986f94$export$3ebdbd7c48e4ea25 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.reindentselectedlines',
            label: $4dEdH.localize('editor.reindentselectedlines', "Reindent Selected Lines"),
            alias: 'Reindent Selected Lines',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            metadata: {
                description: $4dEdH.localize2('editor.reindentselectedlinesDescription', "Reindent the selected lines of the editor.")
            }
        });
    }
    run(accessor, editor) {
        const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
        const model = editor.getModel();
        if (!model) return;
        const selections = editor.getSelections();
        if (selections === null) return;
        const edits = [];
        for (const selection of selections){
            let startLineNumber = selection.startLineNumber;
            let endLineNumber = selection.endLineNumber;
            if (startLineNumber !== endLineNumber && selection.endColumn === 1) endLineNumber--;
            if (startLineNumber === 1) {
                if (startLineNumber === endLineNumber) continue;
            } else startLineNumber--;
            const editOperations = (0, $4c31348f0cb85d5e$export$b3e439d1bd7f9479)(model, languageConfigurationService, startLineNumber, endLineNumber);
            edits.push(...editOperations);
        }
        if (edits.length > 0) {
            editor.pushUndoStop();
            editor.executeEdits(this.id, edits);
            editor.pushUndoStop();
        }
    }
}
class $969bfe0712986f94$export$64afcb2e2db7c353 {
    constructor(edits, initialSelection){
        this._initialSelection = initialSelection;
        this._edits = [];
        this._selectionId = null;
        for (const edit of edits)if (edit.range && typeof edit.text === 'string') this._edits.push(edit);
    }
    getEditOperations(model, builder) {
        for (const edit of this._edits)builder.addEditOperation((0, $d00il.Range).lift(edit.range), edit.text);
        let selectionIsSet = false;
        if (Array.isArray(this._edits) && this._edits.length === 1 && this._initialSelection.isEmpty()) {
            if (this._edits[0].range.startColumn === this._initialSelection.endColumn && this._edits[0].range.startLineNumber === this._initialSelection.endLineNumber) {
                selectionIsSet = true;
                this._selectionId = builder.trackSelection(this._initialSelection, true);
            } else if (this._edits[0].range.endColumn === this._initialSelection.startColumn && this._edits[0].range.endLineNumber === this._initialSelection.startLineNumber) {
                selectionIsSet = true;
                this._selectionId = builder.trackSelection(this._initialSelection, false);
            }
        }
        if (!selectionIsSet) this._selectionId = builder.trackSelection(this._initialSelection);
    }
    computeCursorState(model, helper) {
        return helper.getTrackedSelection(this._selectionId);
    }
}
let $969bfe0712986f94$export$6fc01df139454e78 = class AutoIndentOnPaste {
    static{
        this.ID = 'editor.contrib.autoIndentOnPaste';
    }
    constructor(editor, _languageConfigurationService){
        this.editor = editor;
        this._languageConfigurationService = _languageConfigurationService;
        this.callOnDispose = new (0, $9cWcn.DisposableStore)();
        this.callOnModel = new (0, $9cWcn.DisposableStore)();
        this.callOnDispose.add(editor.onDidChangeConfiguration(()=>this.update()));
        this.callOnDispose.add(editor.onDidChangeModel(()=>this.update()));
        this.callOnDispose.add(editor.onDidChangeModelLanguage(()=>this.update()));
    }
    update() {
        // clean up
        this.callOnModel.clear();
        // we are disabled
        if (this.editor.getOption(12 /* EditorOption.autoIndent */ ) < 4 /* EditorAutoIndentStrategy.Full */  || this.editor.getOption(55 /* EditorOption.formatOnPaste */ )) return;
        // no model
        if (!this.editor.hasModel()) return;
        this.callOnModel.add(this.editor.onDidPaste(({ range: range })=>{
            this.trigger(range);
        }));
    }
    trigger(range) {
        const selections = this.editor.getSelections();
        if (selections === null || selections.length > 1) return;
        const model = this.editor.getModel();
        if (!model) return;
        const containsOnlyWhitespace = this.rangeContainsOnlyWhitespaceCharacters(model, range);
        if (containsOnlyWhitespace) return;
        if ($969bfe0712986f94$var$isStartOrEndInString(model, range)) return;
        if (!model.tokenization.isCheapToTokenize(range.getStartPosition().lineNumber)) return;
        const autoIndent = this.editor.getOption(12 /* EditorOption.autoIndent */ );
        const { tabSize: tabSize, indentSize: indentSize, insertSpaces: insertSpaces } = model.getOptions();
        const textEdits = [];
        const indentConverter = {
            shiftIndent: (indentation)=>{
                return (0, $9S8HY.ShiftCommand).shiftIndent(indentation, indentation.length + 1, tabSize, indentSize, insertSpaces);
            },
            unshiftIndent: (indentation)=>{
                return (0, $9S8HY.ShiftCommand).unshiftIndent(indentation, indentation.length + 1, tabSize, indentSize, insertSpaces);
            }
        };
        let startLineNumber = range.startLineNumber;
        while(startLineNumber <= range.endLineNumber){
            if (this.shouldIgnoreLine(model, startLineNumber)) {
                startLineNumber++;
                continue;
            }
            break;
        }
        if (startLineNumber > range.endLineNumber) return;
        let firstLineText = model.getLineContent(startLineNumber);
        if (!/\S/.test(firstLineText.substring(0, range.startColumn - 1))) {
            const indentOfFirstLine = (0, $cBY5u.getGoodIndentForLine)(autoIndent, model, model.getLanguageId(), startLineNumber, indentConverter, this._languageConfigurationService);
            if (indentOfFirstLine !== null) {
                const oldIndentation = $jcr1R.getLeadingWhitespace(firstLineText);
                const newSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(indentOfFirstLine, tabSize);
                const oldSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(oldIndentation, tabSize);
                if (newSpaceCnt !== oldSpaceCnt) {
                    const newIndent = $85f1c58e99f5ff47$export$f2011d4fc9157d6f(newSpaceCnt, tabSize, insertSpaces);
                    textEdits.push({
                        range: new (0, $d00il.Range)(startLineNumber, 1, startLineNumber, oldIndentation.length + 1),
                        text: newIndent
                    });
                    firstLineText = newIndent + firstLineText.substring(oldIndentation.length);
                } else {
                    const indentMetadata = (0, $cBY5u.getIndentMetadata)(model, startLineNumber, this._languageConfigurationService);
                    if (indentMetadata === 0 || indentMetadata === 8 /* IndentConsts.UNINDENT_MASK */ ) // we paste content into a line where only contains whitespaces
                    // after pasting, the indentation of the first line is already correct
                    // the first line doesn't match any indentation rule
                    // then no-op.
                    return;
                }
            }
        }
        const firstLineNumber = startLineNumber;
        // ignore empty or ignored lines
        while(startLineNumber < range.endLineNumber){
            if (!/\S/.test(model.getLineContent(startLineNumber + 1))) {
                startLineNumber++;
                continue;
            }
            break;
        }
        if (startLineNumber !== range.endLineNumber) {
            const virtualModel = {
                tokenization: {
                    getLineTokens: (lineNumber)=>{
                        return model.tokenization.getLineTokens(lineNumber);
                    },
                    getLanguageId: ()=>{
                        return model.getLanguageId();
                    },
                    getLanguageIdAtPosition: (lineNumber, column)=>{
                        return model.getLanguageIdAtPosition(lineNumber, column);
                    }
                },
                getLineContent: (lineNumber)=>{
                    if (lineNumber === firstLineNumber) return firstLineText;
                    else return model.getLineContent(lineNumber);
                }
            };
            const indentOfSecondLine = (0, $cBY5u.getGoodIndentForLine)(autoIndent, virtualModel, model.getLanguageId(), startLineNumber + 1, indentConverter, this._languageConfigurationService);
            if (indentOfSecondLine !== null) {
                const newSpaceCntOfSecondLine = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(indentOfSecondLine, tabSize);
                const oldSpaceCntOfSecondLine = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b($jcr1R.getLeadingWhitespace(model.getLineContent(startLineNumber + 1)), tabSize);
                if (newSpaceCntOfSecondLine !== oldSpaceCntOfSecondLine) {
                    const spaceCntOffset = newSpaceCntOfSecondLine - oldSpaceCntOfSecondLine;
                    for(let i = startLineNumber + 1; i <= range.endLineNumber; i++){
                        const lineContent = model.getLineContent(i);
                        const originalIndent = $jcr1R.getLeadingWhitespace(lineContent);
                        const originalSpacesCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(originalIndent, tabSize);
                        const newSpacesCnt = originalSpacesCnt + spaceCntOffset;
                        const newIndent = $85f1c58e99f5ff47$export$f2011d4fc9157d6f(newSpacesCnt, tabSize, insertSpaces);
                        if (newIndent !== originalIndent) textEdits.push({
                            range: new (0, $d00il.Range)(i, 1, i, originalIndent.length + 1),
                            text: newIndent
                        });
                    }
                }
            }
        }
        if (textEdits.length > 0) {
            this.editor.pushUndoStop();
            const cmd = new $969bfe0712986f94$export$64afcb2e2db7c353(textEdits, this.editor.getSelection());
            this.editor.executeCommand('autoIndentOnPaste', cmd);
            this.editor.pushUndoStop();
        }
    }
    rangeContainsOnlyWhitespaceCharacters(model, range) {
        const lineContainsOnlyWhitespace = (content)=>{
            return content.trim().length === 0;
        };
        let containsOnlyWhitespace = true;
        if (range.startLineNumber === range.endLineNumber) {
            const lineContent = model.getLineContent(range.startLineNumber);
            const linePart = lineContent.substring(range.startColumn - 1, range.endColumn - 1);
            containsOnlyWhitespace = lineContainsOnlyWhitespace(linePart);
        } else for(let i = range.startLineNumber; i <= range.endLineNumber; i++){
            const lineContent = model.getLineContent(i);
            if (i === range.startLineNumber) {
                const linePart = lineContent.substring(range.startColumn - 1);
                containsOnlyWhitespace = lineContainsOnlyWhitespace(linePart);
            } else if (i === range.endLineNumber) {
                const linePart = lineContent.substring(0, range.endColumn - 1);
                containsOnlyWhitespace = lineContainsOnlyWhitespace(linePart);
            } else containsOnlyWhitespace = model.getLineFirstNonWhitespaceColumn(i) === 0;
            if (!containsOnlyWhitespace) break;
        }
        return containsOnlyWhitespace;
    }
    shouldIgnoreLine(model, lineNumber) {
        model.tokenization.forceTokenization(lineNumber);
        const nonWhitespaceColumn = model.getLineFirstNonWhitespaceColumn(lineNumber);
        if (nonWhitespaceColumn === 0) return true;
        const tokens = model.tokenization.getLineTokens(lineNumber);
        if (tokens.getCount() > 0) {
            const firstNonWhitespaceTokenIndex = tokens.findTokenIndexAtOffset(nonWhitespaceColumn);
            if (firstNonWhitespaceTokenIndex >= 0 && tokens.getStandardTokenType(firstNonWhitespaceTokenIndex) === 1 /* StandardTokenType.Comment */ ) return true;
        }
        return false;
    }
    dispose() {
        this.callOnDispose.dispose();
        this.callOnModel.dispose();
    }
};
$969bfe0712986f94$export$6fc01df139454e78 = $969bfe0712986f94$var$__decorate([
    $969bfe0712986f94$var$__param(1, (0, $1qkuR.ILanguageConfigurationService))
], $969bfe0712986f94$export$6fc01df139454e78);
function $969bfe0712986f94$var$isStartOrEndInString(model, range) {
    const isPositionInString = (position)=>{
        const tokenType = (0, $eoigl.getStandardTokenTypeAtPosition)(model, position);
        return tokenType === 2 /* StandardTokenType.String */ ;
    };
    return isPositionInString(range.getStartPosition()) || isPositionInString(range.getEndPosition());
}
function $969bfe0712986f94$var$getIndentationEditOperations(model, builder, tabSize, tabsToSpaces) {
    if (model.getLineCount() === 1 && model.getLineMaxColumn(1) === 1) // Model is empty
    return;
    let spaces = '';
    for(let i = 0; i < tabSize; i++)spaces += ' ';
    const spacesRegExp = new RegExp(spaces, 'gi');
    for(let lineNumber = 1, lineCount = model.getLineCount(); lineNumber <= lineCount; lineNumber++){
        let lastIndentationColumn = model.getLineFirstNonWhitespaceColumn(lineNumber);
        if (lastIndentationColumn === 0) lastIndentationColumn = model.getLineMaxColumn(lineNumber);
        if (lastIndentationColumn === 1) continue;
        const originalIndentationRange = new (0, $d00il.Range)(lineNumber, 1, lineNumber, lastIndentationColumn);
        const originalIndentation = model.getValueInRange(originalIndentationRange);
        const newIndentation = tabsToSpaces ? originalIndentation.replace(/\t/ig, spaces) : originalIndentation.replace(spacesRegExp, '\t');
        builder.addEditOperation(originalIndentationRange, newIndentation);
    }
}
class $969bfe0712986f94$export$3085c18d982e32ff {
    constructor(selection, tabSize){
        this.selection = selection;
        this.tabSize = tabSize;
        this.selectionId = null;
    }
    getEditOperations(model, builder) {
        this.selectionId = builder.trackSelection(this.selection);
        $969bfe0712986f94$var$getIndentationEditOperations(model, builder, this.tabSize, true);
    }
    computeCursorState(model, helper) {
        return helper.getTrackedSelection(this.selectionId);
    }
}
class $969bfe0712986f94$export$2a6e9e59679d870 {
    constructor(selection, tabSize){
        this.selection = selection;
        this.tabSize = tabSize;
        this.selectionId = null;
    }
    getEditOperations(model, builder) {
        this.selectionId = builder.trackSelection(this.selection);
        $969bfe0712986f94$var$getIndentationEditOperations(model, builder, this.tabSize, false);
    }
    computeCursorState(model, helper) {
        return helper.getTrackedSelection(this.selectionId);
    }
}
(0, $2iJTi.registerEditorContribution)($969bfe0712986f94$export$6fc01df139454e78.ID, $969bfe0712986f94$export$6fc01df139454e78, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$23df39ff30c2cbb4);
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$2bccca385c69c5fb);
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$838aef8de6435fda);
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$63083e2212f94950);
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$abffc28c62c594ab);
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$2352183caa01d2b1);
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$c4e59949ff243a9f);
(0, $2iJTi.registerEditorAction)($969bfe0712986f94$export$3ebdbd7c48e4ea25);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");



(0, $2iJTi.registerEditorContribution)((0, $c1123d6baa54d7d8$export$c42ac128db3942ca).ID, (0, $c1123d6baa54d7d8$export$c42ac128db3942ca), 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $4760294cb1bcf994$export$fc2e2429672a46bc).register((0, $fc2677ebb06de358$export$a81360d5e6af0e81));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $lgoyH = parcelRequire("lgoyH");

var $2iJTi = parcelRequire("2iJTi");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $ibKGQ = parcelRequire("ibKGQ");

var $91ntV = parcelRequire("91ntV");

var $zvLvK = parcelRequire("zvLvK");

var $4dEdH = parcelRequire("4dEdH");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $jzicX = parcelRequire("jzicX");
class $3768e37b1f387758$export$9bc9910c55aab12 {
    constructor(editRange, originalSelection, text){
        this._editRange = editRange;
        this._originalSelection = originalSelection;
        this._text = text;
    }
    getEditOperations(model, builder) {
        builder.addTrackedEditOperation(this._editRange, this._text);
    }
    computeCursorState(model, helper) {
        const inverseEditOperations = helper.getInverseEditOperations();
        const srcRange = inverseEditOperations[0].range;
        if (!this._originalSelection.isEmpty()) // Preserve selection and extends to typed text
        return new (0, $jzicX.Selection)(srcRange.endLineNumber, srcRange.endColumn - this._text.length, srcRange.endLineNumber, srcRange.endColumn);
        return new (0, $jzicX.Selection)(srcRange.endLineNumber, Math.min(this._originalSelection.positionColumn, srcRange.endColumn), srcRange.endLineNumber, Math.min(this._originalSelection.positionColumn, srcRange.endColumn));
    }
}



var $e17cf22926eee547$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $e17cf22926eee547$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $e17cf22926eee547$var$InPlaceReplaceController_1;
let $e17cf22926eee547$var$InPlaceReplaceController = class InPlaceReplaceController {
    static{
        $e17cf22926eee547$var$InPlaceReplaceController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.inPlaceReplaceController';
    }
    static get(editor) {
        return editor.getContribution($e17cf22926eee547$var$InPlaceReplaceController_1.ID);
    }
    static{
        this.DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'in-place-replace',
            className: 'valueSetReplacement'
        });
    }
    constructor(editor, editorWorkerService){
        this.editor = editor;
        this.editorWorkerService = editorWorkerService;
        this.decorations = this.editor.createDecorationsCollection();
    }
    dispose() {}
    run(source, up) {
        // cancel any pending request
        this.currentRequest?.cancel();
        const editorSelection = this.editor.getSelection();
        const model = this.editor.getModel();
        if (!model || !editorSelection) return undefined;
        let selection = editorSelection;
        if (selection.startLineNumber !== selection.endLineNumber) // Can't accept multiline selection
        return undefined;
        const state = new (0, $lgoyH.EditorState)(this.editor, 5 /* CodeEditorStateFlag.Position */ );
        const modelURI = model.uri;
        if (!this.editorWorkerService.canNavigateValueSet(modelURI)) return Promise.resolve(undefined);
        this.currentRequest = (0, $6bXyA.createCancelablePromise)((token)=>this.editorWorkerService.navigateValueSet(modelURI, selection, up));
        return this.currentRequest.then((result)=>{
            if (!result || !result.range || !result.value) // No proper result
            return;
            if (!state.validate(this.editor)) // state has changed
            return;
            // Selection
            const editRange = (0, $d00il.Range).lift(result.range);
            let highlightRange = result.range;
            const diff = result.value.length - (selection.endColumn - selection.startColumn);
            // highlight
            highlightRange = {
                startLineNumber: highlightRange.startLineNumber,
                startColumn: highlightRange.startColumn,
                endLineNumber: highlightRange.endLineNumber,
                endColumn: highlightRange.startColumn + result.value.length
            };
            if (diff > 1) selection = new (0, $jzicX.Selection)(selection.startLineNumber, selection.startColumn, selection.endLineNumber, selection.endColumn + diff - 1);
            // Insert new text
            const command = new (0, $3768e37b1f387758$export$9bc9910c55aab12)(editRange, selection, result.value);
            this.editor.pushUndoStop();
            this.editor.executeCommand(source, command);
            this.editor.pushUndoStop();
            // add decoration
            this.decorations.set([
                {
                    range: highlightRange,
                    options: $e17cf22926eee547$var$InPlaceReplaceController_1.DECORATION
                }
            ]);
            // remove decoration after delay
            this.decorationRemover?.cancel();
            this.decorationRemover = (0, $6bXyA.timeout)(350);
            this.decorationRemover.then(()=>this.decorations.clear()).catch((0, $gPkHZ.onUnexpectedError));
        }).catch((0, $gPkHZ.onUnexpectedError));
    }
};
$e17cf22926eee547$var$InPlaceReplaceController = $e17cf22926eee547$var$InPlaceReplaceController_1 = $e17cf22926eee547$var$__decorate([
    $e17cf22926eee547$var$__param(1, (0, $zvLvK.IEditorWorkerService))
], $e17cf22926eee547$var$InPlaceReplaceController);
class $e17cf22926eee547$var$InPlaceReplaceUp extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.inPlaceReplace.up',
            label: $4dEdH.localize('InPlaceReplaceAction.previous.label', "Replace with Previous Value"),
            alias: 'Replace with Previous Value',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3159 /* KeyCode.Comma */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        const controller = $e17cf22926eee547$var$InPlaceReplaceController.get(editor);
        if (!controller) return Promise.resolve(undefined);
        return controller.run(this.id, false);
    }
}
class $e17cf22926eee547$var$InPlaceReplaceDown extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.inPlaceReplace.down',
            label: $4dEdH.localize('InPlaceReplaceAction.next.label', "Replace with Next Value"),
            alias: 'Replace with Next Value',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3161 /* KeyCode.Period */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        const controller = $e17cf22926eee547$var$InPlaceReplaceController.get(editor);
        if (!controller) return Promise.resolve(undefined);
        return controller.run(this.id, true);
    }
}
(0, $2iJTi.registerEditorContribution)($e17cf22926eee547$var$InPlaceReplaceController.ID, $e17cf22926eee547$var$InPlaceReplaceController, 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorAction)($e17cf22926eee547$var$InPlaceReplaceUp);
(0, $2iJTi.registerEditorAction)($e17cf22926eee547$var$InPlaceReplaceDown);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $lLi3Z = parcelRequire("lLi3Z");

var $ibKGQ = parcelRequire("ibKGQ");

var $4dEdH = parcelRequire("4dEdH");
class $b429ce4b2dbf6242$export$b138959c3fb78d73 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'expandLineSelection',
            label: $4dEdH.localize('expandLineSelection', "Expand Line Selection"),
            alias: 'Expand Line Selection',
            precondition: undefined,
            kbOpts: {
                weight: 0 /* KeybindingWeight.EditorCore */ ,
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 2090 /* KeyCode.KeyL */ 
            }
        });
    }
    run(_accessor, editor, args) {
        args = args || {};
        if (!editor.hasModel()) return;
        const viewModel = editor._getViewModel();
        viewModel.model.pushStackElement();
        viewModel.setCursorStates(args.source, 3 /* CursorChangeReason.Explicit */ , (0, $lLi3Z.CursorMoveCommands).expandLineSelection(viewModel, viewModel.getCursorStates()));
        viewModel.revealAllCursors(args.source, true);
    }
}
(0, $2iJTi.registerEditorAction)($b429ce4b2dbf6242$export$b138959c3fb78d73);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $fuc8X = parcelRequire("fuc8X");

var $1uQAu = parcelRequire("1uQAu");

var $2iJTi = parcelRequire("2iJTi");

var $5TVJR = parcelRequire("5TVJR");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $jcr1R = parcelRequire("jcr1R");

var $kHJv6 = parcelRequire("kHJv6");

var $d00il = parcelRequire("d00il");
class $fb94e4eefdfa3332$export$d5a264e582fa038c {
    constructor(selection, cursors, trimInRegexesAndStrings){
        this._selection = selection;
        this._cursors = cursors;
        this._selectionId = null;
        this._trimInRegexesAndStrings = trimInRegexesAndStrings;
    }
    getEditOperations(model, builder) {
        const ops = $fb94e4eefdfa3332$export$a5e50b06a093aab9(model, this._cursors, this._trimInRegexesAndStrings);
        for(let i = 0, len = ops.length; i < len; i++){
            const op = ops[i];
            builder.addEditOperation(op.range, op.text);
        }
        this._selectionId = builder.trackSelection(this._selection);
    }
    computeCursorState(model, helper) {
        return helper.getTrackedSelection(this._selectionId);
    }
}
function $fb94e4eefdfa3332$export$a5e50b06a093aab9(model, cursors, trimInRegexesAndStrings) {
    // Sort cursors ascending
    cursors.sort((a, b)=>{
        if (a.lineNumber === b.lineNumber) return a.column - b.column;
        return a.lineNumber - b.lineNumber;
    });
    // Reduce multiple cursors on the same line and only keep the last one on the line
    for(let i = cursors.length - 2; i >= 0; i--)if (cursors[i].lineNumber === cursors[i + 1].lineNumber) // Remove cursor at `i`
    cursors.splice(i, 1);
    const r = [];
    let rLen = 0;
    let cursorIndex = 0;
    const cursorLen = cursors.length;
    for(let lineNumber = 1, lineCount = model.getLineCount(); lineNumber <= lineCount; lineNumber++){
        const lineContent = model.getLineContent(lineNumber);
        const maxLineColumn = lineContent.length + 1;
        let minEditColumn = 0;
        if (cursorIndex < cursorLen && cursors[cursorIndex].lineNumber === lineNumber) {
            minEditColumn = cursors[cursorIndex].column;
            cursorIndex++;
            if (minEditColumn === maxLineColumn) continue;
        }
        if (lineContent.length === 0) continue;
        const lastNonWhitespaceIndex = $jcr1R.lastNonWhitespaceIndex(lineContent);
        let fromColumn = 0;
        if (lastNonWhitespaceIndex === -1) // Entire line is whitespace
        fromColumn = 1;
        else if (lastNonWhitespaceIndex !== lineContent.length - 1) // There is trailing whitespace
        fromColumn = lastNonWhitespaceIndex + 2;
        else continue;
        if (!trimInRegexesAndStrings) {
            if (!model.tokenization.hasAccurateTokensForLine(lineNumber)) continue;
            const lineTokens = model.tokenization.getLineTokens(lineNumber);
            const fromColumnType = lineTokens.getStandardTokenType(lineTokens.findTokenIndexAtOffset(fromColumn));
            if (fromColumnType === 2 /* StandardTokenType.String */  || fromColumnType === 3 /* StandardTokenType.RegEx */ ) continue;
        }
        fromColumn = Math.max(minEditColumn, fromColumn);
        r[rLen++] = (0, $kHJv6.EditOperation).delete(new (0, $d00il.Range)(lineNumber, fromColumn, lineNumber, maxLineColumn));
    }
    return r;
}



var $i4bit = parcelRequire("i4bit");

var $cR4ou = parcelRequire("cR4ou");

var $kHJv6 = parcelRequire("kHJv6");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");
class $194346570a7f2661$export$b709865215a86879 {
    constructor(selection, isCopyingDown, noop){
        this._selection = selection;
        this._isCopyingDown = isCopyingDown;
        this._noop = noop || false;
        this._selectionDirection = 0 /* SelectionDirection.LTR */ ;
        this._selectionId = null;
        this._startLineNumberDelta = 0;
        this._endLineNumberDelta = 0;
    }
    getEditOperations(model, builder) {
        let s = this._selection;
        this._startLineNumberDelta = 0;
        this._endLineNumberDelta = 0;
        if (s.startLineNumber < s.endLineNumber && s.endColumn === 1) {
            this._endLineNumberDelta = 1;
            s = s.setEndPosition(s.endLineNumber - 1, model.getLineMaxColumn(s.endLineNumber - 1));
        }
        const sourceLines = [];
        for(let i = s.startLineNumber; i <= s.endLineNumber; i++)sourceLines.push(model.getLineContent(i));
        const sourceText = sourceLines.join('\n');
        if (sourceText === '') // Duplicating empty line
        {
            if (this._isCopyingDown) {
                this._startLineNumberDelta++;
                this._endLineNumberDelta++;
            }
        }
        if (this._noop) builder.addEditOperation(new (0, $d00il.Range)(s.endLineNumber, model.getLineMaxColumn(s.endLineNumber), s.endLineNumber + 1, 1), s.endLineNumber === model.getLineCount() ? '' : '\n');
        else if (!this._isCopyingDown) builder.addEditOperation(new (0, $d00il.Range)(s.endLineNumber, model.getLineMaxColumn(s.endLineNumber), s.endLineNumber, model.getLineMaxColumn(s.endLineNumber)), '\n' + sourceText);
        else builder.addEditOperation(new (0, $d00il.Range)(s.startLineNumber, 1, s.startLineNumber, 1), sourceText + '\n');
        this._selectionId = builder.trackSelection(s);
        this._selectionDirection = this._selection.getDirection();
    }
    computeCursorState(model, helper) {
        let result = helper.getTrackedSelection(this._selectionId);
        if (this._startLineNumberDelta !== 0 || this._endLineNumberDelta !== 0) {
            let startLineNumber = result.startLineNumber;
            let startColumn = result.startColumn;
            let endLineNumber = result.endLineNumber;
            let endColumn = result.endColumn;
            if (this._startLineNumberDelta !== 0) {
                startLineNumber = startLineNumber + this._startLineNumberDelta;
                startColumn = 1;
            }
            if (this._endLineNumberDelta !== 0) {
                endLineNumber = endLineNumber + this._endLineNumberDelta;
                endColumn = 1;
            }
            result = (0, $jzicX.Selection).createWithDirection(startLineNumber, startColumn, endLineNumber, endColumn, this._selectionDirection);
        }
        return result;
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $jcr1R = parcelRequire("jcr1R");

var $9S8HY = parcelRequire("9S8HY");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $IyNuh = parcelRequire("IyNuh");

var $1qkuR = parcelRequire("1qkuR");


var $cBY5u = parcelRequire("cBY5u");

var $6WzfJ = parcelRequire("6WzfJ");
var $9b55b3e3b7b0a6eb$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $9b55b3e3b7b0a6eb$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $9b55b3e3b7b0a6eb$export$14a8ecb8bc929c31 = class MoveLinesCommand {
    constructor(selection, isMovingDown, autoIndent, _languageConfigurationService){
        this._languageConfigurationService = _languageConfigurationService;
        this._selection = selection;
        this._isMovingDown = isMovingDown;
        this._autoIndent = autoIndent;
        this._selectionId = null;
        this._moveEndLineSelectionShrink = false;
    }
    getEditOperations(model, builder) {
        const getLanguageId = ()=>{
            return model.getLanguageId();
        };
        const getLanguageIdAtPosition = (lineNumber, column)=>{
            return model.getLanguageIdAtPosition(lineNumber, column);
        };
        const modelLineCount = model.getLineCount();
        if (this._isMovingDown && this._selection.endLineNumber === modelLineCount) {
            this._selectionId = builder.trackSelection(this._selection);
            return;
        }
        if (!this._isMovingDown && this._selection.startLineNumber === 1) {
            this._selectionId = builder.trackSelection(this._selection);
            return;
        }
        this._moveEndPositionDown = false;
        let s = this._selection;
        if (s.startLineNumber < s.endLineNumber && s.endColumn === 1) {
            this._moveEndPositionDown = true;
            s = s.setEndPosition(s.endLineNumber - 1, model.getLineMaxColumn(s.endLineNumber - 1));
        }
        const { tabSize: tabSize, indentSize: indentSize, insertSpaces: insertSpaces } = model.getOptions();
        const indentConverter = this.buildIndentConverter(tabSize, indentSize, insertSpaces);
        if (s.startLineNumber === s.endLineNumber && model.getLineMaxColumn(s.startLineNumber) === 1) {
            // Current line is empty
            const lineNumber = s.startLineNumber;
            const otherLineNumber = this._isMovingDown ? lineNumber + 1 : lineNumber - 1;
            if (model.getLineMaxColumn(otherLineNumber) === 1) // Other line number is empty too, so no editing is needed
            // Add a no-op to force running by the model
            builder.addEditOperation(new (0, $d00il.Range)(1, 1, 1, 1), null);
            else {
                // Type content from other line number on line number
                builder.addEditOperation(new (0, $d00il.Range)(lineNumber, 1, lineNumber, 1), model.getLineContent(otherLineNumber));
                // Remove content from other line number
                builder.addEditOperation(new (0, $d00il.Range)(otherLineNumber, 1, otherLineNumber, model.getLineMaxColumn(otherLineNumber)), null);
            }
            // Track selection at the other line number
            s = new (0, $jzicX.Selection)(otherLineNumber, 1, otherLineNumber, 1);
        } else {
            let movingLineNumber;
            let movingLineText;
            if (this._isMovingDown) {
                movingLineNumber = s.endLineNumber + 1;
                movingLineText = model.getLineContent(movingLineNumber);
                // Delete line that needs to be moved
                builder.addEditOperation(new (0, $d00il.Range)(movingLineNumber - 1, model.getLineMaxColumn(movingLineNumber - 1), movingLineNumber, model.getLineMaxColumn(movingLineNumber)), null);
                let insertingText = movingLineText;
                if (this.shouldAutoIndent(model, s)) {
                    const movingLineMatchResult = this.matchEnterRule(model, indentConverter, tabSize, movingLineNumber, s.startLineNumber - 1);
                    // if s.startLineNumber - 1 matches onEnter rule, we still honor that.
                    if (movingLineMatchResult !== null) {
                        const oldIndentation = $jcr1R.getLeadingWhitespace(model.getLineContent(movingLineNumber));
                        const newSpaceCnt = movingLineMatchResult + $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(oldIndentation, tabSize);
                        const newIndentation = $85f1c58e99f5ff47$export$f2011d4fc9157d6f(newSpaceCnt, tabSize, insertSpaces);
                        insertingText = newIndentation + this.trimStart(movingLineText);
                    } else {
                        // no enter rule matches, let's check indentatin rules then.
                        const virtualModel = {
                            tokenization: {
                                getLineTokens: (lineNumber)=>{
                                    if (lineNumber === s.startLineNumber) return model.tokenization.getLineTokens(movingLineNumber);
                                    else return model.tokenization.getLineTokens(lineNumber);
                                },
                                getLanguageId: getLanguageId,
                                getLanguageIdAtPosition: getLanguageIdAtPosition
                            },
                            getLineContent: (lineNumber)=>{
                                if (lineNumber === s.startLineNumber) return model.getLineContent(movingLineNumber);
                                else return model.getLineContent(lineNumber);
                            }
                        };
                        const indentOfMovingLine = (0, $cBY5u.getGoodIndentForLine)(this._autoIndent, virtualModel, model.getLanguageIdAtPosition(movingLineNumber, 1), s.startLineNumber, indentConverter, this._languageConfigurationService);
                        if (indentOfMovingLine !== null) {
                            const oldIndentation = $jcr1R.getLeadingWhitespace(model.getLineContent(movingLineNumber));
                            const newSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(indentOfMovingLine, tabSize);
                            const oldSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(oldIndentation, tabSize);
                            if (newSpaceCnt !== oldSpaceCnt) {
                                const newIndentation = $85f1c58e99f5ff47$export$f2011d4fc9157d6f(newSpaceCnt, tabSize, insertSpaces);
                                insertingText = newIndentation + this.trimStart(movingLineText);
                            }
                        }
                    }
                    // add edit operations for moving line first to make sure it's executed after we make indentation change
                    // to s.startLineNumber
                    builder.addEditOperation(new (0, $d00il.Range)(s.startLineNumber, 1, s.startLineNumber, 1), insertingText + '\n');
                    const ret = this.matchEnterRuleMovingDown(model, indentConverter, tabSize, s.startLineNumber, movingLineNumber, insertingText);
                    // check if the line being moved before matches onEnter rules, if so let's adjust the indentation by onEnter rules.
                    if (ret !== null) {
                        if (ret !== 0) this.getIndentEditsOfMovingBlock(model, builder, s, tabSize, insertSpaces, ret);
                    } else {
                        // it doesn't match onEnter rules, let's check indentation rules then.
                        const virtualModel = {
                            tokenization: {
                                getLineTokens: (lineNumber)=>{
                                    if (lineNumber === s.startLineNumber) // TODO@aiday-mar: the tokens here don't correspond exactly to the corresponding content (after indentation adjustment), have to fix this.
                                    return model.tokenization.getLineTokens(movingLineNumber);
                                    else if (lineNumber >= s.startLineNumber + 1 && lineNumber <= s.endLineNumber + 1) return model.tokenization.getLineTokens(lineNumber - 1);
                                    else return model.tokenization.getLineTokens(lineNumber);
                                },
                                getLanguageId: getLanguageId,
                                getLanguageIdAtPosition: getLanguageIdAtPosition
                            },
                            getLineContent: (lineNumber)=>{
                                if (lineNumber === s.startLineNumber) return insertingText;
                                else if (lineNumber >= s.startLineNumber + 1 && lineNumber <= s.endLineNumber + 1) return model.getLineContent(lineNumber - 1);
                                else return model.getLineContent(lineNumber);
                            }
                        };
                        const newIndentatOfMovingBlock = (0, $cBY5u.getGoodIndentForLine)(this._autoIndent, virtualModel, model.getLanguageIdAtPosition(movingLineNumber, 1), s.startLineNumber + 1, indentConverter, this._languageConfigurationService);
                        if (newIndentatOfMovingBlock !== null) {
                            const oldIndentation = $jcr1R.getLeadingWhitespace(model.getLineContent(s.startLineNumber));
                            const newSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(newIndentatOfMovingBlock, tabSize);
                            const oldSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(oldIndentation, tabSize);
                            if (newSpaceCnt !== oldSpaceCnt) {
                                const spaceCntOffset = newSpaceCnt - oldSpaceCnt;
                                this.getIndentEditsOfMovingBlock(model, builder, s, tabSize, insertSpaces, spaceCntOffset);
                            }
                        }
                    }
                } else // Insert line that needs to be moved before
                builder.addEditOperation(new (0, $d00il.Range)(s.startLineNumber, 1, s.startLineNumber, 1), insertingText + '\n');
            } else {
                movingLineNumber = s.startLineNumber - 1;
                movingLineText = model.getLineContent(movingLineNumber);
                // Delete line that needs to be moved
                builder.addEditOperation(new (0, $d00il.Range)(movingLineNumber, 1, movingLineNumber + 1, 1), null);
                // Insert line that needs to be moved after
                builder.addEditOperation(new (0, $d00il.Range)(s.endLineNumber, model.getLineMaxColumn(s.endLineNumber), s.endLineNumber, model.getLineMaxColumn(s.endLineNumber)), '\n' + movingLineText);
                if (this.shouldAutoIndent(model, s)) {
                    const virtualModel = {
                        tokenization: {
                            getLineTokens: (lineNumber)=>{
                                if (lineNumber === movingLineNumber) return model.tokenization.getLineTokens(s.startLineNumber);
                                else return model.tokenization.getLineTokens(lineNumber);
                            },
                            getLanguageId: getLanguageId,
                            getLanguageIdAtPosition: getLanguageIdAtPosition
                        },
                        getLineContent: (lineNumber)=>{
                            if (lineNumber === movingLineNumber) return model.getLineContent(s.startLineNumber);
                            else return model.getLineContent(lineNumber);
                        }
                    };
                    const ret = this.matchEnterRule(model, indentConverter, tabSize, s.startLineNumber, s.startLineNumber - 2);
                    // check if s.startLineNumber - 2 matches onEnter rules, if so adjust the moving block by onEnter rules.
                    if (ret !== null) {
                        if (ret !== 0) this.getIndentEditsOfMovingBlock(model, builder, s, tabSize, insertSpaces, ret);
                    } else {
                        // it doesn't match any onEnter rule, let's check indentation rules then.
                        const indentOfFirstLine = (0, $cBY5u.getGoodIndentForLine)(this._autoIndent, virtualModel, model.getLanguageIdAtPosition(s.startLineNumber, 1), movingLineNumber, indentConverter, this._languageConfigurationService);
                        if (indentOfFirstLine !== null) {
                            // adjust the indentation of the moving block
                            const oldIndent = $jcr1R.getLeadingWhitespace(model.getLineContent(s.startLineNumber));
                            const newSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(indentOfFirstLine, tabSize);
                            const oldSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(oldIndent, tabSize);
                            if (newSpaceCnt !== oldSpaceCnt) {
                                const spaceCntOffset = newSpaceCnt - oldSpaceCnt;
                                this.getIndentEditsOfMovingBlock(model, builder, s, tabSize, insertSpaces, spaceCntOffset);
                            }
                        }
                    }
                }
            }
        }
        this._selectionId = builder.trackSelection(s);
    }
    buildIndentConverter(tabSize, indentSize, insertSpaces) {
        return {
            shiftIndent: (indentation)=>{
                return (0, $9S8HY.ShiftCommand).shiftIndent(indentation, indentation.length + 1, tabSize, indentSize, insertSpaces);
            },
            unshiftIndent: (indentation)=>{
                return (0, $9S8HY.ShiftCommand).unshiftIndent(indentation, indentation.length + 1, tabSize, indentSize, insertSpaces);
            }
        };
    }
    parseEnterResult(model, indentConverter, tabSize, line, enter) {
        if (enter) {
            let enterPrefix = enter.indentation;
            if (enter.indentAction === (0, $IyNuh.IndentAction).None) enterPrefix = enter.indentation + enter.appendText;
            else if (enter.indentAction === (0, $IyNuh.IndentAction).Indent) enterPrefix = enter.indentation + enter.appendText;
            else if (enter.indentAction === (0, $IyNuh.IndentAction).IndentOutdent) enterPrefix = enter.indentation;
            else if (enter.indentAction === (0, $IyNuh.IndentAction).Outdent) enterPrefix = indentConverter.unshiftIndent(enter.indentation) + enter.appendText;
            const movingLineText = model.getLineContent(line);
            if (this.trimStart(movingLineText).indexOf(this.trimStart(enterPrefix)) >= 0) {
                const oldIndentation = $jcr1R.getLeadingWhitespace(model.getLineContent(line));
                let newIndentation = $jcr1R.getLeadingWhitespace(enterPrefix);
                const indentMetadataOfMovelingLine = (0, $cBY5u.getIndentMetadata)(model, line, this._languageConfigurationService);
                if (indentMetadataOfMovelingLine !== null && indentMetadataOfMovelingLine & 2 /* IndentConsts.DECREASE_MASK */ ) newIndentation = indentConverter.unshiftIndent(newIndentation);
                const newSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(newIndentation, tabSize);
                const oldSpaceCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(oldIndentation, tabSize);
                return newSpaceCnt - oldSpaceCnt;
            }
        }
        return null;
    }
    /**
     *
     * @param model
     * @param indentConverter
     * @param tabSize
     * @param line the line moving down
     * @param futureAboveLineNumber the line which will be at the `line` position
     * @param futureAboveLineText
     */ matchEnterRuleMovingDown(model, indentConverter, tabSize, line, futureAboveLineNumber, futureAboveLineText) {
        if ($jcr1R.lastNonWhitespaceIndex(futureAboveLineText) >= 0) {
            // break
            const maxColumn = model.getLineMaxColumn(futureAboveLineNumber);
            const enter = (0, $6WzfJ.getEnterAction)(this._autoIndent, model, new (0, $d00il.Range)(futureAboveLineNumber, maxColumn, futureAboveLineNumber, maxColumn), this._languageConfigurationService);
            return this.parseEnterResult(model, indentConverter, tabSize, line, enter);
        } else {
            // go upwards, starting from `line - 1`
            let validPrecedingLine = line - 1;
            while(validPrecedingLine >= 1){
                const lineContent = model.getLineContent(validPrecedingLine);
                const nonWhitespaceIdx = $jcr1R.lastNonWhitespaceIndex(lineContent);
                if (nonWhitespaceIdx >= 0) break;
                validPrecedingLine--;
            }
            if (validPrecedingLine < 1 || line > model.getLineCount()) return null;
            const maxColumn = model.getLineMaxColumn(validPrecedingLine);
            const enter = (0, $6WzfJ.getEnterAction)(this._autoIndent, model, new (0, $d00il.Range)(validPrecedingLine, maxColumn, validPrecedingLine, maxColumn), this._languageConfigurationService);
            return this.parseEnterResult(model, indentConverter, tabSize, line, enter);
        }
    }
    matchEnterRule(model, indentConverter, tabSize, line, oneLineAbove, previousLineText) {
        let validPrecedingLine = oneLineAbove;
        while(validPrecedingLine >= 1){
            // ship empty lines as empty lines just inherit indentation
            let lineContent;
            if (validPrecedingLine === oneLineAbove && previousLineText !== undefined) lineContent = previousLineText;
            else lineContent = model.getLineContent(validPrecedingLine);
            const nonWhitespaceIdx = $jcr1R.lastNonWhitespaceIndex(lineContent);
            if (nonWhitespaceIdx >= 0) break;
            validPrecedingLine--;
        }
        if (validPrecedingLine < 1 || line > model.getLineCount()) return null;
        const maxColumn = model.getLineMaxColumn(validPrecedingLine);
        const enter = (0, $6WzfJ.getEnterAction)(this._autoIndent, model, new (0, $d00il.Range)(validPrecedingLine, maxColumn, validPrecedingLine, maxColumn), this._languageConfigurationService);
        return this.parseEnterResult(model, indentConverter, tabSize, line, enter);
    }
    trimStart(str) {
        return str.replace(/^\s+/, '');
    }
    shouldAutoIndent(model, selection) {
        if (this._autoIndent < 4 /* EditorAutoIndentStrategy.Full */ ) return false;
        // if it's not easy to tokenize, we stop auto indent.
        if (!model.tokenization.isCheapToTokenize(selection.startLineNumber)) return false;
        const languageAtSelectionStart = model.getLanguageIdAtPosition(selection.startLineNumber, 1);
        const languageAtSelectionEnd = model.getLanguageIdAtPosition(selection.endLineNumber, 1);
        if (languageAtSelectionStart !== languageAtSelectionEnd) return false;
        if (this._languageConfigurationService.getLanguageConfiguration(languageAtSelectionStart).indentRulesSupport === null) return false;
        return true;
    }
    getIndentEditsOfMovingBlock(model, builder, s, tabSize, insertSpaces, offset) {
        for(let i = s.startLineNumber; i <= s.endLineNumber; i++){
            const lineContent = model.getLineContent(i);
            const originalIndent = $jcr1R.getLeadingWhitespace(lineContent);
            const originalSpacesCnt = $85f1c58e99f5ff47$export$e83f2438bfbc9f9b(originalIndent, tabSize);
            const newSpacesCnt = originalSpacesCnt + offset;
            const newIndent = $85f1c58e99f5ff47$export$f2011d4fc9157d6f(newSpacesCnt, tabSize, insertSpaces);
            if (newIndent !== originalIndent) {
                builder.addEditOperation(new (0, $d00il.Range)(i, 1, i, originalIndent.length + 1), newIndent);
                if (i === s.endLineNumber && s.endColumn <= originalIndent.length + 1 && newIndent === '') // as users select part of the original indent white spaces
                // when we adjust the indentation of endLine, we should adjust the cursor position as well.
                this._moveEndLineSelectionShrink = true;
            }
        }
    }
    computeCursorState(model, helper) {
        let result = helper.getTrackedSelection(this._selectionId);
        if (this._moveEndPositionDown) result = result.setEndPosition(result.endLineNumber + 1, 1);
        if (this._moveEndLineSelectionShrink && result.startLineNumber < result.endLineNumber) result = result.setEndPosition(result.endLineNumber, 2);
        return result;
    }
};
$9b55b3e3b7b0a6eb$export$14a8ecb8bc929c31 = $9b55b3e3b7b0a6eb$var$__decorate([
    $9b55b3e3b7b0a6eb$var$__param(3, (0, $1qkuR.ILanguageConfigurationService))
], $9b55b3e3b7b0a6eb$export$14a8ecb8bc929c31);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kHJv6 = parcelRequire("kHJv6");

var $d00il = parcelRequire("d00il");
class $402fb8fa976685a4$export$ba55b4b15d1da26c {
    static{
        this._COLLATOR = null;
    }
    static getCollator() {
        if (!$402fb8fa976685a4$export$ba55b4b15d1da26c._COLLATOR) $402fb8fa976685a4$export$ba55b4b15d1da26c._COLLATOR = new Intl.Collator();
        return $402fb8fa976685a4$export$ba55b4b15d1da26c._COLLATOR;
    }
    constructor(selection, descending){
        this.selection = selection;
        this.descending = descending;
        this.selectionId = null;
    }
    getEditOperations(model, builder) {
        const op = $402fb8fa976685a4$var$sortLines(model, this.selection, this.descending);
        if (op) builder.addEditOperation(op.range, op.text);
        this.selectionId = builder.trackSelection(this.selection);
    }
    computeCursorState(model, helper) {
        return helper.getTrackedSelection(this.selectionId);
    }
    static canRun(model, selection, descending) {
        if (model === null) return false;
        const data = $402fb8fa976685a4$var$getSortData(model, selection, descending);
        if (!data) return false;
        for(let i = 0, len = data.before.length; i < len; i++){
            if (data.before[i] !== data.after[i]) return true;
        }
        return false;
    }
}
function $402fb8fa976685a4$var$getSortData(model, selection, descending) {
    const startLineNumber = selection.startLineNumber;
    let endLineNumber = selection.endLineNumber;
    if (selection.endColumn === 1) endLineNumber--;
    // Nothing to sort if user didn't select anything.
    if (startLineNumber >= endLineNumber) return null;
    const linesToSort = [];
    // Get the contents of the selection to be sorted.
    for(let lineNumber = startLineNumber; lineNumber <= endLineNumber; lineNumber++)linesToSort.push(model.getLineContent(lineNumber));
    let sorted = linesToSort.slice(0);
    sorted.sort($402fb8fa976685a4$export$ba55b4b15d1da26c.getCollator().compare);
    // If descending, reverse the order.
    if (descending === true) sorted = sorted.reverse();
    return {
        startLineNumber: startLineNumber,
        endLineNumber: endLineNumber,
        before: linesToSort,
        after: sorted
    };
}
/**
 * Generate commands for sorting lines on a model.
 */ function $402fb8fa976685a4$var$sortLines(model, selection, descending) {
    const data = $402fb8fa976685a4$var$getSortData(model, selection, descending);
    if (!data) return null;
    return (0, $kHJv6.EditOperation).replace(new (0, $d00il.Range)(data.startLineNumber, 1, data.endLineNumber, model.getLineMaxColumn(data.endLineNumber)), data.after.join('\n'));
}



var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $1qkuR = parcelRequire("1qkuR");

var $35IZ9 = parcelRequire("35IZ9");
// copy lines
class $000aefaa07b501cc$var$AbstractCopyLinesAction extends (0, $2iJTi.EditorAction) {
    constructor(down, opts){
        super(opts);
        this.down = down;
    }
    run(_accessor, editor) {
        if (!editor.hasModel()) return;
        const selections = editor.getSelections().map((selection, index)=>({
                selection: selection,
                index: index,
                ignore: false
            }));
        selections.sort((a, b)=>(0, $d00il.Range).compareRangesUsingStarts(a.selection, b.selection));
        // Remove selections that would result in copying the same line
        let prev = selections[0];
        for(let i = 1; i < selections.length; i++){
            const curr = selections[i];
            if (prev.selection.endLineNumber === curr.selection.startLineNumber) {
                // these two selections would copy the same line
                if (prev.index < curr.index) // prev wins
                curr.ignore = true;
                else {
                    // curr wins
                    prev.ignore = true;
                    prev = curr;
                }
            }
        }
        const commands = [];
        for (const selection of selections)commands.push(new (0, $194346570a7f2661$export$b709865215a86879)(selection.selection, this.down, selection.ignore));
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$var$CopyLinesUpAction extends $000aefaa07b501cc$var$AbstractCopyLinesAction {
    constructor(){
        super(false, {
            id: 'editor.action.copyLinesUpAction',
            label: $4dEdH.localize('lines.copyUp', "Copy Line Up"),
            alias: 'Copy Line Up',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1552 /* KeyCode.UpArrow */ ,
                linux: {
                    primary: 3600 /* KeyCode.UpArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '2_line',
                title: $4dEdH.localize({
                    key: 'miCopyLinesUp',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Copy Line Up"),
                order: 1
            }
        });
    }
}
class $000aefaa07b501cc$var$CopyLinesDownAction extends $000aefaa07b501cc$var$AbstractCopyLinesAction {
    constructor(){
        super(true, {
            id: 'editor.action.copyLinesDownAction',
            label: $4dEdH.localize('lines.copyDown', "Copy Line Down"),
            alias: 'Copy Line Down',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1554 /* KeyCode.DownArrow */ ,
                linux: {
                    primary: 3602 /* KeyCode.DownArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '2_line',
                title: $4dEdH.localize({
                    key: 'miCopyLinesDown',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Co&&py Line Down"),
                order: 2
            }
        });
    }
}
class $000aefaa07b501cc$export$3cbca8715f2928a3 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.duplicateSelection',
            label: $4dEdH.localize('duplicateSelection', "Duplicate Selection"),
            alias: 'Duplicate Selection',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '2_line',
                title: $4dEdH.localize({
                    key: 'miDuplicateSelection',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Duplicate Selection"),
                order: 5
            }
        });
    }
    run(accessor, editor, args) {
        if (!editor.hasModel()) return;
        const commands = [];
        const selections = editor.getSelections();
        const model = editor.getModel();
        for (const selection of selections)if (selection.isEmpty()) commands.push(new (0, $194346570a7f2661$export$b709865215a86879)(selection, true));
        else {
            const insertSelection = new (0, $jzicX.Selection)(selection.endLineNumber, selection.endColumn, selection.endLineNumber, selection.endColumn);
            commands.push(new (0, $5TVJR.ReplaceCommandThatSelectsText)(insertSelection, model.getValueInRange(selection)));
        }
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
// move lines
class $000aefaa07b501cc$var$AbstractMoveLinesAction extends (0, $2iJTi.EditorAction) {
    constructor(down, opts){
        super(opts);
        this.down = down;
    }
    run(accessor, editor) {
        const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
        const commands = [];
        const selections = editor.getSelections() || [];
        const autoIndent = editor.getOption(12 /* EditorOption.autoIndent */ );
        for (const selection of selections)commands.push(new (0, $9b55b3e3b7b0a6eb$export$14a8ecb8bc929c31)(selection, this.down, autoIndent, languageConfigurationService));
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$var$MoveLinesUpAction extends $000aefaa07b501cc$var$AbstractMoveLinesAction {
    constructor(){
        super(false, {
            id: 'editor.action.moveLinesUpAction',
            label: $4dEdH.localize('lines.moveUp', "Move Line Up"),
            alias: 'Move Line Up',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 528 /* KeyCode.UpArrow */ ,
                linux: {
                    primary: 528 /* KeyCode.UpArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '2_line',
                title: $4dEdH.localize({
                    key: 'miMoveLinesUp',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Mo&&ve Line Up"),
                order: 3
            }
        });
    }
}
class $000aefaa07b501cc$var$MoveLinesDownAction extends $000aefaa07b501cc$var$AbstractMoveLinesAction {
    constructor(){
        super(true, {
            id: 'editor.action.moveLinesDownAction',
            label: $4dEdH.localize('lines.moveDown', "Move Line Down"),
            alias: 'Move Line Down',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 530 /* KeyCode.DownArrow */ ,
                linux: {
                    primary: 530 /* KeyCode.DownArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '2_line',
                title: $4dEdH.localize({
                    key: 'miMoveLinesDown',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Move &&Line Down"),
                order: 4
            }
        });
    }
}
class $000aefaa07b501cc$export$e314e63e71893b5f extends (0, $2iJTi.EditorAction) {
    constructor(descending, opts){
        super(opts);
        this.descending = descending;
    }
    run(_accessor, editor) {
        if (!editor.hasModel()) return;
        const model = editor.getModel();
        let selections = editor.getSelections();
        if (selections.length === 1 && selections[0].isEmpty()) // Apply to whole document.
        selections = [
            new (0, $jzicX.Selection)(1, 1, model.getLineCount(), model.getLineMaxColumn(model.getLineCount()))
        ];
        for (const selection of selections){
            if (!(0, $402fb8fa976685a4$export$ba55b4b15d1da26c).canRun(editor.getModel(), selection, this.descending)) return;
        }
        const commands = [];
        for(let i = 0, len = selections.length; i < len; i++)commands[i] = new (0, $402fb8fa976685a4$export$ba55b4b15d1da26c)(selections[i], this.descending);
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$export$ca6d6f27cd0b1546 extends $000aefaa07b501cc$export$e314e63e71893b5f {
    constructor(){
        super(false, {
            id: 'editor.action.sortLinesAscending',
            label: $4dEdH.localize('lines.sortAscending', "Sort Lines Ascending"),
            alias: 'Sort Lines Ascending',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
class $000aefaa07b501cc$export$f51f7f4d11319ba2 extends $000aefaa07b501cc$export$e314e63e71893b5f {
    constructor(){
        super(true, {
            id: 'editor.action.sortLinesDescending',
            label: $4dEdH.localize('lines.sortDescending', "Sort Lines Descending"),
            alias: 'Sort Lines Descending',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
class $000aefaa07b501cc$export$16d0def50a9fdfd0 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.removeDuplicateLines',
            label: $4dEdH.localize('lines.deleteDuplicates', "Delete Duplicate Lines"),
            alias: 'Delete Duplicate Lines',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    run(_accessor, editor) {
        if (!editor.hasModel()) return;
        const model = editor.getModel();
        if (model.getLineCount() === 1 && model.getLineMaxColumn(1) === 1) return;
        const edits = [];
        const endCursorState = [];
        let linesDeleted = 0;
        let updateSelection = true;
        let selections = editor.getSelections();
        if (selections.length === 1 && selections[0].isEmpty()) {
            // Apply to whole document.
            selections = [
                new (0, $jzicX.Selection)(1, 1, model.getLineCount(), model.getLineMaxColumn(model.getLineCount()))
            ];
            updateSelection = false;
        }
        for (const selection of selections){
            const uniqueLines = new Set();
            const lines = [];
            for(let i = selection.startLineNumber; i <= selection.endLineNumber; i++){
                const line = model.getLineContent(i);
                if (uniqueLines.has(line)) continue;
                lines.push(line);
                uniqueLines.add(line);
            }
            const selectionToReplace = new (0, $jzicX.Selection)(selection.startLineNumber, 1, selection.endLineNumber, model.getLineMaxColumn(selection.endLineNumber));
            const adjustedSelectionStart = selection.startLineNumber - linesDeleted;
            const finalSelection = new (0, $jzicX.Selection)(adjustedSelectionStart, 1, adjustedSelectionStart + lines.length - 1, lines[lines.length - 1].length);
            edits.push((0, $kHJv6.EditOperation).replace(selectionToReplace, lines.join('\n')));
            endCursorState.push(finalSelection);
            linesDeleted += selection.endLineNumber - selection.startLineNumber + 1 - lines.length;
        }
        editor.pushUndoStop();
        editor.executeEdits(this.id, edits, updateSelection ? endCursorState : undefined);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$export$7c2a5fb1bcba21da extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.trimTrailingWhitespace';
    }
    constructor(){
        super({
            id: $000aefaa07b501cc$export$7c2a5fb1bcba21da.ID,
            label: $4dEdH.localize('lines.trimTrailingWhitespace', "Trim Trailing Whitespace"),
            alias: 'Trim Trailing Whitespace',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2102 /* KeyCode.KeyX */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor, args) {
        let cursors = [];
        if (args.reason === 'auto-save') // See https://github.com/editorconfig/editorconfig-vscode/issues/47
        // It is very convenient for the editor config extension to invoke this action.
        // So, if we get a reason:'auto-save' passed in, let's preserve cursor positions.
        cursors = (editor.getSelections() || []).map((s)=>new (0, $dcxQ7.Position)(s.positionLineNumber, s.positionColumn));
        const selection = editor.getSelection();
        if (selection === null) return;
        const config = _accessor.get((0, $35IZ9.IConfigurationService));
        const model = editor.getModel();
        const trimInRegexAndStrings = config.getValue('files.trimTrailingWhitespaceInRegexAndStrings', {
            overrideIdentifier: model?.getLanguageId(),
            resource: model?.uri
        });
        const command = new (0, $fb94e4eefdfa3332$export$d5a264e582fa038c)(selection, cursors, trimInRegexAndStrings);
        editor.pushUndoStop();
        editor.executeCommands(this.id, [
            command
        ]);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$export$a325764c76fc5489 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.deleteLines',
            label: $4dEdH.localize('lines.delete', "Delete Line"),
            alias: 'Delete Line',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 3113 /* KeyCode.KeyK */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        if (!editor.hasModel()) return;
        const ops = this._getLinesToRemove(editor);
        const model = editor.getModel();
        if (model.getLineCount() === 1 && model.getLineMaxColumn(1) === 1) // Model is empty
        return;
        let linesDeleted = 0;
        const edits = [];
        const cursorState = [];
        for(let i = 0, len = ops.length; i < len; i++){
            const op = ops[i];
            let startLineNumber = op.startLineNumber;
            let endLineNumber = op.endLineNumber;
            let startColumn = 1;
            let endColumn = model.getLineMaxColumn(endLineNumber);
            if (endLineNumber < model.getLineCount()) {
                endLineNumber += 1;
                endColumn = 1;
            } else if (startLineNumber > 1) {
                startLineNumber -= 1;
                startColumn = model.getLineMaxColumn(startLineNumber);
            }
            edits.push((0, $kHJv6.EditOperation).replace(new (0, $jzicX.Selection)(startLineNumber, startColumn, endLineNumber, endColumn), ''));
            cursorState.push(new (0, $jzicX.Selection)(startLineNumber - linesDeleted, op.positionColumn, startLineNumber - linesDeleted, op.positionColumn));
            linesDeleted += op.endLineNumber - op.startLineNumber + 1;
        }
        editor.pushUndoStop();
        editor.executeEdits(this.id, edits, cursorState);
        editor.pushUndoStop();
    }
    _getLinesToRemove(editor) {
        // Construct delete operations
        const operations = editor.getSelections().map((s)=>{
            let endLineNumber = s.endLineNumber;
            if (s.startLineNumber < s.endLineNumber && s.endColumn === 1) endLineNumber -= 1;
            return {
                startLineNumber: s.startLineNumber,
                selectionStartColumn: s.selectionStartColumn,
                endLineNumber: endLineNumber,
                positionColumn: s.positionColumn
            };
        });
        // Sort delete operations
        operations.sort((a, b)=>{
            if (a.startLineNumber === b.startLineNumber) return a.endLineNumber - b.endLineNumber;
            return a.startLineNumber - b.startLineNumber;
        });
        // Merge delete operations which are adjacent or overlapping
        const mergedOperations = [];
        let previousOperation = operations[0];
        for(let i = 1; i < operations.length; i++)if (previousOperation.endLineNumber + 1 >= operations[i].startLineNumber) // Merge current operations into the previous one
        previousOperation.endLineNumber = operations[i].endLineNumber;
        else {
            // Push previous operation
            mergedOperations.push(previousOperation);
            previousOperation = operations[i];
        }
        // Push the last operation
        mergedOperations.push(previousOperation);
        return mergedOperations;
    }
}
class $000aefaa07b501cc$export$b16686fff98be8f7 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.indentLines',
            label: $4dEdH.localize('lines.indent', "Indent Line"),
            alias: 'Indent Line',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2142 /* KeyCode.BracketRight */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        const viewModel = editor._getViewModel();
        if (!viewModel) return;
        editor.pushUndoStop();
        editor.executeCommands(this.id, (0, $i4bit.TypeOperations).indent(viewModel.cursorConfig, editor.getModel(), editor.getSelections()));
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$var$OutdentLinesAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.outdentLines',
            label: $4dEdH.localize('lines.outdent', "Outdent Line"),
            alias: 'Outdent Line',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2140 /* KeyCode.BracketLeft */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        (0, $1uQAu.CoreEditingCommands).Outdent.runEditorCommand(_accessor, editor, null);
    }
}
class $000aefaa07b501cc$export$db5751c0accc4bcc extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.insertLineBefore',
            label: $4dEdH.localize('lines.insertBefore', "Insert Line Above"),
            alias: 'Insert Line Above',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3075 /* KeyCode.Enter */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        const viewModel = editor._getViewModel();
        if (!viewModel) return;
        editor.pushUndoStop();
        editor.executeCommands(this.id, (0, $cR4ou.EnterOperation).lineInsertBefore(viewModel.cursorConfig, editor.getModel(), editor.getSelections()));
    }
}
class $000aefaa07b501cc$export$2dd5d09a007eecf5 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.insertLineAfter',
            label: $4dEdH.localize('lines.insertAfter', "Insert Line Below"),
            alias: 'Insert Line Below',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2051 /* KeyCode.Enter */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        const viewModel = editor._getViewModel();
        if (!viewModel) return;
        editor.pushUndoStop();
        editor.executeCommands(this.id, (0, $cR4ou.EnterOperation).lineInsertAfter(viewModel.cursorConfig, editor.getModel(), editor.getSelections()));
    }
}
class $000aefaa07b501cc$export$7fdcece70613530e extends (0, $2iJTi.EditorAction) {
    run(_accessor, editor) {
        if (!editor.hasModel()) return;
        const primaryCursor = editor.getSelection();
        const rangesToDelete = this._getRangesToDelete(editor);
        // merge overlapping selections
        const effectiveRanges = [];
        for(let i = 0, count = rangesToDelete.length - 1; i < count; i++){
            const range = rangesToDelete[i];
            const nextRange = rangesToDelete[i + 1];
            if ((0, $d00il.Range).intersectRanges(range, nextRange) === null) effectiveRanges.push(range);
            else rangesToDelete[i + 1] = (0, $d00il.Range).plusRange(range, nextRange);
        }
        effectiveRanges.push(rangesToDelete[rangesToDelete.length - 1]);
        const endCursorState = this._getEndCursorState(primaryCursor, effectiveRanges);
        const edits = effectiveRanges.map((range)=>{
            return (0, $kHJv6.EditOperation).replace(range, '');
        });
        editor.pushUndoStop();
        editor.executeEdits(this.id, edits, endCursorState);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$export$9a3834b09b6983ed extends $000aefaa07b501cc$export$7fdcece70613530e {
    constructor(){
        super({
            id: 'deleteAllLeft',
            label: $4dEdH.localize('lines.deleteAllLeft', "Delete All Left"),
            alias: 'Delete All Left',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 2049 /* KeyCode.Backspace */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    _getEndCursorState(primaryCursor, rangesToDelete) {
        let endPrimaryCursor = null;
        const endCursorState = [];
        let deletedLines = 0;
        rangesToDelete.forEach((range)=>{
            let endCursor;
            if (range.endColumn === 1 && deletedLines > 0) {
                const newStartLine = range.startLineNumber - deletedLines;
                endCursor = new (0, $jzicX.Selection)(newStartLine, range.startColumn, newStartLine, range.startColumn);
            } else endCursor = new (0, $jzicX.Selection)(range.startLineNumber, range.startColumn, range.startLineNumber, range.startColumn);
            deletedLines += range.endLineNumber - range.startLineNumber;
            if (range.intersectRanges(primaryCursor)) endPrimaryCursor = endCursor;
            else endCursorState.push(endCursor);
        });
        if (endPrimaryCursor) endCursorState.unshift(endPrimaryCursor);
        return endCursorState;
    }
    _getRangesToDelete(editor) {
        const selections = editor.getSelections();
        if (selections === null) return [];
        let rangesToDelete = selections;
        const model = editor.getModel();
        if (model === null) return [];
        rangesToDelete.sort((0, $d00il.Range).compareRangesUsingStarts);
        rangesToDelete = rangesToDelete.map((selection)=>{
            if (selection.isEmpty()) {
                if (selection.startColumn === 1) {
                    const deleteFromLine = Math.max(1, selection.startLineNumber - 1);
                    const deleteFromColumn = selection.startLineNumber === 1 ? 1 : model.getLineLength(deleteFromLine) + 1;
                    return new (0, $d00il.Range)(deleteFromLine, deleteFromColumn, selection.startLineNumber, 1);
                } else return new (0, $d00il.Range)(selection.startLineNumber, 1, selection.startLineNumber, selection.startColumn);
            } else return new (0, $d00il.Range)(selection.startLineNumber, 1, selection.endLineNumber, selection.endColumn);
        });
        return rangesToDelete;
    }
}
class $000aefaa07b501cc$export$698902706bc70cc6 extends $000aefaa07b501cc$export$7fdcece70613530e {
    constructor(){
        super({
            id: 'deleteAllRight',
            label: $4dEdH.localize('lines.deleteAllRight', "Delete All Right"),
            alias: 'Delete All Right',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 297 /* KeyCode.KeyK */ ,
                    secondary: [
                        2068 /* KeyCode.Delete */ 
                    ]
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    _getEndCursorState(primaryCursor, rangesToDelete) {
        let endPrimaryCursor = null;
        const endCursorState = [];
        for(let i = 0, len = rangesToDelete.length, offset = 0; i < len; i++){
            const range = rangesToDelete[i];
            const endCursor = new (0, $jzicX.Selection)(range.startLineNumber - offset, range.startColumn, range.startLineNumber - offset, range.startColumn);
            if (range.intersectRanges(primaryCursor)) endPrimaryCursor = endCursor;
            else endCursorState.push(endCursor);
        }
        if (endPrimaryCursor) endCursorState.unshift(endPrimaryCursor);
        return endCursorState;
    }
    _getRangesToDelete(editor) {
        const model = editor.getModel();
        if (model === null) return [];
        const selections = editor.getSelections();
        if (selections === null) return [];
        const rangesToDelete = selections.map((sel)=>{
            if (sel.isEmpty()) {
                const maxColumn = model.getLineMaxColumn(sel.startLineNumber);
                if (sel.startColumn === maxColumn) return new (0, $d00il.Range)(sel.startLineNumber, sel.startColumn, sel.startLineNumber + 1, 1);
                else return new (0, $d00il.Range)(sel.startLineNumber, sel.startColumn, sel.startLineNumber, maxColumn);
            }
            return sel;
        });
        rangesToDelete.sort((0, $d00il.Range).compareRangesUsingStarts);
        return rangesToDelete;
    }
}
class $000aefaa07b501cc$export$dd737e2c91d24d1a extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.joinLines',
            label: $4dEdH.localize('lines.joinLines', "Join Lines"),
            alias: 'Join Lines',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 0,
                mac: {
                    primary: 296 /* KeyCode.KeyJ */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(_accessor, editor) {
        const selections = editor.getSelections();
        if (selections === null) return;
        let primaryCursor = editor.getSelection();
        if (primaryCursor === null) return;
        selections.sort((0, $d00il.Range).compareRangesUsingStarts);
        const reducedSelections = [];
        const lastSelection = selections.reduce((previousValue, currentValue)=>{
            if (previousValue.isEmpty()) {
                if (previousValue.endLineNumber === currentValue.startLineNumber) {
                    if (primaryCursor.equalsSelection(previousValue)) primaryCursor = currentValue;
                    return currentValue;
                }
                if (currentValue.startLineNumber > previousValue.endLineNumber + 1) {
                    reducedSelections.push(previousValue);
                    return currentValue;
                } else return new (0, $jzicX.Selection)(previousValue.startLineNumber, previousValue.startColumn, currentValue.endLineNumber, currentValue.endColumn);
            } else {
                if (currentValue.startLineNumber > previousValue.endLineNumber) {
                    reducedSelections.push(previousValue);
                    return currentValue;
                } else return new (0, $jzicX.Selection)(previousValue.startLineNumber, previousValue.startColumn, currentValue.endLineNumber, currentValue.endColumn);
            }
        });
        reducedSelections.push(lastSelection);
        const model = editor.getModel();
        if (model === null) return;
        const edits = [];
        const endCursorState = [];
        let endPrimaryCursor = primaryCursor;
        let lineOffset = 0;
        for(let i = 0, len = reducedSelections.length; i < len; i++){
            const selection = reducedSelections[i];
            const startLineNumber = selection.startLineNumber;
            const startColumn = 1;
            let columnDeltaOffset = 0;
            let endLineNumber, endColumn;
            const selectionEndPositionOffset = model.getLineLength(selection.endLineNumber) - selection.endColumn;
            if (selection.isEmpty() || selection.startLineNumber === selection.endLineNumber) {
                const position = selection.getStartPosition();
                if (position.lineNumber < model.getLineCount()) {
                    endLineNumber = startLineNumber + 1;
                    endColumn = model.getLineMaxColumn(endLineNumber);
                } else {
                    endLineNumber = position.lineNumber;
                    endColumn = model.getLineMaxColumn(position.lineNumber);
                }
            } else {
                endLineNumber = selection.endLineNumber;
                endColumn = model.getLineMaxColumn(endLineNumber);
            }
            let trimmedLinesContent = model.getLineContent(startLineNumber);
            for(let i = startLineNumber + 1; i <= endLineNumber; i++){
                const lineText = model.getLineContent(i);
                const firstNonWhitespaceIdx = model.getLineFirstNonWhitespaceColumn(i);
                if (firstNonWhitespaceIdx >= 1) {
                    let insertSpace = true;
                    if (trimmedLinesContent === '') insertSpace = false;
                    if (insertSpace && (trimmedLinesContent.charAt(trimmedLinesContent.length - 1) === ' ' || trimmedLinesContent.charAt(trimmedLinesContent.length - 1) === '\t')) {
                        insertSpace = false;
                        trimmedLinesContent = trimmedLinesContent.replace(/[\s\uFEFF\xA0]+$/g, ' ');
                    }
                    const lineTextWithoutIndent = lineText.substr(firstNonWhitespaceIdx - 1);
                    trimmedLinesContent += (insertSpace ? ' ' : '') + lineTextWithoutIndent;
                    if (insertSpace) columnDeltaOffset = lineTextWithoutIndent.length + 1;
                    else columnDeltaOffset = lineTextWithoutIndent.length;
                } else columnDeltaOffset = 0;
            }
            const deleteSelection = new (0, $d00il.Range)(startLineNumber, startColumn, endLineNumber, endColumn);
            if (!deleteSelection.isEmpty()) {
                let resultSelection;
                if (selection.isEmpty()) {
                    edits.push((0, $kHJv6.EditOperation).replace(deleteSelection, trimmedLinesContent));
                    resultSelection = new (0, $jzicX.Selection)(deleteSelection.startLineNumber - lineOffset, trimmedLinesContent.length - columnDeltaOffset + 1, startLineNumber - lineOffset, trimmedLinesContent.length - columnDeltaOffset + 1);
                } else if (selection.startLineNumber === selection.endLineNumber) {
                    edits.push((0, $kHJv6.EditOperation).replace(deleteSelection, trimmedLinesContent));
                    resultSelection = new (0, $jzicX.Selection)(selection.startLineNumber - lineOffset, selection.startColumn, selection.endLineNumber - lineOffset, selection.endColumn);
                } else {
                    edits.push((0, $kHJv6.EditOperation).replace(deleteSelection, trimmedLinesContent));
                    resultSelection = new (0, $jzicX.Selection)(selection.startLineNumber - lineOffset, selection.startColumn, selection.startLineNumber - lineOffset, trimmedLinesContent.length - selectionEndPositionOffset);
                }
                if ((0, $d00il.Range).intersectRanges(deleteSelection, primaryCursor) !== null) endPrimaryCursor = resultSelection;
                else endCursorState.push(resultSelection);
            }
            lineOffset += deleteSelection.endLineNumber - deleteSelection.startLineNumber;
        }
        endCursorState.unshift(endPrimaryCursor);
        editor.pushUndoStop();
        editor.executeEdits(this.id, edits, endCursorState);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$export$30796fb0d031fb22 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.transpose',
            label: $4dEdH.localize('editor.transpose', "Transpose Characters around the Cursor"),
            alias: 'Transpose Characters around the Cursor',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    run(_accessor, editor) {
        const selections = editor.getSelections();
        if (selections === null) return;
        const model = editor.getModel();
        if (model === null) return;
        const commands = [];
        for(let i = 0, len = selections.length; i < len; i++){
            const selection = selections[i];
            if (!selection.isEmpty()) continue;
            const cursor = selection.getStartPosition();
            const maxColumn = model.getLineMaxColumn(cursor.lineNumber);
            if (cursor.column >= maxColumn) {
                if (cursor.lineNumber === model.getLineCount()) continue;
                // The cursor is at the end of current line and current line is not empty
                // then we transpose the character before the cursor and the line break if there is any following line.
                const deleteSelection = new (0, $d00il.Range)(cursor.lineNumber, Math.max(1, cursor.column - 1), cursor.lineNumber + 1, 1);
                const chars = model.getValueInRange(deleteSelection).split('').reverse().join('');
                commands.push(new (0, $5TVJR.ReplaceCommand)(new (0, $jzicX.Selection)(cursor.lineNumber, Math.max(1, cursor.column - 1), cursor.lineNumber + 1, 1), chars));
            } else {
                const deleteSelection = new (0, $d00il.Range)(cursor.lineNumber, Math.max(1, cursor.column - 1), cursor.lineNumber, cursor.column + 1);
                const chars = model.getValueInRange(deleteSelection).split('').reverse().join('');
                commands.push(new (0, $5TVJR.ReplaceCommandThatPreservesSelection)(deleteSelection, chars, new (0, $jzicX.Selection)(cursor.lineNumber, cursor.column + 1, cursor.lineNumber, cursor.column + 1)));
            }
        }
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$export$4aaeafa0e9d33d8d extends (0, $2iJTi.EditorAction) {
    run(_accessor, editor) {
        const selections = editor.getSelections();
        if (selections === null) return;
        const model = editor.getModel();
        if (model === null) return;
        const wordSeparators = editor.getOption(132 /* EditorOption.wordSeparators */ );
        const textEdits = [];
        for (const selection of selections)if (selection.isEmpty()) {
            const cursor = selection.getStartPosition();
            const word = editor.getConfiguredWordAtPosition(cursor);
            if (!word) continue;
            const wordRange = new (0, $d00il.Range)(cursor.lineNumber, word.startColumn, cursor.lineNumber, word.endColumn);
            const text = model.getValueInRange(wordRange);
            textEdits.push((0, $kHJv6.EditOperation).replace(wordRange, this._modifyText(text, wordSeparators)));
        } else {
            const text = model.getValueInRange(selection);
            textEdits.push((0, $kHJv6.EditOperation).replace(selection, this._modifyText(text, wordSeparators)));
        }
        editor.pushUndoStop();
        editor.executeEdits(this.id, textEdits);
        editor.pushUndoStop();
    }
}
class $000aefaa07b501cc$export$952432f59b47d01d extends $000aefaa07b501cc$export$4aaeafa0e9d33d8d {
    constructor(){
        super({
            id: 'editor.action.transformToUppercase',
            label: $4dEdH.localize('editor.transformToUppercase', "Transform to Uppercase"),
            alias: 'Transform to Uppercase',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    _modifyText(text, wordSeparators) {
        return text.toLocaleUpperCase();
    }
}
class $000aefaa07b501cc$export$f2f207fda3be448e extends $000aefaa07b501cc$export$4aaeafa0e9d33d8d {
    constructor(){
        super({
            id: 'editor.action.transformToLowercase',
            label: $4dEdH.localize('editor.transformToLowercase', "Transform to Lowercase"),
            alias: 'Transform to Lowercase',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    _modifyText(text, wordSeparators) {
        return text.toLocaleLowerCase();
    }
}
class $000aefaa07b501cc$var$BackwardsCompatibleRegExp {
    constructor(_pattern, _flags){
        this._pattern = _pattern;
        this._flags = _flags;
        this._actual = null;
        this._evaluated = false;
    }
    get() {
        if (!this._evaluated) {
            this._evaluated = true;
            try {
                this._actual = new RegExp(this._pattern, this._flags);
            } catch (err) {
            // this browser does not support this regular expression
            }
        }
        return this._actual;
    }
    isSupported() {
        return this.get() !== null;
    }
}
class $000aefaa07b501cc$export$9e3e216230e0d173 extends $000aefaa07b501cc$export$4aaeafa0e9d33d8d {
    static{
        this.titleBoundary = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('(^|[^\\p{L}\\p{N}\']|((^|\\P{L})\'))\\p{L}', 'gmu');
    }
    constructor(){
        super({
            id: 'editor.action.transformToTitlecase',
            label: $4dEdH.localize('editor.transformToTitlecase', "Transform to Title Case"),
            alias: 'Transform to Title Case',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    _modifyText(text, wordSeparators) {
        const titleBoundary = $000aefaa07b501cc$export$9e3e216230e0d173.titleBoundary.get();
        if (!titleBoundary) // cannot support this
        return text;
        return text.toLocaleLowerCase().replace(titleBoundary, (b)=>b.toLocaleUpperCase());
    }
}
class $000aefaa07b501cc$export$120f47daedc39d47 extends $000aefaa07b501cc$export$4aaeafa0e9d33d8d {
    static{
        this.caseBoundary = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('(\\p{Ll})(\\p{Lu})', 'gmu');
    }
    static{
        this.singleLetters = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})', 'gmu');
    }
    constructor(){
        super({
            id: 'editor.action.transformToSnakecase',
            label: $4dEdH.localize('editor.transformToSnakecase', "Transform to Snake Case"),
            alias: 'Transform to Snake Case',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    _modifyText(text, wordSeparators) {
        const caseBoundary = $000aefaa07b501cc$export$120f47daedc39d47.caseBoundary.get();
        const singleLetters = $000aefaa07b501cc$export$120f47daedc39d47.singleLetters.get();
        if (!caseBoundary || !singleLetters) // cannot support this
        return text;
        return text.replace(caseBoundary, '$1_$2').replace(singleLetters, '$1_$2$3').toLocaleLowerCase();
    }
}
class $000aefaa07b501cc$export$2f4344999e08d94f extends $000aefaa07b501cc$export$4aaeafa0e9d33d8d {
    static{
        this.wordBoundary = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('[_\\s-]', 'gm');
    }
    constructor(){
        super({
            id: 'editor.action.transformToCamelcase',
            label: $4dEdH.localize('editor.transformToCamelcase', "Transform to Camel Case"),
            alias: 'Transform to Camel Case',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    _modifyText(text, wordSeparators) {
        const wordBoundary = $000aefaa07b501cc$export$2f4344999e08d94f.wordBoundary.get();
        if (!wordBoundary) // cannot support this
        return text;
        const words = text.split(wordBoundary);
        const firstWord = words.shift();
        return firstWord + words.map((word)=>word.substring(0, 1).toLocaleUpperCase() + word.substring(1)).join('');
    }
}
class $000aefaa07b501cc$export$e38e286d5d7ad5ac extends $000aefaa07b501cc$export$4aaeafa0e9d33d8d {
    static{
        this.wordBoundary = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('[_\\s-]', 'gm');
    }
    static{
        this.wordBoundaryToMaintain = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('(?<=\\.)', 'gm');
    }
    constructor(){
        super({
            id: 'editor.action.transformToPascalcase',
            label: $4dEdH.localize('editor.transformToPascalcase', "Transform to Pascal Case"),
            alias: 'Transform to Pascal Case',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    _modifyText(text, wordSeparators) {
        const wordBoundary = $000aefaa07b501cc$export$e38e286d5d7ad5ac.wordBoundary.get();
        const wordBoundaryToMaintain = $000aefaa07b501cc$export$e38e286d5d7ad5ac.wordBoundaryToMaintain.get();
        if (!wordBoundary || !wordBoundaryToMaintain) // cannot support this
        return text;
        const wordsWithMaintainBoundaries = text.split(wordBoundaryToMaintain);
        const words = wordsWithMaintainBoundaries.map((word)=>word.split(wordBoundary)).flat();
        return words.map((word)=>word.substring(0, 1).toLocaleUpperCase() + word.substring(1)).join('');
    }
}
class $000aefaa07b501cc$export$19ec3d8e9a5b76f4 extends $000aefaa07b501cc$export$4aaeafa0e9d33d8d {
    static isSupported() {
        const areAllRegexpsSupported = [
            this.caseBoundary,
            this.singleLetters,
            this.underscoreBoundary
        ].every((regexp)=>regexp.isSupported());
        return areAllRegexpsSupported;
    }
    static{
        this.caseBoundary = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('(\\p{Ll})(\\p{Lu})', 'gmu');
    }
    static{
        this.singleLetters = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})', 'gmu');
    }
    static{
        this.underscoreBoundary = new $000aefaa07b501cc$var$BackwardsCompatibleRegExp('(\\S)(_)(\\S)', 'gm');
    }
    constructor(){
        super({
            id: 'editor.action.transformToKebabcase',
            label: $4dEdH.localize('editor.transformToKebabcase', 'Transform to Kebab Case'),
            alias: 'Transform to Kebab Case',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    _modifyText(text, _) {
        const caseBoundary = $000aefaa07b501cc$export$19ec3d8e9a5b76f4.caseBoundary.get();
        const singleLetters = $000aefaa07b501cc$export$19ec3d8e9a5b76f4.singleLetters.get();
        const underscoreBoundary = $000aefaa07b501cc$export$19ec3d8e9a5b76f4.underscoreBoundary.get();
        if (!caseBoundary || !singleLetters || !underscoreBoundary) // one or more regexps aren't supported
        return text;
        return text.replace(underscoreBoundary, '$1-$3').replace(caseBoundary, '$1-$2').replace(singleLetters, '$1-$2').toLocaleLowerCase();
    }
}
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$var$CopyLinesUpAction);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$var$CopyLinesDownAction);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$3cbca8715f2928a3);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$var$MoveLinesUpAction);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$var$MoveLinesDownAction);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$ca6d6f27cd0b1546);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$f51f7f4d11319ba2);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$16d0def50a9fdfd0);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$7c2a5fb1bcba21da);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$a325764c76fc5489);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$b16686fff98be8f7);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$var$OutdentLinesAction);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$db5751c0accc4bcc);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$2dd5d09a007eecf5);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$9a3834b09b6983ed);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$698902706bc70cc6);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$dd737e2c91d24d1a);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$30796fb0d031fb22);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$952432f59b47d01d);
(0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$f2f207fda3be448e);
if ($000aefaa07b501cc$export$120f47daedc39d47.caseBoundary.isSupported() && $000aefaa07b501cc$export$120f47daedc39d47.singleLetters.isSupported()) (0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$120f47daedc39d47);
if ($000aefaa07b501cc$export$2f4344999e08d94f.wordBoundary.isSupported()) (0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$2f4344999e08d94f);
if ($000aefaa07b501cc$export$e38e286d5d7ad5ac.wordBoundary.isSupported()) (0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$e38e286d5d7ad5ac);
if ($000aefaa07b501cc$export$9e3e216230e0d173.titleBoundary.isSupported()) (0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$9e3e216230e0d173);
if ($000aefaa07b501cc$export$19ec3d8e9a5b76f4.isSupported()) (0, $2iJTi.registerEditorAction)($000aefaa07b501cc$export$19ec3d8e9a5b76f4);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $bjjQO = parcelRequire("bjjQO");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $5OJ54 = parcelRequire("5OJ54");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $91ntV = parcelRequire("91ntV");

var $1qkuR = parcelRequire("1qkuR");

var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $4J6fu = parcelRequire("4J6fu");

var $gaWeX = parcelRequire("gaWeX");

var $goG89 = parcelRequire("goG89");

var $eUQTM = parcelRequire("eUQTM");

var $8ef362ab4ccb00fe$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $8ef362ab4ccb00fe$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $8ef362ab4ccb00fe$var$LinkedEditingContribution_1;
const $8ef362ab4ccb00fe$export$d3411856fe5ceb08 = new (0, $cxCeF.RawContextKey)('LinkedEditingInputVisible', false);
const $8ef362ab4ccb00fe$var$DECORATION_CLASS_NAME = 'linked-editing-decoration';
let $8ef362ab4ccb00fe$export$6a78bc49d64aa850 = class LinkedEditingContribution extends (0, $9cWcn.Disposable) {
    static{
        $8ef362ab4ccb00fe$var$LinkedEditingContribution_1 = this;
    }
    static{
        this.ID = 'editor.contrib.linkedEditing';
    }
    static{
        this.DECORATION = (0, $91ntV.ModelDecorationOptions).register({
            description: 'linked-editing',
            stickiness: 0 /* TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges */ ,
            className: $8ef362ab4ccb00fe$var$DECORATION_CLASS_NAME
        });
    }
    static get(editor) {
        return editor.getContribution($8ef362ab4ccb00fe$var$LinkedEditingContribution_1.ID);
    }
    constructor(editor, contextKeyService, languageFeaturesService, languageConfigurationService, languageFeatureDebounceService){
        super();
        this.languageConfigurationService = languageConfigurationService;
        this._syncRangesToken = 0;
        this._localToDispose = this._register(new (0, $9cWcn.DisposableStore)());
        this._editor = editor;
        this._providers = languageFeaturesService.linkedEditingRangeProvider;
        this._enabled = false;
        this._visibleContextKey = $8ef362ab4ccb00fe$export$d3411856fe5ceb08.bindTo(contextKeyService);
        this._debounceInformation = languageFeatureDebounceService.for(this._providers, 'Linked Editing', {
            max: 200
        });
        this._currentDecorations = this._editor.createDecorationsCollection();
        this._languageWordPattern = null;
        this._currentWordPattern = null;
        this._ignoreChangeEvent = false;
        this._localToDispose = this._register(new (0, $9cWcn.DisposableStore)());
        this._rangeUpdateTriggerPromise = null;
        this._rangeSyncTriggerPromise = null;
        this._currentRequestCts = null;
        this._currentRequestPosition = null;
        this._currentRequestModelVersion = null;
        this._register(this._editor.onDidChangeModel(()=>this.reinitialize(true)));
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(70 /* EditorOption.linkedEditing */ ) || e.hasChanged(94 /* EditorOption.renameOnType */ )) this.reinitialize(false);
        }));
        this._register(this._providers.onDidChange(()=>this.reinitialize(false)));
        this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(true)));
        this.reinitialize(true);
    }
    reinitialize(forceRefresh) {
        const model = this._editor.getModel();
        const isEnabled = model !== null && (this._editor.getOption(70 /* EditorOption.linkedEditing */ ) || this._editor.getOption(94 /* EditorOption.renameOnType */ )) && this._providers.has(model);
        if (isEnabled === this._enabled && !forceRefresh) return;
        this._enabled = isEnabled;
        this.clearRanges();
        this._localToDispose.clear();
        if (!isEnabled || model === null) return;
        this._localToDispose.add((0, $5YaSO.Event).runAndSubscribe(model.onDidChangeLanguageConfiguration, ()=>{
            this._languageWordPattern = this.languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getWordDefinition();
        }));
        const rangeUpdateScheduler = new (0, $6bXyA.Delayer)(this._debounceInformation.get(model));
        const triggerRangeUpdate = ()=>{
            this._rangeUpdateTriggerPromise = rangeUpdateScheduler.trigger(()=>this.updateRanges(), this._debounceDuration ?? this._debounceInformation.get(model));
        };
        const rangeSyncScheduler = new (0, $6bXyA.Delayer)(0);
        const triggerRangeSync = (token)=>{
            this._rangeSyncTriggerPromise = rangeSyncScheduler.trigger(()=>this._syncRanges(token));
        };
        this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{
            triggerRangeUpdate();
        }));
        this._localToDispose.add(this._editor.onDidChangeModelContent((e)=>{
            if (!this._ignoreChangeEvent) {
                if (this._currentDecorations.length > 0) {
                    const referenceRange = this._currentDecorations.getRange(0);
                    if (referenceRange && e.changes.every((c)=>referenceRange.intersectRanges(c.range))) {
                        triggerRangeSync(this._syncRangesToken);
                        return;
                    }
                }
            }
            triggerRangeUpdate();
        }));
        this._localToDispose.add({
            dispose: ()=>{
                rangeUpdateScheduler.dispose();
                rangeSyncScheduler.dispose();
            }
        });
        this.updateRanges();
    }
    _syncRanges(token) {
        // delayed invocation, make sure we're still on
        if (!this._editor.hasModel() || token !== this._syncRangesToken || this._currentDecorations.length === 0) // nothing to do
        return;
        const model = this._editor.getModel();
        const referenceRange = this._currentDecorations.getRange(0);
        if (!referenceRange || referenceRange.startLineNumber !== referenceRange.endLineNumber) return this.clearRanges();
        const referenceValue = model.getValueInRange(referenceRange);
        if (this._currentWordPattern) {
            const match = referenceValue.match(this._currentWordPattern);
            const matchLength = match ? match[0].length : 0;
            if (matchLength !== referenceValue.length) return this.clearRanges();
        }
        const edits = [];
        for(let i = 1, len = this._currentDecorations.length; i < len; i++){
            const mirrorRange = this._currentDecorations.getRange(i);
            if (!mirrorRange) continue;
            if (mirrorRange.startLineNumber !== mirrorRange.endLineNumber) edits.push({
                range: mirrorRange,
                text: referenceValue
            });
            else {
                let oldValue = model.getValueInRange(mirrorRange);
                let newValue = referenceValue;
                let rangeStartColumn = mirrorRange.startColumn;
                let rangeEndColumn = mirrorRange.endColumn;
                const commonPrefixLength = $jcr1R.commonPrefixLength(oldValue, newValue);
                rangeStartColumn += commonPrefixLength;
                oldValue = oldValue.substr(commonPrefixLength);
                newValue = newValue.substr(commonPrefixLength);
                const commonSuffixLength = $jcr1R.commonSuffixLength(oldValue, newValue);
                rangeEndColumn -= commonSuffixLength;
                oldValue = oldValue.substr(0, oldValue.length - commonSuffixLength);
                newValue = newValue.substr(0, newValue.length - commonSuffixLength);
                if (rangeStartColumn !== rangeEndColumn || newValue.length !== 0) edits.push({
                    range: new (0, $d00il.Range)(mirrorRange.startLineNumber, rangeStartColumn, mirrorRange.endLineNumber, rangeEndColumn),
                    text: newValue
                });
            }
        }
        if (edits.length === 0) return;
        try {
            this._editor.popUndoStop();
            this._ignoreChangeEvent = true;
            const prevEditOperationType = this._editor._getViewModel().getPrevEditOperationType();
            this._editor.executeEdits('linkedEditing', edits);
            this._editor._getViewModel().setPrevEditOperationType(prevEditOperationType);
        } finally{
            this._ignoreChangeEvent = false;
        }
    }
    dispose() {
        this.clearRanges();
        super.dispose();
    }
    clearRanges() {
        this._visibleContextKey.set(false);
        this._currentDecorations.clear();
        if (this._currentRequestCts) {
            this._currentRequestCts.cancel();
            this._currentRequestCts = null;
            this._currentRequestPosition = null;
        }
    }
    async updateRanges(force = false) {
        if (!this._editor.hasModel()) {
            this.clearRanges();
            return;
        }
        const position = this._editor.getPosition();
        if (!this._enabled && !force || this._editor.getSelections().length > 1) {
            // disabled or multicursor
            this.clearRanges();
            return;
        }
        const model = this._editor.getModel();
        const modelVersionId = model.getVersionId();
        if (this._currentRequestPosition && this._currentRequestModelVersion === modelVersionId) {
            if (position.equals(this._currentRequestPosition)) return; // same position
            if (this._currentDecorations.length > 0) {
                const range = this._currentDecorations.getRange(0);
                if (range && range.containsPosition(position)) return; // just moving inside the existing primary range
            }
        }
        // Clear existing decorations while we compute new ones
        this.clearRanges();
        this._currentRequestPosition = position;
        this._currentRequestModelVersion = modelVersionId;
        const currentRequestCts = this._currentRequestCts = new (0, $giPcZ.CancellationTokenSource)();
        try {
            const sw = new (0, $eUQTM.StopWatch)(false);
            const response = await $8ef362ab4ccb00fe$var$getLinkedEditingRanges(this._providers, model, position, currentRequestCts.token);
            this._debounceInformation.update(model, sw.elapsed());
            if (currentRequestCts !== this._currentRequestCts) return;
            this._currentRequestCts = null;
            if (modelVersionId !== model.getVersionId()) return;
            let ranges = [];
            if (response?.ranges) ranges = response.ranges;
            this._currentWordPattern = response?.wordPattern || this._languageWordPattern;
            let foundReferenceRange = false;
            for(let i = 0, len = ranges.length; i < len; i++)if ((0, $d00il.Range).containsPosition(ranges[i], position)) {
                foundReferenceRange = true;
                if (i !== 0) {
                    const referenceRange = ranges[i];
                    ranges.splice(i, 1);
                    ranges.unshift(referenceRange);
                }
                break;
            }
            if (!foundReferenceRange) {
                // Cannot do linked editing if the ranges are not where the cursor is...
                this.clearRanges();
                return;
            }
            const decorations = ranges.map((range)=>({
                    range: range,
                    options: $8ef362ab4ccb00fe$var$LinkedEditingContribution_1.DECORATION
                }));
            this._visibleContextKey.set(true);
            this._currentDecorations.set(decorations);
            this._syncRangesToken++; // cancel any pending syncRanges call
        } catch (err) {
            if (!(0, $gPkHZ.isCancellationError)(err)) (0, $gPkHZ.onUnexpectedError)(err);
            if (this._currentRequestCts === currentRequestCts || !this._currentRequestCts) // stop if we are still the latest request
            this.clearRanges();
        }
    }
};
$8ef362ab4ccb00fe$export$6a78bc49d64aa850 = $8ef362ab4ccb00fe$var$LinkedEditingContribution_1 = $8ef362ab4ccb00fe$var$__decorate([
    $8ef362ab4ccb00fe$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $8ef362ab4ccb00fe$var$__param(2, (0, $4J6fu.ILanguageFeaturesService)),
    $8ef362ab4ccb00fe$var$__param(3, (0, $1qkuR.ILanguageConfigurationService)),
    $8ef362ab4ccb00fe$var$__param(4, (0, $goG89.ILanguageFeatureDebounceService))
], $8ef362ab4ccb00fe$export$6a78bc49d64aa850);
class $8ef362ab4ccb00fe$export$3ac885947f0e79d7 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.linkedEditing',
            label: $4dEdH.localize('linkedEditing.label', "Start Linked Editing"),
            alias: 'Start Linked Editing',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasRenameProvider),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3132 /* KeyCode.F2 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    runCommand(accessor, args) {
        const editorService = accessor.get((0, $2Qfl0.ICodeEditorService));
        const [uri, pos] = Array.isArray(args) && args || [
            undefined,
            undefined
        ];
        if ((0, $5OJ54.URI).isUri(uri) && (0, $dcxQ7.Position).isIPosition(pos)) return editorService.openCodeEditor({
            resource: uri
        }, editorService.getActiveCodeEditor()).then((editor)=>{
            if (!editor) return;
            editor.setPosition(pos);
            editor.invokeWithinContext((accessor)=>{
                this.reportTelemetry(accessor, editor);
                return this.run(accessor, editor);
            });
        }, (0, $gPkHZ.onUnexpectedError));
        return super.runCommand(accessor, args);
    }
    run(_accessor, editor) {
        const controller = $8ef362ab4ccb00fe$export$6a78bc49d64aa850.get(editor);
        if (controller) return Promise.resolve(controller.updateRanges(true));
        return Promise.resolve();
    }
}
const $8ef362ab4ccb00fe$var$LinkedEditingCommand = (0, $2iJTi.EditorCommand).bindToContribution($8ef362ab4ccb00fe$export$6a78bc49d64aa850.get);
(0, $2iJTi.registerEditorCommand)(new $8ef362ab4ccb00fe$var$LinkedEditingCommand({
    id: 'cancelLinkedEditingInput',
    precondition: $8ef362ab4ccb00fe$export$d3411856fe5ceb08,
    handler: (x)=>x.clearRanges(),
    kbOpts: {
        kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
        weight: 199,
        primary: 9 /* KeyCode.Escape */ ,
        secondary: [
            1033 /* KeyCode.Escape */ 
        ]
    }
}));
function $8ef362ab4ccb00fe$var$getLinkedEditingRanges(providers, model, position, token) {
    const orderedByScore = providers.ordered(model);
    // in order of score ask the linked editing range provider
    // until someone response with a good result
    // (good = not null)
    return (0, $6bXyA.first)(orderedByScore.map((provider)=>async ()=>{
            try {
                return await provider.provideLinkedEditingRanges(model, position, token);
            } catch (e) {
                (0, $gPkHZ.onUnexpectedExternalError)(e);
                return undefined;
            }
        }), (result)=>!!result && $kJ8UG.isNonEmptyArray(result?.ranges));
}
const $8ef362ab4ccb00fe$export$f1351e4f55b397f4 = (0, $gaWeX.registerColor)('editor.linkedEditingBackground', {
    dark: (0, $bjjQO.Color).fromHex('#f00').transparent(0.3),
    light: (0, $bjjQO.Color).fromHex('#f00').transparent(0.3),
    hcDark: (0, $bjjQO.Color).fromHex('#f00').transparent(0.3),
    hcLight: (0, $bjjQO.Color).white
}, $4dEdH.localize('editorLinkedEditingBackground', 'Background color when the editor auto renames on type.'));
(0, $2iJTi.registerModelAndPositionCommand)('_executeLinkedEditingProvider', (_accessor, model, position)=>{
    const { linkedEditingRangeProvider: linkedEditingRangeProvider } = _accessor.get((0, $4J6fu.ILanguageFeaturesService));
    return $8ef362ab4ccb00fe$var$getLinkedEditingRanges(linkedEditingRangeProvider, model, position, (0, $giPcZ.CancellationToken).None);
});
(0, $2iJTi.registerEditorContribution)($8ef362ab4ccb00fe$export$6a78bc49d64aa850.ID, $8ef362ab4ccb00fe$export$6a78bc49d64aa850, 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $2iJTi.registerEditorAction)($8ef362ab4ccb00fe$export$3ac885947f0e79d7);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");

var $8GPp8 = parcelRequire("8GPp8");

var $lb0Ah = parcelRequire("lb0Ah");

var $5Aea5 = parcelRequire("5Aea5");

var $eUQTM = parcelRequire("eUQTM");

var $5OJ54 = parcelRequire("5OJ54");


var $2iJTi = parcelRequire("2iJTi");

var $91ntV = parcelRequire("91ntV");

var $goG89 = parcelRequire("goG89");

var $4J6fu = parcelRequire("4J6fu");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $d00il = parcelRequire("d00il");

var $cKKJT = parcelRequire("cKKJT");

var $8tcMz = parcelRequire("8tcMz");

var $4J6fu = parcelRequire("4J6fu");
class $6a0fb5989a2c32ed$export$a6c7ac8248d6e38a {
    constructor(link, provider){
        this._link = link;
        this._provider = provider;
    }
    toJSON() {
        return {
            range: this.range,
            url: this.url,
            tooltip: this.tooltip
        };
    }
    get range() {
        return this._link.range;
    }
    get url() {
        return this._link.url;
    }
    get tooltip() {
        return this._link.tooltip;
    }
    async resolve(token) {
        if (this._link.url) return this._link.url;
        if (typeof this._provider.resolveLink === 'function') return Promise.resolve(this._provider.resolveLink(this._link, token)).then((value)=>{
            this._link = value || this._link;
            if (this._link.url) // recurse
            return this.resolve(token);
            return Promise.reject(new Error('missing'));
        });
        return Promise.reject(new Error('missing'));
    }
}
class $6a0fb5989a2c32ed$export$adce7cd866adc18b {
    constructor(tuples){
        this._disposables = new (0, $9cWcn.DisposableStore)();
        let links = [];
        for (const [list, provider] of tuples){
            // merge all links
            const newLinks = list.links.map((link)=>new $6a0fb5989a2c32ed$export$a6c7ac8248d6e38a(link, provider));
            links = $6a0fb5989a2c32ed$export$adce7cd866adc18b._union(links, newLinks);
            // register disposables
            if ((0, $9cWcn.isDisposable)(list)) this._disposables.add(list);
        }
        this.links = links;
    }
    dispose() {
        this._disposables.dispose();
        this.links.length = 0;
    }
    static _union(oldLinks, newLinks) {
        // reunite oldLinks with newLinks and remove duplicates
        const result = [];
        let oldIndex;
        let oldLen;
        let newIndex;
        let newLen;
        for(oldIndex = 0, newIndex = 0, oldLen = oldLinks.length, newLen = newLinks.length; oldIndex < oldLen && newIndex < newLen;){
            const oldLink = oldLinks[oldIndex];
            const newLink = newLinks[newIndex];
            if ((0, $d00il.Range).areIntersectingOrTouching(oldLink.range, newLink.range)) {
                // Remove the oldLink
                oldIndex++;
                continue;
            }
            const comparisonResult = (0, $d00il.Range).compareRangesUsingStarts(oldLink.range, newLink.range);
            if (comparisonResult < 0) {
                // oldLink is before
                result.push(oldLink);
                oldIndex++;
            } else {
                // newLink is before
                result.push(newLink);
                newIndex++;
            }
        }
        for(; oldIndex < oldLen; oldIndex++)result.push(oldLinks[oldIndex]);
        for(; newIndex < newLen; newIndex++)result.push(newLinks[newIndex]);
        return result;
    }
}
function $6a0fb5989a2c32ed$export$8054dcb2b42da45c(providers, model, token) {
    const lists = [];
    // ask all providers for links in parallel
    const promises = providers.ordered(model).reverse().map((provider, i)=>{
        return Promise.resolve(provider.provideLinks(model, token)).then((result)=>{
            if (result) lists[i] = [
                result,
                provider
            ];
        }, (0, $gPkHZ.onUnexpectedExternalError));
    });
    return Promise.all(promises).then(()=>{
        const result = new $6a0fb5989a2c32ed$export$adce7cd866adc18b((0, $kJ8UG.coalesce)(lists));
        if (!token.isCancellationRequested) return result;
        result.dispose();
        return new $6a0fb5989a2c32ed$export$adce7cd866adc18b([]);
    });
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeLinkProvider', async (accessor, ...args)=>{
    let [uri, resolveCount] = args;
    (0, $bxBg7.assertType)(uri instanceof (0, $5OJ54.URI));
    if (typeof resolveCount !== 'number') resolveCount = 0;
    const { linkProvider: linkProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(uri);
    if (!model) return [];
    const list = await $6a0fb5989a2c32ed$export$8054dcb2b42da45c(linkProvider, model, (0, $giPcZ.CancellationToken).None);
    if (!list) return [];
    // resolve links
    for(let i = 0; i < Math.min(resolveCount, list.links.length); i++)await list.links[i].resolve((0, $giPcZ.CancellationToken).None);
    const result = list.links.slice(0);
    list.dispose();
    return result;
});



var $4dEdH = parcelRequire("4dEdH");

var $kCOKl = parcelRequire("kCOKl");

var $iAi3o = parcelRequire("iAi3o");
var $da9a6dc94fb21f94$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $da9a6dc94fb21f94$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $da9a6dc94fb21f94$var$LinkDetector_1;
let $da9a6dc94fb21f94$export$e173163e3618783f = class LinkDetector extends (0, $9cWcn.Disposable) {
    static{
        $da9a6dc94fb21f94$var$LinkDetector_1 = this;
    }
    static{
        this.ID = 'editor.linkDetector';
    }
    static get(editor) {
        return editor.getContribution($da9a6dc94fb21f94$var$LinkDetector_1.ID);
    }
    constructor(editor, openerService, notificationService, languageFeaturesService, languageFeatureDebounceService){
        super();
        this.editor = editor;
        this.openerService = openerService;
        this.notificationService = notificationService;
        this.languageFeaturesService = languageFeaturesService;
        this.providers = this.languageFeaturesService.linkProvider;
        this.debounceInformation = languageFeatureDebounceService.for(this.providers, 'Links', {
            min: 1000,
            max: 4000
        });
        this.computeLinks = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this.computeLinksNow(), 1000));
        this.computePromise = null;
        this.activeLinksList = null;
        this.currentOccurrences = {};
        this.activeLinkDecorationId = null;
        const clickLinkGesture = this._register(new (0, $485c48732062cc95$export$e5a83b5c609cb4bb)(editor));
        this._register(clickLinkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent])=>{
            this._onEditorMouseMove(mouseEvent, keyboardEvent);
        }));
        this._register(clickLinkGesture.onExecute((e)=>{
            this.onEditorMouseUp(e);
        }));
        this._register(clickLinkGesture.onCancel((e)=>{
            this.cleanUpActiveLinkDecoration();
        }));
        this._register(editor.onDidChangeConfiguration((e)=>{
            if (!e.hasChanged(71 /* EditorOption.links */ )) return;
            // Remove any links (for the getting disabled case)
            this.updateDecorations([]);
            // Stop any computation (for the getting disabled case)
            this.stop();
            // Start computing (for the getting enabled case)
            this.computeLinks.schedule(0);
        }));
        this._register(editor.onDidChangeModelContent((e)=>{
            if (!this.editor.hasModel()) return;
            this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()));
        }));
        this._register(editor.onDidChangeModel((e)=>{
            this.currentOccurrences = {};
            this.activeLinkDecorationId = null;
            this.stop();
            this.computeLinks.schedule(0);
        }));
        this._register(editor.onDidChangeModelLanguage((e)=>{
            this.stop();
            this.computeLinks.schedule(0);
        }));
        this._register(this.providers.onDidChange((e)=>{
            this.stop();
            this.computeLinks.schedule(0);
        }));
        this.computeLinks.schedule(0);
    }
    async computeLinksNow() {
        if (!this.editor.hasModel() || !this.editor.getOption(71 /* EditorOption.links */ )) return;
        const model = this.editor.getModel();
        if (model.isTooLargeForSyncing()) return;
        if (!this.providers.has(model)) return;
        if (this.activeLinksList) {
            this.activeLinksList.dispose();
            this.activeLinksList = null;
        }
        this.computePromise = (0, $6bXyA.createCancelablePromise)((token)=>(0, $6a0fb5989a2c32ed$export$8054dcb2b42da45c)(this.providers, model, token));
        try {
            const sw = new (0, $eUQTM.StopWatch)(false);
            this.activeLinksList = await this.computePromise;
            this.debounceInformation.update(model, sw.elapsed());
            if (model.isDisposed()) return;
            this.updateDecorations(this.activeLinksList.links);
        } catch (err) {
            (0, $gPkHZ.onUnexpectedError)(err);
        } finally{
            this.computePromise = null;
        }
    }
    updateDecorations(links) {
        const useMetaKey = this.editor.getOption(78 /* EditorOption.multiCursorModifier */ ) === 'altKey';
        const oldDecorations = [];
        const keys = Object.keys(this.currentOccurrences);
        for (const decorationId of keys){
            const occurence = this.currentOccurrences[decorationId];
            oldDecorations.push(occurence.decorationId);
        }
        const newDecorations = [];
        if (links) // Not sure why this is sometimes null
        for (const link of links)newDecorations.push($da9a6dc94fb21f94$var$LinkOccurrence.decoration(link, useMetaKey));
        this.editor.changeDecorations((changeAccessor)=>{
            const decorations = changeAccessor.deltaDecorations(oldDecorations, newDecorations);
            this.currentOccurrences = {};
            this.activeLinkDecorationId = null;
            for(let i = 0, len = decorations.length; i < len; i++){
                const occurence = new $da9a6dc94fb21f94$var$LinkOccurrence(links[i], decorations[i]);
                this.currentOccurrences[occurence.decorationId] = occurence;
            }
        });
    }
    _onEditorMouseMove(mouseEvent, withKey) {
        const useMetaKey = this.editor.getOption(78 /* EditorOption.multiCursorModifier */ ) === 'altKey';
        if (this.isEnabled(mouseEvent, withKey)) {
            this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one
            const occurrence = this.getLinkOccurrence(mouseEvent.target.position);
            if (occurrence) this.editor.changeDecorations((changeAccessor)=>{
                occurrence.activate(changeAccessor, useMetaKey);
                this.activeLinkDecorationId = occurrence.decorationId;
            });
        } else this.cleanUpActiveLinkDecoration();
    }
    cleanUpActiveLinkDecoration() {
        const useMetaKey = this.editor.getOption(78 /* EditorOption.multiCursorModifier */ ) === 'altKey';
        if (this.activeLinkDecorationId) {
            const occurrence = this.currentOccurrences[this.activeLinkDecorationId];
            if (occurrence) this.editor.changeDecorations((changeAccessor)=>{
                occurrence.deactivate(changeAccessor, useMetaKey);
            });
            this.activeLinkDecorationId = null;
        }
    }
    onEditorMouseUp(mouseEvent) {
        if (!this.isEnabled(mouseEvent)) return;
        const occurrence = this.getLinkOccurrence(mouseEvent.target.position);
        if (!occurrence) return;
        this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier, true);
    }
    openLinkOccurrence(occurrence, openToSide, fromUserGesture = false) {
        if (!this.openerService) return;
        const { link: link } = occurrence;
        link.resolve((0, $giPcZ.CancellationToken).None).then((uri)=>{
            // Support for relative file URIs of the shape file://./relativeFile.txt or file:///./relativeFile.txt
            if (typeof uri === 'string' && this.editor.hasModel()) {
                const modelUri = this.editor.getModel().uri;
                if (modelUri.scheme === (0, $8GPp8.Schemas).file && uri.startsWith(`${(0, $8GPp8.Schemas).file}:`)) {
                    const parsedUri = (0, $5OJ54.URI).parse(uri);
                    if (parsedUri.scheme === (0, $8GPp8.Schemas).file) {
                        const fsPath = $5Aea5.originalFSPath(parsedUri);
                        let relativePath = null;
                        if (fsPath.startsWith('/./') || fsPath.startsWith('\\.\\')) relativePath = `.${fsPath.substr(1)}`;
                        else if (fsPath.startsWith('//./') || fsPath.startsWith('\\\\.\\')) relativePath = `.${fsPath.substr(2)}`;
                        if (relativePath) uri = $5Aea5.joinPath(modelUri, relativePath);
                    }
                }
            }
            return this.openerService.open(uri, {
                openToSide: openToSide,
                fromUserGesture: fromUserGesture,
                allowContributedOpeners: true,
                allowCommands: true,
                fromWorkspace: true
            });
        }, (err)=>{
            const messageOrError = err instanceof Error ? err.message : err;
            // different error cases
            if (messageOrError === 'invalid') this.notificationService.warn($4dEdH.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));
            else if (messageOrError === 'missing') this.notificationService.warn($4dEdH.localize('missing.url', 'Failed to open this link because its target is missing.'));
            else (0, $gPkHZ.onUnexpectedError)(err);
        });
    }
    getLinkOccurrence(position) {
        if (!this.editor.hasModel() || !position) return null;
        const decorations = this.editor.getModel().getDecorationsInRange({
            startLineNumber: position.lineNumber,
            startColumn: position.column,
            endLineNumber: position.lineNumber,
            endColumn: position.column
        }, 0, true);
        for (const decoration of decorations){
            const currentOccurrence = this.currentOccurrences[decoration.id];
            if (currentOccurrence) return currentOccurrence;
        }
        return null;
    }
    isEnabled(mouseEvent, withKey) {
        return Boolean(mouseEvent.target.type === 6 /* MouseTargetType.CONTENT_TEXT */  && (mouseEvent.hasTriggerModifier || withKey && withKey.keyCodeIsTriggerKey));
    }
    stop() {
        this.computeLinks.cancel();
        if (this.activeLinksList) {
            this.activeLinksList?.dispose();
            this.activeLinksList = null;
        }
        if (this.computePromise) {
            this.computePromise.cancel();
            this.computePromise = null;
        }
    }
    dispose() {
        super.dispose();
        this.stop();
    }
};
$da9a6dc94fb21f94$export$e173163e3618783f = $da9a6dc94fb21f94$var$LinkDetector_1 = $da9a6dc94fb21f94$var$__decorate([
    $da9a6dc94fb21f94$var$__param(1, (0, $iAi3o.IOpenerService)),
    $da9a6dc94fb21f94$var$__param(2, (0, $kCOKl.INotificationService)),
    $da9a6dc94fb21f94$var$__param(3, (0, $4J6fu.ILanguageFeaturesService)),
    $da9a6dc94fb21f94$var$__param(4, (0, $goG89.ILanguageFeatureDebounceService))
], $da9a6dc94fb21f94$export$e173163e3618783f);
const $da9a6dc94fb21f94$var$decoration = {
    general: (0, $91ntV.ModelDecorationOptions).register({
        description: 'detected-link',
        stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
        collapseOnReplaceEdit: true,
        inlineClassName: 'detected-link'
    }),
    active: (0, $91ntV.ModelDecorationOptions).register({
        description: 'detected-link-active',
        stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
        collapseOnReplaceEdit: true,
        inlineClassName: 'detected-link-active'
    })
};
class $da9a6dc94fb21f94$var$LinkOccurrence {
    static decoration(link, useMetaKey) {
        return {
            range: link.range,
            options: $da9a6dc94fb21f94$var$LinkOccurrence._getOptions(link, useMetaKey, false)
        };
    }
    static _getOptions(link, useMetaKey, isActive) {
        const options = {
            ...isActive ? $da9a6dc94fb21f94$var$decoration.active : $da9a6dc94fb21f94$var$decoration.general
        };
        options.hoverMessage = $da9a6dc94fb21f94$var$getHoverMessage(link, useMetaKey);
        return options;
    }
    constructor(link, decorationId){
        this.link = link;
        this.decorationId = decorationId;
    }
    activate(changeAccessor, useMetaKey) {
        changeAccessor.changeDecorationOptions(this.decorationId, $da9a6dc94fb21f94$var$LinkOccurrence._getOptions(this.link, useMetaKey, true));
    }
    deactivate(changeAccessor, useMetaKey) {
        changeAccessor.changeDecorationOptions(this.decorationId, $da9a6dc94fb21f94$var$LinkOccurrence._getOptions(this.link, useMetaKey, false));
    }
}
function $da9a6dc94fb21f94$var$getHoverMessage(link, useMetaKey) {
    const executeCmd = link.url && /^command:/i.test(link.url.toString());
    const label = link.tooltip ? link.tooltip : executeCmd ? $4dEdH.localize('links.navigate.executeCmd', 'Execute command') : $4dEdH.localize('links.navigate.follow', 'Follow link');
    const kb = useMetaKey ? $lb0Ah.isMacintosh ? $4dEdH.localize('links.navigate.kb.meta.mac', "cmd + click") : $4dEdH.localize('links.navigate.kb.meta', "ctrl + click") : $lb0Ah.isMacintosh ? $4dEdH.localize('links.navigate.kb.alt.mac', "option + click") : $4dEdH.localize('links.navigate.kb.alt', "alt + click");
    if (link.url) {
        let nativeLabel = '';
        if (/^command:/i.test(link.url.toString())) {
            // Don't show complete command arguments in the native tooltip
            const match = link.url.toString().match(/^command:([^?#]+)/);
            if (match) {
                const commandId = match[1];
                nativeLabel = $4dEdH.localize('tooltip.explanation', "Execute command {0}", commandId);
            }
        }
        const hoverMessage = new (0, $iGmb0.MarkdownString)('', true).appendLink(link.url.toString(true).replace(/ /g, '%20'), label, nativeLabel).appendMarkdown(` (${kb})`);
        return hoverMessage;
    } else return new (0, $iGmb0.MarkdownString)().appendText(`${label} (${kb})`);
}
class $da9a6dc94fb21f94$var$OpenLinkAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.openLink',
            label: $4dEdH.localize('label', "Open Link"),
            alias: 'Open Link',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        const linkDetector = $da9a6dc94fb21f94$export$e173163e3618783f.get(editor);
        if (!linkDetector) return;
        if (!editor.hasModel()) return;
        const selections = editor.getSelections();
        for (const sel of selections){
            const link = linkDetector.getLinkOccurrence(sel.getEndPosition());
            if (link) linkDetector.openLinkOccurrence(link, false);
        }
    }
}
(0, $2iJTi.registerEditorContribution)($da9a6dc94fb21f94$export$e173163e3618783f.ID, $da9a6dc94fb21f94$export$e173163e3618783f, 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $2iJTi.registerEditorAction)($da9a6dc94fb21f94$var$OpenLinkAction);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");
class $611d58062f87f84f$var$LongLinesHelper extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.longLinesHelper';
    }
    constructor(_editor){
        super();
        this._editor = _editor;
        this._register(this._editor.onMouseDown((e)=>{
            const stopRenderingLineAfter = this._editor.getOption(118 /* EditorOption.stopRenderingLineAfter */ );
            if (stopRenderingLineAfter >= 0 && e.target.type === 6 /* MouseTargetType.CONTENT_TEXT */  && e.target.position.column >= stopRenderingLineAfter) this._editor.updateOptions({
                stopRenderingLineAfter: -1
            });
        }));
    }
}
(0, $2iJTi.registerEditorContribution)($611d58062f87f84f$var$LongLinesHelper.ID, $611d58062f87f84f$var$LongLinesHelper, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $aIbUW = parcelRequire("aIbUW");

var $6bXyA = parcelRequire("6bXyA");

var $fuc8X = parcelRequire("fuc8X");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $lLi3Z = parcelRequire("lLi3Z");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $ibKGQ = parcelRequire("ibKGQ");


var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $1Y4vr = parcelRequire("1Y4vr");

var $91ntV = parcelRequire("91ntV");

var $kzNQX = parcelRequire("kzNQX");

var $4dEdH = parcelRequire("4dEdH");

var $gaWeX = parcelRequire("gaWeX");

var $azIPz = parcelRequire("azIPz");
const $9bb3e520d28a4c12$var$wordHighlightBackground = (0, $gaWeX.registerColor)('editor.wordHighlightBackground', {
    dark: '#575757B8',
    light: '#57575740',
    hcDark: null,
    hcLight: null
}, $4dEdH.localize('wordHighlight', 'Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations.'), true);
(0, $gaWeX.registerColor)('editor.wordHighlightStrongBackground', {
    dark: '#004972B8',
    light: '#0e639c40',
    hcDark: null,
    hcLight: null
}, $4dEdH.localize('wordHighlightStrong', 'Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations.'), true);
(0, $gaWeX.registerColor)('editor.wordHighlightTextBackground', $9bb3e520d28a4c12$var$wordHighlightBackground, $4dEdH.localize('wordHighlightText', 'Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.'), true);
const $9bb3e520d28a4c12$var$wordHighlightBorder = (0, $gaWeX.registerColor)('editor.wordHighlightBorder', {
    light: null,
    dark: null,
    hcDark: (0, $gaWeX.activeContrastBorder),
    hcLight: (0, $gaWeX.activeContrastBorder)
}, $4dEdH.localize('wordHighlightBorder', 'Border color of a symbol during read-access, like reading a variable.'));
(0, $gaWeX.registerColor)('editor.wordHighlightStrongBorder', {
    light: null,
    dark: null,
    hcDark: (0, $gaWeX.activeContrastBorder),
    hcLight: (0, $gaWeX.activeContrastBorder)
}, $4dEdH.localize('wordHighlightStrongBorder', 'Border color of a symbol during write-access, like writing to a variable.'));
(0, $gaWeX.registerColor)('editor.wordHighlightTextBorder', $9bb3e520d28a4c12$var$wordHighlightBorder, $4dEdH.localize('wordHighlightTextBorder', "Border color of a textual occurrence for a symbol."));
const $9bb3e520d28a4c12$var$overviewRulerWordHighlightForeground = (0, $gaWeX.registerColor)('editorOverviewRuler.wordHighlightForeground', '#A0A0A0CC', $4dEdH.localize('overviewRulerWordHighlightForeground', 'Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations.'), true);
const $9bb3e520d28a4c12$var$overviewRulerWordHighlightStrongForeground = (0, $gaWeX.registerColor)('editorOverviewRuler.wordHighlightStrongForeground', '#C0A0C0CC', $4dEdH.localize('overviewRulerWordHighlightStrongForeground', 'Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations.'), true);
const $9bb3e520d28a4c12$var$overviewRulerWordHighlightTextForeground = (0, $gaWeX.registerColor)('editorOverviewRuler.wordHighlightTextForeground', (0, $gaWeX.overviewRulerSelectionHighlightForeground), $4dEdH.localize('overviewRulerWordHighlightTextForeground', 'Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.'), true);
const $9bb3e520d28a4c12$var$_WRITE_OPTIONS = (0, $91ntV.ModelDecorationOptions).register({
    description: 'word-highlight-strong',
    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
    className: 'wordHighlightStrong',
    overviewRuler: {
        color: (0, $azIPz.themeColorFromId)($9bb3e520d28a4c12$var$overviewRulerWordHighlightStrongForeground),
        position: (0, $1Y4vr.OverviewRulerLane).Center
    },
    minimap: {
        color: (0, $azIPz.themeColorFromId)((0, $gaWeX.minimapSelectionOccurrenceHighlight)),
        position: 1 /* MinimapPosition.Inline */ 
    }
});
const $9bb3e520d28a4c12$var$_TEXT_OPTIONS = (0, $91ntV.ModelDecorationOptions).register({
    description: 'word-highlight-text',
    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
    className: 'wordHighlightText',
    overviewRuler: {
        color: (0, $azIPz.themeColorFromId)($9bb3e520d28a4c12$var$overviewRulerWordHighlightTextForeground),
        position: (0, $1Y4vr.OverviewRulerLane).Center
    },
    minimap: {
        color: (0, $azIPz.themeColorFromId)((0, $gaWeX.minimapSelectionOccurrenceHighlight)),
        position: 1 /* MinimapPosition.Inline */ 
    }
});
const $9bb3e520d28a4c12$var$_SELECTION_HIGHLIGHT_OPTIONS = (0, $91ntV.ModelDecorationOptions).register({
    description: 'selection-highlight-overview',
    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
    className: 'selectionHighlight',
    overviewRuler: {
        color: (0, $azIPz.themeColorFromId)((0, $gaWeX.overviewRulerSelectionHighlightForeground)),
        position: (0, $1Y4vr.OverviewRulerLane).Center
    },
    minimap: {
        color: (0, $azIPz.themeColorFromId)((0, $gaWeX.minimapSelectionOccurrenceHighlight)),
        position: 1 /* MinimapPosition.Inline */ 
    }
});
const $9bb3e520d28a4c12$var$_SELECTION_HIGHLIGHT_OPTIONS_NO_OVERVIEW = (0, $91ntV.ModelDecorationOptions).register({
    description: 'selection-highlight',
    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
    className: 'selectionHighlight'
});
const $9bb3e520d28a4c12$var$_REGULAR_OPTIONS = (0, $91ntV.ModelDecorationOptions).register({
    description: 'word-highlight',
    stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
    className: 'wordHighlight',
    overviewRuler: {
        color: (0, $azIPz.themeColorFromId)($9bb3e520d28a4c12$var$overviewRulerWordHighlightForeground),
        position: (0, $1Y4vr.OverviewRulerLane).Center
    },
    minimap: {
        color: (0, $azIPz.themeColorFromId)((0, $gaWeX.minimapSelectionOccurrenceHighlight)),
        position: 1 /* MinimapPosition.Inline */ 
    }
});
function $9bb3e520d28a4c12$export$d9c75c339791af2c(kind) {
    if (kind === (0, $kzNQX.DocumentHighlightKind).Write) return $9bb3e520d28a4c12$var$_WRITE_OPTIONS;
    else if (kind === (0, $kzNQX.DocumentHighlightKind).Text) return $9bb3e520d28a4c12$var$_TEXT_OPTIONS;
    else return $9bb3e520d28a4c12$var$_REGULAR_OPTIONS;
}
function $9bb3e520d28a4c12$export$4dcbdd96b9fbba47(hasSemanticHighlights) {
    // Show in overviewRuler only if model has no semantic highlighting
    return hasSemanticHighlights ? $9bb3e520d28a4c12$var$_SELECTION_HIGHLIGHT_OPTIONS_NO_OVERVIEW : $9bb3e520d28a4c12$var$_SELECTION_HIGHLIGHT_OPTIONS;
}
(0, $azIPz.registerThemingParticipant)((theme, collector)=>{
    const selectionHighlight = theme.getColor((0, $gaWeX.editorSelectionHighlight));
    if (selectionHighlight) collector.addRule(`.monaco-editor .selectionHighlight { background-color: ${selectionHighlight.transparent(0.5)}; }`);
});



var $fdGPu = parcelRequire("fdGPu");
var $5533615b752eba30$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $5533615b752eba30$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $5533615b752eba30$var$SelectionHighlighter_1;
function $5533615b752eba30$var$announceCursorChange(previousCursorState, cursorState) {
    const cursorDiff = cursorState.filter((cs)=>!previousCursorState.find((pcs)=>pcs.equals(cs)));
    if (cursorDiff.length >= 1) {
        const cursorPositions = cursorDiff.map((cs)=>`line ${cs.viewState.position.lineNumber} column ${cs.viewState.position.column}`).join(', ');
        const msg = cursorDiff.length === 1 ? $4dEdH.localize('cursorAdded', "Cursor added: {0}", cursorPositions) : $4dEdH.localize('cursorsAdded', "Cursors added: {0}", cursorPositions);
        (0, $aIbUW.status)(msg);
    }
}
class $5533615b752eba30$export$a2a103e44264bbeb extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.insertCursorAbove',
            label: $4dEdH.localize('mutlicursor.insertAbove', "Add Cursor Above"),
            alias: 'Add Cursor Above',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2576 /* KeyCode.UpArrow */ ,
                linux: {
                    primary: 1552 /* KeyCode.UpArrow */ ,
                    secondary: [
                        3088 /* KeyCode.UpArrow */ 
                    ]
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '3_multi',
                title: $4dEdH.localize({
                    key: 'miInsertCursorAbove',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Add Cursor Above"),
                order: 2
            }
        });
    }
    run(accessor, editor, args) {
        if (!editor.hasModel()) return;
        let useLogicalLine = true;
        if (args && args.logicalLine === false) useLogicalLine = false;
        const viewModel = editor._getViewModel();
        if (viewModel.cursorConfig.readOnly) return;
        viewModel.model.pushStackElement();
        const previousCursorState = viewModel.getCursorStates();
        viewModel.setCursorStates(args.source, 3 /* CursorChangeReason.Explicit */ , (0, $lLi3Z.CursorMoveCommands).addCursorUp(viewModel, previousCursorState, useLogicalLine));
        viewModel.revealTopMostCursor(args.source);
        $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
    }
}
class $5533615b752eba30$export$a0aca99842abcc90 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.insertCursorBelow',
            label: $4dEdH.localize('mutlicursor.insertBelow', "Add Cursor Below"),
            alias: 'Add Cursor Below',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2578 /* KeyCode.DownArrow */ ,
                linux: {
                    primary: 1554 /* KeyCode.DownArrow */ ,
                    secondary: [
                        3090 /* KeyCode.DownArrow */ 
                    ]
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '3_multi',
                title: $4dEdH.localize({
                    key: 'miInsertCursorBelow',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "A&&dd Cursor Below"),
                order: 3
            }
        });
    }
    run(accessor, editor, args) {
        if (!editor.hasModel()) return;
        let useLogicalLine = true;
        if (args && args.logicalLine === false) useLogicalLine = false;
        const viewModel = editor._getViewModel();
        if (viewModel.cursorConfig.readOnly) return;
        viewModel.model.pushStackElement();
        const previousCursorState = viewModel.getCursorStates();
        viewModel.setCursorStates(args.source, 3 /* CursorChangeReason.Explicit */ , (0, $lLi3Z.CursorMoveCommands).addCursorDown(viewModel, previousCursorState, useLogicalLine));
        viewModel.revealBottomMostCursor(args.source);
        $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
    }
}
class $5533615b752eba30$var$InsertCursorAtEndOfEachLineSelected extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.insertCursorAtEndOfEachLineSelected',
            label: $4dEdH.localize('mutlicursor.insertAtEndOfEachLineSelected', "Add Cursors to Line Ends"),
            alias: 'Add Cursors to Line Ends',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1575 /* KeyCode.KeyI */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '3_multi',
                title: $4dEdH.localize({
                    key: 'miInsertCursorAtEndOfEachLineSelected',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Add C&&ursors to Line Ends"),
                order: 4
            }
        });
    }
    getCursorsForSelection(selection, model, result) {
        if (selection.isEmpty()) return;
        for(let i = selection.startLineNumber; i < selection.endLineNumber; i++){
            const currentLineMaxColumn = model.getLineMaxColumn(i);
            result.push(new (0, $jzicX.Selection)(i, currentLineMaxColumn, i, currentLineMaxColumn));
        }
        if (selection.endColumn > 1) result.push(new (0, $jzicX.Selection)(selection.endLineNumber, selection.endColumn, selection.endLineNumber, selection.endColumn));
    }
    run(accessor, editor) {
        if (!editor.hasModel()) return;
        const model = editor.getModel();
        const selections = editor.getSelections();
        const viewModel = editor._getViewModel();
        const previousCursorState = viewModel.getCursorStates();
        const newSelections = [];
        selections.forEach((sel)=>this.getCursorsForSelection(sel, model, newSelections));
        if (newSelections.length > 0) editor.setSelections(newSelections);
        $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
    }
}
class $5533615b752eba30$var$InsertCursorAtEndOfLineSelected extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.addCursorsToBottom',
            label: $4dEdH.localize('mutlicursor.addCursorsToBottom', "Add Cursors To Bottom"),
            alias: 'Add Cursors To Bottom',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        if (!editor.hasModel()) return;
        const selections = editor.getSelections();
        const lineCount = editor.getModel().getLineCount();
        const newSelections = [];
        for(let i = selections[0].startLineNumber; i <= lineCount; i++)newSelections.push(new (0, $jzicX.Selection)(i, selections[0].startColumn, i, selections[0].endColumn));
        const viewModel = editor._getViewModel();
        const previousCursorState = viewModel.getCursorStates();
        if (newSelections.length > 0) editor.setSelections(newSelections);
        $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
    }
}
class $5533615b752eba30$var$InsertCursorAtTopOfLineSelected extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.addCursorsToTop',
            label: $4dEdH.localize('mutlicursor.addCursorsToTop', "Add Cursors To Top"),
            alias: 'Add Cursors To Top',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        if (!editor.hasModel()) return;
        const selections = editor.getSelections();
        const newSelections = [];
        for(let i = selections[0].startLineNumber; i >= 1; i--)newSelections.push(new (0, $jzicX.Selection)(i, selections[0].startColumn, i, selections[0].endColumn));
        const viewModel = editor._getViewModel();
        const previousCursorState = viewModel.getCursorStates();
        if (newSelections.length > 0) editor.setSelections(newSelections);
        $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
    }
}
class $5533615b752eba30$export$c53027d5280f35e5 {
    constructor(selections, revealRange, revealScrollType){
        this.selections = selections;
        this.revealRange = revealRange;
        this.revealScrollType = revealScrollType;
    }
}
class $5533615b752eba30$export$3eae6fd7223f22ab {
    static create(editor, findController) {
        if (!editor.hasModel()) return null;
        const findState = findController.getState();
        // Find widget owns entirely what we search for if:
        //  - focus is not in the editor (i.e. it is in the find widget)
        //  - and the search widget is visible
        //  - and the search string is non-empty
        if (!editor.hasTextFocus() && findState.isRevealed && findState.searchString.length > 0) // Find widget owns what is searched for
        return new $5533615b752eba30$export$3eae6fd7223f22ab(editor, findController, false, findState.searchString, findState.wholeWord, findState.matchCase, null);
        // Otherwise, the selection gives the search text, and the find widget gives the search settings
        // The exception is the find state disassociation case: when beginning with a single, collapsed selection
        let isDisconnectedFromFindController = false;
        let wholeWord;
        let matchCase;
        const selections = editor.getSelections();
        if (selections.length === 1 && selections[0].isEmpty()) {
            isDisconnectedFromFindController = true;
            wholeWord = true;
            matchCase = true;
        } else {
            wholeWord = findState.wholeWord;
            matchCase = findState.matchCase;
        }
        // Selection owns what is searched for
        const s = editor.getSelection();
        let searchText;
        let currentMatch = null;
        if (s.isEmpty()) {
            // selection is empty => expand to current word
            const word = editor.getConfiguredWordAtPosition(s.getStartPosition());
            if (!word) return null;
            searchText = word.word;
            currentMatch = new (0, $jzicX.Selection)(s.startLineNumber, word.startColumn, s.startLineNumber, word.endColumn);
        } else searchText = editor.getModel().getValueInRange(s).replace(/\r\n/g, '\n');
        return new $5533615b752eba30$export$3eae6fd7223f22ab(editor, findController, isDisconnectedFromFindController, searchText, wholeWord, matchCase, currentMatch);
    }
    constructor(_editor, findController, isDisconnectedFromFindController, searchText, wholeWord, matchCase, currentMatch){
        this._editor = _editor;
        this.findController = findController;
        this.isDisconnectedFromFindController = isDisconnectedFromFindController;
        this.searchText = searchText;
        this.wholeWord = wholeWord;
        this.matchCase = matchCase;
        this.currentMatch = currentMatch;
    }
    addSelectionToNextFindMatch() {
        if (!this._editor.hasModel()) return null;
        const nextMatch = this._getNextMatch();
        if (!nextMatch) return null;
        const allSelections = this._editor.getSelections();
        return new $5533615b752eba30$export$c53027d5280f35e5(allSelections.concat(nextMatch), nextMatch, 0 /* ScrollType.Smooth */ );
    }
    moveSelectionToNextFindMatch() {
        if (!this._editor.hasModel()) return null;
        const nextMatch = this._getNextMatch();
        if (!nextMatch) return null;
        const allSelections = this._editor.getSelections();
        return new $5533615b752eba30$export$c53027d5280f35e5(allSelections.slice(0, allSelections.length - 1).concat(nextMatch), nextMatch, 0 /* ScrollType.Smooth */ );
    }
    _getNextMatch() {
        if (!this._editor.hasModel()) return null;
        if (this.currentMatch) {
            const result = this.currentMatch;
            this.currentMatch = null;
            return result;
        }
        this.findController.highlightFindOptions();
        const allSelections = this._editor.getSelections();
        const lastAddedSelection = allSelections[allSelections.length - 1];
        const nextMatch = this._editor.getModel().findNextMatch(this.searchText, lastAddedSelection.getEndPosition(), false, this.matchCase, this.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false);
        if (!nextMatch) return null;
        return new (0, $jzicX.Selection)(nextMatch.range.startLineNumber, nextMatch.range.startColumn, nextMatch.range.endLineNumber, nextMatch.range.endColumn);
    }
    addSelectionToPreviousFindMatch() {
        if (!this._editor.hasModel()) return null;
        const previousMatch = this._getPreviousMatch();
        if (!previousMatch) return null;
        const allSelections = this._editor.getSelections();
        return new $5533615b752eba30$export$c53027d5280f35e5(allSelections.concat(previousMatch), previousMatch, 0 /* ScrollType.Smooth */ );
    }
    moveSelectionToPreviousFindMatch() {
        if (!this._editor.hasModel()) return null;
        const previousMatch = this._getPreviousMatch();
        if (!previousMatch) return null;
        const allSelections = this._editor.getSelections();
        return new $5533615b752eba30$export$c53027d5280f35e5(allSelections.slice(0, allSelections.length - 1).concat(previousMatch), previousMatch, 0 /* ScrollType.Smooth */ );
    }
    _getPreviousMatch() {
        if (!this._editor.hasModel()) return null;
        if (this.currentMatch) {
            const result = this.currentMatch;
            this.currentMatch = null;
            return result;
        }
        this.findController.highlightFindOptions();
        const allSelections = this._editor.getSelections();
        const lastAddedSelection = allSelections[allSelections.length - 1];
        const previousMatch = this._editor.getModel().findPreviousMatch(this.searchText, lastAddedSelection.getStartPosition(), false, this.matchCase, this.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false);
        if (!previousMatch) return null;
        return new (0, $jzicX.Selection)(previousMatch.range.startLineNumber, previousMatch.range.startColumn, previousMatch.range.endLineNumber, previousMatch.range.endColumn);
    }
    selectAll(searchScope) {
        if (!this._editor.hasModel()) return [];
        this.findController.highlightFindOptions();
        const editorModel = this._editor.getModel();
        if (searchScope) return editorModel.findMatches(this.searchText, searchScope, false, this.matchCase, this.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false, 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ );
        return editorModel.findMatches(this.searchText, true, false, this.matchCase, this.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false, 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ );
    }
}
class $5533615b752eba30$export$72ef690ee4064f04 extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.multiCursorController';
    }
    static get(editor) {
        return editor.getContribution($5533615b752eba30$export$72ef690ee4064f04.ID);
    }
    constructor(editor){
        super();
        this._sessionDispose = this._register(new (0, $9cWcn.DisposableStore)());
        this._editor = editor;
        this._ignoreSelectionChange = false;
        this._session = null;
    }
    dispose() {
        this._endSession();
        super.dispose();
    }
    _beginSessionIfNeeded(findController) {
        if (!this._session) {
            // Create a new session
            const session = $5533615b752eba30$export$3eae6fd7223f22ab.create(this._editor, findController);
            if (!session) return;
            this._session = session;
            const newState = {
                searchString: this._session.searchText
            };
            if (this._session.isDisconnectedFromFindController) {
                newState.wholeWordOverride = 1 /* FindOptionOverride.True */ ;
                newState.matchCaseOverride = 1 /* FindOptionOverride.True */ ;
                newState.isRegexOverride = 2 /* FindOptionOverride.False */ ;
            }
            findController.getState().change(newState, false);
            this._sessionDispose.add(this._editor.onDidChangeCursorSelection((e)=>{
                if (this._ignoreSelectionChange) return;
                this._endSession();
            }));
            this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{
                this._endSession();
            }));
            this._sessionDispose.add(findController.getState().onFindReplaceStateChange((e)=>{
                if (e.matchCase || e.wholeWord) this._endSession();
            }));
        }
    }
    _endSession() {
        this._sessionDispose.clear();
        if (this._session && this._session.isDisconnectedFromFindController) {
            const newState = {
                wholeWordOverride: 0 /* FindOptionOverride.NotSet */ ,
                matchCaseOverride: 0 /* FindOptionOverride.NotSet */ ,
                isRegexOverride: 0 /* FindOptionOverride.NotSet */ 
            };
            this._session.findController.getState().change(newState, false);
        }
        this._session = null;
    }
    _setSelections(selections) {
        this._ignoreSelectionChange = true;
        this._editor.setSelections(selections);
        this._ignoreSelectionChange = false;
    }
    _expandEmptyToWord(model, selection) {
        if (!selection.isEmpty()) return selection;
        const word = this._editor.getConfiguredWordAtPosition(selection.getStartPosition());
        if (!word) return selection;
        return new (0, $jzicX.Selection)(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);
    }
    _applySessionResult(result) {
        if (!result) return;
        this._setSelections(result.selections);
        if (result.revealRange) this._editor.revealRangeInCenterIfOutsideViewport(result.revealRange, result.revealScrollType);
    }
    getSession(findController) {
        return this._session;
    }
    addSelectionToNextFindMatch(findController) {
        if (!this._editor.hasModel()) return;
        if (!this._session) {
            // If there are multiple cursors, handle the case where they do not all select the same text.
            const allSelections = this._editor.getSelections();
            if (allSelections.length > 1) {
                const findState = findController.getState();
                const matchCase = findState.matchCase;
                const selectionsContainSameText = $5533615b752eba30$var$modelRangesContainSameText(this._editor.getModel(), allSelections, matchCase);
                if (!selectionsContainSameText) {
                    const model = this._editor.getModel();
                    const resultingSelections = [];
                    for(let i = 0, len = allSelections.length; i < len; i++)resultingSelections[i] = this._expandEmptyToWord(model, allSelections[i]);
                    this._editor.setSelections(resultingSelections);
                    return;
                }
            }
        }
        this._beginSessionIfNeeded(findController);
        if (this._session) this._applySessionResult(this._session.addSelectionToNextFindMatch());
    }
    addSelectionToPreviousFindMatch(findController) {
        this._beginSessionIfNeeded(findController);
        if (this._session) this._applySessionResult(this._session.addSelectionToPreviousFindMatch());
    }
    moveSelectionToNextFindMatch(findController) {
        this._beginSessionIfNeeded(findController);
        if (this._session) this._applySessionResult(this._session.moveSelectionToNextFindMatch());
    }
    moveSelectionToPreviousFindMatch(findController) {
        this._beginSessionIfNeeded(findController);
        if (this._session) this._applySessionResult(this._session.moveSelectionToPreviousFindMatch());
    }
    selectAll(findController) {
        if (!this._editor.hasModel()) return;
        let matches = null;
        const findState = findController.getState();
        // Special case: find widget owns entirely what we search for if:
        // - focus is not in the editor (i.e. it is in the find widget)
        // - and the search widget is visible
        // - and the search string is non-empty
        // - and we're searching for a regex
        if (findState.isRevealed && findState.searchString.length > 0 && findState.isRegex) {
            const editorModel = this._editor.getModel();
            if (findState.searchScope) matches = editorModel.findMatches(findState.searchString, findState.searchScope, findState.isRegex, findState.matchCase, findState.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false, 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ );
            else matches = editorModel.findMatches(findState.searchString, true, findState.isRegex, findState.matchCase, findState.wholeWord ? this._editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, false, 1073741824 /* Constants.MAX_SAFE_SMALL_INTEGER */ );
        } else {
            this._beginSessionIfNeeded(findController);
            if (!this._session) return;
            matches = this._session.selectAll(findState.searchScope);
        }
        if (matches.length > 0) {
            const editorSelection = this._editor.getSelection();
            // Have the primary cursor remain the one where the action was invoked
            for(let i = 0, len = matches.length; i < len; i++){
                const match = matches[i];
                const intersection = match.range.intersectRanges(editorSelection);
                if (intersection) {
                    // bingo!
                    matches[i] = matches[0];
                    matches[0] = match;
                    break;
                }
            }
            this._setSelections(matches.map((m)=>new (0, $jzicX.Selection)(m.range.startLineNumber, m.range.startColumn, m.range.endLineNumber, m.range.endColumn)));
        }
    }
}
class $5533615b752eba30$export$7117bb1c55f1db87 extends (0, $2iJTi.EditorAction) {
    run(accessor, editor) {
        const multiCursorController = $5533615b752eba30$export$72ef690ee4064f04.get(editor);
        if (!multiCursorController) return;
        const viewModel = editor._getViewModel();
        if (viewModel) {
            const previousCursorState = viewModel.getCursorStates();
            const findController = (0, $ccce32ec99de83e9$export$3190f9a23ad62166).get(editor);
            if (findController) this._run(multiCursorController, findController);
            else {
                const newFindController = accessor.get((0, $fdGPu.IInstantiationService)).createInstance((0, $ccce32ec99de83e9$export$3190f9a23ad62166), editor);
                this._run(multiCursorController, newFindController);
                newFindController.dispose();
            }
            $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
        }
    }
}
class $5533615b752eba30$export$8f076283f2167b25 extends $5533615b752eba30$export$7117bb1c55f1db87 {
    constructor(){
        super({
            id: 'editor.action.addSelectionToNextFindMatch',
            label: $4dEdH.localize('addSelectionToNextFindMatch', "Add Selection To Next Find Match"),
            alias: 'Add Selection To Next Find Match',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 2082 /* KeyCode.KeyD */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '3_multi',
                title: $4dEdH.localize({
                    key: 'miAddSelectionToNextFindMatch',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Add &&Next Occurrence"),
                order: 5
            }
        });
    }
    _run(multiCursorController, findController) {
        multiCursorController.addSelectionToNextFindMatch(findController);
    }
}
class $5533615b752eba30$export$18b95272d65addf8 extends $5533615b752eba30$export$7117bb1c55f1db87 {
    constructor(){
        super({
            id: 'editor.action.addSelectionToPreviousFindMatch',
            label: $4dEdH.localize('addSelectionToPreviousFindMatch', "Add Selection To Previous Find Match"),
            alias: 'Add Selection To Previous Find Match',
            precondition: undefined,
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '3_multi',
                title: $4dEdH.localize({
                    key: 'miAddSelectionToPreviousFindMatch',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Add P&&revious Occurrence"),
                order: 6
            }
        });
    }
    _run(multiCursorController, findController) {
        multiCursorController.addSelectionToPreviousFindMatch(findController);
    }
}
class $5533615b752eba30$export$411b7432b064bcf7 extends $5533615b752eba30$export$7117bb1c55f1db87 {
    constructor(){
        super({
            id: 'editor.action.moveSelectionToNextFindMatch',
            label: $4dEdH.localize('moveSelectionToNextFindMatch', "Move Last Selection To Next Find Match"),
            alias: 'Move Last Selection To Next Find Match',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: (0, $fuc8X.KeyChord)(2089 /* KeyCode.KeyK */ , 2082 /* KeyCode.KeyD */ ),
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    _run(multiCursorController, findController) {
        multiCursorController.moveSelectionToNextFindMatch(findController);
    }
}
class $5533615b752eba30$export$1fb22e5b0da21ac2 extends $5533615b752eba30$export$7117bb1c55f1db87 {
    constructor(){
        super({
            id: 'editor.action.moveSelectionToPreviousFindMatch',
            label: $4dEdH.localize('moveSelectionToPreviousFindMatch', "Move Last Selection To Previous Find Match"),
            alias: 'Move Last Selection To Previous Find Match',
            precondition: undefined
        });
    }
    _run(multiCursorController, findController) {
        multiCursorController.moveSelectionToPreviousFindMatch(findController);
    }
}
class $5533615b752eba30$export$d06ce53b2982cd37 extends $5533615b752eba30$export$7117bb1c55f1db87 {
    constructor(){
        super({
            id: 'editor.action.selectHighlights',
            label: $4dEdH.localize('selectAllOccurrencesOfFindMatch', "Select All Occurrences of Find Match"),
            alias: 'Select All Occurrences of Find Match',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 3114 /* KeyCode.KeyL */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '3_multi',
                title: $4dEdH.localize({
                    key: 'miSelectHighlights',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "Select All &&Occurrences"),
                order: 7
            }
        });
    }
    _run(multiCursorController, findController) {
        multiCursorController.selectAll(findController);
    }
}
class $5533615b752eba30$export$22d364fb7d9f34a3 extends $5533615b752eba30$export$7117bb1c55f1db87 {
    constructor(){
        super({
            id: 'editor.action.changeAll',
            label: $4dEdH.localize('changeAll.label', "Change All Occurrences"),
            alias: 'Change All Occurrences',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).editorTextFocus),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 2108 /* KeyCode.F2 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            contextMenuOpts: {
                group: '1_modification',
                order: 1.2
            }
        });
    }
    _run(multiCursorController, findController) {
        multiCursorController.selectAll(findController);
    }
}
class $5533615b752eba30$var$SelectionHighlighterState {
    constructor(_model, _searchText, _matchCase, _wordSeparators, prevState){
        this._model = _model;
        this._searchText = _searchText;
        this._matchCase = _matchCase;
        this._wordSeparators = _wordSeparators;
        this._modelVersionId = this._model.getVersionId();
        this._cachedFindMatches = null;
        if (prevState && this._model === prevState._model && this._searchText === prevState._searchText && this._matchCase === prevState._matchCase && this._wordSeparators === prevState._wordSeparators && this._modelVersionId === prevState._modelVersionId) this._cachedFindMatches = prevState._cachedFindMatches;
    }
    findMatches() {
        if (this._cachedFindMatches === null) {
            this._cachedFindMatches = this._model.findMatches(this._searchText, true, false, this._matchCase, this._wordSeparators, false).map((m)=>m.range);
            this._cachedFindMatches.sort((0, $d00il.Range).compareRangesUsingStarts);
        }
        return this._cachedFindMatches;
    }
}
let $5533615b752eba30$export$e2d3f180605870d2 = class SelectionHighlighter extends (0, $9cWcn.Disposable) {
    static{
        $5533615b752eba30$var$SelectionHighlighter_1 = this;
    }
    static{
        this.ID = 'editor.contrib.selectionHighlighter';
    }
    constructor(editor, _languageFeaturesService){
        super();
        this._languageFeaturesService = _languageFeaturesService;
        this.editor = editor;
        this._isEnabled = editor.getOption(109 /* EditorOption.selectionHighlight */ );
        this._decorations = editor.createDecorationsCollection();
        this.updateSoon = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._update(), 300));
        this.state = null;
        this._register(editor.onDidChangeConfiguration((e)=>{
            this._isEnabled = editor.getOption(109 /* EditorOption.selectionHighlight */ );
        }));
        this._register(editor.onDidChangeCursorSelection((e)=>{
            if (!this._isEnabled) // Early exit if nothing needs to be done!
            // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)
            return;
            if (e.selection.isEmpty()) {
                if (e.reason === 3 /* CursorChangeReason.Explicit */ ) {
                    if (this.state) // no longer valid
                    this._setState(null);
                    this.updateSoon.schedule();
                } else this._setState(null);
            } else this._update();
        }));
        this._register(editor.onDidChangeModel((e)=>{
            this._setState(null);
        }));
        this._register(editor.onDidChangeModelContent((e)=>{
            if (this._isEnabled) this.updateSoon.schedule();
        }));
        const findController = (0, $ccce32ec99de83e9$export$3190f9a23ad62166).get(editor);
        if (findController) this._register(findController.getState().onFindReplaceStateChange((e)=>{
            this._update();
        }));
        this.updateSoon.schedule();
    }
    _update() {
        this._setState($5533615b752eba30$var$SelectionHighlighter_1._createState(this.state, this._isEnabled, this.editor));
    }
    static _createState(oldState, isEnabled, editor) {
        if (!isEnabled) return null;
        if (!editor.hasModel()) return null;
        const s = editor.getSelection();
        if (s.startLineNumber !== s.endLineNumber) // multiline forbidden for perf reasons
        return null;
        const multiCursorController = $5533615b752eba30$export$72ef690ee4064f04.get(editor);
        if (!multiCursorController) return null;
        const findController = (0, $ccce32ec99de83e9$export$3190f9a23ad62166).get(editor);
        if (!findController) return null;
        let r = multiCursorController.getSession(findController);
        if (!r) {
            const allSelections = editor.getSelections();
            if (allSelections.length > 1) {
                const findState = findController.getState();
                const matchCase = findState.matchCase;
                const selectionsContainSameText = $5533615b752eba30$var$modelRangesContainSameText(editor.getModel(), allSelections, matchCase);
                if (!selectionsContainSameText) return null;
            }
            r = $5533615b752eba30$export$3eae6fd7223f22ab.create(editor, findController);
        }
        if (!r) return null;
        if (r.currentMatch) // This is an empty selection
        // Do not interfere with semantic word highlighting in the no selection case
        return null;
        if (/^[ \t]+$/.test(r.searchText)) // whitespace only selection
        return null;
        if (r.searchText.length > 200) // very long selection
        return null;
        // TODO: better handling of this case
        const findState = findController.getState();
        const caseSensitive = findState.matchCase;
        // Return early if the find widget shows the exact same matches
        if (findState.isRevealed) {
            let findStateSearchString = findState.searchString;
            if (!caseSensitive) findStateSearchString = findStateSearchString.toLowerCase();
            let mySearchString = r.searchText;
            if (!caseSensitive) mySearchString = mySearchString.toLowerCase();
            if (findStateSearchString === mySearchString && r.matchCase === findState.matchCase && r.wholeWord === findState.wholeWord && !findState.isRegex) return null;
        }
        return new $5533615b752eba30$var$SelectionHighlighterState(editor.getModel(), r.searchText, r.matchCase, r.wholeWord ? editor.getOption(132 /* EditorOption.wordSeparators */ ) : null, oldState);
    }
    _setState(newState) {
        this.state = newState;
        if (!this.state) {
            this._decorations.clear();
            return;
        }
        if (!this.editor.hasModel()) return;
        const model = this.editor.getModel();
        if (model.isTooLargeForTokenization()) // the file is too large, so searching word under cursor in the whole document would be blocking the UI.
        return;
        const allMatches = this.state.findMatches();
        const selections = this.editor.getSelections();
        selections.sort((0, $d00il.Range).compareRangesUsingStarts);
        // do not overlap with selection (issue #64 and #512)
        const matches = [];
        for(let i = 0, j = 0, len = allMatches.length, lenJ = selections.length; i < len;){
            const match = allMatches[i];
            if (j >= lenJ) {
                // finished all editor selections
                matches.push(match);
                i++;
            } else {
                const cmp = (0, $d00il.Range).compareRangesUsingStarts(match, selections[j]);
                if (cmp < 0) {
                    // match is before sel
                    if (selections[j].isEmpty() || !(0, $d00il.Range).areIntersecting(match, selections[j])) matches.push(match);
                    i++;
                } else if (cmp > 0) // sel is before match
                j++;
                else {
                    // sel is equal to match
                    i++;
                    j++;
                }
            }
        }
        const occurrenceHighlighting = this.editor.getOption(81 /* EditorOption.occurrencesHighlight */ ) !== 'off';
        const hasSemanticHighlights = this._languageFeaturesService.documentHighlightProvider.has(model) && occurrenceHighlighting;
        const decorations = matches.map((r)=>{
            return {
                range: r,
                options: (0, $9bb3e520d28a4c12$export$4dcbdd96b9fbba47)(hasSemanticHighlights)
            };
        });
        this._decorations.set(decorations);
    }
    dispose() {
        this._setState(null);
        super.dispose();
    }
};
$5533615b752eba30$export$e2d3f180605870d2 = $5533615b752eba30$var$SelectionHighlighter_1 = $5533615b752eba30$var$__decorate([
    $5533615b752eba30$var$__param(1, (0, $4J6fu.ILanguageFeaturesService))
], $5533615b752eba30$export$e2d3f180605870d2);
function $5533615b752eba30$var$modelRangesContainSameText(model, ranges, matchCase) {
    const selectedText = $5533615b752eba30$var$getValueInRange(model, ranges[0], !matchCase);
    for(let i = 1, len = ranges.length; i < len; i++){
        const range = ranges[i];
        if (range.isEmpty()) return false;
        const thisSelectedText = $5533615b752eba30$var$getValueInRange(model, range, !matchCase);
        if (selectedText !== thisSelectedText) return false;
    }
    return true;
}
function $5533615b752eba30$var$getValueInRange(model, range, toLowerCase) {
    const text = model.getValueInRange(range);
    return toLowerCase ? text.toLowerCase() : text;
}
class $5533615b752eba30$export$abcab3c2c3e65904 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.focusNextCursor',
            label: $4dEdH.localize('mutlicursor.focusNextCursor', "Focus Next Cursor"),
            metadata: {
                description: $4dEdH.localize('mutlicursor.focusNextCursor.description', "Focuses the next cursor"),
                args: []
            },
            alias: 'Focus Next Cursor',
            precondition: undefined
        });
    }
    run(accessor, editor, args) {
        if (!editor.hasModel()) return;
        const viewModel = editor._getViewModel();
        if (viewModel.cursorConfig.readOnly) return;
        viewModel.model.pushStackElement();
        const previousCursorState = Array.from(viewModel.getCursorStates());
        const firstCursor = previousCursorState.shift();
        if (!firstCursor) return;
        previousCursorState.push(firstCursor);
        viewModel.setCursorStates(args.source, 3 /* CursorChangeReason.Explicit */ , previousCursorState);
        viewModel.revealPrimaryCursor(args.source, true);
        $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
    }
}
class $5533615b752eba30$export$2535ca639f43c0a8 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.focusPreviousCursor',
            label: $4dEdH.localize('mutlicursor.focusPreviousCursor', "Focus Previous Cursor"),
            metadata: {
                description: $4dEdH.localize('mutlicursor.focusPreviousCursor.description', "Focuses the previous cursor"),
                args: []
            },
            alias: 'Focus Previous Cursor',
            precondition: undefined
        });
    }
    run(accessor, editor, args) {
        if (!editor.hasModel()) return;
        const viewModel = editor._getViewModel();
        if (viewModel.cursorConfig.readOnly) return;
        viewModel.model.pushStackElement();
        const previousCursorState = Array.from(viewModel.getCursorStates());
        const firstCursor = previousCursorState.pop();
        if (!firstCursor) return;
        previousCursorState.unshift(firstCursor);
        viewModel.setCursorStates(args.source, 3 /* CursorChangeReason.Explicit */ , previousCursorState);
        viewModel.revealPrimaryCursor(args.source, true);
        $5533615b752eba30$var$announceCursorChange(previousCursorState, viewModel.getCursorStates());
    }
}
(0, $2iJTi.registerEditorContribution)($5533615b752eba30$export$72ef690ee4064f04.ID, $5533615b752eba30$export$72ef690ee4064f04, 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorContribution)($5533615b752eba30$export$e2d3f180605870d2.ID, $5533615b752eba30$export$e2d3f180605870d2, 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$a2a103e44264bbeb);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$a0aca99842abcc90);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$var$InsertCursorAtEndOfEachLineSelected);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$8f076283f2167b25);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$18b95272d65addf8);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$411b7432b064bcf7);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$1fb22e5b0da21ac2);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$d06ce53b2982cd37);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$22d364fb7d9f34a3);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$var$InsertCursorAtEndOfLineSelected);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$var$InsertCursorAtTopOfLineSelected);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$abcab3c2c3e65904);
(0, $2iJTi.registerEditorAction)($5533615b752eba30$export$2535ca639f43c0a8);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ const $caefdfeeddd1fee9$export$e2e7db96eedff096 = 'editor.action.inlineEdit.accept';
const $caefdfeeddd1fee9$export$5edf882d6a27d8ac = 'editor.action.inlineEdit.reject';
const $caefdfeeddd1fee9$export$a4fe2f52c1ca49b2 = 'editor.action.inlineEdit.jumpTo';
const $caefdfeeddd1fee9$export$b3d561592bebb71c = 'editor.action.inlineEdit.jumpBack';


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $kHJv6 = parcelRequire("kHJv6");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");


var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $h9Xpp = parcelRequire("h9Xpp");

var $1Y4vr = parcelRequire("1Y4vr");

var $k6oYA = parcelRequire("k6oYA");


var $a6rxD = parcelRequire("a6rxD");
var $02a9658baed3675a$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $02a9658baed3675a$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $02a9658baed3675a$export$6b9273b68a3e6f50 = 'inline-edit';
let $02a9658baed3675a$export$28b57199d8d32698 = class GhostTextWidget extends (0, $9cWcn.Disposable) {
    constructor(editor, model, languageService){
        super();
        this.editor = editor;
        this.model = model;
        this.languageService = languageService;
        this.isDisposed = (0, $4fzqs.observableValue)(this, false);
        this.currentTextModel = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeModel, ()=>/** @description editor.model */ this.editor.getModel());
        this.uiState = (0, $4fzqs.derived)(this, (reader)=>{
            if (this.isDisposed.read(reader)) return undefined;
            const textModel = this.currentTextModel.read(reader);
            if (textModel !== this.model.targetTextModel.read(reader)) return undefined;
            const ghostText = this.model.ghostText.read(reader);
            if (!ghostText) return undefined;
            let range = this.model.range?.read(reader);
            //if range is empty, we want to remove it
            if (range && range.startLineNumber === range.endLineNumber && range.startColumn === range.endColumn) range = undefined;
            //check if both range and text are single line - in this case we want to do inline replacement
            //rather than replacing whole lines
            const isSingleLine = (range ? range.startLineNumber === range.endLineNumber : true) && ghostText.parts.length === 1 && ghostText.parts[0].lines.length === 1;
            //check if we're just removing code
            const isPureRemove = ghostText.parts.length === 1 && ghostText.parts[0].lines.every((l)=>l.length === 0);
            const inlineTexts = [];
            const additionalLines = [];
            function addToAdditionalLines(lines, className) {
                if (additionalLines.length > 0) {
                    const lastLine = additionalLines[additionalLines.length - 1];
                    if (className) lastLine.decorations.push(new (0, $k6oYA.LineDecoration)(lastLine.content.length + 1, lastLine.content.length + 1 + lines[0].length, className, 0 /* InlineDecorationType.Regular */ ));
                    lastLine.content += lines[0];
                    lines = lines.slice(1);
                }
                for (const line of lines)additionalLines.push({
                    content: line,
                    decorations: className ? [
                        new (0, $k6oYA.LineDecoration)(1, line.length + 1, className, 0 /* InlineDecorationType.Regular */ )
                    ] : []
                });
            }
            const textBufferLine = textModel.getLineContent(ghostText.lineNumber);
            let hiddenTextStartColumn = undefined;
            let lastIdx = 0;
            if (!isPureRemove && (isSingleLine || !range)) {
                for (const part of ghostText.parts){
                    let lines = part.lines;
                    //If remove range is set, we want to push all new liens to virtual area
                    if (range && !isSingleLine) {
                        addToAdditionalLines(lines, $02a9658baed3675a$export$6b9273b68a3e6f50);
                        lines = [];
                    }
                    if (hiddenTextStartColumn === undefined) {
                        inlineTexts.push({
                            column: part.column,
                            text: lines[0],
                            preview: part.preview
                        });
                        lines = lines.slice(1);
                    } else addToAdditionalLines([
                        textBufferLine.substring(lastIdx, part.column - 1)
                    ], undefined);
                    if (lines.length > 0) {
                        addToAdditionalLines(lines, $02a9658baed3675a$export$6b9273b68a3e6f50);
                        if (hiddenTextStartColumn === undefined && part.column <= textBufferLine.length) hiddenTextStartColumn = part.column;
                    }
                    lastIdx = part.column - 1;
                }
                if (hiddenTextStartColumn !== undefined) addToAdditionalLines([
                    textBufferLine.substring(lastIdx)
                ], undefined);
            }
            const hiddenRange = hiddenTextStartColumn !== undefined ? new (0, $5176a6fee772219a$export$dbf33034d7f3ab1)(hiddenTextStartColumn, textBufferLine.length + 1) : undefined;
            const lineNumber = isSingleLine || !range ? ghostText.lineNumber : range.endLineNumber - 1;
            return {
                inlineTexts: inlineTexts,
                additionalLines: additionalLines,
                hiddenRange: hiddenRange,
                lineNumber: lineNumber,
                additionalReservedLineCount: this.model.minReservedLineCount.read(reader),
                targetTextModel: textModel,
                range: range,
                isSingleLine: isSingleLine,
                isPureRemove: isPureRemove
            };
        });
        this.decorations = (0, $4fzqs.derived)(this, (reader)=>{
            const uiState = this.uiState.read(reader);
            if (!uiState) return [];
            const decorations = [];
            if (uiState.hiddenRange) decorations.push({
                range: uiState.hiddenRange.toRange(uiState.lineNumber),
                options: {
                    inlineClassName: 'inline-edit-hidden',
                    description: 'inline-edit-hidden'
                }
            });
            if (uiState.range) {
                const ranges = [];
                if (uiState.isSingleLine) ranges.push(uiState.range);
                else if (!uiState.isPureRemove) {
                    const lines = uiState.range.endLineNumber - uiState.range.startLineNumber;
                    for(let i = 0; i < lines; i++){
                        const line = uiState.range.startLineNumber + i;
                        const firstNonWhitespace = uiState.targetTextModel.getLineFirstNonWhitespaceColumn(line);
                        const lastNonWhitespace = uiState.targetTextModel.getLineLastNonWhitespaceColumn(line);
                        const range = new (0, $d00il.Range)(line, firstNonWhitespace, line, lastNonWhitespace);
                        ranges.push(range);
                    }
                }
                for (const range of ranges)decorations.push({
                    range: range,
                    options: (0, $a6rxD.diffDeleteDecoration)
                });
            }
            if (uiState.range && !uiState.isSingleLine && uiState.isPureRemove) {
                const r = new (0, $d00il.Range)(uiState.range.startLineNumber, 1, uiState.range.endLineNumber - 1, 1);
                decorations.push({
                    range: r,
                    options: (0, $a6rxD.diffLineDeleteDecorationBackgroundWithIndicator)
                });
            }
            for (const p of uiState.inlineTexts)decorations.push({
                range: (0, $d00il.Range).fromPositions(new (0, $dcxQ7.Position)(uiState.lineNumber, p.column)),
                options: {
                    description: $02a9658baed3675a$export$6b9273b68a3e6f50,
                    after: {
                        content: p.text,
                        inlineClassName: p.preview ? 'inline-edit-decoration-preview' : 'inline-edit-decoration',
                        cursorStops: (0, $1Y4vr.InjectedTextCursorStops).Left
                    },
                    showIfCollapsed: true
                }
            });
            return decorations;
        });
        this._register((0, $9cWcn.toDisposable)(()=>{
            this.isDisposed.set(true, undefined);
        }));
        this._register((0, $5176a6fee772219a$export$826e152505a9989e)(this.editor, this.decorations));
    }
};
$02a9658baed3675a$export$28b57199d8d32698 = $02a9658baed3675a$var$__decorate([
    $02a9658baed3675a$var$__param(2, (0, $h9Xpp.ILanguageService))
], $02a9658baed3675a$export$28b57199d8d32698);



var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $kzNQX = parcelRequire("kzNQX");

var $4J6fu = parcelRequire("4J6fu");

var $giPcZ = parcelRequire("giPcZ");


var $8tcMz = parcelRequire("8tcMz");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $27s0k = parcelRequire("27s0k");

var $cVfMQ = parcelRequire("cVfMQ");

var $kJ8UG = parcelRequire("kJ8UG");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $lb0Ah = parcelRequire("lb0Ah");


var $dcxQ7 = parcelRequire("dcxQ7");

var $hbDWq = parcelRequire("hbDWq");

var $lNBi4 = parcelRequire("lNBi4");

var $g4v7E = parcelRequire("g4v7E");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");

var $d6K7e = parcelRequire("d6K7e");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $lMGba = parcelRequire("lMGba");
var $414329d184628f24$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $414329d184628f24$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $414329d184628f24$var$InlineEditHintsContentWidget_1;
let $414329d184628f24$export$1e9a41920a26cd2d = class InlineEditHintsWidget extends (0, $9cWcn.Disposable) {
    constructor(editor, model, instantiationService){
        super();
        this.editor = editor;
        this.model = model;
        this.instantiationService = instantiationService;
        this.alwaysShowToolbar = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(63 /* EditorOption.inlineEdit */ ).showToolbar === 'always');
        this.sessionPosition = undefined;
        this.position = (0, $4fzqs.derived)(this, (reader)=>{
            const ghostText = this.model.read(reader)?.model.ghostText.read(reader);
            if (!this.alwaysShowToolbar.read(reader) || !ghostText || ghostText.parts.length === 0) {
                this.sessionPosition = undefined;
                return null;
            }
            const firstColumn = ghostText.parts[0].column;
            if (this.sessionPosition && this.sessionPosition.lineNumber !== ghostText.lineNumber) this.sessionPosition = undefined;
            const position = new (0, $dcxQ7.Position)(ghostText.lineNumber, Math.min(firstColumn, this.sessionPosition?.column ?? Number.MAX_SAFE_INTEGER));
            this.sessionPosition = position;
            return position;
        });
        this._register((0, $4fzqs.autorunWithStore)((reader, store)=>{
            /** @description setup content widget */ const model = this.model.read(reader);
            if (!model || !this.alwaysShowToolbar.read(reader)) return;
            const contentWidget = store.add(this.instantiationService.createInstance($414329d184628f24$export$15253bb4a304133a, this.editor, true, this.position));
            editor.addContentWidget(contentWidget);
            store.add((0, $9cWcn.toDisposable)(()=>editor.removeContentWidget(contentWidget)));
        }));
    }
};
$414329d184628f24$export$1e9a41920a26cd2d = $414329d184628f24$var$__decorate([
    $414329d184628f24$var$__param(2, (0, $fdGPu.IInstantiationService))
], $414329d184628f24$export$1e9a41920a26cd2d);
let $414329d184628f24$export$15253bb4a304133a = class InlineEditHintsContentWidget extends (0, $9cWcn.Disposable) {
    static{
        $414329d184628f24$var$InlineEditHintsContentWidget_1 = this;
    }
    static{
        this._dropDownVisible = false;
    }
    static{
        this.id = 0;
    }
    constructor(editor, withBorder, _position, instantiationService, _contextKeyService, _menuService){
        super();
        this.editor = editor;
        this.withBorder = withBorder;
        this._position = _position;
        this._contextKeyService = _contextKeyService;
        this._menuService = _menuService;
        this.id = `InlineEditHintsContentWidget${$414329d184628f24$var$InlineEditHintsContentWidget_1.id++}`;
        this.allowEditorOverflow = true;
        this.suppressMouseDown = false;
        this.nodes = (0, $bDzmQ.h)('div.inlineEditHints', {
            className: this.withBorder ? '.withBorder' : ''
        }, [
            (0, $bDzmQ.h)('div@toolBar')
        ]);
        this.inlineCompletionsActionsMenus = this._register(this._menuService.createMenu((0, $g4v7E.MenuId).InlineEditActions, this._contextKeyService));
        this.toolBar = this._register(instantiationService.createInstance($414329d184628f24$export$d5fdeb440ea8130f, this.nodes.toolBar, this.editor, (0, $g4v7E.MenuId).InlineEditToolbar, {
            menuOptions: {
                renderShortTitle: true
            },
            toolbarOptions: {
                primaryGroup: (g)=>g.startsWith('primary')
            },
            actionViewItemProvider: (action, options)=>{
                if (action instanceof (0, $g4v7E.MenuItemAction)) return instantiationService.createInstance($414329d184628f24$var$StatusBarViewItem, action, undefined);
                return undefined;
            },
            telemetrySource: 'InlineEditToolbar'
        }));
        this._register(this.toolBar.onDidChangeDropdownVisibility((e)=>{
            $414329d184628f24$var$InlineEditHintsContentWidget_1._dropDownVisible = e;
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description update position */ this._position.read(reader);
            this.editor.layoutContentWidget(this);
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description actions menu */ const extraActions = [];
            for (const [_, group] of this.inlineCompletionsActionsMenus.getActions()){
                for (const action of group)if (action instanceof (0, $g4v7E.MenuItemAction)) extraActions.push(action);
            }
            if (extraActions.length > 0) extraActions.unshift(new (0, $cVfMQ.Separator)());
            this.toolBar.setAdditionalSecondaryActions(extraActions);
        }));
    }
    getId() {
        return this.id;
    }
    getDomNode() {
        return this.nodes.root;
    }
    getPosition() {
        return {
            position: this._position.get(),
            preference: [
                1 /* ContentWidgetPositionPreference.ABOVE */ ,
                2 /* ContentWidgetPositionPreference.BELOW */ 
            ],
            positionAffinity: 3 /* PositionAffinity.LeftOfInjectedText */ 
        };
    }
};
$414329d184628f24$export$15253bb4a304133a = $414329d184628f24$var$InlineEditHintsContentWidget_1 = $414329d184628f24$var$__decorate([
    $414329d184628f24$var$__param(3, (0, $fdGPu.IInstantiationService)),
    $414329d184628f24$var$__param(4, (0, $cxCeF.IContextKeyService)),
    $414329d184628f24$var$__param(5, (0, $g4v7E.IMenuService))
], $414329d184628f24$export$15253bb4a304133a);
class $414329d184628f24$var$StatusBarViewItem extends (0, $hbDWq.MenuEntryActionViewItem) {
    updateLabel() {
        const kb = this._keybindingService.lookupKeybinding(this._action.id, this._contextKeyService);
        if (!kb) return super.updateLabel();
        if (this.label) {
            const div = (0, $bDzmQ.h)('div.keybinding').root;
            const k = this._register(new (0, $27s0k.KeybindingLabel)(div, (0, $lb0Ah.OS), {
                disableTitle: true,
                ...(0, $27s0k.unthemedKeybindingLabelOptions)
            }));
            k.set(kb);
            this.label.textContent = this._action.label;
            this.label.appendChild(div);
            this.label.classList.add('inlineEditStatusBarItemLabel');
        }
    }
    updateTooltip() {
    // NOOP, disable tooltip
    }
}
let $414329d184628f24$export$d5fdeb440ea8130f = class CustomizedMenuWorkbenchToolBar extends (0, $lNBi4.WorkbenchToolBar) {
    constructor(container, editor, menuId, options2, menuService, contextKeyService, contextMenuService, keybindingService, commandService, telemetryService){
        super(container, {
            resetMenu: menuId,
            ...options2
        }, menuService, contextKeyService, contextMenuService, keybindingService, commandService, telemetryService);
        this.editor = editor;
        this.menuId = menuId;
        this.options2 = options2;
        this.menuService = menuService;
        this.contextKeyService = contextKeyService;
        this.menu = this._store.add(this.menuService.createMenu(this.menuId, this.contextKeyService, {
            emitEventsForSubmenuChanges: true
        }));
        this.additionalActions = [];
        this.prependedPrimaryActions = [];
        this._store.add(this.menu.onDidChange(()=>this.updateToolbar()));
        this._store.add(this.editor.onDidChangeCursorPosition(()=>this.updateToolbar()));
        this.updateToolbar();
    }
    updateToolbar() {
        const primary = [];
        const secondary = [];
        (0, $hbDWq.createAndFillInActionBarActions)(this.menu, this.options2?.menuOptions, {
            primary: primary,
            secondary: secondary
        }, this.options2?.toolbarOptions?.primaryGroup, this.options2?.toolbarOptions?.shouldInlineSubmenu, this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions);
        secondary.push(...this.additionalActions);
        primary.unshift(...this.prependedPrimaryActions);
        this.setActions(primary, secondary);
    }
    setAdditionalSecondaryActions(actions) {
        if ((0, $kJ8UG.equals)(this.additionalActions, actions, (a, b)=>a === b)) return;
        this.additionalActions = actions;
        this.updateToolbar();
    }
};
$414329d184628f24$export$d5fdeb440ea8130f = $414329d184628f24$var$__decorate([
    $414329d184628f24$var$__param(4, (0, $g4v7E.IMenuService)),
    $414329d184628f24$var$__param(5, (0, $cxCeF.IContextKeyService)),
    $414329d184628f24$var$__param(6, (0, $d6K7e.IContextMenuService)),
    $414329d184628f24$var$__param(7, (0, $7IxGd.IKeybindingService)),
    $414329d184628f24$var$__param(8, (0, $8tcMz.ICommandService)),
    $414329d184628f24$var$__param(9, (0, $lMGba.ITelemetryService))
], $414329d184628f24$export$d5fdeb440ea8130f);



var $bDzmQ = parcelRequire("bDzmQ");

var $35IZ9 = parcelRequire("35IZ9");

var $gPkHZ = parcelRequire("gPkHZ");

var $5Gd0V = parcelRequire("5Gd0V");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $giPcZ = parcelRequire("giPcZ");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $5Gd0V = parcelRequire("5Gd0V");

var $5OJ54 = parcelRequire("5OJ54");


var $iEpUY = parcelRequire("iEpUY");


var $aHgze = parcelRequire("aHgze");

var $a6rxD = parcelRequire("a6rxD");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $9QNEO = parcelRequire("9QNEO");

var $91ntV = parcelRequire("91ntV");

var $cKKJT = parcelRequire("cKKJT");

var $fdGPu = parcelRequire("fdGPu");
var $ca93ccfda5b631b3$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $ca93ccfda5b631b3$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $ca93ccfda5b631b3$var$InlineEditSideBySideWidget_1, $ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget_1;
function* $ca93ccfda5b631b3$var$range(start, end, step = 1) {
    if (end === undefined) [end, start] = [
        start,
        0
    ];
    for(let n = start; n < end; n += step)yield n;
}
function $ca93ccfda5b631b3$var$removeIndentation(lines) {
    const indentation = lines[0].match(/^\s*/)?.[0] ?? '';
    const length = indentation.length;
    return {
        text: lines.map((l)=>l.replace(new RegExp('^' + indentation), '')),
        shift: length
    };
}
let $ca93ccfda5b631b3$export$d496665f42fec828 = class InlineEditSideBySideWidget extends (0, $9cWcn.Disposable) {
    static{
        $ca93ccfda5b631b3$var$InlineEditSideBySideWidget_1 = this;
    }
    static{
        this._modelId = 0;
    }
    static _createUniqueUri() {
        return (0, $5OJ54.URI).from({
            scheme: 'inline-edit-widget',
            path: new Date().toString() + String($ca93ccfda5b631b3$var$InlineEditSideBySideWidget_1._modelId++)
        });
    }
    constructor(_editor, _model, _instantiationService, _diffProviderFactoryService, _modelService){
        super();
        this._editor = _editor;
        this._model = _model;
        this._instantiationService = _instantiationService;
        this._diffProviderFactoryService = _diffProviderFactoryService;
        this._modelService = _modelService;
        this._position = (0, $4fzqs.derived)(this, (reader)=>{
            const ghostText = this._model.read(reader);
            if (!ghostText || ghostText.text.length === 0) return null;
            if (ghostText.range.startLineNumber === ghostText.range.endLineNumber && !(ghostText.range.startColumn === ghostText.range.endColumn && ghostText.range.startColumn === 1)) //for inner-line suggestions we still want to use minimal ghost text
            return null;
            const editorModel = this._editor.getModel();
            if (!editorModel) return null;
            const lines = Array.from($ca93ccfda5b631b3$var$range(ghostText.range.startLineNumber, ghostText.range.endLineNumber + 1));
            const lengths = lines.map((lineNumber)=>editorModel.getLineLastNonWhitespaceColumn(lineNumber));
            const maxColumn = Math.max(...lengths);
            const lineOfMaxColumn = lines[lengths.indexOf(maxColumn)];
            const position = new (0, $dcxQ7.Position)(lineOfMaxColumn, maxColumn);
            const pos = {
                top: ghostText.range.startLineNumber,
                left: position
            };
            return pos;
        });
        this._text = (0, $4fzqs.derived)(this, (reader)=>{
            const ghostText = this._model.read(reader);
            if (!ghostText) return {
                text: '',
                shift: 0
            };
            const t = $ca93ccfda5b631b3$var$removeIndentation(ghostText.text.split('\n'));
            return {
                text: t.text.join('\n'),
                shift: t.shift
            };
        });
        this._originalModel = (0, $5Gd0V.derivedDisposable)(()=>this._modelService.createModel('', null, $ca93ccfda5b631b3$var$InlineEditSideBySideWidget_1._createUniqueUri())).keepObserved(this._store);
        this._modifiedModel = (0, $5Gd0V.derivedDisposable)(()=>this._modelService.createModel('', null, $ca93ccfda5b631b3$var$InlineEditSideBySideWidget_1._createUniqueUri())).keepObserved(this._store);
        this._diff = (0, $4fzqs.derived)(this, (reader)=>{
            return this._diffPromise.read(reader)?.promiseResult.read(reader)?.data;
        });
        this._diffPromise = (0, $4fzqs.derived)(this, (reader)=>{
            const ghostText = this._model.read(reader);
            if (!ghostText) return;
            const editorModel = this._editor.getModel();
            if (!editorModel) return;
            const originalText = $ca93ccfda5b631b3$var$removeIndentation(editorModel.getValueInRange(ghostText.range).split('\n')).text.join('\n');
            const modifiedText = $ca93ccfda5b631b3$var$removeIndentation(ghostText.text.split('\n')).text.join('\n');
            this._originalModel.get().setValue(originalText);
            this._modifiedModel.get().setValue(modifiedText);
            const d = this._diffProviderFactoryService.createDiffProvider({
                diffAlgorithm: 'advanced'
            });
            return (0, $4fzqs.ObservablePromise).fromFn(async ()=>{
                const result = await d.computeDiff(this._originalModel.get(), this._modifiedModel.get(), {
                    computeMoves: false,
                    ignoreTrimWhitespace: false,
                    maxComputationTimeMs: 1000
                }, (0, $giPcZ.CancellationToken).None);
                if (result.identical) return undefined;
                return result.changes;
            });
        });
        this._register((0, $4fzqs.autorunWithStore)((reader, store)=>{
            /** @description setup content widget */ const model = this._model.read(reader);
            if (!model) return;
            if (this._position.get() === null) return;
            const contentWidget = store.add(this._instantiationService.createInstance($ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget, this._editor, this._position, this._text.map((t)=>t.text), this._text.map((t)=>t.shift), this._diff));
            _editor.addOverlayWidget(contentWidget);
            store.add((0, $9cWcn.toDisposable)(()=>_editor.removeOverlayWidget(contentWidget)));
        }));
    }
};
$ca93ccfda5b631b3$export$d496665f42fec828 = $ca93ccfda5b631b3$var$InlineEditSideBySideWidget_1 = $ca93ccfda5b631b3$var$__decorate([
    $ca93ccfda5b631b3$var$__param(2, (0, $fdGPu.IInstantiationService)),
    $ca93ccfda5b631b3$var$__param(3, (0, $aHgze.IDiffProviderFactoryService)),
    $ca93ccfda5b631b3$var$__param(4, (0, $cKKJT.IModelService))
], $ca93ccfda5b631b3$export$d496665f42fec828);
let $ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget = class InlineEditSideBySideContentWidget extends (0, $9cWcn.Disposable) {
    static{
        $ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget_1 = this;
    }
    static{
        this.id = 0;
    }
    constructor(_editor, _position, _text, _shift, _diff, _instantiationService){
        super();
        this._editor = _editor;
        this._position = _position;
        this._text = _text;
        this._shift = _shift;
        this._diff = _diff;
        this._instantiationService = _instantiationService;
        this.id = `InlineEditSideBySideContentWidget${$ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget_1.id++}`;
        this.allowEditorOverflow = false;
        this._nodes = (0, $bDzmQ.$)('div.inlineEditSideBySide', undefined);
        this._scrollChanged = (0, $4fzqs.observableSignalFromEvent)('editor.onDidScrollChange', this._editor.onDidScrollChange);
        this._previewEditor = this._register(this._instantiationService.createInstance((0, $205d91d7661de01d$export$3c7efbd913d316d0), this._nodes, {
            glyphMargin: false,
            lineNumbers: 'off',
            minimap: {
                enabled: false
            },
            guides: {
                indentation: false,
                bracketPairs: false,
                bracketPairsHorizontal: false,
                highlightActiveIndentation: false
            },
            folding: false,
            selectOnLineNumbers: false,
            selectionHighlight: false,
            columnSelection: false,
            overviewRulerBorder: false,
            overviewRulerLanes: 0,
            lineDecorationsWidth: 0,
            lineNumbersMinChars: 0,
            scrollbar: {
                vertical: 'hidden',
                horizontal: 'hidden',
                alwaysConsumeMouseWheel: false,
                handleMouseWheel: false
            },
            readOnly: true,
            wordWrap: 'off',
            wordWrapOverride1: 'off',
            wordWrapOverride2: 'off',
            wrappingIndent: 'none',
            wrappingStrategy: undefined
        }, {
            contributions: [],
            isSimpleWidget: true
        }, this._editor));
        this._previewEditorObs = (0, $iEpUY.observableCodeEditor)(this._previewEditor);
        this._editorObs = (0, $iEpUY.observableCodeEditor)(this._editor);
        this._previewTextModel = this._register(this._instantiationService.createInstance((0, $91ntV.TextModel), '', this._editor.getModel()?.getLanguageId() ?? (0, $9QNEO.PLAINTEXT_LANGUAGE_ID), (0, $91ntV.TextModel).DEFAULT_CREATION_OPTIONS, null));
        this._setText = (0, $4fzqs.derived)((reader)=>{
            const edit = this._text.read(reader);
            if (!edit) return;
            this._previewTextModel.setValue(edit);
        }).recomputeInitiallyAndOnChange(this._store);
        this._decorations = (0, $4fzqs.derived)(this, (reader)=>{
            this._setText.read(reader);
            const position = this._position.read(reader);
            if (!position) return {
                org: [],
                mod: []
            };
            const diff = this._diff.read(reader);
            if (!diff) return {
                org: [],
                mod: []
            };
            const originalDecorations = [];
            const modifiedDecorations = [];
            if (diff.length === 1 && diff[0].innerChanges[0].modifiedRange.equalsRange(this._previewTextModel.getFullModelRange())) return {
                org: [],
                mod: []
            };
            const shift = this._shift.get();
            const moveRange = (range)=>{
                return new (0, $d00il.Range)(range.startLineNumber + position.top - 1, range.startColumn + shift, range.endLineNumber + position.top - 1, range.endColumn + shift);
            };
            for (const m of diff){
                if (!m.original.isEmpty) originalDecorations.push({
                    range: moveRange(m.original.toInclusiveRange()),
                    options: (0, $a6rxD.diffLineDeleteDecorationBackgroundWithIndicator)
                });
                if (!m.modified.isEmpty) modifiedDecorations.push({
                    range: m.modified.toInclusiveRange(),
                    options: (0, $a6rxD.diffLineAddDecorationBackgroundWithIndicator)
                });
                if (m.modified.isEmpty || m.original.isEmpty) {
                    if (!m.original.isEmpty) originalDecorations.push({
                        range: moveRange(m.original.toInclusiveRange()),
                        options: (0, $a6rxD.diffWholeLineDeleteDecoration)
                    });
                    if (!m.modified.isEmpty) modifiedDecorations.push({
                        range: m.modified.toInclusiveRange(),
                        options: (0, $a6rxD.diffWholeLineAddDecoration)
                    });
                } else for (const i of m.innerChanges || []){
                    // Don't show empty markers outside the line range
                    if (m.original.contains(i.originalRange.startLineNumber)) originalDecorations.push({
                        range: moveRange(i.originalRange),
                        options: i.originalRange.isEmpty() ? (0, $a6rxD.diffDeleteDecorationEmpty) : (0, $a6rxD.diffDeleteDecoration)
                    });
                    if (m.modified.contains(i.modifiedRange.startLineNumber)) modifiedDecorations.push({
                        range: i.modifiedRange,
                        options: i.modifiedRange.isEmpty() ? (0, $a6rxD.diffAddDecorationEmpty) : (0, $a6rxD.diffAddDecoration)
                    });
                }
            }
            return {
                org: originalDecorations,
                mod: modifiedDecorations
            };
        });
        this._originalDecorations = (0, $4fzqs.derived)(this, (reader)=>{
            return this._decorations.read(reader).org;
        });
        this._modifiedDecorations = (0, $4fzqs.derived)(this, (reader)=>{
            return this._decorations.read(reader).mod;
        });
        this._previewEditor.setModel(this._previewTextModel);
        this._register(this._editorObs.setDecorations(this._originalDecorations));
        this._register(this._previewEditorObs.setDecorations(this._modifiedDecorations));
        this._register((0, $4fzqs.autorun)((reader)=>{
            const width = this._previewEditorObs.contentWidth.read(reader);
            const lines = this._text.read(reader).split('\n').length - 1;
            const height = this._editor.getOption(67 /* EditorOption.lineHeight */ ) * lines;
            if (width <= 0) return;
            this._previewEditor.layout({
                height: height,
                width: width
            });
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description update position */ this._position.read(reader);
            this._editor.layoutOverlayWidget(this);
        }));
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description scroll change */ this._scrollChanged.read(reader);
            const position = this._position.read(reader);
            if (!position) return;
            this._editor.layoutOverlayWidget(this);
        }));
    }
    getId() {
        return this.id;
    }
    getDomNode() {
        return this._nodes;
    }
    getPosition() {
        const position = this._position.get();
        if (!position) return null;
        const layoutInfo = this._editor.getLayoutInfo();
        const visibPos = this._editor.getScrolledVisiblePosition(new (0, $dcxQ7.Position)(position.top, 1));
        if (!visibPos) return null;
        const top = visibPos.top - 1; //-1 to offset the border width
        const offset = this._editor.getOffsetForColumn(position.left.lineNumber, position.left.column);
        const left = layoutInfo.contentLeft + offset + 10;
        return {
            preference: {
                left: left,
                top: top
            }
        };
    }
};
$ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget = $ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget_1 = $ca93ccfda5b631b3$var$__decorate([
    $ca93ccfda5b631b3$var$__param(5, (0, $fdGPu.IInstantiationService))
], $ca93ccfda5b631b3$var$InlineEditSideBySideContentWidget);



var $aHgze = parcelRequire("aHgze");

var $cKKJT = parcelRequire("cKKJT");
var $55262f86db00b934$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $55262f86db00b934$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $55262f86db00b934$var$InlineEditController_1;
let $55262f86db00b934$export$930cc2864c4bca0f = class InlineEditController extends (0, $9cWcn.Disposable) {
    static{
        $55262f86db00b934$var$InlineEditController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.inlineEditController';
    }
    static{
        this.inlineEditVisibleKey = 'inlineEditVisible';
    }
    static{
        this.inlineEditVisibleContext = new (0, $cxCeF.RawContextKey)(this.inlineEditVisibleKey, false);
    }
    static{
        this.cursorAtInlineEditKey = 'cursorAtInlineEdit';
    }
    static{
        this.cursorAtInlineEditContext = new (0, $cxCeF.RawContextKey)(this.cursorAtInlineEditKey, false);
    }
    static get(editor) {
        return editor.getContribution($55262f86db00b934$var$InlineEditController_1.ID);
    }
    constructor(editor, instantiationService, contextKeyService, languageFeaturesService, _commandService, _configurationService, _diffProviderFactoryService, _modelService){
        super();
        this.editor = editor;
        this.instantiationService = instantiationService;
        this.contextKeyService = contextKeyService;
        this.languageFeaturesService = languageFeaturesService;
        this._commandService = _commandService;
        this._configurationService = _configurationService;
        this._diffProviderFactoryService = _diffProviderFactoryService;
        this._modelService = _modelService;
        this._isVisibleContext = $55262f86db00b934$var$InlineEditController_1.inlineEditVisibleContext.bindTo(this.contextKeyService);
        this._isCursorAtInlineEditContext = $55262f86db00b934$var$InlineEditController_1.cursorAtInlineEditContext.bindTo(this.contextKeyService);
        this._currentEdit = (0, $4fzqs.observableValue)(this, undefined);
        this._currentWidget = (0, $5Gd0V.derivedDisposable)(this._currentEdit, (reader)=>{
            const edit = this._currentEdit.read(reader);
            if (!edit) return undefined;
            const line = edit.range.endLineNumber;
            const column = edit.range.endColumn;
            const textToDisplay = edit.text.endsWith('\n') && !(edit.range.startLineNumber === edit.range.endLineNumber && edit.range.startColumn === edit.range.endColumn) ? edit.text.slice(0, -1) : edit.text;
            const ghostText = new (0, $3d1b516e94b9053f$export$9415a6e27591b584)(line, [
                new (0, $3d1b516e94b9053f$export$cd17cedf46fe2f2)(column, textToDisplay, false)
            ]);
            //only show ghost text for single line edits
            //unless it is a pure removal
            //multi line edits are shown in the side by side widget
            const isSingleLine = edit.range.startLineNumber === edit.range.endLineNumber && ghostText.parts.length === 1 && ghostText.parts[0].lines.length === 1;
            const isPureRemoval = edit.text === '';
            if (!isSingleLine && !isPureRemoval) return undefined;
            const instance = this.instantiationService.createInstance((0, $02a9658baed3675a$export$28b57199d8d32698), this.editor, {
                ghostText: (0, $4fzqs.constObservable)(ghostText),
                minReservedLineCount: (0, $4fzqs.constObservable)(0),
                targetTextModel: (0, $4fzqs.constObservable)(this.editor.getModel() ?? undefined),
                range: (0, $4fzqs.constObservable)(edit.range)
            });
            return instance;
        });
        this._isAccepting = (0, $4fzqs.observableValue)(this, false);
        this._enabled = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(63 /* EditorOption.inlineEdit */ ).enabled);
        this._fontFamily = (0, $4fzqs.observableFromEvent)(this, this.editor.onDidChangeConfiguration, ()=>this.editor.getOption(63 /* EditorOption.inlineEdit */ ).fontFamily);
        //Automatically request inline edit when the content was changed
        //Cancel the previous request if there is one
        //Remove the previous ghost text
        const modelChangedSignal = (0, $4fzqs.observableSignalFromEvent)('InlineEditController.modelContentChangedSignal', editor.onDidChangeModelContent);
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description InlineEditController.modelContentChanged model */ if (!this._enabled.read(reader)) return;
            modelChangedSignal.read(reader);
            if (this._isAccepting.read(reader)) return;
            this.getInlineEdit(editor, true);
        }));
        //Check if the cursor is at the ghost text
        const cursorPosition = (0, $4fzqs.observableFromEvent)(this, editor.onDidChangeCursorPosition, ()=>editor.getPosition());
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description InlineEditController.cursorPositionChanged model */ if (!this._enabled.read(reader)) return;
            const pos = cursorPosition.read(reader);
            if (pos) this.checkCursorPosition(pos);
        }));
        //Perform stuff when the current edit has changed
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description InlineEditController.update model */ const currentEdit = this._currentEdit.read(reader);
            this._isCursorAtInlineEditContext.set(false);
            if (!currentEdit) {
                this._isVisibleContext.set(false);
                return;
            }
            this._isVisibleContext.set(true);
            const pos = editor.getPosition();
            if (pos) this.checkCursorPosition(pos);
        }));
        //Clear suggestions on lost focus
        const editorBlurSingal = (0, $4fzqs.observableSignalFromEvent)('InlineEditController.editorBlurSignal', editor.onDidBlurEditorWidget);
        this._register((0, $4fzqs.autorun)(async (reader)=>{
            /** @description InlineEditController.editorBlur */ if (!this._enabled.read(reader)) return;
            editorBlurSingal.read(reader);
            // This is a hidden setting very useful for debugging
            if (this._configurationService.getValue('editor.experimentalInlineEdit.keepOnBlur') || editor.getOption(63 /* EditorOption.inlineEdit */ ).keepOnBlur) return;
            this._currentRequestCts?.dispose(true);
            this._currentRequestCts = undefined;
            await this.clear(false);
        }));
        //Invoke provider on focus
        const editorFocusSignal = (0, $4fzqs.observableSignalFromEvent)('InlineEditController.editorFocusSignal', editor.onDidFocusEditorText);
        this._register((0, $4fzqs.autorun)((reader)=>{
            /** @description InlineEditController.editorFocus */ if (!this._enabled.read(reader)) return;
            editorFocusSignal.read(reader);
            this.getInlineEdit(editor, true);
        }));
        //handle changes of font setting
        const styleElement = this._register((0, $bDzmQ.createStyleSheet2)());
        this._register((0, $4fzqs.autorun)((reader)=>{
            const fontFamily = this._fontFamily.read(reader);
            styleElement.setStyle(fontFamily === '' || fontFamily === 'default' ? `` : `
.monaco-editor .inline-edit-decoration,
.monaco-editor .inline-edit-decoration-preview,
.monaco-editor .inline-edit {
	font-family: ${fontFamily};
}`);
        }));
        this._register(new (0, $414329d184628f24$export$1e9a41920a26cd2d)(this.editor, this._currentWidget, this.instantiationService));
        this._register(new (0, $ca93ccfda5b631b3$export$d496665f42fec828)(this.editor, this._currentEdit, this.instantiationService, this._diffProviderFactoryService, this._modelService));
    }
    checkCursorPosition(position) {
        if (!this._currentEdit) {
            this._isCursorAtInlineEditContext.set(false);
            return;
        }
        const gt = this._currentEdit.get();
        if (!gt) {
            this._isCursorAtInlineEditContext.set(false);
            return;
        }
        this._isCursorAtInlineEditContext.set((0, $d00il.Range).containsPosition(gt.range, position));
    }
    validateInlineEdit(editor, edit) {
        //Multiline inline replacing edit must replace whole lines
        if (edit.text.includes('\n') && edit.range.startLineNumber !== edit.range.endLineNumber && edit.range.startColumn !== edit.range.endColumn) {
            const firstColumn = edit.range.startColumn;
            if (firstColumn !== 1) return false;
            const lastLine = edit.range.endLineNumber;
            const lastColumn = edit.range.endColumn;
            const lineLength = editor.getModel()?.getLineLength(lastLine) ?? 0;
            if (lastColumn !== lineLength + 1) return false;
        }
        return true;
    }
    async fetchInlineEdit(editor, auto) {
        if (this._currentRequestCts) this._currentRequestCts.dispose(true);
        const model = editor.getModel();
        if (!model) return;
        const modelVersion = model.getVersionId();
        const providers = this.languageFeaturesService.inlineEditProvider.all(model);
        if (providers.length === 0) return;
        const provider = providers[0];
        this._currentRequestCts = new (0, $giPcZ.CancellationTokenSource)();
        const token = this._currentRequestCts.token;
        const triggerKind = auto ? (0, $kzNQX.InlineEditTriggerKind).Automatic : (0, $kzNQX.InlineEditTriggerKind).Invoke;
        const shouldDebounce = auto;
        if (shouldDebounce) await $55262f86db00b934$var$wait(50, token);
        if (token.isCancellationRequested || model.isDisposed() || model.getVersionId() !== modelVersion) return;
        const edit = await provider.provideInlineEdit(model, {
            triggerKind: triggerKind
        }, token);
        if (!edit) return;
        if (token.isCancellationRequested || model.isDisposed() || model.getVersionId() !== modelVersion) return;
        if (!this.validateInlineEdit(editor, edit)) return;
        return edit;
    }
    async getInlineEdit(editor, auto) {
        this._isCursorAtInlineEditContext.set(false);
        await this.clear();
        const edit = await this.fetchInlineEdit(editor, auto);
        if (!edit) return;
        this._currentEdit.set(edit, undefined);
    }
    async trigger() {
        await this.getInlineEdit(this.editor, false);
    }
    async jumpBack() {
        if (!this._jumpBackPosition) return;
        this.editor.setPosition(this._jumpBackPosition);
        //if position is outside viewports, scroll to it
        this.editor.revealPositionInCenterIfOutsideViewport(this._jumpBackPosition);
    }
    async accept() {
        this._isAccepting.set(true, undefined);
        const data = this._currentEdit.get();
        if (!data) return;
        //It should only happen in case of last line suggestion
        let text = data.text;
        if (data.text.startsWith('\n')) text = data.text.substring(1);
        this.editor.pushUndoStop();
        this.editor.executeEdits('acceptCurrent', [
            (0, $kHJv6.EditOperation).replace((0, $d00il.Range).lift(data.range), text)
        ]);
        if (data.accepted) await this._commandService.executeCommand(data.accepted.id, ...data.accepted.arguments || []).then(undefined, (0, $gPkHZ.onUnexpectedExternalError));
        this.freeEdit(data);
        (0, $4fzqs.transaction)((tx)=>{
            this._currentEdit.set(undefined, tx);
            this._isAccepting.set(false, tx);
        });
    }
    jumpToCurrent() {
        this._jumpBackPosition = this.editor.getSelection()?.getStartPosition();
        const data = this._currentEdit.get();
        if (!data) return;
        const position = (0, $dcxQ7.Position).lift({
            lineNumber: data.range.startLineNumber,
            column: data.range.startColumn
        });
        this.editor.setPosition(position);
        //if position is outside viewports, scroll to it
        this.editor.revealPositionInCenterIfOutsideViewport(position);
    }
    async clear(sendRejection = true) {
        const edit = this._currentEdit.get();
        if (edit && edit?.rejected && sendRejection) await this._commandService.executeCommand(edit.rejected.id, ...edit.rejected.arguments || []).then(undefined, (0, $gPkHZ.onUnexpectedExternalError));
        if (edit) this.freeEdit(edit);
        this._currentEdit.set(undefined, undefined);
    }
    freeEdit(edit) {
        const model = this.editor.getModel();
        if (!model) return;
        const providers = this.languageFeaturesService.inlineEditProvider.all(model);
        if (providers.length === 0) return;
        providers[0].freeInlineEdit(edit);
    }
};
$55262f86db00b934$export$930cc2864c4bca0f = $55262f86db00b934$var$InlineEditController_1 = $55262f86db00b934$var$__decorate([
    $55262f86db00b934$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $55262f86db00b934$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $55262f86db00b934$var$__param(3, (0, $4J6fu.ILanguageFeaturesService)),
    $55262f86db00b934$var$__param(4, (0, $8tcMz.ICommandService)),
    $55262f86db00b934$var$__param(5, (0, $35IZ9.IConfigurationService)),
    $55262f86db00b934$var$__param(6, (0, $aHgze.IDiffProviderFactoryService)),
    $55262f86db00b934$var$__param(7, (0, $cKKJT.IModelService))
], $55262f86db00b934$export$930cc2864c4bca0f);
function $55262f86db00b934$var$wait(ms, cancellationToken) {
    return new Promise((resolve)=>{
        let d = undefined;
        const handle = setTimeout(()=>{
            if (d) d.dispose();
            resolve();
        }, ms);
        if (cancellationToken) d = cancellationToken.onCancellationRequested(()=>{
            clearTimeout(handle);
            if (d) d.dispose();
            resolve();
        });
    });
}



var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");
class $d746bf549fde6793$export$eaa4daf49ee5eead extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $caefdfeeddd1fee9$export$e2e7db96eedff096),
            label: 'Accept Inline Edit',
            alias: 'Accept Inline Edit',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $55262f86db00b934$export$930cc2864c4bca0f).inlineEditVisibleContext),
            kbOpts: [
                {
                    weight: 101,
                    primary: 2 /* KeyCode.Tab */ ,
                    kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $55262f86db00b934$export$930cc2864c4bca0f).inlineEditVisibleContext, (0, $55262f86db00b934$export$930cc2864c4bca0f).cursorAtInlineEditContext)
                }
            ],
            menuOpts: [
                {
                    menuId: (0, $g4v7E.MenuId).InlineEditToolbar,
                    title: 'Accept',
                    group: 'primary',
                    order: 1
                }
            ]
        });
    }
    async run(accessor, editor) {
        const controller = (0, $55262f86db00b934$export$930cc2864c4bca0f).get(editor);
        await controller?.accept();
    }
}
class $d746bf549fde6793$export$ea02984e00e4e0c9 extends (0, $2iJTi.EditorAction) {
    constructor(){
        const activeExpr = (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $cxCeF.ContextKeyExpr).not((0, $55262f86db00b934$export$930cc2864c4bca0f).inlineEditVisibleKey));
        super({
            id: 'editor.action.inlineEdit.trigger',
            label: 'Trigger Inline Edit',
            alias: 'Trigger Inline Edit',
            precondition: activeExpr,
            kbOpts: {
                weight: 101,
                primary: 2646 /* KeyCode.Equal */ ,
                kbExpr: activeExpr
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $55262f86db00b934$export$930cc2864c4bca0f).get(editor);
        controller?.trigger();
    }
}
class $d746bf549fde6793$export$daeb4c0ff10d95d5 extends (0, $2iJTi.EditorAction) {
    constructor(){
        const activeExpr = (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $55262f86db00b934$export$930cc2864c4bca0f).inlineEditVisibleContext, (0, $cxCeF.ContextKeyExpr).not((0, $55262f86db00b934$export$930cc2864c4bca0f).cursorAtInlineEditKey));
        super({
            id: (0, $caefdfeeddd1fee9$export$a4fe2f52c1ca49b2),
            label: 'Jump to Inline Edit',
            alias: 'Jump to Inline Edit',
            precondition: activeExpr,
            kbOpts: {
                weight: 101,
                primary: 2646 /* KeyCode.Equal */ ,
                kbExpr: activeExpr
            },
            menuOpts: [
                {
                    menuId: (0, $g4v7E.MenuId).InlineEditToolbar,
                    title: 'Jump To Edit',
                    group: 'primary',
                    order: 3,
                    when: activeExpr
                }
            ]
        });
    }
    async run(accessor, editor) {
        const controller = (0, $55262f86db00b934$export$930cc2864c4bca0f).get(editor);
        controller?.jumpToCurrent();
    }
}
class $d746bf549fde6793$export$1520b0b1bd1a3704 extends (0, $2iJTi.EditorAction) {
    constructor(){
        const activeExpr = (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $55262f86db00b934$export$930cc2864c4bca0f).cursorAtInlineEditContext);
        super({
            id: (0, $caefdfeeddd1fee9$export$b3d561592bebb71c),
            label: 'Jump Back from Inline Edit',
            alias: 'Jump Back from Inline Edit',
            precondition: activeExpr,
            kbOpts: {
                weight: 110,
                primary: 2646 /* KeyCode.Equal */ ,
                kbExpr: activeExpr
            },
            menuOpts: [
                {
                    menuId: (0, $g4v7E.MenuId).InlineEditToolbar,
                    title: 'Jump Back',
                    group: 'primary',
                    order: 3,
                    when: activeExpr
                }
            ]
        });
    }
    async run(accessor, editor) {
        const controller = (0, $55262f86db00b934$export$930cc2864c4bca0f).get(editor);
        controller?.jumpBack();
    }
}
class $d746bf549fde6793$export$1cdb0fe0a386a62c extends (0, $2iJTi.EditorAction) {
    constructor(){
        const activeExpr = (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $55262f86db00b934$export$930cc2864c4bca0f).inlineEditVisibleContext);
        super({
            id: (0, $caefdfeeddd1fee9$export$5edf882d6a27d8ac),
            label: 'Reject Inline Edit',
            alias: 'Reject Inline Edit',
            precondition: activeExpr,
            kbOpts: {
                weight: 100 /* KeybindingWeight.EditorContrib */ ,
                primary: 9 /* KeyCode.Escape */ ,
                kbExpr: activeExpr
            },
            menuOpts: [
                {
                    menuId: (0, $g4v7E.MenuId).InlineEditToolbar,
                    title: 'Reject',
                    group: 'secondary',
                    order: 2
                }
            ]
        });
    }
    async run(accessor, editor) {
        const controller = (0, $55262f86db00b934$export$930cc2864c4bca0f).get(editor);
        await controller?.clear();
    }
}



(0, $2iJTi.registerEditorAction)((0, $d746bf549fde6793$export$eaa4daf49ee5eead));
(0, $2iJTi.registerEditorAction)((0, $d746bf549fde6793$export$1cdb0fe0a386a62c));
(0, $2iJTi.registerEditorAction)((0, $d746bf549fde6793$export$daeb4c0ff10d95d5));
(0, $2iJTi.registerEditorAction)((0, $d746bf549fde6793$export$1520b0b1bd1a3704));
(0, $2iJTi.registerEditorAction)((0, $d746bf549fde6793$export$ea02984e00e4e0c9));
(0, $2iJTi.registerEditorContribution)((0, $55262f86db00b934$export$930cc2864c4bca0f).ID, (0, $55262f86db00b934$export$930cc2864c4bca0f), 3 /* EditorContributionInstantiation.Eventually */ ); // HoverParticipantRegistry.register(InlineEditHoverParticipant);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $awgRE = parcelRequire("awgRE");

var $4fzqs = parcelRequire("4fzqs");

var $fDQAu = parcelRequire("fDQAu");

var $2iJTi = parcelRequire("2iJTi");


var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");
const $5d7ea48a5dd11dc9$export$e2e7db96eedff096 = 'editor.action.inlineEdits.accept';
const $5d7ea48a5dd11dc9$export$c126e0a722243af3 = 'editor.action.inlineEdits.showPrevious';
const $5d7ea48a5dd11dc9$export$2784db725d91adff = 'editor.action.inlineEdits.showNext';
const $5d7ea48a5dd11dc9$export$9b45cd67ef61ab4f = new (0, $cxCeF.RawContextKey)('inlineEditsVisible', false, (0, $4dEdH.localize)('inlineEditsVisible', "Whether an inline edit is visible"));
const $5d7ea48a5dd11dc9$export$68599a07c1620460 = new (0, $cxCeF.RawContextKey)('inlineEditsIsPinned', false, (0, $4dEdH.localize)('isPinned', "Whether an inline edit is visible"));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $5Gd0V = parcelRequire("5Gd0V");

var $iEpUY = parcelRequire("iEpUY");

var $kImF8 = parcelRequire("kImF8");

var $jzicX = parcelRequire("jzicX");

var $goG89 = parcelRequire("goG89");

var $4J6fu = parcelRequire("4J6fu");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $a0vti = parcelRequire("a0vti");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $5Gd0V = parcelRequire("5Gd0V");

var $5OJ54 = parcelRequire("5OJ54");

var $aHgze = parcelRequire("aHgze");

var $lyGtO = parcelRequire("lyGtO");

var $kzNQX = parcelRequire("kzNQX");

var $4J6fu = parcelRequire("4J6fu");

var $cKKJT = parcelRequire("cKKJT");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $3J5Aj = parcelRequire("3J5Aj");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $5Gd0V = parcelRequire("5Gd0V");


var $2iJTi = parcelRequire("2iJTi");

var $iEpUY = parcelRequire("iEpUY");


var $a6rxD = parcelRequire("a6rxD");

var $02z4I = parcelRequire("02z4I");

var $9QNEO = parcelRequire("9QNEO");

var $91ntV = parcelRequire("91ntV");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $a0vti = parcelRequire("a0vti");

var $9cWcn = parcelRequire("9cWcn");

var $4fzqs = parcelRequire("4fzqs");

var $5Gd0V = parcelRequire("5Gd0V");

var $iEpUY = parcelRequire("iEpUY");
class $d82c43f4abf895d7$export$80dcdce8162cfdb5 extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.placeholderText';
    }
    constructor(_editor){
        super();
        this._editor = _editor;
        this._editorObs = (0, $iEpUY.observableCodeEditor)(this._editor);
        this._placeholderText = this._editorObs.getOption(88 /* EditorOption.placeholder */ );
        this._state = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $a0vti.structuralEquals)
        }, (reader)=>{
            const p = this._placeholderText.read(reader);
            if (!p) return undefined;
            if (!this._editorObs.valueIsEmpty.read(reader)) return undefined;
            return {
                placeholder: p
            };
        });
        this._shouldViewBeAlive = $d82c43f4abf895d7$var$isOrWasTrue(this, (reader)=>this._state.read(reader)?.placeholder !== undefined);
        this._view = (0, $5Gd0V.derivedWithStore)((reader, store)=>{
            if (!this._shouldViewBeAlive.read(reader)) return;
            const element = (0, $bDzmQ.h)('div.editorPlaceholder');
            store.add((0, $4fzqs.autorun)((reader)=>{
                const data = this._state.read(reader);
                const shouldBeVisibile = data?.placeholder !== undefined;
                element.root.style.display = shouldBeVisibile ? 'block' : 'none';
                element.root.innerText = data?.placeholder ?? '';
            }));
            store.add((0, $4fzqs.autorun)((reader)=>{
                const info = this._editorObs.layoutInfo.read(reader);
                element.root.style.left = `${info.contentLeft}px`;
                element.root.style.width = info.contentWidth - info.verticalScrollbarWidth + 'px';
                element.root.style.top = `${this._editor.getTopForLineNumber(0)}px`;
            }));
            store.add((0, $4fzqs.autorun)((reader)=>{
                element.root.style.fontFamily = this._editorObs.getOption(49 /* EditorOption.fontFamily */ ).read(reader);
                element.root.style.fontSize = this._editorObs.getOption(52 /* EditorOption.fontSize */ ).read(reader) + 'px';
                element.root.style.lineHeight = this._editorObs.getOption(67 /* EditorOption.lineHeight */ ).read(reader) + 'px';
            }));
            store.add(this._editorObs.createOverlayWidget({
                allowEditorOverflow: false,
                minContentWidthInPx: (0, $4fzqs.constObservable)(0),
                position: (0, $4fzqs.constObservable)(null),
                domNode: element.root
            }));
        });
        this._view.recomputeInitiallyAndOnChange(this._store);
    }
}
function $d82c43f4abf895d7$var$isOrWasTrue(owner, fn) {
    return (0, $4fzqs.derivedObservableWithCache)(owner, (reader, lastValue)=>{
        if (lastValue === true) return true;
        return fn(reader);
    });
}




var $fdGPu = parcelRequire("fdGPu");
var $0c36536f839b5614$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $0c36536f839b5614$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $0c36536f839b5614$export$97bda0f90d93904c {
    constructor(range, newLines, changes){
        this.range = range;
        this.newLines = newLines;
        this.changes = changes;
    }
}
let $0c36536f839b5614$export$a426f41ad4310dcc = class InlineEditsWidget extends (0, $9cWcn.Disposable) {
    constructor(_editor, _edit, _userPrompt, _instantiationService){
        super();
        this._editor = _editor;
        this._edit = _edit;
        this._userPrompt = _userPrompt;
        this._instantiationService = _instantiationService;
        this._editorObs = (0, $iEpUY.observableCodeEditor)(this._editor);
        this._elements = (0, $bDzmQ.h)('div.inline-edits-widget', {
            style: {
                position: 'absolute',
                overflow: 'visible',
                top: '0px',
                left: '0px'
            }
        }, [
            (0, $bDzmQ.h)('div@editorContainer', {
                style: {
                    position: 'absolute',
                    top: '0px',
                    left: '0px',
                    width: '500px',
                    height: '500px'
                }
            }, [
                (0, $bDzmQ.h)('div.toolbar@toolbar', {
                    style: {
                        position: 'absolute',
                        top: '-25px',
                        left: '0px'
                    }
                }),
                (0, $bDzmQ.h)('div.promptEditor@promptEditor', {
                    style: {
                        position: 'absolute',
                        top: '-25px',
                        left: '80px',
                        width: '300px',
                        height: '22px'
                    }
                }),
                (0, $bDzmQ.h)('div.preview@editor', {
                    style: {
                        position: 'absolute',
                        top: '0px',
                        left: '0px'
                    }
                })
            ]),
            (0, $bDzmQ.svgElem)('svg', {
                style: {
                    overflow: 'visible',
                    pointerEvents: 'none'
                }
            }, [
                (0, $bDzmQ.svgElem)('defs', [
                    (0, $bDzmQ.svgElem)('linearGradient', {
                        id: 'Gradient2',
                        x1: '0',
                        y1: '0',
                        x2: '1',
                        y2: '0'
                    }, [
                        /*svgElem('stop', { offset: '0%', class: 'gradient-start', }),
                        svgElem('stop', { offset: '0%', class: 'gradient-start', }),
                        svgElem('stop', { offset: '20%', class: 'gradient-stop', }),*/ (0, $bDzmQ.svgElem)('stop', {
                            offset: '0%',
                            class: 'gradient-stop'
                        }),
                        (0, $bDzmQ.svgElem)('stop', {
                            offset: '100%',
                            class: 'gradient-stop'
                        })
                    ])
                ]),
                (0, $bDzmQ.svgElem)('path@path', {
                    d: '',
                    fill: 'url(#Gradient2)'
                })
            ])
        ]);
        this._previewTextModel = this._register(this._instantiationService.createInstance((0, $91ntV.TextModel), '', (0, $9QNEO.PLAINTEXT_LANGUAGE_ID), (0, $91ntV.TextModel).DEFAULT_CREATION_OPTIONS, null));
        this._setText = (0, $4fzqs.derived)((reader)=>{
            const edit = this._edit.read(reader);
            if (!edit) return;
            this._previewTextModel.setValue(edit.newLines.join('\n'));
        }).recomputeInitiallyAndOnChange(this._store);
        this._promptTextModel = this._register(this._instantiationService.createInstance((0, $91ntV.TextModel), '', (0, $9QNEO.PLAINTEXT_LANGUAGE_ID), (0, $91ntV.TextModel).DEFAULT_CREATION_OPTIONS, null));
        this._promptEditor = this._register(this._instantiationService.createInstance((0, $205d91d7661de01d$export$3c7efbd913d316d0), this._elements.promptEditor, {
            glyphMargin: false,
            lineNumbers: 'off',
            minimap: {
                enabled: false
            },
            guides: {
                indentation: false,
                bracketPairs: false,
                bracketPairsHorizontal: false,
                highlightActiveIndentation: false
            },
            folding: false,
            selectOnLineNumbers: false,
            selectionHighlight: false,
            columnSelection: false,
            overviewRulerBorder: false,
            overviewRulerLanes: 0,
            lineDecorationsWidth: 0,
            lineNumbersMinChars: 0,
            placeholder: 'Describe the change you want...',
            fontFamily: (0, $3J5Aj.DEFAULT_FONT_FAMILY)
        }, {
            contributions: (0, $2iJTi.EditorExtensionsRegistry).getSomeEditorContributions([
                (0, $0dadf7fc8f08a569$export$54e1189006f2eb3a).ID,
                (0, $d82c43f4abf895d7$export$80dcdce8162cfdb5).ID,
                (0, $5545e172cd36db6d$export$4b3a61d923941f77).ID
            ]),
            isSimpleWidget: true
        }, this._editor));
        this._previewEditor = this._register(this._instantiationService.createInstance((0, $205d91d7661de01d$export$3c7efbd913d316d0), this._elements.editor, {
            glyphMargin: false,
            lineNumbers: 'off',
            minimap: {
                enabled: false
            },
            guides: {
                indentation: false,
                bracketPairs: false,
                bracketPairsHorizontal: false,
                highlightActiveIndentation: false
            },
            folding: false,
            selectOnLineNumbers: false,
            selectionHighlight: false,
            columnSelection: false,
            overviewRulerBorder: false,
            overviewRulerLanes: 0,
            lineDecorationsWidth: 0,
            lineNumbersMinChars: 0
        }, {
            contributions: []
        }, this._editor));
        this._previewEditorObs = (0, $iEpUY.observableCodeEditor)(this._previewEditor);
        this._decorations = (0, $4fzqs.derived)(this, (reader)=>{
            this._setText.read(reader);
            const diff = this._edit.read(reader)?.changes;
            if (!diff) return [];
            const originalDecorations = [];
            const modifiedDecorations = [];
            if (diff.length === 1 && diff[0].innerChanges[0].modifiedRange.equalsRange(this._previewTextModel.getFullModelRange())) return [];
            for (const m of diff){
                if (!m.original.isEmpty) originalDecorations.push({
                    range: m.original.toInclusiveRange(),
                    options: (0, $a6rxD.diffLineDeleteDecorationBackgroundWithIndicator)
                });
                if (!m.modified.isEmpty) modifiedDecorations.push({
                    range: m.modified.toInclusiveRange(),
                    options: (0, $a6rxD.diffLineAddDecorationBackgroundWithIndicator)
                });
                if (m.modified.isEmpty || m.original.isEmpty) {
                    if (!m.original.isEmpty) originalDecorations.push({
                        range: m.original.toInclusiveRange(),
                        options: (0, $a6rxD.diffWholeLineDeleteDecoration)
                    });
                    if (!m.modified.isEmpty) modifiedDecorations.push({
                        range: m.modified.toInclusiveRange(),
                        options: (0, $a6rxD.diffWholeLineAddDecoration)
                    });
                } else for (const i of m.innerChanges || []){
                    // Don't show empty markers outside the line range
                    if (m.original.contains(i.originalRange.startLineNumber)) originalDecorations.push({
                        range: i.originalRange,
                        options: i.originalRange.isEmpty() ? (0, $a6rxD.diffDeleteDecorationEmpty) : (0, $a6rxD.diffDeleteDecoration)
                    });
                    if (m.modified.contains(i.modifiedRange.startLineNumber)) modifiedDecorations.push({
                        range: i.modifiedRange,
                        options: i.modifiedRange.isEmpty() ? (0, $a6rxD.diffAddDecorationEmpty) : (0, $a6rxD.diffAddDecoration)
                    });
                }
            }
            return modifiedDecorations;
        });
        this._layout1 = (0, $4fzqs.derived)(this, (reader)=>{
            const model = this._editor.getModel();
            const inlineEdit = this._edit.read(reader);
            if (!inlineEdit) return null;
            const range = inlineEdit.range;
            let maxLeft = 0;
            for(let i = range.startLineNumber; i < range.endLineNumberExclusive; i++){
                const column = model.getLineMaxColumn(i);
                const left = this._editor.getOffsetForColumn(i, column);
                maxLeft = Math.max(maxLeft, left);
            }
            const layoutInfo = this._editor.getLayoutInfo();
            const contentLeft = layoutInfo.contentLeft;
            return {
                left: contentLeft + maxLeft
            };
        });
        this._layout = (0, $4fzqs.derived)(this, (reader)=>{
            const inlineEdit = this._edit.read(reader);
            if (!inlineEdit) return null;
            const range = inlineEdit.range;
            const scrollLeft = this._editorObs.scrollLeft.read(reader);
            const left = this._layout1.read(reader).left + 20 - scrollLeft;
            const selectionTop = this._editor.getTopForLineNumber(range.startLineNumber) - this._editorObs.scrollTop.read(reader);
            const selectionBottom = this._editor.getTopForLineNumber(range.endLineNumberExclusive) - this._editorObs.scrollTop.read(reader);
            const topCode = new $0c36536f839b5614$var$Point(left, selectionTop);
            const bottomCode = new $0c36536f839b5614$var$Point(left, selectionBottom);
            const codeHeight = selectionBottom - selectionTop;
            const codeEditDist = 50;
            const editHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ ) * inlineEdit.newLines.length;
            const difference = codeHeight - editHeight;
            const topEdit = new $0c36536f839b5614$var$Point(left + codeEditDist, selectionTop + difference / 2);
            const bottomEdit = new $0c36536f839b5614$var$Point(left + codeEditDist, selectionBottom - difference / 2);
            return {
                topCode: topCode,
                bottomCode: bottomCode,
                codeHeight: codeHeight,
                topEdit: topEdit,
                bottomEdit: bottomEdit,
                editHeight: editHeight
            };
        });
        const visible = (0, $4fzqs.derived)(this, (reader)=>this._edit.read(reader) !== undefined || this._userPrompt.read(reader) !== undefined);
        this._register((0, $02z4I.applyStyle)(this._elements.root, {
            display: (0, $4fzqs.derived)(this, (reader)=>visible.read(reader) ? 'block' : 'none')
        }));
        this._register((0, $02z4I.appendRemoveOnDispose)(this._editor.getDomNode(), this._elements.root));
        this._register((0, $iEpUY.observableCodeEditor)(_editor).createOverlayWidget({
            domNode: this._elements.root,
            position: (0, $4fzqs.constObservable)(null),
            allowEditorOverflow: false,
            minContentWidthInPx: (0, $4fzqs.derived)((reader)=>{
                const x = this._layout1.read(reader)?.left;
                if (x === undefined) return 0;
                const width = this._previewEditorObs.contentWidth.read(reader);
                return x + width;
            })
        }));
        this._previewEditor.setModel(this._previewTextModel);
        this._register(this._previewEditorObs.setDecorations(this._decorations));
        this._register((0, $4fzqs.autorun)((reader)=>{
            const layoutInfo = this._layout.read(reader);
            if (!layoutInfo) return;
            const { topCode: topCode, bottomCode: bottomCode, topEdit: topEdit, bottomEdit: bottomEdit, editHeight: editHeight } = layoutInfo;
            const straightWidthCode = 10;
            const straightWidthEdit = 0;
            const bezierDist = 40;
            const path = new $0c36536f839b5614$var$PathBuilder().moveTo(topCode).lineTo(topCode.deltaX(straightWidthCode)).curveTo(topCode.deltaX(straightWidthCode + bezierDist), topEdit.deltaX(-bezierDist - straightWidthEdit), topEdit.deltaX(-straightWidthEdit)).lineTo(topEdit).lineTo(bottomEdit).lineTo(bottomEdit.deltaX(-straightWidthEdit)).curveTo(bottomEdit.deltaX(-bezierDist - straightWidthEdit), bottomCode.deltaX(straightWidthCode + bezierDist), bottomCode.deltaX(straightWidthCode)).lineTo(bottomCode).build();
            this._elements.path.setAttribute('d', path);
            this._elements.editorContainer.style.top = `${topEdit.y}px`;
            this._elements.editorContainer.style.left = `${topEdit.x}px`;
            this._elements.editorContainer.style.height = `${editHeight}px`;
            const width = this._previewEditorObs.contentWidth.read(reader);
            this._previewEditor.layout({
                height: editHeight,
                width: width
            });
        }));
        this._promptEditor.setModel(this._promptTextModel);
        this._promptEditor.layout();
        this._register($0c36536f839b5614$var$createTwoWaySync($0c36536f839b5614$var$mapSettableObservable(this._userPrompt, (v)=>v ?? '', (v)=>v), (0, $iEpUY.observableCodeEditor)(this._promptEditor).value));
        this._register((0, $4fzqs.autorun)((reader)=>{
            const isFocused = (0, $iEpUY.observableCodeEditor)(this._promptEditor).isFocused.read(reader);
            this._elements.root.classList.toggle('focused', isFocused);
        }));
    }
};
$0c36536f839b5614$export$a426f41ad4310dcc = $0c36536f839b5614$var$__decorate([
    $0c36536f839b5614$var$__param(3, (0, $fdGPu.IInstantiationService))
], $0c36536f839b5614$export$a426f41ad4310dcc);
function $0c36536f839b5614$var$mapSettableObservable(obs, fn1, fn2) {
    return (0, $5Gd0V.derivedWithSetter)(undefined, (reader)=>fn1(obs.read(reader)), (value, tx)=>obs.set(fn2(value), tx));
}
class $0c36536f839b5614$var$Point {
    constructor(x, y){
        this.x = x;
        this.y = y;
    }
    deltaX(delta) {
        return new $0c36536f839b5614$var$Point(this.x + delta, this.y);
    }
}
class $0c36536f839b5614$var$PathBuilder {
    constructor(){
        this._data = '';
    }
    moveTo(point) {
        this._data += `M ${point.x} ${point.y} `;
        return this;
    }
    lineTo(point) {
        this._data += `L ${point.x} ${point.y} `;
        return this;
    }
    curveTo(cp1, cp2, to) {
        this._data += `C ${cp1.x} ${cp1.y} ${cp2.x} ${cp2.y} ${to.x} ${to.y} `;
        return this;
    }
    build() {
        return this._data;
    }
}
function $0c36536f839b5614$var$createTwoWaySync(main, target) {
    const store = new (0, $9cWcn.DisposableStore)();
    store.add((0, $4fzqs.autorun)((reader)=>{
        const value = main.read(reader);
        target.set(value, undefined);
    }));
    store.add((0, $4fzqs.autorun)((reader)=>{
        const value = target.read(reader);
        main.set(value, undefined);
    }));
    return store;
}


var $92d0f1cd36cb1ad6$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $92d0f1cd36cb1ad6$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $92d0f1cd36cb1ad6$var$InlineEditsModel_1;
let $92d0f1cd36cb1ad6$export$2924042c9b08ea7f = class InlineEditsModel extends (0, $9cWcn.Disposable) {
    static{
        $92d0f1cd36cb1ad6$var$InlineEditsModel_1 = this;
    }
    static{
        this._modelId = 0;
    }
    static _createUniqueUri() {
        return (0, $5OJ54.URI).from({
            scheme: 'inline-edits',
            path: new Date().toString() + String($92d0f1cd36cb1ad6$var$InlineEditsModel_1._modelId++)
        });
    }
    constructor(textModel, _textModelVersionId, _selection, _debounceValue, languageFeaturesService, _diffProviderFactoryService, _modelService){
        super();
        this.textModel = textModel;
        this._textModelVersionId = _textModelVersionId;
        this._selection = _selection;
        this._debounceValue = _debounceValue;
        this.languageFeaturesService = languageFeaturesService;
        this._diffProviderFactoryService = _diffProviderFactoryService;
        this._modelService = _modelService;
        this._forceUpdateExplicitlySignal = (0, $4fzqs.observableSignal)(this);
        // We use a semantic id to keep the same inline completion selected even if the provider reorders the completions.
        this._selectedInlineCompletionId = (0, $4fzqs.observableValue)(this, undefined);
        this._isActive = (0, $4fzqs.observableValue)(this, false);
        this._originalModel = (0, $5Gd0V.derivedDisposable)(()=>this._modelService.createModel('', null, $92d0f1cd36cb1ad6$var$InlineEditsModel_1._createUniqueUri())).keepObserved(this._store);
        this._modifiedModel = (0, $5Gd0V.derivedDisposable)(()=>this._modelService.createModel('', null, $92d0f1cd36cb1ad6$var$InlineEditsModel_1._createUniqueUri())).keepObserved(this._store);
        this._pinnedRange = new $92d0f1cd36cb1ad6$var$TrackedRange(this.textModel, this._textModelVersionId);
        this.isPinned = this._pinnedRange.range.map((range)=>!!range);
        this.userPrompt = (0, $4fzqs.observableValue)(this, undefined);
        this.inlineEdit = (0, $4fzqs.derived)(this, (reader)=>{
            return this._inlineEdit.read(reader)?.promiseResult.read(reader)?.data;
        });
        this._inlineEdit = (0, $4fzqs.derived)(this, (reader)=>{
            const edit = this.selectedInlineEdit.read(reader);
            if (!edit) return undefined;
            const range = edit.inlineCompletion.range;
            if (edit.inlineCompletion.insertText.trim() === '') return undefined;
            let newLines = edit.inlineCompletion.insertText.split(/\r\n|\r|\n/);
            function removeIndentation(lines) {
                const indentation = lines[0].match(/^\s*/)?.[0] ?? '';
                return lines.map((l)=>l.replace(new RegExp('^' + indentation), ''));
            }
            newLines = removeIndentation(newLines);
            const existing = this.textModel.getValueInRange(range);
            let existingLines = existing.split(/\r\n|\r|\n/);
            existingLines = removeIndentation(existingLines);
            this._originalModel.get().setValue(existingLines.join('\n'));
            this._modifiedModel.get().setValue(newLines.join('\n'));
            const d = this._diffProviderFactoryService.createDiffProvider({
                diffAlgorithm: 'advanced'
            });
            return (0, $4fzqs.ObservablePromise).fromFn(async ()=>{
                const result = await d.computeDiff(this._originalModel.get(), this._modifiedModel.get(), {
                    computeMoves: false,
                    ignoreTrimWhitespace: false,
                    maxComputationTimeMs: 1000
                }, (0, $giPcZ.CancellationToken).None);
                if (result.identical) return undefined;
                return new (0, $0c36536f839b5614$export$97bda0f90d93904c)((0, $lyGtO.LineRange).fromRangeInclusive(range), removeIndentation(newLines), result.changes);
            });
        });
        this._fetchStore = this._register(new (0, $9cWcn.DisposableStore)());
        this._inlineEditsFetchResult = (0, $4fzqs.disposableObservableValue)(this, undefined);
        this._inlineEdits = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $a0vti.structuralEquals)
        }, (reader)=>{
            return this._inlineEditsFetchResult.read(reader)?.completions.map((c)=>new $92d0f1cd36cb1ad6$var$InlineEditData(c)) ?? [];
        });
        this._fetchInlineEditsPromise = (0, $4fzqs.derivedHandleChanges)({
            owner: this,
            createEmptyChangeSummary: ()=>({
                    inlineCompletionTriggerKind: (0, $kzNQX.InlineCompletionTriggerKind).Automatic
                }),
            handleChange: (ctx, changeSummary)=>{
                /** @description fetch inline completions */ if (ctx.didChange(this._forceUpdateExplicitlySignal)) changeSummary.inlineCompletionTriggerKind = (0, $kzNQX.InlineCompletionTriggerKind).Explicit;
                return true;
            }
        }, async (reader, changeSummary)=>{
            this._fetchStore.clear();
            this._forceUpdateExplicitlySignal.read(reader);
            /*if (!this._isActive.read(reader)) {
                return undefined;
            }*/ this._textModelVersionId.read(reader);
            function mapValue(value, fn) {
                return fn(value);
            }
            const selection = this._pinnedRange.range.read(reader) ?? mapValue(this._selection.read(reader), (v)=>v.isEmpty() ? undefined : v);
            if (!selection) {
                this._inlineEditsFetchResult.set(undefined, undefined);
                this.userPrompt.set(undefined, undefined);
                return undefined;
            }
            const context = {
                triggerKind: changeSummary.inlineCompletionTriggerKind,
                selectedSuggestionInfo: undefined,
                userPrompt: this.userPrompt.read(reader)
            };
            const token = (0, $giPcZ.cancelOnDispose)(this._fetchStore);
            await (0, $6bXyA.timeout)(200, token);
            const result = await (0, $2dee656271dcbcaa$export$eb35bd557f596021)(this.languageFeaturesService.inlineCompletionsProvider, selection, this.textModel, context, token);
            if (token.isCancellationRequested) return;
            this._inlineEditsFetchResult.set(result, undefined);
        });
        this._filteredInlineEditItems = (0, $4fzqs.derivedOpts)({
            owner: this,
            equalsFn: (0, $a0vti.itemsEquals)()
        }, (reader)=>{
            return this._inlineEdits.read(reader);
        });
        this.selectedInlineCompletionIndex = (0, $4fzqs.derived)(this, (reader)=>{
            const selectedInlineCompletionId = this._selectedInlineCompletionId.read(reader);
            const filteredCompletions = this._filteredInlineEditItems.read(reader);
            const idx = this._selectedInlineCompletionId === undefined ? -1 : filteredCompletions.findIndex((v)=>v.semanticId === selectedInlineCompletionId);
            if (idx === -1) {
                // Reset the selection so that the selection does not jump back when it appears again
                this._selectedInlineCompletionId.set(undefined, undefined);
                return 0;
            }
            return idx;
        });
        this.selectedInlineEdit = (0, $4fzqs.derived)(this, (reader)=>{
            const filteredCompletions = this._filteredInlineEditItems.read(reader);
            const idx = this.selectedInlineCompletionIndex.read(reader);
            return filteredCompletions[idx];
        });
        this._register((0, $4fzqs.recomputeInitiallyAndOnChange)(this._fetchInlineEditsPromise));
    }
    async triggerExplicitly(tx) {
        (0, $4fzqs.subtransaction)(tx, (tx)=>{
            this._isActive.set(true, tx);
            this._forceUpdateExplicitlySignal.trigger(tx);
        });
        await this._fetchInlineEditsPromise.get();
    }
    stop(tx) {
        (0, $4fzqs.subtransaction)(tx, (tx)=>{
            this.userPrompt.set(undefined, tx);
            this._isActive.set(false, tx);
            this._inlineEditsFetchResult.set(undefined, tx);
            this._pinnedRange.setRange(undefined, tx);
        //this._source.clear(tx);
        });
    }
    async _deltaSelectedInlineCompletionIndex(delta) {
        await this.triggerExplicitly();
        const completions = this._filteredInlineEditItems.get() || [];
        if (completions.length > 0) {
            const newIdx = (this.selectedInlineCompletionIndex.get() + delta + completions.length) % completions.length;
            this._selectedInlineCompletionId.set(completions[newIdx].semanticId, undefined);
        } else this._selectedInlineCompletionId.set(undefined, undefined);
    }
    async next() {
        await this._deltaSelectedInlineCompletionIndex(1);
    }
    async previous() {
        await this._deltaSelectedInlineCompletionIndex(-1);
    }
    async accept(editor) {
        if (editor.getModel() !== this.textModel) throw new (0, $gPkHZ.BugIndicatingError)();
        const edit = this.selectedInlineEdit.get();
        if (!edit) return;
        editor.pushUndoStop();
        editor.executeEdits('inlineSuggestion.accept', [
            edit.inlineCompletion.toSingleTextEdit().toSingleEditOperation()
        ]);
        this.stop();
    }
};
$92d0f1cd36cb1ad6$export$2924042c9b08ea7f = $92d0f1cd36cb1ad6$var$InlineEditsModel_1 = $92d0f1cd36cb1ad6$var$__decorate([
    $92d0f1cd36cb1ad6$var$__param(4, (0, $4J6fu.ILanguageFeaturesService)),
    $92d0f1cd36cb1ad6$var$__param(5, (0, $aHgze.IDiffProviderFactoryService)),
    $92d0f1cd36cb1ad6$var$__param(6, (0, $cKKJT.IModelService))
], $92d0f1cd36cb1ad6$export$2924042c9b08ea7f);
class $92d0f1cd36cb1ad6$var$InlineEditData {
    constructor(inlineCompletion){
        this.inlineCompletion = inlineCompletion;
        this.semanticId = this.inlineCompletion.hash();
    }
}
class $92d0f1cd36cb1ad6$var$TrackedRange extends (0, $9cWcn.Disposable) {
    constructor(_textModel, _versionId){
        super();
        this._textModel = _textModel;
        this._versionId = _versionId;
        this._decorations = (0, $4fzqs.observableValue)(this, []);
        this.range = (0, $4fzqs.derived)(this, (reader)=>{
            this._versionId.read(reader);
            const deco = this._decorations.read(reader)[0];
            if (!deco) return null;
            return this._textModel.getDecorationRange(deco) ?? null;
        });
        this._register((0, $9cWcn.toDisposable)(()=>{
            this._textModel.deltaDecorations(this._decorations.get(), []);
        }));
    }
    setRange(range, tx) {
        this._decorations.set(this._textModel.deltaDecorations(this._decorations.get(), range ? [
            {
                range: range,
                options: {
                    description: 'trackedRange'
                }
            }
        ] : []), tx);
    }
}




var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $JxG7D = parcelRequire("JxG7D");
var $635277e49f640e02$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $635277e49f640e02$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $635277e49f640e02$var$InlineEditsController_1;
let $635277e49f640e02$export$ed697208c77384a1 = class InlineEditsController extends (0, $9cWcn.Disposable) {
    static{
        $635277e49f640e02$var$InlineEditsController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.inlineEditsController';
    }
    static get(editor) {
        return editor.getContribution($635277e49f640e02$var$InlineEditsController_1.ID);
    }
    constructor(editor, _instantiationService, _contextKeyService, _debounceService, _languageFeaturesService, _configurationService){
        super();
        this.editor = editor;
        this._instantiationService = _instantiationService;
        this._contextKeyService = _contextKeyService;
        this._debounceService = _debounceService;
        this._languageFeaturesService = _languageFeaturesService;
        this._configurationService = _configurationService;
        this._enabled = (0, $JxG7D.observableConfigValue)('editor.inlineEdits.enabled', false, this._configurationService);
        this._editorObs = (0, $iEpUY.observableCodeEditor)(this.editor);
        this._selection = (0, $4fzqs.derived)(this, (reader)=>this._editorObs.cursorSelection.read(reader) ?? new (0, $jzicX.Selection)(1, 1, 1, 1));
        this._debounceValue = this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider, 'InlineEditsDebounce', {
            min: 50,
            max: 50
        });
        this.model = (0, $5Gd0V.derivedDisposable)(this, (reader)=>{
            if (!this._enabled.read(reader)) return undefined;
            if (this._editorObs.isReadonly.read(reader)) return undefined;
            const textModel = this._editorObs.model.read(reader);
            if (!textModel) return undefined;
            const model = this._instantiationService.createInstance((0, $kImF8.readHotReloadableExport)((0, $92d0f1cd36cb1ad6$export$2924042c9b08ea7f), reader), textModel, this._editorObs.versionId, this._selection, this._debounceValue);
            return model;
        });
        this._hadInlineEdit = (0, $4fzqs.derivedObservableWithCache)(this, (reader, lastValue)=>lastValue || this.model.read(reader)?.inlineEdit.read(reader) !== undefined);
        this._widget = (0, $5Gd0V.derivedDisposable)(this, (reader)=>{
            if (!this._hadInlineEdit.read(reader)) return undefined;
            return this._instantiationService.createInstance((0, $kImF8.readHotReloadableExport)((0, $0c36536f839b5614$export$a426f41ad4310dcc), reader), this.editor, this.model.map((m, reader)=>m?.inlineEdit.read(reader)), $635277e49f640e02$var$flattenSettableObservable((reader)=>this.model.read(reader)?.userPrompt ?? (0, $4fzqs.observableValue)('empty', '')));
        });
        this._register((0, $JxG7D.bindContextKey)((0, $5d7ea48a5dd11dc9$export$9b45cd67ef61ab4f), this._contextKeyService, (r)=>!!this.model.read(r)?.inlineEdit.read(r)));
        this._register((0, $JxG7D.bindContextKey)((0, $5d7ea48a5dd11dc9$export$68599a07c1620460), this._contextKeyService, (r)=>!!this.model.read(r)?.isPinned.read(r)));
        this.model.recomputeInitiallyAndOnChange(this._store);
        this._widget.recomputeInitiallyAndOnChange(this._store);
    }
};
$635277e49f640e02$export$ed697208c77384a1 = $635277e49f640e02$var$InlineEditsController_1 = $635277e49f640e02$var$__decorate([
    $635277e49f640e02$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $635277e49f640e02$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $635277e49f640e02$var$__param(3, (0, $goG89.ILanguageFeatureDebounceService)),
    $635277e49f640e02$var$__param(4, (0, $4J6fu.ILanguageFeaturesService)),
    $635277e49f640e02$var$__param(5, (0, $35IZ9.IConfigurationService))
], $635277e49f640e02$export$ed697208c77384a1);
function $635277e49f640e02$var$flattenSettableObservable(fn) {
    return (0, $5Gd0V.derivedWithSetter)(undefined, (reader)=>{
        const obs = fn(reader);
        return obs.read(reader);
    }, (value, tx)=>{
        fn(undefined).set(value, tx);
    });
}



var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");
function $b2373dd29b115cc4$var$labelAndAlias(str) {
    return {
        label: str.value,
        alias: str.original
    };
}
class $b2373dd29b115cc4$export$4cacaed2f012c67c extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = (0, $5d7ea48a5dd11dc9$export$2784db725d91adff);
    }
    constructor(){
        super({
            id: $b2373dd29b115cc4$export$4cacaed2f012c67c.ID,
            ...$b2373dd29b115cc4$var$labelAndAlias($4dEdH.localize2('action.inlineEdits.showNext', "Show Next Inline Edit")),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $5d7ea48a5dd11dc9$export$9b45cd67ef61ab4f)),
            kbOpts: {
                weight: 100,
                primary: 606 /* KeyCode.BracketRight */ 
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $635277e49f640e02$export$ed697208c77384a1).get(editor);
        controller?.model.get()?.next();
    }
}
class $b2373dd29b115cc4$export$488bd103c5d209a7 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = (0, $5d7ea48a5dd11dc9$export$c126e0a722243af3);
    }
    constructor(){
        super({
            id: $b2373dd29b115cc4$export$488bd103c5d209a7.ID,
            ...$b2373dd29b115cc4$var$labelAndAlias($4dEdH.localize2('action.inlineEdits.showPrevious', "Show Previous Inline Edit")),
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $5d7ea48a5dd11dc9$export$9b45cd67ef61ab4f)),
            kbOpts: {
                weight: 100,
                primary: 604 /* KeyCode.BracketLeft */ 
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $635277e49f640e02$export$ed697208c77384a1).get(editor);
        controller?.model.get()?.previous();
    }
}
class $b2373dd29b115cc4$export$20379efecc4b3c58 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.inlineEdits.trigger',
            ...$b2373dd29b115cc4$var$labelAndAlias($4dEdH.localize2('action.inlineEdits.trigger', "Trigger Inline Edit")),
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
    async run(accessor, editor) {
        const controller = (0, $635277e49f640e02$export$ed697208c77384a1).get(editor);
        await (0, $fDQAu.asyncTransaction)(async (tx)=>{
            /** @description triggerExplicitly from command */ await controller?.model.get()?.triggerExplicitly(tx);
        });
    }
}
class $b2373dd29b115cc4$export$eaa4daf49ee5eead extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: (0, $5d7ea48a5dd11dc9$export$e2e7db96eedff096),
            ...$b2373dd29b115cc4$var$labelAndAlias($4dEdH.localize2('action.inlineEdits.accept', "Accept Inline Edit")),
            precondition: (0, $5d7ea48a5dd11dc9$export$9b45cd67ef61ab4f),
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).InlineEditsActions,
                title: $4dEdH.localize('inlineEditsActions', "Accept Inline Edit"),
                group: 'primary',
                order: 1,
                icon: (0, $awgRE.Codicon).check
            },
            kbOpts: {
                primary: 2058 /* KeyCode.Space */ ,
                weight: 20000,
                kbExpr: (0, $5d7ea48a5dd11dc9$export$9b45cd67ef61ab4f)
            }
        });
    }
    async run(accessor, editor) {
        if (editor instanceof (0, $205d91d7661de01d$export$3c7efbd913d316d0)) editor = editor.getParentEditor();
        const controller = (0, $635277e49f640e02$export$ed697208c77384a1).get(editor);
        if (controller) {
            controller.model.get()?.accept(controller.editor);
            controller.editor.focus();
        }
    }
}
class $b2373dd29b115cc4$export$ff62d4c0352d48e8 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.inlineEdits.hide';
    }
    constructor(){
        super({
            id: $b2373dd29b115cc4$export$ff62d4c0352d48e8.ID,
            ...$b2373dd29b115cc4$var$labelAndAlias($4dEdH.localize2('action.inlineEdits.hide', "Hide Inline Edit")),
            precondition: (0, $5d7ea48a5dd11dc9$export$9b45cd67ef61ab4f),
            kbOpts: {
                weight: 100,
                primary: 9 /* KeyCode.Escape */ 
            }
        });
    }
    async run(accessor, editor) {
        const controller = (0, $635277e49f640e02$export$ed697208c77384a1).get(editor);
        (0, $4fzqs.transaction)((tx)=>{
            controller?.model.get()?.stop(tx);
        });
    }
}



(0, $2iJTi.registerEditorContribution)((0, $635277e49f640e02$export$ed697208c77384a1).ID, (0, $635277e49f640e02$export$ed697208c77384a1), 3 /* EditorContributionInstantiation.Eventually */ );
(0, $2iJTi.registerEditorAction)((0, $b2373dd29b115cc4$export$20379efecc4b3c58));
(0, $2iJTi.registerEditorAction)((0, $b2373dd29b115cc4$export$4cacaed2f012c67c));
(0, $2iJTi.registerEditorAction)((0, $b2373dd29b115cc4$export$488bd103c5d209a7));
(0, $2iJTi.registerEditorAction)((0, $b2373dd29b115cc4$export$eaa4daf49ee5eead));
(0, $2iJTi.registerEditorAction)((0, $b2373dd29b115cc4$export$ff62d4c0352d48e8));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $7DcRJ = parcelRequire("7DcRJ");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $kzNQX = parcelRequire("kzNQX");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $gPkHZ = parcelRequire("gPkHZ");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $kNeNo = parcelRequire("kNeNo");

var $kzNQX = parcelRequire("kzNQX");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $dcxQ7 = parcelRequire("dcxQ7");

var $kzNQX = parcelRequire("kzNQX");

var $4J6fu = parcelRequire("4J6fu");

var $aTkrt = parcelRequire("aTkrt");

var $8tcMz = parcelRequire("8tcMz");

var $cxCeF = parcelRequire("cxCeF");
const $9720969f08005d5b$export$841858b892ce1f4c = {
    Visible: new (0, $cxCeF.RawContextKey)('parameterHintsVisible', false),
    MultipleSignatures: new (0, $cxCeF.RawContextKey)('parameterHintsMultipleSignatures', false)
};
async function $9720969f08005d5b$export$49fb82b90cfa6803(registry, model, position, context, token) {
    const supports = registry.ordered(model);
    for (const support of supports)try {
        const result = await support.provideSignatureHelp(model, position, token, context);
        if (result) return result;
    } catch (err) {
        (0, $gPkHZ.onUnexpectedExternalError)(err);
    }
    return undefined;
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeSignatureHelpProvider', async (accessor, ...args)=>{
    const [uri, position, triggerCharacter] = args;
    (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(uri));
    (0, $bxBg7.assertType)((0, $dcxQ7.Position).isIPosition(position));
    (0, $bxBg7.assertType)(typeof triggerCharacter === 'string' || !triggerCharacter);
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const ref = await accessor.get((0, $aTkrt.ITextModelService)).createModelReference(uri);
    try {
        const result = await $9720969f08005d5b$export$49fb82b90cfa6803(languageFeaturesService.signatureHelpProvider, ref.object.textEditorModel, (0, $dcxQ7.Position).lift(position), {
            triggerKind: $kzNQX.SignatureHelpTriggerKind.Invoke,
            isRetrigger: false,
            triggerCharacter: triggerCharacter
        }, (0, $giPcZ.CancellationToken).None);
        if (!result) return undefined;
        setTimeout(()=>result.dispose(), 0);
        return result.value;
    } finally{
        ref.dispose();
    }
});


var $a36f154798cb4a78$var$ParameterHintState;
(function(ParameterHintState) {
    ParameterHintState.Default = {
        type: 0 /* Type.Default */ 
    };
    class Pending {
        constructor(request, previouslyActiveHints){
            this.request = request;
            this.previouslyActiveHints = previouslyActiveHints;
            this.type = 2 /* Type.Pending */ ;
        }
    }
    ParameterHintState.Pending = Pending;
    class Active {
        constructor(hints){
            this.hints = hints;
            this.type = 1 /* Type.Active */ ;
        }
    }
    ParameterHintState.Active = Active;
})($a36f154798cb4a78$var$ParameterHintState || ($a36f154798cb4a78$var$ParameterHintState = {}));
class $a36f154798cb4a78$export$7f27c6b5c579a14e extends (0, $9cWcn.Disposable) {
    static{
        this.DEFAULT_DELAY = 120;
    }
    constructor(editor, providers, delay = $a36f154798cb4a78$export$7f27c6b5c579a14e.DEFAULT_DELAY){
        super();
        this._onChangedHints = this._register(new (0, $5YaSO.Emitter)());
        this.onChangedHints = this._onChangedHints.event;
        this.triggerOnType = false;
        this._state = $a36f154798cb4a78$var$ParameterHintState.Default;
        this._pendingTriggers = [];
        this._lastSignatureHelpResult = this._register(new (0, $9cWcn.MutableDisposable)());
        this.triggerChars = new (0, $kNeNo.CharacterSet)();
        this.retriggerChars = new (0, $kNeNo.CharacterSet)();
        this.triggerId = 0;
        this.editor = editor;
        this.providers = providers;
        this.throttledDelayer = new (0, $6bXyA.Delayer)(delay);
        this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel()));
        this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange()));
        this._register(this.editor.onDidChangeModel((e)=>this.onModelChanged()));
        this._register(this.editor.onDidChangeModelLanguage((_)=>this.onModelChanged()));
        this._register(this.editor.onDidChangeCursorSelection((e)=>this.onCursorChange(e)));
        this._register(this.editor.onDidChangeModelContent((e)=>this.onModelContentChange()));
        this._register(this.providers.onDidChange(this.onModelChanged, this));
        this._register(this.editor.onDidType((text)=>this.onDidType(text)));
        this.onEditorConfigurationChange();
        this.onModelChanged();
    }
    get state() {
        return this._state;
    }
    set state(value) {
        if (this._state.type === 2 /* ParameterHintState.Type.Pending */ ) this._state.request.cancel();
        this._state = value;
    }
    cancel(silent = false) {
        this.state = $a36f154798cb4a78$var$ParameterHintState.Default;
        this.throttledDelayer.cancel();
        if (!silent) this._onChangedHints.fire(undefined);
    }
    trigger(context, delay) {
        const model = this.editor.getModel();
        if (!model || !this.providers.has(model)) return;
        const triggerId = ++this.triggerId;
        this._pendingTriggers.push(context);
        this.throttledDelayer.trigger(()=>{
            return this.doTrigger(triggerId);
        }, delay).catch((0, $gPkHZ.onUnexpectedError));
    }
    next() {
        if (this.state.type !== 1 /* ParameterHintState.Type.Active */ ) return;
        const length = this.state.hints.signatures.length;
        const activeSignature = this.state.hints.activeSignature;
        const last = activeSignature % length === length - 1;
        const cycle = this.editor.getOption(86 /* EditorOption.parameterHints */ ).cycle;
        // If there is only one signature, or we're on last signature of list
        if ((length < 2 || last) && !cycle) {
            this.cancel();
            return;
        }
        this.updateActiveSignature(last && cycle ? 0 : activeSignature + 1);
    }
    previous() {
        if (this.state.type !== 1 /* ParameterHintState.Type.Active */ ) return;
        const length = this.state.hints.signatures.length;
        const activeSignature = this.state.hints.activeSignature;
        const first = activeSignature === 0;
        const cycle = this.editor.getOption(86 /* EditorOption.parameterHints */ ).cycle;
        // If there is only one signature, or we're on first signature of list
        if ((length < 2 || first) && !cycle) {
            this.cancel();
            return;
        }
        this.updateActiveSignature(first && cycle ? length - 1 : activeSignature - 1);
    }
    updateActiveSignature(activeSignature) {
        if (this.state.type !== 1 /* ParameterHintState.Type.Active */ ) return;
        this.state = new $a36f154798cb4a78$var$ParameterHintState.Active({
            ...this.state.hints,
            activeSignature: activeSignature
        });
        this._onChangedHints.fire(this.state.hints);
    }
    async doTrigger(triggerId) {
        const isRetrigger = this.state.type === 1 /* ParameterHintState.Type.Active */  || this.state.type === 2 /* ParameterHintState.Type.Pending */ ;
        const activeSignatureHelp = this.getLastActiveHints();
        this.cancel(true);
        if (this._pendingTriggers.length === 0) return false;
        const context = this._pendingTriggers.reduce($a36f154798cb4a78$var$mergeTriggerContexts);
        this._pendingTriggers = [];
        const triggerContext = {
            triggerKind: context.triggerKind,
            triggerCharacter: context.triggerCharacter,
            isRetrigger: isRetrigger,
            activeSignatureHelp: activeSignatureHelp
        };
        if (!this.editor.hasModel()) return false;
        const model = this.editor.getModel();
        const position = this.editor.getPosition();
        this.state = new $a36f154798cb4a78$var$ParameterHintState.Pending((0, $6bXyA.createCancelablePromise)((token)=>(0, $9720969f08005d5b$export$49fb82b90cfa6803)(this.providers, model, position, triggerContext, token)), activeSignatureHelp);
        try {
            const result = await this.state.request;
            // Check that we are still resolving the correct signature help
            if (triggerId !== this.triggerId) {
                result?.dispose();
                return false;
            }
            if (!result || !result.value.signatures || result.value.signatures.length === 0) {
                result?.dispose();
                this._lastSignatureHelpResult.clear();
                this.cancel();
                return false;
            } else {
                this.state = new $a36f154798cb4a78$var$ParameterHintState.Active(result.value);
                this._lastSignatureHelpResult.value = result;
                this._onChangedHints.fire(this.state.hints);
                return true;
            }
        } catch (error) {
            if (triggerId === this.triggerId) this.state = $a36f154798cb4a78$var$ParameterHintState.Default;
            (0, $gPkHZ.onUnexpectedError)(error);
            return false;
        }
    }
    getLastActiveHints() {
        switch(this.state.type){
            case 1 /* ParameterHintState.Type.Active */ :
                return this.state.hints;
            case 2 /* ParameterHintState.Type.Pending */ :
                return this.state.previouslyActiveHints;
            default:
                return undefined;
        }
    }
    get isTriggered() {
        return this.state.type === 1 /* ParameterHintState.Type.Active */  || this.state.type === 2 /* ParameterHintState.Type.Pending */  || this.throttledDelayer.isTriggered();
    }
    onModelChanged() {
        this.cancel();
        this.triggerChars.clear();
        this.retriggerChars.clear();
        const model = this.editor.getModel();
        if (!model) return;
        for (const support of this.providers.ordered(model)){
            for (const ch of support.signatureHelpTriggerCharacters || [])if (ch.length) {
                const charCode = ch.charCodeAt(0);
                this.triggerChars.add(charCode);
                // All trigger characters are also considered retrigger characters
                this.retriggerChars.add(charCode);
            }
            for (const ch of support.signatureHelpRetriggerCharacters || [])if (ch.length) this.retriggerChars.add(ch.charCodeAt(0));
        }
    }
    onDidType(text) {
        if (!this.triggerOnType) return;
        const lastCharIndex = text.length - 1;
        const triggerCharCode = text.charCodeAt(lastCharIndex);
        if (this.triggerChars.has(triggerCharCode) || this.isTriggered && this.retriggerChars.has(triggerCharCode)) this.trigger({
            triggerKind: $kzNQX.SignatureHelpTriggerKind.TriggerCharacter,
            triggerCharacter: text.charAt(lastCharIndex)
        });
    }
    onCursorChange(e) {
        if (e.source === 'mouse') this.cancel();
        else if (this.isTriggered) this.trigger({
            triggerKind: $kzNQX.SignatureHelpTriggerKind.ContentChange
        });
    }
    onModelContentChange() {
        if (this.isTriggered) this.trigger({
            triggerKind: $kzNQX.SignatureHelpTriggerKind.ContentChange
        });
    }
    onEditorConfigurationChange() {
        this.triggerOnType = this.editor.getOption(86 /* EditorOption.parameterHints */ ).enabled;
        if (!this.triggerOnType) this.cancel();
    }
    dispose() {
        this.cancel(true);
        super.dispose();
    }
}
function $a36f154798cb4a78$var$mergeTriggerContexts(previous, current) {
    switch(current.triggerKind){
        case $kzNQX.SignatureHelpTriggerKind.Invoke:
            // Invoke overrides previous triggers.
            return current;
        case $kzNQX.SignatureHelpTriggerKind.ContentChange:
            // Ignore content changes triggers
            return previous;
        case $kzNQX.SignatureHelpTriggerKind.TriggerCharacter:
        default:
            return current;
    }
}




var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $aIbUW = parcelRequire("aIbUW");

var $2aRJR = parcelRequire("2aRJR");

var $awgRE = parcelRequire("awgRE");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $bxBg7 = parcelRequire("bxBg7");


var $cd4KD = parcelRequire("cd4KD");

var $h9Xpp = parcelRequire("h9Xpp");

var $1vDLP = parcelRequire("1vDLP");


var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $iAi3o = parcelRequire("iAi3o");

var $gaWeX = parcelRequire("gaWeX");

var $hEsmQ = parcelRequire("hEsmQ");

var $5rADe = parcelRequire("5rADe");

var $eUQTM = parcelRequire("eUQTM");

var $lMGba = parcelRequire("lMGba");
var $2cd628e3030fa8c7$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $2cd628e3030fa8c7$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $2cd628e3030fa8c7$var$ParameterHintsWidget_1;
const $2cd628e3030fa8c7$var$$ = $bDzmQ.$;
const $2cd628e3030fa8c7$var$parameterHintsNextIcon = (0, $hEsmQ.registerIcon)('parameter-hints-next', (0, $awgRE.Codicon).chevronDown, $4dEdH.localize('parameterHintsNextIcon', 'Icon for show next parameter hint.'));
const $2cd628e3030fa8c7$var$parameterHintsPreviousIcon = (0, $hEsmQ.registerIcon)('parameter-hints-previous', (0, $awgRE.Codicon).chevronUp, $4dEdH.localize('parameterHintsPreviousIcon', 'Icon for show previous parameter hint.'));
let $2cd628e3030fa8c7$export$fd583862071b2279 = class ParameterHintsWidget extends (0, $9cWcn.Disposable) {
    static{
        $2cd628e3030fa8c7$var$ParameterHintsWidget_1 = this;
    }
    static{
        this.ID = 'editor.widget.parameterHintsWidget';
    }
    constructor(editor, model, contextKeyService, openerService, languageService, telemetryService){
        super();
        this.editor = editor;
        this.model = model;
        this.telemetryService = telemetryService;
        this.renderDisposeables = this._register(new (0, $9cWcn.DisposableStore)());
        this.visible = false;
        this.announcedLabel = null;
        // Editor.IContentWidget.allowEditorOverflow
        this.allowEditorOverflow = true;
        this.markdownRenderer = this._register(new (0, $1vDLP.MarkdownRenderer)({
            editor: editor
        }, languageService, openerService));
        this.keyVisible = (0, $9720969f08005d5b$export$841858b892ce1f4c).Visible.bindTo(contextKeyService);
        this.keyMultipleSignatures = (0, $9720969f08005d5b$export$841858b892ce1f4c).MultipleSignatures.bindTo(contextKeyService);
    }
    createParameterHintDOMNodes() {
        const element = $2cd628e3030fa8c7$var$$('.editor-widget.parameter-hints-widget');
        const wrapper = $bDzmQ.append(element, $2cd628e3030fa8c7$var$$('.phwrapper'));
        wrapper.tabIndex = -1;
        const controls = $bDzmQ.append(wrapper, $2cd628e3030fa8c7$var$$('.controls'));
        const previous = $bDzmQ.append(controls, $2cd628e3030fa8c7$var$$('.button' + (0, $5rADe.ThemeIcon).asCSSSelector($2cd628e3030fa8c7$var$parameterHintsPreviousIcon)));
        const overloads = $bDzmQ.append(controls, $2cd628e3030fa8c7$var$$('.overloads'));
        const next = $bDzmQ.append(controls, $2cd628e3030fa8c7$var$$('.button' + (0, $5rADe.ThemeIcon).asCSSSelector($2cd628e3030fa8c7$var$parameterHintsNextIcon)));
        this._register($bDzmQ.addDisposableListener(previous, 'click', (e)=>{
            $bDzmQ.EventHelper.stop(e);
            this.previous();
        }));
        this._register($bDzmQ.addDisposableListener(next, 'click', (e)=>{
            $bDzmQ.EventHelper.stop(e);
            this.next();
        }));
        const body = $2cd628e3030fa8c7$var$$('.body');
        const scrollbar = new (0, $2aRJR.DomScrollableElement)(body, {
            alwaysConsumeMouseWheel: true
        });
        this._register(scrollbar);
        wrapper.appendChild(scrollbar.getDomNode());
        const signature = $bDzmQ.append(body, $2cd628e3030fa8c7$var$$('.signature'));
        const docs = $bDzmQ.append(body, $2cd628e3030fa8c7$var$$('.docs'));
        element.style.userSelect = 'text';
        this.domNodes = {
            element: element,
            signature: signature,
            overloads: overloads,
            docs: docs,
            scrollbar: scrollbar
        };
        this.editor.addContentWidget(this);
        this.hide();
        this._register(this.editor.onDidChangeCursorSelection((e)=>{
            if (this.visible) this.editor.layoutContentWidget(this);
        }));
        const updateFont = ()=>{
            if (!this.domNodes) return;
            const fontInfo = this.editor.getOption(50 /* EditorOption.fontInfo */ );
            const element = this.domNodes.element;
            element.style.fontSize = `${fontInfo.fontSize}px`;
            element.style.lineHeight = `${fontInfo.lineHeight / fontInfo.fontSize}`;
            element.style.setProperty('--vscode-parameterHintsWidget-editorFontFamily', fontInfo.fontFamily);
            element.style.setProperty('--vscode-parameterHintsWidget-editorFontFamilyDefault', (0, $cd4KD.EDITOR_FONT_DEFAULTS).fontFamily);
        };
        updateFont();
        this._register((0, $5YaSO.Event).chain(this.editor.onDidChangeConfiguration.bind(this.editor), ($)=>$.filter((e)=>e.hasChanged(50 /* EditorOption.fontInfo */ )))(updateFont));
        this._register(this.editor.onDidLayoutChange((e)=>this.updateMaxHeight()));
        this.updateMaxHeight();
    }
    show() {
        if (this.visible) return;
        if (!this.domNodes) this.createParameterHintDOMNodes();
        this.keyVisible.set(true);
        this.visible = true;
        setTimeout(()=>{
            this.domNodes?.element.classList.add('visible');
        }, 100);
        this.editor.layoutContentWidget(this);
    }
    hide() {
        this.renderDisposeables.clear();
        if (!this.visible) return;
        this.keyVisible.reset();
        this.visible = false;
        this.announcedLabel = null;
        this.domNodes?.element.classList.remove('visible');
        this.editor.layoutContentWidget(this);
    }
    getPosition() {
        if (this.visible) return {
            position: this.editor.getPosition(),
            preference: [
                1 /* ContentWidgetPositionPreference.ABOVE */ ,
                2 /* ContentWidgetPositionPreference.BELOW */ 
            ]
        };
        return null;
    }
    render(hints) {
        this.renderDisposeables.clear();
        if (!this.domNodes) return;
        const multiple = hints.signatures.length > 1;
        this.domNodes.element.classList.toggle('multiple', multiple);
        this.keyMultipleSignatures.set(multiple);
        this.domNodes.signature.innerText = '';
        this.domNodes.docs.innerText = '';
        const signature = hints.signatures[hints.activeSignature];
        if (!signature) return;
        const code = $bDzmQ.append(this.domNodes.signature, $2cd628e3030fa8c7$var$$('.code'));
        const hasParameters = signature.parameters.length > 0;
        const activeParameterIndex = signature.activeParameter ?? hints.activeParameter;
        if (!hasParameters) {
            const label = $bDzmQ.append(code, $2cd628e3030fa8c7$var$$('span'));
            label.textContent = signature.label;
        } else this.renderParameters(code, signature, activeParameterIndex);
        const activeParameter = signature.parameters[activeParameterIndex];
        if (activeParameter?.documentation) {
            const documentation = $2cd628e3030fa8c7$var$$('span.documentation');
            if (typeof activeParameter.documentation === 'string') documentation.textContent = activeParameter.documentation;
            else {
                const renderedContents = this.renderMarkdownDocs(activeParameter.documentation);
                documentation.appendChild(renderedContents.element);
            }
            $bDzmQ.append(this.domNodes.docs, $2cd628e3030fa8c7$var$$('p', {}, documentation));
        }
        if (signature.documentation === undefined) ;
        else if (typeof signature.documentation === 'string') $bDzmQ.append(this.domNodes.docs, $2cd628e3030fa8c7$var$$('p', {}, signature.documentation));
        else {
            const renderedContents = this.renderMarkdownDocs(signature.documentation);
            $bDzmQ.append(this.domNodes.docs, renderedContents.element);
        }
        const hasDocs = this.hasDocs(signature, activeParameter);
        this.domNodes.signature.classList.toggle('has-docs', hasDocs);
        this.domNodes.docs.classList.toggle('empty', !hasDocs);
        this.domNodes.overloads.textContent = String(hints.activeSignature + 1).padStart(hints.signatures.length.toString().length, '0') + '/' + hints.signatures.length;
        if (activeParameter) {
            let labelToAnnounce = '';
            const param = signature.parameters[activeParameterIndex];
            if (Array.isArray(param.label)) labelToAnnounce = signature.label.substring(param.label[0], param.label[1]);
            else labelToAnnounce = param.label;
            if (param.documentation) labelToAnnounce += typeof param.documentation === 'string' ? `, ${param.documentation}` : `, ${param.documentation.value}`;
            if (signature.documentation) labelToAnnounce += typeof signature.documentation === 'string' ? `, ${signature.documentation}` : `, ${signature.documentation.value}`;
            // Select method gets called on every user type while parameter hints are visible.
            // We do not want to spam the user with same announcements, so we only announce if the current parameter changed.
            if (this.announcedLabel !== labelToAnnounce) {
                $aIbUW.alert($4dEdH.localize('hint', "{0}, hint", labelToAnnounce));
                this.announcedLabel = labelToAnnounce;
            }
        }
        this.editor.layoutContentWidget(this);
        this.domNodes.scrollbar.scanDomNode();
    }
    renderMarkdownDocs(markdown) {
        const stopWatch = new (0, $eUQTM.StopWatch)();
        const renderedContents = this.renderDisposeables.add(this.markdownRenderer.render(markdown, {
            asyncRenderCallback: ()=>{
                this.domNodes?.scrollbar.scanDomNode();
            }
        }));
        renderedContents.element.classList.add('markdown-docs');
        const renderDuration = stopWatch.elapsed();
        if (renderDuration > 300) this.telemetryService.publicLog2('parameterHints.parseMarkdown', {
            renderDuration: renderDuration
        });
        return renderedContents;
    }
    hasDocs(signature, activeParameter) {
        if (activeParameter && typeof activeParameter.documentation === 'string' && (0, $bxBg7.assertIsDefined)(activeParameter.documentation).length > 0) return true;
        if (activeParameter && typeof activeParameter.documentation === 'object' && (0, $bxBg7.assertIsDefined)(activeParameter.documentation).value.length > 0) return true;
        if (signature.documentation && typeof signature.documentation === 'string' && (0, $bxBg7.assertIsDefined)(signature.documentation).length > 0) return true;
        if (signature.documentation && typeof signature.documentation === 'object' && (0, $bxBg7.assertIsDefined)(signature.documentation.value).length > 0) return true;
        return false;
    }
    renderParameters(parent, signature, activeParameterIndex) {
        const [start, end] = this.getParameterLabelOffsets(signature, activeParameterIndex);
        const beforeSpan = document.createElement('span');
        beforeSpan.textContent = signature.label.substring(0, start);
        const paramSpan = document.createElement('span');
        paramSpan.textContent = signature.label.substring(start, end);
        paramSpan.className = 'parameter active';
        const afterSpan = document.createElement('span');
        afterSpan.textContent = signature.label.substring(end);
        $bDzmQ.append(parent, beforeSpan, paramSpan, afterSpan);
    }
    getParameterLabelOffsets(signature, paramIdx) {
        const param = signature.parameters[paramIdx];
        if (!param) return [
            0,
            0
        ];
        else if (Array.isArray(param.label)) return param.label;
        else if (!param.label.length) return [
            0,
            0
        ];
        else {
            const regex = new RegExp(`(\\W|^)${(0, $jcr1R.escapeRegExpCharacters)(param.label)}(?=\\W|$)`, 'g');
            regex.test(signature.label);
            const idx = regex.lastIndex - param.label.length;
            return idx >= 0 ? [
                idx,
                regex.lastIndex
            ] : [
                0,
                0
            ];
        }
    }
    next() {
        this.editor.focus();
        this.model.next();
    }
    previous() {
        this.editor.focus();
        this.model.previous();
    }
    getDomNode() {
        if (!this.domNodes) this.createParameterHintDOMNodes();
        return this.domNodes.element;
    }
    getId() {
        return $2cd628e3030fa8c7$var$ParameterHintsWidget_1.ID;
    }
    updateMaxHeight() {
        if (!this.domNodes) return;
        const height = Math.max(this.editor.getLayoutInfo().height / 4, 250);
        const maxHeight = `${height}px`;
        this.domNodes.element.style.maxHeight = maxHeight;
        const wrapper = this.domNodes.element.getElementsByClassName('phwrapper');
        if (wrapper.length) wrapper[0].style.maxHeight = maxHeight;
    }
};
$2cd628e3030fa8c7$export$fd583862071b2279 = $2cd628e3030fa8c7$var$ParameterHintsWidget_1 = $2cd628e3030fa8c7$var$__decorate([
    $2cd628e3030fa8c7$var$__param(2, (0, $cxCeF.IContextKeyService)),
    $2cd628e3030fa8c7$var$__param(3, (0, $iAi3o.IOpenerService)),
    $2cd628e3030fa8c7$var$__param(4, (0, $h9Xpp.ILanguageService)),
    $2cd628e3030fa8c7$var$__param(5, (0, $lMGba.ITelemetryService))
], $2cd628e3030fa8c7$export$fd583862071b2279);
(0, $gaWeX.registerColor)('editorHoverWidget.highlightForeground', (0, $gaWeX.listHighlightForeground), $4dEdH.localize('editorHoverWidgetHighlightForeground', 'Foreground color of the active item in the parameter hint.'));


var $af19c63687d22f23$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $af19c63687d22f23$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $af19c63687d22f23$var$ParameterHintsController_1;
let $af19c63687d22f23$export$46d6f6edccd36ce9 = class ParameterHintsController extends (0, $9cWcn.Disposable) {
    static{
        $af19c63687d22f23$var$ParameterHintsController_1 = this;
    }
    static{
        this.ID = 'editor.controller.parameterHints';
    }
    static get(editor) {
        return editor.getContribution($af19c63687d22f23$var$ParameterHintsController_1.ID);
    }
    constructor(editor, instantiationService, languageFeaturesService){
        super();
        this.editor = editor;
        this.model = this._register(new (0, $a36f154798cb4a78$export$7f27c6b5c579a14e)(editor, languageFeaturesService.signatureHelpProvider));
        this._register(this.model.onChangedHints((newParameterHints)=>{
            if (newParameterHints) {
                this.widget.value.show();
                this.widget.value.render(newParameterHints);
            } else this.widget.rawValue?.hide();
        }));
        this.widget = new (0, $7DcRJ.Lazy)(()=>this._register(instantiationService.createInstance((0, $2cd628e3030fa8c7$export$fd583862071b2279), this.editor, this.model)));
    }
    cancel() {
        this.model.cancel();
    }
    previous() {
        this.widget.rawValue?.previous();
    }
    next() {
        this.widget.rawValue?.next();
    }
    trigger(context) {
        this.model.trigger(context, 0);
    }
};
$af19c63687d22f23$export$46d6f6edccd36ce9 = $af19c63687d22f23$var$ParameterHintsController_1 = $af19c63687d22f23$var$__decorate([
    $af19c63687d22f23$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $af19c63687d22f23$var$__param(2, (0, $4J6fu.ILanguageFeaturesService))
], $af19c63687d22f23$export$46d6f6edccd36ce9);
class $af19c63687d22f23$export$289200f1e6286db4 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.triggerParameterHints',
            label: $4dEdH.localize('parameterHints.trigger.label', "Trigger Parameter Hints"),
            alias: 'Trigger Parameter Hints',
            precondition: (0, $ibKGQ.EditorContextKeys).hasSignatureHelpProvider,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 3082 /* KeyCode.Space */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor) {
        const controller = $af19c63687d22f23$export$46d6f6edccd36ce9.get(editor);
        controller?.trigger({
            triggerKind: $kzNQX.SignatureHelpTriggerKind.Invoke
        });
    }
}
(0, $2iJTi.registerEditorContribution)($af19c63687d22f23$export$46d6f6edccd36ce9.ID, $af19c63687d22f23$export$46d6f6edccd36ce9, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );
(0, $2iJTi.registerEditorAction)($af19c63687d22f23$export$289200f1e6286db4);
const $af19c63687d22f23$var$weight = 175;
const $af19c63687d22f23$var$ParameterHintsCommand = (0, $2iJTi.EditorCommand).bindToContribution($af19c63687d22f23$export$46d6f6edccd36ce9.get);
(0, $2iJTi.registerEditorCommand)(new $af19c63687d22f23$var$ParameterHintsCommand({
    id: 'closeParameterHints',
    precondition: (0, $9720969f08005d5b$export$841858b892ce1f4c).Visible,
    handler: (x)=>x.cancel(),
    kbOpts: {
        weight: $af19c63687d22f23$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 9 /* KeyCode.Escape */ ,
        secondary: [
            1033 /* KeyCode.Escape */ 
        ]
    }
}));
(0, $2iJTi.registerEditorCommand)(new $af19c63687d22f23$var$ParameterHintsCommand({
    id: 'showPrevParameterHint',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $9720969f08005d5b$export$841858b892ce1f4c).Visible, (0, $9720969f08005d5b$export$841858b892ce1f4c).MultipleSignatures),
    handler: (x)=>x.previous(),
    kbOpts: {
        weight: $af19c63687d22f23$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 16 /* KeyCode.UpArrow */ ,
        secondary: [
            528 /* KeyCode.UpArrow */ 
        ],
        mac: {
            primary: 16 /* KeyCode.UpArrow */ ,
            secondary: [
                528 /* KeyCode.UpArrow */ ,
                302 /* KeyCode.KeyP */ 
            ]
        }
    }
}));
(0, $2iJTi.registerEditorCommand)(new $af19c63687d22f23$var$ParameterHintsCommand({
    id: 'showNextParameterHint',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $9720969f08005d5b$export$841858b892ce1f4c).Visible, (0, $9720969f08005d5b$export$841858b892ce1f4c).MultipleSignatures),
    handler: (x)=>x.next(),
    kbOpts: {
        weight: $af19c63687d22f23$var$weight,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 18 /* KeyCode.DownArrow */ ,
        secondary: [
            530 /* KeyCode.DownArrow */ 
        ],
        mac: {
            primary: 18 /* KeyCode.DownArrow */ ,
            secondary: [
                530 /* KeyCode.DownArrow */ ,
                300 /* KeyCode.KeyN */ 
            ]
        }
    }
}));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $2iJTi = parcelRequire("2iJTi");

var $cw0ys = parcelRequire("cw0ys");

var $4dEdH = parcelRequire("4dEdH");

var $lGFDZ = parcelRequire("lGFDZ");


var $poVJz = parcelRequire("poVJz");

var $kImF8 = parcelRequire("kImF8");

var $4fzqs = parcelRequire("4fzqs");

var $fdGPu = parcelRequire("fdGPu");
var $f741d7f751e4c016$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $f741d7f751e4c016$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $f741d7f751e4c016$var$BaseClass {
    constructor(instantiationService){
        this.instantiationService = instantiationService;
    }
    init(...params) {}
}
function $f741d7f751e4c016$var$createWrapper(getClass, B) {
    return class ReloadableWrapper extends B {
        constructor(){
            super(...arguments);
            this._autorun = undefined;
        }
        init(...params) {
            this._autorun = (0, $4fzqs.autorunWithStore)((reader, store)=>{
                const clazz = (0, $kImF8.readHotReloadableExport)(getClass(), reader);
                store.add(this.instantiationService.createInstance(clazz, ...params));
            });
        }
        dispose() {
            this._autorun?.dispose();
        }
    };
}
function $f741d7f751e4c016$export$6daae15f870da467(getClass) {
    return !(0, $poVJz.isHotReloadEnabled)() ? getClass() : $f741d7f751e4c016$var$createWrapper(getClass, $f741d7f751e4c016$var$BaseClass1);
}
let $f741d7f751e4c016$var$BaseClass1 = class BaseClass1 extends $f741d7f751e4c016$var$BaseClass {
    constructor(param1, i){
        super(i);
        this.init(param1);
    }
};
$f741d7f751e4c016$var$BaseClass1 = $f741d7f751e4c016$var$__decorate([
    $f741d7f751e4c016$var$__param(1, (0, $fdGPu.IInstantiationService))
], $f741d7f751e4c016$var$BaseClass1);


(0, $2iJTi.registerEditorContribution)((0, $d82c43f4abf895d7$export$80dcdce8162cfdb5).ID, (0, $f741d7f751e4c016$export$6daae15f870da467)(()=>(0, $d82c43f4abf895d7$export$80dcdce8162cfdb5)), 0 /* EditorContributionInstantiation.Eager */ );
(0, $lGFDZ.registerColor)('editor.placeholder.foreground', (0, $cw0ys.ghostTextForeground), (0, $4dEdH.localize)('placeholderForeground', 'Foreground color of the placeholder text in the editor.'));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $aIbUW = parcelRequire("aIbUW");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");

var $2iJTi = parcelRequire("2iJTi");

var $d4p5R = parcelRequire("d4p5R");

var $2Qfl0 = parcelRequire("2Qfl0");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $kzNQX = parcelRequire("kzNQX");

var $4J6fu = parcelRequire("4J6fu");

var $jx8dy = parcelRequire("jx8dy");

var $lgoyH = parcelRequire("lgoyH");


var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $eWLlf = parcelRequire("eWLlf");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $dvEeB = parcelRequire("dvEeB");

var $kCOKl = parcelRequire("kCOKl");

var $4E7vx = parcelRequire("4E7vx");

var $TezJS = parcelRequire("TezJS");

var $lMGba = parcelRequire("lMGba");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $gV002 = parcelRequire("gV002");

var $aIbUW = parcelRequire("aIbUW");

var $j72nw = parcelRequire("j72nw");

var $b97Zr = parcelRequire("b97Zr");

var $6G2yS = parcelRequire("6G2yS");

var $dD2OW = parcelRequire("dD2OW");

var $kJ8UG = parcelRequire("kJ8UG");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $awgRE = parcelRequire("awgRE");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $eUQTM = parcelRequire("eUQTM");

var $bxBg7 = parcelRequire("bxBg7");


var $84zMl = parcelRequire("84zMl");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $kzNQX = parcelRequire("kzNQX");

var $4dEdH = parcelRequire("4dEdH");

var $cxCeF = parcelRequire("cxCeF");

var $7IxGd = parcelRequire("7IxGd");

var $dvEeB = parcelRequire("dvEeB");

var $l1XLO = parcelRequire("l1XLO");

var $gaWeX = parcelRequire("gaWeX");

var $azIPz = parcelRequire("azIPz");
var $f42de4678eafddce$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $f42de4678eafddce$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
/** for debugging */ const $f42de4678eafddce$var$_sticky = false;
const $f42de4678eafddce$export$af782c46022b2288 = new (0, $cxCeF.RawContextKey)('renameInputVisible', false, $4dEdH.localize('renameInputVisible', "Whether the rename input widget is visible"));
const $f42de4678eafddce$export$2d50b73d11bdca1a = new (0, $cxCeF.RawContextKey)('renameInputFocused', false, $4dEdH.localize('renameInputFocused', "Whether the rename input widget is focused"));
let $f42de4678eafddce$export$1f8bfaf864fdb80b = class RenameWidget {
    constructor(_editor, _acceptKeybindings, _themeService, _keybindingService, contextKeyService, _logService){
        this._editor = _editor;
        this._acceptKeybindings = _acceptKeybindings;
        this._themeService = _themeService;
        this._keybindingService = _keybindingService;
        this._logService = _logService;
        // implement IContentWidget
        this.allowEditorOverflow = true;
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._visibleContextKey = $f42de4678eafddce$export$af782c46022b2288.bindTo(contextKeyService);
        this._isEditingRenameCandidate = false;
        this._nRenameSuggestionsInvocations = 0;
        this._hadAutomaticRenameSuggestionsInvocation = false;
        this._candidates = new Set();
        this._beforeFirstInputFieldEditSW = new (0, $eUQTM.StopWatch)();
        this._inputWithButton = new $f42de4678eafddce$var$InputWithButton();
        this._disposables.add(this._inputWithButton);
        this._editor.addContentWidget(this);
        this._disposables.add(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(50 /* EditorOption.fontInfo */ )) this._updateFont();
        }));
        this._disposables.add(_themeService.onDidColorThemeChange(this._updateStyles, this));
    }
    dispose() {
        this._disposables.dispose();
        this._editor.removeContentWidget(this);
    }
    getId() {
        return '__renameInputWidget';
    }
    getDomNode() {
        if (!this._domNode) {
            this._domNode = document.createElement('div');
            this._domNode.className = 'monaco-editor rename-box';
            this._domNode.appendChild(this._inputWithButton.domNode);
            this._renameCandidateListView = this._disposables.add(new $f42de4678eafddce$var$RenameCandidateListView(this._domNode, {
                fontInfo: this._editor.getOption(50 /* EditorOption.fontInfo */ ),
                onFocusChange: (newSymbolName)=>{
                    this._inputWithButton.input.value = newSymbolName;
                    this._isEditingRenameCandidate = false; // @ulugbekna: reset
                },
                onSelectionChange: ()=>{
                    this._isEditingRenameCandidate = false; // @ulugbekna: because user picked a rename suggestion
                    this.acceptInput(false); // we don't allow preview with mouse click for now
                }
            }));
            this._disposables.add(this._inputWithButton.onDidInputChange(()=>{
                if (this._renameCandidateListView?.focusedCandidate !== undefined) this._isEditingRenameCandidate = true;
                this._timeBeforeFirstInputFieldEdit ??= this._beforeFirstInputFieldEditSW.elapsed();
                if (this._renameCandidateProvidersCts?.token.isCancellationRequested === false) this._renameCandidateProvidersCts.cancel();
                this._renameCandidateListView?.clearFocus();
            }));
            this._label = document.createElement('div');
            this._label.className = 'rename-label';
            this._domNode.appendChild(this._label);
            this._updateFont();
            this._updateStyles(this._themeService.getColorTheme());
        }
        return this._domNode;
    }
    _updateStyles(theme) {
        if (!this._domNode) return;
        const widgetShadowColor = theme.getColor((0, $gaWeX.widgetShadow));
        const widgetBorderColor = theme.getColor((0, $gaWeX.widgetBorder));
        this._domNode.style.backgroundColor = String(theme.getColor((0, $gaWeX.editorWidgetBackground)) ?? '');
        this._domNode.style.boxShadow = widgetShadowColor ? ` 0 0 8px 2px ${widgetShadowColor}` : '';
        this._domNode.style.border = widgetBorderColor ? `1px solid ${widgetBorderColor}` : '';
        this._domNode.style.color = String(theme.getColor((0, $gaWeX.inputForeground)) ?? '');
        const border = theme.getColor((0, $gaWeX.inputBorder));
        this._inputWithButton.domNode.style.backgroundColor = String(theme.getColor((0, $gaWeX.inputBackground)) ?? '');
        this._inputWithButton.input.style.backgroundColor = String(theme.getColor((0, $gaWeX.inputBackground)) ?? '');
        this._inputWithButton.domNode.style.borderWidth = border ? '1px' : '0px';
        this._inputWithButton.domNode.style.borderStyle = border ? 'solid' : 'none';
        this._inputWithButton.domNode.style.borderColor = border?.toString() ?? 'none';
    }
    _updateFont() {
        if (this._domNode === undefined) return;
        (0, $bxBg7.assertType)(this._label !== undefined, 'RenameWidget#_updateFont: _label must not be undefined given _domNode is defined');
        this._editor.applyFontInfo(this._inputWithButton.input);
        const fontInfo = this._editor.getOption(50 /* EditorOption.fontInfo */ );
        this._label.style.fontSize = `${this._computeLabelFontSize(fontInfo.fontSize)}px`;
    }
    _computeLabelFontSize(editorFontSize) {
        return editorFontSize * 0.8;
    }
    getPosition() {
        if (!this._visible) return null;
        if (!this._editor.hasModel() || // @ulugbekna: shouldn't happen
        !this._editor.getDomNode() // @ulugbekna: can happen during tests based on suggestWidget's similar predicate check
        ) return null;
        const bodyBox = $bDzmQ.getClientArea(this.getDomNode().ownerDocument.body);
        const editorBox = $bDzmQ.getDomNodePagePosition(this._editor.getDomNode());
        const cursorBoxTop = this._getTopForPosition();
        this._nPxAvailableAbove = cursorBoxTop + editorBox.top;
        this._nPxAvailableBelow = bodyBox.height - this._nPxAvailableAbove;
        const lineHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ );
        const { totalHeight: candidateViewHeight } = $f42de4678eafddce$var$RenameCandidateView.getLayoutInfo({
            lineHeight: lineHeight
        });
        const positionPreference = this._nPxAvailableBelow > candidateViewHeight * 6 /* approximate # of candidates to fit in (inclusive of rename input box & rename label) */  ? [
            2 /* ContentWidgetPositionPreference.BELOW */ ,
            1 /* ContentWidgetPositionPreference.ABOVE */ 
        ] : [
            1 /* ContentWidgetPositionPreference.ABOVE */ ,
            2 /* ContentWidgetPositionPreference.BELOW */ 
        ];
        return {
            position: this._position,
            preference: positionPreference
        };
    }
    beforeRender() {
        const [accept, preview] = this._acceptKeybindings;
        this._label.innerText = $4dEdH.localize({
            key: 'label',
            comment: [
                'placeholders are keybindings, e.g "F2 to Rename, Shift+F2 to Preview"'
            ]
        }, "{0} to Rename, {1} to Preview", this._keybindingService.lookupKeybinding(accept)?.getLabel(), this._keybindingService.lookupKeybinding(preview)?.getLabel());
        this._domNode.style.minWidth = `200px`; // to prevent from widening when candidates come in
        return null;
    }
    afterRender(position) {
        // FIXME@ulugbekna: commenting trace log out until we start unmounting the widget from editor properly - https://github.com/microsoft/vscode/issues/226975
        // this._trace('invoking afterRender, position: ', position ? 'not null' : 'null');
        if (position === null) {
            // cancel rename when input widget isn't rendered anymore
            this.cancelInput(true, 'afterRender (because position is null)');
            return;
        }
        if (!this._editor.hasModel() || // shouldn't happen
        !this._editor.getDomNode() // can happen during tests based on suggestWidget's similar predicate check
        ) return;
        (0, $bxBg7.assertType)(this._renameCandidateListView);
        (0, $bxBg7.assertType)(this._nPxAvailableAbove !== undefined);
        (0, $bxBg7.assertType)(this._nPxAvailableBelow !== undefined);
        const inputBoxHeight = $bDzmQ.getTotalHeight(this._inputWithButton.domNode);
        const labelHeight = $bDzmQ.getTotalHeight(this._label);
        let totalHeightAvailable;
        if (position === 2 /* ContentWidgetPositionPreference.BELOW */ ) totalHeightAvailable = this._nPxAvailableBelow;
        else totalHeightAvailable = this._nPxAvailableAbove;
        this._renameCandidateListView.layout({
            height: totalHeightAvailable - labelHeight - inputBoxHeight,
            width: $bDzmQ.getTotalWidth(this._inputWithButton.domNode)
        });
    }
    acceptInput(wantsPreview) {
        this._trace(`invoking acceptInput`);
        this._currentAcceptInput?.(wantsPreview);
    }
    cancelInput(focusEditor, caller) {
        // this._trace(`invoking cancelInput, caller: ${caller}, _currentCancelInput: ${this._currentAcceptInput ? 'not undefined' : 'undefined'}`);
        this._currentCancelInput?.(focusEditor);
    }
    focusNextRenameSuggestion() {
        if (!this._renameCandidateListView?.focusNext()) this._inputWithButton.input.value = this._currentName;
    }
    focusPreviousRenameSuggestion() {
        if (!this._renameCandidateListView?.focusPrevious()) this._inputWithButton.input.value = this._currentName;
    }
    /**
     * @param requestRenameCandidates is `undefined` when there are no rename suggestion providers
     */ getInput(where, currentName, supportPreview, requestRenameCandidates, cts) {
        const { start: selectionStart, end: selectionEnd } = this._getSelection(where, currentName);
        this._renameCts = cts;
        const disposeOnDone = new (0, $9cWcn.DisposableStore)();
        this._nRenameSuggestionsInvocations = 0;
        this._hadAutomaticRenameSuggestionsInvocation = false;
        if (requestRenameCandidates === undefined) this._inputWithButton.button.style.display = 'none';
        else {
            this._inputWithButton.button.style.display = 'flex';
            this._requestRenameCandidatesOnce = requestRenameCandidates;
            this._requestRenameCandidates(currentName, false);
            disposeOnDone.add($bDzmQ.addDisposableListener(this._inputWithButton.button, 'click', ()=>this._requestRenameCandidates(currentName, true)));
            disposeOnDone.add($bDzmQ.addDisposableListener(this._inputWithButton.button, $bDzmQ.EventType.KEY_DOWN, (e)=>{
                const keyEvent = new (0, $gV002.StandardKeyboardEvent)(e);
                if (keyEvent.equals(3 /* KeyCode.Enter */ ) || keyEvent.equals(10 /* KeyCode.Space */ )) {
                    keyEvent.stopPropagation();
                    keyEvent.preventDefault();
                    this._requestRenameCandidates(currentName, true);
                }
            }));
        }
        this._isEditingRenameCandidate = false;
        this._domNode.classList.toggle('preview', supportPreview);
        this._position = new (0, $dcxQ7.Position)(where.startLineNumber, where.startColumn);
        this._currentName = currentName;
        this._inputWithButton.input.value = currentName;
        this._inputWithButton.input.setAttribute('selectionStart', selectionStart.toString());
        this._inputWithButton.input.setAttribute('selectionEnd', selectionEnd.toString());
        this._inputWithButton.input.size = Math.max((where.endColumn - where.startColumn) * 1.1, 20); // determines width
        this._beforeFirstInputFieldEditSW.reset();
        disposeOnDone.add((0, $9cWcn.toDisposable)(()=>{
            this._renameCts = undefined;
            cts.dispose(true);
        })); // @ulugbekna: this may result in `this.cancelInput` being called twice, but it should be safe since we set it to undefined after 1st call
        disposeOnDone.add((0, $9cWcn.toDisposable)(()=>{
            if (this._renameCandidateProvidersCts !== undefined) {
                this._renameCandidateProvidersCts.dispose(true);
                this._renameCandidateProvidersCts = undefined;
            }
        }));
        disposeOnDone.add((0, $9cWcn.toDisposable)(()=>this._candidates.clear()));
        const inputResult = new (0, $6bXyA.DeferredPromise)();
        inputResult.p.finally(()=>{
            disposeOnDone.dispose();
            this._hide();
        });
        this._currentCancelInput = (focusEditor)=>{
            this._trace('invoking _currentCancelInput');
            this._currentAcceptInput = undefined;
            this._currentCancelInput = undefined;
            // fixme session cleanup
            this._renameCandidateListView?.clearCandidates();
            inputResult.complete(focusEditor);
            return true;
        };
        this._currentAcceptInput = (wantsPreview)=>{
            this._trace('invoking _currentAcceptInput');
            (0, $bxBg7.assertType)(this._renameCandidateListView !== undefined);
            const nRenameSuggestions = this._renameCandidateListView.nCandidates;
            let newName;
            let source;
            const focusedCandidate = this._renameCandidateListView.focusedCandidate;
            if (focusedCandidate !== undefined) {
                this._trace('using new name from renameSuggestion');
                newName = focusedCandidate;
                source = {
                    k: 'renameSuggestion'
                };
            } else {
                this._trace('using new name from inputField');
                newName = this._inputWithButton.input.value;
                source = this._isEditingRenameCandidate ? {
                    k: 'userEditedRenameSuggestion'
                } : {
                    k: 'inputField'
                };
            }
            if (newName === currentName || newName.trim().length === 0 /* is just whitespace */ ) {
                this.cancelInput(true, '_currentAcceptInput (because newName === value || newName.trim().length === 0)');
                return;
            }
            this._currentAcceptInput = undefined;
            this._currentCancelInput = undefined;
            this._renameCandidateListView.clearCandidates();
            // fixme session cleanup
            inputResult.complete({
                newName: newName,
                wantsPreview: supportPreview && wantsPreview,
                stats: {
                    source: source,
                    nRenameSuggestions: nRenameSuggestions,
                    timeBeforeFirstInputFieldEdit: this._timeBeforeFirstInputFieldEdit,
                    nRenameSuggestionsInvocations: this._nRenameSuggestionsInvocations,
                    hadAutomaticRenameSuggestionsInvocation: this._hadAutomaticRenameSuggestionsInvocation
                }
            });
        };
        disposeOnDone.add(cts.token.onCancellationRequested(()=>this.cancelInput(true, 'cts.token.onCancellationRequested')));
        if (!$f42de4678eafddce$var$_sticky) disposeOnDone.add(this._editor.onDidBlurEditorWidget(()=>this.cancelInput(!this._domNode?.ownerDocument.hasFocus(), 'editor.onDidBlurEditorWidget')));
        this._show();
        return inputResult.p;
    }
    _requestRenameCandidates(currentName, isManuallyTriggered) {
        if (this._requestRenameCandidatesOnce === undefined) return;
        if (this._renameCandidateProvidersCts !== undefined) this._renameCandidateProvidersCts.dispose(true);
        (0, $bxBg7.assertType)(this._renameCts);
        if (this._inputWithButton.buttonState !== 'stop') {
            this._renameCandidateProvidersCts = new (0, $giPcZ.CancellationTokenSource)();
            const triggerKind = isManuallyTriggered ? (0, $kzNQX.NewSymbolNameTriggerKind).Invoke : (0, $kzNQX.NewSymbolNameTriggerKind).Automatic;
            const candidates = this._requestRenameCandidatesOnce(triggerKind, this._renameCandidateProvidersCts.token);
            if (candidates.length === 0) {
                this._inputWithButton.setSparkleButton();
                return;
            }
            if (!isManuallyTriggered) this._hadAutomaticRenameSuggestionsInvocation = true;
            this._nRenameSuggestionsInvocations += 1;
            this._inputWithButton.setStopButton();
            this._updateRenameCandidates(candidates, currentName, this._renameCts.token);
        }
    }
    /**
     * This allows selecting only part of the symbol name in the input field based on the selection in the editor
     */ _getSelection(where, currentName) {
        (0, $bxBg7.assertType)(this._editor.hasModel());
        const selection = this._editor.getSelection();
        let start = 0;
        let end = currentName.length;
        if (!(0, $d00il.Range).isEmpty(selection) && !(0, $d00il.Range).spansMultipleLines(selection) && (0, $d00il.Range).containsRange(where, selection)) {
            start = Math.max(0, selection.startColumn - where.startColumn);
            end = Math.min(where.endColumn, selection.endColumn) - where.startColumn;
        }
        return {
            start: start,
            end: end
        };
    }
    _show() {
        this._trace('invoking _show');
        this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber, 0 /* ScrollType.Smooth */ );
        this._visible = true;
        this._visibleContextKey.set(true);
        this._editor.layoutContentWidget(this);
        // TODO@ulugbekna: could this be simply run in `afterRender`?
        setTimeout(()=>{
            this._inputWithButton.input.focus();
            this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute('selectionStart')), parseInt(this._inputWithButton.input.getAttribute('selectionEnd')));
        }, 100);
    }
    async _updateRenameCandidates(candidates, currentName, token) {
        const trace = (...args)=>this._trace('_updateRenameCandidates', ...args);
        trace('start');
        const namesListResults = await (0, $6bXyA.raceCancellation)(Promise.allSettled(candidates), token);
        this._inputWithButton.setSparkleButton();
        if (namesListResults === undefined) {
            trace('returning early - received updateRenameCandidates results - undefined');
            return;
        }
        const newNames = namesListResults.flatMap((namesListResult)=>namesListResult.status === 'fulfilled' && (0, $bxBg7.isDefined)(namesListResult.value) ? namesListResult.value : []);
        trace(`received updateRenameCandidates results - total (unfiltered) ${newNames.length} candidates.`);
        // deduplicate and filter out the current value
        const distinctNames = $kJ8UG.distinct(newNames, (v)=>v.newSymbolName);
        trace(`distinct candidates - ${distinctNames.length} candidates.`);
        const validDistinctNames = distinctNames.filter(({ newSymbolName: newSymbolName })=>newSymbolName.trim().length > 0 && newSymbolName !== this._inputWithButton.input.value && newSymbolName !== currentName && !this._candidates.has(newSymbolName));
        trace(`valid distinct candidates - ${newNames.length} candidates.`);
        validDistinctNames.forEach((n)=>this._candidates.add(n.newSymbolName));
        if (validDistinctNames.length < 1) {
            trace('returning early - no valid distinct candidates');
            return;
        }
        // show the candidates
        trace('setting candidates');
        this._renameCandidateListView.setCandidates(validDistinctNames);
        // ask editor to re-layout given that the widget is now of a different size after rendering rename candidates
        trace('asking editor to re-layout');
        this._editor.layoutContentWidget(this);
    }
    _hide() {
        this._trace('invoked _hide');
        this._visible = false;
        this._visibleContextKey.reset();
        this._editor.layoutContentWidget(this);
    }
    _getTopForPosition() {
        const visibleRanges = this._editor.getVisibleRanges();
        let firstLineInViewport;
        if (visibleRanges.length > 0) firstLineInViewport = visibleRanges[0].startLineNumber;
        else {
            this._logService.warn('RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty');
            firstLineInViewport = Math.max(1, this._position.lineNumber - 5); // @ulugbekna: fallback to current line minus 5
        }
        return this._editor.getTopForLineNumber(this._position.lineNumber) - this._editor.getTopForLineNumber(firstLineInViewport);
    }
    _trace(...args) {
        this._logService.trace('RenameWidget', ...args);
    }
};
$f42de4678eafddce$export$1f8bfaf864fdb80b = $f42de4678eafddce$var$__decorate([
    $f42de4678eafddce$var$__param(2, (0, $azIPz.IThemeService)),
    $f42de4678eafddce$var$__param(3, (0, $7IxGd.IKeybindingService)),
    $f42de4678eafddce$var$__param(4, (0, $cxCeF.IContextKeyService)),
    $f42de4678eafddce$var$__param(5, (0, $dvEeB.ILogService))
], $f42de4678eafddce$export$1f8bfaf864fdb80b);
class $f42de4678eafddce$var$RenameCandidateListView {
    // FIXME@ulugbekna: rewrite using event emitters
    constructor(parent, opts){
        this._disposables = new (0, $9cWcn.DisposableStore)();
        this._availableHeight = 0;
        this._minimumWidth = 0;
        this._lineHeight = opts.fontInfo.lineHeight;
        this._typicalHalfwidthCharacterWidth = opts.fontInfo.typicalHalfwidthCharacterWidth;
        this._listContainer = document.createElement('div');
        this._listContainer.className = 'rename-box rename-candidate-list-container';
        parent.appendChild(this._listContainer);
        this._listWidget = $f42de4678eafddce$var$RenameCandidateListView._createListWidget(this._listContainer, this._candidateViewHeight, opts.fontInfo);
        this._listWidget.onDidChangeFocus((e)=>{
            if (e.elements.length === 1) opts.onFocusChange(e.elements[0].newSymbolName);
        }, this._disposables);
        this._listWidget.onDidChangeSelection((e)=>{
            if (e.elements.length === 1) opts.onSelectionChange();
        }, this._disposables);
        this._disposables.add(this._listWidget.onDidBlur((e)=>{
            this._listWidget.setFocus([]);
        }));
        this._listWidget.style((0, $l1XLO.getListStyles)({
            listInactiveFocusForeground: (0, $gaWeX.quickInputListFocusForeground),
            listInactiveFocusBackground: (0, $gaWeX.quickInputListFocusBackground)
        }));
    }
    dispose() {
        this._listWidget.dispose();
        this._disposables.dispose();
    }
    // height - max height allowed by parent element
    layout({ height: height, width: width }) {
        this._availableHeight = height;
        this._minimumWidth = width;
    }
    setCandidates(candidates) {
        // insert candidates into list widget
        this._listWidget.splice(0, 0, candidates);
        // adjust list widget layout
        const height = this._pickListHeight(this._listWidget.length);
        const width = this._pickListWidth(candidates);
        this._listWidget.layout(height, width);
        // adjust list container layout
        this._listContainer.style.height = `${height}px`;
        this._listContainer.style.width = `${width}px`;
        $aIbUW.status($4dEdH.localize('renameSuggestionsReceivedAria', "Received {0} rename suggestions", candidates.length));
    }
    clearCandidates() {
        this._listContainer.style.height = '0px';
        this._listContainer.style.width = '0px';
        this._listWidget.splice(0, this._listWidget.length, []);
    }
    get nCandidates() {
        return this._listWidget.length;
    }
    get focusedCandidate() {
        if (this._listWidget.length === 0) return;
        const selectedElement = this._listWidget.getSelectedElements()[0];
        if (selectedElement !== undefined) return selectedElement.newSymbolName;
        const focusedElement = this._listWidget.getFocusedElements()[0];
        if (focusedElement !== undefined) return focusedElement.newSymbolName;
        return;
    }
    focusNext() {
        if (this._listWidget.length === 0) return false;
        const focusedIxs = this._listWidget.getFocus();
        if (focusedIxs.length === 0) {
            this._listWidget.focusFirst();
            this._listWidget.reveal(0);
            return true;
        } else if (focusedIxs[0] === this._listWidget.length - 1) {
            this._listWidget.setFocus([]);
            this._listWidget.reveal(0); // @ulugbekna: without this, it seems like focused element is obstructed
            return false;
        } else {
            this._listWidget.focusNext();
            const focused = this._listWidget.getFocus()[0];
            this._listWidget.reveal(focused);
            return true;
        }
    }
    /**
     * @returns true if focus is moved to previous element
     */ focusPrevious() {
        if (this._listWidget.length === 0) return false;
        const focusedIxs = this._listWidget.getFocus();
        if (focusedIxs.length === 0) {
            this._listWidget.focusLast();
            const focused = this._listWidget.getFocus()[0];
            this._listWidget.reveal(focused);
            return true;
        } else if (focusedIxs[0] === 0) {
            this._listWidget.setFocus([]);
            return false;
        } else {
            this._listWidget.focusPrevious();
            const focused = this._listWidget.getFocus()[0];
            this._listWidget.reveal(focused);
            return true;
        }
    }
    clearFocus() {
        this._listWidget.setFocus([]);
    }
    get _candidateViewHeight() {
        const { totalHeight: totalHeight } = $f42de4678eafddce$var$RenameCandidateView.getLayoutInfo({
            lineHeight: this._lineHeight
        });
        return totalHeight;
    }
    _pickListHeight(nCandidates) {
        const heightToFitAllCandidates = this._candidateViewHeight * nCandidates;
        const MAX_N_CANDIDATES = 7; // @ulugbekna: max # of candidates we want to show at once
        const height = Math.min(heightToFitAllCandidates, this._availableHeight, this._candidateViewHeight * MAX_N_CANDIDATES);
        return height;
    }
    _pickListWidth(candidates) {
        const longestCandidateWidth = Math.ceil(Math.max(...candidates.map((c)=>c.newSymbolName.length)) * this._typicalHalfwidthCharacterWidth);
        const width = Math.max(this._minimumWidth, 25 /* margin-left */  + longestCandidateWidth + 10 /* (possibly visible) scrollbar width */  // TODO@ulugbekna: approximate calc - clean this up
        );
        return width;
    }
    static _createListWidget(container, candidateViewHeight, fontInfo) {
        const virtualDelegate = new class {
            getTemplateId(element) {
                return 'candidate';
            }
            getHeight(element) {
                return candidateViewHeight;
            }
        };
        const renderer = new class {
            constructor(){
                this.templateId = 'candidate';
            }
            renderTemplate(container) {
                return new $f42de4678eafddce$var$RenameCandidateView(container, fontInfo);
            }
            renderElement(candidate, index, templateData) {
                templateData.populate(candidate);
            }
            disposeTemplate(templateData) {
                templateData.dispose();
            }
        };
        return new (0, $dD2OW.List)('NewSymbolNameCandidates', container, virtualDelegate, [
            renderer
        ], {
            keyboardSupport: false,
            mouseSupport: true,
            multipleSelectionSupport: false
        });
    }
}
class $f42de4678eafddce$var$InputWithButton {
    constructor(){
        this._onDidInputChange = new (0, $5YaSO.Emitter)();
        this.onDidInputChange = this._onDidInputChange.event;
        this._disposables = new (0, $9cWcn.DisposableStore)();
    }
    get domNode() {
        if (!this._domNode) {
            this._domNode = document.createElement('div');
            this._domNode.className = 'rename-input-with-button';
            this._domNode.style.display = 'flex';
            this._domNode.style.flexDirection = 'row';
            this._domNode.style.alignItems = 'center';
            this._inputNode = document.createElement('input');
            this._inputNode.className = 'rename-input';
            this._inputNode.type = 'text';
            this._inputNode.style.border = 'none';
            this._inputNode.setAttribute('aria-label', $4dEdH.localize('renameAriaLabel', "Rename input. Type new name and press Enter to commit."));
            this._domNode.appendChild(this._inputNode);
            this._buttonNode = document.createElement('div');
            this._buttonNode.className = 'rename-suggestions-button';
            this._buttonNode.setAttribute('tabindex', '0');
            this._buttonGenHoverText = $4dEdH.localize('generateRenameSuggestionsButton', "Generate new name suggestions");
            this._buttonCancelHoverText = $4dEdH.localize('cancelRenameSuggestionsButton', "Cancel");
            this._buttonHover = (0, $j72nw.getBaseLayerHoverDelegate)().setupManagedHover((0, $b97Zr.getDefaultHoverDelegate)('element'), this._buttonNode, this._buttonGenHoverText);
            this._disposables.add(this._buttonHover);
            this._domNode.appendChild(this._buttonNode);
            // notify if selection changes to cancel request to rename-suggestion providers
            this._disposables.add($bDzmQ.addDisposableListener(this.input, $bDzmQ.EventType.INPUT, ()=>this._onDidInputChange.fire()));
            this._disposables.add($bDzmQ.addDisposableListener(this.input, $bDzmQ.EventType.KEY_DOWN, (e)=>{
                const keyEvent = new (0, $gV002.StandardKeyboardEvent)(e);
                if (keyEvent.keyCode === 15 /* KeyCode.LeftArrow */  || keyEvent.keyCode === 17 /* KeyCode.RightArrow */ ) this._onDidInputChange.fire();
            }));
            this._disposables.add($bDzmQ.addDisposableListener(this.input, $bDzmQ.EventType.CLICK, ()=>this._onDidInputChange.fire()));
            // focus "container" border instead of input box
            this._disposables.add($bDzmQ.addDisposableListener(this.input, $bDzmQ.EventType.FOCUS, ()=>{
                this.domNode.style.outlineWidth = '1px';
                this.domNode.style.outlineStyle = 'solid';
                this.domNode.style.outlineOffset = '-1px';
                this.domNode.style.outlineColor = 'var(--vscode-focusBorder)';
            }));
            this._disposables.add($bDzmQ.addDisposableListener(this.input, $bDzmQ.EventType.BLUR, ()=>{
                this.domNode.style.outline = 'none';
            }));
        }
        return this._domNode;
    }
    get input() {
        (0, $bxBg7.assertType)(this._inputNode);
        return this._inputNode;
    }
    get button() {
        (0, $bxBg7.assertType)(this._buttonNode);
        return this._buttonNode;
    }
    get buttonState() {
        return this._buttonState;
    }
    setSparkleButton() {
        this._buttonState = 'sparkle';
        this._sparkleIcon ??= (0, $6G2yS.renderIcon)((0, $awgRE.Codicon).sparkle);
        $bDzmQ.clearNode(this.button);
        this.button.appendChild(this._sparkleIcon);
        this.button.setAttribute('aria-label', 'Generating new name suggestions');
        this._buttonHover?.update(this._buttonGenHoverText);
        this.input.focus();
    }
    setStopButton() {
        this._buttonState = 'stop';
        this._stopIcon ??= (0, $6G2yS.renderIcon)((0, $awgRE.Codicon).primitiveSquare);
        $bDzmQ.clearNode(this.button);
        this.button.appendChild(this._stopIcon);
        this.button.setAttribute('aria-label', 'Cancel generating new name suggestions');
        this._buttonHover?.update(this._buttonCancelHoverText);
        this.input.focus();
    }
    dispose() {
        this._disposables.dispose();
    }
}
class $f42de4678eafddce$var$RenameCandidateView {
    static{
        this._PADDING = 2;
    }
    constructor(parent, fontInfo){
        this._domNode = document.createElement('div');
        this._domNode.className = 'rename-box rename-candidate';
        this._domNode.style.display = `flex`;
        this._domNode.style.columnGap = `5px`;
        this._domNode.style.alignItems = `center`;
        this._domNode.style.height = `${fontInfo.lineHeight}px`;
        this._domNode.style.padding = `${$f42de4678eafddce$var$RenameCandidateView._PADDING}px`;
        // @ulugbekna: needed to keep space when the `icon.style.display` is set to `none`
        const iconContainer = document.createElement('div');
        iconContainer.style.display = `flex`;
        iconContainer.style.alignItems = `center`;
        iconContainer.style.width = iconContainer.style.height = `${fontInfo.lineHeight * 0.8}px`;
        this._domNode.appendChild(iconContainer);
        this._icon = (0, $6G2yS.renderIcon)((0, $awgRE.Codicon).sparkle);
        this._icon.style.display = `none`;
        iconContainer.appendChild(this._icon);
        this._label = document.createElement('div');
        $84zMl.applyFontInfo(this._label, fontInfo);
        this._domNode.appendChild(this._label);
        parent.appendChild(this._domNode);
    }
    populate(value) {
        this._updateIcon(value);
        this._updateLabel(value);
    }
    _updateIcon(value) {
        const isAIGenerated = !!value.tags?.includes((0, $kzNQX.NewSymbolNameTag).AIGenerated);
        this._icon.style.display = isAIGenerated ? 'inherit' : 'none';
    }
    _updateLabel(value) {
        this._label.innerText = value.newSymbolName;
    }
    static getLayoutInfo({ lineHeight: lineHeight }) {
        const totalHeight = lineHeight + $f42de4678eafddce$var$RenameCandidateView._PADDING * 2 /* top & bottom padding */ ;
        return {
            totalHeight: totalHeight
        };
    }
    dispose() {}
}


var $6ef4e517c72138fa$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $6ef4e517c72138fa$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $6ef4e517c72138fa$var$RenameController_1;
class $6ef4e517c72138fa$var$RenameSkeleton {
    constructor(model, position, registry){
        this.model = model;
        this.position = position;
        this._providerRenameIdx = 0;
        this._providers = registry.ordered(model);
    }
    hasProvider() {
        return this._providers.length > 0;
    }
    async resolveRenameLocation(token) {
        const rejects = [];
        for(this._providerRenameIdx = 0; this._providerRenameIdx < this._providers.length; this._providerRenameIdx++){
            const provider = this._providers[this._providerRenameIdx];
            if (!provider.resolveRenameLocation) break;
            const res = await provider.resolveRenameLocation(this.model, this.position, token);
            if (!res) continue;
            if (res.rejectReason) {
                rejects.push(res.rejectReason);
                continue;
            }
            return res;
        }
        // we are here when no provider prepared a location which means we can
        // just rely on the word under cursor and start with the first provider
        this._providerRenameIdx = 0;
        const word = this.model.getWordAtPosition(this.position);
        if (!word) return {
            range: (0, $d00il.Range).fromPositions(this.position),
            text: '',
            rejectReason: rejects.length > 0 ? rejects.join('\n') : undefined
        };
        return {
            range: new (0, $d00il.Range)(this.position.lineNumber, word.startColumn, this.position.lineNumber, word.endColumn),
            text: word.word,
            rejectReason: rejects.length > 0 ? rejects.join('\n') : undefined
        };
    }
    async provideRenameEdits(newName, token) {
        return this._provideRenameEdits(newName, this._providerRenameIdx, [], token);
    }
    async _provideRenameEdits(newName, i, rejects, token) {
        const provider = this._providers[i];
        if (!provider) return {
            edits: [],
            rejectReason: rejects.join('\n')
        };
        const result = await provider.provideRenameEdits(this.model, this.position, newName, token);
        if (!result) return this._provideRenameEdits(newName, i + 1, rejects.concat($4dEdH.localize('no result', "No result.")), token);
        else if (result.rejectReason) return this._provideRenameEdits(newName, i + 1, rejects.concat(result.rejectReason), token);
        return result;
    }
}
async function $6ef4e517c72138fa$export$7ac989ec0c9c279(registry, model, position, newName) {
    const skeleton = new $6ef4e517c72138fa$var$RenameSkeleton(model, position, registry);
    const loc = await skeleton.resolveRenameLocation((0, $giPcZ.CancellationToken).None);
    if (loc?.rejectReason) return {
        edits: [],
        rejectReason: loc.rejectReason
    };
    return skeleton.provideRenameEdits(newName, (0, $giPcZ.CancellationToken).None);
}
// ---  register actions and commands
let $6ef4e517c72138fa$var$RenameController = class RenameController {
    static{
        $6ef4e517c72138fa$var$RenameController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.renameController';
    }
    static get(editor) {
        return editor.getContribution($6ef4e517c72138fa$var$RenameController_1.ID);
    }
    constructor(editor, _instaService, _notificationService, _bulkEditService, _progressService, _logService, _configService, _languageFeaturesService, _telemetryService){
        this.editor = editor;
        this._instaService = _instaService;
        this._notificationService = _notificationService;
        this._bulkEditService = _bulkEditService;
        this._progressService = _progressService;
        this._logService = _logService;
        this._configService = _configService;
        this._languageFeaturesService = _languageFeaturesService;
        this._telemetryService = _telemetryService;
        this._disposableStore = new (0, $9cWcn.DisposableStore)();
        this._cts = new (0, $giPcZ.CancellationTokenSource)();
        this._renameWidget = this._disposableStore.add(this._instaService.createInstance((0, $f42de4678eafddce$export$1f8bfaf864fdb80b), this.editor, [
            'acceptRenameInput',
            'acceptRenameInputWithPreview'
        ]));
    }
    dispose() {
        this._disposableStore.dispose();
        this._cts.dispose(true);
    }
    async run() {
        const trace = this._logService.trace.bind(this._logService, '[rename]');
        // set up cancellation token to prevent reentrant rename, this
        // is the parent to the resolve- and rename-tokens
        this._cts.dispose(true);
        this._cts = new (0, $giPcZ.CancellationTokenSource)();
        if (!this.editor.hasModel()) {
            trace('editor has no model');
            return undefined;
        }
        const position = this.editor.getPosition();
        const skeleton = new $6ef4e517c72138fa$var$RenameSkeleton(this.editor.getModel(), position, this._languageFeaturesService.renameProvider);
        if (!skeleton.hasProvider()) {
            trace('skeleton has no provider');
            return undefined;
        }
        // part 1 - resolve rename location
        const cts1 = new (0, $lgoyH.EditorStateCancellationTokenSource)(this.editor, 5 /* CodeEditorStateFlag.Value */ , undefined, this._cts.token);
        let loc;
        try {
            trace('resolving rename location');
            const resolveLocationOperation = skeleton.resolveRenameLocation(cts1.token);
            this._progressService.showWhile(resolveLocationOperation, 250);
            loc = await resolveLocationOperation;
            trace('resolved rename location');
        } catch (e) {
            if (e instanceof (0, $gPkHZ.CancellationError)) trace('resolve rename location cancelled', JSON.stringify(e, null, '\t'));
            else {
                trace('resolve rename location failed', e instanceof Error ? e : JSON.stringify(e, null, '\t'));
                if (typeof e === 'string' || (0, $iGmb0.isMarkdownString)(e)) (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this.editor)?.showMessage(e || $4dEdH.localize('resolveRenameLocationFailed', "An unknown error occurred while resolving rename location"), position);
            }
            return undefined;
        } finally{
            cts1.dispose();
        }
        if (!loc) {
            trace('returning early - no loc');
            return undefined;
        }
        if (loc.rejectReason) {
            trace(`returning early - rejected with reason: ${loc.rejectReason}`, loc.rejectReason);
            (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this.editor)?.showMessage(loc.rejectReason, position);
            return undefined;
        }
        if (cts1.token.isCancellationRequested) {
            trace('returning early - cts1 cancelled');
            return undefined;
        }
        // part 2 - do rename at location
        const cts2 = new (0, $lgoyH.EditorStateCancellationTokenSource)(this.editor, 5 /* CodeEditorStateFlag.Value */ , loc.range, this._cts.token);
        const model = this.editor.getModel(); // @ulugbekna: assumes editor still has a model, otherwise, cts1 should've been cancelled
        const newSymbolNamesProviders = this._languageFeaturesService.newSymbolNamesProvider.all(model);
        const resolvedNewSymbolnamesProviders = await Promise.all(newSymbolNamesProviders.map(async (p)=>[
                p,
                await p.supportsAutomaticNewSymbolNamesTriggerKind ?? false
            ]));
        const requestRenameSuggestions = (triggerKind, cts)=>{
            let providers = resolvedNewSymbolnamesProviders.slice();
            if (triggerKind === (0, $kzNQX.NewSymbolNameTriggerKind).Automatic) providers = providers.filter(([_, supportsAutomatic])=>supportsAutomatic);
            return providers.map(([p])=>p.provideNewSymbolNames(model, loc.range, triggerKind, cts));
        };
        trace('creating rename input field and awaiting its result');
        const supportPreview = this._bulkEditService.hasPreviewHandler() && this._configService.getValue(this.editor.getModel().uri, 'editor.rename.enablePreview');
        const inputFieldResult = await this._renameWidget.getInput(loc.range, loc.text, supportPreview, newSymbolNamesProviders.length > 0 ? requestRenameSuggestions : undefined, cts2);
        trace('received response from rename input field');
        if (newSymbolNamesProviders.length > 0) this._reportTelemetry(newSymbolNamesProviders.length, model.getLanguageId(), inputFieldResult);
        // no result, only hint to focus the editor or not
        if (typeof inputFieldResult === 'boolean') {
            trace(`returning early - rename input field response - ${inputFieldResult}`);
            if (inputFieldResult) this.editor.focus();
            cts2.dispose();
            return undefined;
        }
        this.editor.focus();
        trace('requesting rename edits');
        const renameOperation = (0, $6bXyA.raceCancellation)(skeleton.provideRenameEdits(inputFieldResult.newName, cts2.token), cts2.token).then(async (renameResult)=>{
            if (!renameResult) {
                trace('returning early - no rename edits result');
                return;
            }
            if (!this.editor.hasModel()) {
                trace('returning early - no model after rename edits are provided');
                return;
            }
            if (renameResult.rejectReason) {
                trace(`returning early - rejected with reason: ${renameResult.rejectReason}`);
                this._notificationService.info(renameResult.rejectReason);
                return;
            }
            // collapse selection to active end
            this.editor.setSelection((0, $d00il.Range).fromPositions(this.editor.getSelection().getPosition()));
            trace('applying edits');
            this._bulkEditService.apply(renameResult, {
                editor: this.editor,
                showPreview: inputFieldResult.wantsPreview,
                label: $4dEdH.localize('label', "Renaming '{0}' to '{1}'", loc?.text, inputFieldResult.newName),
                code: 'undoredo.rename',
                quotableLabel: $4dEdH.localize('quotableLabel', "Renaming {0} to {1}", loc?.text, inputFieldResult.newName),
                respectAutoSaveConfig: true
            }).then((result)=>{
                trace('edits applied');
                if (result.ariaSummary) (0, $aIbUW.alert)($4dEdH.localize('aria', "Successfully renamed '{0}' to '{1}'. Summary: {2}", loc.text, inputFieldResult.newName, result.ariaSummary));
            }).catch((err)=>{
                trace(`error when applying edits ${JSON.stringify(err, null, '\t')}`);
                this._notificationService.error($4dEdH.localize('rename.failedApply', "Rename failed to apply edits"));
                this._logService.error(err);
            });
        }, (err)=>{
            trace('error when providing rename edits', JSON.stringify(err, null, '\t'));
            this._notificationService.error($4dEdH.localize('rename.failed', "Rename failed to compute edits"));
            this._logService.error(err);
        }).finally(()=>{
            cts2.dispose();
        });
        trace('returning rename operation');
        this._progressService.showWhile(renameOperation, 250);
        return renameOperation;
    }
    acceptRenameInput(wantsPreview) {
        this._renameWidget.acceptInput(wantsPreview);
    }
    cancelRenameInput() {
        this._renameWidget.cancelInput(true, 'cancelRenameInput command');
    }
    focusNextRenameSuggestion() {
        this._renameWidget.focusNextRenameSuggestion();
    }
    focusPreviousRenameSuggestion() {
        this._renameWidget.focusPreviousRenameSuggestion();
    }
    _reportTelemetry(nRenameSuggestionProviders, languageId, inputFieldResult) {
        const value = typeof inputFieldResult === 'boolean' ? {
            kind: 'cancelled',
            languageId: languageId,
            nRenameSuggestionProviders: nRenameSuggestionProviders
        } : {
            kind: 'accepted',
            languageId: languageId,
            nRenameSuggestionProviders: nRenameSuggestionProviders,
            source: inputFieldResult.stats.source.k,
            nRenameSuggestions: inputFieldResult.stats.nRenameSuggestions,
            timeBeforeFirstInputFieldEdit: inputFieldResult.stats.timeBeforeFirstInputFieldEdit,
            wantsPreview: inputFieldResult.wantsPreview,
            nRenameSuggestionsInvocations: inputFieldResult.stats.nRenameSuggestionsInvocations,
            hadAutomaticRenameSuggestionsInvocation: inputFieldResult.stats.hadAutomaticRenameSuggestionsInvocation
        };
        this._telemetryService.publicLog2('renameInvokedEvent', value);
    }
};
$6ef4e517c72138fa$var$RenameController = $6ef4e517c72138fa$var$RenameController_1 = $6ef4e517c72138fa$var$__decorate([
    $6ef4e517c72138fa$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $6ef4e517c72138fa$var$__param(2, (0, $kCOKl.INotificationService)),
    $6ef4e517c72138fa$var$__param(3, (0, $d4p5R.IBulkEditService)),
    $6ef4e517c72138fa$var$__param(4, (0, $4E7vx.IEditorProgressService)),
    $6ef4e517c72138fa$var$__param(5, (0, $dvEeB.ILogService)),
    $6ef4e517c72138fa$var$__param(6, (0, $jx8dy.ITextResourceConfigurationService)),
    $6ef4e517c72138fa$var$__param(7, (0, $4J6fu.ILanguageFeaturesService)),
    $6ef4e517c72138fa$var$__param(8, (0, $lMGba.ITelemetryService))
], $6ef4e517c72138fa$var$RenameController);
class $6ef4e517c72138fa$export$9c8fe0f1407330da extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.rename',
            label: $4dEdH.localize('rename.label', "Rename Symbol"),
            alias: 'Rename Symbol',
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).writable, (0, $ibKGQ.EditorContextKeys).hasRenameProvider),
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 60 /* KeyCode.F2 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            contextMenuOpts: {
                group: '1_modification',
                order: 1.1
            }
        });
    }
    runCommand(accessor, args) {
        const editorService = accessor.get((0, $2Qfl0.ICodeEditorService));
        const [uri, pos] = Array.isArray(args) && args || [
            undefined,
            undefined
        ];
        if ((0, $5OJ54.URI).isUri(uri) && (0, $dcxQ7.Position).isIPosition(pos)) return editorService.openCodeEditor({
            resource: uri
        }, editorService.getActiveCodeEditor()).then((editor)=>{
            if (!editor) return;
            editor.setPosition(pos);
            editor.invokeWithinContext((accessor)=>{
                this.reportTelemetry(accessor, editor);
                return this.run(accessor, editor);
            });
        }, (0, $gPkHZ.onUnexpectedError));
        return super.runCommand(accessor, args);
    }
    run(accessor, editor) {
        const logService = accessor.get((0, $dvEeB.ILogService));
        const controller = $6ef4e517c72138fa$var$RenameController.get(editor);
        if (controller) {
            logService.trace('[RenameAction] got controller, running...');
            return controller.run();
        }
        logService.trace('[RenameAction] returning early - controller missing');
        return Promise.resolve();
    }
}
(0, $2iJTi.registerEditorContribution)($6ef4e517c72138fa$var$RenameController.ID, $6ef4e517c72138fa$var$RenameController, 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorAction)($6ef4e517c72138fa$export$9c8fe0f1407330da);
const $6ef4e517c72138fa$var$RenameCommand = (0, $2iJTi.EditorCommand).bindToContribution($6ef4e517c72138fa$var$RenameController.get);
(0, $2iJTi.registerEditorCommand)(new $6ef4e517c72138fa$var$RenameCommand({
    id: 'acceptRenameInput',
    precondition: (0, $f42de4678eafddce$export$af782c46022b2288),
    handler: (x)=>x.acceptRenameInput(false),
    kbOpts: {
        weight: 199,
        kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).focus, (0, $cxCeF.ContextKeyExpr).not('isComposing')),
        primary: 3 /* KeyCode.Enter */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $6ef4e517c72138fa$var$RenameCommand({
    id: 'acceptRenameInputWithPreview',
    precondition: (0, $cxCeF.ContextKeyExpr).and((0, $f42de4678eafddce$export$af782c46022b2288), (0, $cxCeF.ContextKeyExpr).has('config.editor.rename.enablePreview')),
    handler: (x)=>x.acceptRenameInput(true),
    kbOpts: {
        weight: 199,
        kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).focus, (0, $cxCeF.ContextKeyExpr).not('isComposing')),
        primary: 2051 /* KeyCode.Enter */ 
    }
}));
(0, $2iJTi.registerEditorCommand)(new $6ef4e517c72138fa$var$RenameCommand({
    id: 'cancelRenameInput',
    precondition: (0, $f42de4678eafddce$export$af782c46022b2288),
    handler: (x)=>x.cancelRenameInput(),
    kbOpts: {
        weight: 199,
        kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
        primary: 9 /* KeyCode.Escape */ ,
        secondary: [
            1033 /* KeyCode.Escape */ 
        ]
    }
}));
(0, $g4v7E.registerAction2)(class FocusNextRenameSuggestion extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'focusNextRenameSuggestion',
            title: {
                ...$4dEdH.localize2('focusNextRenameSuggestion', "Focus Next Rename Suggestion")
            },
            precondition: (0, $f42de4678eafddce$export$af782c46022b2288),
            keybinding: [
                {
                    primary: 18 /* KeyCode.DownArrow */ ,
                    weight: 199
                }
            ]
        });
    }
    run(accessor) {
        const currentEditor = accessor.get((0, $2Qfl0.ICodeEditorService)).getFocusedCodeEditor();
        if (!currentEditor) return;
        const controller = $6ef4e517c72138fa$var$RenameController.get(currentEditor);
        if (!controller) return;
        controller.focusNextRenameSuggestion();
    }
});
(0, $g4v7E.registerAction2)(class FocusPreviousRenameSuggestion extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'focusPreviousRenameSuggestion',
            title: {
                ...$4dEdH.localize2('focusPreviousRenameSuggestion', "Focus Previous Rename Suggestion")
            },
            precondition: (0, $f42de4678eafddce$export$af782c46022b2288),
            keybinding: [
                {
                    primary: 16 /* KeyCode.UpArrow */ ,
                    weight: 199
                }
            ]
        });
    }
    run(accessor) {
        const currentEditor = accessor.get((0, $2Qfl0.ICodeEditorService)).getFocusedCodeEditor();
        if (!currentEditor) return;
        const controller = $6ef4e517c72138fa$var$RenameController.get(currentEditor);
        if (!controller) return;
        controller.focusPreviousRenameSuggestion();
    }
});
// ---- api bridge command
(0, $2iJTi.registerModelAndPositionCommand)('_executeDocumentRenameProvider', function(accessor, model, position, ...args) {
    const [newName] = args;
    (0, $bxBg7.assertType)(typeof newName === 'string');
    const { renameProvider: renameProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    return $6ef4e517c72138fa$export$7ac989ec0c9c279(renameProvider, model, position, newName);
});
(0, $2iJTi.registerModelAndPositionCommand)('_executePrepareRename', async function(accessor, model, position) {
    const { renameProvider: renameProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const skeleton = new $6ef4e517c72138fa$var$RenameSkeleton(model, position, renameProvider);
    const loc = await skeleton.resolveRenameLocation((0, $giPcZ.CancellationToken).None);
    if (loc?.rejectReason) throw new Error(loc.rejectReason);
    return loc;
});
//todo@jrieken use editor options world
(0, $TezJS.Registry).as((0, $eWLlf.Extensions).Configuration).registerConfiguration({
    id: 'editor',
    properties: {
        'editor.rename.enablePreview': {
            scope: 5 /* ConfigurationScope.LANGUAGE_OVERRIDABLE */ ,
            description: $4dEdH.localize('enablePreview', "Enable/disable the ability to preview changes before renaming"),
            default: true,
            type: 'boolean'
        }
    }
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $1qkuR = parcelRequire("1qkuR");

var $91ntV = parcelRequire("91ntV");

var $zvLvK = parcelRequire("zvLvK");
var $615e852f83f9b0fa$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $615e852f83f9b0fa$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $615e852f83f9b0fa$export$193e2ca651996260 = class SectionHeaderDetector extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.sectionHeaderDetector';
    }
    constructor(editor, languageConfigurationService, editorWorkerService){
        super();
        this.editor = editor;
        this.languageConfigurationService = languageConfigurationService;
        this.editorWorkerService = editorWorkerService;
        this.decorations = this.editor.createDecorationsCollection();
        this.options = this.createOptions(editor.getOption(73 /* EditorOption.minimap */ ));
        this.computePromise = null;
        this.currentOccurrences = {};
        this._register(editor.onDidChangeModel((e)=>{
            this.currentOccurrences = {};
            this.options = this.createOptions(editor.getOption(73 /* EditorOption.minimap */ ));
            this.stop();
            this.computeSectionHeaders.schedule(0);
        }));
        this._register(editor.onDidChangeModelLanguage((e)=>{
            this.currentOccurrences = {};
            this.options = this.createOptions(editor.getOption(73 /* EditorOption.minimap */ ));
            this.stop();
            this.computeSectionHeaders.schedule(0);
        }));
        this._register(languageConfigurationService.onDidChange((e)=>{
            const editorLanguageId = this.editor.getModel()?.getLanguageId();
            if (editorLanguageId && e.affects(editorLanguageId)) {
                this.currentOccurrences = {};
                this.options = this.createOptions(editor.getOption(73 /* EditorOption.minimap */ ));
                this.stop();
                this.computeSectionHeaders.schedule(0);
            }
        }));
        this._register(editor.onDidChangeConfiguration((e)=>{
            if (this.options && !e.hasChanged(73 /* EditorOption.minimap */ )) return;
            this.options = this.createOptions(editor.getOption(73 /* EditorOption.minimap */ ));
            // Remove any links (for the getting disabled case)
            this.updateDecorations([]);
            // Stop any computation (for the getting disabled case)
            this.stop();
            // Start computing (for the getting enabled case)
            this.computeSectionHeaders.schedule(0);
        }));
        this._register(this.editor.onDidChangeModelContent((e)=>{
            this.computeSectionHeaders.schedule();
        }));
        this._register(editor.onDidChangeModelTokens((e)=>{
            if (!this.computeSectionHeaders.isScheduled()) this.computeSectionHeaders.schedule(1000);
        }));
        this.computeSectionHeaders = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>{
            this.findSectionHeaders();
        }, 250));
        this.computeSectionHeaders.schedule(0);
    }
    createOptions(minimap) {
        if (!minimap || !this.editor.hasModel()) return undefined;
        const languageId = this.editor.getModel().getLanguageId();
        if (!languageId) return undefined;
        const commentsConfiguration = this.languageConfigurationService.getLanguageConfiguration(languageId).comments;
        const foldingRules = this.languageConfigurationService.getLanguageConfiguration(languageId).foldingRules;
        if (!commentsConfiguration && !foldingRules?.markers) return undefined;
        return {
            foldingRules: foldingRules,
            findMarkSectionHeaders: minimap.showMarkSectionHeaders,
            findRegionSectionHeaders: minimap.showRegionSectionHeaders
        };
    }
    findSectionHeaders() {
        if (!this.editor.hasModel() || !this.options?.findMarkSectionHeaders && !this.options?.findRegionSectionHeaders) return;
        const model = this.editor.getModel();
        if (model.isDisposed() || model.isTooLargeForSyncing()) return;
        const modelVersionId = model.getVersionId();
        this.editorWorkerService.findSectionHeaders(model.uri, this.options).then((sectionHeaders)=>{
            if (model.isDisposed() || model.getVersionId() !== modelVersionId) // model changed in the meantime
            return;
            this.updateDecorations(sectionHeaders);
        });
    }
    updateDecorations(sectionHeaders) {
        const model = this.editor.getModel();
        if (model) // Remove all section headers that should be in comments and are not in comments
        sectionHeaders = sectionHeaders.filter((sectionHeader)=>{
            if (!sectionHeader.shouldBeInComments) return true;
            const validRange = model.validateRange(sectionHeader.range);
            const tokens = model.tokenization.getLineTokens(validRange.startLineNumber);
            const idx = tokens.findTokenIndexAtOffset(validRange.startColumn - 1);
            const tokenType = tokens.getStandardTokenType(idx);
            const languageId = tokens.getLanguageId(idx);
            return languageId === model.getLanguageId() && tokenType === 1 /* StandardTokenType.Comment */ ;
        });
        const oldDecorations = Object.values(this.currentOccurrences).map((occurrence)=>occurrence.decorationId);
        const newDecorations = sectionHeaders.map((sectionHeader)=>$615e852f83f9b0fa$var$decoration(sectionHeader));
        this.editor.changeDecorations((changeAccessor)=>{
            const decorations = changeAccessor.deltaDecorations(oldDecorations, newDecorations);
            this.currentOccurrences = {};
            for(let i = 0, len = decorations.length; i < len; i++){
                const occurrence = {
                    sectionHeader: sectionHeaders[i],
                    decorationId: decorations[i]
                };
                this.currentOccurrences[occurrence.decorationId] = occurrence;
            }
        });
    }
    stop() {
        this.computeSectionHeaders.cancel();
        if (this.computePromise) {
            this.computePromise.cancel();
            this.computePromise = null;
        }
    }
    dispose() {
        super.dispose();
        this.stop();
        this.decorations.clear();
    }
};
$615e852f83f9b0fa$export$193e2ca651996260 = $615e852f83f9b0fa$var$__decorate([
    $615e852f83f9b0fa$var$__param(1, (0, $1qkuR.ILanguageConfigurationService)),
    $615e852f83f9b0fa$var$__param(2, (0, $zvLvK.IEditorWorkerService))
], $615e852f83f9b0fa$export$193e2ca651996260);
function $615e852f83f9b0fa$var$decoration(sectionHeader) {
    return {
        range: sectionHeader.range,
        options: (0, $91ntV.ModelDecorationOptions).createDynamic({
            description: 'section-header',
            stickiness: 3 /* TrackedRangeStickiness.GrowsOnlyWhenTypingAfter */ ,
            collapseOnReplaceEdit: true,
            minimap: {
                color: undefined,
                position: 1 /* MinimapPosition.Inline */ ,
                sectionHeaderStyle: sectionHeader.hasSeparatorLine ? 2 /* MinimapSectionHeaderStyle.Underlined */  : 1 /* MinimapSectionHeaderStyle.Normal */ ,
                sectionHeaderText: sectionHeader.text
            }
        })
    };
}
(0, $2iJTi.registerEditorContribution)($615e852f83f9b0fa$export$193e2ca651996260.ID, $615e852f83f9b0fa$export$193e2ca651996260, 1 /* EditorContributionInstantiation.AfterFirstRender */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $gPkHZ = parcelRequire("gPkHZ");

var $cKKJT = parcelRequire("cKKJT");

var $35IZ9 = parcelRequire("35IZ9");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $azIPz = parcelRequire("azIPz");

var $9OYtR = parcelRequire("9OYtR");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $5OJ54 = parcelRequire("5OJ54");

var $cKKJT = parcelRequire("cKKJT");

var $8tcMz = parcelRequire("8tcMz");

var $bxBg7 = parcelRequire("bxBg7");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $aBZqH = parcelRequire("aBZqH");

var $lb0Ah = parcelRequire("lb0Ah");
function $eff0be134710488f$var$reverseEndianness(arr) {
    for(let i = 0, len = arr.length; i < len; i += 4){
        // flip bytes 0<->3 and 1<->2
        const b0 = arr[i + 0];
        const b1 = arr[i + 1];
        const b2 = arr[i + 2];
        const b3 = arr[i + 3];
        arr[i + 0] = b3;
        arr[i + 1] = b2;
        arr[i + 2] = b1;
        arr[i + 3] = b0;
    }
}
function $eff0be134710488f$var$toLittleEndianBuffer(arr) {
    const uint8Arr = new Uint8Array(arr.buffer, arr.byteOffset, arr.length * 4);
    if (!$lb0Ah.isLittleEndian()) // the byte order must be changed
    $eff0be134710488f$var$reverseEndianness(uint8Arr);
    return (0, $aBZqH.VSBuffer).wrap(uint8Arr);
}
function $eff0be134710488f$export$d6c04b1a640bd0b1(semanticTokens) {
    const dest = new Uint32Array($eff0be134710488f$var$encodeSemanticTokensDtoSize(semanticTokens));
    let offset = 0;
    dest[offset++] = semanticTokens.id;
    if (semanticTokens.type === 'full') {
        dest[offset++] = 1 /* EncodedSemanticTokensType.Full */ ;
        dest[offset++] = semanticTokens.data.length;
        dest.set(semanticTokens.data, offset);
        offset += semanticTokens.data.length;
    } else {
        dest[offset++] = 2 /* EncodedSemanticTokensType.Delta */ ;
        dest[offset++] = semanticTokens.deltas.length;
        for (const delta of semanticTokens.deltas){
            dest[offset++] = delta.start;
            dest[offset++] = delta.deleteCount;
            if (delta.data) {
                dest[offset++] = delta.data.length;
                dest.set(delta.data, offset);
                offset += delta.data.length;
            } else dest[offset++] = 0;
        }
    }
    return $eff0be134710488f$var$toLittleEndianBuffer(dest);
}
function $eff0be134710488f$var$encodeSemanticTokensDtoSize(semanticTokens) {
    let result = 0;
    result += 2 // type
    ;
    if (semanticTokens.type === 'full') result += 1 // data length
     + semanticTokens.data.length;
    else {
        result += 1 // delta count
        ;
        result += 3 // data length
         * semanticTokens.deltas.length;
        for (const delta of semanticTokens.deltas)if (delta.data) result += delta.data.length;
    }
    return result;
}



var $d00il = parcelRequire("d00il");

var $4J6fu = parcelRequire("4J6fu");
function $024bf54097550cc6$export$bd0819681cac06e1(v) {
    return v && !!v.data;
}
function $024bf54097550cc6$export$41663b01d6c86b05(v) {
    return v && Array.isArray(v.edits);
}
class $024bf54097550cc6$export$7d694cfe8df5573f {
    constructor(provider, tokens, error){
        this.provider = provider;
        this.tokens = tokens;
        this.error = error;
    }
}
function $024bf54097550cc6$export$d6f4be1572786809(registry, model) {
    return registry.has(model);
}
function $024bf54097550cc6$var$getDocumentSemanticTokensProviders(registry, model) {
    const groups = registry.orderedGroups(model);
    return groups.length > 0 ? groups[0] : [];
}
async function $024bf54097550cc6$export$31dec852250cda0b(registry, model, lastProvider, lastResultId, token) {
    const providers = $024bf54097550cc6$var$getDocumentSemanticTokensProviders(registry, model);
    // Get tokens from all providers at the same time.
    const results = await Promise.all(providers.map(async (provider)=>{
        let result;
        let error = null;
        try {
            result = await provider.provideDocumentSemanticTokens(model, provider === lastProvider ? lastResultId : null, token);
        } catch (err) {
            error = err;
            result = null;
        }
        if (!result || !$024bf54097550cc6$export$bd0819681cac06e1(result) && !$024bf54097550cc6$export$41663b01d6c86b05(result)) result = null;
        return new $024bf54097550cc6$export$7d694cfe8df5573f(provider, result, error);
    }));
    // Try to return the first result with actual tokens or
    // the first result which threw an error (!!)
    for (const result of results){
        if (result.error) throw result.error;
        if (result.tokens) return result;
    }
    // Return the first result, even if it doesn't have tokens
    if (results.length > 0) return results[0];
    return null;
}
function $024bf54097550cc6$var$_getDocumentSemanticTokensProviderHighestGroup(registry, model) {
    const result = registry.orderedGroups(model);
    return result.length > 0 ? result[0] : null;
}
class $024bf54097550cc6$var$DocumentRangeSemanticTokensResult {
    constructor(provider, tokens){
        this.provider = provider;
        this.tokens = tokens;
    }
}
function $024bf54097550cc6$export$8cb19d5cb534fdb3(providers, model) {
    return providers.has(model);
}
function $024bf54097550cc6$var$getDocumentRangeSemanticTokensProviders(providers, model) {
    const groups = providers.orderedGroups(model);
    return groups.length > 0 ? groups[0] : [];
}
async function $024bf54097550cc6$export$6a0060f9abd62b68(registry, model, range, token) {
    const providers = $024bf54097550cc6$var$getDocumentRangeSemanticTokensProviders(registry, model);
    // Get tokens from all providers at the same time.
    const results = await Promise.all(providers.map(async (provider)=>{
        let result;
        try {
            result = await provider.provideDocumentRangeSemanticTokens(model, range, token);
        } catch (err) {
            (0, $gPkHZ.onUnexpectedExternalError)(err);
            result = null;
        }
        if (!result || !$024bf54097550cc6$export$bd0819681cac06e1(result)) result = null;
        return new $024bf54097550cc6$var$DocumentRangeSemanticTokensResult(provider, result);
    }));
    // Try to return the first result with actual tokens
    for (const result of results){
        if (result.tokens) return result;
    }
    // Return the first result, even if it doesn't have tokens
    if (results.length > 0) return results[0];
    return null;
}
(0, $8tcMz.CommandsRegistry).registerCommand('_provideDocumentSemanticTokensLegend', async (accessor, ...args)=>{
    const [uri] = args;
    (0, $bxBg7.assertType)(uri instanceof (0, $5OJ54.URI));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(uri);
    if (!model) return undefined;
    const { documentSemanticTokensProvider: documentSemanticTokensProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const providers = $024bf54097550cc6$var$_getDocumentSemanticTokensProviderHighestGroup(documentSemanticTokensProvider, model);
    if (!providers) // there is no provider => fall back to a document range semantic tokens provider
    return accessor.get((0, $8tcMz.ICommandService)).executeCommand('_provideDocumentRangeSemanticTokensLegend', uri);
    return providers[0].getLegend();
});
(0, $8tcMz.CommandsRegistry).registerCommand('_provideDocumentSemanticTokens', async (accessor, ...args)=>{
    const [uri] = args;
    (0, $bxBg7.assertType)(uri instanceof (0, $5OJ54.URI));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(uri);
    if (!model) return undefined;
    const { documentSemanticTokensProvider: documentSemanticTokensProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    if (!$024bf54097550cc6$export$d6f4be1572786809(documentSemanticTokensProvider, model)) // there is no provider => fall back to a document range semantic tokens provider
    return accessor.get((0, $8tcMz.ICommandService)).executeCommand('_provideDocumentRangeSemanticTokens', uri, model.getFullModelRange());
    const r = await $024bf54097550cc6$export$31dec852250cda0b(documentSemanticTokensProvider, model, null, null, (0, $giPcZ.CancellationToken).None);
    if (!r) return undefined;
    const { provider: provider, tokens: tokens } = r;
    if (!tokens || !$024bf54097550cc6$export$bd0819681cac06e1(tokens)) return undefined;
    const buff = (0, $eff0be134710488f$export$d6c04b1a640bd0b1)({
        id: 0,
        type: 'full',
        data: tokens.data
    });
    if (tokens.resultId) provider.releaseDocumentSemanticTokens(tokens.resultId);
    return buff;
});
(0, $8tcMz.CommandsRegistry).registerCommand('_provideDocumentRangeSemanticTokensLegend', async (accessor, ...args)=>{
    const [uri, range] = args;
    (0, $bxBg7.assertType)(uri instanceof (0, $5OJ54.URI));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(uri);
    if (!model) return undefined;
    const { documentRangeSemanticTokensProvider: documentRangeSemanticTokensProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const providers = $024bf54097550cc6$var$getDocumentRangeSemanticTokensProviders(documentRangeSemanticTokensProvider, model);
    if (providers.length === 0) // no providers
    return undefined;
    if (providers.length === 1) // straight forward case, just a single provider
    return providers[0].getLegend();
    if (!range || !(0, $d00il.Range).isIRange(range)) {
        // if no range is provided, we cannot support multiple providers
        // as we cannot fall back to the one which would give results
        // => return the first legend for backwards compatibility and print a warning
        console.warn(`provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in`);
        return providers[0].getLegend();
    }
    const result = await $024bf54097550cc6$export$6a0060f9abd62b68(documentRangeSemanticTokensProvider, model, (0, $d00il.Range).lift(range), (0, $giPcZ.CancellationToken).None);
    if (!result) return undefined;
    return result.provider.getLegend();
});
(0, $8tcMz.CommandsRegistry).registerCommand('_provideDocumentRangeSemanticTokens', async (accessor, ...args)=>{
    const [uri, range] = args;
    (0, $bxBg7.assertType)(uri instanceof (0, $5OJ54.URI));
    (0, $bxBg7.assertType)((0, $d00il.Range).isIRange(range));
    const model = accessor.get((0, $cKKJT.IModelService)).getModel(uri);
    if (!model) return undefined;
    const { documentRangeSemanticTokensProvider: documentRangeSemanticTokensProvider } = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const result = await $024bf54097550cc6$export$6a0060f9abd62b68(documentRangeSemanticTokensProvider, model, (0, $d00il.Range).lift(range), (0, $giPcZ.CancellationToken).None);
    if (!result || !result.tokens) // there is no provider or it didn't return tokens
    return undefined;
    return (0, $eff0be134710488f$export$d6c04b1a640bd0b1)({
        id: 0,
        type: 'full',
        data: result.tokens.data
    });
});



var $goG89 = parcelRequire("goG89");

var $eUQTM = parcelRequire("eUQTM");

var $4J6fu = parcelRequire("4J6fu");

var $cCxrr = parcelRequire("cCxrr");

var $54y8R = parcelRequire("54y8R");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ const $65439f42c14310c1$export$5e3280d83a547546 = 'editor.semanticHighlighting';
function $65439f42c14310c1$export$a60f69ab4fa2304d(model, themeService, configurationService) {
    const setting = configurationService.getValue($65439f42c14310c1$export$5e3280d83a547546, {
        overrideIdentifier: model.getLanguageId(),
        resource: model.uri
    })?.enabled;
    if (typeof setting === 'boolean') return setting;
    return themeService.getColorTheme().semanticHighlighting;
}


var $e0781ee4406c0092$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $e0781ee4406c0092$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $e0781ee4406c0092$var$ModelSemanticColoring_1;
let $e0781ee4406c0092$export$48f6834a04261a90 = class DocumentSemanticTokensFeature extends (0, $9cWcn.Disposable) {
    constructor(semanticTokensStylingService, modelService, themeService, configurationService, languageFeatureDebounceService, languageFeaturesService){
        super();
        this._watchers = Object.create(null);
        const register = (model)=>{
            this._watchers[model.uri.toString()] = new $e0781ee4406c0092$var$ModelSemanticColoring(model, semanticTokensStylingService, themeService, languageFeatureDebounceService, languageFeaturesService);
        };
        const deregister = (model, modelSemanticColoring)=>{
            modelSemanticColoring.dispose();
            delete this._watchers[model.uri.toString()];
        };
        const handleSettingOrThemeChange = ()=>{
            for (const model of modelService.getModels()){
                const curr = this._watchers[model.uri.toString()];
                if ((0, $65439f42c14310c1$export$a60f69ab4fa2304d)(model, themeService, configurationService)) {
                    if (!curr) register(model);
                } else if (curr) deregister(model, curr);
            }
        };
        modelService.getModels().forEach((model)=>{
            if ((0, $65439f42c14310c1$export$a60f69ab4fa2304d)(model, themeService, configurationService)) register(model);
        });
        this._register(modelService.onModelAdded((model)=>{
            if ((0, $65439f42c14310c1$export$a60f69ab4fa2304d)(model, themeService, configurationService)) register(model);
        }));
        this._register(modelService.onModelRemoved((model)=>{
            const curr = this._watchers[model.uri.toString()];
            if (curr) deregister(model, curr);
        }));
        this._register(configurationService.onDidChangeConfiguration((e)=>{
            if (e.affectsConfiguration((0, $65439f42c14310c1$export$5e3280d83a547546))) handleSettingOrThemeChange();
        }));
        this._register(themeService.onDidColorThemeChange(handleSettingOrThemeChange));
    }
    dispose() {
        // Dispose all watchers
        for (const watcher of Object.values(this._watchers))watcher.dispose();
        super.dispose();
    }
};
$e0781ee4406c0092$export$48f6834a04261a90 = $e0781ee4406c0092$var$__decorate([
    $e0781ee4406c0092$var$__param(0, (0, $cCxrr.ISemanticTokensStylingService)),
    $e0781ee4406c0092$var$__param(1, (0, $cKKJT.IModelService)),
    $e0781ee4406c0092$var$__param(2, (0, $azIPz.IThemeService)),
    $e0781ee4406c0092$var$__param(3, (0, $35IZ9.IConfigurationService)),
    $e0781ee4406c0092$var$__param(4, (0, $goG89.ILanguageFeatureDebounceService)),
    $e0781ee4406c0092$var$__param(5, (0, $4J6fu.ILanguageFeaturesService))
], $e0781ee4406c0092$export$48f6834a04261a90);
let $e0781ee4406c0092$var$ModelSemanticColoring = class ModelSemanticColoring extends (0, $9cWcn.Disposable) {
    static{
        $e0781ee4406c0092$var$ModelSemanticColoring_1 = this;
    }
    static{
        this.REQUEST_MIN_DELAY = 300;
    }
    static{
        this.REQUEST_MAX_DELAY = 2000;
    }
    constructor(model, _semanticTokensStylingService, themeService, languageFeatureDebounceService, languageFeaturesService){
        super();
        this._semanticTokensStylingService = _semanticTokensStylingService;
        this._isDisposed = false;
        this._model = model;
        this._provider = languageFeaturesService.documentSemanticTokensProvider;
        this._debounceInformation = languageFeatureDebounceService.for(this._provider, 'DocumentSemanticTokens', {
            min: $e0781ee4406c0092$var$ModelSemanticColoring_1.REQUEST_MIN_DELAY,
            max: $e0781ee4406c0092$var$ModelSemanticColoring_1.REQUEST_MAX_DELAY
        });
        this._fetchDocumentSemanticTokens = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._fetchDocumentSemanticTokensNow(), $e0781ee4406c0092$var$ModelSemanticColoring_1.REQUEST_MIN_DELAY));
        this._currentDocumentResponse = null;
        this._currentDocumentRequestCancellationTokenSource = null;
        this._documentProvidersChangeListeners = [];
        this._providersChangedDuringRequest = false;
        this._register(this._model.onDidChangeContent(()=>{
            if (!this._fetchDocumentSemanticTokens.isScheduled()) this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));
        }));
        this._register(this._model.onDidChangeAttached(()=>{
            if (!this._fetchDocumentSemanticTokens.isScheduled()) this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));
        }));
        this._register(this._model.onDidChangeLanguage(()=>{
            // clear any outstanding state
            if (this._currentDocumentResponse) {
                this._currentDocumentResponse.dispose();
                this._currentDocumentResponse = null;
            }
            if (this._currentDocumentRequestCancellationTokenSource) {
                this._currentDocumentRequestCancellationTokenSource.cancel();
                this._currentDocumentRequestCancellationTokenSource = null;
            }
            this._setDocumentSemanticTokens(null, null, null, []);
            this._fetchDocumentSemanticTokens.schedule(0);
        }));
        const bindDocumentChangeListeners = ()=>{
            (0, $9cWcn.dispose)(this._documentProvidersChangeListeners);
            this._documentProvidersChangeListeners = [];
            for (const provider of this._provider.all(model))if (typeof provider.onDidChange === 'function') this._documentProvidersChangeListeners.push(provider.onDidChange(()=>{
                if (this._currentDocumentRequestCancellationTokenSource) {
                    // there is already a request running,
                    this._providersChangedDuringRequest = true;
                    return;
                }
                this._fetchDocumentSemanticTokens.schedule(0);
            }));
        };
        bindDocumentChangeListeners();
        this._register(this._provider.onDidChange(()=>{
            bindDocumentChangeListeners();
            this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));
        }));
        this._register(themeService.onDidColorThemeChange((_)=>{
            // clear out existing tokens
            this._setDocumentSemanticTokens(null, null, null, []);
            this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));
        }));
        this._fetchDocumentSemanticTokens.schedule(0);
    }
    dispose() {
        if (this._currentDocumentResponse) {
            this._currentDocumentResponse.dispose();
            this._currentDocumentResponse = null;
        }
        if (this._currentDocumentRequestCancellationTokenSource) {
            this._currentDocumentRequestCancellationTokenSource.cancel();
            this._currentDocumentRequestCancellationTokenSource = null;
        }
        (0, $9cWcn.dispose)(this._documentProvidersChangeListeners);
        this._documentProvidersChangeListeners = [];
        this._setDocumentSemanticTokens(null, null, null, []);
        this._isDisposed = true;
        super.dispose();
    }
    _fetchDocumentSemanticTokensNow() {
        if (this._currentDocumentRequestCancellationTokenSource) // there is already a request running, let it finish...
        return;
        if (!(0, $024bf54097550cc6$export$d6f4be1572786809)(this._provider, this._model)) {
            // there is no provider
            if (this._currentDocumentResponse) // there are semantic tokens set
            this._model.tokenization.setSemanticTokens(null, false);
            return;
        }
        if (!this._model.isAttachedToEditor()) // this document is not visible, there is no need to fetch semantic tokens for it
        return;
        const cancellationTokenSource = new (0, $giPcZ.CancellationTokenSource)();
        const lastProvider = this._currentDocumentResponse ? this._currentDocumentResponse.provider : null;
        const lastResultId = this._currentDocumentResponse ? this._currentDocumentResponse.resultId || null : null;
        const request = (0, $024bf54097550cc6$export$31dec852250cda0b)(this._provider, this._model, lastProvider, lastResultId, cancellationTokenSource.token);
        this._currentDocumentRequestCancellationTokenSource = cancellationTokenSource;
        this._providersChangedDuringRequest = false;
        const pendingChanges = [];
        const contentChangeListener = this._model.onDidChangeContent((e)=>{
            pendingChanges.push(e);
        });
        const sw = new (0, $eUQTM.StopWatch)(false);
        request.then((res)=>{
            this._debounceInformation.update(this._model, sw.elapsed());
            this._currentDocumentRequestCancellationTokenSource = null;
            contentChangeListener.dispose();
            if (!res) this._setDocumentSemanticTokens(null, null, null, pendingChanges);
            else {
                const { provider: provider, tokens: tokens } = res;
                const styling = this._semanticTokensStylingService.getStyling(provider);
                this._setDocumentSemanticTokens(provider, tokens || null, styling, pendingChanges);
            }
        }, (err)=>{
            const isExpectedError = err && ($gPkHZ.isCancellationError(err) || typeof err.message === 'string' && err.message.indexOf('busy') !== -1);
            if (!isExpectedError) $gPkHZ.onUnexpectedError(err);
            // Semantic tokens eats up all errors and considers errors to mean that the result is temporarily not available
            // The API does not have a special error kind to express this...
            this._currentDocumentRequestCancellationTokenSource = null;
            contentChangeListener.dispose();
            if (pendingChanges.length > 0 || this._providersChangedDuringRequest) // More changes occurred while the request was running
            {
                if (!this._fetchDocumentSemanticTokens.isScheduled()) this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));
            }
        });
    }
    static _copy(src, srcOffset, dest, destOffset, length) {
        // protect against overflows
        length = Math.min(length, dest.length - destOffset, src.length - srcOffset);
        for(let i = 0; i < length; i++)dest[destOffset + i] = src[srcOffset + i];
    }
    _setDocumentSemanticTokens(provider, tokens, styling, pendingChanges) {
        const currentResponse = this._currentDocumentResponse;
        const rescheduleIfNeeded = ()=>{
            if ((pendingChanges.length > 0 || this._providersChangedDuringRequest) && !this._fetchDocumentSemanticTokens.isScheduled()) this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));
        };
        if (this._currentDocumentResponse) {
            this._currentDocumentResponse.dispose();
            this._currentDocumentResponse = null;
        }
        if (this._isDisposed) {
            // disposed!
            if (provider && tokens) provider.releaseDocumentSemanticTokens(tokens.resultId);
            return;
        }
        if (!provider || !styling) {
            this._model.tokenization.setSemanticTokens(null, false);
            return;
        }
        if (!tokens) {
            this._model.tokenization.setSemanticTokens(null, true);
            rescheduleIfNeeded();
            return;
        }
        if ((0, $024bf54097550cc6$export$41663b01d6c86b05)(tokens)) {
            if (!currentResponse) {
                // not possible!
                this._model.tokenization.setSemanticTokens(null, true);
                return;
            }
            if (tokens.edits.length === 0) // nothing to do!
            tokens = {
                resultId: tokens.resultId,
                data: currentResponse.data
            };
            else {
                let deltaLength = 0;
                for (const edit of tokens.edits)deltaLength += (edit.data ? edit.data.length : 0) - edit.deleteCount;
                const srcData = currentResponse.data;
                const destData = new Uint32Array(srcData.length + deltaLength);
                let srcLastStart = srcData.length;
                let destLastStart = destData.length;
                for(let i = tokens.edits.length - 1; i >= 0; i--){
                    const edit = tokens.edits[i];
                    if (edit.start > srcData.length) {
                        styling.warnInvalidEditStart(currentResponse.resultId, tokens.resultId, i, edit.start, srcData.length);
                        // The edits are invalid and there's no way to recover
                        this._model.tokenization.setSemanticTokens(null, true);
                        return;
                    }
                    const copyCount = srcLastStart - (edit.start + edit.deleteCount);
                    if (copyCount > 0) {
                        $e0781ee4406c0092$var$ModelSemanticColoring_1._copy(srcData, srcLastStart - copyCount, destData, destLastStart - copyCount, copyCount);
                        destLastStart -= copyCount;
                    }
                    if (edit.data) {
                        $e0781ee4406c0092$var$ModelSemanticColoring_1._copy(edit.data, 0, destData, destLastStart - edit.data.length, edit.data.length);
                        destLastStart -= edit.data.length;
                    }
                    srcLastStart = edit.start;
                }
                if (srcLastStart > 0) $e0781ee4406c0092$var$ModelSemanticColoring_1._copy(srcData, 0, destData, 0, srcLastStart);
                tokens = {
                    resultId: tokens.resultId,
                    data: destData
                };
            }
        }
        if ((0, $024bf54097550cc6$export$bd0819681cac06e1)(tokens)) {
            this._currentDocumentResponse = new $e0781ee4406c0092$var$SemanticTokensResponse(provider, tokens.resultId, tokens.data);
            const result = (0, $9OYtR.toMultilineTokens2)(tokens, styling, this._model.getLanguageId());
            // Adjust incoming semantic tokens
            if (pendingChanges.length > 0) // More changes occurred while the request was running
            // We need to:
            // 1. Adjust incoming semantic tokens
            // 2. Request them again
            for (const change of pendingChanges){
                for (const area of result)for (const singleChange of change.changes)area.applyEdit(singleChange.range, singleChange.text);
            }
            this._model.tokenization.setSemanticTokens(result, true);
        } else this._model.tokenization.setSemanticTokens(null, true);
        rescheduleIfNeeded();
    }
};
$e0781ee4406c0092$var$ModelSemanticColoring = $e0781ee4406c0092$var$ModelSemanticColoring_1 = $e0781ee4406c0092$var$__decorate([
    $e0781ee4406c0092$var$__param(1, (0, $cCxrr.ISemanticTokensStylingService)),
    $e0781ee4406c0092$var$__param(2, (0, $azIPz.IThemeService)),
    $e0781ee4406c0092$var$__param(3, (0, $goG89.ILanguageFeatureDebounceService)),
    $e0781ee4406c0092$var$__param(4, (0, $4J6fu.ILanguageFeaturesService))
], $e0781ee4406c0092$var$ModelSemanticColoring);
class $e0781ee4406c0092$var$SemanticTokensResponse {
    constructor(provider, resultId, data){
        this.provider = provider;
        this.resultId = resultId;
        this.data = data;
    }
    dispose() {
        this.provider.releaseDocumentSemanticTokens(this.resultId);
    }
}
(0, $54y8R.registerEditorFeature)($e0781ee4406c0092$export$48f6834a04261a90);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");



var $9OYtR = parcelRequire("9OYtR");

var $35IZ9 = parcelRequire("35IZ9");

var $azIPz = parcelRequire("azIPz");

var $goG89 = parcelRequire("goG89");

var $eUQTM = parcelRequire("eUQTM");

var $4J6fu = parcelRequire("4J6fu");

var $cCxrr = parcelRequire("cCxrr");
var $4989e78c8ff48e31$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $4989e78c8ff48e31$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $4989e78c8ff48e31$export$8b0332f5b373d1af = class ViewportSemanticTokensContribution extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.viewportSemanticTokens';
    }
    constructor(editor, _semanticTokensStylingService, _themeService, _configurationService, languageFeatureDebounceService, languageFeaturesService){
        super();
        this._semanticTokensStylingService = _semanticTokensStylingService;
        this._themeService = _themeService;
        this._configurationService = _configurationService;
        this._editor = editor;
        this._provider = languageFeaturesService.documentRangeSemanticTokensProvider;
        this._debounceInformation = languageFeatureDebounceService.for(this._provider, 'DocumentRangeSemanticTokens', {
            min: 100,
            max: 500
        });
        this._tokenizeViewport = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._tokenizeViewportNow(), 100));
        this._outstandingRequests = [];
        const scheduleTokenizeViewport = ()=>{
            if (this._editor.hasModel()) this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()));
        };
        this._register(this._editor.onDidScrollChange(()=>{
            scheduleTokenizeViewport();
        }));
        this._register(this._editor.onDidChangeModel(()=>{
            this._cancelAll();
            scheduleTokenizeViewport();
        }));
        this._register(this._editor.onDidChangeModelContent((e)=>{
            this._cancelAll();
            scheduleTokenizeViewport();
        }));
        this._register(this._provider.onDidChange(()=>{
            this._cancelAll();
            scheduleTokenizeViewport();
        }));
        this._register(this._configurationService.onDidChangeConfiguration((e)=>{
            if (e.affectsConfiguration((0, $65439f42c14310c1$export$5e3280d83a547546))) {
                this._cancelAll();
                scheduleTokenizeViewport();
            }
        }));
        this._register(this._themeService.onDidColorThemeChange(()=>{
            this._cancelAll();
            scheduleTokenizeViewport();
        }));
        scheduleTokenizeViewport();
    }
    _cancelAll() {
        for (const request of this._outstandingRequests)request.cancel();
        this._outstandingRequests = [];
    }
    _removeOutstandingRequest(req) {
        for(let i = 0, len = this._outstandingRequests.length; i < len; i++)if (this._outstandingRequests[i] === req) {
            this._outstandingRequests.splice(i, 1);
            return;
        }
    }
    _tokenizeViewportNow() {
        if (!this._editor.hasModel()) return;
        const model = this._editor.getModel();
        if (model.tokenization.hasCompleteSemanticTokens()) return;
        if (!(0, $65439f42c14310c1$export$a60f69ab4fa2304d)(model, this._themeService, this._configurationService)) {
            if (model.tokenization.hasSomeSemanticTokens()) model.tokenization.setSemanticTokens(null, false);
            return;
        }
        if (!(0, $024bf54097550cc6$export$8cb19d5cb534fdb3)(this._provider, model)) {
            if (model.tokenization.hasSomeSemanticTokens()) model.tokenization.setSemanticTokens(null, false);
            return;
        }
        const visibleRanges = this._editor.getVisibleRangesPlusViewportAboveBelow();
        this._outstandingRequests = this._outstandingRequests.concat(visibleRanges.map((range)=>this._requestRange(model, range)));
    }
    _requestRange(model, range) {
        const requestVersionId = model.getVersionId();
        const request = (0, $6bXyA.createCancelablePromise)((token)=>Promise.resolve((0, $024bf54097550cc6$export$6a0060f9abd62b68)(this._provider, model, range, token)));
        const sw = new (0, $eUQTM.StopWatch)(false);
        request.then((r)=>{
            this._debounceInformation.update(model, sw.elapsed());
            if (!r || !r.tokens || model.isDisposed() || model.getVersionId() !== requestVersionId) return;
            const { provider: provider, tokens: result } = r;
            const styling = this._semanticTokensStylingService.getStyling(provider);
            model.tokenization.setPartialSemanticTokens(range, (0, $9OYtR.toMultilineTokens2)(result, styling, model.getLanguageId()));
        }).then(()=>this._removeOutstandingRequest(request), ()=>this._removeOutstandingRequest(request));
        return request;
    }
};
$4989e78c8ff48e31$export$8b0332f5b373d1af = $4989e78c8ff48e31$var$__decorate([
    $4989e78c8ff48e31$var$__param(1, (0, $cCxrr.ISemanticTokensStylingService)),
    $4989e78c8ff48e31$var$__param(2, (0, $azIPz.IThemeService)),
    $4989e78c8ff48e31$var$__param(3, (0, $35IZ9.IConfigurationService)),
    $4989e78c8ff48e31$var$__param(4, (0, $goG89.ILanguageFeatureDebounceService)),
    $4989e78c8ff48e31$var$__param(5, (0, $4J6fu.ILanguageFeaturesService))
], $4989e78c8ff48e31$export$8b0332f5b373d1af);
(0, $2iJTi.registerEditorContribution)($4989e78c8ff48e31$export$8b0332f5b373d1af.ID, $4989e78c8ff48e31$export$8b0332f5b373d1af, 1 /* EditorContributionInstantiation.AfterFirstRender */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $2iJTi = parcelRequire("2iJTi");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $ibKGQ = parcelRequire("ibKGQ");

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $jcr1R = parcelRequire("jcr1R");

var $d00il = parcelRequire("d00il");
class $42731654133363ec$export$ef5b42c27450f48c {
    constructor(selectSubwords = true){
        this.selectSubwords = selectSubwords;
    }
    provideSelectionRanges(model, positions) {
        const result = [];
        for (const position of positions){
            const bucket = [];
            result.push(bucket);
            if (this.selectSubwords) this._addInWordRanges(bucket, model, position);
            this._addWordRanges(bucket, model, position);
            this._addWhitespaceLine(bucket, model, position);
            bucket.push({
                range: model.getFullModelRange()
            });
        }
        return result;
    }
    _addInWordRanges(bucket, model, pos) {
        const obj = model.getWordAtPosition(pos);
        if (!obj) return;
        const { word: word, startColumn: startColumn } = obj;
        const offset = pos.column - startColumn;
        let start = offset;
        let end = offset;
        let lastCh = 0;
        // LEFT anchor (start)
        for(; start >= 0; start--){
            const ch = word.charCodeAt(start);
            if (start !== offset && (ch === 95 /* CharCode.Underline */  || ch === 45 /* CharCode.Dash */ )) break;
            else if ((0, $jcr1R.isLowerAsciiLetter)(ch) && (0, $jcr1R.isUpperAsciiLetter)(lastCh)) break;
            lastCh = ch;
        }
        start += 1;
        // RIGHT anchor (end)
        for(; end < word.length; end++){
            const ch = word.charCodeAt(end);
            if ((0, $jcr1R.isUpperAsciiLetter)(ch) && (0, $jcr1R.isLowerAsciiLetter)(lastCh)) break;
            else if (ch === 95 /* CharCode.Underline */  || ch === 45 /* CharCode.Dash */ ) break;
            lastCh = ch;
        }
        if (start < end) bucket.push({
            range: new (0, $d00il.Range)(pos.lineNumber, startColumn + start, pos.lineNumber, startColumn + end)
        });
    }
    _addWordRanges(bucket, model, pos) {
        const word = model.getWordAtPosition(pos);
        if (word) bucket.push({
            range: new (0, $d00il.Range)(pos.lineNumber, word.startColumn, pos.lineNumber, word.endColumn)
        });
    }
    _addWhitespaceLine(bucket, model, pos) {
        if (model.getLineLength(pos.lineNumber) > 0 && model.getLineFirstNonWhitespaceColumn(pos.lineNumber) === 0 && model.getLineLastNonWhitespaceColumn(pos.lineNumber) === 0) bucket.push({
            range: new (0, $d00il.Range)(pos.lineNumber, 1, pos.lineNumber, model.getLineMaxColumn(pos.lineNumber))
        });
    }
}



var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");

var $8tcMz = parcelRequire("8tcMz");

var $4J6fu = parcelRequire("4J6fu");

var $aTkrt = parcelRequire("aTkrt");

var $bxBg7 = parcelRequire("bxBg7");

var $5OJ54 = parcelRequire("5OJ54");
var $ec7b25fb1552e6ce$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $ec7b25fb1552e6ce$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $ec7b25fb1552e6ce$var$SmartSelectController_1;
class $ec7b25fb1552e6ce$var$SelectionRanges {
    constructor(index, ranges){
        this.index = index;
        this.ranges = ranges;
    }
    mov(fwd) {
        const index = this.index + (fwd ? 1 : -1);
        if (index < 0 || index >= this.ranges.length) return this;
        const res = new $ec7b25fb1552e6ce$var$SelectionRanges(index, this.ranges);
        if (res.ranges[index].equalsRange(this.ranges[this.index])) // next range equals this range, retry with next-next
        return res.mov(fwd);
        return res;
    }
}
let $ec7b25fb1552e6ce$export$be0a247cb48b69ee = class SmartSelectController {
    static{
        $ec7b25fb1552e6ce$var$SmartSelectController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.smartSelectController';
    }
    static get(editor) {
        return editor.getContribution($ec7b25fb1552e6ce$var$SmartSelectController_1.ID);
    }
    constructor(_editor, _languageFeaturesService){
        this._editor = _editor;
        this._languageFeaturesService = _languageFeaturesService;
        this._ignoreSelection = false;
    }
    dispose() {
        this._selectionListener?.dispose();
    }
    async run(forward) {
        if (!this._editor.hasModel()) return;
        const selections = this._editor.getSelections();
        const model = this._editor.getModel();
        if (!this._state) await $ec7b25fb1552e6ce$export$ade1e921564bf339(this._languageFeaturesService.selectionRangeProvider, model, selections.map((s)=>s.getPosition()), this._editor.getOption(114 /* EditorOption.smartSelect */ ), (0, $giPcZ.CancellationToken).None).then((ranges)=>{
            if (!$kJ8UG.isNonEmptyArray(ranges) || ranges.length !== selections.length) // invalid result
            return;
            if (!this._editor.hasModel() || !$kJ8UG.equals(this._editor.getSelections(), selections, (a, b)=>a.equalsSelection(b))) // invalid editor state
            return;
            for(let i = 0; i < ranges.length; i++){
                ranges[i] = ranges[i].filter((range)=>{
                    // filter ranges inside the selection
                    return range.containsPosition(selections[i].getStartPosition()) && range.containsPosition(selections[i].getEndPosition());
                });
                // prepend current selection
                ranges[i].unshift(selections[i]);
            }
            this._state = ranges.map((ranges)=>new $ec7b25fb1552e6ce$var$SelectionRanges(0, ranges));
            // listen to caret move and forget about state
            this._selectionListener?.dispose();
            this._selectionListener = this._editor.onDidChangeCursorPosition(()=>{
                if (!this._ignoreSelection) {
                    this._selectionListener?.dispose();
                    this._state = undefined;
                }
            });
        });
        if (!this._state) // no state
        return;
        this._state = this._state.map((state)=>state.mov(forward));
        const newSelections = this._state.map((state)=>(0, $jzicX.Selection).fromPositions(state.ranges[state.index].getStartPosition(), state.ranges[state.index].getEndPosition()));
        this._ignoreSelection = true;
        try {
            this._editor.setSelections(newSelections);
        } finally{
            this._ignoreSelection = false;
        }
    }
};
$ec7b25fb1552e6ce$export$be0a247cb48b69ee = $ec7b25fb1552e6ce$var$SmartSelectController_1 = $ec7b25fb1552e6ce$var$__decorate([
    $ec7b25fb1552e6ce$var$__param(1, (0, $4J6fu.ILanguageFeaturesService))
], $ec7b25fb1552e6ce$export$be0a247cb48b69ee);
class $ec7b25fb1552e6ce$var$AbstractSmartSelect extends (0, $2iJTi.EditorAction) {
    constructor(forward, opts){
        super(opts);
        this._forward = forward;
    }
    async run(_accessor, editor) {
        const controller = $ec7b25fb1552e6ce$export$be0a247cb48b69ee.get(editor);
        if (controller) await controller.run(this._forward);
    }
}
class $ec7b25fb1552e6ce$var$GrowSelectionAction extends $ec7b25fb1552e6ce$var$AbstractSmartSelect {
    constructor(){
        super(true, {
            id: 'editor.action.smartSelect.expand',
            label: $4dEdH.localize('smartSelect.expand', "Expand Selection"),
            alias: 'Expand Selection',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1553 /* KeyCode.RightArrow */ ,
                mac: {
                    primary: 3345 /* KeyCode.RightArrow */ ,
                    secondary: [
                        1297 /* KeyCode.RightArrow */ 
                    ]
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '1_basic',
                title: $4dEdH.localize({
                    key: 'miSmartSelectGrow',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Expand Selection"),
                order: 2
            }
        });
    }
}
// renamed command id
(0, $8tcMz.CommandsRegistry).registerCommandAlias('editor.action.smartSelect.grow', 'editor.action.smartSelect.expand');
class $ec7b25fb1552e6ce$var$ShrinkSelectionAction extends $ec7b25fb1552e6ce$var$AbstractSmartSelect {
    constructor(){
        super(false, {
            id: 'editor.action.smartSelect.shrink',
            label: $4dEdH.localize('smartSelect.shrink', "Shrink Selection"),
            alias: 'Shrink Selection',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1551 /* KeyCode.LeftArrow */ ,
                mac: {
                    primary: 3343 /* KeyCode.LeftArrow */ ,
                    secondary: [
                        1295 /* KeyCode.LeftArrow */ 
                    ]
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            menuOpts: {
                menuId: (0, $g4v7E.MenuId).MenubarSelectionMenu,
                group: '1_basic',
                title: $4dEdH.localize({
                    key: 'miSmartSelectShrink',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Shrink Selection"),
                order: 3
            }
        });
    }
}
(0, $2iJTi.registerEditorContribution)($ec7b25fb1552e6ce$export$be0a247cb48b69ee.ID, $ec7b25fb1552e6ce$export$be0a247cb48b69ee, 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorAction)($ec7b25fb1552e6ce$var$GrowSelectionAction);
(0, $2iJTi.registerEditorAction)($ec7b25fb1552e6ce$var$ShrinkSelectionAction);
async function $ec7b25fb1552e6ce$export$ade1e921564bf339(registry, model, positions, options, token) {
    const providers = registry.all(model).concat(new (0, $42731654133363ec$export$ef5b42c27450f48c)(options.selectSubwords)); // ALWAYS have word based selection range
    if (providers.length === 1) // add word selection and bracket selection when no provider exists
    providers.unshift(new (0, $f704c2158239256f$export$aa5c9041294ca4c8)());
    const work = [];
    const allRawRanges = [];
    for (const provider of providers)work.push(Promise.resolve(provider.provideSelectionRanges(model, positions, token)).then((allProviderRanges)=>{
        if ($kJ8UG.isNonEmptyArray(allProviderRanges) && allProviderRanges.length === positions.length) for(let i = 0; i < positions.length; i++){
            if (!allRawRanges[i]) allRawRanges[i] = [];
            for (const oneProviderRanges of allProviderRanges[i])if ((0, $d00il.Range).isIRange(oneProviderRanges.range) && (0, $d00il.Range).containsPosition(oneProviderRanges.range, positions[i])) allRawRanges[i].push((0, $d00il.Range).lift(oneProviderRanges.range));
        }
    }, (0, $gPkHZ.onUnexpectedExternalError)));
    await Promise.all(work);
    return allRawRanges.map((oneRawRanges)=>{
        if (oneRawRanges.length === 0) return [];
        // sort all by start/end position
        oneRawRanges.sort((a, b)=>{
            if ((0, $dcxQ7.Position).isBefore(a.getStartPosition(), b.getStartPosition())) return 1;
            else if ((0, $dcxQ7.Position).isBefore(b.getStartPosition(), a.getStartPosition())) return -1;
            else if ((0, $dcxQ7.Position).isBefore(a.getEndPosition(), b.getEndPosition())) return -1;
            else if ((0, $dcxQ7.Position).isBefore(b.getEndPosition(), a.getEndPosition())) return 1;
            else return 0;
        });
        // remove ranges that don't contain the former range or that are equal to the
        // former range
        const oneRanges = [];
        let last;
        for (const range of oneRawRanges)if (!last || (0, $d00il.Range).containsRange(range, last) && !(0, $d00il.Range).equalsRange(range, last)) {
            oneRanges.push(range);
            last = range;
        }
        if (!options.selectLeadingAndTrailingWhitespace) return oneRanges;
        // add ranges that expand trivia at line starts and ends whenever a range
        // wraps onto the a new line
        const oneRangesWithTrivia = [
            oneRanges[0]
        ];
        for(let i = 1; i < oneRanges.length; i++){
            const prev = oneRanges[i - 1];
            const cur = oneRanges[i];
            if (cur.startLineNumber !== prev.startLineNumber || cur.endLineNumber !== prev.endLineNumber) {
                // add line/block range without leading/failing whitespace
                const rangeNoWhitespace = new (0, $d00il.Range)(prev.startLineNumber, model.getLineFirstNonWhitespaceColumn(prev.startLineNumber), prev.endLineNumber, model.getLineLastNonWhitespaceColumn(prev.endLineNumber));
                if (rangeNoWhitespace.containsRange(prev) && !rangeNoWhitespace.equalsRange(prev) && cur.containsRange(rangeNoWhitespace) && !cur.equalsRange(rangeNoWhitespace)) oneRangesWithTrivia.push(rangeNoWhitespace);
                // add line/block range
                const rangeFull = new (0, $d00il.Range)(prev.startLineNumber, 1, prev.endLineNumber, model.getLineMaxColumn(prev.endLineNumber));
                if (rangeFull.containsRange(prev) && !rangeFull.equalsRange(rangeNoWhitespace) && cur.containsRange(rangeFull) && !cur.equalsRange(rangeFull)) oneRangesWithTrivia.push(rangeFull);
            }
            oneRangesWithTrivia.push(cur);
        }
        return oneRangesWithTrivia;
    });
}
(0, $8tcMz.CommandsRegistry).registerCommand('_executeSelectionRangeProvider', async function(accessor, ...args) {
    const [resource, positions] = args;
    (0, $bxBg7.assertType)((0, $5OJ54.URI).isUri(resource));
    const registry = accessor.get((0, $4J6fu.ILanguageFeaturesService)).selectionRangeProvider;
    const reference = await accessor.get((0, $aTkrt.ITextModelService)).createModelReference(resource);
    try {
        return $ec7b25fb1552e6ce$export$ade1e921564bf339(registry, reference.object.textEditorModel, positions, {
            selectLeadingAndTrailingWhitespace: true,
            selectSubwords: true
        }, (0, $giPcZ.CancellationToken).None);
    } finally{
        reference.dispose();
    }
});



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $4dEdH = parcelRequire("4dEdH");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4dEdH = parcelRequire("4dEdH");
const $9d226d95e7e9efd2$export$e1e795cef0e670e6 = Object.freeze({
    View: (0, $4dEdH.localize2)('view', 'View'),
    Help: (0, $4dEdH.localize2)('help', 'Help'),
    Test: (0, $4dEdH.localize2)('test', 'Test'),
    File: (0, $4dEdH.localize2)('file', 'File'),
    Preferences: (0, $4dEdH.localize2)('preferences', 'Preferences'),
    Developer: (0, $4dEdH.localize2)({
        key: 'developer',
        comment: [
            'A developer on Code itself or someone diagnosing issues in Code'
        ]
    }, "Developer")
});



var $g4v7E = parcelRequire("g4v7E");

var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");

var $ibKGQ = parcelRequire("ibKGQ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $4J6fu = parcelRequire("4J6fu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $i8wPi = parcelRequire("i8wPi");

var $kJ8UG = parcelRequire("kJ8UG");

var $9cWcn = parcelRequire("9cWcn");

var $5rADe = parcelRequire("5rADe");


var $eK9Ey = parcelRequire("eK9Ey");


var $dcxQ7 = parcelRequire("dcxQ7");

var $deseY = parcelRequire("deseY");

var $k6oYA = parcelRequire("k6oYA");

var $edrMT = parcelRequire("edrMT");

class $467930aefba59039$export$bad5990dbe231ca3 {
    constructor(startLineNumbers, endLineNumbers, lastLineRelativePosition, showEndForLine = null){
        this.startLineNumbers = startLineNumbers;
        this.endLineNumbers = endLineNumbers;
        this.lastLineRelativePosition = lastLineRelativePosition;
        this.showEndForLine = showEndForLine;
    }
    equals(other) {
        return !!other && this.lastLineRelativePosition === other.lastLineRelativePosition && this.showEndForLine === other.showEndForLine && (0, $kJ8UG.equals)(this.startLineNumbers, other.startLineNumbers) && (0, $kJ8UG.equals)(this.endLineNumbers, other.endLineNumbers);
    }
    static get Empty() {
        return new $467930aefba59039$export$bad5990dbe231ca3([], [], 0);
    }
}
const $467930aefba59039$var$_ttPolicy = (0, $i8wPi.createTrustedTypesPolicy)('stickyScrollViewLayer', {
    createHTML: (value)=>value
});
const $467930aefba59039$var$STICKY_INDEX_ATTR = 'data-sticky-line-index';
const $467930aefba59039$var$STICKY_IS_LINE_ATTR = 'data-sticky-is-line';
const $467930aefba59039$var$STICKY_IS_LINE_NUMBER_ATTR = 'data-sticky-is-line-number';
const $467930aefba59039$var$STICKY_IS_FOLDING_ICON_ATTR = 'data-sticky-is-folding-icon';
class $467930aefba59039$export$9891ea470f0c2cea extends (0, $9cWcn.Disposable) {
    constructor(_editor){
        super();
        this._editor = _editor;
        this._foldingIconStore = new (0, $9cWcn.DisposableStore)();
        this._rootDomNode = document.createElement('div');
        this._lineNumbersDomNode = document.createElement('div');
        this._linesDomNodeScrollable = document.createElement('div');
        this._linesDomNode = document.createElement('div');
        this._lineHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ );
        this._renderedStickyLines = [];
        this._lineNumbers = [];
        this._lastLineRelativePosition = 0;
        this._minContentWidthInPx = 0;
        this._isOnGlyphMargin = false;
        this._lineNumbersDomNode.className = 'sticky-widget-line-numbers';
        this._lineNumbersDomNode.setAttribute('role', 'none');
        this._linesDomNode.className = 'sticky-widget-lines';
        this._linesDomNode.setAttribute('role', 'list');
        this._linesDomNodeScrollable.className = 'sticky-widget-lines-scrollable';
        this._linesDomNodeScrollable.appendChild(this._linesDomNode);
        this._rootDomNode.className = 'sticky-widget';
        this._rootDomNode.classList.toggle('peek', _editor instanceof (0, $205d91d7661de01d$export$3c7efbd913d316d0));
        this._rootDomNode.appendChild(this._lineNumbersDomNode);
        this._rootDomNode.appendChild(this._linesDomNodeScrollable);
        const updateScrollLeftPosition = ()=>{
            this._linesDomNode.style.left = this._editor.getOption(116 /* EditorOption.stickyScroll */ ).scrollWithEditor ? `-${this._editor.getScrollLeft()}px` : '0px';
        };
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(116 /* EditorOption.stickyScroll */ )) updateScrollLeftPosition();
            if (e.hasChanged(67 /* EditorOption.lineHeight */ )) this._lineHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ );
        }));
        this._register(this._editor.onDidScrollChange((e)=>{
            if (e.scrollLeftChanged) updateScrollLeftPosition();
            if (e.scrollWidthChanged) this._updateWidgetWidth();
        }));
        this._register(this._editor.onDidChangeModel(()=>{
            updateScrollLeftPosition();
            this._updateWidgetWidth();
        }));
        this._register(this._foldingIconStore);
        updateScrollLeftPosition();
        this._register(this._editor.onDidLayoutChange((e)=>{
            this._updateWidgetWidth();
        }));
        this._updateWidgetWidth();
    }
    get lineNumbers() {
        return this._lineNumbers;
    }
    get lineNumberCount() {
        return this._lineNumbers.length;
    }
    getRenderedStickyLine(lineNumber) {
        return this._renderedStickyLines.find((stickyLine)=>stickyLine.lineNumber === lineNumber);
    }
    getCurrentLines() {
        return this._lineNumbers;
    }
    setState(_state, foldingModel, _rebuildFromLine) {
        if (_rebuildFromLine === undefined && (!this._previousState && !_state || this._previousState && this._previousState.equals(_state))) return;
        const isWidgetHeightZero = this._isWidgetHeightZero(_state);
        const state = isWidgetHeightZero ? undefined : _state;
        const rebuildFromLine = isWidgetHeightZero ? 0 : this._findLineToRebuildWidgetFrom(_state, _rebuildFromLine);
        this._renderRootNode(state, foldingModel, rebuildFromLine);
        this._previousState = _state;
    }
    _isWidgetHeightZero(state) {
        if (!state) return true;
        const futureWidgetHeight = state.startLineNumbers.length * this._lineHeight + state.lastLineRelativePosition;
        if (futureWidgetHeight > 0) {
            this._lastLineRelativePosition = state.lastLineRelativePosition;
            const lineNumbers = [
                ...state.startLineNumbers
            ];
            if (state.showEndForLine !== null) lineNumbers[state.showEndForLine] = state.endLineNumbers[state.showEndForLine];
            this._lineNumbers = lineNumbers;
        } else {
            this._lastLineRelativePosition = 0;
            this._lineNumbers = [];
        }
        return futureWidgetHeight === 0;
    }
    _findLineToRebuildWidgetFrom(state, _rebuildFromLine) {
        if (!state || !this._previousState) return 0;
        if (_rebuildFromLine !== undefined) return _rebuildFromLine;
        const previousState = this._previousState;
        const indexOfLinesAlreadyRendered = state.startLineNumbers.findIndex((startLineNumber)=>!previousState.startLineNumbers.includes(startLineNumber));
        return indexOfLinesAlreadyRendered === -1 ? 0 : indexOfLinesAlreadyRendered;
    }
    _updateWidgetWidth() {
        const layoutInfo = this._editor.getLayoutInfo();
        const lineNumbersWidth = layoutInfo.contentLeft;
        this._lineNumbersDomNode.style.width = `${lineNumbersWidth}px`;
        this._linesDomNodeScrollable.style.setProperty('--vscode-editorStickyScroll-scrollableWidth', `${this._editor.getScrollWidth() - layoutInfo.verticalScrollbarWidth}px`);
        this._rootDomNode.style.width = `${layoutInfo.width - layoutInfo.verticalScrollbarWidth}px`;
    }
    _clearStickyLinesFromLine(clearFromLine) {
        this._foldingIconStore.clear();
        // Removing only the lines that need to be rerendered
        for(let i = clearFromLine; i < this._renderedStickyLines.length; i++){
            const stickyLine = this._renderedStickyLines[i];
            stickyLine.lineNumberDomNode.remove();
            stickyLine.lineDomNode.remove();
        }
        // Keep the lines that need to be updated
        this._renderedStickyLines = this._renderedStickyLines.slice(0, clearFromLine);
        this._rootDomNode.style.display = 'none';
    }
    _useFoldingOpacityTransition(requireTransitions) {
        this._lineNumbersDomNode.style.setProperty('--vscode-editorStickyScroll-foldingOpacityTransition', `opacity ${requireTransitions ? 0.5 : 0}s`);
    }
    _setFoldingIconsVisibility(allVisible) {
        for (const line of this._renderedStickyLines){
            const foldingIcon = line.foldingIcon;
            if (!foldingIcon) continue;
            foldingIcon.setVisible(allVisible ? true : foldingIcon.isCollapsed);
        }
    }
    async _renderRootNode(state, foldingModel, rebuildFromLine) {
        this._clearStickyLinesFromLine(rebuildFromLine);
        if (!state) return;
        // For existing sticky lines update the top and z-index
        for (const stickyLine of this._renderedStickyLines)this._updateTopAndZIndexOfStickyLine(stickyLine);
        // For new sticky lines
        const layoutInfo = this._editor.getLayoutInfo();
        const linesToRender = this._lineNumbers.slice(rebuildFromLine);
        for (const [index, line] of linesToRender.entries()){
            const stickyLine = this._renderChildNode(index + rebuildFromLine, line, foldingModel, layoutInfo);
            if (!stickyLine) continue;
            this._linesDomNode.appendChild(stickyLine.lineDomNode);
            this._lineNumbersDomNode.appendChild(stickyLine.lineNumberDomNode);
            this._renderedStickyLines.push(stickyLine);
        }
        if (foldingModel) {
            this._setFoldingHoverListeners();
            this._useFoldingOpacityTransition(!this._isOnGlyphMargin);
        }
        const widgetHeight = this._lineNumbers.length * this._lineHeight + this._lastLineRelativePosition;
        this._rootDomNode.style.display = 'block';
        this._lineNumbersDomNode.style.height = `${widgetHeight}px`;
        this._linesDomNodeScrollable.style.height = `${widgetHeight}px`;
        this._rootDomNode.style.height = `${widgetHeight}px`;
        this._rootDomNode.style.marginLeft = '0px';
        this._minContentWidthInPx = Math.max(...this._renderedStickyLines.map((l)=>l.scrollWidth)) + layoutInfo.verticalScrollbarWidth;
        this._editor.layoutOverlayWidget(this);
    }
    _setFoldingHoverListeners() {
        const showFoldingControls = this._editor.getOption(111 /* EditorOption.showFoldingControls */ );
        if (showFoldingControls !== 'mouseover') return;
        this._foldingIconStore.add($bDzmQ.addDisposableListener(this._lineNumbersDomNode, $bDzmQ.EventType.MOUSE_ENTER, ()=>{
            this._isOnGlyphMargin = true;
            this._setFoldingIconsVisibility(true);
        }));
        this._foldingIconStore.add($bDzmQ.addDisposableListener(this._lineNumbersDomNode, $bDzmQ.EventType.MOUSE_LEAVE, ()=>{
            this._isOnGlyphMargin = false;
            this._useFoldingOpacityTransition(true);
            this._setFoldingIconsVisibility(false);
        }));
    }
    _renderChildNode(index, line, foldingModel, layoutInfo) {
        const viewModel = this._editor._getViewModel();
        if (!viewModel) return;
        const viewLineNumber = viewModel.coordinatesConverter.convertModelPositionToViewPosition(new (0, $dcxQ7.Position)(line, 1)).lineNumber;
        const lineRenderingData = viewModel.getViewLineRenderingData(viewLineNumber);
        const lineNumberOption = this._editor.getOption(68 /* EditorOption.lineNumbers */ );
        let actualInlineDecorations;
        try {
            actualInlineDecorations = (0, $k6oYA.LineDecoration).filter(lineRenderingData.inlineDecorations, viewLineNumber, lineRenderingData.minColumn, lineRenderingData.maxColumn);
        } catch (err) {
            actualInlineDecorations = [];
        }
        const renderLineInput = new (0, $edrMT.RenderLineInput)(true, true, lineRenderingData.content, lineRenderingData.continuesWithWrappedLine, lineRenderingData.isBasicASCII, lineRenderingData.containsRTL, 0, lineRenderingData.tokens, actualInlineDecorations, lineRenderingData.tabSize, lineRenderingData.startVisibleColumn, 1, 1, 1, 500, 'none', true, true, null);
        const sb = new (0, $deseY.StringBuilder)(2000);
        const renderOutput = (0, $edrMT.renderViewLine)(renderLineInput, sb);
        let newLine;
        if ($467930aefba59039$var$_ttPolicy) newLine = $467930aefba59039$var$_ttPolicy.createHTML(sb.build());
        else newLine = sb.build();
        const lineHTMLNode = document.createElement('span');
        lineHTMLNode.setAttribute($467930aefba59039$var$STICKY_INDEX_ATTR, String(index));
        lineHTMLNode.setAttribute($467930aefba59039$var$STICKY_IS_LINE_ATTR, '');
        lineHTMLNode.setAttribute('role', 'listitem');
        lineHTMLNode.tabIndex = 0;
        lineHTMLNode.className = 'sticky-line-content';
        lineHTMLNode.classList.add(`stickyLine${line}`);
        lineHTMLNode.style.lineHeight = `${this._lineHeight}px`;
        lineHTMLNode.innerHTML = newLine;
        const lineNumberHTMLNode = document.createElement('span');
        lineNumberHTMLNode.setAttribute($467930aefba59039$var$STICKY_INDEX_ATTR, String(index));
        lineNumberHTMLNode.setAttribute($467930aefba59039$var$STICKY_IS_LINE_NUMBER_ATTR, '');
        lineNumberHTMLNode.className = 'sticky-line-number';
        lineNumberHTMLNode.style.lineHeight = `${this._lineHeight}px`;
        const lineNumbersWidth = layoutInfo.contentLeft;
        lineNumberHTMLNode.style.width = `${lineNumbersWidth}px`;
        const innerLineNumberHTML = document.createElement('span');
        if (lineNumberOption.renderType === 1 /* RenderLineNumbersType.On */  || lineNumberOption.renderType === 3 /* RenderLineNumbersType.Interval */  && line % 10 === 0) innerLineNumberHTML.innerText = line.toString();
        else if (lineNumberOption.renderType === 2 /* RenderLineNumbersType.Relative */ ) innerLineNumberHTML.innerText = Math.abs(line - this._editor.getPosition().lineNumber).toString();
        innerLineNumberHTML.className = 'sticky-line-number-inner';
        innerLineNumberHTML.style.lineHeight = `${this._lineHeight}px`;
        innerLineNumberHTML.style.width = `${layoutInfo.lineNumbersWidth}px`;
        innerLineNumberHTML.style.paddingLeft = `${layoutInfo.lineNumbersLeft}px`;
        lineNumberHTMLNode.appendChild(innerLineNumberHTML);
        const foldingIcon = this._renderFoldingIconForLine(foldingModel, line);
        if (foldingIcon) lineNumberHTMLNode.appendChild(foldingIcon.domNode);
        this._editor.applyFontInfo(lineHTMLNode);
        this._editor.applyFontInfo(innerLineNumberHTML);
        lineNumberHTMLNode.style.lineHeight = `${this._lineHeight}px`;
        lineHTMLNode.style.lineHeight = `${this._lineHeight}px`;
        lineNumberHTMLNode.style.height = `${this._lineHeight}px`;
        lineHTMLNode.style.height = `${this._lineHeight}px`;
        const renderedLine = new $467930aefba59039$var$RenderedStickyLine(index, line, lineHTMLNode, lineNumberHTMLNode, foldingIcon, renderOutput.characterMapping, lineHTMLNode.scrollWidth);
        return this._updateTopAndZIndexOfStickyLine(renderedLine);
    }
    _updateTopAndZIndexOfStickyLine(stickyLine) {
        const index = stickyLine.index;
        const lineHTMLNode = stickyLine.lineDomNode;
        const lineNumberHTMLNode = stickyLine.lineNumberDomNode;
        const isLastLine = index === this._lineNumbers.length - 1;
        const lastLineZIndex = '0';
        const intermediateLineZIndex = '1';
        lineHTMLNode.style.zIndex = isLastLine ? lastLineZIndex : intermediateLineZIndex;
        lineNumberHTMLNode.style.zIndex = isLastLine ? lastLineZIndex : intermediateLineZIndex;
        const lastLineTop = `${index * this._lineHeight + this._lastLineRelativePosition + (stickyLine.foldingIcon?.isCollapsed ? 1 : 0)}px`;
        const intermediateLineTop = `${index * this._lineHeight}px`;
        lineHTMLNode.style.top = isLastLine ? lastLineTop : intermediateLineTop;
        lineNumberHTMLNode.style.top = isLastLine ? lastLineTop : intermediateLineTop;
        return stickyLine;
    }
    _renderFoldingIconForLine(foldingModel, line) {
        const showFoldingControls = this._editor.getOption(111 /* EditorOption.showFoldingControls */ );
        if (!foldingModel || showFoldingControls === 'never') return;
        const foldingRegions = foldingModel.regions;
        const indexOfFoldingRegion = foldingRegions.findRange(line);
        const startLineNumber = foldingRegions.getStartLineNumber(indexOfFoldingRegion);
        const isFoldingScope = line === startLineNumber;
        if (!isFoldingScope) return;
        const isCollapsed = foldingRegions.isCollapsed(indexOfFoldingRegion);
        const foldingIcon = new $467930aefba59039$var$StickyFoldingIcon(isCollapsed, startLineNumber, foldingRegions.getEndLineNumber(indexOfFoldingRegion), this._lineHeight);
        foldingIcon.setVisible(this._isOnGlyphMargin ? true : isCollapsed || showFoldingControls === 'always');
        foldingIcon.domNode.setAttribute($467930aefba59039$var$STICKY_IS_FOLDING_ICON_ATTR, '');
        return foldingIcon;
    }
    getId() {
        return 'editor.contrib.stickyScrollWidget';
    }
    getDomNode() {
        return this._rootDomNode;
    }
    getPosition() {
        return {
            preference: 2 /* OverlayWidgetPositionPreference.TOP_CENTER */ ,
            stackOridinal: 10
        };
    }
    getMinContentWidthInPx() {
        return this._minContentWidthInPx;
    }
    focusLineWithIndex(index) {
        if (0 <= index && index < this._renderedStickyLines.length) this._renderedStickyLines[index].lineDomNode.focus();
    }
    /**
     * Given a leaf dom node, tries to find the editor position.
     */ getEditorPositionFromNode(spanDomNode) {
        if (!spanDomNode || spanDomNode.children.length > 0) // This is not a leaf node
        return null;
        const renderedStickyLine = this._getRenderedStickyLineFromChildDomNode(spanDomNode);
        if (!renderedStickyLine) return null;
        const column = (0, $eK9Ey.getColumnOfNodeOffset)(renderedStickyLine.characterMapping, spanDomNode, 0);
        return new (0, $dcxQ7.Position)(renderedStickyLine.lineNumber, column);
    }
    getLineNumberFromChildDomNode(domNode) {
        return this._getRenderedStickyLineFromChildDomNode(domNode)?.lineNumber ?? null;
    }
    _getRenderedStickyLineFromChildDomNode(domNode) {
        const index = this.getLineIndexFromChildDomNode(domNode);
        if (index === null || index < 0 || index >= this._renderedStickyLines.length) return null;
        return this._renderedStickyLines[index];
    }
    /**
     * Given a child dom node, tries to find the line number attribute that was stored in the node.
     * @returns the attribute value or null if none is found.
     */ getLineIndexFromChildDomNode(domNode) {
        const lineIndex = this._getAttributeValue(domNode, $467930aefba59039$var$STICKY_INDEX_ATTR);
        return lineIndex ? parseInt(lineIndex, 10) : null;
    }
    /**
     * Given a child dom node, tries to find if it is (contained in) a sticky line.
     * @returns a boolean.
     */ isInStickyLine(domNode) {
        const isInLine = this._getAttributeValue(domNode, $467930aefba59039$var$STICKY_IS_LINE_ATTR);
        return isInLine !== undefined;
    }
    /**
     * Given a child dom node, tries to find if this dom node is (contained in) a sticky folding icon.
     * @returns a boolean.
     */ isInFoldingIconDomNode(domNode) {
        const isInFoldingIcon = this._getAttributeValue(domNode, $467930aefba59039$var$STICKY_IS_FOLDING_ICON_ATTR);
        return isInFoldingIcon !== undefined;
    }
    /**
     * Given the dom node, finds if it or its parent sequence contains the given attribute.
     * @returns the attribute value or undefined.
     */ _getAttributeValue(domNode, attribute) {
        while(domNode && domNode !== this._rootDomNode){
            const line = domNode.getAttribute(attribute);
            if (line !== null) return line;
            domNode = domNode.parentElement;
        }
        return;
    }
}
class $467930aefba59039$var$RenderedStickyLine {
    constructor(index, lineNumber, lineDomNode, lineNumberDomNode, foldingIcon, characterMapping, scrollWidth){
        this.index = index;
        this.lineNumber = lineNumber;
        this.lineDomNode = lineDomNode;
        this.lineNumberDomNode = lineNumberDomNode;
        this.foldingIcon = foldingIcon;
        this.characterMapping = characterMapping;
        this.scrollWidth = scrollWidth;
    }
}
class $467930aefba59039$var$StickyFoldingIcon {
    constructor(isCollapsed, foldingStartLine, foldingEndLine, dimension){
        this.isCollapsed = isCollapsed;
        this.foldingStartLine = foldingStartLine;
        this.foldingEndLine = foldingEndLine;
        this.dimension = dimension;
        this.domNode = document.createElement('div');
        this.domNode.style.width = `${dimension}px`;
        this.domNode.style.height = `${dimension}px`;
        this.domNode.className = (0, $5rADe.ThemeIcon).asClassName(isCollapsed ? (0, $c635953bb01ef0ba$export$91aea75f1008558b) : (0, $c635953bb01ef0ba$export$885051cbe6b7e954));
    }
    setVisible(visible) {
        this.domNode.style.cursor = visible ? 'pointer' : 'default';
        this.domNode.style.opacity = visible ? '1' : '0';
    }
}


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $4J6fu = parcelRequire("4J6fu");

var $giPcZ = parcelRequire("giPcZ");

var $6bXyA = parcelRequire("6bXyA");

var $kJ8UG = parcelRequire("kJ8UG");

var $5YaSO = parcelRequire("5YaSO");

var $1qkuR = parcelRequire("1qkuR");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $4J6fu = parcelRequire("4J6fu");


var $6bXyA = parcelRequire("6bXyA");




var $1qkuR = parcelRequire("1qkuR");

var $gPkHZ = parcelRequire("gPkHZ");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ class $89176d0a9e545038$export$c23539509a08e553 {
    constructor(startLineNumber, endLineNumber){
        this.startLineNumber = startLineNumber;
        this.endLineNumber = endLineNumber;
    }
}
class $89176d0a9e545038$export$cf169a1987ce7757 {
    constructor(/**
     * Range of line numbers spanned by the current scope
     */ range, /**
     * Must be sorted by start line number
    */ children, /**
     * Parent sticky outline element
     */ parent){
        this.range = range;
        this.children = children;
        this.parent = parent;
    }
}
class $89176d0a9e545038$export$fd6c49893f088dc4 {
    constructor(uri, version, element, outlineProviderId){
        this.uri = uri;
        this.version = version;
        this.element = element;
        this.outlineProviderId = outlineProviderId;
    }
}



var $6CAkM = parcelRequire("6CAkM");

var $fdGPu = parcelRequire("fdGPu");
var $0244b31005587214$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $0244b31005587214$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $0244b31005587214$var$ModelProvider;
(function(ModelProvider) {
    ModelProvider["OUTLINE_MODEL"] = "outlineModel";
    ModelProvider["FOLDING_PROVIDER_MODEL"] = "foldingProviderModel";
    ModelProvider["INDENTATION_MODEL"] = "indentationModel";
})($0244b31005587214$var$ModelProvider || ($0244b31005587214$var$ModelProvider = {}));
var $0244b31005587214$var$Status;
(function(Status) {
    Status[Status["VALID"] = 0] = "VALID";
    Status[Status["INVALID"] = 1] = "INVALID";
    Status[Status["CANCELED"] = 2] = "CANCELED";
})($0244b31005587214$var$Status || ($0244b31005587214$var$Status = {}));
let $0244b31005587214$export$529a0943d98dfc6b = class StickyModelProvider extends (0, $9cWcn.Disposable) {
    constructor(_editor, onProviderUpdate, _languageConfigurationService, _languageFeaturesService){
        super();
        this._editor = _editor;
        this._modelProviders = [];
        this._modelPromise = null;
        this._updateScheduler = this._register(new (0, $6bXyA.Delayer)(300));
        this._updateOperation = this._register(new (0, $9cWcn.DisposableStore)());
        switch(this._editor.getOption(116 /* EditorOption.stickyScroll */ ).defaultModel){
            case $0244b31005587214$var$ModelProvider.OUTLINE_MODEL:
                this._modelProviders.push(new $0244b31005587214$var$StickyModelFromCandidateOutlineProvider(this._editor, _languageFeaturesService));
            // fall through
            case $0244b31005587214$var$ModelProvider.FOLDING_PROVIDER_MODEL:
                this._modelProviders.push(new $0244b31005587214$var$StickyModelFromCandidateSyntaxFoldingProvider(this._editor, onProviderUpdate, _languageFeaturesService));
            // fall through
            case $0244b31005587214$var$ModelProvider.INDENTATION_MODEL:
                this._modelProviders.push(new $0244b31005587214$var$StickyModelFromCandidateIndentationFoldingProvider(this._editor, _languageConfigurationService));
                break;
        }
    }
    dispose() {
        this._modelProviders.forEach((provider)=>provider.dispose());
        this._updateOperation.clear();
        this._cancelModelPromise();
        super.dispose();
    }
    _cancelModelPromise() {
        if (this._modelPromise) {
            this._modelPromise.cancel();
            this._modelPromise = null;
        }
    }
    async update(token) {
        this._updateOperation.clear();
        this._updateOperation.add({
            dispose: ()=>{
                this._cancelModelPromise();
                this._updateScheduler.cancel();
            }
        });
        this._cancelModelPromise();
        return await this._updateScheduler.trigger(async ()=>{
            for (const modelProvider of this._modelProviders){
                const { statusPromise: statusPromise, modelPromise: modelPromise } = modelProvider.computeStickyModel(token);
                this._modelPromise = modelPromise;
                const status = await statusPromise;
                if (this._modelPromise !== modelPromise) return null;
                switch(status){
                    case $0244b31005587214$var$Status.CANCELED:
                        this._updateOperation.clear();
                        return null;
                    case $0244b31005587214$var$Status.VALID:
                        return modelProvider.stickyModel;
                }
            }
            return null;
        }).catch((error)=>{
            (0, $gPkHZ.onUnexpectedError)(error);
            return null;
        });
    }
};
$0244b31005587214$export$529a0943d98dfc6b = $0244b31005587214$var$__decorate([
    $0244b31005587214$var$__param(2, (0, $fdGPu.IInstantiationService)),
    $0244b31005587214$var$__param(3, (0, $4J6fu.ILanguageFeaturesService))
], $0244b31005587214$export$529a0943d98dfc6b);
class $0244b31005587214$var$StickyModelCandidateProvider extends (0, $9cWcn.Disposable) {
    constructor(_editor){
        super();
        this._editor = _editor;
        this._stickyModel = null;
    }
    get stickyModel() {
        return this._stickyModel;
    }
    _invalid() {
        this._stickyModel = null;
        return $0244b31005587214$var$Status.INVALID;
    }
    computeStickyModel(token) {
        if (token.isCancellationRequested || !this.isProviderValid()) return {
            statusPromise: this._invalid(),
            modelPromise: null
        };
        const providerModelPromise = (0, $6bXyA.createCancelablePromise)((token)=>this.createModelFromProvider(token));
        return {
            statusPromise: providerModelPromise.then((providerModel)=>{
                if (!this.isModelValid(providerModel)) return this._invalid();
                if (token.isCancellationRequested) return $0244b31005587214$var$Status.CANCELED;
                this._stickyModel = this.createStickyModel(token, providerModel);
                return $0244b31005587214$var$Status.VALID;
            }).then(undefined, (err)=>{
                (0, $gPkHZ.onUnexpectedError)(err);
                return $0244b31005587214$var$Status.CANCELED;
            }),
            modelPromise: providerModelPromise
        };
    }
    /**
     * Method which checks whether the model returned by the provider is valid and can be used to compute a sticky model.
     * This method by default returns true.
     * @param model model returned by the provider
     * @returns boolean indicating whether the model is valid
     */ isModelValid(model) {
        return true;
    }
    /**
     * Method which checks whether the provider is valid before applying it to find the provider model.
     * This method by default returns true.
     * @returns boolean indicating whether the provider is valid
     */ isProviderValid() {
        return true;
    }
}
let $0244b31005587214$var$StickyModelFromCandidateOutlineProvider = class StickyModelFromCandidateOutlineProvider extends $0244b31005587214$var$StickyModelCandidateProvider {
    constructor(_editor, _languageFeaturesService){
        super(_editor);
        this._languageFeaturesService = _languageFeaturesService;
    }
    createModelFromProvider(token) {
        return (0, $7f863e6a161b6d9f$export$23911836525ed42c).create(this._languageFeaturesService.documentSymbolProvider, this._editor.getModel(), token);
    }
    createStickyModel(token, model) {
        const { stickyOutlineElement: stickyOutlineElement, providerID: providerID } = this._stickyModelFromOutlineModel(model, this._stickyModel?.outlineProviderId);
        const textModel = this._editor.getModel();
        return new (0, $89176d0a9e545038$export$fd6c49893f088dc4)(textModel.uri, textModel.getVersionId(), stickyOutlineElement, providerID);
    }
    isModelValid(model) {
        return model && model.children.size > 0;
    }
    _stickyModelFromOutlineModel(outlineModel, preferredProvider) {
        let outlineElements;
        // When several possible outline providers
        if ((0, $6CAkM.Iterable).first(outlineModel.children.values()) instanceof (0, $7f863e6a161b6d9f$export$7979c5ef85019928)) {
            const provider = (0, $6CAkM.Iterable).find(outlineModel.children.values(), (outlineGroupOfModel)=>outlineGroupOfModel.id === preferredProvider);
            if (provider) outlineElements = provider.children;
            else {
                let tempID = '';
                let maxTotalSumOfRanges = -1;
                let optimalOutlineGroup = undefined;
                for (const [_key, outlineGroup] of outlineModel.children.entries()){
                    const totalSumRanges = this._findSumOfRangesOfGroup(outlineGroup);
                    if (totalSumRanges > maxTotalSumOfRanges) {
                        optimalOutlineGroup = outlineGroup;
                        maxTotalSumOfRanges = totalSumRanges;
                        tempID = outlineGroup.id;
                    }
                }
                preferredProvider = tempID;
                outlineElements = optimalOutlineGroup.children;
            }
        } else outlineElements = outlineModel.children;
        const stickyChildren = [];
        const outlineElementsArray = Array.from(outlineElements.values()).sort((element1, element2)=>{
            const range1 = new (0, $89176d0a9e545038$export$c23539509a08e553)(element1.symbol.range.startLineNumber, element1.symbol.range.endLineNumber);
            const range2 = new (0, $89176d0a9e545038$export$c23539509a08e553)(element2.symbol.range.startLineNumber, element2.symbol.range.endLineNumber);
            return this._comparator(range1, range2);
        });
        for (const outlineElement of outlineElementsArray)stickyChildren.push(this._stickyModelFromOutlineElement(outlineElement, outlineElement.symbol.selectionRange.startLineNumber));
        const stickyOutlineElement = new (0, $89176d0a9e545038$export$cf169a1987ce7757)(undefined, stickyChildren, undefined);
        return {
            stickyOutlineElement: stickyOutlineElement,
            providerID: preferredProvider
        };
    }
    _stickyModelFromOutlineElement(outlineElement, previousStartLine) {
        const children = [];
        for (const child of outlineElement.children.values())if (child.symbol.selectionRange.startLineNumber !== child.symbol.range.endLineNumber) {
            if (child.symbol.selectionRange.startLineNumber !== previousStartLine) children.push(this._stickyModelFromOutlineElement(child, child.symbol.selectionRange.startLineNumber));
            else for (const subchild of child.children.values())children.push(this._stickyModelFromOutlineElement(subchild, child.symbol.selectionRange.startLineNumber));
        }
        children.sort((child1, child2)=>this._comparator(child1.range, child2.range));
        const range = new (0, $89176d0a9e545038$export$c23539509a08e553)(outlineElement.symbol.selectionRange.startLineNumber, outlineElement.symbol.range.endLineNumber);
        return new (0, $89176d0a9e545038$export$cf169a1987ce7757)(range, children, undefined);
    }
    _comparator(range1, range2) {
        if (range1.startLineNumber !== range2.startLineNumber) return range1.startLineNumber - range2.startLineNumber;
        else return range2.endLineNumber - range1.endLineNumber;
    }
    _findSumOfRangesOfGroup(outline) {
        let res = 0;
        for (const child of outline.children.values())res += this._findSumOfRangesOfGroup(child);
        if (outline instanceof (0, $7f863e6a161b6d9f$export$116fbcc3cc8d593)) return res + outline.symbol.range.endLineNumber - outline.symbol.selectionRange.startLineNumber;
        else return res;
    }
};
$0244b31005587214$var$StickyModelFromCandidateOutlineProvider = $0244b31005587214$var$__decorate([
    $0244b31005587214$var$__param(1, (0, $4J6fu.ILanguageFeaturesService))
], $0244b31005587214$var$StickyModelFromCandidateOutlineProvider);
class $0244b31005587214$var$StickyModelFromCandidateFoldingProvider extends $0244b31005587214$var$StickyModelCandidateProvider {
    constructor(editor){
        super(editor);
        this._foldingLimitReporter = new (0, $bd09b69eb5b6e36a$export$361d9ddbbcafe779)(editor);
    }
    createStickyModel(token, model) {
        const foldingElement = this._fromFoldingRegions(model);
        const textModel = this._editor.getModel();
        return new (0, $89176d0a9e545038$export$fd6c49893f088dc4)(textModel.uri, textModel.getVersionId(), foldingElement, undefined);
    }
    isModelValid(model) {
        return model !== null;
    }
    _fromFoldingRegions(foldingRegions) {
        const length = foldingRegions.length;
        const orderedStickyElements = [];
        // The root sticky outline element
        const stickyOutlineElement = new (0, $89176d0a9e545038$export$cf169a1987ce7757)(undefined, [], undefined);
        for(let i = 0; i < length; i++){
            // Finding the parent index of the current range
            const parentIndex = foldingRegions.getParentIndex(i);
            let parentNode;
            if (parentIndex !== -1) // Access the reference of the parent node
            parentNode = orderedStickyElements[parentIndex];
            else // In that case the parent node is the root node
            parentNode = stickyOutlineElement;
            const child = new (0, $89176d0a9e545038$export$cf169a1987ce7757)(new (0, $89176d0a9e545038$export$c23539509a08e553)(foldingRegions.getStartLineNumber(i), foldingRegions.getEndLineNumber(i) + 1), [], parentNode);
            parentNode.children.push(child);
            orderedStickyElements.push(child);
        }
        return stickyOutlineElement;
    }
}
let $0244b31005587214$var$StickyModelFromCandidateIndentationFoldingProvider = class StickyModelFromCandidateIndentationFoldingProvider extends $0244b31005587214$var$StickyModelFromCandidateFoldingProvider {
    constructor(editor, _languageConfigurationService){
        super(editor);
        this._languageConfigurationService = _languageConfigurationService;
        this.provider = this._register(new (0, $b63b4c5971ab4df6$export$c6761242dbde8f79)(editor.getModel(), this._languageConfigurationService, this._foldingLimitReporter));
    }
    async createModelFromProvider(token) {
        return this.provider.compute(token);
    }
};
$0244b31005587214$var$StickyModelFromCandidateIndentationFoldingProvider = $0244b31005587214$var$__decorate([
    $0244b31005587214$var$__param(1, (0, $1qkuR.ILanguageConfigurationService))
], $0244b31005587214$var$StickyModelFromCandidateIndentationFoldingProvider);
let $0244b31005587214$var$StickyModelFromCandidateSyntaxFoldingProvider = class StickyModelFromCandidateSyntaxFoldingProvider extends $0244b31005587214$var$StickyModelFromCandidateFoldingProvider {
    constructor(editor, onProviderUpdate, _languageFeaturesService){
        super(editor);
        this._languageFeaturesService = _languageFeaturesService;
        const selectedProviders = (0, $bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8).getFoldingRangeProviders(this._languageFeaturesService, editor.getModel());
        if (selectedProviders.length > 0) this.provider = this._register(new (0, $c72542064e6cf486$export$409cdd7e50053250)(editor.getModel(), selectedProviders, onProviderUpdate, this._foldingLimitReporter, undefined));
    }
    isProviderValid() {
        return this.provider !== undefined;
    }
    async createModelFromProvider(token) {
        return this.provider?.compute(token) ?? null;
    }
};
$0244b31005587214$var$StickyModelFromCandidateSyntaxFoldingProvider = $0244b31005587214$var$__decorate([
    $0244b31005587214$var$__param(2, (0, $4J6fu.ILanguageFeaturesService))
], $0244b31005587214$var$StickyModelFromCandidateSyntaxFoldingProvider);


var $335b0d64e56d0673$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $335b0d64e56d0673$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $335b0d64e56d0673$export$f86c368f4af6b5d3 {
    constructor(startLineNumber, endLineNumber, nestingDepth){
        this.startLineNumber = startLineNumber;
        this.endLineNumber = endLineNumber;
        this.nestingDepth = nestingDepth;
    }
}
let $335b0d64e56d0673$export$261b57ff8453cb1d = class StickyLineCandidateProvider extends (0, $9cWcn.Disposable) {
    constructor(editor, _languageFeaturesService, _languageConfigurationService){
        super();
        this._languageFeaturesService = _languageFeaturesService;
        this._languageConfigurationService = _languageConfigurationService;
        this._onDidChangeStickyScroll = this._register(new (0, $5YaSO.Emitter)());
        this.onDidChangeStickyScroll = this._onDidChangeStickyScroll.event;
        this._model = null;
        this._cts = null;
        this._stickyModelProvider = null;
        this._editor = editor;
        this._sessionStore = this._register(new (0, $9cWcn.DisposableStore)());
        this._updateSoon = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this.update(), 50));
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(116 /* EditorOption.stickyScroll */ )) this.readConfiguration();
        }));
        this.readConfiguration();
    }
    readConfiguration() {
        this._sessionStore.clear();
        const options = this._editor.getOption(116 /* EditorOption.stickyScroll */ );
        if (!options.enabled) return;
        this._sessionStore.add(this._editor.onDidChangeModel(()=>{
            // We should not show an old model for a different file, it will always be wrong.
            // So we clear the model here immediately and then trigger an update.
            this._model = null;
            this.updateStickyModelProvider();
            this._onDidChangeStickyScroll.fire();
            this.update();
        }));
        this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update()));
        this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule()));
        this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update()));
        this._sessionStore.add((0, $9cWcn.toDisposable)(()=>{
            this._stickyModelProvider?.dispose();
            this._stickyModelProvider = null;
        }));
        this.updateStickyModelProvider();
        this.update();
    }
    getVersionId() {
        return this._model?.version;
    }
    updateStickyModelProvider() {
        this._stickyModelProvider?.dispose();
        this._stickyModelProvider = null;
        const editor = this._editor;
        if (editor.hasModel()) this._stickyModelProvider = new (0, $0244b31005587214$export$529a0943d98dfc6b)(editor, ()=>this._updateSoon.schedule(), this._languageConfigurationService, this._languageFeaturesService);
    }
    async update() {
        this._cts?.dispose(true);
        this._cts = new (0, $giPcZ.CancellationTokenSource)();
        await this.updateStickyModel(this._cts.token);
        this._onDidChangeStickyScroll.fire();
    }
    async updateStickyModel(token) {
        if (!this._editor.hasModel() || !this._stickyModelProvider || this._editor.getModel().isTooLargeForTokenization()) {
            this._model = null;
            return;
        }
        const model = await this._stickyModelProvider.update(token);
        if (token.isCancellationRequested) // the computation was canceled, so do not overwrite the model
        return;
        this._model = model;
    }
    updateIndex(index) {
        if (index === -1) index = 0;
        else if (index < 0) index = -index - 2;
        return index;
    }
    getCandidateStickyLinesIntersectingFromStickyModel(range, outlineModel, result, depth, lastStartLineNumber) {
        if (outlineModel.children.length === 0) return;
        let lastLine = lastStartLineNumber;
        const childrenStartLines = [];
        for(let i = 0; i < outlineModel.children.length; i++){
            const child = outlineModel.children[i];
            if (child.range) childrenStartLines.push(child.range.startLineNumber);
        }
        const lowerBound = this.updateIndex((0, $kJ8UG.binarySearch)(childrenStartLines, range.startLineNumber, (a, b)=>{
            return a - b;
        }));
        const upperBound = this.updateIndex((0, $kJ8UG.binarySearch)(childrenStartLines, range.startLineNumber + depth, (a, b)=>{
            return a - b;
        }));
        for(let i = lowerBound; i <= upperBound; i++){
            const child = outlineModel.children[i];
            if (!child) return;
            if (child.range) {
                const childStartLine = child.range.startLineNumber;
                const childEndLine = child.range.endLineNumber;
                if (range.startLineNumber <= childEndLine + 1 && childStartLine - 1 <= range.endLineNumber && childStartLine !== lastLine) {
                    lastLine = childStartLine;
                    result.push(new $335b0d64e56d0673$export$f86c368f4af6b5d3(childStartLine, childEndLine - 1, depth + 1));
                    this.getCandidateStickyLinesIntersectingFromStickyModel(range, child, result, depth + 1, childStartLine);
                }
            } else this.getCandidateStickyLinesIntersectingFromStickyModel(range, child, result, depth, lastStartLineNumber);
        }
    }
    getCandidateStickyLinesIntersecting(range) {
        if (!this._model?.element) return [];
        let stickyLineCandidates = [];
        this.getCandidateStickyLinesIntersectingFromStickyModel(range, this._model.element, stickyLineCandidates, 0, -1);
        const hiddenRanges = this._editor._getViewModel()?.getHiddenAreas();
        if (hiddenRanges) for (const hiddenRange of hiddenRanges)stickyLineCandidates = stickyLineCandidates.filter((stickyLine)=>!(stickyLine.startLineNumber >= hiddenRange.startLineNumber && stickyLine.endLineNumber <= hiddenRange.endLineNumber + 1));
        return stickyLineCandidates;
    }
};
$335b0d64e56d0673$export$261b57ff8453cb1d = $335b0d64e56d0673$var$__decorate([
    $335b0d64e56d0673$var$__param(1, (0, $4J6fu.ILanguageFeaturesService)),
    $335b0d64e56d0673$var$__param(2, (0, $1qkuR.ILanguageConfigurationService))
], $335b0d64e56d0673$export$261b57ff8453cb1d);



var $fdGPu = parcelRequire("fdGPu");

var $d6K7e = parcelRequire("d6K7e");

var $g4v7E = parcelRequire("g4v7E");

var $cxCeF = parcelRequire("cxCeF");

var $ibKGQ = parcelRequire("ibKGQ");


var $d00il = parcelRequire("d00il");



var $dcxQ7 = parcelRequire("dcxQ7");

var $giPcZ = parcelRequire("giPcZ");

var $1qkuR = parcelRequire("1qkuR");

var $goG89 = parcelRequire("goG89");

var $bDzmQ = parcelRequire("bDzmQ");


var $c8kCi = parcelRequire("c8kCi");


var $56bebe1e37755f4d$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $56bebe1e37755f4d$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $56bebe1e37755f4d$var$StickyScrollController_1;
let $56bebe1e37755f4d$export$815c89346d3a802a = class StickyScrollController extends (0, $9cWcn.Disposable) {
    static{
        $56bebe1e37755f4d$var$StickyScrollController_1 = this;
    }
    static{
        this.ID = 'store.contrib.stickyScrollController';
    }
    constructor(_editor, _contextMenuService, _languageFeaturesService, _instaService, _languageConfigurationService, _languageFeatureDebounceService, _contextKeyService){
        super();
        this._editor = _editor;
        this._contextMenuService = _contextMenuService;
        this._languageFeaturesService = _languageFeaturesService;
        this._instaService = _instaService;
        this._contextKeyService = _contextKeyService;
        this._sessionStore = new (0, $9cWcn.DisposableStore)();
        this._maxStickyLines = Number.MAX_SAFE_INTEGER;
        this._candidateDefinitionsLength = -1;
        this._focusedStickyElementIndex = -1;
        this._enabled = false;
        this._focused = false;
        this._positionRevealed = false;
        this._onMouseDown = false;
        this._endLineNumbers = [];
        this._stickyScrollWidget = new (0, $467930aefba59039$export$9891ea470f0c2cea)(this._editor);
        this._stickyLineCandidateProvider = new (0, $335b0d64e56d0673$export$261b57ff8453cb1d)(this._editor, _languageFeaturesService, _languageConfigurationService);
        this._register(this._stickyScrollWidget);
        this._register(this._stickyLineCandidateProvider);
        this._widgetState = (0, $467930aefba59039$export$bad5990dbe231ca3).Empty;
        this._onDidResize();
        this._readConfiguration();
        const stickyScrollDomNode = this._stickyScrollWidget.getDomNode();
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            this._readConfigurationChange(e);
        }));
        this._register($bDzmQ.addDisposableListener(stickyScrollDomNode, $bDzmQ.EventType.CONTEXT_MENU, async (event)=>{
            this._onContextMenu($bDzmQ.getWindow(stickyScrollDomNode), event);
        }));
        this._stickyScrollFocusedContextKey = (0, $ibKGQ.EditorContextKeys).stickyScrollFocused.bindTo(this._contextKeyService);
        this._stickyScrollVisibleContextKey = (0, $ibKGQ.EditorContextKeys).stickyScrollVisible.bindTo(this._contextKeyService);
        const focusTracker = this._register($bDzmQ.trackFocus(stickyScrollDomNode));
        this._register(focusTracker.onDidBlur((_)=>{
            // Suppose that the blurring is caused by scrolling, then keep the focus on the sticky scroll
            // This is determined by the fact that the height of the widget has become zero and there has been no position revealing
            if (this._positionRevealed === false && stickyScrollDomNode.clientHeight === 0) {
                this._focusedStickyElementIndex = -1;
                this.focus();
            } else this._disposeFocusStickyScrollStore();
        }));
        this._register(focusTracker.onDidFocus((_)=>{
            this.focus();
        }));
        this._registerMouseListeners();
        // Suppose that mouse down on the sticky scroll, then do not focus on the sticky scroll because this will be followed by the revealing of a position
        this._register($bDzmQ.addDisposableListener(stickyScrollDomNode, $bDzmQ.EventType.MOUSE_DOWN, (e)=>{
            this._onMouseDown = true;
        }));
    }
    static get(editor) {
        return editor.getContribution($56bebe1e37755f4d$var$StickyScrollController_1.ID);
    }
    _disposeFocusStickyScrollStore() {
        this._stickyScrollFocusedContextKey.set(false);
        this._focusDisposableStore?.dispose();
        this._focused = false;
        this._positionRevealed = false;
        this._onMouseDown = false;
    }
    focus() {
        // If the mouse is down, do not focus on the sticky scroll
        if (this._onMouseDown) {
            this._onMouseDown = false;
            this._editor.focus();
            return;
        }
        const focusState = this._stickyScrollFocusedContextKey.get();
        if (focusState === true) return;
        this._focused = true;
        this._focusDisposableStore = new (0, $9cWcn.DisposableStore)();
        this._stickyScrollFocusedContextKey.set(true);
        this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumbers.length - 1;
        this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);
    }
    focusNext() {
        if (this._focusedStickyElementIndex < this._stickyScrollWidget.lineNumberCount - 1) this._focusNav(true);
    }
    focusPrevious() {
        if (this._focusedStickyElementIndex > 0) this._focusNav(false);
    }
    selectEditor() {
        this._editor.focus();
    }
    // True is next, false is previous
    _focusNav(direction) {
        this._focusedStickyElementIndex = direction ? this._focusedStickyElementIndex + 1 : this._focusedStickyElementIndex - 1;
        this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);
    }
    goToFocused() {
        const lineNumbers = this._stickyScrollWidget.lineNumbers;
        this._disposeFocusStickyScrollStore();
        this._revealPosition({
            lineNumber: lineNumbers[this._focusedStickyElementIndex],
            column: 1
        });
    }
    _revealPosition(position) {
        this._reveaInEditor(position, ()=>this._editor.revealPosition(position));
    }
    _revealLineInCenterIfOutsideViewport(position) {
        this._reveaInEditor(position, ()=>this._editor.revealLineInCenterIfOutsideViewport(position.lineNumber, 0 /* ScrollType.Smooth */ ));
    }
    _reveaInEditor(position, revealFunction) {
        if (this._focused) this._disposeFocusStickyScrollStore();
        this._positionRevealed = true;
        revealFunction();
        this._editor.setSelection((0, $d00il.Range).fromPositions(position));
        this._editor.focus();
    }
    _registerMouseListeners() {
        const sessionStore = this._register(new (0, $9cWcn.DisposableStore)());
        const gesture = this._register(new (0, $485c48732062cc95$export$e5a83b5c609cb4bb)(this._editor, {
            extractLineNumberFromMouseEvent: (e)=>{
                const position = this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);
                return position ? position.lineNumber : 0;
            }
        }));
        const getMouseEventTarget = (mouseEvent)=>{
            if (!this._editor.hasModel()) return null;
            if (mouseEvent.target.type !== 12 /* MouseTargetType.OVERLAY_WIDGET */  || mouseEvent.target.detail !== this._stickyScrollWidget.getId()) // not hovering over our widget
            return null;
            const mouseTargetElement = mouseEvent.target.element;
            if (!mouseTargetElement || mouseTargetElement.innerText !== mouseTargetElement.innerHTML) // not on a span element rendering text
            return null;
            const position = this._stickyScrollWidget.getEditorPositionFromNode(mouseTargetElement);
            if (!position) // not hovering a sticky scroll line
            return null;
            return {
                range: new (0, $d00il.Range)(position.lineNumber, position.column, position.lineNumber, position.column + mouseTargetElement.innerText.length),
                textElement: mouseTargetElement
            };
        };
        const stickyScrollWidgetDomNode = this._stickyScrollWidget.getDomNode();
        this._register($bDzmQ.addStandardDisposableListener(stickyScrollWidgetDomNode, $bDzmQ.EventType.CLICK, (mouseEvent)=>{
            if (mouseEvent.ctrlKey || mouseEvent.altKey || mouseEvent.metaKey) // modifier pressed
            return;
            if (!mouseEvent.leftButton) // not left click
            return;
            if (mouseEvent.shiftKey) {
                // shift click
                const lineIndex = this._stickyScrollWidget.getLineIndexFromChildDomNode(mouseEvent.target);
                if (lineIndex === null) return;
                const position = new (0, $dcxQ7.Position)(this._endLineNumbers[lineIndex], 1);
                this._revealLineInCenterIfOutsideViewport(position);
                return;
            }
            const isInFoldingIconDomNode = this._stickyScrollWidget.isInFoldingIconDomNode(mouseEvent.target);
            if (isInFoldingIconDomNode) {
                // clicked on folding icon
                const lineNumber = this._stickyScrollWidget.getLineNumberFromChildDomNode(mouseEvent.target);
                this._toggleFoldingRegionForLine(lineNumber);
                return;
            }
            const isInStickyLine = this._stickyScrollWidget.isInStickyLine(mouseEvent.target);
            if (!isInStickyLine) return;
            // normal click
            let position = this._stickyScrollWidget.getEditorPositionFromNode(mouseEvent.target);
            if (!position) {
                const lineNumber = this._stickyScrollWidget.getLineNumberFromChildDomNode(mouseEvent.target);
                if (lineNumber === null) // not hovering a sticky scroll line
                return;
                position = new (0, $dcxQ7.Position)(lineNumber, 1);
            }
            this._revealPosition(position);
        }));
        this._register($bDzmQ.addStandardDisposableListener(stickyScrollWidgetDomNode, $bDzmQ.EventType.MOUSE_MOVE, (mouseEvent)=>{
            if (mouseEvent.shiftKey) {
                const currentEndForLineIndex = this._stickyScrollWidget.getLineIndexFromChildDomNode(mouseEvent.target);
                if (currentEndForLineIndex === null || this._showEndForLine !== null && this._showEndForLine === currentEndForLineIndex) return;
                this._showEndForLine = currentEndForLineIndex;
                this._renderStickyScroll();
                return;
            }
            if (this._showEndForLine !== undefined) {
                this._showEndForLine = undefined;
                this._renderStickyScroll();
            }
        }));
        this._register($bDzmQ.addDisposableListener(stickyScrollWidgetDomNode, $bDzmQ.EventType.MOUSE_LEAVE, (e)=>{
            if (this._showEndForLine !== undefined) {
                this._showEndForLine = undefined;
                this._renderStickyScroll();
            }
        }));
        this._register(gesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, _keyboardEvent])=>{
            const mouseTarget = getMouseEventTarget(mouseEvent);
            if (!mouseTarget || !mouseEvent.hasTriggerModifier || !this._editor.hasModel()) {
                sessionStore.clear();
                return;
            }
            const { range: range, textElement: textElement } = mouseTarget;
            if (!range.equalsRange(this._stickyRangeProjectedOnEditor)) {
                this._stickyRangeProjectedOnEditor = range;
                sessionStore.clear();
            } else if (textElement.style.textDecoration === 'underline') return;
            const cancellationToken = new (0, $giPcZ.CancellationTokenSource)();
            sessionStore.add((0, $9cWcn.toDisposable)(()=>cancellationToken.dispose(true)));
            let currentHTMLChild;
            (0, $398bbabbcbf6b57c$export$6b9dcdfe32ab3450)(this._languageFeaturesService.definitionProvider, this._editor.getModel(), new (0, $dcxQ7.Position)(range.startLineNumber, range.startColumn + 1), false, cancellationToken.token).then((candidateDefinitions)=>{
                if (cancellationToken.token.isCancellationRequested) return;
                if (candidateDefinitions.length !== 0) {
                    this._candidateDefinitionsLength = candidateDefinitions.length;
                    const childHTML = textElement;
                    if (currentHTMLChild !== childHTML) {
                        sessionStore.clear();
                        currentHTMLChild = childHTML;
                        currentHTMLChild.style.textDecoration = 'underline';
                        sessionStore.add((0, $9cWcn.toDisposable)(()=>{
                            currentHTMLChild.style.textDecoration = 'none';
                        }));
                    } else if (!currentHTMLChild) {
                        currentHTMLChild = childHTML;
                        currentHTMLChild.style.textDecoration = 'underline';
                        sessionStore.add((0, $9cWcn.toDisposable)(()=>{
                            currentHTMLChild.style.textDecoration = 'none';
                        }));
                    }
                } else sessionStore.clear();
            });
        }));
        this._register(gesture.onCancel(()=>{
            sessionStore.clear();
        }));
        this._register(gesture.onExecute(async (e)=>{
            if (e.target.type !== 12 /* MouseTargetType.OVERLAY_WIDGET */  || e.target.detail !== this._stickyScrollWidget.getId()) // not hovering over our widget
            return;
            const position = this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);
            if (!position) // not hovering a sticky scroll line
            return;
            if (!this._editor.hasModel() || !this._stickyRangeProjectedOnEditor) return;
            if (this._candidateDefinitionsLength > 1) {
                if (this._focused) this._disposeFocusStickyScrollStore();
                this._revealPosition({
                    lineNumber: position.lineNumber,
                    column: 1
                });
            }
            this._instaService.invokeFunction((0, $e5dd2bc6a42a00f0$export$6b268345d6f19f36), e, this._editor, {
                uri: this._editor.getModel().uri,
                range: this._stickyRangeProjectedOnEditor
            });
        }));
    }
    _onContextMenu(targetWindow, e) {
        const event = new (0, $c8kCi.StandardMouseEvent)(targetWindow, e);
        this._contextMenuService.showContextMenu({
            menuId: (0, $g4v7E.MenuId).StickyScrollContext,
            getAnchor: ()=>event
        });
    }
    _toggleFoldingRegionForLine(line) {
        if (!this._foldingModel || line === null) return;
        const stickyLine = this._stickyScrollWidget.getRenderedStickyLine(line);
        const foldingIcon = stickyLine?.foldingIcon;
        if (!foldingIcon) return;
        (0, $20b0c2d6437739df$export$6008f8f734d0336a)(this._foldingModel, Number.MAX_VALUE, [
            line
        ]);
        foldingIcon.isCollapsed = !foldingIcon.isCollapsed;
        const scrollTop = (foldingIcon.isCollapsed ? this._editor.getTopForLineNumber(foldingIcon.foldingEndLine) : this._editor.getTopForLineNumber(foldingIcon.foldingStartLine)) - this._editor.getOption(67 /* EditorOption.lineHeight */ ) * stickyLine.index + 1;
        this._editor.setScrollTop(scrollTop);
        this._renderStickyScroll(line);
    }
    _readConfiguration() {
        const options = this._editor.getOption(116 /* EditorOption.stickyScroll */ );
        if (options.enabled === false) {
            this._editor.removeOverlayWidget(this._stickyScrollWidget);
            this._sessionStore.clear();
            this._enabled = false;
            return;
        } else if (options.enabled && !this._enabled) {
            // When sticky scroll was just enabled, add the listeners on the sticky scroll
            this._editor.addOverlayWidget(this._stickyScrollWidget);
            this._sessionStore.add(this._editor.onDidScrollChange((e)=>{
                if (e.scrollTopChanged) {
                    this._showEndForLine = undefined;
                    this._renderStickyScroll();
                }
            }));
            this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize()));
            this._sessionStore.add(this._editor.onDidChangeModelTokens((e)=>this._onTokensChange(e)));
            this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{
                this._showEndForLine = undefined;
                this._renderStickyScroll();
            }));
            this._enabled = true;
        }
        const lineNumberOption = this._editor.getOption(68 /* EditorOption.lineNumbers */ );
        if (lineNumberOption.renderType === 2 /* RenderLineNumbersType.Relative */ ) this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{
            this._showEndForLine = undefined;
            this._renderStickyScroll(0);
        }));
    }
    _readConfigurationChange(event) {
        if (event.hasChanged(116 /* EditorOption.stickyScroll */ ) || event.hasChanged(73 /* EditorOption.minimap */ ) || event.hasChanged(67 /* EditorOption.lineHeight */ ) || event.hasChanged(111 /* EditorOption.showFoldingControls */ ) || event.hasChanged(68 /* EditorOption.lineNumbers */ )) this._readConfiguration();
        if (event.hasChanged(68 /* EditorOption.lineNumbers */ )) this._renderStickyScroll(0);
    }
    _needsUpdate(event) {
        const stickyLineNumbers = this._stickyScrollWidget.getCurrentLines();
        for (const stickyLineNumber of stickyLineNumbers)for (const range of event.ranges){
            if (stickyLineNumber >= range.fromLineNumber && stickyLineNumber <= range.toLineNumber) return true;
        }
        return false;
    }
    _onTokensChange(event) {
        if (this._needsUpdate(event)) // Rebuilding the whole widget from line 0
        this._renderStickyScroll(0);
    }
    _onDidResize() {
        const layoutInfo = this._editor.getLayoutInfo();
        // Make sure sticky scroll doesn't take up more than 25% of the editor
        const theoreticalLines = layoutInfo.height / this._editor.getOption(67 /* EditorOption.lineHeight */ );
        this._maxStickyLines = Math.round(theoreticalLines * .25);
    }
    async _renderStickyScroll(rebuildFromLine) {
        const model = this._editor.getModel();
        if (!model || model.isTooLargeForTokenization()) {
            this._resetState();
            return;
        }
        const nextRebuildFromLine = this._updateAndGetMinRebuildFromLine(rebuildFromLine);
        const stickyWidgetVersion = this._stickyLineCandidateProvider.getVersionId();
        const shouldUpdateState = stickyWidgetVersion === undefined || stickyWidgetVersion === model.getVersionId();
        if (shouldUpdateState) {
            if (!this._focused) await this._updateState(nextRebuildFromLine);
            else // Suppose that previously the sticky scroll widget had height 0, then if there are visible lines, set the last line as focused
            if (this._focusedStickyElementIndex === -1) {
                await this._updateState(nextRebuildFromLine);
                this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumberCount - 1;
                if (this._focusedStickyElementIndex !== -1) this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);
            } else {
                const focusedStickyElementLineNumber = this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];
                await this._updateState(nextRebuildFromLine);
                // Suppose that after setting the state, there are no sticky lines, set the focused index to -1
                if (this._stickyScrollWidget.lineNumberCount === 0) this._focusedStickyElementIndex = -1;
                else {
                    const previousFocusedLineNumberExists = this._stickyScrollWidget.lineNumbers.includes(focusedStickyElementLineNumber);
                    // If the line number is still there, do not change anything
                    // If the line number is not there, set the new focused line to be the last line
                    if (!previousFocusedLineNumberExists) this._focusedStickyElementIndex = this._stickyScrollWidget.lineNumberCount - 1;
                    this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);
                }
            }
        }
    }
    _updateAndGetMinRebuildFromLine(rebuildFromLine) {
        if (rebuildFromLine !== undefined) {
            const minRebuildFromLineOrInfinity = this._minRebuildFromLine !== undefined ? this._minRebuildFromLine : Infinity;
            this._minRebuildFromLine = Math.min(rebuildFromLine, minRebuildFromLineOrInfinity);
        }
        return this._minRebuildFromLine;
    }
    async _updateState(rebuildFromLine) {
        this._minRebuildFromLine = undefined;
        this._foldingModel = await (0, $bd09b69eb5b6e36a$export$5d4a7ec5ea2624d8).get(this._editor)?.getFoldingModel() ?? undefined;
        this._widgetState = this.findScrollWidgetState();
        const stickyWidgetHasLines = this._widgetState.startLineNumbers.length > 0;
        this._stickyScrollVisibleContextKey.set(stickyWidgetHasLines);
        this._stickyScrollWidget.setState(this._widgetState, this._foldingModel, rebuildFromLine);
    }
    async _resetState() {
        this._minRebuildFromLine = undefined;
        this._foldingModel = undefined;
        this._widgetState = (0, $467930aefba59039$export$bad5990dbe231ca3).Empty;
        this._stickyScrollVisibleContextKey.set(false);
        this._stickyScrollWidget.setState(undefined, undefined);
    }
    findScrollWidgetState() {
        const lineHeight = this._editor.getOption(67 /* EditorOption.lineHeight */ );
        const maxNumberStickyLines = Math.min(this._maxStickyLines, this._editor.getOption(116 /* EditorOption.stickyScroll */ ).maxLineCount);
        const scrollTop = this._editor.getScrollTop();
        let lastLineRelativePosition = 0;
        const startLineNumbers = [];
        const endLineNumbers = [];
        const arrayVisibleRanges = this._editor.getVisibleRanges();
        if (arrayVisibleRanges.length !== 0) {
            const fullVisibleRange = new (0, $89176d0a9e545038$export$c23539509a08e553)(arrayVisibleRanges[0].startLineNumber, arrayVisibleRanges[arrayVisibleRanges.length - 1].endLineNumber);
            const candidateRanges = this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(fullVisibleRange);
            for (const range of candidateRanges){
                const start = range.startLineNumber;
                const end = range.endLineNumber;
                const depth = range.nestingDepth;
                if (end - start > 0) {
                    const topOfElementAtDepth = (depth - 1) * lineHeight;
                    const bottomOfElementAtDepth = depth * lineHeight;
                    const bottomOfBeginningLine = this._editor.getBottomForLineNumber(start) - scrollTop;
                    const topOfEndLine = this._editor.getTopForLineNumber(end) - scrollTop;
                    const bottomOfEndLine = this._editor.getBottomForLineNumber(end) - scrollTop;
                    if (topOfElementAtDepth > topOfEndLine && topOfElementAtDepth <= bottomOfEndLine) {
                        startLineNumbers.push(start);
                        endLineNumbers.push(end + 1);
                        lastLineRelativePosition = bottomOfEndLine - bottomOfElementAtDepth;
                        break;
                    } else if (bottomOfElementAtDepth > bottomOfBeginningLine && bottomOfElementAtDepth <= bottomOfEndLine) {
                        startLineNumbers.push(start);
                        endLineNumbers.push(end + 1);
                    }
                    if (startLineNumbers.length === maxNumberStickyLines) break;
                }
            }
        }
        this._endLineNumbers = endLineNumbers;
        return new (0, $467930aefba59039$export$bad5990dbe231ca3)(startLineNumbers, endLineNumbers, lastLineRelativePosition, this._showEndForLine);
    }
    dispose() {
        super.dispose();
        this._sessionStore.dispose();
    }
};
$56bebe1e37755f4d$export$815c89346d3a802a = $56bebe1e37755f4d$var$StickyScrollController_1 = $56bebe1e37755f4d$var$__decorate([
    $56bebe1e37755f4d$var$__param(1, (0, $d6K7e.IContextMenuService)),
    $56bebe1e37755f4d$var$__param(2, (0, $4J6fu.ILanguageFeaturesService)),
    $56bebe1e37755f4d$var$__param(3, (0, $fdGPu.IInstantiationService)),
    $56bebe1e37755f4d$var$__param(4, (0, $1qkuR.ILanguageConfigurationService)),
    $56bebe1e37755f4d$var$__param(5, (0, $goG89.ILanguageFeatureDebounceService)),
    $56bebe1e37755f4d$var$__param(6, (0, $cxCeF.IContextKeyService))
], $56bebe1e37755f4d$export$815c89346d3a802a);


class $753301c9640d15ce$export$aacff18530edf9b1 extends (0, $g4v7E.Action2) {
    constructor(){
        super({
            id: 'editor.action.toggleStickyScroll',
            title: {
                ...(0, $4dEdH.localize2)('toggleEditorStickyScroll', "Toggle Editor Sticky Scroll"),
                mnemonicTitle: (0, $4dEdH.localize)({
                    key: 'mitoggleStickyScroll',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Toggle Editor Sticky Scroll")
            },
            metadata: {
                description: (0, $4dEdH.localize2)('toggleEditorStickyScroll.description', "Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport")
            },
            category: (0, $9d226d95e7e9efd2$export$e1e795cef0e670e6).View,
            toggled: {
                condition: (0, $cxCeF.ContextKeyExpr).equals('config.editor.stickyScroll.enabled', true),
                title: (0, $4dEdH.localize)('stickyScroll', "Sticky Scroll"),
                mnemonicTitle: (0, $4dEdH.localize)({
                    key: 'miStickyScroll',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Sticky Scroll")
            },
            menu: [
                {
                    id: (0, $g4v7E.MenuId).CommandPalette
                },
                {
                    id: (0, $g4v7E.MenuId).MenubarAppearanceMenu,
                    group: '4_editor',
                    order: 3
                },
                {
                    id: (0, $g4v7E.MenuId).StickyScrollContext
                }
            ]
        });
    }
    async run(accessor) {
        const configurationService = accessor.get((0, $35IZ9.IConfigurationService));
        const newValue = !configurationService.getValue('editor.stickyScroll.enabled');
        return configurationService.updateValue('editor.stickyScroll.enabled', newValue);
    }
}
const $753301c9640d15ce$var$weight = 100 /* KeybindingWeight.EditorContrib */ ;
class $753301c9640d15ce$export$7d099948c382ec9b extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'editor.action.focusStickyScroll',
            title: {
                ...(0, $4dEdH.localize2)('focusStickyScroll', "Focus on the editor sticky scroll"),
                mnemonicTitle: (0, $4dEdH.localize)({
                    key: 'mifocusStickyScroll',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Focus Sticky Scroll")
            },
            precondition: (0, $cxCeF.ContextKeyExpr).and((0, $cxCeF.ContextKeyExpr).has('config.editor.stickyScroll.enabled'), (0, $ibKGQ.EditorContextKeys).stickyScrollVisible),
            menu: [
                {
                    id: (0, $g4v7E.MenuId).CommandPalette
                }
            ]
        });
    }
    runEditorCommand(_accessor, editor) {
        (0, $56bebe1e37755f4d$export$815c89346d3a802a).get(editor)?.focus();
    }
}
class $753301c9640d15ce$export$3edefac9110e7759 extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'editor.action.selectNextStickyScrollLine',
            title: (0, $4dEdH.localize2)('selectNextStickyScrollLine.title', "Select the next editor sticky scroll line"),
            precondition: (0, $ibKGQ.EditorContextKeys).stickyScrollFocused.isEqualTo(true),
            keybinding: {
                weight: $753301c9640d15ce$var$weight,
                primary: 18 /* KeyCode.DownArrow */ 
            }
        });
    }
    runEditorCommand(_accessor, editor) {
        (0, $56bebe1e37755f4d$export$815c89346d3a802a).get(editor)?.focusNext();
    }
}
class $753301c9640d15ce$export$3d1883a163c3ed25 extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'editor.action.selectPreviousStickyScrollLine',
            title: (0, $4dEdH.localize2)('selectPreviousStickyScrollLine.title', "Select the previous sticky scroll line"),
            precondition: (0, $ibKGQ.EditorContextKeys).stickyScrollFocused.isEqualTo(true),
            keybinding: {
                weight: $753301c9640d15ce$var$weight,
                primary: 16 /* KeyCode.UpArrow */ 
            }
        });
    }
    runEditorCommand(_accessor, editor) {
        (0, $56bebe1e37755f4d$export$815c89346d3a802a).get(editor)?.focusPrevious();
    }
}
class $753301c9640d15ce$export$9e254a1d4d43db54 extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'editor.action.goToFocusedStickyScrollLine',
            title: (0, $4dEdH.localize2)('goToFocusedStickyScrollLine.title', "Go to the focused sticky scroll line"),
            precondition: (0, $ibKGQ.EditorContextKeys).stickyScrollFocused.isEqualTo(true),
            keybinding: {
                weight: $753301c9640d15ce$var$weight,
                primary: 3 /* KeyCode.Enter */ 
            }
        });
    }
    runEditorCommand(_accessor, editor) {
        (0, $56bebe1e37755f4d$export$815c89346d3a802a).get(editor)?.goToFocused();
    }
}
class $753301c9640d15ce$export$17b56297dcd7e281 extends (0, $2iJTi.EditorAction2) {
    constructor(){
        super({
            id: 'editor.action.selectEditor',
            title: (0, $4dEdH.localize2)('selectEditor.title', "Select Editor"),
            precondition: (0, $ibKGQ.EditorContextKeys).stickyScrollFocused.isEqualTo(true),
            keybinding: {
                weight: $753301c9640d15ce$var$weight,
                primary: 9 /* KeyCode.Escape */ 
            }
        });
    }
    runEditorCommand(_accessor, editor) {
        (0, $56bebe1e37755f4d$export$815c89346d3a802a).get(editor)?.selectEditor();
    }
}




var $g4v7E = parcelRequire("g4v7E");
(0, $2iJTi.registerEditorContribution)((0, $56bebe1e37755f4d$export$815c89346d3a802a).ID, (0, $56bebe1e37755f4d$export$815c89346d3a802a), 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $g4v7E.registerAction2)((0, $753301c9640d15ce$export$aacff18530edf9b1));
(0, $g4v7E.registerAction2)((0, $753301c9640d15ce$export$7d099948c382ec9b));
(0, $g4v7E.registerAction2)((0, $753301c9640d15ce$export$3d1883a163c3ed25));
(0, $g4v7E.registerAction2)((0, $753301c9640d15ce$export$3edefac9110e7759));
(0, $g4v7E.registerAction2)((0, $753301c9640d15ce$export$9e254a1d4d43db54));
(0, $g4v7E.registerAction2)((0, $753301c9640d15ce$export$17b56297dcd7e281));



/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $giPcZ = parcelRequire("giPcZ");

var $lk06m = parcelRequire("lk06m");

var $6CAkM = parcelRequire("6CAkM");

var $9cWcn = parcelRequire("9cWcn");

var $2Qfl0 = parcelRequire("2Qfl0");

var $d00il = parcelRequire("d00il");

var $54y8R = parcelRequire("54y8R");

var $4J6fu = parcelRequire("4J6fu");






var $8QSW4 = parcelRequire("8QSW4");
var $75af935a4a9996a2$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $75af935a4a9996a2$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $75af935a4a9996a2$var$SuggestInlineCompletion {
    constructor(range, insertText, filterText, additionalTextEdits, command, completion){
        this.range = range;
        this.insertText = insertText;
        this.filterText = filterText;
        this.additionalTextEdits = additionalTextEdits;
        this.command = command;
        this.completion = completion;
    }
}
let $75af935a4a9996a2$var$InlineCompletionResults = class InlineCompletionResults extends (0, $9cWcn.RefCountedDisposable) {
    constructor(model, line, word, completionModel, completions, _suggestMemoryService){
        super(completions.disposable);
        this.model = model;
        this.line = line;
        this.word = word;
        this.completionModel = completionModel;
        this._suggestMemoryService = _suggestMemoryService;
    }
    canBeReused(model, line, word) {
        return this.model === model // same model
         && this.line === line && this.word.word.length > 0 && this.word.startColumn === word.startColumn && this.word.endColumn < word.endColumn // same word
         && this.completionModel.getIncompleteProvider().size === 0; // no incomplete results
    }
    get items() {
        const result = [];
        // Split items by preselected index. This ensures the memory-selected item shows first and that better/worst
        // ranked items are before/after
        const { items: items } = this.completionModel;
        const selectedIndex = this._suggestMemoryService.select(this.model, {
            lineNumber: this.line,
            column: this.word.endColumn + this.completionModel.lineContext.characterCountDelta
        }, items);
        const first = (0, $6CAkM.Iterable).slice(items, selectedIndex);
        const second = (0, $6CAkM.Iterable).slice(items, 0, selectedIndex);
        let resolveCount = 5;
        for (const item of (0, $6CAkM.Iterable).concat(first, second)){
            if (item.score === (0, $lk06m.FuzzyScore).Default) continue;
            const range = new (0, $d00il.Range)(item.editStart.lineNumber, item.editStart.column, item.editInsertEnd.lineNumber, item.editInsertEnd.column + this.completionModel.lineContext.characterCountDelta // end PLUS character delta
            );
            const insertText = item.completion.insertTextRules && item.completion.insertTextRules & 4 /* CompletionItemInsertTextRule.InsertAsSnippet */  ? {
                snippet: item.completion.insertText
            } : item.completion.insertText;
            result.push(new $75af935a4a9996a2$var$SuggestInlineCompletion(range, insertText, item.filterTextLow ?? item.labelLow, item.completion.additionalTextEdits, item.completion.command, item));
            // resolve the first N suggestions eagerly
            if (resolveCount-- >= 0) item.resolve((0, $giPcZ.CancellationToken).None);
        }
        return result;
    }
};
$75af935a4a9996a2$var$InlineCompletionResults = $75af935a4a9996a2$var$__decorate([
    $75af935a4a9996a2$var$__param(5, (0, $3137e0e4318e8557$export$d66aa79ce7d9c867))
], $75af935a4a9996a2$var$InlineCompletionResults);
let $75af935a4a9996a2$export$26066ba7b9d11c63 = class SuggestInlineCompletions extends (0, $9cWcn.Disposable) {
    constructor(_languageFeatureService, _clipboardService, _suggestMemoryService, _editorService){
        super();
        this._languageFeatureService = _languageFeatureService;
        this._clipboardService = _clipboardService;
        this._suggestMemoryService = _suggestMemoryService;
        this._editorService = _editorService;
        this._store.add(_languageFeatureService.inlineCompletionsProvider.register('*', this));
    }
    async provideInlineCompletions(model, position, context, token) {
        if (context.selectedSuggestionInfo) return;
        let editor;
        for (const candidate of this._editorService.listCodeEditors())if (candidate.getModel() === model) {
            editor = candidate;
            break;
        }
        if (!editor) return;
        const config = editor.getOption(90 /* EditorOption.quickSuggestions */ );
        if ((0, $46671b3f02f7e7cd$export$8cddbe8aa50feac1).isAllOff(config)) // quick suggest is off (for this model/language)
        return;
        model.tokenization.tokenizeIfCheap(position.lineNumber);
        const lineTokens = model.tokenization.getLineTokens(position.lineNumber);
        const tokenType = lineTokens.getStandardTokenType(lineTokens.findTokenIndexAtOffset(Math.max(position.column - 1 - 1, 0)));
        if ((0, $46671b3f02f7e7cd$export$8cddbe8aa50feac1).valueFor(config, tokenType) !== 'inline') // quick suggest is off (for this token)
        return undefined;
        // We consider non-empty leading words and trigger characters. The latter only
        // when no word is being typed (word characters superseed trigger characters)
        let wordInfo = model.getWordAtPosition(position);
        let triggerCharacterInfo;
        if (!wordInfo?.word) triggerCharacterInfo = this._getTriggerCharacterInfo(model, position);
        if (!wordInfo?.word && !triggerCharacterInfo) // not at word, not a trigger character
        return;
        // ensure that we have word information and that we are at the end of a word
        // otherwise we stop because we don't want to do quick suggestions inside words
        if (!wordInfo) wordInfo = model.getWordUntilPosition(position);
        if (wordInfo.endColumn !== position.column) return;
        let result;
        const leadingLineContents = model.getValueInRange(new (0, $d00il.Range)(position.lineNumber, 1, position.lineNumber, position.column));
        if (!triggerCharacterInfo && this._lastResult?.canBeReused(model, position.lineNumber, wordInfo)) {
            // reuse a previous result iff possible, only a refilter is needed
            // TODO@jrieken this can be improved further and only incomplete results can be updated
            // console.log(`REUSE with ${wordInfo.word}`);
            const newLineContext = new (0, $ed4f2b2c2d18e4d1$export$894a84ea03928d60)(leadingLineContents, position.column - this._lastResult.word.endColumn);
            this._lastResult.completionModel.lineContext = newLineContext;
            this._lastResult.acquire();
            result = this._lastResult;
        } else {
            // refesh model is required
            const completions = await (0, $46671b3f02f7e7cd$export$c34b3fef967c72b0)(this._languageFeatureService.completionProvider, model, position, new (0, $46671b3f02f7e7cd$export$6e9613987176d8af)(undefined, (0, $c647ef64fb80ec19$export$bd6d3a37695095d5).createSuggestFilter(editor).itemKind, triggerCharacterInfo?.providers), triggerCharacterInfo && {
                triggerKind: 1 /* CompletionTriggerKind.TriggerCharacter */ ,
                triggerCharacter: triggerCharacterInfo.ch
            }, token);
            let clipboardText;
            if (completions.needsClipboard) clipboardText = await this._clipboardService.readText();
            const completionModel = new (0, $ed4f2b2c2d18e4d1$export$8420ec00c11e432f)(completions.items, position.column, new (0, $ed4f2b2c2d18e4d1$export$894a84ea03928d60)(leadingLineContents, 0), (0, $f0635859e8508238$export$620c7fa9f786bff6).None, editor.getOption(119 /* EditorOption.suggest */ ), editor.getOption(113 /* EditorOption.snippetSuggestions */ ), {
                boostFullMatch: false,
                firstMatchCanBeWeak: false
            }, clipboardText);
            result = new $75af935a4a9996a2$var$InlineCompletionResults(model, position.lineNumber, wordInfo, completionModel, completions, this._suggestMemoryService);
        }
        this._lastResult = result;
        return result;
    }
    handleItemDidShow(_completions, item) {
        item.completion.resolve((0, $giPcZ.CancellationToken).None);
    }
    freeInlineCompletions(result) {
        result.release();
    }
    _getTriggerCharacterInfo(model, position) {
        const ch = model.getValueInRange((0, $d00il.Range).fromPositions({
            lineNumber: position.lineNumber,
            column: position.column - 1
        }, position));
        const providers = new Set();
        for (const provider of this._languageFeatureService.completionProvider.all(model))if (provider.triggerCharacters?.includes(ch)) providers.add(provider);
        if (providers.size === 0) return undefined;
        return {
            providers: providers,
            ch: ch
        };
    }
};
$75af935a4a9996a2$export$26066ba7b9d11c63 = $75af935a4a9996a2$var$__decorate([
    $75af935a4a9996a2$var$__param(0, (0, $4J6fu.ILanguageFeaturesService)),
    $75af935a4a9996a2$var$__param(1, (0, $8QSW4.IClipboardService)),
    $75af935a4a9996a2$var$__param(2, (0, $3137e0e4318e8557$export$d66aa79ce7d9c867)),
    $75af935a4a9996a2$var$__param(3, (0, $2Qfl0.ICodeEditorService))
], $75af935a4a9996a2$export$26066ba7b9d11c63);
(0, $54y8R.registerEditorFeature)($75af935a4a9996a2$export$26066ba7b9d11c63);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $eUQTM = parcelRequire("eUQTM");

var $2iJTi = parcelRequire("2iJTi");

var $4dEdH = parcelRequire("4dEdH");
class $a8604412a20613d9$var$ForceRetokenizeAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.forceRetokenize',
            label: $4dEdH.localize('forceRetokenize', "Developer: Force Retokenize"),
            alias: 'Developer: Force Retokenize',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        if (!editor.hasModel()) return;
        const model = editor.getModel();
        model.tokenization.resetTokenization();
        const sw = new (0, $eUQTM.StopWatch)();
        model.tokenization.forceTokenization(model.getLineCount());
        sw.stop();
        console.log(`tokenization took ${sw.elapsed()}`);
    }
}
(0, $2iJTi.registerEditorAction)($a8604412a20613d9$var$ForceRetokenizeAction);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $aIbUW = parcelRequire("aIbUW");

var $j0ijY = parcelRequire("j0ijY");

var $4dEdH = parcelRequire("4dEdH");

var $g4v7E = parcelRequire("g4v7E");
class $3c63d910d6bb097e$export$676ded3884da9932 extends (0, $g4v7E.Action2) {
    static{
        this.ID = 'editor.action.toggleTabFocusMode';
    }
    constructor(){
        super({
            id: $3c63d910d6bb097e$export$676ded3884da9932.ID,
            title: $4dEdH.localize2({
                key: 'toggle.tabMovesFocus',
                comment: [
                    'Turn on/off use of tab key for moving focus around VS Code'
                ]
            }, 'Toggle Tab Key Moves Focus'),
            precondition: undefined,
            keybinding: {
                primary: 2091 /* KeyCode.KeyM */ ,
                mac: {
                    primary: 1323 /* KeyCode.KeyM */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            metadata: {
                description: $4dEdH.localize2('tabMovesFocusDescriptions', "Determines whether the tab key moves focus around the workbench or inserts the tab character in the current editor. This is also called tab trapping, tab navigation, or tab focus mode.")
            },
            f1: true
        });
    }
    run() {
        const oldValue = (0, $j0ijY.TabFocus).getTabFocusMode();
        const newValue = !oldValue;
        (0, $j0ijY.TabFocus).setTabFocusMode(newValue);
        if (newValue) (0, $aIbUW.alert)($4dEdH.localize('toggle.tabMovesFocus.on', "Pressing Tab will now move focus to the next focusable element"));
        else (0, $aIbUW.alert)($4dEdH.localize('toggle.tabMovesFocus.off', "Pressing Tab will now insert the tab character"));
    }
}
(0, $g4v7E.registerAction2)($3c63d910d6bb097e$export$676ded3884da9932);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $awgRE = parcelRequire("awgRE");

var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");

var $lb0Ah = parcelRequire("lb0Ah");

var $jcr1R = parcelRequire("jcr1R");


var $2iJTi = parcelRequire("2iJTi");

var $cd4KD = parcelRequire("cd4KD");

var $91ntV = parcelRequire("91ntV");

var $eJwQl = parcelRequire("eJwQl");

var $zvLvK = parcelRequire("zvLvK");

var $h9Xpp = parcelRequire("h9Xpp");

var $9mXLU = parcelRequire("9mXLU");




var $bDzmQ = parcelRequire("bDzmQ");

var $czr0Q = parcelRequire("czr0Q");

var $cVfMQ = parcelRequire("cVfMQ");

var $9cWcn = parcelRequire("9cWcn");

var $1vDLP = parcelRequire("1vDLP");

var $fdGPu = parcelRequire("fdGPu");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $bDzmQ = parcelRequire("bDzmQ");

var $3vJsA = parcelRequire("3vJsA");

var $gV002 = parcelRequire("gV002");

var $cnAUf = parcelRequire("cnAUf");

var $5YaSO = parcelRequire("5YaSO");

var $9cWcn = parcelRequire("9cWcn");

var $iAi3o = parcelRequire("iAi3o");


var $b97Zr = parcelRequire("b97Zr");

var $lc5DL = parcelRequire("lc5DL");
var $b504846d2d19c1a7$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $b504846d2d19c1a7$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $b504846d2d19c1a7$export$a6c7ac8248d6e38a = class Link extends (0, $9cWcn.Disposable) {
    get enabled() {
        return this._enabled;
    }
    set enabled(enabled) {
        if (enabled) {
            this.el.setAttribute('aria-disabled', 'false');
            this.el.tabIndex = 0;
            this.el.style.pointerEvents = 'auto';
            this.el.style.opacity = '1';
            this.el.style.cursor = 'pointer';
            this._enabled = false;
        } else {
            this.el.setAttribute('aria-disabled', 'true');
            this.el.tabIndex = -1;
            this.el.style.pointerEvents = 'none';
            this.el.style.opacity = '0.4';
            this.el.style.cursor = 'default';
            this._enabled = true;
        }
        this._enabled = enabled;
    }
    constructor(container, _link, options = {}, _hoverService, openerService){
        super();
        this._link = _link;
        this._hoverService = _hoverService;
        this._enabled = true;
        this.el = (0, $bDzmQ.append)(container, (0, $bDzmQ.$)('a.monaco-link', {
            tabIndex: _link.tabIndex ?? 0,
            href: _link.href
        }, _link.label));
        this.hoverDelegate = options.hoverDelegate ?? (0, $b97Zr.getDefaultHoverDelegate)('mouse');
        this.setTooltip(_link.title);
        this.el.setAttribute('role', 'button');
        const onClickEmitter = this._register(new (0, $3vJsA.DomEmitter)(this.el, 'click'));
        const onKeyPress = this._register(new (0, $3vJsA.DomEmitter)(this.el, 'keypress'));
        const onEnterPress = (0, $5YaSO.Event).chain(onKeyPress.event, ($)=>$.map((e)=>new (0, $gV002.StandardKeyboardEvent)(e)).filter((e)=>e.keyCode === 3 /* KeyCode.Enter */ ));
        const onTap = this._register(new (0, $3vJsA.DomEmitter)(this.el, (0, $cnAUf.EventType).Tap)).event;
        this._register((0, $cnAUf.Gesture).addTarget(this.el));
        const onOpen = (0, $5YaSO.Event).any(onClickEmitter.event, onEnterPress, onTap);
        this._register(onOpen((e)=>{
            if (!this.enabled) return;
            (0, $bDzmQ.EventHelper).stop(e, true);
            if (options?.opener) options.opener(this._link.href);
            else openerService.open(this._link.href, {
                allowCommands: true
            });
        }));
        this.enabled = true;
    }
    setTooltip(title) {
        if (this.hoverDelegate.showNativeHover) this.el.title = title ?? '';
        else if (!this.hover && title) this.hover = this._register(this._hoverService.setupManagedHover(this.hoverDelegate, this.el, title));
        else if (this.hover) this.hover.update(title);
    }
};
$b504846d2d19c1a7$export$a6c7ac8248d6e38a = $b504846d2d19c1a7$var$__decorate([
    $b504846d2d19c1a7$var$__param(3, (0, $lc5DL.IHoverService)),
    $b504846d2d19c1a7$var$__param(4, (0, $iAi3o.IOpenerService))
], $b504846d2d19c1a7$export$a6c7ac8248d6e38a);



var $hEsmQ = parcelRequire("hEsmQ");

var $5rADe = parcelRequire("5rADe");
var $c03b307b3fc04291$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c03b307b3fc04291$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $c03b307b3fc04291$var$BANNER_ELEMENT_HEIGHT = 26;
let $c03b307b3fc04291$export$1da7e17bff54d3c0 = class BannerController extends (0, $9cWcn.Disposable) {
    constructor(_editor, instantiationService){
        super();
        this._editor = _editor;
        this.instantiationService = instantiationService;
        this.banner = this._register(this.instantiationService.createInstance($c03b307b3fc04291$var$Banner));
    }
    hide() {
        this._editor.setBanner(null, 0);
        this.banner.clear();
    }
    show(item) {
        this.banner.show({
            ...item,
            onClose: ()=>{
                this.hide();
                item.onClose?.();
            }
        });
        this._editor.setBanner(this.banner.element, $c03b307b3fc04291$var$BANNER_ELEMENT_HEIGHT);
    }
};
$c03b307b3fc04291$export$1da7e17bff54d3c0 = $c03b307b3fc04291$var$__decorate([
    $c03b307b3fc04291$var$__param(1, (0, $fdGPu.IInstantiationService))
], $c03b307b3fc04291$export$1da7e17bff54d3c0);
// TODO@hediet: Investigate if this can be reused by the workspace banner (bannerPart.ts).
let $c03b307b3fc04291$var$Banner = class Banner extends (0, $9cWcn.Disposable) {
    constructor(instantiationService){
        super();
        this.instantiationService = instantiationService;
        this.markdownRenderer = this.instantiationService.createInstance((0, $1vDLP.MarkdownRenderer), {});
        this.element = (0, $bDzmQ.$)('div.editor-banner');
        this.element.tabIndex = 0;
    }
    getAriaLabel(item) {
        if (item.ariaLabel) return item.ariaLabel;
        if (typeof item.message === 'string') return item.message;
        return undefined;
    }
    getBannerMessage(message) {
        if (typeof message === 'string') {
            const element = (0, $bDzmQ.$)('span');
            element.innerText = message;
            return element;
        }
        return this.markdownRenderer.render(message).element;
    }
    clear() {
        (0, $bDzmQ.clearNode)(this.element);
    }
    show(item) {
        // Clear previous item
        (0, $bDzmQ.clearNode)(this.element);
        // Banner aria label
        const ariaLabel = this.getAriaLabel(item);
        if (ariaLabel) this.element.setAttribute('aria-label', ariaLabel);
        // Icon
        const iconContainer = (0, $bDzmQ.append)(this.element, (0, $bDzmQ.$)('div.icon-container'));
        iconContainer.setAttribute('aria-hidden', 'true');
        if (item.icon) iconContainer.appendChild((0, $bDzmQ.$)(`div${(0, $5rADe.ThemeIcon).asCSSSelector(item.icon)}`));
        // Message
        const messageContainer = (0, $bDzmQ.append)(this.element, (0, $bDzmQ.$)('div.message-container'));
        messageContainer.setAttribute('aria-hidden', 'true');
        messageContainer.appendChild(this.getBannerMessage(item.message));
        // Message Actions
        this.messageActionsContainer = (0, $bDzmQ.append)(this.element, (0, $bDzmQ.$)('div.message-actions-container'));
        if (item.actions) for (const action of item.actions)this._register(this.instantiationService.createInstance((0, $b504846d2d19c1a7$export$a6c7ac8248d6e38a), this.messageActionsContainer, {
            ...action,
            tabIndex: -1
        }, {}));
        // Action
        const actionBarContainer = (0, $bDzmQ.append)(this.element, (0, $bDzmQ.$)('div.action-container'));
        this.actionBar = this._register(new (0, $czr0Q.ActionBar)(actionBarContainer));
        this.actionBar.push(this._register(new (0, $cVfMQ.Action)('banner.close', 'Close Banner', (0, $5rADe.ThemeIcon).asClassName((0, $hEsmQ.widgetClose)), true, ()=>{
            if (typeof item.onClose === 'function') item.onClose();
        })), {
            icon: true,
            label: false
        });
        this.actionBar.setFocusable(false);
    }
};
$c03b307b3fc04291$var$Banner = $c03b307b3fc04291$var$__decorate([
    $c03b307b3fc04291$var$__param(0, (0, $fdGPu.IInstantiationService))
], $c03b307b3fc04291$var$Banner);



var $4dEdH = parcelRequire("4dEdH");

var $35IZ9 = parcelRequire("35IZ9");

var $fdGPu = parcelRequire("fdGPu");

var $iAi3o = parcelRequire("iAi3o");

var $3XkzC = parcelRequire("3XkzC");

var $hEsmQ = parcelRequire("hEsmQ");

var $1iEDc = parcelRequire("1iEDc");
var $8e961b8573a42b51$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $8e961b8573a42b51$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $8e961b8573a42b51$export$8929e07d808734d0 = (0, $hEsmQ.registerIcon)('extensions-warning-message', (0, $awgRE.Codicon).warning, $4dEdH.localize('warningIcon', 'Icon shown with a warning message in the extensions editor.'));
let $8e961b8573a42b51$export$db6ed2fe81e44dff = class UnicodeHighlighter extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.unicodeHighlighter';
    }
    constructor(_editor, _editorWorkerService, _workspaceTrustService, instantiationService){
        super();
        this._editor = _editor;
        this._editorWorkerService = _editorWorkerService;
        this._workspaceTrustService = _workspaceTrustService;
        this._highlighter = null;
        this._bannerClosed = false;
        this._updateState = (state)=>{
            if (state && state.hasMore) {
                if (this._bannerClosed) return;
                // This document contains many non-basic ASCII characters.
                const max = Math.max(state.ambiguousCharacterCount, state.nonBasicAsciiCharacterCount, state.invisibleCharacterCount);
                let data;
                if (state.nonBasicAsciiCharacterCount >= max) data = {
                    message: $4dEdH.localize('unicodeHighlighting.thisDocumentHasManyNonBasicAsciiUnicodeCharacters', 'This document contains many non-basic ASCII unicode characters'),
                    command: new $8e961b8573a42b51$export$bd2d98ee4f877b7c()
                };
                else if (state.ambiguousCharacterCount >= max) data = {
                    message: $4dEdH.localize('unicodeHighlighting.thisDocumentHasManyAmbiguousUnicodeCharacters', 'This document contains many ambiguous unicode characters'),
                    command: new $8e961b8573a42b51$export$13974d2fac2cb715()
                };
                else if (state.invisibleCharacterCount >= max) data = {
                    message: $4dEdH.localize('unicodeHighlighting.thisDocumentHasManyInvisibleUnicodeCharacters', 'This document contains many invisible unicode characters'),
                    command: new $8e961b8573a42b51$export$a9f1e8c395a54dc4()
                };
                else throw new Error('Unreachable');
                this._bannerController.show({
                    id: 'unicodeHighlightBanner',
                    message: data.message,
                    icon: $8e961b8573a42b51$export$8929e07d808734d0,
                    actions: [
                        {
                            label: data.command.shortLabel,
                            href: `command:${data.command.id}`
                        }
                    ],
                    onClose: ()=>{
                        this._bannerClosed = true;
                    }
                });
            } else this._bannerController.hide();
        };
        this._bannerController = this._register(instantiationService.createInstance((0, $c03b307b3fc04291$export$1da7e17bff54d3c0), _editor));
        this._register(this._editor.onDidChangeModel(()=>{
            this._bannerClosed = false;
            this._updateHighlighter();
        }));
        this._options = _editor.getOption(126 /* EditorOption.unicodeHighlighting */ );
        this._register(_workspaceTrustService.onDidChangeTrust((e)=>{
            this._updateHighlighter();
        }));
        this._register(_editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(126 /* EditorOption.unicodeHighlighting */ )) {
                this._options = _editor.getOption(126 /* EditorOption.unicodeHighlighting */ );
                this._updateHighlighter();
            }
        }));
        this._updateHighlighter();
    }
    dispose() {
        if (this._highlighter) {
            this._highlighter.dispose();
            this._highlighter = null;
        }
        super.dispose();
    }
    _updateHighlighter() {
        this._updateState(null);
        if (this._highlighter) {
            this._highlighter.dispose();
            this._highlighter = null;
        }
        if (!this._editor.hasModel()) return;
        const options = $8e961b8573a42b51$var$resolveOptions(this._workspaceTrustService.isWorkspaceTrusted(), this._options);
        if ([
            options.nonBasicASCII,
            options.ambiguousCharacters,
            options.invisibleCharacters
        ].every((option)=>option === false)) // Don't do anything if the feature is fully disabled
        return;
        const highlightOptions = {
            nonBasicASCII: options.nonBasicASCII,
            ambiguousCharacters: options.ambiguousCharacters,
            invisibleCharacters: options.invisibleCharacters,
            includeComments: options.includeComments,
            includeStrings: options.includeStrings,
            allowedCodePoints: Object.keys(options.allowedCharacters).map((c)=>c.codePointAt(0)),
            allowedLocales: Object.keys(options.allowedLocales).map((locale)=>{
                if (locale === '_os') {
                    const osLocale = new Intl.NumberFormat().resolvedOptions().locale;
                    return osLocale;
                } else if (locale === '_vscode') return $lb0Ah.language;
                return locale;
            })
        };
        if (this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)) this._highlighter = new $8e961b8573a42b51$var$DocumentUnicodeHighlighter(this._editor, highlightOptions, this._updateState, this._editorWorkerService);
        else this._highlighter = new $8e961b8573a42b51$var$ViewportUnicodeHighlighter(this._editor, highlightOptions, this._updateState);
    }
    getDecorationInfo(decoration) {
        if (this._highlighter) return this._highlighter.getDecorationInfo(decoration);
        return null;
    }
};
$8e961b8573a42b51$export$db6ed2fe81e44dff = $8e961b8573a42b51$var$__decorate([
    $8e961b8573a42b51$var$__param(1, (0, $zvLvK.IEditorWorkerService)),
    $8e961b8573a42b51$var$__param(2, (0, $1iEDc.IWorkspaceTrustManagementService)),
    $8e961b8573a42b51$var$__param(3, (0, $fdGPu.IInstantiationService))
], $8e961b8573a42b51$export$db6ed2fe81e44dff);
function $8e961b8573a42b51$var$resolveOptions(trusted, options) {
    return {
        nonBasicASCII: options.nonBasicASCII === (0, $cd4KD.inUntrustedWorkspace) ? !trusted : options.nonBasicASCII,
        ambiguousCharacters: options.ambiguousCharacters,
        invisibleCharacters: options.invisibleCharacters,
        includeComments: options.includeComments === (0, $cd4KD.inUntrustedWorkspace) ? !trusted : options.includeComments,
        includeStrings: options.includeStrings === (0, $cd4KD.inUntrustedWorkspace) ? !trusted : options.includeStrings,
        allowedCharacters: options.allowedCharacters,
        allowedLocales: options.allowedLocales
    };
}
let $8e961b8573a42b51$var$DocumentUnicodeHighlighter = class DocumentUnicodeHighlighter extends (0, $9cWcn.Disposable) {
    constructor(_editor, _options, _updateState, _editorWorkerService){
        super();
        this._editor = _editor;
        this._options = _options;
        this._updateState = _updateState;
        this._editorWorkerService = _editorWorkerService;
        this._model = this._editor.getModel();
        this._decorations = this._editor.createDecorationsCollection();
        this._updateSoon = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._update(), 250));
        this._register(this._editor.onDidChangeModelContent(()=>{
            this._updateSoon.schedule();
        }));
        this._updateSoon.schedule();
    }
    dispose() {
        this._decorations.clear();
        super.dispose();
    }
    _update() {
        if (this._model.isDisposed()) return;
        if (!this._model.mightContainNonBasicASCII()) {
            this._decorations.clear();
            return;
        }
        const modelVersionId = this._model.getVersionId();
        this._editorWorkerService.computedUnicodeHighlights(this._model.uri, this._options).then((info)=>{
            if (this._model.isDisposed()) return;
            if (this._model.getVersionId() !== modelVersionId) // model changed in the meantime
            return;
            this._updateState(info);
            const decorations = [];
            if (!info.hasMore) // Don't show decoration if there are too many.
            // In this case, a banner is shown.
            for (const range of info.ranges)decorations.push({
                range: range,
                options: $8e961b8573a42b51$var$Decorations.instance.getDecorationFromOptions(this._options)
            });
            this._decorations.set(decorations);
        });
    }
    getDecorationInfo(decoration) {
        if (!this._decorations.has(decoration)) return null;
        const model = this._editor.getModel();
        if (!(0, $9mXLU.isModelDecorationVisible)(model, decoration)) return null;
        const text = model.getValueInRange(decoration.range);
        return {
            reason: $8e961b8573a42b51$var$computeReason(text, this._options),
            inComment: (0, $9mXLU.isModelDecorationInComment)(model, decoration),
            inString: (0, $9mXLU.isModelDecorationInString)(model, decoration)
        };
    }
};
$8e961b8573a42b51$var$DocumentUnicodeHighlighter = $8e961b8573a42b51$var$__decorate([
    $8e961b8573a42b51$var$__param(3, (0, $zvLvK.IEditorWorkerService))
], $8e961b8573a42b51$var$DocumentUnicodeHighlighter);
class $8e961b8573a42b51$var$ViewportUnicodeHighlighter extends (0, $9cWcn.Disposable) {
    constructor(_editor, _options, _updateState){
        super();
        this._editor = _editor;
        this._options = _options;
        this._updateState = _updateState;
        this._model = this._editor.getModel();
        this._decorations = this._editor.createDecorationsCollection();
        this._updateSoon = this._register(new (0, $6bXyA.RunOnceScheduler)(()=>this._update(), 250));
        this._register(this._editor.onDidLayoutChange(()=>{
            this._updateSoon.schedule();
        }));
        this._register(this._editor.onDidScrollChange(()=>{
            this._updateSoon.schedule();
        }));
        this._register(this._editor.onDidChangeHiddenAreas(()=>{
            this._updateSoon.schedule();
        }));
        this._register(this._editor.onDidChangeModelContent(()=>{
            this._updateSoon.schedule();
        }));
        this._updateSoon.schedule();
    }
    dispose() {
        this._decorations.clear();
        super.dispose();
    }
    _update() {
        if (this._model.isDisposed()) return;
        if (!this._model.mightContainNonBasicASCII()) {
            this._decorations.clear();
            return;
        }
        const ranges = this._editor.getVisibleRanges();
        const decorations = [];
        const totalResult = {
            ranges: [],
            ambiguousCharacterCount: 0,
            invisibleCharacterCount: 0,
            nonBasicAsciiCharacterCount: 0,
            hasMore: false
        };
        for (const range of ranges){
            const result = (0, $eJwQl.UnicodeTextModelHighlighter).computeUnicodeHighlights(this._model, this._options, range);
            for (const r of result.ranges)totalResult.ranges.push(r);
            totalResult.ambiguousCharacterCount += totalResult.ambiguousCharacterCount;
            totalResult.invisibleCharacterCount += totalResult.invisibleCharacterCount;
            totalResult.nonBasicAsciiCharacterCount += totalResult.nonBasicAsciiCharacterCount;
            totalResult.hasMore = totalResult.hasMore || result.hasMore;
        }
        if (!totalResult.hasMore) // Don't show decorations if there are too many.
        // A banner will be shown instead.
        for (const range of totalResult.ranges)decorations.push({
            range: range,
            options: $8e961b8573a42b51$var$Decorations.instance.getDecorationFromOptions(this._options)
        });
        this._updateState(totalResult);
        this._decorations.set(decorations);
    }
    getDecorationInfo(decoration) {
        if (!this._decorations.has(decoration)) return null;
        const model = this._editor.getModel();
        const text = model.getValueInRange(decoration.range);
        if (!(0, $9mXLU.isModelDecorationVisible)(model, decoration)) return null;
        return {
            reason: $8e961b8573a42b51$var$computeReason(text, this._options),
            inComment: (0, $9mXLU.isModelDecorationInComment)(model, decoration),
            inString: (0, $9mXLU.isModelDecorationInString)(model, decoration)
        };
    }
}
const $8e961b8573a42b51$var$configureUnicodeHighlightOptionsStr = $4dEdH.localize('unicodeHighlight.configureUnicodeHighlightOptions', 'Configure Unicode Highlight Options');
let $8e961b8573a42b51$export$abfb214dc8905583 = class UnicodeHighlighterHoverParticipant {
    constructor(_editor, _languageService, _openerService){
        this._editor = _editor;
        this._languageService = _languageService;
        this._openerService = _openerService;
        this.hoverOrdinal = 5;
    }
    computeSync(anchor, lineDecorations) {
        if (!this._editor.hasModel() || anchor.type !== 1 /* HoverAnchorType.Range */ ) return [];
        const model = this._editor.getModel();
        const unicodeHighlighter = this._editor.getContribution($8e961b8573a42b51$export$db6ed2fe81e44dff.ID);
        if (!unicodeHighlighter) return [];
        const result = [];
        const existedReason = new Set();
        let index = 300;
        for (const d of lineDecorations){
            const highlightInfo = unicodeHighlighter.getDecorationInfo(d);
            if (!highlightInfo) continue;
            const char = model.getValueInRange(d.range);
            // text refers to a single character.
            const codePoint = char.codePointAt(0);
            const codePointStr = $8e961b8573a42b51$var$formatCodePointMarkdown(codePoint);
            let reason;
            switch(highlightInfo.reason.kind){
                case 0 /* UnicodeHighlighterReasonKind.Ambiguous */ :
                    if ((0, $jcr1R.isBasicASCII)(highlightInfo.reason.confusableWith)) reason = $4dEdH.localize('unicodeHighlight.characterIsAmbiguousASCII', 'The character {0} could be confused with the ASCII character {1}, which is more common in source code.', codePointStr, $8e961b8573a42b51$var$formatCodePointMarkdown(highlightInfo.reason.confusableWith.codePointAt(0)));
                    else reason = $4dEdH.localize('unicodeHighlight.characterIsAmbiguous', 'The character {0} could be confused with the character {1}, which is more common in source code.', codePointStr, $8e961b8573a42b51$var$formatCodePointMarkdown(highlightInfo.reason.confusableWith.codePointAt(0)));
                    break;
                case 1 /* UnicodeHighlighterReasonKind.Invisible */ :
                    reason = $4dEdH.localize('unicodeHighlight.characterIsInvisible', 'The character {0} is invisible.', codePointStr);
                    break;
                case 2 /* UnicodeHighlighterReasonKind.NonBasicAscii */ :
                    reason = $4dEdH.localize('unicodeHighlight.characterIsNonBasicAscii', 'The character {0} is not a basic ASCII character.', codePointStr);
                    break;
            }
            if (existedReason.has(reason)) continue;
            existedReason.add(reason);
            const adjustSettingsArgs = {
                codePoint: codePoint,
                reason: highlightInfo.reason,
                inComment: highlightInfo.inComment,
                inString: highlightInfo.inString
            };
            const adjustSettings = $4dEdH.localize('unicodeHighlight.adjustSettings', 'Adjust settings');
            const uri = `command:${$8e961b8573a42b51$export$cc3a119c1042a4c8.ID}?${encodeURIComponent(JSON.stringify(adjustSettingsArgs))}`;
            const markdown = new (0, $iGmb0.MarkdownString)('', true).appendMarkdown(reason).appendText(' ').appendLink(uri, adjustSettings, $8e961b8573a42b51$var$configureUnicodeHighlightOptionsStr);
            result.push(new (0, $9195b2d03426c505$export$de5210377542b3f9)(this, d.range, [
                markdown
            ], false, index++));
        }
        return result;
    }
    renderHoverParts(context, hoverParts) {
        return (0, $9195b2d03426c505$export$d74d68ef545bd110)(context, hoverParts, this._editor, this._languageService, this._openerService);
    }
};
$8e961b8573a42b51$export$abfb214dc8905583 = $8e961b8573a42b51$var$__decorate([
    $8e961b8573a42b51$var$__param(1, (0, $h9Xpp.ILanguageService)),
    $8e961b8573a42b51$var$__param(2, (0, $iAi3o.IOpenerService))
], $8e961b8573a42b51$export$abfb214dc8905583);
function $8e961b8573a42b51$var$codePointToHex(codePoint) {
    return `U+${codePoint.toString(16).padStart(4, '0')}`;
}
function $8e961b8573a42b51$var$formatCodePointMarkdown(codePoint) {
    let value = `\`${$8e961b8573a42b51$var$codePointToHex(codePoint)}\``;
    if (!(0, $jcr1R.InvisibleCharacters).isInvisibleCharacter(codePoint)) // Don't render any control characters or any invisible characters, as they cannot be seen anyways.
    value += ` "${`${$8e961b8573a42b51$var$renderCodePointAsInlineCode(codePoint)}`}"`;
    return value;
}
function $8e961b8573a42b51$var$renderCodePointAsInlineCode(codePoint) {
    if (codePoint === 96 /* CharCode.BackTick */ ) return '`` ` ``';
    return '`' + String.fromCodePoint(codePoint) + '`';
}
function $8e961b8573a42b51$var$computeReason(char, options) {
    return (0, $eJwQl.UnicodeTextModelHighlighter).computeUnicodeHighlightReason(char, options);
}
class $8e961b8573a42b51$var$Decorations {
    constructor(){
        this.map = new Map();
    }
    static{
        this.instance = new $8e961b8573a42b51$var$Decorations();
    }
    getDecorationFromOptions(options) {
        return this.getDecoration(!options.includeComments, !options.includeStrings);
    }
    getDecoration(hideInComments, hideInStrings) {
        const key = `${hideInComments}${hideInStrings}`;
        let options = this.map.get(key);
        if (!options) {
            options = (0, $91ntV.ModelDecorationOptions).createDynamic({
                description: 'unicode-highlight',
                stickiness: 1 /* TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges */ ,
                className: 'unicode-highlight',
                showIfCollapsed: true,
                overviewRuler: null,
                minimap: null,
                hideInCommentTokens: hideInComments,
                hideInStringTokens: hideInStrings
            });
            this.map.set(key, options);
        }
        return options;
    }
}
class $8e961b8573a42b51$export$dc2470067369c56e extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: $8e961b8573a42b51$export$13974d2fac2cb715.ID,
            label: $4dEdH.localize('action.unicodeHighlight.disableHighlightingInComments', 'Disable highlighting of characters in comments'),
            alias: 'Disable highlighting of characters in comments',
            precondition: undefined
        });
        this.shortLabel = $4dEdH.localize('unicodeHighlight.disableHighlightingInComments.shortLabel', 'Disable Highlight In Comments');
    }
    async run(accessor, editor, args) {
        const configurationService = accessor?.get((0, $35IZ9.IConfigurationService));
        if (configurationService) this.runAction(configurationService);
    }
    async runAction(configurationService) {
        await configurationService.updateValue((0, $cd4KD.unicodeHighlightConfigKeys).includeComments, false, 2 /* ConfigurationTarget.USER */ );
    }
}
class $8e961b8573a42b51$export$426c6c2e8928f8f2 extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: $8e961b8573a42b51$export$13974d2fac2cb715.ID,
            label: $4dEdH.localize('action.unicodeHighlight.disableHighlightingInStrings', 'Disable highlighting of characters in strings'),
            alias: 'Disable highlighting of characters in strings',
            precondition: undefined
        });
        this.shortLabel = $4dEdH.localize('unicodeHighlight.disableHighlightingInStrings.shortLabel', 'Disable Highlight In Strings');
    }
    async run(accessor, editor, args) {
        const configurationService = accessor?.get((0, $35IZ9.IConfigurationService));
        if (configurationService) this.runAction(configurationService);
    }
    async runAction(configurationService) {
        await configurationService.updateValue((0, $cd4KD.unicodeHighlightConfigKeys).includeStrings, false, 2 /* ConfigurationTarget.USER */ );
    }
}
class $8e961b8573a42b51$export$13974d2fac2cb715 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters';
    }
    constructor(){
        super({
            id: $8e961b8573a42b51$export$13974d2fac2cb715.ID,
            label: $4dEdH.localize('action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters', 'Disable highlighting of ambiguous characters'),
            alias: 'Disable highlighting of ambiguous characters',
            precondition: undefined
        });
        this.shortLabel = $4dEdH.localize('unicodeHighlight.disableHighlightingOfAmbiguousCharacters.shortLabel', 'Disable Ambiguous Highlight');
    }
    async run(accessor, editor, args) {
        const configurationService = accessor?.get((0, $35IZ9.IConfigurationService));
        if (configurationService) this.runAction(configurationService);
    }
    async runAction(configurationService) {
        await configurationService.updateValue((0, $cd4KD.unicodeHighlightConfigKeys).ambiguousCharacters, false, 2 /* ConfigurationTarget.USER */ );
    }
}
class $8e961b8573a42b51$export$a9f1e8c395a54dc4 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters';
    }
    constructor(){
        super({
            id: $8e961b8573a42b51$export$a9f1e8c395a54dc4.ID,
            label: $4dEdH.localize('action.unicodeHighlight.disableHighlightingOfInvisibleCharacters', 'Disable highlighting of invisible characters'),
            alias: 'Disable highlighting of invisible characters',
            precondition: undefined
        });
        this.shortLabel = $4dEdH.localize('unicodeHighlight.disableHighlightingOfInvisibleCharacters.shortLabel', 'Disable Invisible Highlight');
    }
    async run(accessor, editor, args) {
        const configurationService = accessor?.get((0, $35IZ9.IConfigurationService));
        if (configurationService) this.runAction(configurationService);
    }
    async runAction(configurationService) {
        await configurationService.updateValue((0, $cd4KD.unicodeHighlightConfigKeys).invisibleCharacters, false, 2 /* ConfigurationTarget.USER */ );
    }
}
class $8e961b8573a42b51$export$bd2d98ee4f877b7c extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters';
    }
    constructor(){
        super({
            id: $8e961b8573a42b51$export$bd2d98ee4f877b7c.ID,
            label: $4dEdH.localize('action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters', 'Disable highlighting of non basic ASCII characters'),
            alias: 'Disable highlighting of non basic ASCII characters',
            precondition: undefined
        });
        this.shortLabel = $4dEdH.localize('unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters.shortLabel', 'Disable Non ASCII Highlight');
    }
    async run(accessor, editor, args) {
        const configurationService = accessor?.get((0, $35IZ9.IConfigurationService));
        if (configurationService) this.runAction(configurationService);
    }
    async runAction(configurationService) {
        await configurationService.updateValue((0, $cd4KD.unicodeHighlightConfigKeys).nonBasicASCII, false, 2 /* ConfigurationTarget.USER */ );
    }
}
class $8e961b8573a42b51$export$cc3a119c1042a4c8 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.unicodeHighlight.showExcludeOptions';
    }
    constructor(){
        super({
            id: $8e961b8573a42b51$export$cc3a119c1042a4c8.ID,
            label: $4dEdH.localize('action.unicodeHighlight.showExcludeOptions', "Show Exclude Options"),
            alias: 'Show Exclude Options',
            precondition: undefined
        });
    }
    async run(accessor, editor, args) {
        const { codePoint: codePoint, reason: reason, inString: inString, inComment: inComment } = args;
        const char = String.fromCodePoint(codePoint);
        const quickPickService = accessor.get((0, $3XkzC.IQuickInputService));
        const configurationService = accessor.get((0, $35IZ9.IConfigurationService));
        function getExcludeCharFromBeingHighlightedLabel(codePoint) {
            if ((0, $jcr1R.InvisibleCharacters).isInvisibleCharacter(codePoint)) return $4dEdH.localize('unicodeHighlight.excludeInvisibleCharFromBeingHighlighted', 'Exclude {0} (invisible character) from being highlighted', $8e961b8573a42b51$var$codePointToHex(codePoint));
            return $4dEdH.localize('unicodeHighlight.excludeCharFromBeingHighlighted', 'Exclude {0} from being highlighted', `${$8e961b8573a42b51$var$codePointToHex(codePoint)} "${char}"`);
        }
        const options = [];
        if (reason.kind === 0 /* UnicodeHighlighterReasonKind.Ambiguous */ ) for (const locale of reason.notAmbiguousInLocales)options.push({
            label: $4dEdH.localize("unicodeHighlight.allowCommonCharactersInLanguage", "Allow unicode characters that are more common in the language \"{0}\".", locale),
            run: async ()=>{
                $8e961b8573a42b51$var$excludeLocaleFromBeingHighlighted(configurationService, [
                    locale
                ]);
            }
        });
        options.push({
            label: getExcludeCharFromBeingHighlightedLabel(codePoint),
            run: ()=>$8e961b8573a42b51$var$excludeCharFromBeingHighlighted(configurationService, [
                    codePoint
                ])
        });
        if (inComment) {
            const action = new $8e961b8573a42b51$export$dc2470067369c56e();
            options.push({
                label: action.label,
                run: async ()=>action.runAction(configurationService)
            });
        } else if (inString) {
            const action = new $8e961b8573a42b51$export$426c6c2e8928f8f2();
            options.push({
                label: action.label,
                run: async ()=>action.runAction(configurationService)
            });
        }
        if (reason.kind === 0 /* UnicodeHighlighterReasonKind.Ambiguous */ ) {
            const action = new $8e961b8573a42b51$export$13974d2fac2cb715();
            options.push({
                label: action.label,
                run: async ()=>action.runAction(configurationService)
            });
        } else if (reason.kind === 1 /* UnicodeHighlighterReasonKind.Invisible */ ) {
            const action = new $8e961b8573a42b51$export$a9f1e8c395a54dc4();
            options.push({
                label: action.label,
                run: async ()=>action.runAction(configurationService)
            });
        } else if (reason.kind === 2 /* UnicodeHighlighterReasonKind.NonBasicAscii */ ) {
            const action = new $8e961b8573a42b51$export$bd2d98ee4f877b7c();
            options.push({
                label: action.label,
                run: async ()=>action.runAction(configurationService)
            });
        } else $8e961b8573a42b51$var$expectNever(reason);
        const result = await quickPickService.pick(options, {
            title: $8e961b8573a42b51$var$configureUnicodeHighlightOptionsStr
        });
        if (result) await result.run();
    }
}
async function $8e961b8573a42b51$var$excludeCharFromBeingHighlighted(configurationService, charCodes) {
    const existingValue = configurationService.getValue((0, $cd4KD.unicodeHighlightConfigKeys).allowedCharacters);
    let value;
    if (typeof existingValue === 'object' && existingValue) value = existingValue;
    else value = {};
    for (const charCode of charCodes)value[String.fromCodePoint(charCode)] = true;
    await configurationService.updateValue((0, $cd4KD.unicodeHighlightConfigKeys).allowedCharacters, value, 2 /* ConfigurationTarget.USER */ );
}
async function $8e961b8573a42b51$var$excludeLocaleFromBeingHighlighted(configurationService, locales) {
    const existingValue = configurationService.inspect((0, $cd4KD.unicodeHighlightConfigKeys).allowedLocales).user?.value;
    let value;
    if (typeof existingValue === 'object' && existingValue) // Copy value, as the existing value is read only
    value = Object.assign({}, existingValue);
    else value = {};
    for (const locale of locales)value[locale] = true;
    await configurationService.updateValue((0, $cd4KD.unicodeHighlightConfigKeys).allowedLocales, value, 2 /* ConfigurationTarget.USER */ );
}
function $8e961b8573a42b51$var$expectNever(value) {
    throw new Error(`Unexpected value: ${value}`);
}
(0, $2iJTi.registerEditorAction)($8e961b8573a42b51$export$13974d2fac2cb715);
(0, $2iJTi.registerEditorAction)($8e961b8573a42b51$export$a9f1e8c395a54dc4);
(0, $2iJTi.registerEditorAction)($8e961b8573a42b51$export$bd2d98ee4f877b7c);
(0, $2iJTi.registerEditorAction)($8e961b8573a42b51$export$cc3a119c1042a4c8);
(0, $2iJTi.registerEditorContribution)($8e961b8573a42b51$export$db6ed2fe81e44dff.ID, $8e961b8573a42b51$export$db6ed2fe81e44dff, 1 /* EditorContributionInstantiation.AfterFirstRender */ );
(0, $4760294cb1bcf994$export$fc2e2429672a46bc).register($8e961b8573a42b51$export$abfb214dc8905583);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $5Aea5 = parcelRequire("5Aea5");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $4dEdH = parcelRequire("4dEdH");

var $iERup = parcelRequire("iERup");
var $f943d9f035700ed6$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $f943d9f035700ed6$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
const $f943d9f035700ed6$var$ignoreUnusualLineTerminators = 'ignoreUnusualLineTerminators';
function $f943d9f035700ed6$var$writeIgnoreState(codeEditorService, model, state) {
    codeEditorService.setModelProperty(model.uri, $f943d9f035700ed6$var$ignoreUnusualLineTerminators, state);
}
function $f943d9f035700ed6$var$readIgnoreState(codeEditorService, model) {
    return codeEditorService.getModelProperty(model.uri, $f943d9f035700ed6$var$ignoreUnusualLineTerminators);
}
let $f943d9f035700ed6$export$ac2e48bc5d9c728f = class UnusualLineTerminatorsDetector extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.unusualLineTerminatorsDetector';
    }
    constructor(_editor, _dialogService, _codeEditorService){
        super();
        this._editor = _editor;
        this._dialogService = _dialogService;
        this._codeEditorService = _codeEditorService;
        this._isPresentingDialog = false;
        this._config = this._editor.getOption(127 /* EditorOption.unusualLineTerminators */ );
        this._register(this._editor.onDidChangeConfiguration((e)=>{
            if (e.hasChanged(127 /* EditorOption.unusualLineTerminators */ )) {
                this._config = this._editor.getOption(127 /* EditorOption.unusualLineTerminators */ );
                this._checkForUnusualLineTerminators();
            }
        }));
        this._register(this._editor.onDidChangeModel(()=>{
            this._checkForUnusualLineTerminators();
        }));
        this._register(this._editor.onDidChangeModelContent((e)=>{
            if (e.isUndoing) // skip checking in case of undoing
            return;
            this._checkForUnusualLineTerminators();
        }));
        this._checkForUnusualLineTerminators();
    }
    async _checkForUnusualLineTerminators() {
        if (this._config === 'off') return;
        if (!this._editor.hasModel()) return;
        const model = this._editor.getModel();
        if (!model.mightContainUnusualLineTerminators()) return;
        const ignoreState = $f943d9f035700ed6$var$readIgnoreState(this._codeEditorService, model);
        if (ignoreState === true) // this model should be ignored
        return;
        if (this._editor.getOption(92 /* EditorOption.readOnly */ )) // read only editor => sorry!
        return;
        if (this._config === 'auto') {
            // just do it!
            model.removeUnusualLineTerminators(this._editor.getSelections());
            return;
        }
        if (this._isPresentingDialog) // we're currently showing the dialog, which is async.
        // avoid spamming the user
        return;
        let result;
        try {
            this._isPresentingDialog = true;
            result = await this._dialogService.confirm({
                title: $4dEdH.localize('unusualLineTerminators.title', "Unusual Line Terminators"),
                message: $4dEdH.localize('unusualLineTerminators.message', "Detected unusual line terminators"),
                detail: $4dEdH.localize('unusualLineTerminators.detail', "The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).\n\nIt is recommended to remove them from the file. This can be configured via `editor.unusualLineTerminators`.", (0, $5Aea5.basename)(model.uri)),
                primaryButton: $4dEdH.localize({
                    key: 'unusualLineTerminators.fix',
                    comment: [
                        '&& denotes a mnemonic'
                    ]
                }, "&&Remove Unusual Line Terminators"),
                cancelButton: $4dEdH.localize('unusualLineTerminators.ignore', "Ignore")
            });
        } finally{
            this._isPresentingDialog = false;
        }
        if (!result.confirmed) {
            // this model should be ignored
            $f943d9f035700ed6$var$writeIgnoreState(this._codeEditorService, model, true);
            return;
        }
        model.removeUnusualLineTerminators(this._editor.getSelections());
    }
};
$f943d9f035700ed6$export$ac2e48bc5d9c728f = $f943d9f035700ed6$var$__decorate([
    $f943d9f035700ed6$var$__param(1, (0, $iERup.IDialogService)),
    $f943d9f035700ed6$var$__param(2, (0, $2Qfl0.ICodeEditorService))
], $f943d9f035700ed6$export$ac2e48bc5d9c728f);
(0, $2iJTi.registerEditorContribution)($f943d9f035700ed6$export$ac2e48bc5d9c728f.ID, $f943d9f035700ed6$export$ac2e48bc5d9c728f, 1 /* EditorContributionInstantiation.AfterFirstRender */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4dEdH = parcelRequire("4dEdH");

var $aIbUW = parcelRequire("aIbUW");

var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $gPkHZ = parcelRequire("gPkHZ");

var $9cWcn = parcelRequire("9cWcn");

var $7UXLG = parcelRequire("7UXLG");

var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");

var $1Y4vr = parcelRequire("1Y4vr");

var $4J6fu = parcelRequire("4J6fu");


var $cxCeF = parcelRequire("cxCeF");

var $8GPp8 = parcelRequire("8GPp8");

var $askDf = parcelRequire("askDf");

var $gT05r = parcelRequire("gT05r");

var $5Aea5 = parcelRequire("5Aea5");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $eeAIY = parcelRequire("eeAIY");

var $4J6fu = parcelRequire("4J6fu");

var $kzNQX = parcelRequire("kzNQX");

var $9cWcn = parcelRequire("9cWcn");

var $askDf = parcelRequire("askDf");
var $6cc2bb5b47b14c92$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $6cc2bb5b47b14c92$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
class $6cc2bb5b47b14c92$var$TextualDocumentHighlightProvider {
    constructor(){
        this.selector = {
            language: '*'
        };
    }
    provideDocumentHighlights(model, position, token) {
        const result = [];
        const word = model.getWordAtPosition({
            lineNumber: position.lineNumber,
            column: position.column
        });
        if (!word) return Promise.resolve(result);
        if (model.isDisposed()) return;
        const matches = model.findMatches(word.word, true, false, true, (0, $eeAIY.USUAL_WORD_SEPARATORS), false);
        return matches.map((m)=>({
                range: m.range,
                kind: (0, $kzNQX.DocumentHighlightKind).Text
            }));
    }
    provideMultiDocumentHighlights(primaryModel, position, otherModels, token) {
        const result = new (0, $askDf.ResourceMap)();
        const word = primaryModel.getWordAtPosition({
            lineNumber: position.lineNumber,
            column: position.column
        });
        if (!word) return Promise.resolve(result);
        for (const model of [
            primaryModel,
            ...otherModels
        ]){
            if (model.isDisposed()) continue;
            const matches = model.findMatches(word.word, true, false, true, (0, $eeAIY.USUAL_WORD_SEPARATORS), false);
            const highlights = matches.map((m)=>({
                    range: m.range,
                    kind: (0, $kzNQX.DocumentHighlightKind).Text
                }));
            if (highlights) result.set(model.uri, highlights);
        }
        return result;
    }
}
let $6cc2bb5b47b14c92$export$fce3f78f200d8fd1 = class TextualMultiDocumentHighlightFeature extends (0, $9cWcn.Disposable) {
    constructor(languageFeaturesService){
        super();
        this._register(languageFeaturesService.documentHighlightProvider.register('*', new $6cc2bb5b47b14c92$var$TextualDocumentHighlightProvider()));
        this._register(languageFeaturesService.multiDocumentHighlightProvider.register('*', new $6cc2bb5b47b14c92$var$TextualDocumentHighlightProvider()));
    }
};
$6cc2bb5b47b14c92$export$fce3f78f200d8fd1 = $6cc2bb5b47b14c92$var$__decorate([
    $6cc2bb5b47b14c92$var$__param(0, (0, $4J6fu.ILanguageFeaturesService))
], $6cc2bb5b47b14c92$export$fce3f78f200d8fd1);



var $54y8R = parcelRequire("54y8R");
var $c0ca017d77cb1a74$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $c0ca017d77cb1a74$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $c0ca017d77cb1a74$var$WordHighlighter_1, $c0ca017d77cb1a74$var$WordHighlighterContribution_1;
const $c0ca017d77cb1a74$var$ctxHasWordHighlights = new (0, $cxCeF.RawContextKey)('hasWordHighlights', false);
function $c0ca017d77cb1a74$export$25c73b4d2077057f(registry, model, position, token) {
    const orderedByScore = registry.ordered(model);
    // in order of score ask the occurrences provider
    // until someone response with a good result
    // (good = non undefined and non null value)
    // (result of size == 0 is valid, no highlights is a valid/expected result -- not a signal to fall back to other providers)
    return (0, $6bXyA.first)(orderedByScore.map((provider)=>()=>{
            return Promise.resolve(provider.provideDocumentHighlights(model, position, token)).then(undefined, (0, $gPkHZ.onUnexpectedExternalError));
        }), (result)=>result !== undefined && result !== null).then((result)=>{
        if (result) {
            const map = new (0, $askDf.ResourceMap)();
            map.set(model.uri, result);
            return map;
        }
        return new (0, $askDf.ResourceMap)();
    });
}
function $c0ca017d77cb1a74$export$66ede4bcf4a5880f(registry, model, position, wordSeparators, token, otherModels) {
    const orderedByScore = registry.ordered(model);
    // in order of score ask the occurrences provider
    // until someone response with a good result
    // (good = non undefined and non null ResourceMap)
    // (result of size == 0 is valid, no highlights is a valid/expected result -- not a signal to fall back to other providers)
    return (0, $6bXyA.first)(orderedByScore.map((provider)=>()=>{
            const filteredModels = otherModels.filter((otherModel)=>{
                return (0, $1Y4vr.shouldSynchronizeModel)(otherModel);
            }).filter((otherModel)=>{
                return (0, $gT05r.score)(provider.selector, otherModel.uri, otherModel.getLanguageId(), true, undefined, undefined) > 0;
            });
            return Promise.resolve(provider.provideMultiDocumentHighlights(model, position, filteredModels, token)).then(undefined, (0, $gPkHZ.onUnexpectedExternalError));
        }), (result)=>result !== undefined && result !== null);
}
class $c0ca017d77cb1a74$var$OccurenceAtPositionRequest {
    constructor(_model, _selection, _wordSeparators){
        this._model = _model;
        this._selection = _selection;
        this._wordSeparators = _wordSeparators;
        this._wordRange = this._getCurrentWordRange(_model, _selection);
        this._result = null;
    }
    get result() {
        if (!this._result) this._result = (0, $6bXyA.createCancelablePromise)((token)=>this._compute(this._model, this._selection, this._wordSeparators, token));
        return this._result;
    }
    _getCurrentWordRange(model, selection) {
        const word = model.getWordAtPosition(selection.getPosition());
        if (word) return new (0, $d00il.Range)(selection.startLineNumber, word.startColumn, selection.startLineNumber, word.endColumn);
        return null;
    }
    isValid(model, selection, decorations) {
        const lineNumber = selection.startLineNumber;
        const startColumn = selection.startColumn;
        const endColumn = selection.endColumn;
        const currentWordRange = this._getCurrentWordRange(model, selection);
        let requestIsValid = Boolean(this._wordRange && this._wordRange.equalsRange(currentWordRange));
        // Even if we are on a different word, if that word is in the decorations ranges, the request is still valid
        // (Same symbol)
        for(let i = 0, len = decorations.length; !requestIsValid && i < len; i++){
            const range = decorations.getRange(i);
            if (range && range.startLineNumber === lineNumber) {
                if (range.startColumn <= startColumn && range.endColumn >= endColumn) requestIsValid = true;
            }
        }
        return requestIsValid;
    }
    cancel() {
        this.result.cancel();
    }
}
class $c0ca017d77cb1a74$var$SemanticOccurenceAtPositionRequest extends $c0ca017d77cb1a74$var$OccurenceAtPositionRequest {
    constructor(model, selection, wordSeparators, providers){
        super(model, selection, wordSeparators);
        this._providers = providers;
    }
    _compute(model, selection, wordSeparators, token) {
        return $c0ca017d77cb1a74$export$25c73b4d2077057f(this._providers, model, selection.getPosition(), token).then((value)=>{
            if (!value) return new (0, $askDf.ResourceMap)();
            return value;
        });
    }
}
class $c0ca017d77cb1a74$var$MultiModelOccurenceRequest extends $c0ca017d77cb1a74$var$OccurenceAtPositionRequest {
    constructor(model, selection, wordSeparators, providers, otherModels){
        super(model, selection, wordSeparators);
        this._providers = providers;
        this._otherModels = otherModels;
    }
    _compute(model, selection, wordSeparators, token) {
        return $c0ca017d77cb1a74$export$66ede4bcf4a5880f(this._providers, model, selection.getPosition(), wordSeparators, token, this._otherModels).then((value)=>{
            if (!value) return new (0, $askDf.ResourceMap)();
            return value;
        });
    }
}
function $c0ca017d77cb1a74$var$computeOccurencesAtPosition(registry, model, selection, word, wordSeparators) {
    return new $c0ca017d77cb1a74$var$SemanticOccurenceAtPositionRequest(model, selection, wordSeparators, registry);
}
function $c0ca017d77cb1a74$var$computeOccurencesMultiModel(registry, model, selection, word, wordSeparators, otherModels) {
    return new $c0ca017d77cb1a74$var$MultiModelOccurenceRequest(model, selection, wordSeparators, registry, otherModels);
}
(0, $2iJTi.registerModelAndPositionCommand)('_executeDocumentHighlights', async (accessor, model, position)=>{
    const languageFeaturesService = accessor.get((0, $4J6fu.ILanguageFeaturesService));
    const map = await $c0ca017d77cb1a74$export$25c73b4d2077057f(languageFeaturesService.documentHighlightProvider, model, position, (0, $giPcZ.CancellationToken).None);
    return map?.get(model.uri);
});
let $c0ca017d77cb1a74$var$WordHighlighter = class WordHighlighter {
    static{
        $c0ca017d77cb1a74$var$WordHighlighter_1 = this;
    }
    static{
        this.storedDecorationIDs = new (0, $askDf.ResourceMap)();
    }
    static{
        this.query = null;
    }
    constructor(editor, providers, multiProviders, contextKeyService, codeEditorService){
        this.toUnhook = new (0, $9cWcn.DisposableStore)();
        this.workerRequestTokenId = 0;
        this.workerRequestCompleted = false;
        this.workerRequestValue = new (0, $askDf.ResourceMap)();
        this.lastCursorPositionChangeTime = 0;
        this.renderDecorationsTimer = -1;
        this.runDelayer = this.toUnhook.add(new (0, $6bXyA.Delayer)(50));
        this.editor = editor;
        this.providers = providers;
        this.multiDocumentProviders = multiProviders;
        this.codeEditorService = codeEditorService;
        this._hasWordHighlights = $c0ca017d77cb1a74$var$ctxHasWordHighlights.bindTo(contextKeyService);
        this._ignorePositionChangeEvent = false;
        this.occurrencesHighlight = this.editor.getOption(81 /* EditorOption.occurrencesHighlight */ );
        this.model = this.editor.getModel();
        this.toUnhook.add(editor.onDidChangeCursorPosition((e)=>{
            if (this._ignorePositionChangeEvent) // We are changing the position => ignore this event
            return;
            if (this.occurrencesHighlight === 'off') // Early exit if nothing needs to be done!
            // Leave some form of early exit check here if you wish to continue being a cursor position change listener ;)
            return;
            this.runDelayer.trigger(()=>{
                this._onPositionChanged(e);
            });
        }));
        this.toUnhook.add(editor.onDidFocusEditorText((e)=>{
            if (this.occurrencesHighlight === 'off') // Early exit if nothing needs to be done
            return;
            if (!this.workerRequest) this.runDelayer.trigger(()=>{
                this._run();
            });
        }));
        this.toUnhook.add(editor.onDidChangeModelContent((e)=>{
            if (!(0, $8GPp8.matchesScheme)(this.model.uri, 'output')) this._stopAll();
        }));
        this.toUnhook.add(editor.onDidChangeModel((e)=>{
            if (!e.newModelUrl && e.oldModelUrl) this._stopSingular();
            else if ($c0ca017d77cb1a74$var$WordHighlighter_1.query) this._run();
        }));
        this.toUnhook.add(editor.onDidChangeConfiguration((e)=>{
            const newValue = this.editor.getOption(81 /* EditorOption.occurrencesHighlight */ );
            if (this.occurrencesHighlight !== newValue) {
                this.occurrencesHighlight = newValue;
                switch(newValue){
                    case 'off':
                        this._stopAll();
                        break;
                    case 'singleFile':
                        this._stopAll($c0ca017d77cb1a74$var$WordHighlighter_1.query?.modelInfo?.model);
                        break;
                    case 'multiFile':
                        if ($c0ca017d77cb1a74$var$WordHighlighter_1.query) this._run(true);
                        break;
                    default:
                        console.warn('Unknown occurrencesHighlight setting value:', newValue);
                        break;
                }
            }
        }));
        this.decorations = this.editor.createDecorationsCollection();
        this.workerRequestTokenId = 0;
        this.workerRequest = null;
        this.workerRequestCompleted = false;
        this.lastCursorPositionChangeTime = 0;
        this.renderDecorationsTimer = -1;
        // if there is a query already, highlight off that query
        if ($c0ca017d77cb1a74$var$WordHighlighter_1.query) this._run();
    }
    hasDecorations() {
        return this.decorations.length > 0;
    }
    restore() {
        if (this.occurrencesHighlight === 'off') return;
        this.runDelayer.cancel();
        this._run();
    }
    _getSortedHighlights() {
        return this.decorations.getRanges().sort((0, $d00il.Range).compareRangesUsingStarts);
    }
    moveNext() {
        const highlights = this._getSortedHighlights();
        const index = highlights.findIndex((range)=>range.containsPosition(this.editor.getPosition()));
        const newIndex = (index + 1) % highlights.length;
        const dest = highlights[newIndex];
        try {
            this._ignorePositionChangeEvent = true;
            this.editor.setPosition(dest.getStartPosition());
            this.editor.revealRangeInCenterIfOutsideViewport(dest);
            const word = this._getWord();
            if (word) {
                const lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);
                (0, $aIbUW.alert)(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);
            }
        } finally{
            this._ignorePositionChangeEvent = false;
        }
    }
    moveBack() {
        const highlights = this._getSortedHighlights();
        const index = highlights.findIndex((range)=>range.containsPosition(this.editor.getPosition()));
        const newIndex = (index - 1 + highlights.length) % highlights.length;
        const dest = highlights[newIndex];
        try {
            this._ignorePositionChangeEvent = true;
            this.editor.setPosition(dest.getStartPosition());
            this.editor.revealRangeInCenterIfOutsideViewport(dest);
            const word = this._getWord();
            if (word) {
                const lineContent = this.editor.getModel().getLineContent(dest.startLineNumber);
                (0, $aIbUW.alert)(`${lineContent}, ${newIndex + 1} of ${highlights.length} for '${word.word}'`);
            }
        } finally{
            this._ignorePositionChangeEvent = false;
        }
    }
    _removeSingleDecorations() {
        // return if no model
        if (!this.editor.hasModel()) return;
        const currentDecorationIDs = $c0ca017d77cb1a74$var$WordHighlighter_1.storedDecorationIDs.get(this.editor.getModel().uri);
        if (!currentDecorationIDs) return;
        this.editor.removeDecorations(currentDecorationIDs);
        $c0ca017d77cb1a74$var$WordHighlighter_1.storedDecorationIDs.delete(this.editor.getModel().uri);
        if (this.decorations.length > 0) {
            this.decorations.clear();
            this._hasWordHighlights.set(false);
        }
    }
    _removeAllDecorations(preservedModel) {
        const currentEditors = this.codeEditorService.listCodeEditors();
        const deleteURI = [];
        // iterate over editors and store models in currentModels
        for (const editor of currentEditors){
            if (!editor.hasModel() || (0, $5Aea5.isEqual)(editor.getModel().uri, preservedModel?.uri)) continue;
            const currentDecorationIDs = $c0ca017d77cb1a74$var$WordHighlighter_1.storedDecorationIDs.get(editor.getModel().uri);
            if (!currentDecorationIDs) continue;
            editor.removeDecorations(currentDecorationIDs);
            deleteURI.push(editor.getModel().uri);
            const editorHighlighterContrib = $c0ca017d77cb1a74$export$4221b4a19b9414cb.get(editor);
            if (!editorHighlighterContrib?.wordHighlighter) continue;
            if (editorHighlighterContrib.wordHighlighter.decorations.length > 0) {
                editorHighlighterContrib.wordHighlighter.decorations.clear();
                editorHighlighterContrib.wordHighlighter.workerRequest = null;
                editorHighlighterContrib.wordHighlighter._hasWordHighlights.set(false);
            }
        }
        for (const uri of deleteURI)$c0ca017d77cb1a74$var$WordHighlighter_1.storedDecorationIDs.delete(uri);
    }
    _stopSingular() {
        // Remove any existing decorations + a possible query, and re - run to update decorations
        this._removeSingleDecorations();
        if (this.editor.hasTextFocus()) {
            if (this.editor.getModel()?.uri.scheme !== (0, $8GPp8.Schemas).vscodeNotebookCell && $c0ca017d77cb1a74$var$WordHighlighter_1.query?.modelInfo?.model.uri.scheme !== (0, $8GPp8.Schemas).vscodeNotebookCell) {
                $c0ca017d77cb1a74$var$WordHighlighter_1.query = null;
                this._run(); // TODO: @Yoyokrazy -- investigate why we need a full rerun here. likely addressed a case/patch in the first iteration of this feature
            } else if ($c0ca017d77cb1a74$var$WordHighlighter_1.query?.modelInfo) $c0ca017d77cb1a74$var$WordHighlighter_1.query.modelInfo = null;
        }
        // Cancel any renderDecorationsTimer
        if (this.renderDecorationsTimer !== -1) {
            clearTimeout(this.renderDecorationsTimer);
            this.renderDecorationsTimer = -1;
        }
        // Cancel any worker request
        if (this.workerRequest !== null) {
            this.workerRequest.cancel();
            this.workerRequest = null;
        }
        // Invalidate any worker request callback
        if (!this.workerRequestCompleted) {
            this.workerRequestTokenId++;
            this.workerRequestCompleted = true;
        }
    }
    _stopAll(preservedModel) {
        // Remove any existing decorations
        // TODO: @Yoyokrazy -- this triggers as notebooks scroll, causing highlights to disappear momentarily.
        // maybe a nb type check?
        this._removeAllDecorations(preservedModel);
        // Cancel any renderDecorationsTimer
        if (this.renderDecorationsTimer !== -1) {
            clearTimeout(this.renderDecorationsTimer);
            this.renderDecorationsTimer = -1;
        }
        // Cancel any worker request
        if (this.workerRequest !== null) {
            this.workerRequest.cancel();
            this.workerRequest = null;
        }
        // Invalidate any worker request callback
        if (!this.workerRequestCompleted) {
            this.workerRequestTokenId++;
            this.workerRequestCompleted = true;
        }
    }
    _onPositionChanged(e) {
        // disabled
        if (this.occurrencesHighlight === 'off') {
            this._stopAll();
            return;
        }
        // ignore typing & other
        // need to check if the model is a notebook cell, should not stop if nb
        if (e.reason !== 3 /* CursorChangeReason.Explicit */  && this.editor.getModel()?.uri.scheme !== (0, $8GPp8.Schemas).vscodeNotebookCell) {
            this._stopAll();
            return;
        }
        this._run();
    }
    _getWord() {
        const editorSelection = this.editor.getSelection();
        const lineNumber = editorSelection.startLineNumber;
        const startColumn = editorSelection.startColumn;
        if (this.model.isDisposed()) return null;
        return this.model.getWordAtPosition({
            lineNumber: lineNumber,
            column: startColumn
        });
    }
    getOtherModelsToHighlight(model) {
        if (!model) return [];
        // notebook case
        const isNotebookEditor = model.uri.scheme === (0, $8GPp8.Schemas).vscodeNotebookCell;
        if (isNotebookEditor) {
            const currentModels = [];
            const currentEditors = this.codeEditorService.listCodeEditors();
            for (const editor of currentEditors){
                const tempModel = editor.getModel();
                if (tempModel && tempModel !== model && tempModel.uri.scheme === (0, $8GPp8.Schemas).vscodeNotebookCell) currentModels.push(tempModel);
            }
            return currentModels;
        }
        // inline case
        // ? current works when highlighting outside of an inline diff, highlighting in.
        // ? broken when highlighting within a diff editor. highlighting the main editor does not work
        // ? editor group service could be useful here
        const currentModels = [];
        const currentEditors = this.codeEditorService.listCodeEditors();
        for (const editor of currentEditors){
            if (!(0, $7UXLG.isDiffEditor)(editor)) continue;
            const diffModel = editor.getModel();
            if (!diffModel) continue;
            if (model === diffModel.modified) //? currentModels.push(diffModel.original);
            currentModels.push(diffModel.modified);
        }
        if (currentModels.length) return currentModels;
        // multi-doc OFF
        if (this.occurrencesHighlight === 'singleFile') return [];
        // multi-doc ON
        for (const editor of currentEditors){
            const tempModel = editor.getModel();
            const isValidModel = tempModel && tempModel !== model;
            if (isValidModel) currentModels.push(tempModel);
        }
        return currentModels;
    }
    _run(multiFileConfigChange) {
        let workerRequestIsValid;
        const hasTextFocus = this.editor.hasTextFocus();
        if (!hasTextFocus) {
            if (!$c0ca017d77cb1a74$var$WordHighlighter_1.query) {
                this._stopAll();
                return;
            }
        } else {
            const editorSelection = this.editor.getSelection();
            // ignore multiline selection
            if (!editorSelection || editorSelection.startLineNumber !== editorSelection.endLineNumber) {
                $c0ca017d77cb1a74$var$WordHighlighter_1.query = null;
                this._stopAll();
                return;
            }
            const startColumn = editorSelection.startColumn;
            const endColumn = editorSelection.endColumn;
            const word = this._getWord();
            // The selection must be inside a word or surround one word at most
            if (!word || word.startColumn > startColumn || word.endColumn < endColumn) {
                // no previous query, nothing to highlight
                $c0ca017d77cb1a74$var$WordHighlighter_1.query = null;
                this._stopAll();
                return;
            }
            // All the effort below is trying to achieve this:
            // - when cursor is moved to a word, trigger immediately a findOccurrences request
            // - 250ms later after the last cursor move event, render the occurrences
            // - no flickering!
            workerRequestIsValid = this.workerRequest && this.workerRequest.isValid(this.model, editorSelection, this.decorations);
            $c0ca017d77cb1a74$var$WordHighlighter_1.query = {
                modelInfo: {
                    model: this.model,
                    selection: editorSelection
                },
                word: word
            };
        }
        // There are 4 cases:
        // a) old workerRequest is valid & completed, renderDecorationsTimer fired
        // b) old workerRequest is valid & completed, renderDecorationsTimer not fired
        // c) old workerRequest is valid, but not completed
        // d) old workerRequest is not valid
        // For a) no action is needed
        // For c), member 'lastCursorPositionChangeTime' will be used when installing the timer so no action is needed
        this.lastCursorPositionChangeTime = new Date().getTime();
        if (workerRequestIsValid) {
            if (this.workerRequestCompleted && this.renderDecorationsTimer !== -1) {
                // case b)
                // Delay the firing of renderDecorationsTimer by an extra 250 ms
                clearTimeout(this.renderDecorationsTimer);
                this.renderDecorationsTimer = -1;
                this._beginRenderDecorations();
            }
        } else if ((0, $5Aea5.isEqual)(this.editor.getModel().uri, $c0ca017d77cb1a74$var$WordHighlighter_1.query.modelInfo?.model.uri)) {
            // case d)
            // check if the new queried word is contained in the range of a stored decoration for this model
            if (!multiFileConfigChange) {
                const currentModelDecorationRanges = this.decorations.getRanges();
                for (const storedRange of currentModelDecorationRanges){
                    if (storedRange.containsPosition(this.editor.getPosition())) return;
                }
            }
            // stop all previous actions if new word is highlighted
            // if we trigger the run off a setting change -> multifile highlighting, we do not want to remove decorations from this model
            this._stopAll(multiFileConfigChange ? this.model : undefined);
            const myRequestId = ++this.workerRequestTokenId;
            this.workerRequestCompleted = false;
            const otherModelsToHighlight = this.getOtherModelsToHighlight(this.editor.getModel());
            // when reaching here, there are two possible states.
            // 		1) we have text focus, and a valid query was updated.
            // 		2) we do not have text focus, and a valid query is cached.
            // the query will ALWAYS have the correct data for the current highlight request, so it can always be passed to the workerRequest safely
            if (!$c0ca017d77cb1a74$var$WordHighlighter_1.query || !$c0ca017d77cb1a74$var$WordHighlighter_1.query.modelInfo || $c0ca017d77cb1a74$var$WordHighlighter_1.query.modelInfo.model.isDisposed()) return;
            this.workerRequest = this.computeWithModel($c0ca017d77cb1a74$var$WordHighlighter_1.query.modelInfo.model, $c0ca017d77cb1a74$var$WordHighlighter_1.query.modelInfo.selection, $c0ca017d77cb1a74$var$WordHighlighter_1.query.word, otherModelsToHighlight);
            this.workerRequest?.result.then((data)=>{
                if (myRequestId === this.workerRequestTokenId) {
                    this.workerRequestCompleted = true;
                    this.workerRequestValue = data || [];
                    this._beginRenderDecorations();
                }
            }, (0, $gPkHZ.onUnexpectedError));
        }
    }
    computeWithModel(model, selection, word, otherModels) {
        if (!otherModels.length) return $c0ca017d77cb1a74$var$computeOccurencesAtPosition(this.providers, model, selection, word, this.editor.getOption(132 /* EditorOption.wordSeparators */ ));
        else return $c0ca017d77cb1a74$var$computeOccurencesMultiModel(this.multiDocumentProviders, model, selection, word, this.editor.getOption(132 /* EditorOption.wordSeparators */ ), otherModels);
    }
    _beginRenderDecorations() {
        const currentTime = new Date().getTime();
        const minimumRenderTime = this.lastCursorPositionChangeTime + 250;
        if (currentTime >= minimumRenderTime) {
            // Synchronous
            this.renderDecorationsTimer = -1;
            this.renderDecorations();
        } else // Asynchronous
        this.renderDecorationsTimer = setTimeout(()=>{
            this.renderDecorations();
        }, minimumRenderTime - currentTime);
    }
    renderDecorations() {
        this.renderDecorationsTimer = -1;
        // create new loop, iterate over current editors using this.codeEditorService.listCodeEditors(),
        // if the URI of that codeEditor is in the map, then add the decorations to the decorations array
        // then set the decorations for the editor
        const currentEditors = this.codeEditorService.listCodeEditors();
        for (const editor of currentEditors){
            const editorHighlighterContrib = $c0ca017d77cb1a74$export$4221b4a19b9414cb.get(editor);
            if (!editorHighlighterContrib) continue;
            const newDecorations = [];
            const uri = editor.getModel()?.uri;
            if (uri && this.workerRequestValue.has(uri)) {
                const oldDecorationIDs = $c0ca017d77cb1a74$var$WordHighlighter_1.storedDecorationIDs.get(uri);
                const newDocumentHighlights = this.workerRequestValue.get(uri);
                if (newDocumentHighlights) for (const highlight of newDocumentHighlights){
                    if (!highlight.range) continue;
                    newDecorations.push({
                        range: highlight.range,
                        options: (0, $9bb3e520d28a4c12$export$d9c75c339791af2c)(highlight.kind)
                    });
                }
                let newDecorationIDs = [];
                editor.changeDecorations((changeAccessor)=>{
                    newDecorationIDs = changeAccessor.deltaDecorations(oldDecorationIDs ?? [], newDecorations);
                });
                $c0ca017d77cb1a74$var$WordHighlighter_1.storedDecorationIDs = $c0ca017d77cb1a74$var$WordHighlighter_1.storedDecorationIDs.set(uri, newDecorationIDs);
                if (newDecorations.length > 0) {
                    editorHighlighterContrib.wordHighlighter?.decorations.set(newDecorations);
                    editorHighlighterContrib.wordHighlighter?._hasWordHighlights.set(true);
                }
            }
        }
    }
    dispose() {
        this._stopSingular();
        this.toUnhook.dispose();
    }
};
$c0ca017d77cb1a74$var$WordHighlighter = $c0ca017d77cb1a74$var$WordHighlighter_1 = $c0ca017d77cb1a74$var$__decorate([
    $c0ca017d77cb1a74$var$__param(4, (0, $2Qfl0.ICodeEditorService))
], $c0ca017d77cb1a74$var$WordHighlighter);
let $c0ca017d77cb1a74$export$4221b4a19b9414cb = class WordHighlighterContribution extends (0, $9cWcn.Disposable) {
    static{
        $c0ca017d77cb1a74$var$WordHighlighterContribution_1 = this;
    }
    static{
        this.ID = 'editor.contrib.wordHighlighter';
    }
    static get(editor) {
        return editor.getContribution($c0ca017d77cb1a74$var$WordHighlighterContribution_1.ID);
    }
    constructor(editor, contextKeyService, languageFeaturesService, codeEditorService){
        super();
        this._wordHighlighter = null;
        const createWordHighlighterIfPossible = ()=>{
            if (editor.hasModel() && !editor.getModel().isTooLargeForTokenization()) this._wordHighlighter = new $c0ca017d77cb1a74$var$WordHighlighter(editor, languageFeaturesService.documentHighlightProvider, languageFeaturesService.multiDocumentHighlightProvider, contextKeyService, codeEditorService);
        };
        this._register(editor.onDidChangeModel((e)=>{
            if (this._wordHighlighter) {
                this._wordHighlighter.dispose();
                this._wordHighlighter = null;
            }
            createWordHighlighterIfPossible();
        }));
        createWordHighlighterIfPossible();
    }
    get wordHighlighter() {
        return this._wordHighlighter;
    }
    saveViewState() {
        if (this._wordHighlighter && this._wordHighlighter.hasDecorations()) return true;
        return false;
    }
    moveNext() {
        this._wordHighlighter?.moveNext();
    }
    moveBack() {
        this._wordHighlighter?.moveBack();
    }
    restoreViewState(state) {
        if (this._wordHighlighter && state) this._wordHighlighter.restore();
    }
    dispose() {
        if (this._wordHighlighter) {
            this._wordHighlighter.dispose();
            this._wordHighlighter = null;
        }
        super.dispose();
    }
};
$c0ca017d77cb1a74$export$4221b4a19b9414cb = $c0ca017d77cb1a74$var$WordHighlighterContribution_1 = $c0ca017d77cb1a74$var$__decorate([
    $c0ca017d77cb1a74$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $c0ca017d77cb1a74$var$__param(2, (0, $4J6fu.ILanguageFeaturesService)),
    $c0ca017d77cb1a74$var$__param(3, (0, $2Qfl0.ICodeEditorService))
], $c0ca017d77cb1a74$export$4221b4a19b9414cb);
class $c0ca017d77cb1a74$var$WordHighlightNavigationAction extends (0, $2iJTi.EditorAction) {
    constructor(next, opts){
        super(opts);
        this._isNext = next;
    }
    run(accessor, editor) {
        const controller = $c0ca017d77cb1a74$export$4221b4a19b9414cb.get(editor);
        if (!controller) return;
        if (this._isNext) controller.moveNext();
        else controller.moveBack();
    }
}
class $c0ca017d77cb1a74$var$NextWordHighlightAction extends $c0ca017d77cb1a74$var$WordHighlightNavigationAction {
    constructor(){
        super(true, {
            id: 'editor.action.wordHighlight.next',
            label: $4dEdH.localize('wordHighlight.next.label', "Go to Next Symbol Highlight"),
            alias: 'Go to Next Symbol Highlight',
            precondition: $c0ca017d77cb1a74$var$ctxHasWordHighlights,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 65 /* KeyCode.F7 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $c0ca017d77cb1a74$var$PrevWordHighlightAction extends $c0ca017d77cb1a74$var$WordHighlightNavigationAction {
    constructor(){
        super(false, {
            id: 'editor.action.wordHighlight.prev',
            label: $4dEdH.localize('wordHighlight.previous.label', "Go to Previous Symbol Highlight"),
            alias: 'Go to Previous Symbol Highlight',
            precondition: $c0ca017d77cb1a74$var$ctxHasWordHighlights,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 1089 /* KeyCode.F7 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $c0ca017d77cb1a74$var$TriggerWordHighlightAction extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.wordHighlight.trigger',
            label: $4dEdH.localize('wordHighlight.trigger.label', "Trigger Symbol Highlight"),
            alias: 'Trigger Symbol Highlight',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).editorTextFocus,
                primary: 0,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor, editor, args) {
        const controller = $c0ca017d77cb1a74$export$4221b4a19b9414cb.get(editor);
        if (!controller) return;
        controller.restoreViewState(true);
    }
}
(0, $2iJTi.registerEditorContribution)($c0ca017d77cb1a74$export$4221b4a19b9414cb.ID, $c0ca017d77cb1a74$export$4221b4a19b9414cb, 0 /* EditorContributionInstantiation.Eager */ ); // eager because it uses `saveViewState`/`restoreViewState`
(0, $2iJTi.registerEditorAction)($c0ca017d77cb1a74$var$NextWordHighlightAction);
(0, $2iJTi.registerEditorAction)($c0ca017d77cb1a74$var$PrevWordHighlightAction);
(0, $2iJTi.registerEditorAction)($c0ca017d77cb1a74$var$TriggerWordHighlightAction);
(0, $54y8R.registerEditorFeature)((0, $6cc2bb5b47b14c92$export$fce3f78f200d8fd1));


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $5TVJR = parcelRequire("5TVJR");

var $cd4KD = parcelRequire("cd4KD");

var $3mrOi = parcelRequire("3mrOi");

var $gmf6D = parcelRequire("gmf6D");

var $Y3F21 = parcelRequire("Y3F21");

var $dcxQ7 = parcelRequire("dcxQ7");

var $d00il = parcelRequire("d00il");

var $jzicX = parcelRequire("jzicX");

var $ibKGQ = parcelRequire("ibKGQ");

var $1qkuR = parcelRequire("1qkuR");

var $4dEdH = parcelRequire("4dEdH");

var $gjaQN = parcelRequire("gjaQN");

var $cxCeF = parcelRequire("cxCeF");

var $h84gy = parcelRequire("h84gy");
class $d3b1aaa581ffe6a4$export$eaab41d675fb3c77 extends (0, $2iJTi.EditorCommand) {
    constructor(opts){
        super(opts);
        this._inSelectionMode = opts.inSelectionMode;
        this._wordNavigationType = opts.wordNavigationType;
    }
    runEditorCommand(accessor, editor, args) {
        if (!editor.hasModel()) return;
        const wordSeparators = (0, $Y3F21.getMapForWordSeparators)(editor.getOption(132 /* EditorOption.wordSeparators */ ), editor.getOption(131 /* EditorOption.wordSegmenterLocales */ ));
        const model = editor.getModel();
        const selections = editor.getSelections();
        const hasMulticursor = selections.length > 1;
        const result = selections.map((sel)=>{
            const inPosition = new (0, $dcxQ7.Position)(sel.positionLineNumber, sel.positionColumn);
            const outPosition = this._move(wordSeparators, model, inPosition, this._wordNavigationType, hasMulticursor);
            return this._moveTo(sel, outPosition, this._inSelectionMode);
        });
        model.pushStackElement();
        editor._getViewModel().setCursorStates('moveWordCommand', 3 /* CursorChangeReason.Explicit */ , result.map((r)=>(0, $3mrOi.CursorState).fromModelSelection(r)));
        if (result.length === 1) {
            const pos = new (0, $dcxQ7.Position)(result[0].positionLineNumber, result[0].positionColumn);
            editor.revealPosition(pos, 0 /* ScrollType.Smooth */ );
        }
    }
    _moveTo(from, to, inSelectionMode) {
        if (inSelectionMode) // move just position
        return new (0, $jzicX.Selection)(from.selectionStartLineNumber, from.selectionStartColumn, to.lineNumber, to.column);
        else // move everything
        return new (0, $jzicX.Selection)(to.lineNumber, to.column, to.lineNumber, to.column);
    }
}
class $d3b1aaa581ffe6a4$export$13a65d419a1678a2 extends $d3b1aaa581ffe6a4$export$eaab41d675fb3c77 {
    _move(wordSeparators, model, position, wordNavigationType, hasMulticursor) {
        return (0, $gmf6D.WordOperations).moveWordLeft(wordSeparators, model, position, wordNavigationType, hasMulticursor);
    }
}
class $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 extends $d3b1aaa581ffe6a4$export$eaab41d675fb3c77 {
    _move(wordSeparators, model, position, wordNavigationType, hasMulticursor) {
        return (0, $gmf6D.WordOperations).moveWordRight(wordSeparators, model, position, wordNavigationType);
    }
}
class $d3b1aaa581ffe6a4$export$4770de8d045e69d9 extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'cursorWordStartLeft',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$157c37c85911da0 extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordEndLeft',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$f491d0cd70e6ac9f extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 1 /* WordNavigationType.WordStartFast */ ,
            id: 'cursorWordLeft',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $cxCeF.ContextKeyExpr).and((0, $gjaQN.CONTEXT_ACCESSIBILITY_MODE_ENABLED), (0, $h84gy.IsWindowsContext))?.negate()),
                primary: 2063 /* KeyCode.LeftArrow */ ,
                mac: {
                    primary: 527 /* KeyCode.LeftArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $d3b1aaa581ffe6a4$export$befceb5f65aabb65 extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'cursorWordStartLeftSelect',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$9d9a22ccd52050d6 extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordEndLeftSelect',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$72b077928c493d15 extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 1 /* WordNavigationType.WordStartFast */ ,
            id: 'cursorWordLeftSelect',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $cxCeF.ContextKeyExpr).and((0, $gjaQN.CONTEXT_ACCESSIBILITY_MODE_ENABLED), (0, $h84gy.IsWindowsContext))?.negate()),
                primary: 3087 /* KeyCode.LeftArrow */ ,
                mac: {
                    primary: 1551 /* KeyCode.LeftArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $d3b1aaa581ffe6a4$export$95e12cee8c99ec86 extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 3 /* WordNavigationType.WordAccessibility */ ,
            id: 'cursorWordAccessibilityLeft',
            precondition: undefined
        });
    }
    _move(wordCharacterClassifier, model, position, wordNavigationType, hasMulticursor) {
        return super._move((0, $Y3F21.getMapForWordSeparators)((0, $cd4KD.EditorOptions).wordSeparators.defaultValue, wordCharacterClassifier.intlSegmenterLocales), model, position, wordNavigationType, hasMulticursor);
    }
}
class $d3b1aaa581ffe6a4$export$97245746696e71d0 extends $d3b1aaa581ffe6a4$export$13a65d419a1678a2 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 3 /* WordNavigationType.WordAccessibility */ ,
            id: 'cursorWordAccessibilityLeftSelect',
            precondition: undefined
        });
    }
    _move(wordCharacterClassifier, model, position, wordNavigationType, hasMulticursor) {
        return super._move((0, $Y3F21.getMapForWordSeparators)((0, $cd4KD.EditorOptions).wordSeparators.defaultValue, wordCharacterClassifier.intlSegmenterLocales), model, position, wordNavigationType, hasMulticursor);
    }
}
class $d3b1aaa581ffe6a4$export$ceee282c44fc7605 extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'cursorWordStartRight',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$850eef07da39cf7a extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordEndRight',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $cxCeF.ContextKeyExpr).and((0, $gjaQN.CONTEXT_ACCESSIBILITY_MODE_ENABLED), (0, $h84gy.IsWindowsContext))?.negate()),
                primary: 2065 /* KeyCode.RightArrow */ ,
                mac: {
                    primary: 529 /* KeyCode.RightArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $d3b1aaa581ffe6a4$export$c902fd9f7a9b8d4f extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordRight',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$39a9bf509c325dc extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'cursorWordStartRightSelect',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$ea19ea92bc7e7da2 extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordEndRightSelect',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $cxCeF.ContextKeyExpr).and((0, $ibKGQ.EditorContextKeys).textInputFocus, (0, $cxCeF.ContextKeyExpr).and((0, $gjaQN.CONTEXT_ACCESSIBILITY_MODE_ENABLED), (0, $h84gy.IsWindowsContext))?.negate()),
                primary: 3089 /* KeyCode.RightArrow */ ,
                mac: {
                    primary: 1553 /* KeyCode.RightArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $d3b1aaa581ffe6a4$export$dfb479c77c3a735f extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordRightSelect',
            precondition: undefined
        });
    }
}
class $d3b1aaa581ffe6a4$export$81a225a710499206 extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 3 /* WordNavigationType.WordAccessibility */ ,
            id: 'cursorWordAccessibilityRight',
            precondition: undefined
        });
    }
    _move(wordCharacterClassifier, model, position, wordNavigationType, hasMulticursor) {
        return super._move((0, $Y3F21.getMapForWordSeparators)((0, $cd4KD.EditorOptions).wordSeparators.defaultValue, wordCharacterClassifier.intlSegmenterLocales), model, position, wordNavigationType, hasMulticursor);
    }
}
class $d3b1aaa581ffe6a4$export$fe11f7bd19429986 extends $d3b1aaa581ffe6a4$export$3bd1a89f17c94fe7 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 3 /* WordNavigationType.WordAccessibility */ ,
            id: 'cursorWordAccessibilityRightSelect',
            precondition: undefined
        });
    }
    _move(wordCharacterClassifier, model, position, wordNavigationType, hasMulticursor) {
        return super._move((0, $Y3F21.getMapForWordSeparators)((0, $cd4KD.EditorOptions).wordSeparators.defaultValue, wordCharacterClassifier.intlSegmenterLocales), model, position, wordNavigationType, hasMulticursor);
    }
}
class $d3b1aaa581ffe6a4$export$19690b27ce3c0bb3 extends (0, $2iJTi.EditorCommand) {
    constructor(opts){
        super(opts);
        this._whitespaceHeuristics = opts.whitespaceHeuristics;
        this._wordNavigationType = opts.wordNavigationType;
    }
    runEditorCommand(accessor, editor, args) {
        const languageConfigurationService = accessor.get((0, $1qkuR.ILanguageConfigurationService));
        if (!editor.hasModel()) return;
        const wordSeparators = (0, $Y3F21.getMapForWordSeparators)(editor.getOption(132 /* EditorOption.wordSeparators */ ), editor.getOption(131 /* EditorOption.wordSegmenterLocales */ ));
        const model = editor.getModel();
        const selections = editor.getSelections();
        const autoClosingBrackets = editor.getOption(6 /* EditorOption.autoClosingBrackets */ );
        const autoClosingQuotes = editor.getOption(11 /* EditorOption.autoClosingQuotes */ );
        const autoClosingPairs = languageConfigurationService.getLanguageConfiguration(model.getLanguageId()).getAutoClosingPairs();
        const viewModel = editor._getViewModel();
        const commands = selections.map((sel)=>{
            const deleteRange = this._delete({
                wordSeparators: wordSeparators,
                model: model,
                selection: sel,
                whitespaceHeuristics: this._whitespaceHeuristics,
                autoClosingDelete: editor.getOption(9 /* EditorOption.autoClosingDelete */ ),
                autoClosingBrackets: autoClosingBrackets,
                autoClosingQuotes: autoClosingQuotes,
                autoClosingPairs: autoClosingPairs,
                autoClosedCharacters: viewModel.getCursorAutoClosedCharacters()
            }, this._wordNavigationType);
            return new (0, $5TVJR.ReplaceCommand)(deleteRange, '');
        });
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
class $d3b1aaa581ffe6a4$export$5ce54e0babbd8085 extends $d3b1aaa581ffe6a4$export$19690b27ce3c0bb3 {
    _delete(ctx, wordNavigationType) {
        const r = (0, $gmf6D.WordOperations).deleteWordLeft(ctx, wordNavigationType);
        if (r) return r;
        return new (0, $d00il.Range)(1, 1, 1, 1);
    }
}
class $d3b1aaa581ffe6a4$export$8ec654e5cf025a25 extends $d3b1aaa581ffe6a4$export$19690b27ce3c0bb3 {
    _delete(ctx, wordNavigationType) {
        const r = (0, $gmf6D.WordOperations).deleteWordRight(ctx, wordNavigationType);
        if (r) return r;
        const lineCount = ctx.model.getLineCount();
        const maxColumn = ctx.model.getLineMaxColumn(lineCount);
        return new (0, $d00il.Range)(lineCount, maxColumn, lineCount, maxColumn);
    }
}
class $d3b1aaa581ffe6a4$export$ad82f35e651a1686 extends $d3b1aaa581ffe6a4$export$5ce54e0babbd8085 {
    constructor(){
        super({
            whitespaceHeuristics: false,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'deleteWordStartLeft',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
class $d3b1aaa581ffe6a4$export$3cb06644b5a9b33e extends $d3b1aaa581ffe6a4$export$5ce54e0babbd8085 {
    constructor(){
        super({
            whitespaceHeuristics: false,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'deleteWordEndLeft',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
class $d3b1aaa581ffe6a4$export$f36e7db579f60a1 extends $d3b1aaa581ffe6a4$export$5ce54e0babbd8085 {
    constructor(){
        super({
            whitespaceHeuristics: true,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'deleteWordLeft',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 2049 /* KeyCode.Backspace */ ,
                mac: {
                    primary: 513 /* KeyCode.Backspace */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $d3b1aaa581ffe6a4$export$3e0062da3d0b9053 extends $d3b1aaa581ffe6a4$export$8ec654e5cf025a25 {
    constructor(){
        super({
            whitespaceHeuristics: false,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'deleteWordStartRight',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
class $d3b1aaa581ffe6a4$export$5bc7327221e6c16c extends $d3b1aaa581ffe6a4$export$8ec654e5cf025a25 {
    constructor(){
        super({
            whitespaceHeuristics: false,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'deleteWordEndRight',
            precondition: (0, $ibKGQ.EditorContextKeys).writable
        });
    }
}
class $d3b1aaa581ffe6a4$export$7e197173a43fafee extends $d3b1aaa581ffe6a4$export$8ec654e5cf025a25 {
    constructor(){
        super({
            whitespaceHeuristics: true,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'deleteWordRight',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 2068 /* KeyCode.Delete */ ,
                mac: {
                    primary: 532 /* KeyCode.Delete */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $d3b1aaa581ffe6a4$export$8f8db2361df25afb extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'deleteInsideWord',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            label: $4dEdH.localize('deleteInsideWord', "Delete Word"),
            alias: 'Delete Word'
        });
    }
    run(accessor, editor, args) {
        if (!editor.hasModel()) return;
        const wordSeparators = (0, $Y3F21.getMapForWordSeparators)(editor.getOption(132 /* EditorOption.wordSeparators */ ), editor.getOption(131 /* EditorOption.wordSegmenterLocales */ ));
        const model = editor.getModel();
        const selections = editor.getSelections();
        const commands = selections.map((sel)=>{
            const deleteRange = (0, $gmf6D.WordOperations).deleteInsideWord(wordSeparators, model, sel);
            return new (0, $5TVJR.ReplaceCommand)(deleteRange, '');
        });
        editor.pushUndoStop();
        editor.executeCommands(this.id, commands);
        editor.pushUndoStop();
    }
}
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$4770de8d045e69d9());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$157c37c85911da0());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$f491d0cd70e6ac9f());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$befceb5f65aabb65());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$9d9a22ccd52050d6());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$72b077928c493d15());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$ceee282c44fc7605());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$850eef07da39cf7a());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$c902fd9f7a9b8d4f());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$39a9bf509c325dc());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$ea19ea92bc7e7da2());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$dfb479c77c3a735f());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$95e12cee8c99ec86());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$97245746696e71d0());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$81a225a710499206());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$fe11f7bd19429986());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$ad82f35e651a1686());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$3cb06644b5a9b33e());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$f36e7db579f60a1());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$3e0062da3d0b9053());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$5bc7327221e6c16c());
(0, $2iJTi.registerEditorCommand)(new $d3b1aaa581ffe6a4$export$7e197173a43fafee());
(0, $2iJTi.registerEditorAction)($d3b1aaa581ffe6a4$export$8f8db2361df25afb);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $gmf6D = parcelRequire("gmf6D");

var $d00il = parcelRequire("d00il");

var $ibKGQ = parcelRequire("ibKGQ");


var $8tcMz = parcelRequire("8tcMz");
class $ad0b7ee6fd29900e$export$c4bbad0c92429e2a extends (0, $d3b1aaa581ffe6a4$export$19690b27ce3c0bb3) {
    constructor(){
        super({
            whitespaceHeuristics: true,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'deleteWordPartLeft',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 769 /* KeyCode.Backspace */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    _delete(ctx, wordNavigationType) {
        const r = (0, $gmf6D.WordPartOperations).deleteWordPartLeft(ctx);
        if (r) return r;
        return new (0, $d00il.Range)(1, 1, 1, 1);
    }
}
class $ad0b7ee6fd29900e$export$badada4aa779607 extends (0, $d3b1aaa581ffe6a4$export$19690b27ce3c0bb3) {
    constructor(){
        super({
            whitespaceHeuristics: true,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'deleteWordPartRight',
            precondition: (0, $ibKGQ.EditorContextKeys).writable,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 788 /* KeyCode.Delete */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    _delete(ctx, wordNavigationType) {
        const r = (0, $gmf6D.WordPartOperations).deleteWordPartRight(ctx);
        if (r) return r;
        const lineCount = ctx.model.getLineCount();
        const maxColumn = ctx.model.getLineMaxColumn(lineCount);
        return new (0, $d00il.Range)(lineCount, maxColumn, lineCount, maxColumn);
    }
}
class $ad0b7ee6fd29900e$export$ae81a0942e424d66 extends (0, $d3b1aaa581ffe6a4$export$eaab41d675fb3c77) {
    _move(wordSeparators, model, position, wordNavigationType, hasMulticursor) {
        return (0, $gmf6D.WordPartOperations).moveWordPartLeft(wordSeparators, model, position, hasMulticursor);
    }
}
class $ad0b7ee6fd29900e$export$d25a50b18eb112d5 extends $ad0b7ee6fd29900e$export$ae81a0942e424d66 {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'cursorWordPartLeft',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 783 /* KeyCode.LeftArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
// Register previous id for compatibility purposes
(0, $8tcMz.CommandsRegistry).registerCommandAlias('cursorWordPartStartLeft', 'cursorWordPartLeft');
class $ad0b7ee6fd29900e$export$351378b9c4d5255a extends $ad0b7ee6fd29900e$export$ae81a0942e424d66 {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 0 /* WordNavigationType.WordStart */ ,
            id: 'cursorWordPartLeftSelect',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 1807 /* KeyCode.LeftArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
// Register previous id for compatibility purposes
(0, $8tcMz.CommandsRegistry).registerCommandAlias('cursorWordPartStartLeftSelect', 'cursorWordPartLeftSelect');
class $ad0b7ee6fd29900e$export$8927a2c83363ac2a extends (0, $d3b1aaa581ffe6a4$export$eaab41d675fb3c77) {
    _move(wordSeparators, model, position, wordNavigationType, hasMulticursor) {
        return (0, $gmf6D.WordPartOperations).moveWordPartRight(wordSeparators, model, position);
    }
}
class $ad0b7ee6fd29900e$export$b4cc05290eaa5d1a extends $ad0b7ee6fd29900e$export$8927a2c83363ac2a {
    constructor(){
        super({
            inSelectionMode: false,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordPartRight',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 785 /* KeyCode.RightArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
class $ad0b7ee6fd29900e$export$a0ec6a8e7a9cded6 extends $ad0b7ee6fd29900e$export$8927a2c83363ac2a {
    constructor(){
        super({
            inSelectionMode: true,
            wordNavigationType: 2 /* WordNavigationType.WordEnd */ ,
            id: 'cursorWordPartRightSelect',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).textInputFocus,
                primary: 0,
                mac: {
                    primary: 1809 /* KeyCode.RightArrow */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
}
(0, $2iJTi.registerEditorCommand)(new $ad0b7ee6fd29900e$export$c4bbad0c92429e2a());
(0, $2iJTi.registerEditorCommand)(new $ad0b7ee6fd29900e$export$badada4aa779607());
(0, $2iJTi.registerEditorCommand)(new $ad0b7ee6fd29900e$export$d25a50b18eb112d5());
(0, $2iJTi.registerEditorCommand)(new $ad0b7ee6fd29900e$export$351378b9c4d5255a());
(0, $2iJTi.registerEditorCommand)(new $ad0b7ee6fd29900e$export$b4cc05290eaa5d1a());
(0, $2iJTi.registerEditorCommand)(new $ad0b7ee6fd29900e$export$a0ec6a8e7a9cded6());


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $iGmb0 = parcelRequire("iGmb0");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");


var $4dEdH = parcelRequire("4dEdH");
class $e5ff6131221a097e$export$360adabb153c6f3d extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.readOnlyMessageController';
    }
    constructor(editor){
        super();
        this.editor = editor;
        this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()));
    }
    _onDidAttemptReadOnlyEdit() {
        const messageController = (0, $c4b598428fae736e$export$8c2d6d477e341dce).get(this.editor);
        if (messageController && this.editor.hasModel()) {
            let message = this.editor.getOptions().get(93 /* EditorOption.readOnlyMessage */ );
            if (!message) {
                if (this.editor.isSimpleWidget) message = new (0, $iGmb0.MarkdownString)($4dEdH.localize('editor.simple.readonly', "Cannot edit in read-only input"));
                else message = new (0, $iGmb0.MarkdownString)($4dEdH.localize('editor.readonly', "Cannot edit in read-only editor"));
            }
            messageController.showMessage(message, this.editor.getPosition());
        }
    }
}
(0, $2iJTi.registerEditorContribution)($e5ff6131221a097e$export$360adabb153c6f3d.ID, $e5ff6131221a097e$export$360adabb153c6f3d, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $kJ8UG = parcelRequire("kJ8UG");

var $4fzqs = parcelRequire("4fzqs");

var $j4yUS = parcelRequire("j4yUS");

var $02z4I = parcelRequire("02z4I");

var $4J6fu = parcelRequire("4J6fu");


var $9cWcn = parcelRequire("9cWcn");

var $5YaSO = parcelRequire("5YaSO");
var $764aae4fc11eafd6$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $764aae4fc11eafd6$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $764aae4fc11eafd6$var$DiffEditorBreadcrumbsSource = class DiffEditorBreadcrumbsSource extends (0, $9cWcn.Disposable) {
    constructor(_textModel, _languageFeaturesService, _outlineModelService){
        super();
        this._textModel = _textModel;
        this._languageFeaturesService = _languageFeaturesService;
        this._outlineModelService = _outlineModelService;
        this._currentModel = (0, $4fzqs.observableValue)(this, undefined);
        const documentSymbolProviderChanged = (0, $4fzqs.observableSignalFromEvent)('documentSymbolProvider.onDidChange', this._languageFeaturesService.documentSymbolProvider.onDidChange);
        const textModelChanged = (0, $4fzqs.observableSignalFromEvent)('_textModel.onDidChangeContent', (0, $5YaSO.Event).debounce((e)=>this._textModel.onDidChangeContent(e), ()=>undefined, 100));
        this._register((0, $4fzqs.autorunWithStore)(async (reader, store)=>{
            documentSymbolProviderChanged.read(reader);
            textModelChanged.read(reader);
            const src = store.add(new (0, $02z4I.DisposableCancellationTokenSource)());
            const model = await this._outlineModelService.getOrCreate(this._textModel, src.token);
            if (store.isDisposed) return;
            this._currentModel.set(model, undefined);
        }));
    }
    getBreadcrumbItems(startRange, reader) {
        const m = this._currentModel.read(reader);
        if (!m) return [];
        const symbols = m.asListOfDocumentSymbols().filter((s)=>startRange.contains(s.range.startLineNumber) && !startRange.contains(s.range.endLineNumber));
        symbols.sort((0, $kJ8UG.reverseOrder)((0, $kJ8UG.compareBy)((s)=>s.range.endLineNumber - s.range.startLineNumber, (0, $kJ8UG.numberComparator))));
        return symbols.map((s)=>({
                name: s.name,
                kind: s.kind,
                startLineNumber: s.range.startLineNumber
            }));
    }
};
$764aae4fc11eafd6$var$DiffEditorBreadcrumbsSource = $764aae4fc11eafd6$var$__decorate([
    $764aae4fc11eafd6$var$__param(1, (0, $4J6fu.ILanguageFeaturesService)),
    $764aae4fc11eafd6$var$__param(2, (0, $7f863e6a161b6d9f$export$8065412b6c424633))
], $764aae4fc11eafd6$var$DiffEditorBreadcrumbsSource);
(0, $j4yUS.HideUnchangedRegionsFeature).setBreadcrumbsSourceFactory((textModel, instantiationService)=>{
    return instantiationService.createInstance($764aae4fc11eafd6$var$DiffEditorBreadcrumbsSource, textModel);
});


parcelRequire("82TRE");

 // The codicons are defined here and must be loaded


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $bDzmQ = parcelRequire("bDzmQ");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $lb0Ah = parcelRequire("lb0Ah");
class $43b3f6a5cad939e6$export$445a80feda1f9fce extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.iPadShowKeyboard';
    }
    constructor(editor){
        super();
        this.editor = editor;
        this.widget = null;
        if (0, $lb0Ah.isIOS) {
            this._register(editor.onDidChangeConfiguration(()=>this.update()));
            this.update();
        }
    }
    update() {
        const shouldHaveWidget = !this.editor.getOption(92 /* EditorOption.readOnly */ );
        if (!this.widget && shouldHaveWidget) this.widget = new $43b3f6a5cad939e6$var$ShowKeyboardWidget(this.editor);
        else if (this.widget && !shouldHaveWidget) {
            this.widget.dispose();
            this.widget = null;
        }
    }
    dispose() {
        super.dispose();
        if (this.widget) {
            this.widget.dispose();
            this.widget = null;
        }
    }
}
class $43b3f6a5cad939e6$var$ShowKeyboardWidget extends (0, $9cWcn.Disposable) {
    static{
        this.ID = 'editor.contrib.ShowKeyboardWidget';
    }
    constructor(editor){
        super();
        this.editor = editor;
        this._domNode = document.createElement('textarea');
        this._domNode.className = 'iPadShowKeyboard';
        this._register($bDzmQ.addDisposableListener(this._domNode, 'touchstart', (e)=>{
            this.editor.focus();
        }));
        this._register($bDzmQ.addDisposableListener(this._domNode, 'focus', (e)=>{
            this.editor.focus();
        }));
        this.editor.addOverlayWidget(this);
    }
    dispose() {
        this.editor.removeOverlayWidget(this);
        super.dispose();
    }
    // ----- IOverlayWidget API
    getId() {
        return $43b3f6a5cad939e6$var$ShowKeyboardWidget.ID;
    }
    getDomNode() {
        return this._domNode;
    }
    getPosition() {
        return {
            preference: 1 /* OverlayWidgetPositionPreference.BOTTOM_RIGHT_CORNER */ 
        };
    }
}
(0, $2iJTi.registerEditorContribution)($43b3f6a5cad939e6$export$445a80feda1f9fce.ID, $43b3f6a5cad939e6$export$445a80feda1f9fce, 3 /* EditorContributionInstantiation.Eventually */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $bDzmQ = parcelRequire("bDzmQ");

var $bjjQO = parcelRequire("bjjQO");

var $9cWcn = parcelRequire("9cWcn");

var $2iJTi = parcelRequire("2iJTi");

var $kzNQX = parcelRequire("kzNQX");

var $HJFls = parcelRequire("HJFls");

var $acPIe = parcelRequire("acPIe");

var $h9Xpp = parcelRequire("h9Xpp");

var $hgpZb = parcelRequire("hgpZb");

var $82TRE = parcelRequire("82TRE");
var $a68324ae765f2c88$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $a68324ae765f2c88$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $a68324ae765f2c88$var$InspectTokensController_1;
let $a68324ae765f2c88$var$InspectTokensController = class InspectTokensController extends (0, $9cWcn.Disposable) {
    static{
        $a68324ae765f2c88$var$InspectTokensController_1 = this;
    }
    static{
        this.ID = 'editor.contrib.inspectTokens';
    }
    static get(editor) {
        return editor.getContribution($a68324ae765f2c88$var$InspectTokensController_1.ID);
    }
    constructor(editor, standaloneColorService, languageService){
        super();
        this._editor = editor;
        this._languageService = languageService;
        this._widget = null;
        this._register(this._editor.onDidChangeModel((e)=>this.stop()));
        this._register(this._editor.onDidChangeModelLanguage((e)=>this.stop()));
        this._register((0, $kzNQX.TokenizationRegistry).onDidChange((e)=>this.stop()));
        this._register(this._editor.onKeyUp((e)=>e.keyCode === 9 /* KeyCode.Escape */  && this.stop()));
    }
    dispose() {
        this.stop();
        super.dispose();
    }
    launch() {
        if (this._widget) return;
        if (!this._editor.hasModel()) return;
        this._widget = new $a68324ae765f2c88$var$InspectTokensWidget(this._editor, this._languageService);
    }
    stop() {
        if (this._widget) {
            this._widget.dispose();
            this._widget = null;
        }
    }
};
$a68324ae765f2c88$var$InspectTokensController = $a68324ae765f2c88$var$InspectTokensController_1 = $a68324ae765f2c88$var$__decorate([
    $a68324ae765f2c88$var$__param(1, (0, $hgpZb.IStandaloneThemeService)),
    $a68324ae765f2c88$var$__param(2, (0, $h9Xpp.ILanguageService))
], $a68324ae765f2c88$var$InspectTokensController);
class $a68324ae765f2c88$var$InspectTokens extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.inspectTokens',
            label: (0, $82TRE.InspectTokensNLS).inspectTokensAction,
            alias: 'Developer: Inspect Tokens',
            precondition: undefined
        });
    }
    run(accessor, editor) {
        const controller = $a68324ae765f2c88$var$InspectTokensController.get(editor);
        controller?.launch();
    }
}
function $a68324ae765f2c88$var$renderTokenText(tokenText) {
    let result = '';
    for(let charIndex = 0, len = tokenText.length; charIndex < len; charIndex++){
        const charCode = tokenText.charCodeAt(charIndex);
        switch(charCode){
            case 9 /* CharCode.Tab */ :
                result += '\u2192'; // &rarr;
                break;
            case 32 /* CharCode.Space */ :
                result += '\u00B7'; // &middot;
                break;
            default:
                result += String.fromCharCode(charCode);
        }
    }
    return result;
}
function $a68324ae765f2c88$var$getSafeTokenizationSupport(languageIdCodec, languageId) {
    const tokenizationSupport = (0, $kzNQX.TokenizationRegistry).get(languageId);
    if (tokenizationSupport) return tokenizationSupport;
    const encodedLanguageId = languageIdCodec.encodeLanguageId(languageId);
    return {
        getInitialState: ()=>(0, $acPIe.NullState),
        tokenize: (line, hasEOL, state)=>(0, $acPIe.nullTokenize)(languageId, state),
        tokenizeEncoded: (line, hasEOL, state)=>(0, $acPIe.nullTokenizeEncoded)(encodedLanguageId, state)
    };
}
class $a68324ae765f2c88$var$InspectTokensWidget extends (0, $9cWcn.Disposable) {
    static{
        this._ID = 'editor.contrib.inspectTokensWidget';
    }
    constructor(editor, languageService){
        super();
        // Editor.IContentWidget.allowEditorOverflow
        this.allowEditorOverflow = true;
        this._editor = editor;
        this._languageService = languageService;
        this._model = this._editor.getModel();
        this._domNode = document.createElement('div');
        this._domNode.className = 'tokens-inspect-widget';
        this._tokenizationSupport = $a68324ae765f2c88$var$getSafeTokenizationSupport(this._languageService.languageIdCodec, this._model.getLanguageId());
        this._compute(this._editor.getPosition());
        this._register(this._editor.onDidChangeCursorPosition((e)=>this._compute(this._editor.getPosition())));
        this._editor.addContentWidget(this);
    }
    dispose() {
        this._editor.removeContentWidget(this);
        super.dispose();
    }
    getId() {
        return $a68324ae765f2c88$var$InspectTokensWidget._ID;
    }
    _compute(position) {
        const data = this._getTokensAtLine(position.lineNumber);
        let token1Index = 0;
        for(let i = data.tokens1.length - 1; i >= 0; i--){
            const t = data.tokens1[i];
            if (position.column - 1 >= t.offset) {
                token1Index = i;
                break;
            }
        }
        let token2Index = 0;
        for(let i = data.tokens2.length >>> 1; i >= 0; i--)if (position.column - 1 >= data.tokens2[i << 1]) {
            token2Index = i;
            break;
        }
        const lineContent = this._model.getLineContent(position.lineNumber);
        let tokenText = '';
        if (token1Index < data.tokens1.length) {
            const tokenStartIndex = data.tokens1[token1Index].offset;
            const tokenEndIndex = token1Index + 1 < data.tokens1.length ? data.tokens1[token1Index + 1].offset : lineContent.length;
            tokenText = lineContent.substring(tokenStartIndex, tokenEndIndex);
        }
        (0, $bDzmQ.reset)(this._domNode, (0, $bDzmQ.$)('h2.tm-token', undefined, $a68324ae765f2c88$var$renderTokenText(tokenText), (0, $bDzmQ.$)('span.tm-token-length', undefined, `${tokenText.length} ${tokenText.length === 1 ? 'char' : 'chars'}`)));
        (0, $bDzmQ.append)(this._domNode, (0, $bDzmQ.$)('hr.tokens-inspect-separator', {
            'style': 'clear:both'
        }));
        const metadata = (token2Index << 1) + 1 < data.tokens2.length ? this._decodeMetadata(data.tokens2[(token2Index << 1) + 1]) : null;
        (0, $bDzmQ.append)(this._domNode, (0, $bDzmQ.$)('table.tm-metadata-table', undefined, (0, $bDzmQ.$)('tbody', undefined, (0, $bDzmQ.$)('tr', undefined, (0, $bDzmQ.$)('td.tm-metadata-key', undefined, 'language'), (0, $bDzmQ.$)('td.tm-metadata-value', undefined, `${metadata ? metadata.languageId : '-?-'}`)), (0, $bDzmQ.$)('tr', undefined, (0, $bDzmQ.$)('td.tm-metadata-key', undefined, 'token type'), (0, $bDzmQ.$)('td.tm-metadata-value', undefined, `${metadata ? this._tokenTypeToString(metadata.tokenType) : '-?-'}`)), (0, $bDzmQ.$)('tr', undefined, (0, $bDzmQ.$)('td.tm-metadata-key', undefined, 'font style'), (0, $bDzmQ.$)('td.tm-metadata-value', undefined, `${metadata ? this._fontStyleToString(metadata.fontStyle) : '-?-'}`)), (0, $bDzmQ.$)('tr', undefined, (0, $bDzmQ.$)('td.tm-metadata-key', undefined, 'foreground'), (0, $bDzmQ.$)('td.tm-metadata-value', undefined, `${metadata ? (0, $bjjQO.Color).Format.CSS.formatHex(metadata.foreground) : '-?-'}`)), (0, $bDzmQ.$)('tr', undefined, (0, $bDzmQ.$)('td.tm-metadata-key', undefined, 'background'), (0, $bDzmQ.$)('td.tm-metadata-value', undefined, `${metadata ? (0, $bjjQO.Color).Format.CSS.formatHex(metadata.background) : '-?-'}`)))));
        (0, $bDzmQ.append)(this._domNode, (0, $bDzmQ.$)('hr.tokens-inspect-separator'));
        if (token1Index < data.tokens1.length) (0, $bDzmQ.append)(this._domNode, (0, $bDzmQ.$)('span.tm-token-type', undefined, data.tokens1[token1Index].type));
        this._editor.layoutContentWidget(this);
    }
    _decodeMetadata(metadata) {
        const colorMap = (0, $kzNQX.TokenizationRegistry).getColorMap();
        const languageId = (0, $HJFls.TokenMetadata).getLanguageId(metadata);
        const tokenType = (0, $HJFls.TokenMetadata).getTokenType(metadata);
        const fontStyle = (0, $HJFls.TokenMetadata).getFontStyle(metadata);
        const foreground = (0, $HJFls.TokenMetadata).getForeground(metadata);
        const background = (0, $HJFls.TokenMetadata).getBackground(metadata);
        return {
            languageId: this._languageService.languageIdCodec.decodeLanguageId(languageId),
            tokenType: tokenType,
            fontStyle: fontStyle,
            foreground: colorMap[foreground],
            background: colorMap[background]
        };
    }
    _tokenTypeToString(tokenType) {
        switch(tokenType){
            case 0 /* StandardTokenType.Other */ :
                return 'Other';
            case 1 /* StandardTokenType.Comment */ :
                return 'Comment';
            case 2 /* StandardTokenType.String */ :
                return 'String';
            case 3 /* StandardTokenType.RegEx */ :
                return 'RegEx';
            default:
                return '??';
        }
    }
    _fontStyleToString(fontStyle) {
        let r = '';
        if (fontStyle & 1 /* FontStyle.Italic */ ) r += 'italic ';
        if (fontStyle & 2 /* FontStyle.Bold */ ) r += 'bold ';
        if (fontStyle & 4 /* FontStyle.Underline */ ) r += 'underline ';
        if (fontStyle & 8 /* FontStyle.Strikethrough */ ) r += 'strikethrough ';
        if (r.length === 0) r = '---';
        return r;
    }
    _getTokensAtLine(lineNumber) {
        const stateBeforeLine = this._getStateBeforeLine(lineNumber);
        const tokenizationResult1 = this._tokenizationSupport.tokenize(this._model.getLineContent(lineNumber), true, stateBeforeLine);
        const tokenizationResult2 = this._tokenizationSupport.tokenizeEncoded(this._model.getLineContent(lineNumber), true, stateBeforeLine);
        return {
            startState: stateBeforeLine,
            tokens1: tokenizationResult1.tokens,
            tokens2: tokenizationResult2.tokens,
            endState: tokenizationResult1.endState
        };
    }
    _getStateBeforeLine(lineNumber) {
        let state = this._tokenizationSupport.getInitialState();
        for(let i = 1; i < lineNumber; i++){
            const tokenizationResult = this._tokenizationSupport.tokenize(this._model.getLineContent(i), true, state);
            state = tokenizationResult.endState;
        }
        return state;
    }
    getDomNode() {
        return this._domNode;
    }
    getPosition() {
        return {
            position: this._editor.getPosition(),
            preference: [
                2 /* ContentWidgetPositionPreference.BELOW */ ,
                1 /* ContentWidgetPositionPreference.ABOVE */ 
            ]
        };
    }
}
(0, $2iJTi.registerEditorContribution)($a68324ae765f2c88$var$InspectTokensController.ID, $a68324ae765f2c88$var$InspectTokensController, 4 /* EditorContributionInstantiation.Lazy */ );
(0, $2iJTi.registerEditorAction)($a68324ae765f2c88$var$InspectTokens);


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $TezJS = parcelRequire("TezJS");

var $7Oj2p = parcelRequire("7Oj2p");

var $82TRE = parcelRequire("82TRE");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $4dEdH = parcelRequire("4dEdH");

var $TezJS = parcelRequire("TezJS");

var $9cWcn = parcelRequire("9cWcn");

var $7IxGd = parcelRequire("7IxGd");

var $7Oj2p = parcelRequire("7Oj2p");

var $3XkzC = parcelRequire("3XkzC");
var $7f0fcbc24e29a1f3$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $7f0fcbc24e29a1f3$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $7f0fcbc24e29a1f3$var$HelpQuickAccessProvider_1;
let $7f0fcbc24e29a1f3$export$960f28d3c3a61657 = class HelpQuickAccessProvider {
    static{
        $7f0fcbc24e29a1f3$var$HelpQuickAccessProvider_1 = this;
    }
    static{
        this.PREFIX = '?';
    }
    constructor(quickInputService, keybindingService){
        this.quickInputService = quickInputService;
        this.keybindingService = keybindingService;
        this.registry = (0, $TezJS.Registry).as((0, $7Oj2p.Extensions).Quickaccess);
    }
    provide(picker) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        // Open a picker with the selected value if picked
        disposables.add(picker.onDidAccept(()=>{
            const [item] = picker.selectedItems;
            if (item) this.quickInputService.quickAccess.show(item.prefix, {
                preserveValue: true
            });
        }));
        // Also open a picker when we detect the user typed the exact
        // name of a provider (e.g. `?term` for terminals)
        disposables.add(picker.onDidChangeValue((value)=>{
            const providerDescriptor = this.registry.getQuickAccessProvider(value.substr($7f0fcbc24e29a1f3$var$HelpQuickAccessProvider_1.PREFIX.length));
            if (providerDescriptor && providerDescriptor.prefix && providerDescriptor.prefix !== $7f0fcbc24e29a1f3$var$HelpQuickAccessProvider_1.PREFIX) this.quickInputService.quickAccess.show(providerDescriptor.prefix, {
                preserveValue: true
            });
        }));
        // Fill in all providers
        picker.items = this.getQuickAccessProviders().filter((p)=>p.prefix !== $7f0fcbc24e29a1f3$var$HelpQuickAccessProvider_1.PREFIX);
        return disposables;
    }
    getQuickAccessProviders() {
        const providers = this.registry.getQuickAccessProviders().sort((providerA, providerB)=>providerA.prefix.localeCompare(providerB.prefix)).flatMap((provider)=>this.createPicks(provider));
        return providers;
    }
    createPicks(provider) {
        return provider.helpEntries.map((helpEntry)=>{
            const prefix = helpEntry.prefix || provider.prefix;
            const label = prefix || '\u2026' /* ... */ ;
            return {
                prefix: prefix,
                label: label,
                keybinding: helpEntry.commandId ? this.keybindingService.lookupKeybinding(helpEntry.commandId) : undefined,
                ariaLabel: (0, $4dEdH.localize)('helpPickAriaLabel', "{0}, {1}", label, helpEntry.description),
                description: helpEntry.description
            };
        });
    }
};
$7f0fcbc24e29a1f3$export$960f28d3c3a61657 = $7f0fcbc24e29a1f3$var$HelpQuickAccessProvider_1 = $7f0fcbc24e29a1f3$var$__decorate([
    $7f0fcbc24e29a1f3$var$__param(0, (0, $3XkzC.IQuickInputService)),
    $7f0fcbc24e29a1f3$var$__param(1, (0, $7IxGd.IKeybindingService))
], $7f0fcbc24e29a1f3$export$960f28d3c3a61657);


(0, $TezJS.Registry).as((0, $7Oj2p.Extensions).Quickaccess).registerQuickAccessProvider({
    ctor: (0, $7f0fcbc24e29a1f3$export$960f28d3c3a61657),
    prefix: '',
    helpEntries: [
        {
            description: (0, $82TRE.QuickHelpNLS).helpQuickAccessActionLabel
        }
    ]
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ /*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $9cWcn = parcelRequire("9cWcn");

var $7UXLG = parcelRequire("7UXLG");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $5eGXQ = parcelRequire("5eGXQ");

var $9cWcn = parcelRequire("9cWcn");

var $7UXLG = parcelRequire("7UXLG");

var $1Y4vr = parcelRequire("1Y4vr");

var $cw0ys = parcelRequire("cw0ys");

var $azIPz = parcelRequire("azIPz");

var $aIbUW = parcelRequire("aIbUW");
class $5bdaebb58d187dc3$export$6c0961619607218e {
    constructor(options){
        this.options = options;
        //#endregion
        //#region Decorations Utils
        this.rangeHighlightDecorationId = undefined;
    }
    //#region Provider methods
    provide(picker, token, runOptions) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        // Apply options if any
        picker.canAcceptInBackground = !!this.options?.canAcceptInBackground;
        // Disable filtering & sorting, we control the results
        picker.matchOnLabel = picker.matchOnDescription = picker.matchOnDetail = picker.sortByLabel = false;
        // Provide based on current active editor
        const pickerDisposable = disposables.add(new (0, $9cWcn.MutableDisposable)());
        pickerDisposable.value = this.doProvide(picker, token, runOptions);
        // Re-create whenever the active editor changes
        disposables.add(this.onDidActiveTextEditorControlChange(()=>{
            // Clear old
            pickerDisposable.value = undefined;
            // Add new
            pickerDisposable.value = this.doProvide(picker, token);
        }));
        return disposables;
    }
    doProvide(picker, token, runOptions) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        // With text control
        const editor = this.activeTextEditorControl;
        if (editor && this.canProvideWithTextEditor(editor)) {
            const context = {
                editor: editor
            };
            // Restore any view state if this picker was closed
            // without actually going to a line
            const codeEditor = (0, $7UXLG.getCodeEditor)(editor);
            if (codeEditor) {
                // Remember view state and update it when the cursor position
                // changes even later because it could be that the user has
                // configured quick access to remain open when focus is lost and
                // we always want to restore the current location.
                let lastKnownEditorViewState = editor.saveViewState() ?? undefined;
                disposables.add(codeEditor.onDidChangeCursorPosition(()=>{
                    lastKnownEditorViewState = editor.saveViewState() ?? undefined;
                }));
                context.restoreViewState = ()=>{
                    if (lastKnownEditorViewState && editor === this.activeTextEditorControl) editor.restoreViewState(lastKnownEditorViewState);
                };
                disposables.add((0, $5eGXQ.createSingleCallFunction)(token.onCancellationRequested)(()=>context.restoreViewState?.()));
            }
            // Clean up decorations on dispose
            disposables.add((0, $9cWcn.toDisposable)(()=>this.clearDecorations(editor)));
            // Ask subclass for entries
            disposables.add(this.provideWithTextEditor(context, picker, token, runOptions));
        } else disposables.add(this.provideWithoutTextEditor(picker, token));
        return disposables;
    }
    /**
     * Subclasses to implement if they can operate on the text editor.
     */ canProvideWithTextEditor(editor) {
        return true;
    }
    gotoLocation({ editor: editor }, options) {
        editor.setSelection(options.range, "code.jump" /* TextEditorSelectionSource.JUMP */ );
        editor.revealRangeInCenter(options.range, 0 /* ScrollType.Smooth */ );
        if (!options.preserveFocus) editor.focus();
        const model = editor.getModel();
        if (model && 'getLineContent' in model) (0, $aIbUW.status)(`${model.getLineContent(options.range.startLineNumber)}`);
    }
    getModel(editor) {
        return (0, $7UXLG.isDiffEditor)(editor) ? editor.getModel()?.modified : editor.getModel();
    }
    addDecorations(editor, range) {
        editor.changeDecorations((changeAccessor)=>{
            // Reset old decorations if any
            const deleteDecorations = [];
            if (this.rangeHighlightDecorationId) {
                deleteDecorations.push(this.rangeHighlightDecorationId.overviewRulerDecorationId);
                deleteDecorations.push(this.rangeHighlightDecorationId.rangeHighlightId);
                this.rangeHighlightDecorationId = undefined;
            }
            // Add new decorations for the range
            const newDecorations = [
                // highlight the entire line on the range
                {
                    range: range,
                    options: {
                        description: 'quick-access-range-highlight',
                        className: 'rangeHighlight',
                        isWholeLine: true
                    }
                },
                // also add overview ruler highlight
                {
                    range: range,
                    options: {
                        description: 'quick-access-range-highlight-overview',
                        overviewRuler: {
                            color: (0, $azIPz.themeColorFromId)((0, $cw0ys.overviewRulerRangeHighlight)),
                            position: (0, $1Y4vr.OverviewRulerLane).Full
                        }
                    }
                }
            ];
            const [rangeHighlightId, overviewRulerDecorationId] = changeAccessor.deltaDecorations(deleteDecorations, newDecorations);
            this.rangeHighlightDecorationId = {
                rangeHighlightId: rangeHighlightId,
                overviewRulerDecorationId: overviewRulerDecorationId
            };
        });
    }
    clearDecorations(editor) {
        const rangeHighlightDecorationId = this.rangeHighlightDecorationId;
        if (rangeHighlightDecorationId) {
            editor.changeDecorations((changeAccessor)=>{
                changeAccessor.deltaDecorations([
                    rangeHighlightDecorationId.overviewRulerDecorationId,
                    rangeHighlightDecorationId.rangeHighlightId
                ], []);
            });
            this.rangeHighlightDecorationId = undefined;
        }
    }
}



var $4dEdH = parcelRequire("4dEdH");
class $249582c8b040043d$export$c7e3af26311986a extends (0, $5bdaebb58d187dc3$export$6c0961619607218e) {
    static{
        this.PREFIX = ':';
    }
    constructor(){
        super({
            canAcceptInBackground: true
        });
    }
    provideWithoutTextEditor(picker) {
        const label = (0, $4dEdH.localize)('cannotRunGotoLine', "Open a text editor first to go to a line.");
        picker.items = [
            {
                label: label
            }
        ];
        picker.ariaLabel = label;
        return (0, $9cWcn.Disposable).None;
    }
    provideWithTextEditor(context, picker, token) {
        const editor = context.editor;
        const disposables = new (0, $9cWcn.DisposableStore)();
        // Goto line once picked
        disposables.add(picker.onDidAccept((event)=>{
            const [item] = picker.selectedItems;
            if (item) {
                if (!this.isValidLineNumber(editor, item.lineNumber)) return;
                this.gotoLocation(context, {
                    range: this.toRange(item.lineNumber, item.column),
                    keyMods: picker.keyMods,
                    preserveFocus: event.inBackground
                });
                if (!event.inBackground) picker.hide();
            }
        }));
        // React to picker changes
        const updatePickerAndEditor = ()=>{
            const position = this.parsePosition(editor, picker.value.trim().substr($249582c8b040043d$export$c7e3af26311986a.PREFIX.length));
            const label = this.getPickLabel(editor, position.lineNumber, position.column);
            // Picker
            picker.items = [
                {
                    lineNumber: position.lineNumber,
                    column: position.column,
                    label: label
                }
            ];
            // ARIA Label
            picker.ariaLabel = label;
            // Clear decorations for invalid range
            if (!this.isValidLineNumber(editor, position.lineNumber)) {
                this.clearDecorations(editor);
                return;
            }
            // Reveal
            const range = this.toRange(position.lineNumber, position.column);
            editor.revealRangeInCenter(range, 0 /* ScrollType.Smooth */ );
            // Decorate
            this.addDecorations(editor, range);
        };
        updatePickerAndEditor();
        disposables.add(picker.onDidChangeValue(()=>updatePickerAndEditor()));
        // Adjust line number visibility as needed
        const codeEditor = (0, $7UXLG.getCodeEditor)(editor);
        if (codeEditor) {
            const options = codeEditor.getOptions();
            const lineNumbers = options.get(68 /* EditorOption.lineNumbers */ );
            if (lineNumbers.renderType === 2 /* RenderLineNumbersType.Relative */ ) {
                codeEditor.updateOptions({
                    lineNumbers: 'on'
                });
                disposables.add((0, $9cWcn.toDisposable)(()=>codeEditor.updateOptions({
                        lineNumbers: 'relative'
                    })));
            }
        }
        return disposables;
    }
    toRange(lineNumber = 1, column = 1) {
        return {
            startLineNumber: lineNumber,
            startColumn: column,
            endLineNumber: lineNumber,
            endColumn: column
        };
    }
    parsePosition(editor, value) {
        // Support line-col formats of `line,col`, `line:col`, `line#col`
        const numbers = value.split(/,|:|#/).map((part)=>parseInt(part, 10)).filter((part)=>!isNaN(part));
        const endLine = this.lineCount(editor) + 1;
        return {
            lineNumber: numbers[0] > 0 ? numbers[0] : endLine + numbers[0],
            column: numbers[1]
        };
    }
    getPickLabel(editor, lineNumber, column) {
        // Location valid: indicate this as picker label
        if (this.isValidLineNumber(editor, lineNumber)) {
            if (this.isValidColumn(editor, lineNumber, column)) return (0, $4dEdH.localize)('gotoLineColumnLabel', "Go to line {0} and character {1}.", lineNumber, column);
            return (0, $4dEdH.localize)('gotoLineLabel', "Go to line {0}.", lineNumber);
        }
        // Location invalid: show generic label
        const position = editor.getPosition() || {
            lineNumber: 1,
            column: 1
        };
        const lineCount = this.lineCount(editor);
        if (lineCount > 1) return (0, $4dEdH.localize)('gotoLineLabelEmptyWithLimit', "Current Line: {0}, Character: {1}. Type a line number between 1 and {2} to navigate to.", position.lineNumber, position.column, lineCount);
        return (0, $4dEdH.localize)('gotoLineLabelEmpty', "Current Line: {0}, Character: {1}. Type a line number to navigate to.", position.lineNumber, position.column);
    }
    isValidLineNumber(editor, lineNumber) {
        if (!lineNumber || typeof lineNumber !== 'number') return false;
        return lineNumber > 0 && lineNumber <= this.lineCount(editor);
    }
    isValidColumn(editor, lineNumber, column) {
        if (!column || typeof column !== 'number') return false;
        const model = this.getModel(editor);
        if (!model) return false;
        const positionCandidate = {
            lineNumber: lineNumber,
            column: column
        };
        return model.validatePosition(positionCandidate).equals(positionCandidate);
    }
    lineCount(editor) {
        return this.getModel(editor)?.getLineCount() ?? 0;
    }
}



var $TezJS = parcelRequire("TezJS");

var $7Oj2p = parcelRequire("7Oj2p");

var $2Qfl0 = parcelRequire("2Qfl0");

var $82TRE = parcelRequire("82TRE");

var $5YaSO = parcelRequire("5YaSO");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $3XkzC = parcelRequire("3XkzC");
var $b06ed5b6a95bf9f3$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $b06ed5b6a95bf9f3$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $b06ed5b6a95bf9f3$export$62f50e6a0744204 = class StandaloneGotoLineQuickAccessProvider extends (0, $249582c8b040043d$export$c7e3af26311986a) {
    constructor(editorService){
        super();
        this.editorService = editorService;
        this.onDidActiveTextEditorControlChange = (0, $5YaSO.Event).None;
    }
    get activeTextEditorControl() {
        return this.editorService.getFocusedCodeEditor() ?? undefined;
    }
};
$b06ed5b6a95bf9f3$export$62f50e6a0744204 = $b06ed5b6a95bf9f3$var$__decorate([
    $b06ed5b6a95bf9f3$var$__param(0, (0, $2Qfl0.ICodeEditorService))
], $b06ed5b6a95bf9f3$export$62f50e6a0744204);
class $b06ed5b6a95bf9f3$export$83454a444c35f5c1 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.gotoLine';
    }
    constructor(){
        super({
            id: $b06ed5b6a95bf9f3$export$83454a444c35f5c1.ID,
            label: (0, $82TRE.GoToLineNLS).gotoLineActionLabel,
            alias: 'Go to Line/Column...',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 2085 /* KeyCode.KeyG */ ,
                mac: {
                    primary: 293 /* KeyCode.KeyG */ 
                },
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            }
        });
    }
    run(accessor) {
        accessor.get((0, $3XkzC.IQuickInputService)).quickAccess.show($b06ed5b6a95bf9f3$export$62f50e6a0744204.PREFIX);
    }
}
(0, $2iJTi.registerEditorAction)($b06ed5b6a95bf9f3$export$83454a444c35f5c1);
(0, $TezJS.Registry).as((0, $7Oj2p.Extensions).Quickaccess).registerQuickAccessProvider({
    ctor: $b06ed5b6a95bf9f3$export$62f50e6a0744204,
    prefix: $b06ed5b6a95bf9f3$export$62f50e6a0744204.PREFIX,
    helpEntries: [
        {
            description: (0, $82TRE.GoToLineNLS).gotoLineActionLabel,
            commandId: $b06ed5b6a95bf9f3$export$83454a444c35f5c1.ID
        }
    ]
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $awgRE = parcelRequire("awgRE");

var $5rADe = parcelRequire("5rADe");

var $lk06m = parcelRequire("lk06m");

var $a4dH7 = parcelRequire("a4dH7");

var $lb0Ah = parcelRequire("lb0Ah");

var $jcr1R = parcelRequire("jcr1R");
const $796e972dbf53d5a8$var$NO_SCORE2 = [
    undefined,
    []
];
function $796e972dbf53d5a8$export$e22f4f530abefc49(target, query, patternStart = 0, wordStart = 0) {
    // Score: multiple inputs
    const preparedQuery = query;
    if (preparedQuery.values && preparedQuery.values.length > 1) return $796e972dbf53d5a8$var$doScoreFuzzy2Multiple(target, preparedQuery.values, patternStart, wordStart);
    // Score: single input
    return $796e972dbf53d5a8$var$doScoreFuzzy2Single(target, query, patternStart, wordStart);
}
function $796e972dbf53d5a8$var$doScoreFuzzy2Multiple(target, query, patternStart, wordStart) {
    let totalScore = 0;
    const totalMatches = [];
    for (const queryPiece of query){
        const [score, matches] = $796e972dbf53d5a8$var$doScoreFuzzy2Single(target, queryPiece, patternStart, wordStart);
        if (typeof score !== 'number') // if a single query value does not match, return with
        // no score entirely, we require all queries to match
        return $796e972dbf53d5a8$var$NO_SCORE2;
        totalScore += score;
        totalMatches.push(...matches);
    }
    // if we have a score, ensure that the positions are
    // sorted in ascending order and distinct
    return [
        totalScore,
        $796e972dbf53d5a8$var$normalizeMatches(totalMatches)
    ];
}
function $796e972dbf53d5a8$var$doScoreFuzzy2Single(target, query, patternStart, wordStart) {
    const score = (0, $lk06m.fuzzyScore)(query.original, query.originalLowercase, patternStart, target, target.toLowerCase(), wordStart, {
        firstMatchCanBeWeak: true,
        boostFullMatch: true
    });
    if (!score) return $796e972dbf53d5a8$var$NO_SCORE2;
    return [
        score[0],
        (0, $lk06m.createMatches)(score)
    ];
}
const $796e972dbf53d5a8$var$NO_ITEM_SCORE = Object.freeze({
    score: 0
});
function $796e972dbf53d5a8$var$normalizeMatches(matches) {
    // sort matches by start to be able to normalize
    const sortedMatches = matches.sort((matchA, matchB)=>{
        return matchA.start - matchB.start;
    });
    // merge matches that overlap
    const normalizedMatches = [];
    let currentMatch = undefined;
    for (const match of sortedMatches)// if we have no current match or the matches
    // do not overlap, we take it as is and remember
    // it for future merging
    if (!currentMatch || !$796e972dbf53d5a8$var$matchOverlaps(currentMatch, match)) {
        currentMatch = match;
        normalizedMatches.push(match);
    } else {
        currentMatch.start = Math.min(currentMatch.start, match.start);
        currentMatch.end = Math.max(currentMatch.end, match.end);
    }
    return normalizedMatches;
}
function $796e972dbf53d5a8$var$matchOverlaps(matchA, matchB) {
    if (matchA.end < matchB.start) return false; // A ends before B starts
    if (matchB.end < matchA.start) return false; // B ends before A starts
    return true;
}
/*
 * If a query is wrapped in quotes, the user does not want to
 * use fuzzy search for this query.
 */ function $796e972dbf53d5a8$var$queryExpectsExactMatch(query) {
    return query.startsWith('"') && query.endsWith('"');
}
/**
 * Helper function to prepare a search value for scoring by removing unwanted characters
 * and allowing to score on multiple pieces separated by whitespace character.
 */ const $796e972dbf53d5a8$var$MULTIPLE_QUERY_VALUES_SEPARATOR = ' ';
function $796e972dbf53d5a8$export$b7b2a481b84622e6(original) {
    if (typeof original !== 'string') original = '';
    const originalLowercase = original.toLowerCase();
    const { pathNormalized: pathNormalized, normalized: normalized, normalizedLowercase: normalizedLowercase } = $796e972dbf53d5a8$var$normalizeQuery(original);
    const containsPathSeparator = pathNormalized.indexOf((0, $a4dH7.sep)) >= 0;
    const expectExactMatch = $796e972dbf53d5a8$var$queryExpectsExactMatch(original);
    let values = undefined;
    const originalSplit = original.split($796e972dbf53d5a8$var$MULTIPLE_QUERY_VALUES_SEPARATOR);
    if (originalSplit.length > 1) for (const originalPiece of originalSplit){
        const expectExactMatchPiece = $796e972dbf53d5a8$var$queryExpectsExactMatch(originalPiece);
        const { pathNormalized: pathNormalizedPiece, normalized: normalizedPiece, normalizedLowercase: normalizedLowercasePiece } = $796e972dbf53d5a8$var$normalizeQuery(originalPiece);
        if (normalizedPiece) {
            if (!values) values = [];
            values.push({
                original: originalPiece,
                originalLowercase: originalPiece.toLowerCase(),
                pathNormalized: pathNormalizedPiece,
                normalized: normalizedPiece,
                normalizedLowercase: normalizedLowercasePiece,
                expectContiguousMatch: expectExactMatchPiece
            });
        }
    }
    return {
        original: original,
        originalLowercase: originalLowercase,
        pathNormalized: pathNormalized,
        normalized: normalized,
        normalizedLowercase: normalizedLowercase,
        values: values,
        containsPathSeparator: containsPathSeparator,
        expectContiguousMatch: expectExactMatch
    };
}
function $796e972dbf53d5a8$var$normalizeQuery(original) {
    let pathNormalized;
    if (0, $lb0Ah.isWindows) pathNormalized = original.replace(/\//g, (0, $a4dH7.sep)); // Help Windows users to search for paths when using slash
    else pathNormalized = original.replace(/\\/g, (0, $a4dH7.sep)); // Help macOS/Linux users to search for paths when using backslash
    // we remove quotes here because quotes are used for exact match search
    const normalized = (0, $jcr1R.stripWildcards)(pathNormalized).replace(/\s|"/g, '');
    return {
        pathNormalized: pathNormalized,
        normalized: normalized,
        normalizedLowercase: normalized.toLowerCase()
    };
}
function $796e972dbf53d5a8$export$20e144ebe86a7451(arg1) {
    if (Array.isArray(arg1)) return $796e972dbf53d5a8$export$b7b2a481b84622e6(arg1.map((piece)=>piece.original).join($796e972dbf53d5a8$var$MULTIPLE_QUERY_VALUES_SEPARATOR));
    return $796e972dbf53d5a8$export$b7b2a481b84622e6(arg1.original);
} //#endregion



var $9cWcn = parcelRequire("9cWcn");

var $jcr1R = parcelRequire("jcr1R");

var $d00il = parcelRequire("d00il");

var $kzNQX = parcelRequire("kzNQX");



var $4dEdH = parcelRequire("4dEdH");

var $4J6fu = parcelRequire("4J6fu");

var $7ysJc = parcelRequire("7ysJc");
var $3c0e32c30a737d8e$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $3c0e32c30a737d8e$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $3c0e32c30a737d8e$var$AbstractGotoSymbolQuickAccessProvider_1;
let $3c0e32c30a737d8e$export$ceb5fc4d82017d3b = class AbstractGotoSymbolQuickAccessProvider extends (0, $5bdaebb58d187dc3$export$6c0961619607218e) {
    static{
        $3c0e32c30a737d8e$var$AbstractGotoSymbolQuickAccessProvider_1 = this;
    }
    static{
        this.PREFIX = '@';
    }
    static{
        this.SCOPE_PREFIX = ':';
    }
    static{
        this.PREFIX_BY_CATEGORY = `${this.PREFIX}${this.SCOPE_PREFIX}`;
    }
    constructor(_languageFeaturesService, _outlineModelService, options = Object.create(null)){
        super(options);
        this._languageFeaturesService = _languageFeaturesService;
        this._outlineModelService = _outlineModelService;
        this.options = options;
        this.options.canAcceptInBackground = true;
    }
    provideWithoutTextEditor(picker) {
        this.provideLabelPick(picker, (0, $4dEdH.localize)('cannotRunGotoSymbolWithoutEditor', "To go to a symbol, first open a text editor with symbol information."));
        return (0, $9cWcn.Disposable).None;
    }
    provideWithTextEditor(context, picker, token, runOptions) {
        const editor = context.editor;
        const model = this.getModel(editor);
        if (!model) return (0, $9cWcn.Disposable).None;
        // Provide symbols from model if available in registry
        if (this._languageFeaturesService.documentSymbolProvider.has(model)) return this.doProvideWithEditorSymbols(context, model, picker, token, runOptions);
        // Otherwise show an entry for a model without registry
        // But give a chance to resolve the symbols at a later
        // point if possible
        return this.doProvideWithoutEditorSymbols(context, model, picker, token);
    }
    doProvideWithoutEditorSymbols(context, model, picker, token) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        // Generic pick for not having any symbol information
        this.provideLabelPick(picker, (0, $4dEdH.localize)('cannotRunGotoSymbolWithoutSymbolProvider', "The active text editor does not provide symbol information."));
        // Wait for changes to the registry and see if eventually
        // we do get symbols. This can happen if the picker is opened
        // very early after the model has loaded but before the
        // language registry is ready.
        // https://github.com/microsoft/vscode/issues/70607
        (async ()=>{
            const result = await this.waitForLanguageSymbolRegistry(model, disposables);
            if (!result || token.isCancellationRequested) return;
            disposables.add(this.doProvideWithEditorSymbols(context, model, picker, token));
        })();
        return disposables;
    }
    provideLabelPick(picker, label) {
        picker.items = [
            {
                label: label,
                index: 0,
                kind: 14 /* SymbolKind.String */ 
            }
        ];
        picker.ariaLabel = label;
    }
    async waitForLanguageSymbolRegistry(model, disposables) {
        if (this._languageFeaturesService.documentSymbolProvider.has(model)) return true;
        const symbolProviderRegistryPromise = new (0, $6bXyA.DeferredPromise)();
        // Resolve promise when registry knows model
        const symbolProviderListener = disposables.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>{
            if (this._languageFeaturesService.documentSymbolProvider.has(model)) {
                symbolProviderListener.dispose();
                symbolProviderRegistryPromise.complete(true);
            }
        }));
        // Resolve promise when we get disposed too
        disposables.add((0, $9cWcn.toDisposable)(()=>symbolProviderRegistryPromise.complete(false)));
        return symbolProviderRegistryPromise.p;
    }
    doProvideWithEditorSymbols(context, model, picker, token, runOptions) {
        const editor = context.editor;
        const disposables = new (0, $9cWcn.DisposableStore)();
        // Goto symbol once picked
        disposables.add(picker.onDidAccept((event)=>{
            const [item] = picker.selectedItems;
            if (item && item.range) {
                this.gotoLocation(context, {
                    range: item.range.selection,
                    keyMods: picker.keyMods,
                    preserveFocus: event.inBackground
                });
                runOptions?.handleAccept?.(item);
                if (!event.inBackground) picker.hide();
            }
        }));
        // Goto symbol side by side if enabled
        disposables.add(picker.onDidTriggerItemButton(({ item: item })=>{
            if (item && item.range) {
                this.gotoLocation(context, {
                    range: item.range.selection,
                    keyMods: picker.keyMods,
                    forceSideBySide: true
                });
                picker.hide();
            }
        }));
        // Resolve symbols from document once and reuse this
        // request for all filtering and typing then on
        const symbolsPromise = this.getDocumentSymbols(model, token);
        // Set initial picks and update on type
        let picksCts = undefined;
        const updatePickerItems = async (positionToEnclose)=>{
            // Cancel any previous ask for picks and busy
            picksCts?.dispose(true);
            picker.busy = false;
            // Create new cancellation source for this run
            picksCts = new (0, $giPcZ.CancellationTokenSource)(token);
            // Collect symbol picks
            picker.busy = true;
            try {
                const query = (0, $796e972dbf53d5a8$export$b7b2a481b84622e6)(picker.value.substr($3c0e32c30a737d8e$var$AbstractGotoSymbolQuickAccessProvider_1.PREFIX.length).trim());
                const items = await this.doGetSymbolPicks(symbolsPromise, query, undefined, picksCts.token, model);
                if (token.isCancellationRequested) return;
                if (items.length > 0) {
                    picker.items = items;
                    if (positionToEnclose && query.original.length === 0) {
                        const candidate = (0, $7ysJc.findLast)(items, (item)=>Boolean(item.type !== 'separator' && item.range && (0, $d00il.Range).containsPosition(item.range.decoration, positionToEnclose)));
                        if (candidate) picker.activeItems = [
                            candidate
                        ];
                    }
                } else if (query.original.length > 0) this.provideLabelPick(picker, (0, $4dEdH.localize)('noMatchingSymbolResults', "No matching editor symbols"));
                else this.provideLabelPick(picker, (0, $4dEdH.localize)('noSymbolResults', "No editor symbols"));
            } finally{
                if (!token.isCancellationRequested) picker.busy = false;
            }
        };
        disposables.add(picker.onDidChangeValue(()=>updatePickerItems(undefined)));
        updatePickerItems(editor.getSelection()?.getPosition());
        // Reveal and decorate when active item changes
        disposables.add(picker.onDidChangeActive(()=>{
            const [item] = picker.activeItems;
            if (item && item.range) {
                // Reveal
                editor.revealRangeInCenter(item.range.selection, 0 /* ScrollType.Smooth */ );
                // Decorate
                this.addDecorations(editor, item.range.decoration);
            }
        }));
        return disposables;
    }
    async doGetSymbolPicks(symbolsPromise, query, options, token, model) {
        const symbols = await symbolsPromise;
        if (token.isCancellationRequested) return [];
        const filterBySymbolKind = query.original.indexOf($3c0e32c30a737d8e$var$AbstractGotoSymbolQuickAccessProvider_1.SCOPE_PREFIX) === 0;
        const filterPos = filterBySymbolKind ? 1 : 0;
        // Split between symbol and container query
        let symbolQuery;
        let containerQuery;
        if (query.values && query.values.length > 1) {
            symbolQuery = (0, $796e972dbf53d5a8$export$20e144ebe86a7451)(query.values[0]); // symbol: only match on first part
            containerQuery = (0, $796e972dbf53d5a8$export$20e144ebe86a7451)(query.values.slice(1)); // container: match on all but first parts
        } else symbolQuery = query;
        // Convert to symbol picks and apply filtering
        let buttons;
        const openSideBySideDirection = this.options?.openSideBySideDirection?.();
        if (openSideBySideDirection) buttons = [
            {
                iconClass: openSideBySideDirection === 'right' ? (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).splitHorizontal) : (0, $5rADe.ThemeIcon).asClassName((0, $awgRE.Codicon).splitVertical),
                tooltip: openSideBySideDirection === 'right' ? (0, $4dEdH.localize)('openToSide', "Open to the Side") : (0, $4dEdH.localize)('openToBottom', "Open to the Bottom")
            }
        ];
        const filteredSymbolPicks = [];
        for(let index = 0; index < symbols.length; index++){
            const symbol = symbols[index];
            const symbolLabel = (0, $jcr1R.trim)(symbol.name);
            const symbolLabelWithIcon = `$(${(0, $kzNQX.SymbolKinds).toIcon(symbol.kind).id}) ${symbolLabel}`;
            const symbolLabelIconOffset = symbolLabelWithIcon.length - symbolLabel.length;
            let containerLabel = symbol.containerName;
            if (options?.extraContainerLabel) {
                if (containerLabel) containerLabel = `${options.extraContainerLabel} \u{2022} ${containerLabel}`;
                else containerLabel = options.extraContainerLabel;
            }
            let symbolScore = undefined;
            let symbolMatches = undefined;
            let containerScore = undefined;
            let containerMatches = undefined;
            if (query.original.length > filterPos) {
                // First: try to score on the entire query, it is possible that
                // the symbol matches perfectly (e.g. searching for "change log"
                // can be a match on a markdown symbol "change log"). In that
                // case we want to skip the container query altogether.
                let skipContainerQuery = false;
                if (symbolQuery !== query) {
                    [symbolScore, symbolMatches] = (0, $796e972dbf53d5a8$export$e22f4f530abefc49)(symbolLabelWithIcon, {
                        ...query,
                        values: undefined /* disable multi-query support */ 
                    }, filterPos, symbolLabelIconOffset);
                    if (typeof symbolScore === 'number') skipContainerQuery = true; // since we consumed the query, skip any container matching
                }
                // Otherwise: score on the symbol query and match on the container later
                if (typeof symbolScore !== 'number') {
                    [symbolScore, symbolMatches] = (0, $796e972dbf53d5a8$export$e22f4f530abefc49)(symbolLabelWithIcon, symbolQuery, filterPos, symbolLabelIconOffset);
                    if (typeof symbolScore !== 'number') continue;
                }
                // Score by container if specified
                if (!skipContainerQuery && containerQuery) {
                    if (containerLabel && containerQuery.original.length > 0) [containerScore, containerMatches] = (0, $796e972dbf53d5a8$export$e22f4f530abefc49)(containerLabel, containerQuery);
                    if (typeof containerScore !== 'number') continue;
                    if (typeof symbolScore === 'number') symbolScore += containerScore; // boost symbolScore by containerScore
                }
            }
            const deprecated = symbol.tags && symbol.tags.indexOf(1 /* SymbolTag.Deprecated */ ) >= 0;
            filteredSymbolPicks.push({
                index: index,
                kind: symbol.kind,
                score: symbolScore,
                label: symbolLabelWithIcon,
                ariaLabel: (0, $kzNQX.getAriaLabelForSymbol)(symbol.name, symbol.kind),
                description: containerLabel,
                highlights: deprecated ? undefined : {
                    label: symbolMatches,
                    description: containerMatches
                },
                range: {
                    selection: (0, $d00il.Range).collapseToStart(symbol.selectionRange),
                    decoration: symbol.range
                },
                uri: model.uri,
                symbolName: symbolLabel,
                strikethrough: deprecated,
                buttons: buttons
            });
        }
        // Sort by score
        const sortedFilteredSymbolPicks = filteredSymbolPicks.sort((symbolA, symbolB)=>filterBySymbolKind ? this.compareByKindAndScore(symbolA, symbolB) : this.compareByScore(symbolA, symbolB));
        // Add separator for types
        // - @  only total number of symbols
        // - @: grouped by symbol kind
        let symbolPicks = [];
        if (filterBySymbolKind) {
            let lastSymbolKind = undefined;
            let lastSeparator = undefined;
            let lastSymbolKindCounter = 0;
            function updateLastSeparatorLabel() {
                if (lastSeparator && typeof lastSymbolKind === 'number' && lastSymbolKindCounter > 0) lastSeparator.label = (0, $jcr1R.format)($3c0e32c30a737d8e$var$NLS_SYMBOL_KIND_CACHE[lastSymbolKind] || $3c0e32c30a737d8e$var$FALLBACK_NLS_SYMBOL_KIND, lastSymbolKindCounter);
            }
            for (const symbolPick of sortedFilteredSymbolPicks){
                // Found new kind
                if (lastSymbolKind !== symbolPick.kind) {
                    // Update last separator with number of symbols we found for kind
                    updateLastSeparatorLabel();
                    lastSymbolKind = symbolPick.kind;
                    lastSymbolKindCounter = 1;
                    // Add new separator for new kind
                    lastSeparator = {
                        type: 'separator'
                    };
                    symbolPicks.push(lastSeparator);
                } else lastSymbolKindCounter++;
                // Add to final result
                symbolPicks.push(symbolPick);
            }
            // Update last separator with number of symbols we found for kind
            updateLastSeparatorLabel();
        } else if (sortedFilteredSymbolPicks.length > 0) symbolPicks = [
            {
                label: (0, $4dEdH.localize)('symbols', "symbols ({0})", filteredSymbolPicks.length),
                type: 'separator'
            },
            ...sortedFilteredSymbolPicks
        ];
        return symbolPicks;
    }
    compareByScore(symbolA, symbolB) {
        if (typeof symbolA.score !== 'number' && typeof symbolB.score === 'number') return 1;
        else if (typeof symbolA.score === 'number' && typeof symbolB.score !== 'number') return -1;
        if (typeof symbolA.score === 'number' && typeof symbolB.score === 'number') {
            if (symbolA.score > symbolB.score) return -1;
            else if (symbolA.score < symbolB.score) return 1;
        }
        if (symbolA.index < symbolB.index) return -1;
        else if (symbolA.index > symbolB.index) return 1;
        return 0;
    }
    compareByKindAndScore(symbolA, symbolB) {
        const kindA = $3c0e32c30a737d8e$var$NLS_SYMBOL_KIND_CACHE[symbolA.kind] || $3c0e32c30a737d8e$var$FALLBACK_NLS_SYMBOL_KIND;
        const kindB = $3c0e32c30a737d8e$var$NLS_SYMBOL_KIND_CACHE[symbolB.kind] || $3c0e32c30a737d8e$var$FALLBACK_NLS_SYMBOL_KIND;
        // Sort by type first if scoped search
        const result = kindA.localeCompare(kindB);
        if (result === 0) return this.compareByScore(symbolA, symbolB);
        return result;
    }
    async getDocumentSymbols(document, token) {
        const model = await this._outlineModelService.getOrCreate(document, token);
        return token.isCancellationRequested ? [] : model.asListOfDocumentSymbols();
    }
};
$3c0e32c30a737d8e$export$ceb5fc4d82017d3b = $3c0e32c30a737d8e$var$AbstractGotoSymbolQuickAccessProvider_1 = $3c0e32c30a737d8e$var$__decorate([
    $3c0e32c30a737d8e$var$__param(0, (0, $4J6fu.ILanguageFeaturesService)),
    $3c0e32c30a737d8e$var$__param(1, (0, $7f863e6a161b6d9f$export$8065412b6c424633))
], $3c0e32c30a737d8e$export$ceb5fc4d82017d3b);
// #region NLS Helpers
const $3c0e32c30a737d8e$var$FALLBACK_NLS_SYMBOL_KIND = (0, $4dEdH.localize)('property', "properties ({0})");
const $3c0e32c30a737d8e$var$NLS_SYMBOL_KIND_CACHE = {
    [5 /* SymbolKind.Method */ ]: (0, $4dEdH.localize)('method', "methods ({0})"),
    [11 /* SymbolKind.Function */ ]: (0, $4dEdH.localize)('function', "functions ({0})"),
    [8 /* SymbolKind.Constructor */ ]: (0, $4dEdH.localize)('_constructor', "constructors ({0})"),
    [12 /* SymbolKind.Variable */ ]: (0, $4dEdH.localize)('variable', "variables ({0})"),
    [4 /* SymbolKind.Class */ ]: (0, $4dEdH.localize)('class', "classes ({0})"),
    [22 /* SymbolKind.Struct */ ]: (0, $4dEdH.localize)('struct', "structs ({0})"),
    [23 /* SymbolKind.Event */ ]: (0, $4dEdH.localize)('event', "events ({0})"),
    [24 /* SymbolKind.Operator */ ]: (0, $4dEdH.localize)('operator', "operators ({0})"),
    [10 /* SymbolKind.Interface */ ]: (0, $4dEdH.localize)('interface', "interfaces ({0})"),
    [2 /* SymbolKind.Namespace */ ]: (0, $4dEdH.localize)('namespace', "namespaces ({0})"),
    [3 /* SymbolKind.Package */ ]: (0, $4dEdH.localize)('package', "packages ({0})"),
    [25 /* SymbolKind.TypeParameter */ ]: (0, $4dEdH.localize)('typeParameter', "type parameters ({0})"),
    [1 /* SymbolKind.Module */ ]: (0, $4dEdH.localize)('modules', "modules ({0})"),
    [6 /* SymbolKind.Property */ ]: (0, $4dEdH.localize)('property', "properties ({0})"),
    [9 /* SymbolKind.Enum */ ]: (0, $4dEdH.localize)('enum', "enumerations ({0})"),
    [21 /* SymbolKind.EnumMember */ ]: (0, $4dEdH.localize)('enumMember', "enumeration members ({0})"),
    [14 /* SymbolKind.String */ ]: (0, $4dEdH.localize)('string', "strings ({0})"),
    [0 /* SymbolKind.File */ ]: (0, $4dEdH.localize)('file', "files ({0})"),
    [17 /* SymbolKind.Array */ ]: (0, $4dEdH.localize)('array', "arrays ({0})"),
    [15 /* SymbolKind.Number */ ]: (0, $4dEdH.localize)('number', "numbers ({0})"),
    [16 /* SymbolKind.Boolean */ ]: (0, $4dEdH.localize)('boolean', "booleans ({0})"),
    [18 /* SymbolKind.Object */ ]: (0, $4dEdH.localize)('object', "objects ({0})"),
    [19 /* SymbolKind.Key */ ]: (0, $4dEdH.localize)('key', "keys ({0})"),
    [7 /* SymbolKind.Field */ ]: (0, $4dEdH.localize)('field', "fields ({0})"),
    [13 /* SymbolKind.Constant */ ]: (0, $4dEdH.localize)('constant', "constants ({0})")
}; //#endregion



var $TezJS = parcelRequire("TezJS");

var $7Oj2p = parcelRequire("7Oj2p");

var $2Qfl0 = parcelRequire("2Qfl0");

var $82TRE = parcelRequire("82TRE");

var $5YaSO = parcelRequire("5YaSO");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $3XkzC = parcelRequire("3XkzC");


var $4J6fu = parcelRequire("4J6fu");
var $506c64b5cded2bda$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $506c64b5cded2bda$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $506c64b5cded2bda$export$1891c65a7e9a2e48 = class StandaloneGotoSymbolQuickAccessProvider extends (0, $3c0e32c30a737d8e$export$ceb5fc4d82017d3b) {
    constructor(editorService, languageFeaturesService, outlineModelService){
        super(languageFeaturesService, outlineModelService);
        this.editorService = editorService;
        this.onDidActiveTextEditorControlChange = (0, $5YaSO.Event).None;
    }
    get activeTextEditorControl() {
        return this.editorService.getFocusedCodeEditor() ?? undefined;
    }
};
$506c64b5cded2bda$export$1891c65a7e9a2e48 = $506c64b5cded2bda$var$__decorate([
    $506c64b5cded2bda$var$__param(0, (0, $2Qfl0.ICodeEditorService)),
    $506c64b5cded2bda$var$__param(1, (0, $4J6fu.ILanguageFeaturesService)),
    $506c64b5cded2bda$var$__param(2, (0, $7f863e6a161b6d9f$export$8065412b6c424633))
], $506c64b5cded2bda$export$1891c65a7e9a2e48);
class $506c64b5cded2bda$export$f8bc32f580b83372 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.quickOutline';
    }
    constructor(){
        super({
            id: $506c64b5cded2bda$export$f8bc32f580b83372.ID,
            label: (0, $82TRE.QuickOutlineNLS).quickOutlineActionLabel,
            alias: 'Go to Symbol...',
            precondition: (0, $ibKGQ.EditorContextKeys).hasDocumentSymbolProvider,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 3117 /* KeyCode.KeyO */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            contextMenuOpts: {
                group: 'navigation',
                order: 3
            }
        });
    }
    run(accessor) {
        accessor.get((0, $3XkzC.IQuickInputService)).quickAccess.show((0, $3c0e32c30a737d8e$export$ceb5fc4d82017d3b).PREFIX, {
            itemActivation: (0, $3XkzC.ItemActivation).NONE
        });
    }
}
(0, $2iJTi.registerEditorAction)($506c64b5cded2bda$export$f8bc32f580b83372);
(0, $TezJS.Registry).as((0, $7Oj2p.Extensions).Quickaccess).registerQuickAccessProvider({
    ctor: $506c64b5cded2bda$export$1891c65a7e9a2e48,
    prefix: (0, $3c0e32c30a737d8e$export$ceb5fc4d82017d3b).PREFIX,
    helpEntries: [
        {
            description: (0, $82TRE.QuickOutlineNLS).quickOutlineActionLabel,
            prefix: (0, $3c0e32c30a737d8e$export$ceb5fc4d82017d3b).PREFIX,
            commandId: $506c64b5cded2bda$export$f8bc32f580b83372.ID
        },
        {
            description: (0, $82TRE.QuickOutlineNLS).quickOutlineByCategoryActionLabel,
            prefix: (0, $3c0e32c30a737d8e$export$ceb5fc4d82017d3b).PREFIX_BY_CATEGORY
        }
    ]
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $TezJS = parcelRequire("TezJS");

var $7Oj2p = parcelRequire("7Oj2p");

var $82TRE = parcelRequire("82TRE");

var $2Qfl0 = parcelRequire("2Qfl0");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $3PwGr = parcelRequire("3PwGr");

var $8XSWp = parcelRequire("8XSWp");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 

var $gPkHZ = parcelRequire("gPkHZ");

var $lk06m = parcelRequire("lk06m");

var $5eGXQ = parcelRequire("5eGXQ");

var $9cWcn = parcelRequire("9cWcn");

var $askDf = parcelRequire("askDf");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ function $336c4d80846fe220$var$countMapFrom(values) {
    const map = new Map();
    for (const value of values)map.set(value, (map.get(value) ?? 0) + 1);
    return map;
}
class $336c4d80846fe220$export$bd0d670b5e127c7a {
    constructor(){
        /**
         * Total number of chunks
         */ this.chunkCount = 0;
        this.chunkOccurrences = new Map();
        this.documents = new Map();
    }
    calculateScores(query, token) {
        const embedding = this.computeEmbedding(query);
        const idfCache = new Map();
        const scores = [];
        // For each document, generate one score
        for (const [key, doc] of this.documents){
            if (token.isCancellationRequested) return [];
            for (const chunk of doc.chunks){
                const score = this.computeSimilarityScore(chunk, embedding, idfCache);
                if (score > 0) scores.push({
                    key: key,
                    score: score
                });
            }
        }
        return scores;
    }
    /**
     * Count how many times each term (word) appears in a string.
     */ static termFrequencies(input) {
        return $336c4d80846fe220$var$countMapFrom($336c4d80846fe220$export$bd0d670b5e127c7a.splitTerms(input));
    }
    /**
     * Break a string into terms (words).
     */ static *splitTerms(input) {
        const normalize = (word)=>word.toLowerCase();
        // Only match on words that are at least 3 characters long and start with a letter
        for (const [word] of input.matchAll(/\b\p{Letter}[\p{Letter}\d]{2,}\b/gu)){
            yield normalize(word);
            const camelParts = word.replace(/([a-z])([A-Z])/g, '$1 $2').split(/\s+/g);
            if (camelParts.length > 1) {
                for (const part of camelParts)// Require at least 3 letters in the parts of a camel case word
                if (part.length > 2 && /\p{Letter}{3,}/gu.test(part)) yield normalize(part);
            }
        }
    }
    updateDocuments(documents) {
        for (const { key: key } of documents)this.deleteDocument(key);
        for (const doc of documents){
            const chunks = [];
            for (const text of doc.textChunks){
                // TODO: See if we can compute the tf lazily
                // The challenge is that we need to also update the `chunkOccurrences`
                // and all of those updates need to get flushed before the real TF-IDF of
                // anything is computed.
                const tf = $336c4d80846fe220$export$bd0d670b5e127c7a.termFrequencies(text);
                // Update occurrences list
                for (const term of tf.keys())this.chunkOccurrences.set(term, (this.chunkOccurrences.get(term) ?? 0) + 1);
                chunks.push({
                    text: text,
                    tf: tf
                });
            }
            this.chunkCount += chunks.length;
            this.documents.set(doc.key, {
                chunks: chunks
            });
        }
        return this;
    }
    deleteDocument(key) {
        const doc = this.documents.get(key);
        if (!doc) return;
        this.documents.delete(key);
        this.chunkCount -= doc.chunks.length;
        // Update term occurrences for the document
        for (const chunk of doc.chunks)for (const term of chunk.tf.keys()){
            const currentOccurrences = this.chunkOccurrences.get(term);
            if (typeof currentOccurrences === 'number') {
                const newOccurrences = currentOccurrences - 1;
                if (newOccurrences <= 0) this.chunkOccurrences.delete(term);
                else this.chunkOccurrences.set(term, newOccurrences);
            }
        }
    }
    computeSimilarityScore(chunk, queryEmbedding, idfCache) {
        // Compute the dot product between the chunk's embedding and the query embedding
        // Note that the chunk embedding is computed lazily on a per-term basis.
        // This lets us skip a large number of calculations because the majority
        // of chunks do not share any terms with the query.
        let sum = 0;
        for (const [term, termTfidf] of Object.entries(queryEmbedding)){
            const chunkTf = chunk.tf.get(term);
            if (!chunkTf) continue;
            let chunkIdf = idfCache.get(term);
            if (typeof chunkIdf !== 'number') {
                chunkIdf = this.computeIdf(term);
                idfCache.set(term, chunkIdf);
            }
            const chunkTfidf = chunkTf * chunkIdf;
            sum += chunkTfidf * termTfidf;
        }
        return sum;
    }
    computeEmbedding(input) {
        const tf = $336c4d80846fe220$export$bd0d670b5e127c7a.termFrequencies(input);
        return this.computeTfidf(tf);
    }
    computeIdf(term) {
        const chunkOccurrences = this.chunkOccurrences.get(term) ?? 0;
        return chunkOccurrences > 0 ? Math.log((this.chunkCount + 1) / chunkOccurrences) : 0;
    }
    computeTfidf(termFrequencies) {
        const embedding = Object.create(null);
        for (const [word, occurrences] of termFrequencies){
            const idf = this.computeIdf(word);
            if (idf > 0) embedding[word] = occurrences * idf;
        }
        return embedding;
    }
}
function $336c4d80846fe220$export$65d84e111c6ad8b3(scores) {
    // copy of scores
    const result = scores.slice(0);
    // sort descending
    result.sort((a, b)=>b.score - a.score);
    // normalize
    const max = result[0]?.score ?? 0;
    if (max > 0) for (const score of result)score.score /= max;
    return result;
}



var $4dEdH = parcelRequire("4dEdH");

var $8tcMz = parcelRequire("8tcMz");

var $35IZ9 = parcelRequire("35IZ9");

var $iERup = parcelRequire("iERup");

var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $dvEeB = parcelRequire("dvEeB");
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $6bXyA = parcelRequire("6bXyA");

var $giPcZ = parcelRequire("giPcZ");

var $9cWcn = parcelRequire("9cWcn");

var $bxBg7 = parcelRequire("bxBg7");
var $8a24db115be4b14e$export$43c639767ba93dcc;
(function(TriggerAction) {
    /**
     * Do nothing after the button was clicked.
     */ TriggerAction[TriggerAction["NO_ACTION"] = 0] = "NO_ACTION";
    /**
     * Close the picker.
     */ TriggerAction[TriggerAction["CLOSE_PICKER"] = 1] = "CLOSE_PICKER";
    /**
     * Update the results of the picker.
     */ TriggerAction[TriggerAction["REFRESH_PICKER"] = 2] = "REFRESH_PICKER";
    /**
     * Remove the item from the picker.
     */ TriggerAction[TriggerAction["REMOVE_ITEM"] = 3] = "REMOVE_ITEM";
})($8a24db115be4b14e$export$43c639767ba93dcc || ($8a24db115be4b14e$export$43c639767ba93dcc = {}));
function $8a24db115be4b14e$var$isPicksWithActive(obj) {
    const candidate = obj;
    return Array.isArray(candidate.items);
}
function $8a24db115be4b14e$var$isFastAndSlowPicks(obj) {
    const candidate = obj;
    return !!candidate.picks && candidate.additionalPicks instanceof Promise;
}
class $8a24db115be4b14e$export$76827b77f41011c2 extends (0, $9cWcn.Disposable) {
    constructor(prefix, options){
        super();
        this.prefix = prefix;
        this.options = options;
    }
    provide(picker, token, runOptions) {
        const disposables = new (0, $9cWcn.DisposableStore)();
        // Apply options if any
        picker.canAcceptInBackground = !!this.options?.canAcceptInBackground;
        // Disable filtering & sorting, we control the results
        picker.matchOnLabel = picker.matchOnDescription = picker.matchOnDetail = picker.sortByLabel = false;
        // Set initial picks and update on type
        let picksCts = undefined;
        const picksDisposable = disposables.add(new (0, $9cWcn.MutableDisposable)());
        const updatePickerItems = async ()=>{
            const picksDisposables = picksDisposable.value = new (0, $9cWcn.DisposableStore)();
            // Cancel any previous ask for picks and busy
            picksCts?.dispose(true);
            picker.busy = false;
            // Create new cancellation source for this run
            picksCts = new (0, $giPcZ.CancellationTokenSource)(token);
            // Collect picks and support both long running and short or combined
            const picksToken = picksCts.token;
            let picksFilter = picker.value.substring(this.prefix.length);
            if (!this.options?.shouldSkipTrimPickFilter) picksFilter = picksFilter.trim();
            const providedPicks = this._getPicks(picksFilter, picksDisposables, picksToken, runOptions);
            const applyPicks = (picks, skipEmpty)=>{
                let items;
                let activeItem = undefined;
                if ($8a24db115be4b14e$var$isPicksWithActive(picks)) {
                    items = picks.items;
                    activeItem = picks.active;
                } else items = picks;
                if (items.length === 0) {
                    if (skipEmpty) return false;
                    // We show the no results pick if we have no input to prevent completely empty pickers #172613
                    if ((picksFilter.length > 0 || picker.hideInput) && this.options?.noResultsPick) {
                        if ((0, $bxBg7.isFunction)(this.options.noResultsPick)) items = [
                            this.options.noResultsPick(picksFilter)
                        ];
                        else items = [
                            this.options.noResultsPick
                        ];
                    }
                }
                picker.items = items;
                if (activeItem) picker.activeItems = [
                    activeItem
                ];
                return true;
            };
            const applyFastAndSlowPicks = async (fastAndSlowPicks)=>{
                let fastPicksApplied = false;
                let slowPicksApplied = false;
                await Promise.all([
                    // Fast Picks: if `mergeDelay` is configured, in order to reduce
                    // amount of flicker, we race against the slow picks over some delay
                    // and then set the fast picks.
                    // If the slow picks are faster, we reduce the flicker by only
                    // setting the items once.
                    (async ()=>{
                        if (typeof fastAndSlowPicks.mergeDelay === 'number') {
                            await (0, $6bXyA.timeout)(fastAndSlowPicks.mergeDelay);
                            if (picksToken.isCancellationRequested) return;
                        }
                        if (!slowPicksApplied) fastPicksApplied = applyPicks(fastAndSlowPicks.picks, true);
                    })(),
                    // Slow Picks: we await the slow picks and then set them at
                    // once together with the fast picks, but only if we actually
                    // have additional results.
                    (async ()=>{
                        picker.busy = true;
                        try {
                            const awaitedAdditionalPicks = await fastAndSlowPicks.additionalPicks;
                            if (picksToken.isCancellationRequested) return;
                            let picks;
                            let activePick = undefined;
                            if ($8a24db115be4b14e$var$isPicksWithActive(fastAndSlowPicks.picks)) {
                                picks = fastAndSlowPicks.picks.items;
                                activePick = fastAndSlowPicks.picks.active;
                            } else picks = fastAndSlowPicks.picks;
                            let additionalPicks;
                            let additionalActivePick = undefined;
                            if ($8a24db115be4b14e$var$isPicksWithActive(awaitedAdditionalPicks)) {
                                additionalPicks = awaitedAdditionalPicks.items;
                                additionalActivePick = awaitedAdditionalPicks.active;
                            } else additionalPicks = awaitedAdditionalPicks;
                            if (additionalPicks.length > 0 || !fastPicksApplied) {
                                // If we do not have any activePick or additionalActivePick
                                // we try to preserve the currently active pick from the
                                // fast results. This fixes an issue where the user might
                                // have made a pick active before the additional results
                                // kick in.
                                // See https://github.com/microsoft/vscode/issues/102480
                                let fallbackActivePick = undefined;
                                if (!activePick && !additionalActivePick) {
                                    const fallbackActivePickCandidate = picker.activeItems[0];
                                    if (fallbackActivePickCandidate && picks.indexOf(fallbackActivePickCandidate) !== -1) fallbackActivePick = fallbackActivePickCandidate;
                                }
                                applyPicks({
                                    items: [
                                        ...picks,
                                        ...additionalPicks
                                    ],
                                    active: activePick || additionalActivePick || fallbackActivePick
                                });
                            }
                        } finally{
                            if (!picksToken.isCancellationRequested) picker.busy = false;
                            slowPicksApplied = true;
                        }
                    })()
                ]);
            };
            // No Picks
            if (providedPicks === null) ;
            else if ($8a24db115be4b14e$var$isFastAndSlowPicks(providedPicks)) await applyFastAndSlowPicks(providedPicks);
            else if (!(providedPicks instanceof Promise)) applyPicks(providedPicks);
            else {
                picker.busy = true;
                try {
                    const awaitedPicks = await providedPicks;
                    if (picksToken.isCancellationRequested) return;
                    if ($8a24db115be4b14e$var$isFastAndSlowPicks(awaitedPicks)) await applyFastAndSlowPicks(awaitedPicks);
                    else applyPicks(awaitedPicks);
                } finally{
                    if (!picksToken.isCancellationRequested) picker.busy = false;
                }
            }
        };
        disposables.add(picker.onDidChangeValue(()=>updatePickerItems()));
        updatePickerItems();
        // Accept the pick on accept and hide picker
        disposables.add(picker.onDidAccept((event)=>{
            if (runOptions?.handleAccept) {
                if (!event.inBackground) picker.hide(); // hide picker unless we accept in background
                runOptions.handleAccept?.(picker.activeItems[0]);
                return;
            }
            const [item] = picker.selectedItems;
            if (typeof item?.accept === 'function') {
                if (!event.inBackground) picker.hide(); // hide picker unless we accept in background
                item.accept(picker.keyMods, event);
            }
        }));
        const buttonTrigger = async (button, item)=>{
            if (typeof item.trigger !== 'function') return;
            const buttonIndex = item.buttons?.indexOf(button) ?? -1;
            if (buttonIndex >= 0) {
                const result = item.trigger(buttonIndex, picker.keyMods);
                const action = typeof result === 'number' ? result : await result;
                if (token.isCancellationRequested) return;
                switch(action){
                    case $8a24db115be4b14e$export$43c639767ba93dcc.NO_ACTION:
                        break;
                    case $8a24db115be4b14e$export$43c639767ba93dcc.CLOSE_PICKER:
                        picker.hide();
                        break;
                    case $8a24db115be4b14e$export$43c639767ba93dcc.REFRESH_PICKER:
                        updatePickerItems();
                        break;
                    case $8a24db115be4b14e$export$43c639767ba93dcc.REMOVE_ITEM:
                        {
                            const index = picker.items.indexOf(item);
                            if (index !== -1) {
                                const items = picker.items.slice();
                                const removed = items.splice(index, 1);
                                const activeItems = picker.activeItems.filter((activeItem)=>activeItem !== removed[0]);
                                const keepScrollPositionBefore = picker.keepScrollPosition;
                                picker.keepScrollPosition = true;
                                picker.items = items;
                                if (activeItems) picker.activeItems = activeItems;
                                picker.keepScrollPosition = keepScrollPositionBefore;
                            }
                            break;
                        }
                }
            }
        };
        // Trigger the pick with button index if button triggered
        disposables.add(picker.onDidTriggerItemButton(({ button: button, item: item })=>buttonTrigger(button, item)));
        disposables.add(picker.onDidTriggerSeparatorButton(({ button: button, separator: separator })=>buttonTrigger(button, separator)));
        return disposables;
    }
}



var $2AUoS = parcelRequire("2AUoS");

var $lMGba = parcelRequire("lMGba");
var $b300ac387e19cb30$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $b300ac387e19cb30$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
var $b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1, $b300ac387e19cb30$var$CommandsHistory_1;
let $b300ac387e19cb30$export$e2727582285dc787 = class AbstractCommandsQuickAccessProvider extends (0, $8a24db115be4b14e$export$76827b77f41011c2) {
    static{
        $b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1 = this;
    }
    static{
        this.PREFIX = '>';
    }
    static{
        this.TFIDF_THRESHOLD = 0.5;
    }
    static{
        this.TFIDF_MAX_RESULTS = 5;
    }
    static{
        this.WORD_FILTER = (0, $lk06m.or)((0, $lk06m.matchesPrefix), (0, $lk06m.matchesWords), (0, $lk06m.matchesContiguousSubString));
    }
    constructor(options, instantiationService, keybindingService, commandService, telemetryService, dialogService){
        super($b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1.PREFIX, options);
        this.instantiationService = instantiationService;
        this.keybindingService = keybindingService;
        this.commandService = commandService;
        this.telemetryService = telemetryService;
        this.dialogService = dialogService;
        this.commandsHistory = this._register(this.instantiationService.createInstance($b300ac387e19cb30$export$57d1125e86e67be7));
        this.options = options;
    }
    async _getPicks(filter, _disposables, token, runOptions) {
        // Ask subclass for all command picks
        const allCommandPicks = await this.getCommandPicks(token);
        if (token.isCancellationRequested) return [];
        const runTfidf = (0, $5eGXQ.createSingleCallFunction)(()=>{
            const tfidf = new (0, $336c4d80846fe220$export$bd0d670b5e127c7a)();
            tfidf.updateDocuments(allCommandPicks.map((commandPick)=>({
                    key: commandPick.commandId,
                    textChunks: [
                        this.getTfIdfChunk(commandPick)
                    ]
                })));
            const result = tfidf.calculateScores(filter, token);
            return (0, $336c4d80846fe220$export$65d84e111c6ad8b3)(result).filter((score)=>score.score > $b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1.TFIDF_THRESHOLD).slice(0, $b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1.TFIDF_MAX_RESULTS);
        });
        // Filter
        const filteredCommandPicks = [];
        for (const commandPick of allCommandPicks){
            const labelHighlights = $b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1.WORD_FILTER(filter, commandPick.label) ?? undefined;
            const aliasHighlights = commandPick.commandAlias ? $b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1.WORD_FILTER(filter, commandPick.commandAlias) ?? undefined : undefined;
            // Add if matching in label or alias
            if (labelHighlights || aliasHighlights) {
                commandPick.highlights = {
                    label: labelHighlights,
                    detail: this.options.showAlias ? aliasHighlights : undefined
                };
                filteredCommandPicks.push(commandPick);
            } else if (filter === commandPick.commandId) filteredCommandPicks.push(commandPick);
            else if (filter.length >= 3) {
                const tfidf = runTfidf();
                if (token.isCancellationRequested) return [];
                // Add if we have a tf-idf score
                const tfidfScore = tfidf.find((score)=>score.key === commandPick.commandId);
                if (tfidfScore) {
                    commandPick.tfIdfScore = tfidfScore.score;
                    filteredCommandPicks.push(commandPick);
                }
            }
        }
        // Add description to commands that have duplicate labels
        const mapLabelToCommand = new Map();
        for (const commandPick of filteredCommandPicks){
            const existingCommandForLabel = mapLabelToCommand.get(commandPick.label);
            if (existingCommandForLabel) {
                commandPick.description = commandPick.commandId;
                existingCommandForLabel.description = existingCommandForLabel.commandId;
            } else mapLabelToCommand.set(commandPick.label, commandPick);
        }
        // Sort by MRU order and fallback to name otherwise
        filteredCommandPicks.sort((commandPickA, commandPickB)=>{
            // If a result came from tf-idf, we want to put that towards the bottom
            if (commandPickA.tfIdfScore && commandPickB.tfIdfScore) {
                if (commandPickA.tfIdfScore === commandPickB.tfIdfScore) return commandPickA.label.localeCompare(commandPickB.label); // prefer lexicographically smaller command
                return commandPickB.tfIdfScore - commandPickA.tfIdfScore; // prefer higher tf-idf score
            } else if (commandPickA.tfIdfScore) return 1; // first command has a score but other doesn't so other wins
            else if (commandPickB.tfIdfScore) return -1; // other command has a score but first doesn't so first wins
            const commandACounter = this.commandsHistory.peek(commandPickA.commandId);
            const commandBCounter = this.commandsHistory.peek(commandPickB.commandId);
            if (commandACounter && commandBCounter) return commandACounter > commandBCounter ? -1 : 1; // use more recently used command before older
            if (commandACounter) return -1; // first command was used, so it wins over the non used one
            if (commandBCounter) return 1; // other command was used so it wins over the command
            if (this.options.suggestedCommandIds) {
                const commandASuggestion = this.options.suggestedCommandIds.has(commandPickA.commandId);
                const commandBSuggestion = this.options.suggestedCommandIds.has(commandPickB.commandId);
                if (commandASuggestion && commandBSuggestion) return 0; // honor the order of the array
                if (commandASuggestion) return -1; // first command was suggested, so it wins over the non suggested one
                if (commandBSuggestion) return 1; // other command was suggested so it wins over the command
            }
            // both commands were never used, so we sort by name
            return commandPickA.label.localeCompare(commandPickB.label);
        });
        const commandPicks = [];
        let addOtherSeparator = false;
        let addSuggestedSeparator = true;
        let addCommonlyUsedSeparator = !!this.options.suggestedCommandIds;
        for(let i = 0; i < filteredCommandPicks.length; i++){
            const commandPick = filteredCommandPicks[i];
            // Separator: recently used
            if (i === 0 && this.commandsHistory.peek(commandPick.commandId)) {
                commandPicks.push({
                    type: 'separator',
                    label: (0, $4dEdH.localize)('recentlyUsed', "recently used")
                });
                addOtherSeparator = true;
            }
            if (addSuggestedSeparator && commandPick.tfIdfScore !== undefined) {
                commandPicks.push({
                    type: 'separator',
                    label: (0, $4dEdH.localize)('suggested', "similar commands")
                });
                addSuggestedSeparator = false;
            }
            // Separator: commonly used
            if (addCommonlyUsedSeparator && commandPick.tfIdfScore === undefined && !this.commandsHistory.peek(commandPick.commandId) && this.options.suggestedCommandIds?.has(commandPick.commandId)) {
                commandPicks.push({
                    type: 'separator',
                    label: (0, $4dEdH.localize)('commonlyUsed', "commonly used")
                });
                addOtherSeparator = true;
                addCommonlyUsedSeparator = false;
            }
            // Separator: other commands
            if (addOtherSeparator && commandPick.tfIdfScore === undefined && !this.commandsHistory.peek(commandPick.commandId) && !this.options.suggestedCommandIds?.has(commandPick.commandId)) {
                commandPicks.push({
                    type: 'separator',
                    label: (0, $4dEdH.localize)('morecCommands', "other commands")
                });
                addOtherSeparator = false;
            }
            // Command
            commandPicks.push(this.toCommandPick(commandPick, runOptions));
        }
        if (!this.hasAdditionalCommandPicks(filter, token)) return commandPicks;
        return {
            picks: commandPicks,
            additionalPicks: (async ()=>{
                const additionalCommandPicks = await this.getAdditionalCommandPicks(allCommandPicks, filteredCommandPicks, filter, token);
                if (token.isCancellationRequested) return [];
                const commandPicks = additionalCommandPicks.map((commandPick)=>this.toCommandPick(commandPick, runOptions));
                // Basically, if we haven't already added a separator, we add one before the additional picks so long
                // as one hasn't been added to the start of the array.
                if (addSuggestedSeparator && commandPicks[0]?.type !== 'separator') commandPicks.unshift({
                    type: 'separator',
                    label: (0, $4dEdH.localize)('suggested', "similar commands")
                });
                return commandPicks;
            })()
        };
    }
    toCommandPick(commandPick, runOptions) {
        if (commandPick.type === 'separator') return commandPick;
        const keybinding = this.keybindingService.lookupKeybinding(commandPick.commandId);
        const ariaLabel = keybinding ? (0, $4dEdH.localize)('commandPickAriaLabelWithKeybinding', "{0}, {1}", commandPick.label, keybinding.getAriaLabel()) : commandPick.label;
        return {
            ...commandPick,
            ariaLabel: ariaLabel,
            detail: this.options.showAlias && commandPick.commandAlias !== commandPick.label ? commandPick.commandAlias : undefined,
            keybinding: keybinding,
            accept: async ()=>{
                // Add to history
                this.commandsHistory.push(commandPick.commandId);
                // Telementry
                this.telemetryService.publicLog2('workbenchActionExecuted', {
                    id: commandPick.commandId,
                    from: runOptions?.from ?? 'quick open'
                });
                // Run
                try {
                    commandPick.args?.length ? await this.commandService.executeCommand(commandPick.commandId, ...commandPick.args) : await this.commandService.executeCommand(commandPick.commandId);
                } catch (error) {
                    if (!(0, $gPkHZ.isCancellationError)(error)) this.dialogService.error((0, $4dEdH.localize)('canNotRun', "Command '{0}' resulted in an error", commandPick.label), (0, $fe4e8839960fa4d7$export$95506c204c060a3)(error));
                }
            }
        };
    }
    // TF-IDF string to be indexed
    getTfIdfChunk({ label: label, commandAlias: commandAlias, commandDescription: commandDescription }) {
        let chunk = label;
        if (commandAlias && commandAlias !== label) chunk += ` - ${commandAlias}`;
        if (commandDescription && commandDescription.value !== label) // If the original is the same as the value, don't add it
        chunk += ` - ${commandDescription.value === commandDescription.original ? commandDescription.value : `${commandDescription.value} (${commandDescription.original})`}`;
        return chunk;
    }
};
$b300ac387e19cb30$export$e2727582285dc787 = $b300ac387e19cb30$var$AbstractCommandsQuickAccessProvider_1 = $b300ac387e19cb30$var$__decorate([
    $b300ac387e19cb30$var$__param(1, (0, $fdGPu.IInstantiationService)),
    $b300ac387e19cb30$var$__param(2, (0, $7IxGd.IKeybindingService)),
    $b300ac387e19cb30$var$__param(3, (0, $8tcMz.ICommandService)),
    $b300ac387e19cb30$var$__param(4, (0, $lMGba.ITelemetryService)),
    $b300ac387e19cb30$var$__param(5, (0, $iERup.IDialogService))
], $b300ac387e19cb30$export$e2727582285dc787);
let $b300ac387e19cb30$export$57d1125e86e67be7 = class CommandsHistory extends (0, $9cWcn.Disposable) {
    static{
        $b300ac387e19cb30$var$CommandsHistory_1 = this;
    }
    static{
        this.DEFAULT_COMMANDS_HISTORY_LENGTH = 50;
    }
    static{
        this.PREF_KEY_CACHE = 'commandPalette.mru.cache';
    }
    static{
        this.PREF_KEY_COUNTER = 'commandPalette.mru.counter';
    }
    static{
        this.counter = 1;
    }
    static{
        this.hasChanges = false;
    }
    constructor(storageService, configurationService, logService){
        super();
        this.storageService = storageService;
        this.configurationService = configurationService;
        this.logService = logService;
        this.configuredCommandsHistoryLength = 0;
        this.updateConfiguration();
        this.load();
        this.registerListeners();
    }
    registerListeners() {
        this._register(this.configurationService.onDidChangeConfiguration((e)=>this.updateConfiguration(e)));
        this._register(this.storageService.onWillSaveState((e)=>{
            if (e.reason === (0, $2AUoS.WillSaveStateReason).SHUTDOWN) // Commands history is very dynamic and so we limit impact
            // on storage to only save on shutdown. This helps reduce
            // the overhead of syncing this data across machines.
            this.saveState();
        }));
    }
    updateConfiguration(e) {
        if (e && !e.affectsConfiguration('workbench.commandPalette.history')) return;
        this.configuredCommandsHistoryLength = $b300ac387e19cb30$var$CommandsHistory_1.getConfiguredCommandHistoryLength(this.configurationService);
        if ($b300ac387e19cb30$var$CommandsHistory_1.cache && $b300ac387e19cb30$var$CommandsHistory_1.cache.limit !== this.configuredCommandsHistoryLength) {
            $b300ac387e19cb30$var$CommandsHistory_1.cache.limit = this.configuredCommandsHistoryLength;
            $b300ac387e19cb30$var$CommandsHistory_1.hasChanges = true;
        }
    }
    load() {
        const raw = this.storageService.get($b300ac387e19cb30$var$CommandsHistory_1.PREF_KEY_CACHE, 0 /* StorageScope.PROFILE */ );
        let serializedCache;
        if (raw) try {
            serializedCache = JSON.parse(raw);
        } catch (error) {
            this.logService.error(`[CommandsHistory] invalid data: ${error}`);
        }
        const cache = $b300ac387e19cb30$var$CommandsHistory_1.cache = new (0, $askDf.LRUCache)(this.configuredCommandsHistoryLength, 1);
        if (serializedCache) {
            let entries;
            if (serializedCache.usesLRU) entries = serializedCache.entries;
            else entries = serializedCache.entries.sort((a, b)=>a.value - b.value);
            entries.forEach((entry)=>cache.set(entry.key, entry.value));
        }
        $b300ac387e19cb30$var$CommandsHistory_1.counter = this.storageService.getNumber($b300ac387e19cb30$var$CommandsHistory_1.PREF_KEY_COUNTER, 0 /* StorageScope.PROFILE */ , $b300ac387e19cb30$var$CommandsHistory_1.counter);
    }
    push(commandId) {
        if (!$b300ac387e19cb30$var$CommandsHistory_1.cache) return;
        $b300ac387e19cb30$var$CommandsHistory_1.cache.set(commandId, $b300ac387e19cb30$var$CommandsHistory_1.counter++); // set counter to command
        $b300ac387e19cb30$var$CommandsHistory_1.hasChanges = true;
    }
    peek(commandId) {
        return $b300ac387e19cb30$var$CommandsHistory_1.cache?.peek(commandId);
    }
    saveState() {
        if (!$b300ac387e19cb30$var$CommandsHistory_1.cache) return;
        if (!$b300ac387e19cb30$var$CommandsHistory_1.hasChanges) return;
        const serializedCache = {
            usesLRU: true,
            entries: []
        };
        $b300ac387e19cb30$var$CommandsHistory_1.cache.forEach((value, key)=>serializedCache.entries.push({
                key: key,
                value: value
            }));
        this.storageService.store($b300ac387e19cb30$var$CommandsHistory_1.PREF_KEY_CACHE, JSON.stringify(serializedCache), 0 /* StorageScope.PROFILE */ , 0 /* StorageTarget.USER */ );
        this.storageService.store($b300ac387e19cb30$var$CommandsHistory_1.PREF_KEY_COUNTER, $b300ac387e19cb30$var$CommandsHistory_1.counter, 0 /* StorageScope.PROFILE */ , 0 /* StorageTarget.USER */ );
        $b300ac387e19cb30$var$CommandsHistory_1.hasChanges = false;
    }
    static getConfiguredCommandHistoryLength(configurationService) {
        const config = configurationService.getValue();
        const configuredCommandHistoryLength = config.workbench?.commandPalette?.history;
        if (typeof configuredCommandHistoryLength === 'number') return configuredCommandHistoryLength;
        return $b300ac387e19cb30$var$CommandsHistory_1.DEFAULT_COMMANDS_HISTORY_LENGTH;
    }
};
$b300ac387e19cb30$export$57d1125e86e67be7 = $b300ac387e19cb30$var$CommandsHistory_1 = $b300ac387e19cb30$var$__decorate([
    $b300ac387e19cb30$var$__param(0, (0, $2AUoS.IStorageService)),
    $b300ac387e19cb30$var$__param(1, (0, $35IZ9.IConfigurationService)),
    $b300ac387e19cb30$var$__param(2, (0, $dvEeB.ILogService))
], $b300ac387e19cb30$export$57d1125e86e67be7);


class $6440c4f439fe5142$export$e085036133fffa80 extends (0, $b300ac387e19cb30$export$e2727582285dc787) {
    constructor(options, instantiationService, keybindingService, commandService, telemetryService, dialogService){
        super(options, instantiationService, keybindingService, commandService, telemetryService, dialogService);
    }
    getCodeEditorCommandPicks() {
        const activeTextEditorControl = this.activeTextEditorControl;
        if (!activeTextEditorControl) return [];
        const editorCommandPicks = [];
        for (const editorAction of activeTextEditorControl.getSupportedActions()){
            let commandDescription;
            if (editorAction.metadata?.description) {
                if ((0, $8XSWp.isLocalizedString)(editorAction.metadata.description)) commandDescription = editorAction.metadata.description;
                else commandDescription = {
                    original: editorAction.metadata.description,
                    value: editorAction.metadata.description
                };
            }
            editorCommandPicks.push({
                commandId: editorAction.id,
                commandAlias: editorAction.alias,
                commandDescription: commandDescription,
                label: (0, $3PwGr.stripIcons)(editorAction.label) || editorAction.id
            });
        }
        return editorCommandPicks;
    }
}



var $fdGPu = parcelRequire("fdGPu");

var $7IxGd = parcelRequire("7IxGd");

var $8tcMz = parcelRequire("8tcMz");

var $lMGba = parcelRequire("lMGba");

var $iERup = parcelRequire("iERup");

var $2iJTi = parcelRequire("2iJTi");

var $ibKGQ = parcelRequire("ibKGQ");

var $3XkzC = parcelRequire("3XkzC");
var $cabf138d6fc5db0d$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $cabf138d6fc5db0d$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $cabf138d6fc5db0d$export$b53f517d2ef5810d = class StandaloneCommandsQuickAccessProvider extends (0, $6440c4f439fe5142$export$e085036133fffa80) {
    get activeTextEditorControl() {
        return this.codeEditorService.getFocusedCodeEditor() ?? undefined;
    }
    constructor(instantiationService, codeEditorService, keybindingService, commandService, telemetryService, dialogService){
        super({
            showAlias: false
        }, instantiationService, keybindingService, commandService, telemetryService, dialogService);
        this.codeEditorService = codeEditorService;
    }
    async getCommandPicks() {
        return this.getCodeEditorCommandPicks();
    }
    hasAdditionalCommandPicks() {
        return false;
    }
    async getAdditionalCommandPicks() {
        return [];
    }
};
$cabf138d6fc5db0d$export$b53f517d2ef5810d = $cabf138d6fc5db0d$var$__decorate([
    $cabf138d6fc5db0d$var$__param(0, (0, $fdGPu.IInstantiationService)),
    $cabf138d6fc5db0d$var$__param(1, (0, $2Qfl0.ICodeEditorService)),
    $cabf138d6fc5db0d$var$__param(2, (0, $7IxGd.IKeybindingService)),
    $cabf138d6fc5db0d$var$__param(3, (0, $8tcMz.ICommandService)),
    $cabf138d6fc5db0d$var$__param(4, (0, $lMGba.ITelemetryService)),
    $cabf138d6fc5db0d$var$__param(5, (0, $iERup.IDialogService))
], $cabf138d6fc5db0d$export$b53f517d2ef5810d);
class $cabf138d6fc5db0d$export$83454a444c35f5c1 extends (0, $2iJTi.EditorAction) {
    static{
        this.ID = 'editor.action.quickCommand';
    }
    constructor(){
        super({
            id: $cabf138d6fc5db0d$export$83454a444c35f5c1.ID,
            label: (0, $82TRE.QuickCommandNLS).quickCommandActionLabel,
            alias: 'Command Palette',
            precondition: undefined,
            kbOpts: {
                kbExpr: (0, $ibKGQ.EditorContextKeys).focus,
                primary: 59 /* KeyCode.F1 */ ,
                weight: 100 /* KeybindingWeight.EditorContrib */ 
            },
            contextMenuOpts: {
                group: 'z_commands',
                order: 1
            }
        });
    }
    run(accessor) {
        accessor.get((0, $3XkzC.IQuickInputService)).quickAccess.show($cabf138d6fc5db0d$export$b53f517d2ef5810d.PREFIX);
    }
}
(0, $2iJTi.registerEditorAction)($cabf138d6fc5db0d$export$83454a444c35f5c1);
(0, $TezJS.Registry).as((0, $7Oj2p.Extensions).Quickaccess).registerQuickAccessProvider({
    ctor: $cabf138d6fc5db0d$export$b53f517d2ef5810d,
    prefix: $cabf138d6fc5db0d$export$b53f517d2ef5810d.PREFIX,
    helpEntries: [
        {
            description: (0, $82TRE.QuickCommandNLS).quickCommandHelp,
            commandId: $cabf138d6fc5db0d$export$83454a444c35f5c1.ID
        }
    ]
});


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $2Qfl0 = parcelRequire("2Qfl0");


var $35IZ9 = parcelRequire("35IZ9");

var $cxCeF = parcelRequire("cxCeF");

var $fdGPu = parcelRequire("fdGPu");

var $kCOKl = parcelRequire("kCOKl");

var $2AUoS = parcelRequire("2AUoS");
var $f217809784e9ca11$var$__decorate = undefined && undefined.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for(var i = decorators.length - 1; i >= 0; i--)if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var $f217809784e9ca11$var$__param = undefined && undefined.__param || function(paramIndex, decorator) {
    return function(target, key) {
        decorator(target, key, paramIndex);
    };
};
let $f217809784e9ca11$export$79f48fa51423fd3f = class StandaloneReferencesController extends (0, $cbeaa13ed7da71f5$export$60e6f978b59c492d) {
    constructor(editor, contextKeyService, editorService, notificationService, instantiationService, storageService, configurationService){
        super(true, editor, contextKeyService, editorService, notificationService, instantiationService, storageService, configurationService);
    }
};
$f217809784e9ca11$export$79f48fa51423fd3f = $f217809784e9ca11$var$__decorate([
    $f217809784e9ca11$var$__param(1, (0, $cxCeF.IContextKeyService)),
    $f217809784e9ca11$var$__param(2, (0, $2Qfl0.ICodeEditorService)),
    $f217809784e9ca11$var$__param(3, (0, $kCOKl.INotificationService)),
    $f217809784e9ca11$var$__param(4, (0, $fdGPu.IInstantiationService)),
    $f217809784e9ca11$var$__param(5, (0, $2AUoS.IStorageService)),
    $f217809784e9ca11$var$__param(6, (0, $35IZ9.IConfigurationService))
], $f217809784e9ca11$export$79f48fa51423fd3f);
(0, $2iJTi.registerEditorContribution)((0, $cbeaa13ed7da71f5$export$60e6f978b59c492d).ID, $f217809784e9ca11$export$79f48fa51423fd3f, 4 /* EditorContributionInstantiation.Lazy */ );


/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/ 
var $2iJTi = parcelRequire("2iJTi");

var $hgpZb = parcelRequire("hgpZb");

var $82TRE = parcelRequire("82TRE");

var $95ky9 = parcelRequire("95ky9");

var $9u1jP = parcelRequire("9u1jP");
class $59fb0073f4c38650$var$ToggleHighContrast extends (0, $2iJTi.EditorAction) {
    constructor(){
        super({
            id: 'editor.action.toggleHighContrast',
            label: (0, $82TRE.ToggleHighContrastNLS).toggleHighContrast,
            alias: 'Toggle High Contrast Theme',
            precondition: undefined
        });
        this._originalThemeName = null;
    }
    run(accessor, editor) {
        const standaloneThemeService = accessor.get((0, $hgpZb.IStandaloneThemeService));
        const currentTheme = standaloneThemeService.getColorTheme();
        if ((0, $95ky9.isHighContrast)(currentTheme.type)) {
            // We must toggle back to the integrator's theme
            standaloneThemeService.setTheme(this._originalThemeName || ((0, $95ky9.isDark)(currentTheme.type) ? (0, $9u1jP.VS_DARK_THEME_NAME) : (0, $9u1jP.VS_LIGHT_THEME_NAME)));
            this._originalThemeName = null;
        } else {
            standaloneThemeService.setTheme((0, $95ky9.isDark)(currentTheme.type) ? (0, $9u1jP.HC_BLACK_THEME_NAME) : (0, $9u1jP.HC_LIGHT_THEME_NAME));
            this._originalThemeName = currentTheme.themeName;
        }
    }
}
(0, $2iJTi.registerEditorAction)($59fb0073f4c38650$var$ToggleHighContrast);


parcelRequire("leKFq");




var $leKFq = parcelRequire("leKFq");
/**
 * Observable class prototype.
 *
 * @module observable
 */ /**
 * Utility module to work with key-value stores.
 *
 * @module map
 */ /**
 * Creates a new Map instance.
 *
 * @function
 * @return {Map<any, any>}
 *
 * @function
 */ const $58ab1e30cc73aec7$export$185802fd694ee1f5 = ()=>new Map();
const $58ab1e30cc73aec7$export$784d13d8ee351f07 = (m)=>{
    const r = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    m.forEach((v, k)=>{
        r.set(k, v);
    });
    return r;
};
const $58ab1e30cc73aec7$export$dccd489362a8619 = (map, key, createT)=>{
    let set = map.get(key);
    if (set === undefined) map.set(key, set = createT());
    return set;
};
const $58ab1e30cc73aec7$export$871de8747c9eaa88 = (m, f)=>{
    const res = [];
    for (const [key, value] of m)res.push(f(value, key));
    return res;
};
const $58ab1e30cc73aec7$export$4154a199d7d90455 = (m, f)=>{
    for (const [key, value] of m){
        if (f(value, key)) return true;
    }
    return false;
};
const $58ab1e30cc73aec7$export$84bf76cd7afc7469 = (m, f)=>{
    for (const [key, value] of m){
        if (!f(value, key)) return false;
    }
    return true;
};


/**
 * Utility module to work with sets.
 *
 * @module set
 */ const $ace4f15b64ff1dc0$export$185802fd694ee1f5 = ()=>new Set();
const $ace4f15b64ff1dc0$export$45b10814cc054894 = (set)=>Array.from(set);
const $ace4f15b64ff1dc0$export$43128fadae87b74a = (set)=>set.values().next().value ?? undefined;
const $ace4f15b64ff1dc0$export$6788812c4e6611e6 = (entries)=>new Set(entries);


/**
 * Utility module to work with Arrays.
 *
 * @module array
 */ 
const $cfaabc628d0f476d$export$4c7897fafd92b108 = (arr)=>arr[arr.length - 1];
const $cfaabc628d0f476d$export$185802fd694ee1f5 = ()=>/** @type {Array<C>} */ [];
const $cfaabc628d0f476d$export$784d13d8ee351f07 = (a)=>/** @type {Array<D>} */ a.slice();
const $cfaabc628d0f476d$export$9ceefe31f12a3778 = (dest, src)=>{
    for(let i = 0; i < src.length; i++)dest.push(src[i]);
};
const $cfaabc628d0f476d$export$6788812c4e6611e6 = Array.from;
const $cfaabc628d0f476d$export$7ecc1a3b11b57dab = (arr, f)=>{
    for(let i = 0; i < arr.length; i++){
        if (!f(arr[i], i, arr)) return false;
    }
    return true;
};
const $cfaabc628d0f476d$export$ad14ef4001db2bcd = (arr, f)=>{
    for(let i = 0; i < arr.length; i++){
        if (f(arr[i], i, arr)) return true;
    }
    return false;
};
const $cfaabc628d0f476d$export$4f1c34abb2bb4c8 = (a, b)=>a.length === b.length && $cfaabc628d0f476d$export$7ecc1a3b11b57dab(a, (item, index)=>item === b[index]);
const $cfaabc628d0f476d$export$bffa455ba8c619a6 = (arr)=>$cfaabc628d0f476d$export$93e2b83da34ff82a(arr, /** @type {Array<ELEM>} */ [], (acc, val)=>acc.concat(val));
const $cfaabc628d0f476d$export$c48e357c1a89b78d = (len, f)=>{
    const array = new Array(len);
    for(let i = 0; i < len; i++)array[i] = f(i, array);
    return array;
};
const $cfaabc628d0f476d$export$93e2b83da34ff82a = (arr, seed, folder)=>arr.reduce(folder, seed);
const $cfaabc628d0f476d$export$43bee75e5e14138e = Array.isArray;
const $cfaabc628d0f476d$export$7a5d5c156e7dc406 = (arr)=>$cfaabc628d0f476d$export$6788812c4e6611e6($ace4f15b64ff1dc0$export$6788812c4e6611e6(arr));
const $cfaabc628d0f476d$export$abf0e2545164275f = (arr, mapper)=>{
    /**
   * @type {Set<M>}
   */ const happened = $ace4f15b64ff1dc0$export$185802fd694ee1f5();
    /**
   * @type {Array<T>}
   */ const result = [];
    for(let i = 0; i < arr.length; i++){
        const el = arr[i];
        const mapped = mapper(el);
        if (!happened.has(mapped)) {
            happened.add(mapped);
            result.push(el);
        }
    }
    return result;
};
const $cfaabc628d0f476d$export$871de8747c9eaa88 = (arr, mapper)=>{
    /**
   * @type {Array<any>}
   */ const res = Array(arr.length);
    for(let i = 0; i < arr.length; i++)res[i] = mapper(/** @type {any} */ arr[i], i, /** @type {any} */ arr);
    return /** @type {any} */ res;
};


class $015da90ca04a7f6c$export$e23d3436ce401adc {
    constructor(){
        /**
     * Some desc.
     * @type {Map<string, Set<any>>}
     */ this._observers = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    }
    /**
   * @template {keyof EVENTS & string} NAME
   * @param {NAME} name
   * @param {EVENTS[NAME]} f
   */ on(name, f) {
        $58ab1e30cc73aec7$export$dccd489362a8619(this._observers, /** @type {string} */ name, $ace4f15b64ff1dc0$export$185802fd694ee1f5).add(f);
        return f;
    }
    /**
   * @template {keyof EVENTS & string} NAME
   * @param {NAME} name
   * @param {EVENTS[NAME]} f
   */ once(name, f) {
        /**
     * @param  {...any} args
     */ const _f = (...args)=>{
            this.off(name, /** @type {any} */ _f);
            f(...args);
        };
        this.on(name, /** @type {any} */ _f);
    }
    /**
   * @template {keyof EVENTS & string} NAME
   * @param {NAME} name
   * @param {EVENTS[NAME]} f
   */ off(name, f) {
        const observers = this._observers.get(name);
        if (observers !== undefined) {
            observers.delete(f);
            if (observers.size === 0) this._observers.delete(name);
        }
    }
    /**
   * Emit a named event. All registered event listeners that listen to the
   * specified name will receive the event.
   *
   * @todo This should catch exceptions
   *
   * @template {keyof EVENTS & string} NAME
   * @param {NAME} name The event name.
   * @param {Parameters<EVENTS[NAME]>} args The arguments that are applied to the event listener.
   */ emit(name, args) {
        // copy all listeners to an array first to make sure that no event is emitted to listeners that are subscribed while the event handler is called.
        return $cfaabc628d0f476d$export$6788812c4e6611e6((this._observers.get(name) || $58ab1e30cc73aec7$export$185802fd694ee1f5()).values()).forEach((f)=>f(...args));
    }
    destroy() {
        this._observers = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    }
}
class $015da90ca04a7f6c$export$77cea355fa80b5f4 {
    constructor(){
        /**
     * Some desc.
     * @type {Map<N, any>}
     */ this._observers = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    }
    /**
   * @param {N} name
   * @param {function} f
   */ on(name, f) {
        $58ab1e30cc73aec7$export$dccd489362a8619(this._observers, name, $ace4f15b64ff1dc0$export$185802fd694ee1f5).add(f);
    }
    /**
   * @param {N} name
   * @param {function} f
   */ once(name, f) {
        /**
     * @param  {...any} args
     */ const _f = (...args)=>{
            this.off(name, _f);
            f(...args);
        };
        this.on(name, _f);
    }
    /**
   * @param {N} name
   * @param {function} f
   */ off(name, f) {
        const observers = this._observers.get(name);
        if (observers !== undefined) {
            observers.delete(f);
            if (observers.size === 0) this._observers.delete(name);
        }
    }
    /**
   * Emit a named event. All registered event listeners that listen to the
   * specified name will receive the event.
   *
   * @todo This should catch exceptions
   *
   * @param {N} name The event name.
   * @param {Array<any>} args The arguments that are applied to the event listener.
   */ emit(name, args) {
        // copy all listeners to an array first to make sure that no event is emitted to listeners that are subscribed while the event handler is called.
        return $cfaabc628d0f476d$export$6788812c4e6611e6((this._observers.get(name) || $58ab1e30cc73aec7$export$185802fd694ee1f5()).values()).forEach((f)=>f(...args));
    }
    destroy() {
        this._observers = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    }
} /* c8 ignore end */ 



/**
 * Common Math expressions.
 *
 * @module math
 */ const $674380a05f97f4f3$export$a3fe094919f356fd = Math.floor;
const $674380a05f97f4f3$export$803ce6b71a0a94b2 = Math.ceil;
const $674380a05f97f4f3$export$2335f513bbd82c6d = Math.abs;
const $674380a05f97f4f3$export$46de3d998ca9a030 = Math.imul;
const $674380a05f97f4f3$export$2077e0241d6afd3c = Math.round;
const $674380a05f97f4f3$export$75e08744a3ff8516 = Math.log10;
const $674380a05f97f4f3$export$b9fae0bba9d9094d = Math.log2;
const $674380a05f97f4f3$export$bef1f36f5486a6a3 = Math.log;
const $674380a05f97f4f3$export$eba8049fb5020b81 = Math.sqrt;
const $674380a05f97f4f3$export$e16d8520af44a096 = (a, b)=>a + b;
const $674380a05f97f4f3$export$96ec731ed4dcb222 = (a, b)=>a < b ? a : b;
const $674380a05f97f4f3$export$8960430cfd85939f = (a, b)=>a > b ? a : b;
const $674380a05f97f4f3$export$c9f5652083b8129d = Number.isNaN;
const $674380a05f97f4f3$export$9c297f60e22e3389 = Math.pow;
const $674380a05f97f4f3$export$1bb2a14208c790f7 = (exp)=>Math.pow(10, exp);
const $674380a05f97f4f3$export$c5552dfdbc7cec71 = Math.sign;
const $674380a05f97f4f3$export$dc0a61f4a9121f92 = (n)=>n !== 0 ? n < 0 : 1 / n < 0;



/**
 * Efficient schema-less binary encoding with support for variable length encoding.
 *
 * Use [lib0/encoding] with [lib0/decoding]. Every encoding function has a corresponding decoding function.
 *
 * Encodes numbers in little-endian order (least to most significant byte order)
 * and is compatible with Golang's binary encoding (https://golang.org/pkg/encoding/binary/)
 * which is also used in Protocol Buffers.
 *
 * ```js
 * // encoding step
 * const encoder = encoding.createEncoder()
 * encoding.writeVarUint(encoder, 256)
 * encoding.writeVarString(encoder, 'Hello world!')
 * const buf = encoding.toUint8Array(encoder)
 * ```
 *
 * ```js
 * // decoding step
 * const decoder = decoding.createDecoder(buf)
 * decoding.readVarUint(decoder) // => 256
 * decoding.readVarString(decoder) // => 'Hello world!'
 * decoding.hasContent(decoder) // => false - all data is read
 * ```
 *
 * @module encoding
 */ 
/**
 * Utility helpers for working with numbers.
 *
 * @module number
 */ 
/* eslint-env browser */ /**
 * Binary data constants.
 *
 * @module binary
 */ /**
 * n-th bit activated.
 *
 * @type {number}
 */ const $b27b7daa87337538$export$ee2c6657cb286da4 = 1;
const $b27b7daa87337538$export$1f117f3b0edc2676 = 2;
const $b27b7daa87337538$export$e5294f8c78cf7711 = 4;
const $b27b7daa87337538$export$873ae8db4cef5125 = 8;
const $b27b7daa87337538$export$b6e6496517dfbd31 = 16;
const $b27b7daa87337538$export$daf23f774967089 = 32;
const $b27b7daa87337538$export$eb5a8e0006ab4bb5 = 64;
const $b27b7daa87337538$export$e25597372303a045 = 128;
const $b27b7daa87337538$export$f15587807021fe79 = 256;
const $b27b7daa87337538$export$70939d57ba836c5 = 512;
const $b27b7daa87337538$export$9ec47920d80e8c85 = 1024;
const $b27b7daa87337538$export$bc5dd16b35d4584b = 2048;
const $b27b7daa87337538$export$76a85e893e6d6ecc = 4096;
const $b27b7daa87337538$export$fb6ca64a3ffa3aa9 = 8192;
const $b27b7daa87337538$export$e7adc86ee9ea4b00 = 16384;
const $b27b7daa87337538$export$6aa68b9346d558bb = 32768;
const $b27b7daa87337538$export$5d7aab37466c79ea = 65536;
const $b27b7daa87337538$export$3aa401309ff3940 = 131072;
const $b27b7daa87337538$export$1fd8467d3320465f = 262144;
const $b27b7daa87337538$export$d1dceb84a396f684 = 524288;
const $b27b7daa87337538$export$ef62e7729d79baec = 1048576;
const $b27b7daa87337538$export$40651ae3846a7710 = 2097152;
const $b27b7daa87337538$export$e03976987cb0b818 = 4194304;
const $b27b7daa87337538$export$dd5dceb22223d8ef = 8388608;
const $b27b7daa87337538$export$aecaefba6ae044e4 = 16777216;
const $b27b7daa87337538$export$6e47d6f6c411c0e1 = 33554432;
const $b27b7daa87337538$export$321a8fda0150a18 = 67108864;
const $b27b7daa87337538$export$d7843230fff08622 = 134217728;
const $b27b7daa87337538$export$9fe7219cb72d1ed8 = 268435456;
const $b27b7daa87337538$export$c85121a54e1cc97f = 536870912;
const $b27b7daa87337538$export$76075a64dc7c21ef = 1073741824;
const $b27b7daa87337538$export$49d5cdcf29800e09 = -2147483648;
const $b27b7daa87337538$export$853d99058378c102 = 0;
const $b27b7daa87337538$export$b859c32a415b3ec1 = 1;
const $b27b7daa87337538$export$decefe6957191373 = 3;
const $b27b7daa87337538$export$d1defff3cbd2c6f4 = 7;
const $b27b7daa87337538$export$8d2b432c8c02ae65 = 15;
const $b27b7daa87337538$export$bc2aba63e4099c09 = 31;
const $b27b7daa87337538$export$f39f4e074e983a34 = 63;
const $b27b7daa87337538$export$f84d6bebff154ceb = 127;
const $b27b7daa87337538$export$c880072ee0e87648 = 255;
const $b27b7daa87337538$export$cbbfa5d3c076ad8c = 511;
const $b27b7daa87337538$export$e365aa75b5fa7293 = 1023;
const $b27b7daa87337538$export$51bfc23c1b7b60c3 = 2047;
const $b27b7daa87337538$export$3b0a099b88523ac = 4095;
const $b27b7daa87337538$export$8345c1c06d3e5fc1 = 8191;
const $b27b7daa87337538$export$e20cffba663a7688 = 16383;
const $b27b7daa87337538$export$cd0970fd37b207c6 = 32767;
const $b27b7daa87337538$export$250487b182389b6a = 65535;
const $b27b7daa87337538$export$9d6e01d73abdaadb = $b27b7daa87337538$export$3aa401309ff3940 - 1;
const $b27b7daa87337538$export$eedeab0ac4009664 = $b27b7daa87337538$export$1fd8467d3320465f - 1;
const $b27b7daa87337538$export$e1840c3c33a76ffc = $b27b7daa87337538$export$d1dceb84a396f684 - 1;
const $b27b7daa87337538$export$f0ae3ba8312e92e3 = $b27b7daa87337538$export$ef62e7729d79baec - 1;
const $b27b7daa87337538$export$b5ffbef7f0f6f536 = $b27b7daa87337538$export$40651ae3846a7710 - 1;
const $b27b7daa87337538$export$33ae34bc8e747862 = $b27b7daa87337538$export$e03976987cb0b818 - 1;
const $b27b7daa87337538$export$3629272792e6a9a0 = $b27b7daa87337538$export$dd5dceb22223d8ef - 1;
const $b27b7daa87337538$export$a07300a4cc2ba23c = $b27b7daa87337538$export$aecaefba6ae044e4 - 1;
const $b27b7daa87337538$export$9137f2824b26e02b = $b27b7daa87337538$export$6e47d6f6c411c0e1 - 1;
const $b27b7daa87337538$export$94d4c3aa7cfbb8dd = $b27b7daa87337538$export$321a8fda0150a18 - 1;
const $b27b7daa87337538$export$8af89455097efce0 = $b27b7daa87337538$export$d7843230fff08622 - 1;
const $b27b7daa87337538$export$dee9196bb8567fe9 = $b27b7daa87337538$export$9fe7219cb72d1ed8 - 1;
const $b27b7daa87337538$export$bd0b5ef1d89e90f = $b27b7daa87337538$export$c85121a54e1cc97f - 1;
const $b27b7daa87337538$export$e5560e011efa8766 = $b27b7daa87337538$export$76075a64dc7c21ef - 1;
const $b27b7daa87337538$export$87ec42487f19c66c = 0x7FFFFFFF;
const $b27b7daa87337538$export$3ea07c5174cba08a = 0xFFFFFFFF;


const $963a0e68dce57aab$export$18510406f204a1b9 = Number.MAX_SAFE_INTEGER;
const $963a0e68dce57aab$export$91ddad910c1af487 = Number.MIN_SAFE_INTEGER;
const $963a0e68dce57aab$export$7accc3db8e859605 = -2147483648;
const $963a0e68dce57aab$export$a5f353c3c14c00d0 = $b27b7daa87337538$export$87ec42487f19c66c;
const $963a0e68dce57aab$export$f055c566d4c0f541 = $b27b7daa87337538$export$3ea07c5174cba08a;
const $963a0e68dce57aab$export$a287f47fed4544b8 = Number.isInteger || ((num)=>typeof num === 'number' && isFinite(num) && $674380a05f97f4f3$export$a3fe094919f356fd(num) === num);
const $963a0e68dce57aab$export$c9f5652083b8129d = Number.isNaN;
const $963a0e68dce57aab$export$5f87784a266e50a4 = Number.parseInt;
const $963a0e68dce57aab$export$33de6ea056a4cdbb = (n)=>{
    n &= $b27b7daa87337538$export$3ea07c5174cba08a;
    let count = 0;
    while(n){
        n &= n - 1;
        count++;
    }
    return count;
};




const $83a4db9bed1df563$export$30216c0101da0ee0 = String.fromCharCode;
const $83a4db9bed1df563$export$73bfc63873071f74 = String.fromCodePoint;
const $83a4db9bed1df563$export$e3a9a653b2a11ac1 = $83a4db9bed1df563$export$30216c0101da0ee0(65535);
/**
 * @param {string} s
 * @return {string}
 */ const $83a4db9bed1df563$var$toLowerCase = (s)=>s.toLowerCase();
const $83a4db9bed1df563$var$trimLeftRegex = /^\s*/g;
const $83a4db9bed1df563$export$c5557f40488c48ec = (s)=>s.replace($83a4db9bed1df563$var$trimLeftRegex, '');
const $83a4db9bed1df563$var$fromCamelCaseRegex = /([A-Z])/g;
const $83a4db9bed1df563$export$87429743646c3257 = (s, separator)=>$83a4db9bed1df563$export$c5557f40488c48ec(s.replace($83a4db9bed1df563$var$fromCamelCaseRegex, (match)=>`${separator}${$83a4db9bed1df563$var$toLowerCase(match)}`));
const $83a4db9bed1df563$export$ba35f6b806a3dbd4 = (str)=>unescape(encodeURIComponent(str)).length;
const $83a4db9bed1df563$export$83d8cea287b4dfcd = (str)=>{
    const encodedString = unescape(encodeURIComponent(str));
    const len = encodedString.length;
    const buf = new Uint8Array(len);
    for(let i = 0; i < len; i++)buf[i] = /** @type {number} */ encodedString.codePointAt(i);
    return buf;
};
const $83a4db9bed1df563$export$f3ce4806f2484eb = /** @type {TextEncoder} */ typeof TextEncoder !== 'undefined' ? new TextEncoder() : null;
const $83a4db9bed1df563$export$9a0a70804ee285dd = (str)=>$83a4db9bed1df563$export$f3ce4806f2484eb.encode(str);
const $83a4db9bed1df563$export$8f647c2204da8484 = $83a4db9bed1df563$export$f3ce4806f2484eb ? $83a4db9bed1df563$export$9a0a70804ee285dd : $83a4db9bed1df563$export$83d8cea287b4dfcd;
const $83a4db9bed1df563$export$154b750182ae32cf = (buf)=>{
    let remainingLen = buf.length;
    let encodedString = '';
    let bufPos = 0;
    while(remainingLen > 0){
        const nextLen = remainingLen < 10000 ? remainingLen : 10000;
        const bytes = buf.subarray(bufPos, bufPos + nextLen);
        bufPos += nextLen;
        // Starting with ES5.1 we can supply a generic array-like object as arguments
        encodedString += String.fromCodePoint.apply(null, /** @type {any} */ bytes);
        remainingLen -= nextLen;
    }
    return decodeURIComponent(escape(encodedString));
};
let $83a4db9bed1df563$export$f477633695bbbcd = typeof TextDecoder === 'undefined' ? null : new TextDecoder('utf-8', {
    fatal: true,
    ignoreBOM: true
});
/* c8 ignore start */ if ($83a4db9bed1df563$export$f477633695bbbcd && $83a4db9bed1df563$export$f477633695bbbcd.decode(new Uint8Array()).length === 1) // Safari doesn't handle BOM correctly.
// This fixes a bug in Safari 13.0.5 where it produces a BOM the first time it is called.
// utf8TextDecoder.decode(new Uint8Array()).length === 1 on the first call and
// utf8TextDecoder.decode(new Uint8Array()).length === 1 on the second call
// Another issue is that from then on no BOM chars are recognized anymore
/* c8 ignore next */ $83a4db9bed1df563$export$f477633695bbbcd = null;
const $83a4db9bed1df563$export$23d5f1ce72f56168 = (buf)=>/** @type {TextDecoder} */ $83a4db9bed1df563$export$f477633695bbbcd.decode(buf);
const $83a4db9bed1df563$export$72118b85b055afd = $83a4db9bed1df563$export$f477633695bbbcd ? $83a4db9bed1df563$export$23d5f1ce72f56168 : $83a4db9bed1df563$export$154b750182ae32cf;
const $83a4db9bed1df563$export$869882364835d202 = (str, index, remove, insert = '')=>str.slice(0, index) + insert + str.slice(index + remove);
const $83a4db9bed1df563$export$76d90c956114f2c2 = (source, n)=>$cfaabc628d0f476d$export$c48e357c1a89b78d(n, ()=>source).join('');



class $293cd0efd7645786$export$a50aceb0e02a00aa {
    constructor(){
        this.cpos = 0;
        this.cbuf = new Uint8Array(100);
        /**
     * @type {Array<Uint8Array>}
     */ this.bufs = [];
    }
}
const $293cd0efd7645786$export$4e76eeb6df88c889 = ()=>new $293cd0efd7645786$export$a50aceb0e02a00aa();
const $293cd0efd7645786$export$c564cdbbe6da493 = (f)=>{
    const encoder = $293cd0efd7645786$export$4e76eeb6df88c889();
    f(encoder);
    return $293cd0efd7645786$export$73470fd2221e6aef(encoder);
};
const $293cd0efd7645786$export$f24224f1c91d8156 = (encoder)=>{
    let len = encoder.cpos;
    for(let i = 0; i < encoder.bufs.length; i++)len += encoder.bufs[i].length;
    return len;
};
const $293cd0efd7645786$export$7ad75c69830b76d7 = (encoder)=>encoder.cpos > 0 || encoder.bufs.length > 0;
const $293cd0efd7645786$export$73470fd2221e6aef = (encoder)=>{
    const uint8arr = new Uint8Array($293cd0efd7645786$export$f24224f1c91d8156(encoder));
    let curPos = 0;
    for(let i = 0; i < encoder.bufs.length; i++){
        const d = encoder.bufs[i];
        uint8arr.set(d, curPos);
        curPos += d.length;
    }
    uint8arr.set(new Uint8Array(encoder.cbuf.buffer, 0, encoder.cpos), curPos);
    return uint8arr;
};
const $293cd0efd7645786$export$39fb588b9aff60c5 = (encoder, len)=>{
    const bufferLen = encoder.cbuf.length;
    if (bufferLen - encoder.cpos < len) {
        encoder.bufs.push(new Uint8Array(encoder.cbuf.buffer, 0, encoder.cpos));
        encoder.cbuf = new Uint8Array($674380a05f97f4f3$export$8960430cfd85939f(bufferLen, len) * 2);
        encoder.cpos = 0;
    }
};
const $293cd0efd7645786$export$68d8715fc104d294 = (encoder, num)=>{
    const bufferLen = encoder.cbuf.length;
    if (encoder.cpos === bufferLen) {
        encoder.bufs.push(encoder.cbuf);
        encoder.cbuf = new Uint8Array(bufferLen * 2);
        encoder.cpos = 0;
    }
    encoder.cbuf[encoder.cpos++] = num;
};
const $293cd0efd7645786$export$adaa4cf7ef1b65be = (encoder, pos, num)=>{
    let buffer = null;
    // iterate all buffers and adjust position
    for(let i = 0; i < encoder.bufs.length && buffer === null; i++){
        const b = encoder.bufs[i];
        if (pos < b.length) buffer = b // found buffer
        ;
        else pos -= b.length;
    }
    if (buffer === null) // use current buffer
    buffer = encoder.cbuf;
    buffer[pos] = num;
};
const $293cd0efd7645786$export$826a1a6619653272 = $293cd0efd7645786$export$68d8715fc104d294;
const $293cd0efd7645786$export$83964ea8501fbf8 = $293cd0efd7645786$export$adaa4cf7ef1b65be;
const $293cd0efd7645786$export$ba6b74b6f3145a00 = (encoder, num)=>{
    $293cd0efd7645786$export$68d8715fc104d294(encoder, num & $b27b7daa87337538$export$c880072ee0e87648);
    $293cd0efd7645786$export$68d8715fc104d294(encoder, num >>> 8 & $b27b7daa87337538$export$c880072ee0e87648);
};
const $293cd0efd7645786$export$f86e1edc3d839287 = (encoder, pos, num)=>{
    $293cd0efd7645786$export$adaa4cf7ef1b65be(encoder, pos, num & $b27b7daa87337538$export$c880072ee0e87648);
    $293cd0efd7645786$export$adaa4cf7ef1b65be(encoder, pos + 1, num >>> 8 & $b27b7daa87337538$export$c880072ee0e87648);
};
const $293cd0efd7645786$export$835343b0f7799f5b = (encoder, num)=>{
    for(let i = 0; i < 4; i++){
        $293cd0efd7645786$export$68d8715fc104d294(encoder, num & $b27b7daa87337538$export$c880072ee0e87648);
        num >>>= 8;
    }
};
const $293cd0efd7645786$export$efed0d8c16230d13 = (encoder, num)=>{
    for(let i = 3; i >= 0; i--)$293cd0efd7645786$export$68d8715fc104d294(encoder, num >>> 8 * i & $b27b7daa87337538$export$c880072ee0e87648);
};
const $293cd0efd7645786$export$5517b6394fc440fb = (encoder, pos, num)=>{
    for(let i = 0; i < 4; i++){
        $293cd0efd7645786$export$adaa4cf7ef1b65be(encoder, pos + i, num & $b27b7daa87337538$export$c880072ee0e87648);
        num >>>= 8;
    }
};
const $293cd0efd7645786$export$872f48c75febcd2b = (encoder, num)=>{
    while(num > $b27b7daa87337538$export$f84d6bebff154ceb){
        $293cd0efd7645786$export$68d8715fc104d294(encoder, $b27b7daa87337538$export$e25597372303a045 | $b27b7daa87337538$export$f84d6bebff154ceb & num);
        num = $674380a05f97f4f3$export$a3fe094919f356fd(num / 128) // shift >>> 7
        ;
    }
    $293cd0efd7645786$export$68d8715fc104d294(encoder, $b27b7daa87337538$export$f84d6bebff154ceb & num);
};
const $293cd0efd7645786$export$ff90f819e16cc9bb = (encoder, num)=>{
    const isNegative = $674380a05f97f4f3$export$dc0a61f4a9121f92(num);
    if (isNegative) num = -num;
    //             |- whether to continue reading         |- whether is negative     |- number
    $293cd0efd7645786$export$68d8715fc104d294(encoder, (num > $b27b7daa87337538$export$f39f4e074e983a34 ? $b27b7daa87337538$export$e25597372303a045 : 0) | (isNegative ? $b27b7daa87337538$export$eb5a8e0006ab4bb5 : 0) | $b27b7daa87337538$export$f39f4e074e983a34 & num);
    num = $674380a05f97f4f3$export$a3fe094919f356fd(num / 64) // shift >>> 6
    ;
    // We don't need to consider the case of num === 0 so we can use a different
    // pattern here than above.
    while(num > 0){
        $293cd0efd7645786$export$68d8715fc104d294(encoder, (num > $b27b7daa87337538$export$f84d6bebff154ceb ? $b27b7daa87337538$export$e25597372303a045 : 0) | $b27b7daa87337538$export$f84d6bebff154ceb & num);
        num = $674380a05f97f4f3$export$a3fe094919f356fd(num / 128) // shift >>> 7
        ;
    }
};
/**
 * A cache to store strings temporarily
 */ const $293cd0efd7645786$var$_strBuffer = new Uint8Array(30000);
const $293cd0efd7645786$var$_maxStrBSize = $293cd0efd7645786$var$_strBuffer.length / 3;
const $293cd0efd7645786$export$dff327976627e12b = (encoder, str)=>{
    if (str.length < $293cd0efd7645786$var$_maxStrBSize) {
        // We can encode the string into the existing buffer
        /* c8 ignore next */ const written = $83a4db9bed1df563$export$f3ce4806f2484eb.encodeInto(str, $293cd0efd7645786$var$_strBuffer).written || 0;
        $293cd0efd7645786$export$872f48c75febcd2b(encoder, written);
        for(let i = 0; i < written; i++)$293cd0efd7645786$export$68d8715fc104d294(encoder, $293cd0efd7645786$var$_strBuffer[i]);
    } else $293cd0efd7645786$export$f7d11515275e88a2(encoder, $83a4db9bed1df563$export$8f647c2204da8484(str));
};
const $293cd0efd7645786$export$94cf4193edfe959a = (encoder, str)=>{
    const encodedString = unescape(encodeURIComponent(str));
    const len = encodedString.length;
    $293cd0efd7645786$export$872f48c75febcd2b(encoder, len);
    for(let i = 0; i < len; i++)$293cd0efd7645786$export$68d8715fc104d294(encoder, /** @type {number} */ encodedString.codePointAt(i));
};
const $293cd0efd7645786$export$dde49cb52d5f1650 = $83a4db9bed1df563$export$f3ce4806f2484eb && /** @type {any} */ $83a4db9bed1df563$export$f3ce4806f2484eb.encodeInto ? $293cd0efd7645786$export$dff327976627e12b : $293cd0efd7645786$export$94cf4193edfe959a;
const $293cd0efd7645786$export$be5604ffb9fbbd0c = (encoder, str)=>$293cd0efd7645786$export$6c17d6eec4abdaa6(encoder, $83a4db9bed1df563$export$8f647c2204da8484(str));
const $293cd0efd7645786$export$6c17d6eec4abdaa6 = (encoder, buf)=>{
    for(let i = 0; i < buf.length; i++){
        const b = buf[i];
        if (b === 0 || b === 1) $293cd0efd7645786$export$68d8715fc104d294(encoder, 1);
        $293cd0efd7645786$export$68d8715fc104d294(encoder, buf[i]);
    }
    $293cd0efd7645786$export$68d8715fc104d294(encoder, 0);
};
const $293cd0efd7645786$export$c029b62321ea3da = (encoder, append)=>$293cd0efd7645786$export$73b5e63e27d2b4c7(encoder, $293cd0efd7645786$export$73470fd2221e6aef(append));
const $293cd0efd7645786$export$73b5e63e27d2b4c7 = (encoder, uint8Array)=>{
    const bufferLen = encoder.cbuf.length;
    const cpos = encoder.cpos;
    const leftCopyLen = $674380a05f97f4f3$export$96ec731ed4dcb222(bufferLen - cpos, uint8Array.length);
    const rightCopyLen = uint8Array.length - leftCopyLen;
    encoder.cbuf.set(uint8Array.subarray(0, leftCopyLen), cpos);
    encoder.cpos += leftCopyLen;
    if (rightCopyLen > 0) {
        // Still something to write, write right half..
        // Append new buffer
        encoder.bufs.push(encoder.cbuf);
        // must have at least size of remaining buffer
        encoder.cbuf = new Uint8Array($674380a05f97f4f3$export$8960430cfd85939f(bufferLen * 2, rightCopyLen));
        // copy array
        encoder.cbuf.set(uint8Array.subarray(leftCopyLen));
        encoder.cpos = rightCopyLen;
    }
};
const $293cd0efd7645786$export$f7d11515275e88a2 = (encoder, uint8Array)=>{
    $293cd0efd7645786$export$872f48c75febcd2b(encoder, uint8Array.byteLength);
    $293cd0efd7645786$export$73b5e63e27d2b4c7(encoder, uint8Array);
};
const $293cd0efd7645786$export$1f031ae9c71bd530 = (encoder, len)=>{
    $293cd0efd7645786$export$39fb588b9aff60c5(encoder, len);
    const dview = new DataView(encoder.cbuf.buffer, encoder.cpos, len);
    encoder.cpos += len;
    return dview;
};
const $293cd0efd7645786$export$a33455db0a9638a6 = (encoder, num)=>$293cd0efd7645786$export$1f031ae9c71bd530(encoder, 4).setFloat32(0, num, false);
const $293cd0efd7645786$export$231a04cea676c54c = (encoder, num)=>$293cd0efd7645786$export$1f031ae9c71bd530(encoder, 8).setFloat64(0, num, false);
const $293cd0efd7645786$export$4fbfa93dd6e14543 = (encoder, num)=>/** @type {any} */ $293cd0efd7645786$export$1f031ae9c71bd530(encoder, 8).setBigInt64(0, num, false);
const $293cd0efd7645786$export$663ca46034903888 = (encoder, num)=>/** @type {any} */ $293cd0efd7645786$export$1f031ae9c71bd530(encoder, 8).setBigUint64(0, num, false);
const $293cd0efd7645786$var$floatTestBed = new DataView(new ArrayBuffer(4));
/**
 * Check if a number can be encoded as a 32 bit float.
 *
 * @param {number} num
 * @return {boolean}
 */ const $293cd0efd7645786$var$isFloat32 = (num)=>{
    $293cd0efd7645786$var$floatTestBed.setFloat32(0, num);
    return $293cd0efd7645786$var$floatTestBed.getFloat32(0) === num;
};
const $293cd0efd7645786$export$264b1e8551468ea = (encoder, data)=>{
    switch(typeof data){
        case 'string':
            // TYPE 119: STRING
            $293cd0efd7645786$export$68d8715fc104d294(encoder, 119);
            $293cd0efd7645786$export$dde49cb52d5f1650(encoder, data);
            break;
        case 'number':
            if ($963a0e68dce57aab$export$a287f47fed4544b8(data) && $674380a05f97f4f3$export$2335f513bbd82c6d(data) <= $b27b7daa87337538$export$87ec42487f19c66c) {
                // TYPE 125: INTEGER
                $293cd0efd7645786$export$68d8715fc104d294(encoder, 125);
                $293cd0efd7645786$export$ff90f819e16cc9bb(encoder, data);
            } else if ($293cd0efd7645786$var$isFloat32(data)) {
                // TYPE 124: FLOAT32
                $293cd0efd7645786$export$68d8715fc104d294(encoder, 124);
                $293cd0efd7645786$export$a33455db0a9638a6(encoder, data);
            } else {
                // TYPE 123: FLOAT64
                $293cd0efd7645786$export$68d8715fc104d294(encoder, 123);
                $293cd0efd7645786$export$231a04cea676c54c(encoder, data);
            }
            break;
        case 'bigint':
            // TYPE 122: BigInt
            $293cd0efd7645786$export$68d8715fc104d294(encoder, 122);
            $293cd0efd7645786$export$4fbfa93dd6e14543(encoder, data);
            break;
        case 'object':
            if (data === null) // TYPE 126: null
            $293cd0efd7645786$export$68d8715fc104d294(encoder, 126);
            else if ($cfaabc628d0f476d$export$43bee75e5e14138e(data)) {
                // TYPE 117: Array
                $293cd0efd7645786$export$68d8715fc104d294(encoder, 117);
                $293cd0efd7645786$export$872f48c75febcd2b(encoder, data.length);
                for(let i = 0; i < data.length; i++)$293cd0efd7645786$export$264b1e8551468ea(encoder, data[i]);
            } else if (data instanceof Uint8Array) {
                // TYPE 116: ArrayBuffer
                $293cd0efd7645786$export$68d8715fc104d294(encoder, 116);
                $293cd0efd7645786$export$f7d11515275e88a2(encoder, data);
            } else {
                // TYPE 118: Object
                $293cd0efd7645786$export$68d8715fc104d294(encoder, 118);
                const keys = Object.keys(data);
                $293cd0efd7645786$export$872f48c75febcd2b(encoder, keys.length);
                for(let i = 0; i < keys.length; i++){
                    const key = keys[i];
                    $293cd0efd7645786$export$dde49cb52d5f1650(encoder, key);
                    $293cd0efd7645786$export$264b1e8551468ea(encoder, data[key]);
                }
            }
            break;
        case 'boolean':
            // TYPE 120/121: boolean (true/false)
            $293cd0efd7645786$export$68d8715fc104d294(encoder, data ? 120 : 121);
            break;
        default:
            // TYPE 127: undefined
            $293cd0efd7645786$export$68d8715fc104d294(encoder, 127);
    }
};
class $293cd0efd7645786$export$8fa72bb4fa9409ff extends $293cd0efd7645786$export$a50aceb0e02a00aa {
    /**
   * @param {function(Encoder, T):void} writer
   */ constructor(writer){
        super();
        /**
     * The writer
     */ this.w = writer;
        /**
     * Current state
     * @type {T|null}
     */ this.s = null;
        this.count = 0;
    }
    /**
   * @param {T} v
   */ write(v) {
        if (this.s === v) this.count++;
        else {
            if (this.count > 0) // flush counter, unless this is the first value (count = 0)
            $293cd0efd7645786$export$872f48c75febcd2b(this, this.count - 1) // since count is always > 0, we can decrement by one. non-standard encoding ftw
            ;
            this.count = 1;
            // write first value
            this.w(this, v);
            this.s = v;
        }
    }
}
class $293cd0efd7645786$export$c636f3fa46f2752c extends $293cd0efd7645786$export$a50aceb0e02a00aa {
    /**
   * @param {number} start
   */ constructor(start){
        super();
        /**
     * Current state
     * @type {number}
     */ this.s = start;
    }
    /**
   * @param {number} v
   */ write(v) {
        $293cd0efd7645786$export$ff90f819e16cc9bb(this, v - this.s);
        this.s = v;
    }
}
class $293cd0efd7645786$export$29917ece4cb403fb extends $293cd0efd7645786$export$a50aceb0e02a00aa {
    /**
   * @param {number} start
   */ constructor(start){
        super();
        /**
     * Current state
     * @type {number}
     */ this.s = start;
        this.count = 0;
    }
    /**
   * @param {number} v
   */ write(v) {
        if (this.s === v && this.count > 0) this.count++;
        else {
            if (this.count > 0) // flush counter, unless this is the first value (count = 0)
            $293cd0efd7645786$export$872f48c75febcd2b(this, this.count - 1) // since count is always > 0, we can decrement by one. non-standard encoding ftw
            ;
            this.count = 1;
            // write first value
            $293cd0efd7645786$export$ff90f819e16cc9bb(this, v - this.s);
            this.s = v;
        }
    }
}
/**
 * @param {UintOptRleEncoder} encoder
 */ const $293cd0efd7645786$var$flushUintOptRleEncoder = (encoder)=>{
    if (encoder.count > 0) {
        // flush counter, unless this is the first value (count = 0)
        // case 1: just a single value. set sign to positive
        // case 2: write several values. set sign to negative to indicate that there is a length coming
        $293cd0efd7645786$export$ff90f819e16cc9bb(encoder.encoder, encoder.count === 1 ? encoder.s : -encoder.s);
        if (encoder.count > 1) $293cd0efd7645786$export$872f48c75febcd2b(encoder.encoder, encoder.count - 2) // since count is always > 1, we can decrement by one. non-standard encoding ftw
        ;
    }
};
class $293cd0efd7645786$export$785ebd3312c38061 {
    constructor(){
        this.encoder = new $293cd0efd7645786$export$a50aceb0e02a00aa();
        /**
     * @type {number}
     */ this.s = 0;
        this.count = 0;
    }
    /**
   * @param {number} v
   */ write(v) {
        if (this.s === v) this.count++;
        else {
            $293cd0efd7645786$var$flushUintOptRleEncoder(this);
            this.count = 1;
            this.s = v;
        }
    }
    /**
   * Flush the encoded state and transform this to a Uint8Array.
   *
   * Note that this should only be called once.
   */ toUint8Array() {
        $293cd0efd7645786$var$flushUintOptRleEncoder(this);
        return $293cd0efd7645786$export$73470fd2221e6aef(this.encoder);
    }
}
class $293cd0efd7645786$export$f460a01fb0702193 {
    constructor(){
        this.encoder = new $293cd0efd7645786$export$a50aceb0e02a00aa();
        /**
     * @type {number}
     */ this.s = 0;
        this.count = 0;
    }
    /**
   * @param {number} v
   */ write(v) {
        if (this.s + this.count === v) this.count++;
        else {
            $293cd0efd7645786$var$flushUintOptRleEncoder(this);
            this.count = 1;
            this.s = v;
        }
    }
    /**
   * Flush the encoded state and transform this to a Uint8Array.
   *
   * Note that this should only be called once.
   */ toUint8Array() {
        $293cd0efd7645786$var$flushUintOptRleEncoder(this);
        return $293cd0efd7645786$export$73470fd2221e6aef(this.encoder);
    }
}
/**
 * @param {IntDiffOptRleEncoder} encoder
 */ const $293cd0efd7645786$var$flushIntDiffOptRleEncoder = (encoder)=>{
    if (encoder.count > 0) {
        //          31 bit making up the diff | wether to write the counter
        // const encodedDiff = encoder.diff << 1 | (encoder.count === 1 ? 0 : 1)
        const encodedDiff = encoder.diff * 2 + (encoder.count === 1 ? 0 : 1);
        // flush counter, unless this is the first value (count = 0)
        // case 1: just a single value. set first bit to positive
        // case 2: write several values. set first bit to negative to indicate that there is a length coming
        $293cd0efd7645786$export$ff90f819e16cc9bb(encoder.encoder, encodedDiff);
        if (encoder.count > 1) $293cd0efd7645786$export$872f48c75febcd2b(encoder.encoder, encoder.count - 2) // since count is always > 1, we can decrement by one. non-standard encoding ftw
        ;
    }
};
class $293cd0efd7645786$export$7542c66a59375c6f {
    constructor(){
        this.encoder = new $293cd0efd7645786$export$a50aceb0e02a00aa();
        /**
     * @type {number}
     */ this.s = 0;
        this.count = 0;
        this.diff = 0;
    }
    /**
   * @param {number} v
   */ write(v) {
        if (this.diff === v - this.s) {
            this.s = v;
            this.count++;
        } else {
            $293cd0efd7645786$var$flushIntDiffOptRleEncoder(this);
            this.count = 1;
            this.diff = v - this.s;
            this.s = v;
        }
    }
    /**
   * Flush the encoded state and transform this to a Uint8Array.
   *
   * Note that this should only be called once.
   */ toUint8Array() {
        $293cd0efd7645786$var$flushIntDiffOptRleEncoder(this);
        return $293cd0efd7645786$export$73470fd2221e6aef(this.encoder);
    }
}
class $293cd0efd7645786$export$7dcdc5c32f31c550 {
    constructor(){
        /**
     * @type {Array<string>}
     */ this.sarr = [];
        this.s = '';
        this.lensE = new $293cd0efd7645786$export$785ebd3312c38061();
    }
    /**
   * @param {string} string
   */ write(string) {
        this.s += string;
        if (this.s.length > 19) {
            this.sarr.push(this.s);
            this.s = '';
        }
        this.lensE.write(string.length);
    }
    toUint8Array() {
        const encoder = new $293cd0efd7645786$export$a50aceb0e02a00aa();
        this.sarr.push(this.s);
        this.s = '';
        $293cd0efd7645786$export$dde49cb52d5f1650(encoder, this.sarr.join(''));
        $293cd0efd7645786$export$73b5e63e27d2b4c7(encoder, this.lensE.toUint8Array());
        return $293cd0efd7645786$export$73470fd2221e6aef(encoder);
    }
}


/**
 * Efficient schema-less binary decoding with support for variable length encoding.
 *
 * Use [lib0/decoding] with [lib0/encoding]. Every encoding function has a corresponding decoding function.
 *
 * Encodes numbers in little-endian order (least to most significant byte order)
 * and is compatible with Golang's binary encoding (https://golang.org/pkg/encoding/binary/)
 * which is also used in Protocol Buffers.
 *
 * ```js
 * // encoding step
 * const encoder = encoding.createEncoder()
 * encoding.writeVarUint(encoder, 256)
 * encoding.writeVarString(encoder, 'Hello world!')
 * const buf = encoding.toUint8Array(encoder)
 * ```
 *
 * ```js
 * // decoding step
 * const decoder = decoding.createDecoder(buf)
 * decoding.readVarUint(decoder) // => 256
 * decoding.readVarString(decoder) // => 'Hello world!'
 * decoding.hasContent(decoder) // => false - all data is read
 * ```
 *
 * @module decoding
 */ 



/**
 * Error helpers.
 *
 * @module error
 */ /**
 * @param {string} s
 * @return {Error}
 */ /* c8 ignore next */ const $20dad2a1f8b7bbe7$export$185802fd694ee1f5 = (s)=>new Error(s);
const $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f = ()=>{
    throw $20dad2a1f8b7bbe7$export$185802fd694ee1f5('Method unimplemented');
};
const $20dad2a1f8b7bbe7$export$965b6bccecbd9673 = ()=>{
    throw $20dad2a1f8b7bbe7$export$185802fd694ee1f5('Unexpected case');
};



const $e15498288f7f96ea$var$errorUnexpectedEndOfArray = $20dad2a1f8b7bbe7$export$185802fd694ee1f5('Unexpected end of array');
const $e15498288f7f96ea$var$errorIntegerOutOfRange = $20dad2a1f8b7bbe7$export$185802fd694ee1f5('Integer out of Range');
class $e15498288f7f96ea$export$f9de6ca0bc043724 {
    /**
   * @param {Uint8Array} uint8Array Binary data to decode
   */ constructor(uint8Array){
        /**
     * Decoding target.
     *
     * @type {Uint8Array}
     */ this.arr = uint8Array;
        /**
     * Current decoding position.
     *
     * @type {number}
     */ this.pos = 0;
    }
}
const $e15498288f7f96ea$export$f8c898e83b60faaa = (uint8Array)=>new $e15498288f7f96ea$export$f9de6ca0bc043724(uint8Array);
const $e15498288f7f96ea$export$7ad75c69830b76d7 = (decoder)=>decoder.pos !== decoder.arr.length;
const $e15498288f7f96ea$export$9cd59f9826255e47 = (decoder, newPos = decoder.pos)=>{
    const _decoder = $e15498288f7f96ea$export$f8c898e83b60faaa(decoder.arr);
    _decoder.pos = newPos;
    return _decoder;
};
const $e15498288f7f96ea$export$e21b2fe168d56a89 = (decoder, len)=>{
    const view = new Uint8Array(decoder.arr.buffer, decoder.pos + decoder.arr.byteOffset, len);
    decoder.pos += len;
    return view;
};
const $e15498288f7f96ea$export$7418bbc18dee40f3 = (decoder)=>$e15498288f7f96ea$export$e21b2fe168d56a89(decoder, $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder));
const $e15498288f7f96ea$export$8c9f57cb3e3e2d3b = (decoder)=>$e15498288f7f96ea$export$e21b2fe168d56a89(decoder, decoder.arr.length - decoder.pos);
const $e15498288f7f96ea$export$228a9507fbdfcdb6 = (decoder)=>decoder.pos++;
const $e15498288f7f96ea$export$d5778a2beba4ceef = (decoder)=>decoder.arr[decoder.pos++];
const $e15498288f7f96ea$export$ef14636f4cf20706 = (decoder)=>{
    const uint = decoder.arr[decoder.pos] + (decoder.arr[decoder.pos + 1] << 8);
    decoder.pos += 2;
    return uint;
};
const $e15498288f7f96ea$export$967c96218130b9ba = (decoder)=>{
    const uint = decoder.arr[decoder.pos] + (decoder.arr[decoder.pos + 1] << 8) + (decoder.arr[decoder.pos + 2] << 16) + (decoder.arr[decoder.pos + 3] << 24) >>> 0;
    decoder.pos += 4;
    return uint;
};
const $e15498288f7f96ea$export$adb88b5d4ab91f4e = (decoder)=>{
    const uint = decoder.arr[decoder.pos + 3] + (decoder.arr[decoder.pos + 2] << 8) + (decoder.arr[decoder.pos + 1] << 16) + (decoder.arr[decoder.pos] << 24) >>> 0;
    decoder.pos += 4;
    return uint;
};
const $e15498288f7f96ea$export$c6eca102d0b41ca0 = (decoder)=>decoder.arr[decoder.pos];
const $e15498288f7f96ea$export$e5eb1e52afa13f8d = (decoder)=>decoder.arr[decoder.pos] + (decoder.arr[decoder.pos + 1] << 8);
const $e15498288f7f96ea$export$67e54e775d28f9ae = (decoder)=>decoder.arr[decoder.pos] + (decoder.arr[decoder.pos + 1] << 8) + (decoder.arr[decoder.pos + 2] << 16) + (decoder.arr[decoder.pos + 3] << 24) >>> 0;
const $e15498288f7f96ea$export$5a476e4dbe7923d5 = (decoder)=>{
    let num = 0;
    let mult = 1;
    const len = decoder.arr.length;
    while(decoder.pos < len){
        const r = decoder.arr[decoder.pos++];
        // num = num | ((r & binary.BITS7) << len)
        num = num + (r & $b27b7daa87337538$export$f84d6bebff154ceb) * mult // shift $r << (7*#iterations) and add it to num
        ;
        mult *= 128 // next iteration, shift 7 "more" to the left
        ;
        if (r < $b27b7daa87337538$export$e25597372303a045) return num;
        /* c8 ignore start */ if (num > $963a0e68dce57aab$export$18510406f204a1b9) throw $e15498288f7f96ea$var$errorIntegerOutOfRange;
    /* c8 ignore stop */ }
    throw $e15498288f7f96ea$var$errorUnexpectedEndOfArray;
};
const $e15498288f7f96ea$export$1dd5b9ddf6575ae8 = (decoder)=>{
    let r = decoder.arr[decoder.pos++];
    let num = r & $b27b7daa87337538$export$f39f4e074e983a34;
    let mult = 64;
    const sign = (r & $b27b7daa87337538$export$eb5a8e0006ab4bb5) > 0 ? -1 : 1;
    if ((r & $b27b7daa87337538$export$e25597372303a045) === 0) // don't continue reading
    return sign * num;
    const len = decoder.arr.length;
    while(decoder.pos < len){
        r = decoder.arr[decoder.pos++];
        // num = num | ((r & binary.BITS7) << len)
        num = num + (r & $b27b7daa87337538$export$f84d6bebff154ceb) * mult;
        mult *= 128;
        if (r < $b27b7daa87337538$export$e25597372303a045) return sign * num;
        /* c8 ignore start */ if (num > $963a0e68dce57aab$export$18510406f204a1b9) throw $e15498288f7f96ea$var$errorIntegerOutOfRange;
    /* c8 ignore stop */ }
    throw $e15498288f7f96ea$var$errorUnexpectedEndOfArray;
};
const $e15498288f7f96ea$export$dc86e1eb544aa5ab = (decoder)=>{
    const pos = decoder.pos;
    const s = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
    decoder.pos = pos;
    return s;
};
const $e15498288f7f96ea$export$47c43df02cd47fca = (decoder)=>{
    const pos = decoder.pos;
    const s = $e15498288f7f96ea$export$1dd5b9ddf6575ae8(decoder);
    decoder.pos = pos;
    return s;
};
const $e15498288f7f96ea$export$e73299e6158668bb = (decoder)=>{
    let remainingLen = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
    if (remainingLen === 0) return '';
    else {
        let encodedString = String.fromCodePoint($e15498288f7f96ea$export$d5778a2beba4ceef(decoder)) // remember to decrease remainingLen
        ;
        if (--remainingLen < 100) while(remainingLen--)encodedString += String.fromCodePoint($e15498288f7f96ea$export$d5778a2beba4ceef(decoder));
        else while(remainingLen > 0){
            const nextLen = remainingLen < 10000 ? remainingLen : 10000;
            // this is dangerous, we create a fresh array view from the existing buffer
            const bytes = decoder.arr.subarray(decoder.pos, decoder.pos + nextLen);
            decoder.pos += nextLen;
            // Starting with ES5.1 we can supply a generic array-like object as arguments
            encodedString += String.fromCodePoint.apply(null, /** @type {any} */ bytes);
            remainingLen -= nextLen;
        }
        return decodeURIComponent(escape(encodedString));
    }
};
const $e15498288f7f96ea$export$7247eefae50fb91a = (decoder)=>/** @type any */ $83a4db9bed1df563$export$f477633695bbbcd.decode($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
const $e15498288f7f96ea$export$3b64b4d753b81ec2 = $83a4db9bed1df563$export$f477633695bbbcd ? $e15498288f7f96ea$export$7247eefae50fb91a : $e15498288f7f96ea$export$e73299e6158668bb;
const $e15498288f7f96ea$export$23764cfecad9ae2f = (decoder)=>{
    const encoder = $293cd0efd7645786$export$4e76eeb6df88c889();
    let b;
    while(true){
        b = $e15498288f7f96ea$export$d5778a2beba4ceef(decoder);
        if (b === 0) return $293cd0efd7645786$export$73470fd2221e6aef(encoder);
        if (b === 1) b = $e15498288f7f96ea$export$d5778a2beba4ceef(decoder);
        $293cd0efd7645786$export$68d8715fc104d294(encoder, b);
    }
};
const $e15498288f7f96ea$export$d38ec182b293d566 = (decoder)=>$83a4db9bed1df563$export$72118b85b055afd($e15498288f7f96ea$export$23764cfecad9ae2f(decoder));
const $e15498288f7f96ea$export$91c1f3f0dd9bd2f5 = (decoder)=>{
    const pos = decoder.pos;
    const s = $e15498288f7f96ea$export$3b64b4d753b81ec2(decoder);
    decoder.pos = pos;
    return s;
};
const $e15498288f7f96ea$export$d7dd05f632129fe5 = (decoder, len)=>{
    const dv = new DataView(decoder.arr.buffer, decoder.arr.byteOffset + decoder.pos, len);
    decoder.pos += len;
    return dv;
};
const $e15498288f7f96ea$export$dbc4aa781d9afe3b = (decoder)=>$e15498288f7f96ea$export$d7dd05f632129fe5(decoder, 4).getFloat32(0, false);
const $e15498288f7f96ea$export$d89a471990a89a7f = (decoder)=>$e15498288f7f96ea$export$d7dd05f632129fe5(decoder, 8).getFloat64(0, false);
const $e15498288f7f96ea$export$99e633bd4f295d85 = (decoder)=>/** @type {any} */ $e15498288f7f96ea$export$d7dd05f632129fe5(decoder, 8).getBigInt64(0, false);
const $e15498288f7f96ea$export$21575c47d1f9b652 = (decoder)=>/** @type {any} */ $e15498288f7f96ea$export$d7dd05f632129fe5(decoder, 8).getBigUint64(0, false);
/**
 * @type {Array<function(Decoder):any>}
 */ const $e15498288f7f96ea$var$readAnyLookupTable = [
    (decoder)=>undefined,
    (decoder)=>null,
    $e15498288f7f96ea$export$1dd5b9ddf6575ae8,
    $e15498288f7f96ea$export$dbc4aa781d9afe3b,
    $e15498288f7f96ea$export$d89a471990a89a7f,
    $e15498288f7f96ea$export$99e633bd4f295d85,
    (decoder)=>false,
    (decoder)=>true,
    $e15498288f7f96ea$export$3b64b4d753b81ec2,
    (decoder)=>{
        const len = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
        /**
     * @type {Object<string,any>}
     */ const obj = {};
        for(let i = 0; i < len; i++){
            const key = $e15498288f7f96ea$export$3b64b4d753b81ec2(decoder);
            obj[key] = $e15498288f7f96ea$export$82863139061f472f(decoder);
        }
        return obj;
    },
    (decoder)=>{
        const len = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
        const arr = [];
        for(let i = 0; i < len; i++)arr.push($e15498288f7f96ea$export$82863139061f472f(decoder));
        return arr;
    },
    $e15498288f7f96ea$export$7418bbc18dee40f3 // CASE 116: Uint8Array
];
const $e15498288f7f96ea$export$82863139061f472f = (decoder)=>$e15498288f7f96ea$var$readAnyLookupTable[127 - $e15498288f7f96ea$export$d5778a2beba4ceef(decoder)](decoder);
class $e15498288f7f96ea$export$f1f1200492b832af extends $e15498288f7f96ea$export$f9de6ca0bc043724 {
    /**
   * @param {Uint8Array} uint8Array
   * @param {function(Decoder):T} reader
   */ constructor(uint8Array, reader){
        super(uint8Array);
        /**
     * The reader
     */ this.reader = reader;
        /**
     * Current state
     * @type {T|null}
     */ this.s = null;
        this.count = 0;
    }
    read() {
        if (this.count === 0) {
            this.s = this.reader(this);
            if ($e15498288f7f96ea$export$7ad75c69830b76d7(this)) this.count = $e15498288f7f96ea$export$5a476e4dbe7923d5(this) + 1 // see encoder implementation for the reason why this is incremented
            ;
            else this.count = -1 // read the current value forever
            ;
        }
        this.count--;
        return /** @type {T} */ this.s;
    }
}
class $e15498288f7f96ea$export$938378143fffe1b4 extends $e15498288f7f96ea$export$f9de6ca0bc043724 {
    /**
   * @param {Uint8Array} uint8Array
   * @param {number} start
   */ constructor(uint8Array, start){
        super(uint8Array);
        /**
     * Current state
     * @type {number}
     */ this.s = start;
    }
    /**
   * @return {number}
   */ read() {
        this.s += $e15498288f7f96ea$export$1dd5b9ddf6575ae8(this);
        return this.s;
    }
}
class $e15498288f7f96ea$export$595b36f1b42934c6 extends $e15498288f7f96ea$export$f9de6ca0bc043724 {
    /**
   * @param {Uint8Array} uint8Array
   * @param {number} start
   */ constructor(uint8Array, start){
        super(uint8Array);
        /**
     * Current state
     * @type {number}
     */ this.s = start;
        this.count = 0;
    }
    /**
   * @return {number}
   */ read() {
        if (this.count === 0) {
            this.s += $e15498288f7f96ea$export$1dd5b9ddf6575ae8(this);
            if ($e15498288f7f96ea$export$7ad75c69830b76d7(this)) this.count = $e15498288f7f96ea$export$5a476e4dbe7923d5(this) + 1 // see encoder implementation for the reason why this is incremented
            ;
            else this.count = -1 // read the current value forever
            ;
        }
        this.count--;
        return /** @type {number} */ this.s;
    }
}
class $e15498288f7f96ea$export$2dc62fb2f864b82e extends $e15498288f7f96ea$export$f9de6ca0bc043724 {
    /**
   * @param {Uint8Array} uint8Array
   */ constructor(uint8Array){
        super(uint8Array);
        /**
     * @type {number}
     */ this.s = 0;
        this.count = 0;
    }
    read() {
        if (this.count === 0) {
            this.s = $e15498288f7f96ea$export$1dd5b9ddf6575ae8(this);
            // if the sign is negative, we read the count too, otherwise count is 1
            const isNegative = $674380a05f97f4f3$export$dc0a61f4a9121f92(this.s);
            this.count = 1;
            if (isNegative) {
                this.s = -this.s;
                this.count = $e15498288f7f96ea$export$5a476e4dbe7923d5(this) + 2;
            }
        }
        this.count--;
        return /** @type {number} */ this.s;
    }
}
class $e15498288f7f96ea$export$727389af14dfe417 extends $e15498288f7f96ea$export$f9de6ca0bc043724 {
    /**
   * @param {Uint8Array} uint8Array
   */ constructor(uint8Array){
        super(uint8Array);
        /**
     * @type {number}
     */ this.s = 0;
        this.count = 0;
    }
    read() {
        if (this.count === 0) {
            this.s = $e15498288f7f96ea$export$1dd5b9ddf6575ae8(this);
            // if the sign is negative, we read the count too, otherwise count is 1
            const isNegative = $674380a05f97f4f3$export$dc0a61f4a9121f92(this.s);
            this.count = 1;
            if (isNegative) {
                this.s = -this.s;
                this.count = $e15498288f7f96ea$export$5a476e4dbe7923d5(this) + 2;
            }
        }
        this.count--;
        return /** @type {number} */ this.s++;
    }
}
class $e15498288f7f96ea$export$d502ab0bf048a596 extends $e15498288f7f96ea$export$f9de6ca0bc043724 {
    /**
   * @param {Uint8Array} uint8Array
   */ constructor(uint8Array){
        super(uint8Array);
        /**
     * @type {number}
     */ this.s = 0;
        this.count = 0;
        this.diff = 0;
    }
    /**
   * @return {number}
   */ read() {
        if (this.count === 0) {
            const diff = $e15498288f7f96ea$export$1dd5b9ddf6575ae8(this);
            // if the first bit is set, we read more data
            const hasCount = diff & 1;
            this.diff = $674380a05f97f4f3$export$a3fe094919f356fd(diff / 2) // shift >> 1
            ;
            this.count = 1;
            if (hasCount) this.count = $e15498288f7f96ea$export$5a476e4dbe7923d5(this) + 2;
        }
        this.s += this.diff;
        this.count--;
        return this.s;
    }
}
class $e15498288f7f96ea$export$63a7aa211a91ed69 {
    /**
   * @param {Uint8Array} uint8Array
   */ constructor(uint8Array){
        this.decoder = new $e15498288f7f96ea$export$2dc62fb2f864b82e(uint8Array);
        this.str = $e15498288f7f96ea$export$3b64b4d753b81ec2(this.decoder);
        /**
     * @type {number}
     */ this.spos = 0;
    }
    /**
   * @return {string}
   */ read() {
        const end = this.spos + this.decoder.read();
        const res = this.str.slice(this.spos, end);
        this.spos = end;
        return res;
    }
}


/**
 * Isomorphic module for true random numbers / buffers / uuids.
 *
 * Attention: falls back to Math.random if the browser does not support crypto.
 *
 * @module random
 */ 

/* eslint-env browser */ const $7870a5d2fb378964$export$f45422fd2e8042d4 = crypto.subtle;
const $7870a5d2fb378964$export$960b9ff25e7d4257 = crypto.getRandomValues.bind(crypto);


const $78e269f32c0d8b71$export$bb0a9c36cf454ea0 = Math.random;
const $78e269f32c0d8b71$export$de9ffb9418dd7d0d = ()=>(0, $7870a5d2fb378964$export$960b9ff25e7d4257)(new Uint32Array(1))[0];
const $78e269f32c0d8b71$export$6bf94e3d82617e4e = ()=>{
    const arr = (0, $7870a5d2fb378964$export$960b9ff25e7d4257)(new Uint32Array(8));
    return (arr[0] & $b27b7daa87337538$export$b5ffbef7f0f6f536) * ($b27b7daa87337538$export$3ea07c5174cba08a + 1) + (arr[1] >>> 0);
};
const $78e269f32c0d8b71$export$a9a18ae5ba42aeab = (arr)=>arr[$674380a05f97f4f3$export$a3fe094919f356fd($78e269f32c0d8b71$export$bb0a9c36cf454ea0() * arr.length)];
// @ts-ignore
const $78e269f32c0d8b71$var$uuidv4Template = "10000000-1000-4000-8000-100000000000";
const $78e269f32c0d8b71$export$abe4376e1bf796d6 = ()=>$78e269f32c0d8b71$var$uuidv4Template.replace(/[018]/g, /** @param {number} c */ (c)=>(c ^ $78e269f32c0d8b71$export$de9ffb9418dd7d0d() & 15 >> c / 4).toString(16));


/**
 * Utility helpers to work with promises.
 *
 * @module promise
 */ /**
 * Utility module to work with time.
 *
 * @module time
 */ /**
 * Utility module to convert metric values.
 *
 * @module metric
 */ 
const $5b43ca2ee686079d$export$3c3f39195836e927 = 1e24;
const $5b43ca2ee686079d$export$bc1fc8bc8e1895cf = 1e21;
const $5b43ca2ee686079d$export$91377b751fc464a0 = 1e18;
const $5b43ca2ee686079d$export$fc10d2598c9417a5 = 1e15;
const $5b43ca2ee686079d$export$ce366dc9d5abf7ac = 1e12;
const $5b43ca2ee686079d$export$197e40aa3a484017 = 1e9;
const $5b43ca2ee686079d$export$580f1e8cf64f2815 = 1e6;
const $5b43ca2ee686079d$export$a3ed9693cfbf67fa = 1e3;
const $5b43ca2ee686079d$export$6ec17edd70114a88 = 1e2;
const $5b43ca2ee686079d$export$6ffbaf3528ca9f3f = 10;
const $5b43ca2ee686079d$export$ec5800edbd9f0b69 = 0.1;
const $5b43ca2ee686079d$export$9faf718fe58aaa35 = 0.01;
const $5b43ca2ee686079d$export$fab274f99578ceb6 = 1e-3;
const $5b43ca2ee686079d$export$77bd0ce503b87b26 = 1e-6;
const $5b43ca2ee686079d$export$ddef5c050164e23e = 1e-9;
const $5b43ca2ee686079d$export$e10c52a2ab594201 = 1e-12;
const $5b43ca2ee686079d$export$c49f04803481822 = 1e-15;
const $5b43ca2ee686079d$export$5510a0bcf77f39 = 1e-18;
const $5b43ca2ee686079d$export$2b85cc24af20b7fe = 1e-21;
const $5b43ca2ee686079d$export$a2878e23774b59ce = 1e-24;
const $5b43ca2ee686079d$var$prefixUp = [
    '',
    'k',
    'M',
    'G',
    'T',
    'P',
    'E',
    'Z',
    'Y'
];
const $5b43ca2ee686079d$var$prefixDown = [
    '',
    'm',
    "\u03BC",
    'n',
    'p',
    'f',
    'a',
    'z',
    'y'
];
const $5b43ca2ee686079d$export$82e9f45cca5ba907 = (n, baseMultiplier = 0)=>{
    const nPow = n === 0 ? 0 : $674380a05f97f4f3$export$75e08744a3ff8516(n);
    let mult = 0;
    while(nPow < mult * 3 && baseMultiplier > -8){
        baseMultiplier--;
        mult--;
    }
    while(nPow >= 3 + mult * 3 && baseMultiplier < 8){
        baseMultiplier++;
        mult++;
    }
    const prefix = baseMultiplier < 0 ? $5b43ca2ee686079d$var$prefixDown[-baseMultiplier] : $5b43ca2ee686079d$var$prefixUp[baseMultiplier];
    return {
        n: $674380a05f97f4f3$export$2077e0241d6afd3c((mult > 0 ? n / $674380a05f97f4f3$export$1bb2a14208c790f7(mult * 3) : n * $674380a05f97f4f3$export$1bb2a14208c790f7(mult * -3)) * 1e12) / 1e12,
        prefix: prefix
    };
};



const $3500d09fbb2953ce$export$aa350b96d91cd94 = ()=>new Date();
const $3500d09fbb2953ce$export$1f77c0008d16313 = Date.now;
const $3500d09fbb2953ce$export$70cb903099cabea3 = (d)=>{
    if (d < 60000) {
        const p = $5b43ca2ee686079d$export$82e9f45cca5ba907(d, -1);
        return $674380a05f97f4f3$export$2077e0241d6afd3c(p.n * 100) / 100 + p.prefix + 's';
    }
    d = $674380a05f97f4f3$export$a3fe094919f356fd(d / 1000);
    const seconds = d % 60;
    const minutes = $674380a05f97f4f3$export$a3fe094919f356fd(d / 60) % 60;
    const hours = $674380a05f97f4f3$export$a3fe094919f356fd(d / 3600) % 24;
    const days = $674380a05f97f4f3$export$a3fe094919f356fd(d / 86400);
    if (days > 0) return days + 'd' + (hours > 0 || minutes > 30 ? ' ' + (minutes > 30 ? hours + 1 : hours) + 'h' : '');
    if (hours > 0) /* c8 ignore next */ return hours + 'h' + (minutes > 0 || seconds > 30 ? ' ' + (seconds > 30 ? minutes + 1 : minutes) + 'min' : '');
    return minutes + 'min' + (seconds > 0 ? ' ' + seconds + 's' : '');
};


const $f43a5cbbc8f3e47e$export$185802fd694ee1f5 = (f)=>/** @type {Promise<T>} */ new Promise(f);
const $f43a5cbbc8f3e47e$export$fe201bb3bbe031e9 = (f)=>new Promise(f);
const $f43a5cbbc8f3e47e$export$84bf76cd7afc7469 = Promise.all.bind(Promise);
const $f43a5cbbc8f3e47e$export$2800f3ceda99eb84 = (reason)=>Promise.reject(reason);
const $f43a5cbbc8f3e47e$export$f7ad0328861e2f03 = (res)=>Promise.resolve(res);
const $f43a5cbbc8f3e47e$export$65eff93aa071dbbd = (res)=>Promise.resolve(res);
const $f43a5cbbc8f3e47e$export$a40009bd2c363351 = (timeout, check, intervalResolution = 10)=>$f43a5cbbc8f3e47e$export$185802fd694ee1f5((resolve, reject)=>{
        const startTime = $3500d09fbb2953ce$export$1f77c0008d16313();
        const hasTimeout = timeout > 0;
        const untilInterval = ()=>{
            if (check()) {
                clearInterval(intervalHandle);
                resolve();
            } else if (hasTimeout) /* c8 ignore else */ {
                if ($3500d09fbb2953ce$export$1f77c0008d16313() - startTime > timeout) {
                    clearInterval(intervalHandle);
                    reject(new Error('Timeout'));
                }
            }
        };
        const intervalHandle = setInterval(untilInterval, intervalResolution);
    });
const $f43a5cbbc8f3e47e$export$6ab8c822a2b03a03 = async (check, timeout = 0, intervalResolution = 10)=>{
    const startTime = $3500d09fbb2953ce$export$1f77c0008d16313();
    const noTimeout = timeout <= 0;
    // eslint-disable-next-line no-unmodified-loop-condition
    while(noTimeout || $3500d09fbb2953ce$export$1f77c0008d16313() - startTime <= timeout){
        if (await check()) return;
        await $f43a5cbbc8f3e47e$export$5c069c93d2b7493f(intervalResolution);
    }
    throw new Error('Timeout');
};
const $f43a5cbbc8f3e47e$export$5c069c93d2b7493f = (timeout)=>$f43a5cbbc8f3e47e$export$185802fd694ee1f5((resolve, _reject)=>setTimeout(resolve, timeout));
const $f43a5cbbc8f3e47e$export$4369c812aac99591 = (p)=>p instanceof Promise || p && p.then && p.catch && p.finally;


/**
 * Utility functions to work with buffers (Uint8Array).
 *
 * @module buffer
 */ 
/**
 * Isomorphic module to work access the environment (query params, env variables).
 *
 * @module environment
 */ 

/**
 * Often used conditions.
 *
 * @module conditions
 */ /**
 * @template T
 * @param {T|null|undefined} v
 * @return {T|null}
 */ /* c8 ignore next */ const $e095237a378fe88d$export$43874719a1af321f = (v)=>v === undefined ? null : v;


/* eslint-env browser */ /**
 * Isomorphic variable storage.
 *
 * Uses LocalStorage in the browser and falls back to in-memory storage.
 *
 * @module storage
 */ /* c8 ignore start */ class $362228369924c7eb$var$VarStoragePolyfill {
    constructor(){
        this.map = new Map();
    }
    /**
   * @param {string} key
   * @param {any} newValue
   */ setItem(key, newValue) {
        this.map.set(key, newValue);
    }
    /**
   * @param {string} key
   */ getItem(key) {
        return this.map.get(key);
    }
}
/* c8 ignore stop */ /**
 * @type {any}
 */ let $362228369924c7eb$var$_localStorage = new $362228369924c7eb$var$VarStoragePolyfill();
let $362228369924c7eb$var$usePolyfill = true;
/* c8 ignore start */ try {
    // if the same-origin rule is violated, accessing localStorage might thrown an error
    if (typeof localStorage !== 'undefined' && localStorage) {
        $362228369924c7eb$var$_localStorage = localStorage;
        $362228369924c7eb$var$usePolyfill = false;
    }
} catch (e) {}
const $362228369924c7eb$export$86b84a8d42aa2c65 = $362228369924c7eb$var$_localStorage;
const $362228369924c7eb$export$bd913411069e59d3 = (eventHandler)=>$362228369924c7eb$var$usePolyfill || addEventListener('storage', /** @type {any} */ eventHandler);
const $362228369924c7eb$export$ff6a13ad336aa064 = (eventHandler)=>$362228369924c7eb$var$usePolyfill || removeEventListener('storage', /** @type {any} */ eventHandler);


/**
 * Common functions and function call helpers.
 *
 * @module function
 */ 
/**
 * Utility functions for working with EcmaScript objects.
 *
 * @module object
 */ /**
 * @return {Object<string,any>} obj
 */ const $a87a3720cf570984$export$185802fd694ee1f5 = ()=>Object.create(null);
const $a87a3720cf570984$export$e6e34fd1f2686227 = Object.assign;
const $a87a3720cf570984$export$ed97f33186d4b816 = Object.keys;
const $a87a3720cf570984$export$4b80e395e36b5a56 = (obj, f)=>{
    for(const key in obj)f(obj[key], key);
};
const $a87a3720cf570984$export$871de8747c9eaa88 = (obj, f)=>{
    const results = [];
    for(const key in obj)results.push(f(obj[key], key));
    return results;
};
const $a87a3720cf570984$export$f24224f1c91d8156 = (obj)=>$a87a3720cf570984$export$ed97f33186d4b816(obj).length;
const $a87a3720cf570984$export$346677f925de839c = (obj)=>$a87a3720cf570984$export$ed97f33186d4b816(obj).length;
const $a87a3720cf570984$export$ad14ef4001db2bcd = (obj, f)=>{
    for(const key in obj){
        if (f(obj[key], key)) return true;
    }
    return false;
};
const $a87a3720cf570984$export$dd1bc94b04021eeb = (obj)=>{
    // eslint-disable-next-line
    for(const _k in obj)return false;
    return true;
};
const $a87a3720cf570984$export$7ecc1a3b11b57dab = (obj, f)=>{
    for(const key in obj){
        if (!f(obj[key], key)) return false;
    }
    return true;
};
const $a87a3720cf570984$export$bf9617eaf5d2451 = (obj, key)=>Object.prototype.hasOwnProperty.call(obj, key);
const $a87a3720cf570984$export$4f1c34abb2bb4c8 = (a, b)=>a === b || $a87a3720cf570984$export$346677f925de839c(a) === $a87a3720cf570984$export$346677f925de839c(b) && $a87a3720cf570984$export$7ecc1a3b11b57dab(a, (val, key)=>(val !== undefined || $a87a3720cf570984$export$bf9617eaf5d2451(b, key)) && b[key] === val);
const $a87a3720cf570984$export$792f3d81ea979f55 = Object.freeze;
const $a87a3720cf570984$export$7e32b29e1cb162e1 = (o)=>{
    for(const key in o){
        const c = o[key];
        if (typeof c === 'object' || typeof c === 'function') $a87a3720cf570984$export$7e32b29e1cb162e1(o[key]);
    }
    return $a87a3720cf570984$export$792f3d81ea979f55(o);
};


const $e2897672a487246a$export$9dd9a52f2dd5b9ce = (fs, args, i = 0)=>{
    try {
        for(; i < fs.length; i++)fs[i](...args);
    } finally{
        if (i < fs.length) $e2897672a487246a$export$9dd9a52f2dd5b9ce(fs, args, i + 1);
    }
};
const $e2897672a487246a$export$b5f1cfe7b08e6ed5 = ()=>{};
const $e2897672a487246a$export$5635d7ef4b8fee1c = (f)=>f();
const $e2897672a487246a$export$d560c7e4a29451c2 = (a)=>a;
const $e2897672a487246a$export$bbb1dcf8c6c6bac1 = (a, b)=>a === b;
const $e2897672a487246a$export$6ca82605a98f2278 = (a, b)=>a === b || a != null && b != null && a.constructor === b.constructor && ($cfaabc628d0f476d$export$43bee75e5e14138e(a) && $cfaabc628d0f476d$export$4f1c34abb2bb4c8(a, /** @type {Array<T>} */ b) || typeof a === 'object' && $a87a3720cf570984$export$4f1c34abb2bb4c8(a, b));
const $e2897672a487246a$export$2ca9a723affd5d11 = (a, b)=>{
    if (a == null || b == null) return $e2897672a487246a$export$bbb1dcf8c6c6bac1(a, b);
    if (a.constructor !== b.constructor) return false;
    if (a === b) return true;
    switch(a.constructor){
        case ArrayBuffer:
            a = new Uint8Array(a);
            b = new Uint8Array(b);
        // eslint-disable-next-line no-fallthrough
        case Uint8Array:
            if (a.byteLength !== b.byteLength) return false;
            for(let i = 0; i < a.length; i++){
                if (a[i] !== b[i]) return false;
            }
            break;
        case Set:
            if (a.size !== b.size) return false;
            for (const value of a){
                if (!b.has(value)) return false;
            }
            break;
        case Map:
            if (a.size !== b.size) return false;
            for (const key of a.keys()){
                if (!b.has(key) || !$e2897672a487246a$export$2ca9a723affd5d11(a.get(key), b.get(key))) return false;
            }
            break;
        case Object:
            if ($a87a3720cf570984$export$f24224f1c91d8156(a) !== $a87a3720cf570984$export$f24224f1c91d8156(b)) return false;
            for(const key in a){
                if (!$a87a3720cf570984$export$bf9617eaf5d2451(a, key) || !$e2897672a487246a$export$2ca9a723affd5d11(a[key], b[key])) return false;
            }
            break;
        case Array:
            if (a.length !== b.length) return false;
            for(let i = 0; i < a.length; i++){
                if (!$e2897672a487246a$export$2ca9a723affd5d11(a[i], b[i])) return false;
            }
            break;
        default:
            return false;
    }
    return true;
};
const $e2897672a487246a$export$532a90c0e5e8e48c = (value, options)=>options.includes(value);
const $e2897672a487246a$export$43bee75e5e14138e = $cfaabc628d0f476d$export$43bee75e5e14138e;
const $e2897672a487246a$export$844ec244b1367d54 = (s)=>s && s.constructor === String;
const $e2897672a487246a$export$7e4aa119212bc614 = (n)=>n != null && n.constructor === Number;
const $e2897672a487246a$export$226b3eccf92c9ed9 = (n, T)=>n && n.constructor === T;
const $e2897672a487246a$export$6306e0d85c68df69 = (T)=>/**
   * @param {any} n
   * @return {n is InstanceType<TYPE>}
   **/ (n)=>n && n.constructor === T;


var $361a76e6ea33591f$exports = {};
// shim for using process in browser
var $361a76e6ea33591f$var$process = $361a76e6ea33591f$exports = {};
// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.
var $361a76e6ea33591f$var$cachedSetTimeout;
var $361a76e6ea33591f$var$cachedClearTimeout;
function $361a76e6ea33591f$var$defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function $361a76e6ea33591f$var$defaultClearTimeout() {
    throw new Error('clearTimeout has not been defined');
}
(function() {
    try {
        if (typeof setTimeout === 'function') $361a76e6ea33591f$var$cachedSetTimeout = setTimeout;
        else $361a76e6ea33591f$var$cachedSetTimeout = $361a76e6ea33591f$var$defaultSetTimout;
    } catch (e) {
        $361a76e6ea33591f$var$cachedSetTimeout = $361a76e6ea33591f$var$defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') $361a76e6ea33591f$var$cachedClearTimeout = clearTimeout;
        else $361a76e6ea33591f$var$cachedClearTimeout = $361a76e6ea33591f$var$defaultClearTimeout;
    } catch (e) {
        $361a76e6ea33591f$var$cachedClearTimeout = $361a76e6ea33591f$var$defaultClearTimeout;
    }
})();
function $361a76e6ea33591f$var$runTimeout(fun) {
    if ($361a76e6ea33591f$var$cachedSetTimeout === setTimeout) //normal enviroments in sane situations
    return setTimeout(fun, 0);
    // if setTimeout wasn't available but was latter defined
    if (($361a76e6ea33591f$var$cachedSetTimeout === $361a76e6ea33591f$var$defaultSetTimout || !$361a76e6ea33591f$var$cachedSetTimeout) && setTimeout) {
        $361a76e6ea33591f$var$cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return $361a76e6ea33591f$var$cachedSetTimeout(fun, 0);
    } catch (e) {
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return $361a76e6ea33591f$var$cachedSetTimeout.call(null, fun, 0);
        } catch (e) {
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return $361a76e6ea33591f$var$cachedSetTimeout.call(this, fun, 0);
        }
    }
}
function $361a76e6ea33591f$var$runClearTimeout(marker) {
    if ($361a76e6ea33591f$var$cachedClearTimeout === clearTimeout) //normal enviroments in sane situations
    return clearTimeout(marker);
    // if clearTimeout wasn't available but was latter defined
    if (($361a76e6ea33591f$var$cachedClearTimeout === $361a76e6ea33591f$var$defaultClearTimeout || !$361a76e6ea33591f$var$cachedClearTimeout) && clearTimeout) {
        $361a76e6ea33591f$var$cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return $361a76e6ea33591f$var$cachedClearTimeout(marker);
    } catch (e) {
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return $361a76e6ea33591f$var$cachedClearTimeout.call(null, marker);
        } catch (e) {
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return $361a76e6ea33591f$var$cachedClearTimeout.call(this, marker);
        }
    }
}
var $361a76e6ea33591f$var$queue = [];
var $361a76e6ea33591f$var$draining = false;
var $361a76e6ea33591f$var$currentQueue;
var $361a76e6ea33591f$var$queueIndex = -1;
function $361a76e6ea33591f$var$cleanUpNextTick() {
    if (!$361a76e6ea33591f$var$draining || !$361a76e6ea33591f$var$currentQueue) return;
    $361a76e6ea33591f$var$draining = false;
    if ($361a76e6ea33591f$var$currentQueue.length) $361a76e6ea33591f$var$queue = $361a76e6ea33591f$var$currentQueue.concat($361a76e6ea33591f$var$queue);
    else $361a76e6ea33591f$var$queueIndex = -1;
    if ($361a76e6ea33591f$var$queue.length) $361a76e6ea33591f$var$drainQueue();
}
function $361a76e6ea33591f$var$drainQueue() {
    if ($361a76e6ea33591f$var$draining) return;
    var timeout = $361a76e6ea33591f$var$runTimeout($361a76e6ea33591f$var$cleanUpNextTick);
    $361a76e6ea33591f$var$draining = true;
    var len = $361a76e6ea33591f$var$queue.length;
    while(len){
        $361a76e6ea33591f$var$currentQueue = $361a76e6ea33591f$var$queue;
        $361a76e6ea33591f$var$queue = [];
        while(++$361a76e6ea33591f$var$queueIndex < len)if ($361a76e6ea33591f$var$currentQueue) $361a76e6ea33591f$var$currentQueue[$361a76e6ea33591f$var$queueIndex].run();
        $361a76e6ea33591f$var$queueIndex = -1;
        len = $361a76e6ea33591f$var$queue.length;
    }
    $361a76e6ea33591f$var$currentQueue = null;
    $361a76e6ea33591f$var$draining = false;
    $361a76e6ea33591f$var$runClearTimeout(timeout);
}
$361a76e6ea33591f$var$process.nextTick = function(fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) for(var i = 1; i < arguments.length; i++)args[i - 1] = arguments[i];
    $361a76e6ea33591f$var$queue.push(new $361a76e6ea33591f$var$Item(fun, args));
    if ($361a76e6ea33591f$var$queue.length === 1 && !$361a76e6ea33591f$var$draining) $361a76e6ea33591f$var$runTimeout($361a76e6ea33591f$var$drainQueue);
};
// v8 likes predictible objects
function $361a76e6ea33591f$var$Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
$361a76e6ea33591f$var$Item.prototype.run = function() {
    this.fun.apply(null, this.array);
};
$361a76e6ea33591f$var$process.title = 'browser';
$361a76e6ea33591f$var$process.browser = true;
$361a76e6ea33591f$var$process.env = {};
$361a76e6ea33591f$var$process.argv = [];
$361a76e6ea33591f$var$process.version = ''; // empty string to avoid regexp issues
$361a76e6ea33591f$var$process.versions = {};
function $361a76e6ea33591f$var$noop() {}
$361a76e6ea33591f$var$process.on = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.addListener = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.once = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.off = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.removeListener = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.removeAllListeners = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.emit = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.prependListener = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.prependOnceListener = $361a76e6ea33591f$var$noop;
$361a76e6ea33591f$var$process.listeners = function(name) {
    return [];
};
$361a76e6ea33591f$var$process.binding = function(name) {
    throw new Error('process.binding is not supported');
};
$361a76e6ea33591f$var$process.cwd = function() {
    return '/';
};
$361a76e6ea33591f$var$process.chdir = function(dir) {
    throw new Error('process.chdir is not supported');
};
$361a76e6ea33591f$var$process.umask = function() {
    return 0;
};


const $63eb5f96ace248ce$export$8ee0fc9ee280b4ee = typeof $361a76e6ea33591f$exports !== 'undefined' && $361a76e6ea33591f$exports.release && /node|io\.js/.test($361a76e6ea33591f$exports.release.name) && Object.prototype.toString.call(typeof $361a76e6ea33591f$exports !== 'undefined' ? $361a76e6ea33591f$exports : 0) === '[object process]';
const $63eb5f96ace248ce$export$4e09c449d6c407f7 = typeof window !== 'undefined' && typeof document !== 'undefined' && !$63eb5f96ace248ce$export$8ee0fc9ee280b4ee;
const $63eb5f96ace248ce$export$9ac100e40613ea10 = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
/**
 * @type {Map<string,string>}
 */ let $63eb5f96ace248ce$var$params;
const $63eb5f96ace248ce$var$args = [];
/* c8 ignore start */ const $63eb5f96ace248ce$var$computeParams = ()=>{
    if ($63eb5f96ace248ce$var$params === undefined) {
        if ($63eb5f96ace248ce$export$8ee0fc9ee280b4ee) {
            $63eb5f96ace248ce$var$params = $58ab1e30cc73aec7$export$185802fd694ee1f5();
            const pargs = $361a76e6ea33591f$exports.argv;
            let currParamName = null;
            for(let i = 0; i < pargs.length; i++){
                const parg = pargs[i];
                if (parg[0] === '-') {
                    if (currParamName !== null) $63eb5f96ace248ce$var$params.set(currParamName, '');
                    currParamName = parg;
                } else if (currParamName !== null) {
                    $63eb5f96ace248ce$var$params.set(currParamName, parg);
                    currParamName = null;
                } else $63eb5f96ace248ce$var$args.push(parg);
            }
            if (currParamName !== null) $63eb5f96ace248ce$var$params.set(currParamName, '');
        // in ReactNative for example this would not be true (unless connected to the Remote Debugger)
        } else if (typeof location === 'object') {
            $63eb5f96ace248ce$var$params = $58ab1e30cc73aec7$export$185802fd694ee1f5(); // eslint-disable-next-line no-undef
            (location.search || '?').slice(1).split('&').forEach((kv)=>{
                if (kv.length !== 0) {
                    const [key, value] = kv.split('=');
                    $63eb5f96ace248ce$var$params.set(`--${$83a4db9bed1df563$export$87429743646c3257(key, '-')}`, value);
                    $63eb5f96ace248ce$var$params.set(`-${$83a4db9bed1df563$export$87429743646c3257(key, '-')}`, value);
                }
            });
        } else $63eb5f96ace248ce$var$params = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    }
    return $63eb5f96ace248ce$var$params;
};
const $63eb5f96ace248ce$export$3ad523d4e4ddff75 = (name)=>$63eb5f96ace248ce$var$computeParams().has(name);
const $63eb5f96ace248ce$export$ecf541e09a511845 = (name, defaultVal)=>$63eb5f96ace248ce$var$computeParams().get(name) || defaultVal;
const $63eb5f96ace248ce$export$39fb32ac18db3f88 = (name)=>$63eb5f96ace248ce$export$8ee0fc9ee280b4ee ? $e095237a378fe88d$export$43874719a1af321f($361a76e6ea33591f$exports.env[name.toUpperCase().replaceAll('-', '_')]) : $e095237a378fe88d$export$43874719a1af321f($362228369924c7eb$export$86b84a8d42aa2c65.getItem(name));
const $63eb5f96ace248ce$export$137940a4fd07b923 = (name)=>$63eb5f96ace248ce$var$computeParams().get('--' + name) || $63eb5f96ace248ce$export$39fb32ac18db3f88(name);
const $63eb5f96ace248ce$export$e336c1d2b3b2390d = (name)=>{
    const c = $63eb5f96ace248ce$export$137940a4fd07b923(name);
    if (c == null) throw new Error(`Expected configuration "${name.toUpperCase().replaceAll('-', '_')}"`);
    return c;
};
const $63eb5f96ace248ce$export$41f29dc169f5b0eb = (name)=>$63eb5f96ace248ce$export$3ad523d4e4ddff75('--' + name) || $63eb5f96ace248ce$export$39fb32ac18db3f88(name) !== null;
const $63eb5f96ace248ce$export$d71d1489bc353e92 = $63eb5f96ace248ce$export$41f29dc169f5b0eb('production');
/* c8 ignore next 2 */ const $63eb5f96ace248ce$var$forceColor = $63eb5f96ace248ce$export$8ee0fc9ee280b4ee && $e2897672a487246a$export$532a90c0e5e8e48c(undefined, [
    'true',
    '1',
    '2'
]);
const $63eb5f96ace248ce$export$fcbe44f5d6fcebd = $63eb5f96ace248ce$var$forceColor || !$63eb5f96ace248ce$export$3ad523d4e4ddff75('--no-colors') && // @todo deprecate --no-colors
!$63eb5f96ace248ce$export$41f29dc169f5b0eb('no-color') && (!$63eb5f96ace248ce$export$8ee0fc9ee280b4ee || $361a76e6ea33591f$exports.stdout.isTTY) && (!$63eb5f96ace248ce$export$8ee0fc9ee280b4ee || $63eb5f96ace248ce$export$3ad523d4e4ddff75('--color') || $63eb5f96ace248ce$export$39fb32ac18db3f88('COLORTERM') !== null || ($63eb5f96ace248ce$export$39fb32ac18db3f88('TERM') || '').includes('color')) /* c8 ignore stop */ ;






/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */ /* eslint-disable no-proto */ var $7aaf889172aa0226$export$a143d493d941bafc;
var $7aaf889172aa0226$export$e4cf37d7f6fb9e0a;
var $7aaf889172aa0226$export$f99ded8fe4b79145;
var $7aaf889172aa0226$export$599f31c3813fae4d;
'use strict';
var $023dfcfbcb75732a$export$a48f0734ac7c2329;
var $023dfcfbcb75732a$export$d622b2ad8d90c771;
var $023dfcfbcb75732a$export$6100ba28696e12de;
'use strict';
$023dfcfbcb75732a$export$a48f0734ac7c2329 = $023dfcfbcb75732a$var$byteLength;
$023dfcfbcb75732a$export$d622b2ad8d90c771 = $023dfcfbcb75732a$var$toByteArray;
$023dfcfbcb75732a$export$6100ba28696e12de = $023dfcfbcb75732a$var$fromByteArray;
var $023dfcfbcb75732a$var$lookup = [];
var $023dfcfbcb75732a$var$revLookup = [];
var $023dfcfbcb75732a$var$Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array;
var $023dfcfbcb75732a$var$code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
for(var $023dfcfbcb75732a$var$i = 0, $023dfcfbcb75732a$var$len = $023dfcfbcb75732a$var$code.length; $023dfcfbcb75732a$var$i < $023dfcfbcb75732a$var$len; ++$023dfcfbcb75732a$var$i){
    $023dfcfbcb75732a$var$lookup[$023dfcfbcb75732a$var$i] = $023dfcfbcb75732a$var$code[$023dfcfbcb75732a$var$i];
    $023dfcfbcb75732a$var$revLookup[$023dfcfbcb75732a$var$code.charCodeAt($023dfcfbcb75732a$var$i)] = $023dfcfbcb75732a$var$i;
}
// Support decoding URL-safe base64 strings, as Node.js does.
// See: https://en.wikipedia.org/wiki/Base64#URL_applications
$023dfcfbcb75732a$var$revLookup['-'.charCodeAt(0)] = 62;
$023dfcfbcb75732a$var$revLookup['_'.charCodeAt(0)] = 63;
function $023dfcfbcb75732a$var$getLens(b64) {
    var len = b64.length;
    if (len % 4 > 0) throw new Error('Invalid string. Length must be a multiple of 4');
    // Trim off extra bytes after placeholder bytes are found
    // See: https://github.com/beatgammit/base64-js/issues/42
    var validLen = b64.indexOf('=');
    if (validLen === -1) validLen = len;
    var placeHoldersLen = validLen === len ? 0 : 4 - validLen % 4;
    return [
        validLen,
        placeHoldersLen
    ];
}
// base64 is 4/3 + up to two characters of the original data
function $023dfcfbcb75732a$var$byteLength(b64) {
    var lens = $023dfcfbcb75732a$var$getLens(b64);
    var validLen = lens[0];
    var placeHoldersLen = lens[1];
    return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;
}
function $023dfcfbcb75732a$var$_byteLength(b64, validLen, placeHoldersLen) {
    return (validLen + placeHoldersLen) * 3 / 4 - placeHoldersLen;
}
function $023dfcfbcb75732a$var$toByteArray(b64) {
    var tmp;
    var lens = $023dfcfbcb75732a$var$getLens(b64);
    var validLen = lens[0];
    var placeHoldersLen = lens[1];
    var arr = new $023dfcfbcb75732a$var$Arr($023dfcfbcb75732a$var$_byteLength(b64, validLen, placeHoldersLen));
    var curByte = 0;
    // if there are placeholders, only get up to the last complete 4 chars
    var len = placeHoldersLen > 0 ? validLen - 4 : validLen;
    var i;
    for(i = 0; i < len; i += 4){
        tmp = $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i)] << 18 | $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i + 1)] << 12 | $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i + 2)] << 6 | $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i + 3)];
        arr[curByte++] = tmp >> 16 & 0xFF;
        arr[curByte++] = tmp >> 8 & 0xFF;
        arr[curByte++] = tmp & 0xFF;
    }
    if (placeHoldersLen === 2) {
        tmp = $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i)] << 2 | $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i + 1)] >> 4;
        arr[curByte++] = tmp & 0xFF;
    }
    if (placeHoldersLen === 1) {
        tmp = $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i)] << 10 | $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i + 1)] << 4 | $023dfcfbcb75732a$var$revLookup[b64.charCodeAt(i + 2)] >> 2;
        arr[curByte++] = tmp >> 8 & 0xFF;
        arr[curByte++] = tmp & 0xFF;
    }
    return arr;
}
function $023dfcfbcb75732a$var$tripletToBase64(num) {
    return $023dfcfbcb75732a$var$lookup[num >> 18 & 0x3F] + $023dfcfbcb75732a$var$lookup[num >> 12 & 0x3F] + $023dfcfbcb75732a$var$lookup[num >> 6 & 0x3F] + $023dfcfbcb75732a$var$lookup[num & 0x3F];
}
function $023dfcfbcb75732a$var$encodeChunk(uint8, start, end) {
    var tmp;
    var output = [];
    for(var i = start; i < end; i += 3){
        tmp = (uint8[i] << 16 & 0xFF0000) + (uint8[i + 1] << 8 & 0xFF00) + (uint8[i + 2] & 0xFF);
        output.push($023dfcfbcb75732a$var$tripletToBase64(tmp));
    }
    return output.join('');
}
function $023dfcfbcb75732a$var$fromByteArray(uint8) {
    var tmp;
    var len = uint8.length;
    var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes
    ;
    var parts = [];
    var maxChunkLength = 16383 // must be multiple of 3
    ;
    // go through the array every three bytes, we'll deal with trailing stuff later
    for(var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength)parts.push($023dfcfbcb75732a$var$encodeChunk(uint8, i, i + maxChunkLength > len2 ? len2 : i + maxChunkLength));
    // pad the end with zeros, but make sure to not forget the extra bytes
    if (extraBytes === 1) {
        tmp = uint8[len - 1];
        parts.push($023dfcfbcb75732a$var$lookup[tmp >> 2] + $023dfcfbcb75732a$var$lookup[tmp << 4 & 0x3F] + '==');
    } else if (extraBytes === 2) {
        tmp = (uint8[len - 2] << 8) + uint8[len - 1];
        parts.push($023dfcfbcb75732a$var$lookup[tmp >> 10] + $023dfcfbcb75732a$var$lookup[tmp >> 4 & 0x3F] + $023dfcfbcb75732a$var$lookup[tmp << 2 & 0x3F] + '=');
    }
    return parts.join('');
}


/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ var $b38ea80d59ab0cdb$export$aafa59e2e03f2942;
var $b38ea80d59ab0cdb$export$68d8715fc104d294;
$b38ea80d59ab0cdb$export$aafa59e2e03f2942 = function(buffer, offset, isLE, mLen, nBytes) {
    var e, m;
    var eLen = nBytes * 8 - mLen - 1;
    var eMax = (1 << eLen) - 1;
    var eBias = eMax >> 1;
    var nBits = -7;
    var i = isLE ? nBytes - 1 : 0;
    var d = isLE ? -1 : 1;
    var s = buffer[offset + i];
    i += d;
    e = s & (1 << -nBits) - 1;
    s >>= -nBits;
    nBits += eLen;
    for(; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8);
    m = e & (1 << -nBits) - 1;
    e >>= -nBits;
    nBits += mLen;
    for(; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8);
    if (e === 0) e = 1 - eBias;
    else if (e === eMax) return m ? NaN : (s ? -1 : 1) * Infinity;
    else {
        m = m + Math.pow(2, mLen);
        e = e - eBias;
    }
    return (s ? -1 : 1) * m * Math.pow(2, e - mLen);
};
$b38ea80d59ab0cdb$export$68d8715fc104d294 = function(buffer, value, offset, isLE, mLen, nBytes) {
    var e, m, c;
    var eLen = nBytes * 8 - mLen - 1;
    var eMax = (1 << eLen) - 1;
    var eBias = eMax >> 1;
    var rt = mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0;
    var i = isLE ? 0 : nBytes - 1;
    var d = isLE ? 1 : -1;
    var s = value < 0 || value === 0 && 1 / value < 0 ? 1 : 0;
    value = Math.abs(value);
    if (isNaN(value) || value === Infinity) {
        m = isNaN(value) ? 1 : 0;
        e = eMax;
    } else {
        e = Math.floor(Math.log(value) / Math.LN2);
        if (value * (c = Math.pow(2, -e)) < 1) {
            e--;
            c *= 2;
        }
        if (e + eBias >= 1) value += rt / c;
        else value += rt * Math.pow(2, 1 - eBias);
        if (value * c >= 2) {
            e++;
            c /= 2;
        }
        if (e + eBias >= eMax) {
            m = 0;
            e = eMax;
        } else if (e + eBias >= 1) {
            m = (value * c - 1) * Math.pow(2, mLen);
            e = e + eBias;
        } else {
            m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);
            e = 0;
        }
    }
    for(; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8);
    e = e << mLen | m;
    eLen += mLen;
    for(; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8);
    buffer[offset + i - d] |= s * 128;
};


const $7aaf889172aa0226$var$customInspectSymbol = typeof Symbol === 'function' && typeof Symbol['for'] === 'function' // eslint-disable-line dot-notation
 ? Symbol['for']('nodejs.util.inspect.custom') // eslint-disable-line dot-notation
 : null;
$7aaf889172aa0226$export$a143d493d941bafc = $7aaf889172aa0226$var$Buffer;
$7aaf889172aa0226$export$e4cf37d7f6fb9e0a = $7aaf889172aa0226$var$SlowBuffer;
$7aaf889172aa0226$export$f99ded8fe4b79145 = 50;
const $7aaf889172aa0226$var$K_MAX_LENGTH = 0x7fffffff;
$7aaf889172aa0226$export$599f31c3813fae4d = $7aaf889172aa0226$var$K_MAX_LENGTH;
/**
 * If `Buffer.TYPED_ARRAY_SUPPORT`:
 *   === true    Use Uint8Array implementation (fastest)
 *   === false   Print warning and recommend using `buffer` v4.x which has an Object
 *               implementation (most compatible, even IE6)
 *
 * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,
 * Opera 11.6+, iOS 4.2+.
 *
 * We report that the browser does not support typed arrays if the are not subclassable
 * using __proto__. Firefox 4-29 lacks support for adding new properties to `Uint8Array`
 * (See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438). IE 10 lacks support
 * for __proto__ and has a buggy typed array implementation.
 */ $7aaf889172aa0226$var$Buffer.TYPED_ARRAY_SUPPORT = $7aaf889172aa0226$var$typedArraySupport();
if (!$7aaf889172aa0226$var$Buffer.TYPED_ARRAY_SUPPORT && typeof console !== 'undefined' && typeof console.error === 'function') console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");
function $7aaf889172aa0226$var$typedArraySupport() {
    // Can typed array instances can be augmented?
    try {
        const arr = new Uint8Array(1);
        const proto = {
            foo: function() {
                return 42;
            }
        };
        Object.setPrototypeOf(proto, Uint8Array.prototype);
        Object.setPrototypeOf(arr, proto);
        return arr.foo() === 42;
    } catch (e) {
        return false;
    }
}
Object.defineProperty($7aaf889172aa0226$var$Buffer.prototype, 'parent', {
    enumerable: true,
    get: function() {
        if (!$7aaf889172aa0226$var$Buffer.isBuffer(this)) return undefined;
        return this.buffer;
    }
});
Object.defineProperty($7aaf889172aa0226$var$Buffer.prototype, 'offset', {
    enumerable: true,
    get: function() {
        if (!$7aaf889172aa0226$var$Buffer.isBuffer(this)) return undefined;
        return this.byteOffset;
    }
});
function $7aaf889172aa0226$var$createBuffer(length) {
    if (length > $7aaf889172aa0226$var$K_MAX_LENGTH) throw new RangeError('The value "' + length + '" is invalid for option "size"');
    // Return an augmented `Uint8Array` instance
    const buf = new Uint8Array(length);
    Object.setPrototypeOf(buf, $7aaf889172aa0226$var$Buffer.prototype);
    return buf;
}
/**
 * The Buffer constructor returns instances of `Uint8Array` that have their
 * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of
 * `Uint8Array`, so the returned instances will have all the node `Buffer` methods
 * and the `Uint8Array` methods. Square bracket notation works as expected -- it
 * returns a single octet.
 *
 * The `Uint8Array` prototype remains unmodified.
 */ function $7aaf889172aa0226$var$Buffer(arg, encodingOrOffset, length) {
    // Common case.
    if (typeof arg === 'number') {
        if (typeof encodingOrOffset === 'string') throw new TypeError('The "string" argument must be of type string. Received type number');
        return $7aaf889172aa0226$var$allocUnsafe(arg);
    }
    return $7aaf889172aa0226$var$from(arg, encodingOrOffset, length);
}
$7aaf889172aa0226$var$Buffer.poolSize = 8192 // not used by this implementation
;
function $7aaf889172aa0226$var$from(value, encodingOrOffset, length) {
    if (typeof value === 'string') return $7aaf889172aa0226$var$fromString(value, encodingOrOffset);
    if (ArrayBuffer.isView(value)) return $7aaf889172aa0226$var$fromArrayView(value);
    if (value == null) throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type " + typeof value);
    if ($7aaf889172aa0226$var$isInstance(value, ArrayBuffer) || value && $7aaf889172aa0226$var$isInstance(value.buffer, ArrayBuffer)) return $7aaf889172aa0226$var$fromArrayBuffer(value, encodingOrOffset, length);
    if (typeof SharedArrayBuffer !== 'undefined' && ($7aaf889172aa0226$var$isInstance(value, SharedArrayBuffer) || value && $7aaf889172aa0226$var$isInstance(value.buffer, SharedArrayBuffer))) return $7aaf889172aa0226$var$fromArrayBuffer(value, encodingOrOffset, length);
    if (typeof value === 'number') throw new TypeError('The "value" argument must not be of type number. Received type number');
    const valueOf = value.valueOf && value.valueOf();
    if (valueOf != null && valueOf !== value) return $7aaf889172aa0226$var$Buffer.from(valueOf, encodingOrOffset, length);
    const b = $7aaf889172aa0226$var$fromObject(value);
    if (b) return b;
    if (typeof Symbol !== 'undefined' && Symbol.toPrimitive != null && typeof value[Symbol.toPrimitive] === 'function') return $7aaf889172aa0226$var$Buffer.from(value[Symbol.toPrimitive]('string'), encodingOrOffset, length);
    throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type " + typeof value);
}
/**
 * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError
 * if value is a number.
 * Buffer.from(str[, encoding])
 * Buffer.from(array)
 * Buffer.from(buffer)
 * Buffer.from(arrayBuffer[, byteOffset[, length]])
 **/ $7aaf889172aa0226$var$Buffer.from = function(value, encodingOrOffset, length) {
    return $7aaf889172aa0226$var$from(value, encodingOrOffset, length);
};
// Note: Change prototype *after* Buffer.from is defined to workaround Chrome bug:
// https://github.com/feross/buffer/pull/148
Object.setPrototypeOf($7aaf889172aa0226$var$Buffer.prototype, Uint8Array.prototype);
Object.setPrototypeOf($7aaf889172aa0226$var$Buffer, Uint8Array);
function $7aaf889172aa0226$var$assertSize(size) {
    if (typeof size !== 'number') throw new TypeError('"size" argument must be of type number');
    else if (size < 0) throw new RangeError('The value "' + size + '" is invalid for option "size"');
}
function $7aaf889172aa0226$var$alloc(size, fill, encoding) {
    $7aaf889172aa0226$var$assertSize(size);
    if (size <= 0) return $7aaf889172aa0226$var$createBuffer(size);
    if (fill !== undefined) // Only pay attention to encoding if it's a string. This
    // prevents accidentally sending in a number that would
    // be interpreted as a start offset.
    return typeof encoding === 'string' ? $7aaf889172aa0226$var$createBuffer(size).fill(fill, encoding) : $7aaf889172aa0226$var$createBuffer(size).fill(fill);
    return $7aaf889172aa0226$var$createBuffer(size);
}
/**
 * Creates a new filled Buffer instance.
 * alloc(size[, fill[, encoding]])
 **/ $7aaf889172aa0226$var$Buffer.alloc = function(size, fill, encoding) {
    return $7aaf889172aa0226$var$alloc(size, fill, encoding);
};
function $7aaf889172aa0226$var$allocUnsafe(size) {
    $7aaf889172aa0226$var$assertSize(size);
    return $7aaf889172aa0226$var$createBuffer(size < 0 ? 0 : $7aaf889172aa0226$var$checked(size) | 0);
}
/**
 * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.
 * */ $7aaf889172aa0226$var$Buffer.allocUnsafe = function(size) {
    return $7aaf889172aa0226$var$allocUnsafe(size);
};
/**
 * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.
 */ $7aaf889172aa0226$var$Buffer.allocUnsafeSlow = function(size) {
    return $7aaf889172aa0226$var$allocUnsafe(size);
};
function $7aaf889172aa0226$var$fromString(string, encoding) {
    if (typeof encoding !== 'string' || encoding === '') encoding = 'utf8';
    if (!$7aaf889172aa0226$var$Buffer.isEncoding(encoding)) throw new TypeError('Unknown encoding: ' + encoding);
    const length = $7aaf889172aa0226$var$byteLength(string, encoding) | 0;
    let buf = $7aaf889172aa0226$var$createBuffer(length);
    const actual = buf.write(string, encoding);
    if (actual !== length) // Writing a hex string, for example, that contains invalid characters will
    // cause everything after the first invalid character to be ignored. (e.g.
    // 'abxxcd' will be treated as 'ab')
    buf = buf.slice(0, actual);
    return buf;
}
function $7aaf889172aa0226$var$fromArrayLike(array) {
    const length = array.length < 0 ? 0 : $7aaf889172aa0226$var$checked(array.length) | 0;
    const buf = $7aaf889172aa0226$var$createBuffer(length);
    for(let i = 0; i < length; i += 1)buf[i] = array[i] & 255;
    return buf;
}
function $7aaf889172aa0226$var$fromArrayView(arrayView) {
    if ($7aaf889172aa0226$var$isInstance(arrayView, Uint8Array)) {
        const copy = new Uint8Array(arrayView);
        return $7aaf889172aa0226$var$fromArrayBuffer(copy.buffer, copy.byteOffset, copy.byteLength);
    }
    return $7aaf889172aa0226$var$fromArrayLike(arrayView);
}
function $7aaf889172aa0226$var$fromArrayBuffer(array, byteOffset, length) {
    if (byteOffset < 0 || array.byteLength < byteOffset) throw new RangeError('"offset" is outside of buffer bounds');
    if (array.byteLength < byteOffset + (length || 0)) throw new RangeError('"length" is outside of buffer bounds');
    let buf;
    if (byteOffset === undefined && length === undefined) buf = new Uint8Array(array);
    else if (length === undefined) buf = new Uint8Array(array, byteOffset);
    else buf = new Uint8Array(array, byteOffset, length);
    // Return an augmented `Uint8Array` instance
    Object.setPrototypeOf(buf, $7aaf889172aa0226$var$Buffer.prototype);
    return buf;
}
function $7aaf889172aa0226$var$fromObject(obj) {
    if ($7aaf889172aa0226$var$Buffer.isBuffer(obj)) {
        const len = $7aaf889172aa0226$var$checked(obj.length) | 0;
        const buf = $7aaf889172aa0226$var$createBuffer(len);
        if (buf.length === 0) return buf;
        obj.copy(buf, 0, 0, len);
        return buf;
    }
    if (obj.length !== undefined) {
        if (typeof obj.length !== 'number' || $7aaf889172aa0226$var$numberIsNaN(obj.length)) return $7aaf889172aa0226$var$createBuffer(0);
        return $7aaf889172aa0226$var$fromArrayLike(obj);
    }
    if (obj.type === 'Buffer' && Array.isArray(obj.data)) return $7aaf889172aa0226$var$fromArrayLike(obj.data);
}
function $7aaf889172aa0226$var$checked(length) {
    // Note: cannot use `length < K_MAX_LENGTH` here because that fails when
    // length is NaN (which is otherwise coerced to zero.)
    if (length >= $7aaf889172aa0226$var$K_MAX_LENGTH) throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x" + $7aaf889172aa0226$var$K_MAX_LENGTH.toString(16) + ' bytes');
    return length | 0;
}
function $7aaf889172aa0226$var$SlowBuffer(length) {
    if (+length != length) length = 0;
    return $7aaf889172aa0226$var$Buffer.alloc(+length);
}
$7aaf889172aa0226$var$Buffer.isBuffer = function isBuffer(b) {
    return b != null && b._isBuffer === true && b !== $7aaf889172aa0226$var$Buffer.prototype // so Buffer.isBuffer(Buffer.prototype) will be false
    ;
};
$7aaf889172aa0226$var$Buffer.compare = function compare(a, b) {
    if ($7aaf889172aa0226$var$isInstance(a, Uint8Array)) a = $7aaf889172aa0226$var$Buffer.from(a, a.offset, a.byteLength);
    if ($7aaf889172aa0226$var$isInstance(b, Uint8Array)) b = $7aaf889172aa0226$var$Buffer.from(b, b.offset, b.byteLength);
    if (!$7aaf889172aa0226$var$Buffer.isBuffer(a) || !$7aaf889172aa0226$var$Buffer.isBuffer(b)) throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');
    if (a === b) return 0;
    let x = a.length;
    let y = b.length;
    for(let i = 0, len = Math.min(x, y); i < len; ++i)if (a[i] !== b[i]) {
        x = a[i];
        y = b[i];
        break;
    }
    if (x < y) return -1;
    if (y < x) return 1;
    return 0;
};
$7aaf889172aa0226$var$Buffer.isEncoding = function isEncoding(encoding) {
    switch(String(encoding).toLowerCase()){
        case 'hex':
        case 'utf8':
        case 'utf-8':
        case 'ascii':
        case 'latin1':
        case 'binary':
        case 'base64':
        case 'ucs2':
        case 'ucs-2':
        case 'utf16le':
        case 'utf-16le':
            return true;
        default:
            return false;
    }
};
$7aaf889172aa0226$var$Buffer.concat = function concat(list, length) {
    if (!Array.isArray(list)) throw new TypeError('"list" argument must be an Array of Buffers');
    if (list.length === 0) return $7aaf889172aa0226$var$Buffer.alloc(0);
    let i;
    if (length === undefined) {
        length = 0;
        for(i = 0; i < list.length; ++i)length += list[i].length;
    }
    const buffer = $7aaf889172aa0226$var$Buffer.allocUnsafe(length);
    let pos = 0;
    for(i = 0; i < list.length; ++i){
        let buf = list[i];
        if ($7aaf889172aa0226$var$isInstance(buf, Uint8Array)) {
            if (pos + buf.length > buffer.length) {
                if (!$7aaf889172aa0226$var$Buffer.isBuffer(buf)) buf = $7aaf889172aa0226$var$Buffer.from(buf);
                buf.copy(buffer, pos);
            } else Uint8Array.prototype.set.call(buffer, buf, pos);
        } else if (!$7aaf889172aa0226$var$Buffer.isBuffer(buf)) throw new TypeError('"list" argument must be an Array of Buffers');
        else buf.copy(buffer, pos);
        pos += buf.length;
    }
    return buffer;
};
function $7aaf889172aa0226$var$byteLength(string, encoding) {
    if ($7aaf889172aa0226$var$Buffer.isBuffer(string)) return string.length;
    if (ArrayBuffer.isView(string) || $7aaf889172aa0226$var$isInstance(string, ArrayBuffer)) return string.byteLength;
    if (typeof string !== 'string') throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type ' + typeof string);
    const len = string.length;
    const mustMatch = arguments.length > 2 && arguments[2] === true;
    if (!mustMatch && len === 0) return 0;
    // Use a for loop to avoid recursion
    let loweredCase = false;
    for(;;)switch(encoding){
        case 'ascii':
        case 'latin1':
        case 'binary':
            return len;
        case 'utf8':
        case 'utf-8':
            return $7aaf889172aa0226$var$utf8ToBytes(string).length;
        case 'ucs2':
        case 'ucs-2':
        case 'utf16le':
        case 'utf-16le':
            return len * 2;
        case 'hex':
            return len >>> 1;
        case 'base64':
            return $7aaf889172aa0226$var$base64ToBytes(string).length;
        default:
            if (loweredCase) return mustMatch ? -1 : $7aaf889172aa0226$var$utf8ToBytes(string).length // assume utf8
            ;
            encoding = ('' + encoding).toLowerCase();
            loweredCase = true;
    }
}
$7aaf889172aa0226$var$Buffer.byteLength = $7aaf889172aa0226$var$byteLength;
function $7aaf889172aa0226$var$slowToString(encoding, start, end) {
    let loweredCase = false;
    // No need to verify that "this.length <= MAX_UINT32" since it's a read-only
    // property of a typed array.
    // This behaves neither like String nor Uint8Array in that we set start/end
    // to their upper/lower bounds if the value passed is out of range.
    // undefined is handled specially as per ECMA-262 6th Edition,
    // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.
    if (start === undefined || start < 0) start = 0;
    // Return early if start > this.length. Done here to prevent potential uint32
    // coercion fail below.
    if (start > this.length) return '';
    if (end === undefined || end > this.length) end = this.length;
    if (end <= 0) return '';
    // Force coercion to uint32. This will also coerce falsey/NaN values to 0.
    end >>>= 0;
    start >>>= 0;
    if (end <= start) return '';
    if (!encoding) encoding = 'utf8';
    while(true)switch(encoding){
        case 'hex':
            return $7aaf889172aa0226$var$hexSlice(this, start, end);
        case 'utf8':
        case 'utf-8':
            return $7aaf889172aa0226$var$utf8Slice(this, start, end);
        case 'ascii':
            return $7aaf889172aa0226$var$asciiSlice(this, start, end);
        case 'latin1':
        case 'binary':
            return $7aaf889172aa0226$var$latin1Slice(this, start, end);
        case 'base64':
            return $7aaf889172aa0226$var$base64Slice(this, start, end);
        case 'ucs2':
        case 'ucs-2':
        case 'utf16le':
        case 'utf-16le':
            return $7aaf889172aa0226$var$utf16leSlice(this, start, end);
        default:
            if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding);
            encoding = (encoding + '').toLowerCase();
            loweredCase = true;
    }
}
// This property is used by `Buffer.isBuffer` (and the `is-buffer` npm package)
// to detect a Buffer instance. It's not possible to use `instanceof Buffer`
// reliably in a browserify context because there could be multiple different
// copies of the 'buffer' package in use. This method works even for Buffer
// instances that were created from another copy of the `buffer` package.
// See: https://github.com/feross/buffer/issues/154
$7aaf889172aa0226$var$Buffer.prototype._isBuffer = true;
function $7aaf889172aa0226$var$swap(b, n, m) {
    const i = b[n];
    b[n] = b[m];
    b[m] = i;
}
$7aaf889172aa0226$var$Buffer.prototype.swap16 = function swap16() {
    const len = this.length;
    if (len % 2 !== 0) throw new RangeError('Buffer size must be a multiple of 16-bits');
    for(let i = 0; i < len; i += 2)$7aaf889172aa0226$var$swap(this, i, i + 1);
    return this;
};
$7aaf889172aa0226$var$Buffer.prototype.swap32 = function swap32() {
    const len = this.length;
    if (len % 4 !== 0) throw new RangeError('Buffer size must be a multiple of 32-bits');
    for(let i = 0; i < len; i += 4){
        $7aaf889172aa0226$var$swap(this, i, i + 3);
        $7aaf889172aa0226$var$swap(this, i + 1, i + 2);
    }
    return this;
};
$7aaf889172aa0226$var$Buffer.prototype.swap64 = function swap64() {
    const len = this.length;
    if (len % 8 !== 0) throw new RangeError('Buffer size must be a multiple of 64-bits');
    for(let i = 0; i < len; i += 8){
        $7aaf889172aa0226$var$swap(this, i, i + 7);
        $7aaf889172aa0226$var$swap(this, i + 1, i + 6);
        $7aaf889172aa0226$var$swap(this, i + 2, i + 5);
        $7aaf889172aa0226$var$swap(this, i + 3, i + 4);
    }
    return this;
};
$7aaf889172aa0226$var$Buffer.prototype.toString = function toString() {
    const length = this.length;
    if (length === 0) return '';
    if (arguments.length === 0) return $7aaf889172aa0226$var$utf8Slice(this, 0, length);
    return $7aaf889172aa0226$var$slowToString.apply(this, arguments);
};
$7aaf889172aa0226$var$Buffer.prototype.toLocaleString = $7aaf889172aa0226$var$Buffer.prototype.toString;
$7aaf889172aa0226$var$Buffer.prototype.equals = function equals(b) {
    if (!$7aaf889172aa0226$var$Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer');
    if (this === b) return true;
    return $7aaf889172aa0226$var$Buffer.compare(this, b) === 0;
};
$7aaf889172aa0226$var$Buffer.prototype.inspect = function inspect() {
    let str = '';
    const max = $7aaf889172aa0226$export$f99ded8fe4b79145;
    str = this.toString('hex', 0, max).replace(/(.{2})/g, '$1 ').trim();
    if (this.length > max) str += ' ... ';
    return '<Buffer ' + str + '>';
};
if ($7aaf889172aa0226$var$customInspectSymbol) $7aaf889172aa0226$var$Buffer.prototype[$7aaf889172aa0226$var$customInspectSymbol] = $7aaf889172aa0226$var$Buffer.prototype.inspect;
$7aaf889172aa0226$var$Buffer.prototype.compare = function compare(target, start, end, thisStart, thisEnd) {
    if ($7aaf889172aa0226$var$isInstance(target, Uint8Array)) target = $7aaf889172aa0226$var$Buffer.from(target, target.offset, target.byteLength);
    if (!$7aaf889172aa0226$var$Buffer.isBuffer(target)) throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type ' + typeof target);
    if (start === undefined) start = 0;
    if (end === undefined) end = target ? target.length : 0;
    if (thisStart === undefined) thisStart = 0;
    if (thisEnd === undefined) thisEnd = this.length;
    if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) throw new RangeError('out of range index');
    if (thisStart >= thisEnd && start >= end) return 0;
    if (thisStart >= thisEnd) return -1;
    if (start >= end) return 1;
    start >>>= 0;
    end >>>= 0;
    thisStart >>>= 0;
    thisEnd >>>= 0;
    if (this === target) return 0;
    let x = thisEnd - thisStart;
    let y = end - start;
    const len = Math.min(x, y);
    const thisCopy = this.slice(thisStart, thisEnd);
    const targetCopy = target.slice(start, end);
    for(let i = 0; i < len; ++i)if (thisCopy[i] !== targetCopy[i]) {
        x = thisCopy[i];
        y = targetCopy[i];
        break;
    }
    if (x < y) return -1;
    if (y < x) return 1;
    return 0;
};
// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,
// OR the last index of `val` in `buffer` at offset <= `byteOffset`.
//
// Arguments:
// - buffer - a Buffer to search
// - val - a string, Buffer, or number
// - byteOffset - an index into `buffer`; will be clamped to an int32
// - encoding - an optional encoding, relevant is val is a string
// - dir - true for indexOf, false for lastIndexOf
function $7aaf889172aa0226$var$bidirectionalIndexOf(buffer, val, byteOffset, encoding, dir) {
    // Empty buffer means no match
    if (buffer.length === 0) return -1;
    // Normalize byteOffset
    if (typeof byteOffset === 'string') {
        encoding = byteOffset;
        byteOffset = 0;
    } else if (byteOffset > 0x7fffffff) byteOffset = 0x7fffffff;
    else if (byteOffset < -2147483648) byteOffset = -2147483648;
    byteOffset = +byteOffset // Coerce to Number.
    ;
    if ($7aaf889172aa0226$var$numberIsNaN(byteOffset)) // byteOffset: it it's undefined, null, NaN, "foo", etc, search whole buffer
    byteOffset = dir ? 0 : buffer.length - 1;
    // Normalize byteOffset: negative offsets start from the end of the buffer
    if (byteOffset < 0) byteOffset = buffer.length + byteOffset;
    if (byteOffset >= buffer.length) {
        if (dir) return -1;
        else byteOffset = buffer.length - 1;
    } else if (byteOffset < 0) {
        if (dir) byteOffset = 0;
        else return -1;
    }
    // Normalize val
    if (typeof val === 'string') val = $7aaf889172aa0226$var$Buffer.from(val, encoding);
    // Finally, search either indexOf (if dir is true) or lastIndexOf
    if ($7aaf889172aa0226$var$Buffer.isBuffer(val)) {
        // Special case: looking for empty string/buffer always fails
        if (val.length === 0) return -1;
        return $7aaf889172aa0226$var$arrayIndexOf(buffer, val, byteOffset, encoding, dir);
    } else if (typeof val === 'number') {
        val = val & 0xFF // Search for a byte value [0-255]
        ;
        if (typeof Uint8Array.prototype.indexOf === 'function') {
            if (dir) return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset);
            else return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset);
        }
        return $7aaf889172aa0226$var$arrayIndexOf(buffer, [
            val
        ], byteOffset, encoding, dir);
    }
    throw new TypeError('val must be string, number or Buffer');
}
function $7aaf889172aa0226$var$arrayIndexOf(arr, val, byteOffset, encoding, dir) {
    let indexSize = 1;
    let arrLength = arr.length;
    let valLength = val.length;
    if (encoding !== undefined) {
        encoding = String(encoding).toLowerCase();
        if (encoding === 'ucs2' || encoding === 'ucs-2' || encoding === 'utf16le' || encoding === 'utf-16le') {
            if (arr.length < 2 || val.length < 2) return -1;
            indexSize = 2;
            arrLength /= 2;
            valLength /= 2;
            byteOffset /= 2;
        }
    }
    function read(buf, i) {
        if (indexSize === 1) return buf[i];
        else return buf.readUInt16BE(i * indexSize);
    }
    let i;
    if (dir) {
        let foundIndex = -1;
        for(i = byteOffset; i < arrLength; i++)if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {
            if (foundIndex === -1) foundIndex = i;
            if (i - foundIndex + 1 === valLength) return foundIndex * indexSize;
        } else {
            if (foundIndex !== -1) i -= i - foundIndex;
            foundIndex = -1;
        }
    } else {
        if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength;
        for(i = byteOffset; i >= 0; i--){
            let found = true;
            for(let j = 0; j < valLength; j++)if (read(arr, i + j) !== read(val, j)) {
                found = false;
                break;
            }
            if (found) return i;
        }
    }
    return -1;
}
$7aaf889172aa0226$var$Buffer.prototype.includes = function includes(val, byteOffset, encoding) {
    return this.indexOf(val, byteOffset, encoding) !== -1;
};
$7aaf889172aa0226$var$Buffer.prototype.indexOf = function indexOf(val, byteOffset, encoding) {
    return $7aaf889172aa0226$var$bidirectionalIndexOf(this, val, byteOffset, encoding, true);
};
$7aaf889172aa0226$var$Buffer.prototype.lastIndexOf = function lastIndexOf(val, byteOffset, encoding) {
    return $7aaf889172aa0226$var$bidirectionalIndexOf(this, val, byteOffset, encoding, false);
};
function $7aaf889172aa0226$var$hexWrite(buf, string, offset, length) {
    offset = Number(offset) || 0;
    const remaining = buf.length - offset;
    if (!length) length = remaining;
    else {
        length = Number(length);
        if (length > remaining) length = remaining;
    }
    const strLen = string.length;
    if (length > strLen / 2) length = strLen / 2;
    let i;
    for(i = 0; i < length; ++i){
        const parsed = parseInt(string.substr(i * 2, 2), 16);
        if ($7aaf889172aa0226$var$numberIsNaN(parsed)) return i;
        buf[offset + i] = parsed;
    }
    return i;
}
function $7aaf889172aa0226$var$utf8Write(buf, string, offset, length) {
    return $7aaf889172aa0226$var$blitBuffer($7aaf889172aa0226$var$utf8ToBytes(string, buf.length - offset), buf, offset, length);
}
function $7aaf889172aa0226$var$asciiWrite(buf, string, offset, length) {
    return $7aaf889172aa0226$var$blitBuffer($7aaf889172aa0226$var$asciiToBytes(string), buf, offset, length);
}
function $7aaf889172aa0226$var$base64Write(buf, string, offset, length) {
    return $7aaf889172aa0226$var$blitBuffer($7aaf889172aa0226$var$base64ToBytes(string), buf, offset, length);
}
function $7aaf889172aa0226$var$ucs2Write(buf, string, offset, length) {
    return $7aaf889172aa0226$var$blitBuffer($7aaf889172aa0226$var$utf16leToBytes(string, buf.length - offset), buf, offset, length);
}
$7aaf889172aa0226$var$Buffer.prototype.write = function write(string, offset, length, encoding) {
    // Buffer#write(string)
    if (offset === undefined) {
        encoding = 'utf8';
        length = this.length;
        offset = 0;
    // Buffer#write(string, encoding)
    } else if (length === undefined && typeof offset === 'string') {
        encoding = offset;
        length = this.length;
        offset = 0;
    // Buffer#write(string, offset[, length][, encoding])
    } else if (isFinite(offset)) {
        offset = offset >>> 0;
        if (isFinite(length)) {
            length = length >>> 0;
            if (encoding === undefined) encoding = 'utf8';
        } else {
            encoding = length;
            length = undefined;
        }
    } else throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');
    const remaining = this.length - offset;
    if (length === undefined || length > remaining) length = remaining;
    if (string.length > 0 && (length < 0 || offset < 0) || offset > this.length) throw new RangeError('Attempt to write outside buffer bounds');
    if (!encoding) encoding = 'utf8';
    let loweredCase = false;
    for(;;)switch(encoding){
        case 'hex':
            return $7aaf889172aa0226$var$hexWrite(this, string, offset, length);
        case 'utf8':
        case 'utf-8':
            return $7aaf889172aa0226$var$utf8Write(this, string, offset, length);
        case 'ascii':
        case 'latin1':
        case 'binary':
            return $7aaf889172aa0226$var$asciiWrite(this, string, offset, length);
        case 'base64':
            // Warning: maxLength not taken into account in base64Write
            return $7aaf889172aa0226$var$base64Write(this, string, offset, length);
        case 'ucs2':
        case 'ucs-2':
        case 'utf16le':
        case 'utf-16le':
            return $7aaf889172aa0226$var$ucs2Write(this, string, offset, length);
        default:
            if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding);
            encoding = ('' + encoding).toLowerCase();
            loweredCase = true;
    }
};
$7aaf889172aa0226$var$Buffer.prototype.toJSON = function toJSON() {
    return {
        type: 'Buffer',
        data: Array.prototype.slice.call(this._arr || this, 0)
    };
};
function $7aaf889172aa0226$var$base64Slice(buf, start, end) {
    if (start === 0 && end === buf.length) return $023dfcfbcb75732a$export$6100ba28696e12de(buf);
    else return $023dfcfbcb75732a$export$6100ba28696e12de(buf.slice(start, end));
}
function $7aaf889172aa0226$var$utf8Slice(buf, start, end) {
    end = Math.min(buf.length, end);
    const res = [];
    let i = start;
    while(i < end){
        const firstByte = buf[i];
        let codePoint = null;
        let bytesPerSequence = firstByte > 0xEF ? 4 : firstByte > 0xDF ? 3 : firstByte > 0xBF ? 2 : 1;
        if (i + bytesPerSequence <= end) {
            let secondByte, thirdByte, fourthByte, tempCodePoint;
            switch(bytesPerSequence){
                case 1:
                    if (firstByte < 0x80) codePoint = firstByte;
                    break;
                case 2:
                    secondByte = buf[i + 1];
                    if ((secondByte & 0xC0) === 0x80) {
                        tempCodePoint = (firstByte & 0x1F) << 0x6 | secondByte & 0x3F;
                        if (tempCodePoint > 0x7F) codePoint = tempCodePoint;
                    }
                    break;
                case 3:
                    secondByte = buf[i + 1];
                    thirdByte = buf[i + 2];
                    if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {
                        tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | thirdByte & 0x3F;
                        if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) codePoint = tempCodePoint;
                    }
                    break;
                case 4:
                    secondByte = buf[i + 1];
                    thirdByte = buf[i + 2];
                    fourthByte = buf[i + 3];
                    if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {
                        tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | fourthByte & 0x3F;
                        if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) codePoint = tempCodePoint;
                    }
            }
        }
        if (codePoint === null) {
            // we did not generate a valid codePoint so insert a
            // replacement char (U+FFFD) and advance only 1 byte
            codePoint = 0xFFFD;
            bytesPerSequence = 1;
        } else if (codePoint > 0xFFFF) {
            // encode to utf16 (surrogate pair dance)
            codePoint -= 0x10000;
            res.push(codePoint >>> 10 & 0x3FF | 0xD800);
            codePoint = 0xDC00 | codePoint & 0x3FF;
        }
        res.push(codePoint);
        i += bytesPerSequence;
    }
    return $7aaf889172aa0226$var$decodeCodePointsArray(res);
}
// Based on http://stackoverflow.com/a/22747272/680742, the browser with
// the lowest limit is Chrome, with 0x10000 args.
// We go 1 magnitude less, for safety
const $7aaf889172aa0226$var$MAX_ARGUMENTS_LENGTH = 0x1000;
function $7aaf889172aa0226$var$decodeCodePointsArray(codePoints) {
    const len = codePoints.length;
    if (len <= $7aaf889172aa0226$var$MAX_ARGUMENTS_LENGTH) return String.fromCharCode.apply(String, codePoints) // avoid extra slice()
    ;
    // Decode in chunks to avoid "call stack size exceeded".
    let res = '';
    let i = 0;
    while(i < len)res += String.fromCharCode.apply(String, codePoints.slice(i, i += $7aaf889172aa0226$var$MAX_ARGUMENTS_LENGTH));
    return res;
}
function $7aaf889172aa0226$var$asciiSlice(buf, start, end) {
    let ret = '';
    end = Math.min(buf.length, end);
    for(let i = start; i < end; ++i)ret += String.fromCharCode(buf[i] & 0x7F);
    return ret;
}
function $7aaf889172aa0226$var$latin1Slice(buf, start, end) {
    let ret = '';
    end = Math.min(buf.length, end);
    for(let i = start; i < end; ++i)ret += String.fromCharCode(buf[i]);
    return ret;
}
function $7aaf889172aa0226$var$hexSlice(buf, start, end) {
    const len = buf.length;
    if (!start || start < 0) start = 0;
    if (!end || end < 0 || end > len) end = len;
    let out = '';
    for(let i = start; i < end; ++i)out += $7aaf889172aa0226$var$hexSliceLookupTable[buf[i]];
    return out;
}
function $7aaf889172aa0226$var$utf16leSlice(buf, start, end) {
    const bytes = buf.slice(start, end);
    let res = '';
    // If bytes.length is odd, the last 8 bits must be ignored (same as node.js)
    for(let i = 0; i < bytes.length - 1; i += 2)res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256);
    return res;
}
$7aaf889172aa0226$var$Buffer.prototype.slice = function slice(start, end) {
    const len = this.length;
    start = ~~start;
    end = end === undefined ? len : ~~end;
    if (start < 0) {
        start += len;
        if (start < 0) start = 0;
    } else if (start > len) start = len;
    if (end < 0) {
        end += len;
        if (end < 0) end = 0;
    } else if (end > len) end = len;
    if (end < start) end = start;
    const newBuf = this.subarray(start, end);
    // Return an augmented `Uint8Array` instance
    Object.setPrototypeOf(newBuf, $7aaf889172aa0226$var$Buffer.prototype);
    return newBuf;
};
/*
 * Need to make sure that buffer isn't trying to write out of bounds.
 */ function $7aaf889172aa0226$var$checkOffset(offset, ext, length) {
    if (offset % 1 !== 0 || offset < 0) throw new RangeError('offset is not uint');
    if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length');
}
$7aaf889172aa0226$var$Buffer.prototype.readUintLE = $7aaf889172aa0226$var$Buffer.prototype.readUIntLE = function readUIntLE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, byteLength, this.length);
    let val = this[offset];
    let mul = 1;
    let i = 0;
    while(++i < byteLength && (mul *= 0x100))val += this[offset + i] * mul;
    return val;
};
$7aaf889172aa0226$var$Buffer.prototype.readUintBE = $7aaf889172aa0226$var$Buffer.prototype.readUIntBE = function readUIntBE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, byteLength, this.length);
    let val = this[offset + --byteLength];
    let mul = 1;
    while(byteLength > 0 && (mul *= 0x100))val += this[offset + --byteLength] * mul;
    return val;
};
$7aaf889172aa0226$var$Buffer.prototype.readUint8 = $7aaf889172aa0226$var$Buffer.prototype.readUInt8 = function readUInt8(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 1, this.length);
    return this[offset];
};
$7aaf889172aa0226$var$Buffer.prototype.readUint16LE = $7aaf889172aa0226$var$Buffer.prototype.readUInt16LE = function readUInt16LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 2, this.length);
    return this[offset] | this[offset + 1] << 8;
};
$7aaf889172aa0226$var$Buffer.prototype.readUint16BE = $7aaf889172aa0226$var$Buffer.prototype.readUInt16BE = function readUInt16BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 2, this.length);
    return this[offset] << 8 | this[offset + 1];
};
$7aaf889172aa0226$var$Buffer.prototype.readUint32LE = $7aaf889172aa0226$var$Buffer.prototype.readUInt32LE = function readUInt32LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 4, this.length);
    return (this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16) + this[offset + 3] * 0x1000000;
};
$7aaf889172aa0226$var$Buffer.prototype.readUint32BE = $7aaf889172aa0226$var$Buffer.prototype.readUInt32BE = function readUInt32BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 4, this.length);
    return this[offset] * 0x1000000 + (this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3]);
};
$7aaf889172aa0226$var$Buffer.prototype.readBigUInt64LE = $7aaf889172aa0226$var$defineBigIntMethod(function readBigUInt64LE(offset) {
    offset = offset >>> 0;
    $7aaf889172aa0226$var$validateNumber(offset, 'offset');
    const first = this[offset];
    const last = this[offset + 7];
    if (first === undefined || last === undefined) $7aaf889172aa0226$var$boundsError(offset, this.length - 8);
    const lo = first + this[++offset] * 256 + this[++offset] * 2 ** 16 + this[++offset] * 2 ** 24;
    const hi = this[++offset] + this[++offset] * 256 + this[++offset] * 2 ** 16 + last * 2 ** 24;
    return BigInt(lo) + (BigInt(hi) << BigInt(32));
});
$7aaf889172aa0226$var$Buffer.prototype.readBigUInt64BE = $7aaf889172aa0226$var$defineBigIntMethod(function readBigUInt64BE(offset) {
    offset = offset >>> 0;
    $7aaf889172aa0226$var$validateNumber(offset, 'offset');
    const first = this[offset];
    const last = this[offset + 7];
    if (first === undefined || last === undefined) $7aaf889172aa0226$var$boundsError(offset, this.length - 8);
    const hi = first * 2 ** 24 + this[++offset] * 2 ** 16 + this[++offset] * 256 + this[++offset];
    const lo = this[++offset] * 2 ** 24 + this[++offset] * 2 ** 16 + this[++offset] * 256 + last;
    return (BigInt(hi) << BigInt(32)) + BigInt(lo);
});
$7aaf889172aa0226$var$Buffer.prototype.readIntLE = function readIntLE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, byteLength, this.length);
    let val = this[offset];
    let mul = 1;
    let i = 0;
    while(++i < byteLength && (mul *= 0x100))val += this[offset + i] * mul;
    mul *= 0x80;
    if (val >= mul) val -= Math.pow(2, 8 * byteLength);
    return val;
};
$7aaf889172aa0226$var$Buffer.prototype.readIntBE = function readIntBE(offset, byteLength, noAssert) {
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, byteLength, this.length);
    let i = byteLength;
    let mul = 1;
    let val = this[offset + --i];
    while(i > 0 && (mul *= 0x100))val += this[offset + --i] * mul;
    mul *= 0x80;
    if (val >= mul) val -= Math.pow(2, 8 * byteLength);
    return val;
};
$7aaf889172aa0226$var$Buffer.prototype.readInt8 = function readInt8(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 1, this.length);
    if (!(this[offset] & 0x80)) return this[offset];
    return (0xff - this[offset] + 1) * -1;
};
$7aaf889172aa0226$var$Buffer.prototype.readInt16LE = function readInt16LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 2, this.length);
    const val = this[offset] | this[offset + 1] << 8;
    return val & 0x8000 ? val | 0xFFFF0000 : val;
};
$7aaf889172aa0226$var$Buffer.prototype.readInt16BE = function readInt16BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 2, this.length);
    const val = this[offset + 1] | this[offset] << 8;
    return val & 0x8000 ? val | 0xFFFF0000 : val;
};
$7aaf889172aa0226$var$Buffer.prototype.readInt32LE = function readInt32LE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 4, this.length);
    return this[offset] | this[offset + 1] << 8 | this[offset + 2] << 16 | this[offset + 3] << 24;
};
$7aaf889172aa0226$var$Buffer.prototype.readInt32BE = function readInt32BE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 4, this.length);
    return this[offset] << 24 | this[offset + 1] << 16 | this[offset + 2] << 8 | this[offset + 3];
};
$7aaf889172aa0226$var$Buffer.prototype.readBigInt64LE = $7aaf889172aa0226$var$defineBigIntMethod(function readBigInt64LE(offset) {
    offset = offset >>> 0;
    $7aaf889172aa0226$var$validateNumber(offset, 'offset');
    const first = this[offset];
    const last = this[offset + 7];
    if (first === undefined || last === undefined) $7aaf889172aa0226$var$boundsError(offset, this.length - 8);
    const val = this[offset + 4] + this[offset + 5] * 256 + this[offset + 6] * 2 ** 16 + (last << 24 // Overflow
    );
    return (BigInt(val) << BigInt(32)) + BigInt(first + this[++offset] * 256 + this[++offset] * 2 ** 16 + this[++offset] * 2 ** 24);
});
$7aaf889172aa0226$var$Buffer.prototype.readBigInt64BE = $7aaf889172aa0226$var$defineBigIntMethod(function readBigInt64BE(offset) {
    offset = offset >>> 0;
    $7aaf889172aa0226$var$validateNumber(offset, 'offset');
    const first = this[offset];
    const last = this[offset + 7];
    if (first === undefined || last === undefined) $7aaf889172aa0226$var$boundsError(offset, this.length - 8);
    const val = (first << 24) + // Overflow
    this[++offset] * 2 ** 16 + this[++offset] * 256 + this[++offset];
    return (BigInt(val) << BigInt(32)) + BigInt(this[++offset] * 2 ** 24 + this[++offset] * 2 ** 16 + this[++offset] * 256 + last);
});
$7aaf889172aa0226$var$Buffer.prototype.readFloatLE = function readFloatLE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 4, this.length);
    return $b38ea80d59ab0cdb$export$aafa59e2e03f2942(this, offset, true, 23, 4);
};
$7aaf889172aa0226$var$Buffer.prototype.readFloatBE = function readFloatBE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 4, this.length);
    return $b38ea80d59ab0cdb$export$aafa59e2e03f2942(this, offset, false, 23, 4);
};
$7aaf889172aa0226$var$Buffer.prototype.readDoubleLE = function readDoubleLE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 8, this.length);
    return $b38ea80d59ab0cdb$export$aafa59e2e03f2942(this, offset, true, 52, 8);
};
$7aaf889172aa0226$var$Buffer.prototype.readDoubleBE = function readDoubleBE(offset, noAssert) {
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkOffset(offset, 8, this.length);
    return $b38ea80d59ab0cdb$export$aafa59e2e03f2942(this, offset, false, 52, 8);
};
function $7aaf889172aa0226$var$checkInt(buf, value, offset, ext, max, min) {
    if (!$7aaf889172aa0226$var$Buffer.isBuffer(buf)) throw new TypeError('"buffer" argument must be a Buffer instance');
    if (value > max || value < min) throw new RangeError('"value" argument is out of bounds');
    if (offset + ext > buf.length) throw new RangeError('Index out of range');
}
$7aaf889172aa0226$var$Buffer.prototype.writeUintLE = $7aaf889172aa0226$var$Buffer.prototype.writeUIntLE = function writeUIntLE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) {
        const maxBytes = Math.pow(2, 8 * byteLength) - 1;
        $7aaf889172aa0226$var$checkInt(this, value, offset, byteLength, maxBytes, 0);
    }
    let mul = 1;
    let i = 0;
    this[offset] = value & 0xFF;
    while(++i < byteLength && (mul *= 0x100))this[offset + i] = value / mul & 0xFF;
    return offset + byteLength;
};
$7aaf889172aa0226$var$Buffer.prototype.writeUintBE = $7aaf889172aa0226$var$Buffer.prototype.writeUIntBE = function writeUIntBE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;
    byteLength = byteLength >>> 0;
    if (!noAssert) {
        const maxBytes = Math.pow(2, 8 * byteLength) - 1;
        $7aaf889172aa0226$var$checkInt(this, value, offset, byteLength, maxBytes, 0);
    }
    let i = byteLength - 1;
    let mul = 1;
    this[offset + i] = value & 0xFF;
    while(--i >= 0 && (mul *= 0x100))this[offset + i] = value / mul & 0xFF;
    return offset + byteLength;
};
$7aaf889172aa0226$var$Buffer.prototype.writeUint8 = $7aaf889172aa0226$var$Buffer.prototype.writeUInt8 = function writeUInt8(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 1, 0xff, 0);
    this[offset] = value & 0xff;
    return offset + 1;
};
$7aaf889172aa0226$var$Buffer.prototype.writeUint16LE = $7aaf889172aa0226$var$Buffer.prototype.writeUInt16LE = function writeUInt16LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 2, 0xffff, 0);
    this[offset] = value & 0xff;
    this[offset + 1] = value >>> 8;
    return offset + 2;
};
$7aaf889172aa0226$var$Buffer.prototype.writeUint16BE = $7aaf889172aa0226$var$Buffer.prototype.writeUInt16BE = function writeUInt16BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 2, 0xffff, 0);
    this[offset] = value >>> 8;
    this[offset + 1] = value & 0xff;
    return offset + 2;
};
$7aaf889172aa0226$var$Buffer.prototype.writeUint32LE = $7aaf889172aa0226$var$Buffer.prototype.writeUInt32LE = function writeUInt32LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 4, 0xffffffff, 0);
    this[offset + 3] = value >>> 24;
    this[offset + 2] = value >>> 16;
    this[offset + 1] = value >>> 8;
    this[offset] = value & 0xff;
    return offset + 4;
};
$7aaf889172aa0226$var$Buffer.prototype.writeUint32BE = $7aaf889172aa0226$var$Buffer.prototype.writeUInt32BE = function writeUInt32BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 4, 0xffffffff, 0);
    this[offset] = value >>> 24;
    this[offset + 1] = value >>> 16;
    this[offset + 2] = value >>> 8;
    this[offset + 3] = value & 0xff;
    return offset + 4;
};
function $7aaf889172aa0226$var$wrtBigUInt64LE(buf, value, offset, min, max) {
    $7aaf889172aa0226$var$checkIntBI(value, min, max, buf, offset, 7);
    let lo = Number(value & BigInt(0xffffffff));
    buf[offset++] = lo;
    lo = lo >> 8;
    buf[offset++] = lo;
    lo = lo >> 8;
    buf[offset++] = lo;
    lo = lo >> 8;
    buf[offset++] = lo;
    let hi = Number(value >> BigInt(32) & BigInt(0xffffffff));
    buf[offset++] = hi;
    hi = hi >> 8;
    buf[offset++] = hi;
    hi = hi >> 8;
    buf[offset++] = hi;
    hi = hi >> 8;
    buf[offset++] = hi;
    return offset;
}
function $7aaf889172aa0226$var$wrtBigUInt64BE(buf, value, offset, min, max) {
    $7aaf889172aa0226$var$checkIntBI(value, min, max, buf, offset, 7);
    let lo = Number(value & BigInt(0xffffffff));
    buf[offset + 7] = lo;
    lo = lo >> 8;
    buf[offset + 6] = lo;
    lo = lo >> 8;
    buf[offset + 5] = lo;
    lo = lo >> 8;
    buf[offset + 4] = lo;
    let hi = Number(value >> BigInt(32) & BigInt(0xffffffff));
    buf[offset + 3] = hi;
    hi = hi >> 8;
    buf[offset + 2] = hi;
    hi = hi >> 8;
    buf[offset + 1] = hi;
    hi = hi >> 8;
    buf[offset] = hi;
    return offset + 8;
}
$7aaf889172aa0226$var$Buffer.prototype.writeBigUInt64LE = $7aaf889172aa0226$var$defineBigIntMethod(function writeBigUInt64LE(value, offset = 0) {
    return $7aaf889172aa0226$var$wrtBigUInt64LE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'));
});
$7aaf889172aa0226$var$Buffer.prototype.writeBigUInt64BE = $7aaf889172aa0226$var$defineBigIntMethod(function writeBigUInt64BE(value, offset = 0) {
    return $7aaf889172aa0226$var$wrtBigUInt64BE(this, value, offset, BigInt(0), BigInt('0xffffffffffffffff'));
});
$7aaf889172aa0226$var$Buffer.prototype.writeIntLE = function writeIntLE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) {
        const limit = Math.pow(2, 8 * byteLength - 1);
        $7aaf889172aa0226$var$checkInt(this, value, offset, byteLength, limit - 1, -limit);
    }
    let i = 0;
    let mul = 1;
    let sub = 0;
    this[offset] = value & 0xFF;
    while(++i < byteLength && (mul *= 0x100)){
        if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) sub = 1;
        this[offset + i] = (value / mul >> 0) - sub & 0xFF;
    }
    return offset + byteLength;
};
$7aaf889172aa0226$var$Buffer.prototype.writeIntBE = function writeIntBE(value, offset, byteLength, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) {
        const limit = Math.pow(2, 8 * byteLength - 1);
        $7aaf889172aa0226$var$checkInt(this, value, offset, byteLength, limit - 1, -limit);
    }
    let i = byteLength - 1;
    let mul = 1;
    let sub = 0;
    this[offset + i] = value & 0xFF;
    while(--i >= 0 && (mul *= 0x100)){
        if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) sub = 1;
        this[offset + i] = (value / mul >> 0) - sub & 0xFF;
    }
    return offset + byteLength;
};
$7aaf889172aa0226$var$Buffer.prototype.writeInt8 = function writeInt8(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 1, 0x7f, -128);
    if (value < 0) value = 0xff + value + 1;
    this[offset] = value & 0xff;
    return offset + 1;
};
$7aaf889172aa0226$var$Buffer.prototype.writeInt16LE = function writeInt16LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 2, 0x7fff, -32768);
    this[offset] = value & 0xff;
    this[offset + 1] = value >>> 8;
    return offset + 2;
};
$7aaf889172aa0226$var$Buffer.prototype.writeInt16BE = function writeInt16BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 2, 0x7fff, -32768);
    this[offset] = value >>> 8;
    this[offset + 1] = value & 0xff;
    return offset + 2;
};
$7aaf889172aa0226$var$Buffer.prototype.writeInt32LE = function writeInt32LE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 4, 0x7fffffff, -2147483648);
    this[offset] = value & 0xff;
    this[offset + 1] = value >>> 8;
    this[offset + 2] = value >>> 16;
    this[offset + 3] = value >>> 24;
    return offset + 4;
};
$7aaf889172aa0226$var$Buffer.prototype.writeInt32BE = function writeInt32BE(value, offset, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkInt(this, value, offset, 4, 0x7fffffff, -2147483648);
    if (value < 0) value = 0xffffffff + value + 1;
    this[offset] = value >>> 24;
    this[offset + 1] = value >>> 16;
    this[offset + 2] = value >>> 8;
    this[offset + 3] = value & 0xff;
    return offset + 4;
};
$7aaf889172aa0226$var$Buffer.prototype.writeBigInt64LE = $7aaf889172aa0226$var$defineBigIntMethod(function writeBigInt64LE(value, offset = 0) {
    return $7aaf889172aa0226$var$wrtBigUInt64LE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'));
});
$7aaf889172aa0226$var$Buffer.prototype.writeBigInt64BE = $7aaf889172aa0226$var$defineBigIntMethod(function writeBigInt64BE(value, offset = 0) {
    return $7aaf889172aa0226$var$wrtBigUInt64BE(this, value, offset, -BigInt('0x8000000000000000'), BigInt('0x7fffffffffffffff'));
});
function $7aaf889172aa0226$var$checkIEEE754(buf, value, offset, ext, max, min) {
    if (offset + ext > buf.length) throw new RangeError('Index out of range');
    if (offset < 0) throw new RangeError('Index out of range');
}
function $7aaf889172aa0226$var$writeFloat(buf, value, offset, littleEndian, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -340282346638528860000000000000000000000);
    $b38ea80d59ab0cdb$export$68d8715fc104d294(buf, value, offset, littleEndian, 23, 4);
    return offset + 4;
}
$7aaf889172aa0226$var$Buffer.prototype.writeFloatLE = function writeFloatLE(value, offset, noAssert) {
    return $7aaf889172aa0226$var$writeFloat(this, value, offset, true, noAssert);
};
$7aaf889172aa0226$var$Buffer.prototype.writeFloatBE = function writeFloatBE(value, offset, noAssert) {
    return $7aaf889172aa0226$var$writeFloat(this, value, offset, false, noAssert);
};
function $7aaf889172aa0226$var$writeDouble(buf, value, offset, littleEndian, noAssert) {
    value = +value;
    offset = offset >>> 0;
    if (!noAssert) $7aaf889172aa0226$var$checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000);
    $b38ea80d59ab0cdb$export$68d8715fc104d294(buf, value, offset, littleEndian, 52, 8);
    return offset + 8;
}
$7aaf889172aa0226$var$Buffer.prototype.writeDoubleLE = function writeDoubleLE(value, offset, noAssert) {
    return $7aaf889172aa0226$var$writeDouble(this, value, offset, true, noAssert);
};
$7aaf889172aa0226$var$Buffer.prototype.writeDoubleBE = function writeDoubleBE(value, offset, noAssert) {
    return $7aaf889172aa0226$var$writeDouble(this, value, offset, false, noAssert);
};
// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)
$7aaf889172aa0226$var$Buffer.prototype.copy = function copy(target, targetStart, start, end) {
    if (!$7aaf889172aa0226$var$Buffer.isBuffer(target)) throw new TypeError('argument should be a Buffer');
    if (!start) start = 0;
    if (!end && end !== 0) end = this.length;
    if (targetStart >= target.length) targetStart = target.length;
    if (!targetStart) targetStart = 0;
    if (end > 0 && end < start) end = start;
    // Copy 0 bytes; we're done
    if (end === start) return 0;
    if (target.length === 0 || this.length === 0) return 0;
    // Fatal error conditions
    if (targetStart < 0) throw new RangeError('targetStart out of bounds');
    if (start < 0 || start >= this.length) throw new RangeError('Index out of range');
    if (end < 0) throw new RangeError('sourceEnd out of bounds');
    // Are we oob?
    if (end > this.length) end = this.length;
    if (target.length - targetStart < end - start) end = target.length - targetStart + start;
    const len = end - start;
    if (this === target && typeof Uint8Array.prototype.copyWithin === 'function') // Use built-in when available, missing from IE11
    this.copyWithin(targetStart, start, end);
    else Uint8Array.prototype.set.call(target, this.subarray(start, end), targetStart);
    return len;
};
// Usage:
//    buffer.fill(number[, offset[, end]])
//    buffer.fill(buffer[, offset[, end]])
//    buffer.fill(string[, offset[, end]][, encoding])
$7aaf889172aa0226$var$Buffer.prototype.fill = function fill(val, start, end, encoding) {
    // Handle string cases:
    if (typeof val === 'string') {
        if (typeof start === 'string') {
            encoding = start;
            start = 0;
            end = this.length;
        } else if (typeof end === 'string') {
            encoding = end;
            end = this.length;
        }
        if (encoding !== undefined && typeof encoding !== 'string') throw new TypeError('encoding must be a string');
        if (typeof encoding === 'string' && !$7aaf889172aa0226$var$Buffer.isEncoding(encoding)) throw new TypeError('Unknown encoding: ' + encoding);
        if (val.length === 1) {
            const code = val.charCodeAt(0);
            if (encoding === 'utf8' && code < 128 || encoding === 'latin1') // Fast path: If `val` fits into a single byte, use that numeric value.
            val = code;
        }
    } else if (typeof val === 'number') val = val & 255;
    else if (typeof val === 'boolean') val = Number(val);
    // Invalid ranges are not set to a default, so can range check early.
    if (start < 0 || this.length < start || this.length < end) throw new RangeError('Out of range index');
    if (end <= start) return this;
    start = start >>> 0;
    end = end === undefined ? this.length : end >>> 0;
    if (!val) val = 0;
    let i;
    if (typeof val === 'number') for(i = start; i < end; ++i)this[i] = val;
    else {
        const bytes = $7aaf889172aa0226$var$Buffer.isBuffer(val) ? val : $7aaf889172aa0226$var$Buffer.from(val, encoding);
        const len = bytes.length;
        if (len === 0) throw new TypeError('The value "' + val + '" is invalid for argument "value"');
        for(i = 0; i < end - start; ++i)this[i + start] = bytes[i % len];
    }
    return this;
};
// CUSTOM ERRORS
// =============
// Simplified versions from Node, changed for Buffer-only usage
const $7aaf889172aa0226$var$errors = {};
function $7aaf889172aa0226$var$E(sym, getMessage, Base) {
    $7aaf889172aa0226$var$errors[sym] = class NodeError extends Base {
        constructor(){
            super();
            Object.defineProperty(this, 'message', {
                value: getMessage.apply(this, arguments),
                writable: true,
                configurable: true
            });
            // Add the error code to the name to include it in the stack trace.
            this.name = `${this.name} [${sym}]`;
            // Access the stack to generate the error message including the error code
            // from the name.
            this.stack // eslint-disable-line no-unused-expressions
            ;
            // Reset the name to the actual name.
            delete this.name;
        }
        get code() {
            return sym;
        }
        set code(value) {
            Object.defineProperty(this, 'code', {
                configurable: true,
                enumerable: true,
                value: value,
                writable: true
            });
        }
        toString() {
            return `${this.name} [${sym}]: ${this.message}`;
        }
    };
}
$7aaf889172aa0226$var$E('ERR_BUFFER_OUT_OF_BOUNDS', function(name) {
    if (name) return `${name} is outside of buffer bounds`;
    return 'Attempt to access memory outside buffer bounds';
}, RangeError);
$7aaf889172aa0226$var$E('ERR_INVALID_ARG_TYPE', function(name, actual) {
    return `The "${name}" argument must be of type number. Received type ${typeof actual}`;
}, TypeError);
$7aaf889172aa0226$var$E('ERR_OUT_OF_RANGE', function(str, range, input) {
    let msg = `The value of "${str}" is out of range.`;
    let received = input;
    if (Number.isInteger(input) && Math.abs(input) > 2 ** 32) received = $7aaf889172aa0226$var$addNumericalSeparator(String(input));
    else if (typeof input === 'bigint') {
        received = String(input);
        if (input > BigInt(2) ** BigInt(32) || input < -(BigInt(2) ** BigInt(32))) received = $7aaf889172aa0226$var$addNumericalSeparator(received);
        received += 'n';
    }
    msg += ` It must be ${range}. Received ${received}`;
    return msg;
}, RangeError);
function $7aaf889172aa0226$var$addNumericalSeparator(val) {
    let res = '';
    let i = val.length;
    const start = val[0] === '-' ? 1 : 0;
    for(; i >= start + 4; i -= 3)res = `_${val.slice(i - 3, i)}${res}`;
    return `${val.slice(0, i)}${res}`;
}
// CHECK FUNCTIONS
// ===============
function $7aaf889172aa0226$var$checkBounds(buf, offset, byteLength) {
    $7aaf889172aa0226$var$validateNumber(offset, 'offset');
    if (buf[offset] === undefined || buf[offset + byteLength] === undefined) $7aaf889172aa0226$var$boundsError(offset, buf.length - (byteLength + 1));
}
function $7aaf889172aa0226$var$checkIntBI(value, min, max, buf, offset, byteLength) {
    if (value > max || value < min) {
        const n = typeof min === 'bigint' ? 'n' : '';
        let range;
        if (byteLength > 3) {
            if (min === 0 || min === BigInt(0)) range = `>= 0${n} and < 2${n} ** ${(byteLength + 1) * 8}${n}`;
            else range = `>= -(2${n} ** ${(byteLength + 1) * 8 - 1}${n}) and < 2 ** ` + `${(byteLength + 1) * 8 - 1}${n}`;
        } else range = `>= ${min}${n} and <= ${max}${n}`;
        throw new $7aaf889172aa0226$var$errors.ERR_OUT_OF_RANGE('value', range, value);
    }
    $7aaf889172aa0226$var$checkBounds(buf, offset, byteLength);
}
function $7aaf889172aa0226$var$validateNumber(value, name) {
    if (typeof value !== 'number') throw new $7aaf889172aa0226$var$errors.ERR_INVALID_ARG_TYPE(name, 'number', value);
}
function $7aaf889172aa0226$var$boundsError(value, length, type) {
    if (Math.floor(value) !== value) {
        $7aaf889172aa0226$var$validateNumber(value, type);
        throw new $7aaf889172aa0226$var$errors.ERR_OUT_OF_RANGE(type || 'offset', 'an integer', value);
    }
    if (length < 0) throw new $7aaf889172aa0226$var$errors.ERR_BUFFER_OUT_OF_BOUNDS();
    throw new $7aaf889172aa0226$var$errors.ERR_OUT_OF_RANGE(type || 'offset', `>= ${type ? 1 : 0} and <= ${length}`, value);
}
// HELPER FUNCTIONS
// ================
const $7aaf889172aa0226$var$INVALID_BASE64_RE = /[^+/0-9A-Za-z-_]/g;
function $7aaf889172aa0226$var$base64clean(str) {
    // Node takes equal signs as end of the Base64 encoding
    str = str.split('=')[0];
    // Node strips out invalid characters like \n and \t from the string, base64-js does not
    str = str.trim().replace($7aaf889172aa0226$var$INVALID_BASE64_RE, '');
    // Node converts strings with length < 2 to ''
    if (str.length < 2) return '';
    // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not
    while(str.length % 4 !== 0)str = str + '=';
    return str;
}
function $7aaf889172aa0226$var$utf8ToBytes(string, units) {
    units = units || Infinity;
    let codePoint;
    const length = string.length;
    let leadSurrogate = null;
    const bytes = [];
    for(let i = 0; i < length; ++i){
        codePoint = string.charCodeAt(i);
        // is surrogate component
        if (codePoint > 0xD7FF && codePoint < 0xE000) {
            // last char was a lead
            if (!leadSurrogate) {
                // no lead yet
                if (codePoint > 0xDBFF) {
                    // unexpected trail
                    if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
                    continue;
                } else if (i + 1 === length) {
                    // unpaired lead
                    if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
                    continue;
                }
                // valid lead
                leadSurrogate = codePoint;
                continue;
            }
            // 2 leads in a row
            if (codePoint < 0xDC00) {
                if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
                leadSurrogate = codePoint;
                continue;
            }
            // valid surrogate pair
            codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000;
        } else if (leadSurrogate) // valid bmp char, but last char was a lead
        {
            if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD);
        }
        leadSurrogate = null;
        // encode utf8
        if (codePoint < 0x80) {
            if ((units -= 1) < 0) break;
            bytes.push(codePoint);
        } else if (codePoint < 0x800) {
            if ((units -= 2) < 0) break;
            bytes.push(codePoint >> 0x6 | 0xC0, codePoint & 0x3F | 0x80);
        } else if (codePoint < 0x10000) {
            if ((units -= 3) < 0) break;
            bytes.push(codePoint >> 0xC | 0xE0, codePoint >> 0x6 & 0x3F | 0x80, codePoint & 0x3F | 0x80);
        } else if (codePoint < 0x110000) {
            if ((units -= 4) < 0) break;
            bytes.push(codePoint >> 0x12 | 0xF0, codePoint >> 0xC & 0x3F | 0x80, codePoint >> 0x6 & 0x3F | 0x80, codePoint & 0x3F | 0x80);
        } else throw new Error('Invalid code point');
    }
    return bytes;
}
function $7aaf889172aa0226$var$asciiToBytes(str) {
    const byteArray = [];
    for(let i = 0; i < str.length; ++i)// Node's code seems to be doing this and not & 0x7F..
    byteArray.push(str.charCodeAt(i) & 0xFF);
    return byteArray;
}
function $7aaf889172aa0226$var$utf16leToBytes(str, units) {
    let c, hi, lo;
    const byteArray = [];
    for(let i = 0; i < str.length; ++i){
        if ((units -= 2) < 0) break;
        c = str.charCodeAt(i);
        hi = c >> 8;
        lo = c % 256;
        byteArray.push(lo);
        byteArray.push(hi);
    }
    return byteArray;
}
function $7aaf889172aa0226$var$base64ToBytes(str) {
    return $023dfcfbcb75732a$export$d622b2ad8d90c771($7aaf889172aa0226$var$base64clean(str));
}
function $7aaf889172aa0226$var$blitBuffer(src, dst, offset, length) {
    let i;
    for(i = 0; i < length; ++i){
        if (i + offset >= dst.length || i >= src.length) break;
        dst[i + offset] = src[i];
    }
    return i;
}
// ArrayBuffer or Uint8Array objects from other contexts (i.e. iframes) do not pass
// the `instanceof` check but they should be treated as of that type.
// See: https://github.com/feross/buffer/issues/166
function $7aaf889172aa0226$var$isInstance(obj, type) {
    return obj instanceof type || obj != null && obj.constructor != null && obj.constructor.name != null && obj.constructor.name === type.name;
}
function $7aaf889172aa0226$var$numberIsNaN(obj) {
    // For IE11 support
    return obj !== obj // eslint-disable-line no-self-compare
    ;
}
// Create lookup table for `toString('hex')`
// See: https://github.com/feross/buffer/issues/219
const $7aaf889172aa0226$var$hexSliceLookupTable = function() {
    const alphabet = '0123456789abcdef';
    const table = new Array(256);
    for(let i = 0; i < 16; ++i){
        const i16 = i * 16;
        for(let j = 0; j < 16; ++j)table[i16 + j] = alphabet[i] + alphabet[j];
    }
    return table;
}();
// Return not function with Error if BigInt not supported
function $7aaf889172aa0226$var$defineBigIntMethod(fn) {
    return typeof BigInt === 'undefined' ? $7aaf889172aa0226$var$BufferBigIntNotDefined : fn;
}
function $7aaf889172aa0226$var$BufferBigIntNotDefined() {
    throw new Error('BigInt not supported');
}


var $5315c5b824bb5181$require$Buffer = $7aaf889172aa0226$export$a143d493d941bafc;
const $5315c5b824bb5181$export$79a0c4c40eecffbb = (len)=>new Uint8Array(len);
const $5315c5b824bb5181$export$f3c8b5f6d250ec43 = (buffer, byteOffset, length)=>new Uint8Array(buffer, byteOffset, length);
const $5315c5b824bb5181$export$1b999ddd54e5bed1 = (buffer)=>new Uint8Array(buffer);
/* c8 ignore start */ /**
 * @param {Uint8Array} bytes
 * @return {string}
 */ const $5315c5b824bb5181$var$toBase64Browser = (bytes)=>{
    let s = '';
    for(let i = 0; i < bytes.byteLength; i++)s += $83a4db9bed1df563$export$30216c0101da0ee0(bytes[i]);
    // eslint-disable-next-line no-undef
    return btoa(s);
};
/* c8 ignore stop */ /**
 * @param {Uint8Array} bytes
 * @return {string}
 */ const $5315c5b824bb5181$var$toBase64Node = (bytes)=>$5315c5b824bb5181$require$Buffer.from(bytes.buffer, bytes.byteOffset, bytes.byteLength).toString('base64');
/* c8 ignore start */ /**
 * @param {string} s
 * @return {Uint8Array}
 */ const $5315c5b824bb5181$var$fromBase64Browser = (s)=>{
    // eslint-disable-next-line no-undef
    const a = atob(s);
    const bytes = $5315c5b824bb5181$export$79a0c4c40eecffbb(a.length);
    for(let i = 0; i < a.length; i++)bytes[i] = a.charCodeAt(i);
    return bytes;
};
/* c8 ignore stop */ /**
 * @param {string} s
 */ const $5315c5b824bb5181$var$fromBase64Node = (s)=>{
    const buf = $5315c5b824bb5181$require$Buffer.from(s, 'base64');
    return $5315c5b824bb5181$export$f3c8b5f6d250ec43(buf.buffer, buf.byteOffset, buf.byteLength);
};
const $5315c5b824bb5181$export$37cc283d8fbd3462 = $63eb5f96ace248ce$export$4e09c449d6c407f7 ? $5315c5b824bb5181$var$toBase64Browser : $5315c5b824bb5181$var$toBase64Node;
const $5315c5b824bb5181$export$c537b38001c583b7 = $63eb5f96ace248ce$export$4e09c449d6c407f7 ? $5315c5b824bb5181$var$fromBase64Browser : $5315c5b824bb5181$var$fromBase64Node;
const $5315c5b824bb5181$export$31f478961f22a29 = (buf)=>$5315c5b824bb5181$export$37cc283d8fbd3462(buf).replaceAll('+', '-').replaceAll('/', '_').replaceAll('=', '');
const $5315c5b824bb5181$export$2fcb175ca881fa06 = (base64)=>$5315c5b824bb5181$export$c537b38001c583b7(base64.replaceAll('-', '+').replaceAll('_', '/'));
const $5315c5b824bb5181$export$f4915efbb94d4d01 = (buf)=>$cfaabc628d0f476d$export$871de8747c9eaa88(buf, (b)=>b.toString(16).padStart(2, '0')).join('');
const $5315c5b824bb5181$export$99a70112ceb8327b = (hex)=>{
    const hlen = hex.length;
    const buf = new Uint8Array($674380a05f97f4f3$export$803ce6b71a0a94b2(hlen / 2));
    for(let i = 0; i < hlen; i += 2)buf[buf.length - i / 2 - 1] = Number.parseInt(hex.slice(hlen - i - 2, hlen - i), 16);
    return buf;
};
const $5315c5b824bb5181$export$fe6f60023cd5ffaf = (uint8Array)=>{
    const newBuf = $5315c5b824bb5181$export$79a0c4c40eecffbb(uint8Array.byteLength);
    newBuf.set(uint8Array);
    return newBuf;
};
const $5315c5b824bb5181$export$355ad3726be07997 = (data)=>$293cd0efd7645786$export$c564cdbbe6da493((encoder)=>$293cd0efd7645786$export$264b1e8551468ea(encoder, data));
const $5315c5b824bb5181$export$929c279cfec29a23 = (buf)=>$e15498288f7f96ea$export$82863139061f472f($e15498288f7f96ea$export$f8c898e83b60faaa(buf));
const $5315c5b824bb5181$export$e87773390ebfdab4 = (bs, N)=>{
    if (N === 0) return bs;
    bs = new Uint8Array(bs);
    bs[0] <<= N;
    for(let i = 1; i < bs.length; i++){
        bs[i - 1] |= bs[i] >>> 8 - N;
        bs[i] <<= N;
    }
    return bs;
};






/**
 * Isomorphic logging module with support for colors!
 *
 * @module logging
 */ 

/**
 * Working with value pairs.
 *
 * @module pair
 */ /**
 * @template L,R
 */ class $4cab5b1b6e01e721$export$d63d7cff08fe4dc9 {
    /**
   * @param {L} left
   * @param {R} right
   */ constructor(left, right){
        this.left = left;
        this.right = right;
    }
}
const $4cab5b1b6e01e721$export$185802fd694ee1f5 = (left, right)=>new $4cab5b1b6e01e721$export$d63d7cff08fe4dc9(left, right);
const $4cab5b1b6e01e721$export$ca0ea131672c5a9b = (right, left)=>new $4cab5b1b6e01e721$export$d63d7cff08fe4dc9(left, right);
const $4cab5b1b6e01e721$export$4b80e395e36b5a56 = (arr, f)=>arr.forEach((p)=>f(p.left, p.right));
const $4cab5b1b6e01e721$export$871de8747c9eaa88 = (arr, f)=>arr.map((p)=>f(p.left, p.right));


/* eslint-env browser */ /**
 * Utility module to work with the DOM.
 *
 * @module dom
 */ 

const $fb2339228bc2eebb$export$2a111da947c407d2 = /** @type {Document} */ typeof document !== 'undefined' ? document : {};
const $fb2339228bc2eebb$export$c8a8987d4410bf2d = (name)=>$fb2339228bc2eebb$export$2a111da947c407d2.createElement(name);
const $fb2339228bc2eebb$export$fb51152cd5328759 = ()=>$fb2339228bc2eebb$export$2a111da947c407d2.createDocumentFragment();
const $fb2339228bc2eebb$export$b2ce9ad90858ed7a = (text)=>$fb2339228bc2eebb$export$2a111da947c407d2.createTextNode(text);
const $fb2339228bc2eebb$export$fb621bb527230cda = /** @type {DOMParser} */ typeof DOMParser !== 'undefined' ? new DOMParser() : null;
const $fb2339228bc2eebb$export$77c9ee5a14f9d7cf = (el, name, opts)=>el.dispatchEvent(new CustomEvent(name, opts));
const $fb2339228bc2eebb$export$74da2cba014bdc09 = (el, attrs)=>{
    $4cab5b1b6e01e721$export$4b80e395e36b5a56(attrs, (key, value)=>{
        if (value === false) el.removeAttribute(key);
        else if (value === true) el.setAttribute(key, '');
        else // @ts-ignore
        el.setAttribute(key, value);
    });
    return el;
};
const $fb2339228bc2eebb$export$ba744f7d152abea1 = (el, attrs)=>{
    attrs.forEach((value, key)=>{
        el.setAttribute(key, value);
    });
    return el;
};
const $fb2339228bc2eebb$export$f00aeb236b6f05af = (children)=>{
    const fragment = $fb2339228bc2eebb$export$fb51152cd5328759();
    for(let i = 0; i < children.length; i++)$fb2339228bc2eebb$export$1b8e57c9ea42f1d2(fragment, children[i]);
    return fragment;
};
const $fb2339228bc2eebb$export$10d8903dec122b9d = (parent, nodes)=>{
    $fb2339228bc2eebb$export$1b8e57c9ea42f1d2(parent, $fb2339228bc2eebb$export$f00aeb236b6f05af(nodes));
    return parent;
};
const $fb2339228bc2eebb$export$cd7f480d6b8286c3 = (el)=>el.remove();
const $fb2339228bc2eebb$export$3f65cefe8380dbea = (el, name, f)=>el.addEventListener(name, f);
const $fb2339228bc2eebb$export$8ff9f68337b520c0 = (el, name, f)=>el.removeEventListener(name, f);
const $fb2339228bc2eebb$export$40a4ed63e5cb7043 = (node, listeners)=>{
    $4cab5b1b6e01e721$export$4b80e395e36b5a56(listeners, (name, f)=>$fb2339228bc2eebb$export$3f65cefe8380dbea(node, name, f));
    return node;
};
const $fb2339228bc2eebb$export$8c7b13b21690651d = (node, listeners)=>{
    $4cab5b1b6e01e721$export$4b80e395e36b5a56(listeners, (name, f)=>$fb2339228bc2eebb$export$8ff9f68337b520c0(node, name, f));
    return node;
};
const $fb2339228bc2eebb$export$8454457683f90105 = (name, attrs = [], children = [])=>$fb2339228bc2eebb$export$10d8903dec122b9d($fb2339228bc2eebb$export$74da2cba014bdc09($fb2339228bc2eebb$export$c8a8987d4410bf2d(name), attrs), children);
const $fb2339228bc2eebb$export$67ea982130081db = (width, height)=>{
    const c = /** @type {HTMLCanvasElement} */ $fb2339228bc2eebb$export$c8a8987d4410bf2d('canvas');
    c.height = height;
    c.width = width;
    return c;
};
const $fb2339228bc2eebb$export$6f093cfa640b7166 = $fb2339228bc2eebb$export$b2ce9ad90858ed7a;
const $fb2339228bc2eebb$export$7f60f118cd3e6292 = (pair)=>`${pair.left}:${pair.right};`;
const $fb2339228bc2eebb$export$3d24a00500154f45 = (pairs)=>pairs.map($fb2339228bc2eebb$export$7f60f118cd3e6292).join('');
const $fb2339228bc2eebb$export$7d9cafe158c3b49 = (m)=>$58ab1e30cc73aec7$export$871de8747c9eaa88(m, (value, key)=>`${key}:${value};`).join('');
const $fb2339228bc2eebb$export$78fb49a702cc1f2 = (el, query)=>el.querySelector(query);
const $fb2339228bc2eebb$export$2e83b5c43fb7af7b = (el, query)=>el.querySelectorAll(query);
const $fb2339228bc2eebb$export$83595b84fc78b9b4 = (id)=>/** @type {HTMLElement} */ $fb2339228bc2eebb$export$2a111da947c407d2.getElementById(id);
/**
 * @param {string} html
 * @return {HTMLElement}
 */ const $fb2339228bc2eebb$var$_parse = (html)=>$fb2339228bc2eebb$export$fb621bb527230cda.parseFromString(`<html><body>${html}</body></html>`, 'text/html').body;
const $fb2339228bc2eebb$export$e1152f5efcc82ad = (html)=>$fb2339228bc2eebb$export$f00aeb236b6f05af(/** @type {any} */ $fb2339228bc2eebb$var$_parse(html).childNodes);
const $fb2339228bc2eebb$export$b23064c2dcaf2b63 = (html)=>/** @type HTMLElement */ $fb2339228bc2eebb$var$_parse(html).firstElementChild;
const $fb2339228bc2eebb$export$e6a6680780233a77 = (oldEl, newEl)=>oldEl.replaceWith(newEl);
const $fb2339228bc2eebb$export$86b68c7dbeb53c22 = (parent, el, ref)=>parent.insertBefore(el, ref);
const $fb2339228bc2eebb$export$1b8e57c9ea42f1d2 = (parent, child)=>parent.appendChild(child);
const $fb2339228bc2eebb$export$51c8a276ee4b8f51 = $fb2339228bc2eebb$export$2a111da947c407d2.ELEMENT_NODE;
const $fb2339228bc2eebb$export$5bcc40203615fc2e = $fb2339228bc2eebb$export$2a111da947c407d2.TEXT_NODE;
const $fb2339228bc2eebb$export$e5fc6332c1c8eb8e = $fb2339228bc2eebb$export$2a111da947c407d2.CDATA_SECTION_NODE;
const $fb2339228bc2eebb$export$3d597a6ef0f08b0a = $fb2339228bc2eebb$export$2a111da947c407d2.COMMENT_NODE;
const $fb2339228bc2eebb$export$4139dcda4f7f83db = $fb2339228bc2eebb$export$2a111da947c407d2.DOCUMENT_NODE;
const $fb2339228bc2eebb$export$e9e7ddfdb004b848 = $fb2339228bc2eebb$export$2a111da947c407d2.DOCUMENT_TYPE_NODE;
const $fb2339228bc2eebb$export$b86725031ae151ee = $fb2339228bc2eebb$export$2a111da947c407d2.DOCUMENT_FRAGMENT_NODE;
const $fb2339228bc2eebb$export$1aa65d86db59b879 = (node, type)=>node.nodeType === type;
const $fb2339228bc2eebb$export$3c81af374b054d6a = (parent, child)=>{
    let p = child.parentNode;
    while(p && p !== parent)p = p.parentNode;
    return p === parent;
} /* c8 ignore stop */ ;


/**
 * JSON utility functions.
 *
 * @module json
 */ /**
 * Transform JavaScript object to JSON.
 *
 * @param {any} object
 * @return {string}
 */ const $a1cad4ccf68ca4e5$export$fac44ee5b035f737 = JSON.stringify;
const $a1cad4ccf68ca4e5$export$98e6a39c04603d36 = JSON.parse;



/* global requestIdleCallback, requestAnimationFrame, cancelIdleCallback, cancelAnimationFrame */ /**
 * Utility module to work with EcmaScript's event loop.
 *
 * @module eventloop
 */ /**
 * @type {Array<function>}
 */ let $747d4280d058bdb6$var$queue = [];
const $747d4280d058bdb6$var$_runQueue = ()=>{
    for(let i = 0; i < $747d4280d058bdb6$var$queue.length; i++)$747d4280d058bdb6$var$queue[i]();
    $747d4280d058bdb6$var$queue = [];
};
const $747d4280d058bdb6$export$513072ba72100d9c = (f)=>{
    $747d4280d058bdb6$var$queue.push(f);
    if ($747d4280d058bdb6$var$queue.length === 1) setTimeout($747d4280d058bdb6$var$_runQueue, 0);
};
/**
 * @typedef {Object} TimeoutObject
 * @property {function} TimeoutObject.destroy
 */ /**
 * @param {function(number):void} clearFunction
 */ const $747d4280d058bdb6$var$createTimeoutClass = (clearFunction)=>class TT {
        /**
   * @param {number} timeoutId
   */ constructor(timeoutId){
            this._ = timeoutId;
        }
        destroy() {
            clearFunction(this._);
        }
    };
const $747d4280d058bdb6$var$Timeout = $747d4280d058bdb6$var$createTimeoutClass(clearTimeout);
const $747d4280d058bdb6$export$83e74882c5df8fe1 = (timeout, callback)=>new $747d4280d058bdb6$var$Timeout(setTimeout(callback, timeout));
const $747d4280d058bdb6$var$Interval = $747d4280d058bdb6$var$createTimeoutClass(clearInterval);
const $747d4280d058bdb6$export$3174cdbf0a0cbc84 = (timeout, callback)=>new $747d4280d058bdb6$var$Interval(setInterval(callback, timeout));
const $747d4280d058bdb6$export$c35d437ae5945fcd = $747d4280d058bdb6$var$createTimeoutClass((arg)=>typeof requestAnimationFrame !== 'undefined' && cancelAnimationFrame(arg));
const $747d4280d058bdb6$export$1402cba6a733f33a = (cb)=>typeof requestAnimationFrame === 'undefined' ? $747d4280d058bdb6$export$83e74882c5df8fe1(0, cb) : new $747d4280d058bdb6$export$c35d437ae5945fcd(requestAnimationFrame(cb));
/* c8 ignore next */ // @ts-ignore
const $747d4280d058bdb6$var$Idle = $747d4280d058bdb6$var$createTimeoutClass((arg)=>typeof cancelIdleCallback !== 'undefined' && cancelIdleCallback(arg));
const $747d4280d058bdb6$export$9f62c65f1b707875 = (cb)=>typeof requestIdleCallback !== 'undefined' ? new $747d4280d058bdb6$var$Idle(requestIdleCallback(cb)) : $747d4280d058bdb6$export$83e74882c5df8fe1(1000, cb);
const $747d4280d058bdb6$export$21cd608c50c2ba31 = (timeout)=>{
    let timer = -1;
    return (f)=>{
        clearTimeout(timer);
        if (f) timer = /** @type {any} */ setTimeout(f, timeout);
    };
};



/**
 * Utility module to work with EcmaScript Symbols.
 *
 * @module symbol
 */ /**
 * Return fresh symbol.
 *
 * @return {Symbol}
 */ const $28cfa6b842b61e55$export$185802fd694ee1f5 = Symbol;
const $28cfa6b842b61e55$export$a244864fd9645c7f = (s)=>typeof s === 'symbol';






const $3b74996164ee31b1$export$c1286c4c2a7c066 = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$f0ce1666bb40789b = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$738c3b9a44c87ecc = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$7d278ca694634874 = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$48d4b2cd5bc0e88b = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$aa201224bb439d47 = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$7ffdeca4b2f927a2 = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$3de5e29ed1757f9b = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$b586f81201748dd0 = $28cfa6b842b61e55$export$185802fd694ee1f5();
const $3b74996164ee31b1$export$3454091cc3c6c473 = (args)=>{
    if (args.length === 1 && args[0]?.constructor === Function) args = /** @type {Array<string|Symbol|Object|number>} */ /** @type {[function]} */ args[0]();
    const strBuilder = [];
    const logArgs = [];
    // try with formatting until we find something unsupported
    let i = 0;
    for(; i < args.length; i++){
        const arg = args[i];
        if (arg === undefined) break;
        else if (arg.constructor === String || arg.constructor === Number) strBuilder.push(arg);
        else if (arg.constructor === Object) break;
    }
    if (i > 0) // create logArgs with what we have so far
    logArgs.push(strBuilder.join(''));
    // append the rest
    for(; i < args.length; i++){
        const arg = args[i];
        if (!(arg instanceof Symbol)) logArgs.push(arg);
    }
    return logArgs;
};
/* c8 ignore stop */ const $3b74996164ee31b1$var$loggingColors = [
    $3b74996164ee31b1$export$48d4b2cd5bc0e88b,
    $3b74996164ee31b1$export$7ffdeca4b2f927a2,
    $3b74996164ee31b1$export$3de5e29ed1757f9b,
    $3b74996164ee31b1$export$738c3b9a44c87ecc
];
let $3b74996164ee31b1$var$nextColor = 0;
let $3b74996164ee31b1$var$lastLoggingTime = $3500d09fbb2953ce$export$1f77c0008d16313();
const $3b74996164ee31b1$export$c2977e725d59a2fd = (_print, moduleName)=>{
    const color = $3b74996164ee31b1$var$loggingColors[$3b74996164ee31b1$var$nextColor];
    const debugRegexVar = $63eb5f96ace248ce$export$39fb32ac18db3f88('log');
    const doLogging = debugRegexVar !== null && (debugRegexVar === '*' || debugRegexVar === 'true' || new RegExp(debugRegexVar, 'gi').test(moduleName));
    $3b74996164ee31b1$var$nextColor = ($3b74996164ee31b1$var$nextColor + 1) % $3b74996164ee31b1$var$loggingColors.length;
    moduleName += ': ';
    return !doLogging ? $e2897672a487246a$export$b5f1cfe7b08e6ed5 : (...args)=>{
        if (args.length === 1 && args[0]?.constructor === Function) args = args[0]();
        const timeNow = $3500d09fbb2953ce$export$1f77c0008d16313();
        const timeDiff = timeNow - $3b74996164ee31b1$var$lastLoggingTime;
        $3b74996164ee31b1$var$lastLoggingTime = timeNow;
        _print(color, moduleName, $3b74996164ee31b1$export$b586f81201748dd0, ...args.map((arg)=>{
            if (arg != null && arg.constructor === Uint8Array) arg = Array.from(arg);
            const t = typeof arg;
            switch(t){
                case 'string':
                case 'symbol':
                    return arg;
                default:
                    return $a1cad4ccf68ca4e5$export$fac44ee5b035f737(arg);
            }
        }), color, ' +' + timeDiff + 'ms');
    };
} /* c8 ignore stop */ ;


/**
 * @type {Object<Symbol,pair.Pair<string,string>>}
 */ const $0b4450a4ff92533f$var$_browserStyleMap = {
    [$3b74996164ee31b1$export$c1286c4c2a7c066]: $4cab5b1b6e01e721$export$185802fd694ee1f5('font-weight', 'bold'),
    [$3b74996164ee31b1$export$f0ce1666bb40789b]: $4cab5b1b6e01e721$export$185802fd694ee1f5('font-weight', 'normal'),
    [$3b74996164ee31b1$export$738c3b9a44c87ecc]: $4cab5b1b6e01e721$export$185802fd694ee1f5('color', 'blue'),
    [$3b74996164ee31b1$export$48d4b2cd5bc0e88b]: $4cab5b1b6e01e721$export$185802fd694ee1f5('color', 'green'),
    [$3b74996164ee31b1$export$7d278ca694634874]: $4cab5b1b6e01e721$export$185802fd694ee1f5('color', 'grey'),
    [$3b74996164ee31b1$export$aa201224bb439d47]: $4cab5b1b6e01e721$export$185802fd694ee1f5('color', 'red'),
    [$3b74996164ee31b1$export$7ffdeca4b2f927a2]: $4cab5b1b6e01e721$export$185802fd694ee1f5('color', 'purple'),
    [$3b74996164ee31b1$export$3de5e29ed1757f9b]: $4cab5b1b6e01e721$export$185802fd694ee1f5('color', 'orange'),
    [$3b74996164ee31b1$export$b586f81201748dd0]: $4cab5b1b6e01e721$export$185802fd694ee1f5('color', 'black')
};
/**
 * @param {Array<string|Symbol|Object|number|function():any>} args
 * @return {Array<string|object|number>}
 */ /* c8 ignore start */ const $0b4450a4ff92533f$var$computeBrowserLoggingArgs = (args)=>{
    if (args.length === 1 && args[0]?.constructor === Function) args = /** @type {Array<string|Symbol|Object|number>} */ /** @type {[function]} */ args[0]();
    const strBuilder = [];
    const styles = [];
    const currentStyle = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    /**
   * @type {Array<string|Object|number>}
   */ let logArgs = [];
    // try with formatting until we find something unsupported
    let i = 0;
    for(; i < args.length; i++){
        const arg = args[i];
        // @ts-ignore
        const style = $0b4450a4ff92533f$var$_browserStyleMap[arg];
        if (style !== undefined) currentStyle.set(style.left, style.right);
        else {
            if (arg === undefined) break;
            if (arg.constructor === String || arg.constructor === Number) {
                const style = $fb2339228bc2eebb$export$7d9cafe158c3b49(currentStyle);
                if (i > 0 || style.length > 0) {
                    strBuilder.push('%c' + arg);
                    styles.push(style);
                } else strBuilder.push(arg);
            } else break;
        }
    }
    if (i > 0) {
        // create logArgs with what we have so far
        logArgs = styles;
        logArgs.unshift(strBuilder.join(''));
    }
    // append the rest
    for(; i < args.length; i++){
        const arg = args[i];
        if (!(arg instanceof Symbol)) logArgs.push(arg);
    }
    return logArgs;
};
/* c8 ignore stop */ /* c8 ignore start */ const $0b4450a4ff92533f$var$computeLoggingArgs = $63eb5f96ace248ce$export$fcbe44f5d6fcebd ? $0b4450a4ff92533f$var$computeBrowserLoggingArgs : $3b74996164ee31b1$export$3454091cc3c6c473;
const $0b4450a4ff92533f$export$c2d084dc44961371 = (...args)=>{
    console.log(...$0b4450a4ff92533f$var$computeLoggingArgs(args));
    /* c8 ignore next */ $0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.print(args));
};
const $0b4450a4ff92533f$export$c106dd0671a0fc2d = (...args)=>{
    console.warn(...$0b4450a4ff92533f$var$computeLoggingArgs(args));
    args.unshift($3b74996164ee31b1$export$3de5e29ed1757f9b);
    $0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.print(args));
};
const $0b4450a4ff92533f$export$55ee1551a3f962e6 = (err)=>{
    console.error(err);
    $0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.printError(err));
};
const $0b4450a4ff92533f$export$85acd411250ab137 = (url, height)=>{
    if ($63eb5f96ace248ce$export$4e09c449d6c407f7) console.log('%c                      ', `font-size: ${height}px; background-size: contain; background-repeat: no-repeat; background-image: url(${url})`);
    $0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.printImg(url, height));
};
const $0b4450a4ff92533f$export$fcd48d8a033dbfbf = (base64, height)=>$0b4450a4ff92533f$export$85acd411250ab137(`data:image/gif;base64,${base64}`, height);
const $0b4450a4ff92533f$export$e5e25fbcc1f7affe = (...args)=>{
    console.group(...$0b4450a4ff92533f$var$computeLoggingArgs(args));
    /* c8 ignore next */ $0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.group(args));
};
const $0b4450a4ff92533f$export$488ef8fb3416a29f = (...args)=>{
    console.groupCollapsed(...$0b4450a4ff92533f$var$computeLoggingArgs(args));
    /* c8 ignore next */ $0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.groupCollapsed(args));
};
const $0b4450a4ff92533f$export$a57f3dfe595273e6 = ()=>{
    console.groupEnd();
    /* c8 ignore next */ $0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.groupEnd());
};
const $0b4450a4ff92533f$export$76dff282388623b3 = (createNode)=>$0b4450a4ff92533f$export$6f0283bff34730a1.forEach((vc)=>vc.printDom(createNode()));
const $0b4450a4ff92533f$export$98f2e847362d891 = (canvas, height)=>$0b4450a4ff92533f$export$85acd411250ab137(canvas.toDataURL(), height);
const $0b4450a4ff92533f$export$6f0283bff34730a1 = $ace4f15b64ff1dc0$export$185802fd694ee1f5();
/**
 * @param {Array<string|Symbol|Object|number>} args
 * @return {Array<Element>}
 */ /* c8 ignore start */ const $0b4450a4ff92533f$var$_computeLineSpans = (args)=>{
    const spans = [];
    const currentStyle = new Map();
    // try with formatting until we find something unsupported
    let i = 0;
    for(; i < args.length; i++){
        let arg = args[i];
        // @ts-ignore
        const style = $0b4450a4ff92533f$var$_browserStyleMap[arg];
        if (style !== undefined) currentStyle.set(style.left, style.right);
        else {
            if (arg === undefined) arg = 'undefined ';
            if (arg.constructor === String || arg.constructor === Number) {
                // @ts-ignore
                const span = $fb2339228bc2eebb$export$8454457683f90105('span', [
                    $4cab5b1b6e01e721$export$185802fd694ee1f5('style', $fb2339228bc2eebb$export$7d9cafe158c3b49(currentStyle))
                ], [
                    $fb2339228bc2eebb$export$6f093cfa640b7166(arg.toString())
                ]);
                if (span.innerHTML === '') span.innerHTML = '&nbsp;';
                spans.push(span);
            } else break;
        }
    }
    // append the rest
    for(; i < args.length; i++){
        let content = args[i];
        if (!(content instanceof Symbol)) {
            if (content.constructor !== String && content.constructor !== Number) content = ' ' + $a1cad4ccf68ca4e5$export$fac44ee5b035f737(content) + ' ';
            spans.push($fb2339228bc2eebb$export$8454457683f90105('span', [], [
                $fb2339228bc2eebb$export$6f093cfa640b7166(/** @type {string} */ content)
            ]));
        }
    }
    return spans;
};
/* c8 ignore stop */ const $0b4450a4ff92533f$var$lineStyle = 'font-family:monospace;border-bottom:1px solid #e2e2e2;padding:2px;';
class $0b4450a4ff92533f$export$79dd518d42f6d7a1 {
    /**
   * @param {Element} dom
   */ constructor(dom){
        this.dom = dom;
        /**
     * @type {Element}
     */ this.ccontainer = this.dom;
        this.depth = 0;
        $0b4450a4ff92533f$export$6f0283bff34730a1.add(this);
    }
    /**
   * @param {Array<string|Symbol|Object|number>} args
   * @param {boolean} collapsed
   */ group(args, collapsed = false) {
        $747d4280d058bdb6$export$513072ba72100d9c(()=>{
            const triangleDown = $fb2339228bc2eebb$export$8454457683f90105('span', [
                $4cab5b1b6e01e721$export$185802fd694ee1f5('hidden', collapsed),
                $4cab5b1b6e01e721$export$185802fd694ee1f5('style', 'color:grey;font-size:120%;')
            ], [
                $fb2339228bc2eebb$export$6f093cfa640b7166("\u25BC")
            ]);
            const triangleRight = $fb2339228bc2eebb$export$8454457683f90105('span', [
                $4cab5b1b6e01e721$export$185802fd694ee1f5('hidden', !collapsed),
                $4cab5b1b6e01e721$export$185802fd694ee1f5('style', 'color:grey;font-size:125%;')
            ], [
                $fb2339228bc2eebb$export$6f093cfa640b7166("\u25B6")
            ]);
            const content = $fb2339228bc2eebb$export$8454457683f90105('div', [
                $4cab5b1b6e01e721$export$185802fd694ee1f5('style', `${$0b4450a4ff92533f$var$lineStyle};padding-left:${this.depth * 10}px`)
            ], [
                triangleDown,
                triangleRight,
                $fb2339228bc2eebb$export$6f093cfa640b7166(' ')
            ].concat($0b4450a4ff92533f$var$_computeLineSpans(args)));
            const nextContainer = $fb2339228bc2eebb$export$8454457683f90105('div', [
                $4cab5b1b6e01e721$export$185802fd694ee1f5('hidden', collapsed)
            ]);
            const nextLine = $fb2339228bc2eebb$export$8454457683f90105('div', [], [
                content,
                nextContainer
            ]);
            $fb2339228bc2eebb$export$10d8903dec122b9d(this.ccontainer, [
                nextLine
            ]);
            this.ccontainer = nextContainer;
            this.depth++;
            // when header is clicked, collapse/uncollapse container
            $fb2339228bc2eebb$export$3f65cefe8380dbea(content, 'click', (_event)=>{
                nextContainer.toggleAttribute('hidden');
                triangleDown.toggleAttribute('hidden');
                triangleRight.toggleAttribute('hidden');
            });
        });
    }
    /**
   * @param {Array<string|Symbol|Object|number>} args
   */ groupCollapsed(args) {
        this.group(args, true);
    }
    groupEnd() {
        $747d4280d058bdb6$export$513072ba72100d9c(()=>{
            if (this.depth > 0) {
                this.depth--;
                // @ts-ignore
                this.ccontainer = this.ccontainer.parentElement.parentElement;
            }
        });
    }
    /**
   * @param {Array<string|Symbol|Object|number>} args
   */ print(args) {
        $747d4280d058bdb6$export$513072ba72100d9c(()=>{
            $fb2339228bc2eebb$export$10d8903dec122b9d(this.ccontainer, [
                $fb2339228bc2eebb$export$8454457683f90105('div', [
                    $4cab5b1b6e01e721$export$185802fd694ee1f5('style', `${$0b4450a4ff92533f$var$lineStyle};padding-left:${this.depth * 10}px`)
                ], $0b4450a4ff92533f$var$_computeLineSpans(args))
            ]);
        });
    }
    /**
   * @param {Error} err
   */ printError(err) {
        this.print([
            $3b74996164ee31b1$export$aa201224bb439d47,
            $3b74996164ee31b1$export$c1286c4c2a7c066,
            err.toString()
        ]);
    }
    /**
   * @param {string} url
   * @param {number} height
   */ printImg(url, height) {
        $747d4280d058bdb6$export$513072ba72100d9c(()=>{
            $fb2339228bc2eebb$export$10d8903dec122b9d(this.ccontainer, [
                $fb2339228bc2eebb$export$8454457683f90105('img', [
                    $4cab5b1b6e01e721$export$185802fd694ee1f5('src', url),
                    $4cab5b1b6e01e721$export$185802fd694ee1f5('height', `${$674380a05f97f4f3$export$2077e0241d6afd3c(height * 1.5)}px`)
                ])
            ]);
        });
    }
    /**
   * @param {Node} node
   */ printDom(node) {
        $747d4280d058bdb6$export$513072ba72100d9c(()=>{
            $fb2339228bc2eebb$export$10d8903dec122b9d(this.ccontainer, [
                node
            ]);
        });
    }
    destroy() {
        $747d4280d058bdb6$export$513072ba72100d9c(()=>{
            $0b4450a4ff92533f$export$6f0283bff34730a1.delete(this);
        });
    }
}
const $0b4450a4ff92533f$export$3b589da4ab12cf23 = (dom)=>new $0b4450a4ff92533f$export$79dd518d42f6d7a1(dom);
const $0b4450a4ff92533f$export$c2977e725d59a2fd = (moduleName)=>$3b74996164ee31b1$export$c2977e725d59a2fd($0b4450a4ff92533f$export$c2d084dc44961371, moduleName);




/**
 * Utility module to create and manipulate Iterators.
 *
 * @module iterator
 */ /**
 * @template T,R
 * @param {Iterator<T>} iterator
 * @param {function(T):R} f
 * @return {IterableIterator<R>}
 */ const $0b9eaeb04b9479fe$export$68b1bda190f54159 = (iterator, f)=>({
        [Symbol.iterator] () {
            return this;
        },
        // @ts-ignore
        next () {
            const r = iterator.next();
            return {
                value: r.done ? undefined : f(r.value),
                done: r.done
            };
        }
    });
const $0b9eaeb04b9479fe$export$7342c78d7e13e778 = (next)=>({
        /**
   * @return {IterableIterator<T>}
   */ [Symbol.iterator] () {
            return this;
        },
        next: // @ts-ignore
        next
    });
const $0b9eaeb04b9479fe$export$88f0b2eef157f31a = (iterator, filter)=>$0b9eaeb04b9479fe$export$7342c78d7e13e778(()=>{
        let res;
        do res = iterator.next();
        while (!res.done && !filter(res.value));
        return res;
    });
const $0b9eaeb04b9479fe$export$1570d514f543056a = (iterator, fmap)=>$0b9eaeb04b9479fe$export$7342c78d7e13e778(()=>{
        const { done: done, value: value } = iterator.next();
        return {
            done: done,
            value: done ? undefined : fmap(value)
        };
    });




/**
 * This is an abstract interface that all Connectors should implement to keep them interchangeable.
 *
 * @note This interface is experimental and it is not advised to actually inherit this class.
 *       It just serves as typing information.
 *
 * @extends {ObservableV2<any>}
 */ class $42aaa4fd3d01b4df$export$c3faceeb92aa39dd extends (0, $015da90ca04a7f6c$export$e23d3436ce401adc) {
    /**
   * @param {Doc} ydoc
   * @param {any} awareness
   */ constructor(ydoc, awareness){
        super();
        this.doc = ydoc;
        this.awareness = awareness;
    }
}
class $42aaa4fd3d01b4df$var$DeleteItem {
    /**
   * @param {number} clock
   * @param {number} len
   */ constructor(clock, len){
        /**
     * @type {number}
     */ this.clock = clock;
        /**
     * @type {number}
     */ this.len = len;
    }
}
/**
 * We no longer maintain a DeleteStore. DeleteSet is a temporary object that is created when needed.
 * - When created in a transaction, it must only be accessed after sorting, and merging
 *   - This DeleteSet is send to other clients
 * - We do not create a DeleteSet when we send a sync message. The DeleteSet message is created directly from StructStore
 * - We read a DeleteSet as part of a sync/update message. In this case the DeleteSet is already sorted and merged.
 */ class $42aaa4fd3d01b4df$var$DeleteSet {
    constructor(){
        /**
     * @type {Map<number,Array<DeleteItem>>}
     */ this.clients = new Map();
    }
}
/**
 * Iterate over all structs that the DeleteSet gc's.
 *
 * @param {Transaction} transaction
 * @param {DeleteSet} ds
 * @param {function(GC|Item):void} f
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$8afefebbaf4e4c78 = (transaction, ds, f)=>ds.clients.forEach((deletes, clientid)=>{
        const structs = /** @type {Array<GC|Item>} */ transaction.doc.store.clients.get(clientid);
        for(let i = 0; i < deletes.length; i++){
            const del = deletes[i];
            $42aaa4fd3d01b4df$var$iterateStructs(transaction, structs, del.clock, del.len, f);
        }
    });
/**
 * @param {Array<DeleteItem>} dis
 * @param {number} clock
 * @return {number|null}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$findIndexDS = (dis, clock)=>{
    let left = 0;
    let right = dis.length - 1;
    while(left <= right){
        const midindex = $674380a05f97f4f3$export$a3fe094919f356fd((left + right) / 2);
        const mid = dis[midindex];
        const midclock = mid.clock;
        if (midclock <= clock) {
            if (clock < midclock + mid.len) return midindex;
            left = midindex + 1;
        } else right = midindex - 1;
    }
    return null;
};
/**
 * @param {DeleteSet} ds
 * @param {ID} id
 * @return {boolean}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$dcb04af092e44fde = (ds, id)=>{
    const dis = ds.clients.get(id.client);
    return dis !== undefined && $42aaa4fd3d01b4df$var$findIndexDS(dis, id.clock) !== null;
};
/**
 * @param {DeleteSet} ds
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$sortAndMergeDeleteSet = (ds)=>{
    ds.clients.forEach((dels)=>{
        dels.sort((a, b)=>a.clock - b.clock);
        // merge items without filtering or splicing the array
        // i is the current pointer
        // j refers to the current insert position for the pointed item
        // try to merge dels[i] into dels[j-1] or set dels[j]=dels[i]
        let i, j;
        for(i = 1, j = 1; i < dels.length; i++){
            const left = dels[j - 1];
            const right = dels[i];
            if (left.clock + left.len >= right.clock) left.len = $674380a05f97f4f3$export$8960430cfd85939f(left.len, right.clock + right.len - left.clock);
            else {
                if (j < i) dels[j] = right;
                j++;
            }
        }
        dels.length = j;
    });
};
/**
 * @param {Array<DeleteSet>} dss
 * @return {DeleteSet} A fresh DeleteSet
 */ const $42aaa4fd3d01b4df$export$b7826cadad53901e = (dss)=>{
    const merged = new $42aaa4fd3d01b4df$var$DeleteSet();
    for(let dssI = 0; dssI < dss.length; dssI++)dss[dssI].clients.forEach((delsLeft, client)=>{
        if (!merged.clients.has(client)) {
            // Write all missing keys from current ds and all following.
            // If merged already contains `client` current ds has already been added.
            /**
         * @type {Array<DeleteItem>}
         */ const dels = delsLeft.slice();
            for(let i = dssI + 1; i < dss.length; i++)$cfaabc628d0f476d$export$9ceefe31f12a3778(dels, dss[i].clients.get(client) || []);
            merged.clients.set(client, dels);
        }
    });
    $42aaa4fd3d01b4df$var$sortAndMergeDeleteSet(merged);
    return merged;
};
/**
 * @param {DeleteSet} ds
 * @param {number} client
 * @param {number} clock
 * @param {number} length
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$addToDeleteSet = (ds, client, clock, length)=>{
    $58ab1e30cc73aec7$export$dccd489362a8619(ds.clients, client, ()=>/** @type {Array<DeleteItem>} */ []).push(new $42aaa4fd3d01b4df$var$DeleteItem(clock, length));
};
const $42aaa4fd3d01b4df$export$8cbac0d946238699 = ()=>new $42aaa4fd3d01b4df$var$DeleteSet();
/**
 * @param {StructStore} ss
 * @return {DeleteSet} Merged and sorted DeleteSet
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$8450d668bec558e2 = (ss)=>{
    const ds = $42aaa4fd3d01b4df$export$8cbac0d946238699();
    ss.clients.forEach((structs, client)=>{
        /**
     * @type {Array<DeleteItem>}
     */ const dsitems = [];
        for(let i = 0; i < structs.length; i++){
            const struct = structs[i];
            if (struct.deleted) {
                const clock = struct.id.clock;
                let len = struct.length;
                if (i + 1 < structs.length) for(let next = structs[i + 1]; i + 1 < structs.length && next.deleted; next = structs[++i + 1])len += next.length;
                dsitems.push(new $42aaa4fd3d01b4df$var$DeleteItem(clock, len));
            }
        }
        if (dsitems.length > 0) ds.clients.set(client, dsitems);
    });
    return ds;
};
/**
 * @param {DSEncoderV1 | DSEncoderV2} encoder
 * @param {DeleteSet} ds
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$writeDeleteSet = (encoder, ds)=>{
    $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, ds.clients.size);
    // Ensure that the delete set is written in a deterministic order
    $cfaabc628d0f476d$export$6788812c4e6611e6(ds.clients.entries()).sort((a, b)=>b[0] - a[0]).forEach(([client, dsitems])=>{
        encoder.resetDsCurVal();
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, client);
        const len = dsitems.length;
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, len);
        for(let i = 0; i < len; i++){
            const item = dsitems[i];
            encoder.writeDsClock(item.clock);
            encoder.writeDsLen(item.len);
        }
    });
};
/**
 * @param {DSDecoderV1 | DSDecoderV2} decoder
 * @return {DeleteSet}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readDeleteSet = (decoder)=>{
    const ds = new $42aaa4fd3d01b4df$var$DeleteSet();
    const numClients = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
    for(let i = 0; i < numClients; i++){
        decoder.resetDsCurVal();
        const client = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        const numberOfDeletes = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        if (numberOfDeletes > 0) {
            const dsField = $58ab1e30cc73aec7$export$dccd489362a8619(ds.clients, client, ()=>/** @type {Array<DeleteItem>} */ []);
            for(let i = 0; i < numberOfDeletes; i++)dsField.push(new $42aaa4fd3d01b4df$var$DeleteItem(decoder.readDsClock(), decoder.readDsLen()));
        }
    }
    return ds;
};
/**
 * @todo YDecoder also contains references to String and other Decoders. Would make sense to exchange YDecoder.toUint8Array for YDecoder.DsToUint8Array()..
 */ /**
 * @param {DSDecoderV1 | DSDecoderV2} decoder
 * @param {Transaction} transaction
 * @param {StructStore} store
 * @return {Uint8Array|null} Returns a v2 update containing all deletes that couldn't be applied yet; or null if all deletes were applied successfully.
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readAndApplyDeleteSet = (decoder, transaction, store)=>{
    const unappliedDS = new $42aaa4fd3d01b4df$var$DeleteSet();
    const numClients = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
    for(let i = 0; i < numClients; i++){
        decoder.resetDsCurVal();
        const client = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        const numberOfDeletes = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        const structs = store.clients.get(client) || [];
        const state = $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, client);
        for(let i = 0; i < numberOfDeletes; i++){
            const clock = decoder.readDsClock();
            const clockEnd = clock + decoder.readDsLen();
            if (clock < state) {
                if (state < clockEnd) $42aaa4fd3d01b4df$var$addToDeleteSet(unappliedDS, client, state, clockEnd - state);
                let index = $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, clock);
                /**
         * We can ignore the case of GC and Delete structs, because we are going to skip them
         * @type {Item}
         */ // @ts-ignore
                let struct = structs[index];
                // split the first item if necessary
                if (!struct.deleted && struct.id.clock < clock) {
                    structs.splice(index + 1, 0, $42aaa4fd3d01b4df$var$splitItem(transaction, struct, clock - struct.id.clock));
                    index++; // increase we now want to use the next struct
                }
                while(index < structs.length){
                    // @ts-ignore
                    struct = structs[index++];
                    if (struct.id.clock < clockEnd) {
                        if (!struct.deleted) {
                            if (clockEnd < struct.id.clock + struct.length) structs.splice(index, 0, $42aaa4fd3d01b4df$var$splitItem(transaction, struct, clockEnd - struct.id.clock));
                            struct.delete(transaction);
                        }
                    } else break;
                }
            } else $42aaa4fd3d01b4df$var$addToDeleteSet(unappliedDS, client, clock, clockEnd - clock);
        }
    }
    if (unappliedDS.clients.size > 0) {
        const ds = new $42aaa4fd3d01b4df$export$30c99e08943e1c2();
        $293cd0efd7645786$export$872f48c75febcd2b(ds.restEncoder, 0); // encode 0 structs
        $42aaa4fd3d01b4df$var$writeDeleteSet(ds, unappliedDS);
        return ds.toUint8Array();
    }
    return null;
};
/**
 * @param {DeleteSet} ds1
 * @param {DeleteSet} ds2
 */ const $42aaa4fd3d01b4df$export$9697b72c46fd3a5d = (ds1, ds2)=>{
    if (ds1.clients.size !== ds2.clients.size) return false;
    for (const [client, deleteItems1] of ds1.clients.entries()){
        const deleteItems2 = /** @type {Array<import('../internals.js').DeleteItem>} */ ds2.clients.get(client);
        if (deleteItems2 === undefined || deleteItems1.length !== deleteItems2.length) return false;
        for(let i = 0; i < deleteItems1.length; i++){
            const di1 = deleteItems1[i];
            const di2 = deleteItems2[i];
            if (di1.clock !== di2.clock || di1.len !== di2.len) return false;
        }
    }
    return true;
};
/**
 * @module Y
 */ const $42aaa4fd3d01b4df$var$generateNewClientId = $78e269f32c0d8b71$export$de9ffb9418dd7d0d;
/**
 * @typedef {Object} DocOpts
 * @property {boolean} [DocOpts.gc=true] Disable garbage collection (default: gc=true)
 * @property {function(Item):boolean} [DocOpts.gcFilter] Will be called before an Item is garbage collected. Return false to keep the Item.
 * @property {string} [DocOpts.guid] Define a globally unique identifier for this document
 * @property {string | null} [DocOpts.collectionid] Associate this document with a collection. This only plays a role if your provider has a concept of collection.
 * @property {any} [DocOpts.meta] Any kind of meta information you want to associate with this document. If this is a subdocument, remote peers will store the meta information as well.
 * @property {boolean} [DocOpts.autoLoad] If a subdocument, automatically load document. If this is a subdocument, remote peers will load the document as well automatically.
 * @property {boolean} [DocOpts.shouldLoad] Whether the document should be synced by the provider now. This is toggled to true when you call ydoc.load()
 */ /**
 * @typedef {Object} DocEvents
 * @property {function(Doc):void} DocEvents.destroy
 * @property {function(Doc):void} DocEvents.load
 * @property {function(boolean, Doc):void} DocEvents.sync
 * @property {function(Uint8Array, any, Doc, Transaction):void} DocEvents.update
 * @property {function(Uint8Array, any, Doc, Transaction):void} DocEvents.updateV2
 * @property {function(Doc):void} DocEvents.beforeAllTransactions
 * @property {function(Transaction, Doc):void} DocEvents.beforeTransaction
 * @property {function(Transaction, Doc):void} DocEvents.beforeObserverCalls
 * @property {function(Transaction, Doc):void} DocEvents.afterTransaction
 * @property {function(Transaction, Doc):void} DocEvents.afterTransactionCleanup
 * @property {function(Doc, Array<Transaction>):void} DocEvents.afterAllTransactions
 * @property {function({ loaded: Set<Doc>, added: Set<Doc>, removed: Set<Doc> }, Doc, Transaction):void} DocEvents.subdocs
 */ /**
 * A Yjs instance handles the state of shared data.
 * @extends ObservableV2<DocEvents>
 */ class $42aaa4fd3d01b4df$export$bceacc74c2212615 extends (0, $015da90ca04a7f6c$export$e23d3436ce401adc) {
    /**
   * @param {DocOpts} opts configuration
   */ constructor({ guid: guid = $78e269f32c0d8b71$export$abe4376e1bf796d6(), collectionid: collectionid = null, gc: gc = true, gcFilter: gcFilter = ()=>true, meta: meta = null, autoLoad: autoLoad = false, shouldLoad: shouldLoad = true } = {}){
        super();
        this.gc = gc;
        this.gcFilter = gcFilter;
        this.clientID = $42aaa4fd3d01b4df$var$generateNewClientId();
        this.guid = guid;
        this.collectionid = collectionid;
        /**
     * @type {Map<string, AbstractType<YEvent<any>>>}
     */ this.share = new Map();
        this.store = new $42aaa4fd3d01b4df$var$StructStore();
        /**
     * @type {Transaction | null}
     */ this._transaction = null;
        /**
     * @type {Array<Transaction>}
     */ this._transactionCleanups = [];
        /**
     * @type {Set<Doc>}
     */ this.subdocs = new Set();
        /**
     * If this document is a subdocument - a document integrated into another document - then _item is defined.
     * @type {Item?}
     */ this._item = null;
        this.shouldLoad = shouldLoad;
        this.autoLoad = autoLoad;
        this.meta = meta;
        /**
     * This is set to true when the persistence provider loaded the document from the database or when the `sync` event fires.
     * Note that not all providers implement this feature. Provider authors are encouraged to fire the `load` event when the doc content is loaded from the database.
     *
     * @type {boolean}
     */ this.isLoaded = false;
        /**
     * This is set to true when the connection provider has successfully synced with a backend.
     * Note that when using peer-to-peer providers this event may not provide very useful.
     * Also note that not all providers implement this feature. Provider authors are encouraged to fire
     * the `sync` event when the doc has been synced (with `true` as a parameter) or if connection is
     * lost (with false as a parameter).
     */ this.isSynced = false;
        this.isDestroyed = false;
        /**
     * Promise that resolves once the document has been loaded from a presistence provider.
     */ this.whenLoaded = $f43a5cbbc8f3e47e$export$185802fd694ee1f5((resolve)=>{
            this.on('load', ()=>{
                this.isLoaded = true;
                resolve(this);
            });
        });
        const provideSyncedPromise = ()=>$f43a5cbbc8f3e47e$export$185802fd694ee1f5((resolve)=>{
                /**
       * @param {boolean} isSynced
       */ const eventHandler = (isSynced)=>{
                    if (isSynced === undefined || isSynced === true) {
                        this.off('sync', eventHandler);
                        resolve();
                    }
                };
                this.on('sync', eventHandler);
            });
        this.on('sync', (isSynced)=>{
            if (isSynced === false && this.isSynced) this.whenSynced = provideSyncedPromise();
            this.isSynced = isSynced === undefined || isSynced === true;
            if (this.isSynced && !this.isLoaded) this.emit('load', [
                this
            ]);
        });
        /**
     * Promise that resolves once the document has been synced with a backend.
     * This promise is recreated when the connection is lost.
     * Note the documentation about the `isSynced` property.
     */ this.whenSynced = provideSyncedPromise();
    }
    /**
   * Notify the parent document that you request to load data into this subdocument (if it is a subdocument).
   *
   * `load()` might be used in the future to request any provider to load the most current data.
   *
   * It is safe to call `load()` multiple times.
   */ load() {
        const item = this._item;
        if (item !== null && !this.shouldLoad) $42aaa4fd3d01b4df$export$dac1bad6146b2469(/** @type {any} */ item.parent.doc, (transaction)=>{
            transaction.subdocsLoaded.add(this);
        }, null, true);
        this.shouldLoad = true;
    }
    getSubdocs() {
        return this.subdocs;
    }
    getSubdocGuids() {
        return new Set($cfaabc628d0f476d$export$6788812c4e6611e6(this.subdocs).map((doc)=>doc.guid));
    }
    /**
   * Changes that happen inside of a transaction are bundled. This means that
   * the observer fires _after_ the transaction is finished and that all changes
   * that happened inside of the transaction are sent as one message to the
   * other peers.
   *
   * @template T
   * @param {function(Transaction):T} f The function that should be executed as a transaction
   * @param {any} [origin] Origin of who started the transaction. Will be stored on transaction.origin
   * @return T
   *
   * @public
   */ transact(f, origin = null) {
        return $42aaa4fd3d01b4df$export$dac1bad6146b2469(this, f, origin);
    }
    /**
   * Define a shared data type.
   *
   * Multiple calls of `ydoc.get(name, TypeConstructor)` yield the same result
   * and do not overwrite each other. I.e.
   * `ydoc.get(name, Y.Array) === ydoc.get(name, Y.Array)`
   *
   * After this method is called, the type is also available on `ydoc.share.get(name)`.
   *
   * *Best Practices:*
   * Define all types right after the Y.Doc instance is created and store them in a separate object.
   * Also use the typed methods `getText(name)`, `getArray(name)`, ..
   *
   * @template {typeof AbstractType<any>} Type
   * @example
   *   const ydoc = new Y.Doc(..)
   *   const appState = {
   *     document: ydoc.getText('document')
   *     comments: ydoc.getArray('comments')
   *   }
   *
   * @param {string} name
   * @param {Type} TypeConstructor The constructor of the type definition. E.g. Y.Text, Y.Array, Y.Map, ...
   * @return {InstanceType<Type>} The created type. Constructed with TypeConstructor
   *
   * @public
   */ get(name, TypeConstructor = /** @type {any} */ $42aaa4fd3d01b4df$export$c265dc8338484497) {
        const type = $58ab1e30cc73aec7$export$dccd489362a8619(this.share, name, ()=>{
            // @ts-ignore
            const t = new TypeConstructor();
            t._integrate(this, null);
            return t;
        });
        const Constr = type.constructor;
        if (TypeConstructor !== $42aaa4fd3d01b4df$export$c265dc8338484497 && Constr !== TypeConstructor) {
            if (Constr === $42aaa4fd3d01b4df$export$c265dc8338484497) {
                // @ts-ignore
                const t = new TypeConstructor();
                t._map = type._map;
                type._map.forEach(/** @param {Item?} n */ (n)=>{
                    for(; n !== null; n = n.left)// @ts-ignore
                    n.parent = t;
                });
                t._start = type._start;
                for(let n = t._start; n !== null; n = n.right)n.parent = t;
                t._length = type._length;
                this.share.set(name, t);
                t._integrate(this, null);
                return /** @type {InstanceType<Type>} */ t;
            } else throw new Error(`Type with the name ${name} has already been defined with a different constructor`);
        }
        return /** @type {InstanceType<Type>} */ type;
    }
    /**
   * @template T
   * @param {string} [name]
   * @return {YArray<T>}
   *
   * @public
   */ getArray(name = '') {
        return /** @type {YArray<T>} */ this.get(name, $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa);
    }
    /**
   * @param {string} [name]
   * @return {YText}
   *
   * @public
   */ getText(name = '') {
        return this.get(name, $42aaa4fd3d01b4df$export$5f1af8db9871e1d6);
    }
    /**
   * @template T
   * @param {string} [name]
   * @return {YMap<T>}
   *
   * @public
   */ getMap(name = '') {
        return /** @type {YMap<T>} */ this.get(name, $42aaa4fd3d01b4df$export$a5c7b93649eaf8f8);
    }
    /**
   * @param {string} [name]
   * @return {YXmlElement}
   *
   * @public
   */ getXmlElement(name = '') {
        return /** @type {YXmlElement<{[key:string]:string}>} */ this.get(name, $42aaa4fd3d01b4df$export$4db87581d3ca170d);
    }
    /**
   * @param {string} [name]
   * @return {YXmlFragment}
   *
   * @public
   */ getXmlFragment(name = '') {
        return this.get(name, $42aaa4fd3d01b4df$export$d5ce8c3e1731f1a7);
    }
    /**
   * Converts the entire document into a js object, recursively traversing each yjs type
   * Doesn't log types that have not been defined (using ydoc.getType(..)).
   *
   * @deprecated Do not use this method and rather call toJSON directly on the shared types.
   *
   * @return {Object<string, any>}
   */ toJSON() {
        /**
     * @type {Object<string, any>}
     */ const doc = {};
        this.share.forEach((value, key)=>{
            doc[key] = value.toJSON();
        });
        return doc;
    }
    /**
   * Emit `destroy` event and unregister all event handlers.
   */ destroy() {
        this.isDestroyed = true;
        $cfaabc628d0f476d$export$6788812c4e6611e6(this.subdocs).forEach((subdoc)=>subdoc.destroy());
        const item = this._item;
        if (item !== null) {
            this._item = null;
            const content = /** @type {ContentDoc} */ item.content;
            content.doc = new $42aaa4fd3d01b4df$export$bceacc74c2212615({
                guid: this.guid,
                ...content.opts,
                shouldLoad: false
            });
            content.doc._item = item;
            $42aaa4fd3d01b4df$export$dac1bad6146b2469(/** @type {any} */ item.parent.doc, (transaction)=>{
                const doc = content.doc;
                if (!item.deleted) transaction.subdocsAdded.add(doc);
                transaction.subdocsRemoved.add(this);
            }, null, true);
        }
        // @ts-ignore
        this.emit('destroyed', [
            true
        ]); // DEPRECATED!
        this.emit('destroy', [
            this
        ]);
        super.destroy();
    }
}
class $42aaa4fd3d01b4df$var$DSDecoderV1 {
    /**
   * @param {decoding.Decoder} decoder
   */ constructor(decoder){
        this.restDecoder = decoder;
    }
    resetDsCurVal() {
    // nop
    }
    /**
   * @return {number}
   */ readDsClock() {
        return $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder);
    }
    /**
   * @return {number}
   */ readDsLen() {
        return $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder);
    }
}
class $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec extends $42aaa4fd3d01b4df$var$DSDecoderV1 {
    /**
   * @return {ID}
   */ readLeftID() {
        return $42aaa4fd3d01b4df$export$6c7d4e6171d008d0($e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder), $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder));
    }
    /**
   * @return {ID}
   */ readRightID() {
        return $42aaa4fd3d01b4df$export$6c7d4e6171d008d0($e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder), $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder));
    }
    /**
   * Read the next client id.
   * Use this in favor of readID whenever possible to reduce the number of objects created.
   */ readClient() {
        return $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder);
    }
    /**
   * @return {number} info An unsigned 8-bit integer
   */ readInfo() {
        return $e15498288f7f96ea$export$d5778a2beba4ceef(this.restDecoder);
    }
    /**
   * @return {string}
   */ readString() {
        return $e15498288f7f96ea$export$3b64b4d753b81ec2(this.restDecoder);
    }
    /**
   * @return {boolean} isKey
   */ readParentInfo() {
        return $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder) === 1;
    }
    /**
   * @return {number} info An unsigned 8-bit integer
   */ readTypeRef() {
        return $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder);
    }
    /**
   * Write len of a struct - well suited for Opt RLE encoder.
   *
   * @return {number} len
   */ readLen() {
        return $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder);
    }
    /**
   * @return {any}
   */ readAny() {
        return $e15498288f7f96ea$export$82863139061f472f(this.restDecoder);
    }
    /**
   * @return {Uint8Array}
   */ readBuf() {
        return $5315c5b824bb5181$export$fe6f60023cd5ffaf($e15498288f7f96ea$export$7418bbc18dee40f3(this.restDecoder));
    }
    /**
   * Legacy implementation uses JSON parse. We use any-decoding in v2.
   *
   * @return {any}
   */ readJSON() {
        return JSON.parse($e15498288f7f96ea$export$3b64b4d753b81ec2(this.restDecoder));
    }
    /**
   * @return {string}
   */ readKey() {
        return $e15498288f7f96ea$export$3b64b4d753b81ec2(this.restDecoder);
    }
}
class $42aaa4fd3d01b4df$var$DSDecoderV2 {
    /**
   * @param {decoding.Decoder} decoder
   */ constructor(decoder){
        /**
     * @private
     */ this.dsCurrVal = 0;
        this.restDecoder = decoder;
    }
    resetDsCurVal() {
        this.dsCurrVal = 0;
    }
    /**
   * @return {number}
   */ readDsClock() {
        this.dsCurrVal += $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder);
        return this.dsCurrVal;
    }
    /**
   * @return {number}
   */ readDsLen() {
        const diff = $e15498288f7f96ea$export$5a476e4dbe7923d5(this.restDecoder) + 1;
        this.dsCurrVal += diff;
        return diff;
    }
}
class $42aaa4fd3d01b4df$export$1c932452355c5571 extends $42aaa4fd3d01b4df$var$DSDecoderV2 {
    /**
   * @param {decoding.Decoder} decoder
   */ constructor(decoder){
        super(decoder);
        /**
     * List of cached keys. If the keys[id] does not exist, we read a new key
     * from stringEncoder and push it to keys.
     *
     * @type {Array<string>}
     */ this.keys = [];
        $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder); // read feature flag - currently unused
        this.keyClockDecoder = new $e15498288f7f96ea$export$d502ab0bf048a596($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
        this.clientDecoder = new $e15498288f7f96ea$export$2dc62fb2f864b82e($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
        this.leftClockDecoder = new $e15498288f7f96ea$export$d502ab0bf048a596($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
        this.rightClockDecoder = new $e15498288f7f96ea$export$d502ab0bf048a596($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
        this.infoDecoder = new $e15498288f7f96ea$export$f1f1200492b832af($e15498288f7f96ea$export$7418bbc18dee40f3(decoder), $e15498288f7f96ea$export$d5778a2beba4ceef);
        this.stringDecoder = new $e15498288f7f96ea$export$63a7aa211a91ed69($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
        this.parentInfoDecoder = new $e15498288f7f96ea$export$f1f1200492b832af($e15498288f7f96ea$export$7418bbc18dee40f3(decoder), $e15498288f7f96ea$export$d5778a2beba4ceef);
        this.typeRefDecoder = new $e15498288f7f96ea$export$2dc62fb2f864b82e($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
        this.lenDecoder = new $e15498288f7f96ea$export$2dc62fb2f864b82e($e15498288f7f96ea$export$7418bbc18dee40f3(decoder));
    }
    /**
   * @return {ID}
   */ readLeftID() {
        return new $42aaa4fd3d01b4df$export$8be180ec26319f9f(this.clientDecoder.read(), this.leftClockDecoder.read());
    }
    /**
   * @return {ID}
   */ readRightID() {
        return new $42aaa4fd3d01b4df$export$8be180ec26319f9f(this.clientDecoder.read(), this.rightClockDecoder.read());
    }
    /**
   * Read the next client id.
   * Use this in favor of readID whenever possible to reduce the number of objects created.
   */ readClient() {
        return this.clientDecoder.read();
    }
    /**
   * @return {number} info An unsigned 8-bit integer
   */ readInfo() {
        return /** @type {number} */ this.infoDecoder.read();
    }
    /**
   * @return {string}
   */ readString() {
        return this.stringDecoder.read();
    }
    /**
   * @return {boolean}
   */ readParentInfo() {
        return this.parentInfoDecoder.read() === 1;
    }
    /**
   * @return {number} An unsigned 8-bit integer
   */ readTypeRef() {
        return this.typeRefDecoder.read();
    }
    /**
   * Write len of a struct - well suited for Opt RLE encoder.
   *
   * @return {number}
   */ readLen() {
        return this.lenDecoder.read();
    }
    /**
   * @return {any}
   */ readAny() {
        return $e15498288f7f96ea$export$82863139061f472f(this.restDecoder);
    }
    /**
   * @return {Uint8Array}
   */ readBuf() {
        return $e15498288f7f96ea$export$7418bbc18dee40f3(this.restDecoder);
    }
    /**
   * This is mainly here for legacy purposes.
   *
   * Initial we incoded objects using JSON. Now we use the much faster lib0/any-encoder. This method mainly exists for legacy purposes for the v1 encoder.
   *
   * @return {any}
   */ readJSON() {
        return $e15498288f7f96ea$export$82863139061f472f(this.restDecoder);
    }
    /**
   * @return {string}
   */ readKey() {
        const keyClock = this.keyClockDecoder.read();
        if (keyClock < this.keys.length) return this.keys[keyClock];
        else {
            const key = this.stringDecoder.read();
            this.keys.push(key);
            return key;
        }
    }
}
class $42aaa4fd3d01b4df$var$DSEncoderV1 {
    constructor(){
        this.restEncoder = $293cd0efd7645786$export$4e76eeb6df88c889();
    }
    toUint8Array() {
        return $293cd0efd7645786$export$73470fd2221e6aef(this.restEncoder);
    }
    resetDsCurVal() {
    // nop
    }
    /**
   * @param {number} clock
   */ writeDsClock(clock) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, clock);
    }
    /**
   * @param {number} len
   */ writeDsLen(len) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, len);
    }
}
class $42aaa4fd3d01b4df$export$99171b804d9c5b54 extends $42aaa4fd3d01b4df$var$DSEncoderV1 {
    /**
   * @param {ID} id
   */ writeLeftID(id) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, id.client);
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, id.clock);
    }
    /**
   * @param {ID} id
   */ writeRightID(id) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, id.client);
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, id.clock);
    }
    /**
   * Use writeClient and writeClock instead of writeID if possible.
   * @param {number} client
   */ writeClient(client) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, client);
    }
    /**
   * @param {number} info An unsigned 8-bit integer
   */ writeInfo(info) {
        $293cd0efd7645786$export$826a1a6619653272(this.restEncoder, info);
    }
    /**
   * @param {string} s
   */ writeString(s) {
        $293cd0efd7645786$export$dde49cb52d5f1650(this.restEncoder, s);
    }
    /**
   * @param {boolean} isYKey
   */ writeParentInfo(isYKey) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, isYKey ? 1 : 0);
    }
    /**
   * @param {number} info An unsigned 8-bit integer
   */ writeTypeRef(info) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, info);
    }
    /**
   * Write len of a struct - well suited for Opt RLE encoder.
   *
   * @param {number} len
   */ writeLen(len) {
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, len);
    }
    /**
   * @param {any} any
   */ writeAny(any) {
        $293cd0efd7645786$export$264b1e8551468ea(this.restEncoder, any);
    }
    /**
   * @param {Uint8Array} buf
   */ writeBuf(buf) {
        $293cd0efd7645786$export$f7d11515275e88a2(this.restEncoder, buf);
    }
    /**
   * @param {any} embed
   */ writeJSON(embed) {
        $293cd0efd7645786$export$dde49cb52d5f1650(this.restEncoder, JSON.stringify(embed));
    }
    /**
   * @param {string} key
   */ writeKey(key) {
        $293cd0efd7645786$export$dde49cb52d5f1650(this.restEncoder, key);
    }
}
class $42aaa4fd3d01b4df$var$DSEncoderV2 {
    constructor(){
        this.restEncoder = $293cd0efd7645786$export$4e76eeb6df88c889(); // encodes all the rest / non-optimized
        this.dsCurrVal = 0;
    }
    toUint8Array() {
        return $293cd0efd7645786$export$73470fd2221e6aef(this.restEncoder);
    }
    resetDsCurVal() {
        this.dsCurrVal = 0;
    }
    /**
   * @param {number} clock
   */ writeDsClock(clock) {
        const diff = clock - this.dsCurrVal;
        this.dsCurrVal = clock;
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, diff);
    }
    /**
   * @param {number} len
   */ writeDsLen(len) {
        if (len === 0) $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
        $293cd0efd7645786$export$872f48c75febcd2b(this.restEncoder, len - 1);
        this.dsCurrVal += len;
    }
}
class $42aaa4fd3d01b4df$export$30c99e08943e1c2 extends $42aaa4fd3d01b4df$var$DSEncoderV2 {
    constructor(){
        super();
        /**
     * @type {Map<string,number>}
     */ this.keyMap = new Map();
        /**
     * Refers to the next uniqe key-identifier to me used.
     * See writeKey method for more information.
     *
     * @type {number}
     */ this.keyClock = 0;
        this.keyClockEncoder = new $293cd0efd7645786$export$7542c66a59375c6f();
        this.clientEncoder = new $293cd0efd7645786$export$785ebd3312c38061();
        this.leftClockEncoder = new $293cd0efd7645786$export$7542c66a59375c6f();
        this.rightClockEncoder = new $293cd0efd7645786$export$7542c66a59375c6f();
        this.infoEncoder = new $293cd0efd7645786$export$8fa72bb4fa9409ff($293cd0efd7645786$export$826a1a6619653272);
        this.stringEncoder = new $293cd0efd7645786$export$7dcdc5c32f31c550();
        this.parentInfoEncoder = new $293cd0efd7645786$export$8fa72bb4fa9409ff($293cd0efd7645786$export$826a1a6619653272);
        this.typeRefEncoder = new $293cd0efd7645786$export$785ebd3312c38061();
        this.lenEncoder = new $293cd0efd7645786$export$785ebd3312c38061();
    }
    toUint8Array() {
        const encoder = $293cd0efd7645786$export$4e76eeb6df88c889();
        $293cd0efd7645786$export$872f48c75febcd2b(encoder, 0); // this is a feature flag that we might use in the future
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, this.keyClockEncoder.toUint8Array());
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, this.clientEncoder.toUint8Array());
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, this.leftClockEncoder.toUint8Array());
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, this.rightClockEncoder.toUint8Array());
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, $293cd0efd7645786$export$73470fd2221e6aef(this.infoEncoder));
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, this.stringEncoder.toUint8Array());
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, $293cd0efd7645786$export$73470fd2221e6aef(this.parentInfoEncoder));
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, this.typeRefEncoder.toUint8Array());
        $293cd0efd7645786$export$f7d11515275e88a2(encoder, this.lenEncoder.toUint8Array());
        // @note The rest encoder is appended! (note the missing var)
        $293cd0efd7645786$export$73b5e63e27d2b4c7(encoder, $293cd0efd7645786$export$73470fd2221e6aef(this.restEncoder));
        return $293cd0efd7645786$export$73470fd2221e6aef(encoder);
    }
    /**
   * @param {ID} id
   */ writeLeftID(id) {
        this.clientEncoder.write(id.client);
        this.leftClockEncoder.write(id.clock);
    }
    /**
   * @param {ID} id
   */ writeRightID(id) {
        this.clientEncoder.write(id.client);
        this.rightClockEncoder.write(id.clock);
    }
    /**
   * @param {number} client
   */ writeClient(client) {
        this.clientEncoder.write(client);
    }
    /**
   * @param {number} info An unsigned 8-bit integer
   */ writeInfo(info) {
        this.infoEncoder.write(info);
    }
    /**
   * @param {string} s
   */ writeString(s) {
        this.stringEncoder.write(s);
    }
    /**
   * @param {boolean} isYKey
   */ writeParentInfo(isYKey) {
        this.parentInfoEncoder.write(isYKey ? 1 : 0);
    }
    /**
   * @param {number} info An unsigned 8-bit integer
   */ writeTypeRef(info) {
        this.typeRefEncoder.write(info);
    }
    /**
   * Write len of a struct - well suited for Opt RLE encoder.
   *
   * @param {number} len
   */ writeLen(len) {
        this.lenEncoder.write(len);
    }
    /**
   * @param {any} any
   */ writeAny(any) {
        $293cd0efd7645786$export$264b1e8551468ea(this.restEncoder, any);
    }
    /**
   * @param {Uint8Array} buf
   */ writeBuf(buf) {
        $293cd0efd7645786$export$f7d11515275e88a2(this.restEncoder, buf);
    }
    /**
   * This is mainly here for legacy purposes.
   *
   * Initial we incoded objects using JSON. Now we use the much faster lib0/any-encoder. This method mainly exists for legacy purposes for the v1 encoder.
   *
   * @param {any} embed
   */ writeJSON(embed) {
        $293cd0efd7645786$export$264b1e8551468ea(this.restEncoder, embed);
    }
    /**
   * Property keys are often reused. For example, in y-prosemirror the key `bold` might
   * occur very often. For a 3d application, the key `position` might occur very often.
   *
   * We cache these keys in a Map and refer to them via a unique number.
   *
   * @param {string} key
   */ writeKey(key) {
        const clock = this.keyMap.get(key);
        if (clock === undefined) {
            /**
       * @todo uncomment to introduce this feature finally
       *
       * Background. The ContentFormat object was always encoded using writeKey, but the decoder used to use readString.
       * Furthermore, I forgot to set the keyclock. So everything was working fine.
       *
       * However, this feature here is basically useless as it is not being used (it actually only consumes extra memory).
       *
       * I don't know yet how to reintroduce this feature..
       *
       * Older clients won't be able to read updates when we reintroduce this feature. So this should probably be done using a flag.
       *
       */ // this.keyMap.set(key, this.keyClock)
            this.keyClockEncoder.write(this.keyClock++);
            this.stringEncoder.write(key);
        } else this.keyClockEncoder.write(clock);
    }
}
/**
 * @module encoding
 */ /*
 * We use the first five bits in the info flag for determining the type of the struct.
 *
 * 0: GC
 * 1: Item with Deleted content
 * 2: Item with JSON content
 * 3: Item with Binary content
 * 4: Item with String content
 * 5: Item with Embed content (for richtext content)
 * 6: Item with Format content (a formatting marker for richtext content)
 * 7: Item with Type
 */ /**
 * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
 * @param {Array<GC|Item>} structs All structs by `client`
 * @param {number} client
 * @param {number} clock write structs starting with `ID(client,clock)`
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$writeStructs = (encoder, structs, client, clock)=>{
    // write first id
    clock = $674380a05f97f4f3$export$8960430cfd85939f(clock, structs[0].id.clock); // make sure the first id exists
    const startNewStructs = $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, clock);
    // write # encoded structs
    $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, structs.length - startNewStructs);
    encoder.writeClient(client);
    $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, clock);
    const firstStruct = structs[startNewStructs];
    // write first struct with an offset
    firstStruct.write(encoder, clock - firstStruct.id.clock);
    for(let i = startNewStructs + 1; i < structs.length; i++)structs[i].write(encoder, 0);
};
/**
 * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
 * @param {StructStore} store
 * @param {Map<number,number>} _sm
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$writeClientsStructs = (encoder, store, _sm)=>{
    // we filter all valid _sm entries into sm
    const sm = new Map();
    _sm.forEach((clock, client)=>{
        // only write if new structs are available
        if ($42aaa4fd3d01b4df$export$50fdfeece43146fd(store, client) > clock) sm.set(client, clock);
    });
    $42aaa4fd3d01b4df$var$getStateVector(store).forEach((_clock, client)=>{
        if (!_sm.has(client)) sm.set(client, 0);
    });
    // write # states that were updated
    $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, sm.size);
    // Write items with higher client ids first
    // This heavily improves the conflict algorithm.
    $cfaabc628d0f476d$export$6788812c4e6611e6(sm.entries()).sort((a, b)=>b[0] - a[0]).forEach(([client, clock])=>{
        $42aaa4fd3d01b4df$var$writeStructs(encoder, /** @type {Array<GC|Item>} */ store.clients.get(client), client, clock);
    });
};
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder The decoder object to read data from.
 * @param {Doc} doc
 * @return {Map<number, { i: number, refs: Array<Item | GC> }>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readClientsStructRefs = (decoder, doc)=>{
    /**
   * @type {Map<number, { i: number, refs: Array<Item | GC> }>}
   */ const clientRefs = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    const numOfStateUpdates = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
    for(let i = 0; i < numOfStateUpdates; i++){
        const numberOfStructs = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        /**
     * @type {Array<GC|Item>}
     */ const refs = new Array(numberOfStructs);
        const client = decoder.readClient();
        let clock = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        // const start = performance.now()
        clientRefs.set(client, {
            i: 0,
            refs: refs
        });
        for(let i = 0; i < numberOfStructs; i++){
            const info = decoder.readInfo();
            switch($b27b7daa87337538$export$bc2aba63e4099c09 & info){
                case 0:
                    {
                        const len = decoder.readLen();
                        refs[i] = new $42aaa4fd3d01b4df$export$12d259ff017e6b58($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock), len);
                        clock += len;
                        break;
                    }
                case 10:
                    {
                        // @todo we could reduce the amount of checks by adding Skip struct to clientRefs so we know that something is missing.
                        const len = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
                        refs[i] = new $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock), len);
                        clock += len;
                        break;
                    }
                default:
                    {
                        /**
           * The optimized implementation doesn't use any variables because inlining variables is faster.
           * Below a non-optimized version is shown that implements the basic algorithm with
           * a few comments
           */ const cantCopyParentInfo = (info & ($b27b7daa87337538$export$eb5a8e0006ab4bb5 | $b27b7daa87337538$export$e25597372303a045)) === 0;
                        // If parent = null and neither left nor right are defined, then we know that `parent` is child of `y`
                        // and we read the next string as parentYKey.
                        // It indicates how we store/retrieve parent from `y.share`
                        // @type {string|null}
                        const struct = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock), null, (info & $b27b7daa87337538$export$e25597372303a045) === $b27b7daa87337538$export$e25597372303a045 ? decoder.readLeftID() : null, null, (info & $b27b7daa87337538$export$eb5a8e0006ab4bb5) === $b27b7daa87337538$export$eb5a8e0006ab4bb5 ? decoder.readRightID() : null, cantCopyParentInfo ? decoder.readParentInfo() ? doc.get(decoder.readString()) : decoder.readLeftID() : null, cantCopyParentInfo && (info & $b27b7daa87337538$export$daf23f774967089) === $b27b7daa87337538$export$daf23f774967089 ? decoder.readString() : null, $42aaa4fd3d01b4df$var$readItemContent(decoder, info) // item content
                        );
                        /* A non-optimized implementation of the above algorithm:

          // The item that was originally to the left of this item.
          const origin = (info & binary.BIT8) === binary.BIT8 ? decoder.readLeftID() : null
          // The item that was originally to the right of this item.
          const rightOrigin = (info & binary.BIT7) === binary.BIT7 ? decoder.readRightID() : null
          const cantCopyParentInfo = (info & (binary.BIT7 | binary.BIT8)) === 0
          const hasParentYKey = cantCopyParentInfo ? decoder.readParentInfo() : false
          // If parent = null and neither left nor right are defined, then we know that `parent` is child of `y`
          // and we read the next string as parentYKey.
          // It indicates how we store/retrieve parent from `y.share`
          // @type {string|null}
          const parentYKey = cantCopyParentInfo && hasParentYKey ? decoder.readString() : null

          const struct = new Item(
            createID(client, clock),
            null, // left
            origin, // origin
            null, // right
            rightOrigin, // right origin
            cantCopyParentInfo && !hasParentYKey ? decoder.readLeftID() : (parentYKey !== null ? doc.get(parentYKey) : null), // parent
            cantCopyParentInfo && (info & binary.BIT6) === binary.BIT6 ? decoder.readString() : null, // parentSub
            readItemContent(decoder, info) // item content
          )
          */ refs[i] = struct;
                        clock += struct.length;
                    }
            }
        }
    // console.log('time to read: ', performance.now() - start) // @todo remove
    }
    return clientRefs;
};
/**
 * Resume computing structs generated by struct readers.
 *
 * While there is something to do, we integrate structs in this order
 * 1. top element on stack, if stack is not empty
 * 2. next element from current struct reader (if empty, use next struct reader)
 *
 * If struct causally depends on another struct (ref.missing), we put next reader of
 * `ref.id.client` on top of stack.
 *
 * At some point we find a struct that has no causal dependencies,
 * then we start emptying the stack.
 *
 * It is not possible to have circles: i.e. struct1 (from client1) depends on struct2 (from client2)
 * depends on struct3 (from client1). Therefore the max stack size is eqaul to `structReaders.length`.
 *
 * This method is implemented in a way so that we can resume computation if this update
 * causally depends on another update.
 *
 * @param {Transaction} transaction
 * @param {StructStore} store
 * @param {Map<number, { i: number, refs: (GC | Item)[] }>} clientsStructRefs
 * @return { null | { update: Uint8Array, missing: Map<number,number> } }
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$integrateStructs = (transaction, store, clientsStructRefs)=>{
    /**
   * @type {Array<Item | GC>}
   */ const stack = [];
    // sort them so that we take the higher id first, in case of conflicts the lower id will probably not conflict with the id from the higher user.
    let clientsStructRefsIds = $cfaabc628d0f476d$export$6788812c4e6611e6(clientsStructRefs.keys()).sort((a, b)=>a - b);
    if (clientsStructRefsIds.length === 0) return null;
    const getNextStructTarget = ()=>{
        if (clientsStructRefsIds.length === 0) return null;
        let nextStructsTarget = /** @type {{i:number,refs:Array<GC|Item>}} */ clientsStructRefs.get(clientsStructRefsIds[clientsStructRefsIds.length - 1]);
        while(nextStructsTarget.refs.length === nextStructsTarget.i){
            clientsStructRefsIds.pop();
            if (clientsStructRefsIds.length > 0) nextStructsTarget = /** @type {{i:number,refs:Array<GC|Item>}} */ clientsStructRefs.get(clientsStructRefsIds[clientsStructRefsIds.length - 1]);
            else return null;
        }
        return nextStructsTarget;
    };
    let curStructsTarget = getNextStructTarget();
    if (curStructsTarget === null) return null;
    /**
   * @type {StructStore}
   */ const restStructs = new $42aaa4fd3d01b4df$var$StructStore();
    const missingSV = new Map();
    /**
   * @param {number} client
   * @param {number} clock
   */ const updateMissingSv = (client, clock)=>{
        const mclock = missingSV.get(client);
        if (mclock == null || mclock > clock) missingSV.set(client, clock);
    };
    /**
   * @type {GC|Item}
   */ let stackHead = /** @type {any} */ curStructsTarget.refs[/** @type {any} */ curStructsTarget.i++];
    // caching the state because it is used very often
    const state = new Map();
    const addStackToRestSS = ()=>{
        for (const item of stack){
            const client = item.id.client;
            const unapplicableItems = clientsStructRefs.get(client);
            if (unapplicableItems) {
                // decrement because we weren't able to apply previous operation
                unapplicableItems.i--;
                restStructs.clients.set(client, unapplicableItems.refs.slice(unapplicableItems.i));
                clientsStructRefs.delete(client);
                unapplicableItems.i = 0;
                unapplicableItems.refs = [];
            } else // item was the last item on clientsStructRefs and the field was already cleared. Add item to restStructs and continue
            restStructs.clients.set(client, [
                item
            ]);
            // remove client from clientsStructRefsIds to prevent users from applying the same update again
            clientsStructRefsIds = clientsStructRefsIds.filter((c)=>c !== client);
        }
        stack.length = 0;
    };
    // iterate over all struct readers until we are done
    while(true){
        if (stackHead.constructor !== $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0) {
            const localClock = $58ab1e30cc73aec7$export$dccd489362a8619(state, stackHead.id.client, ()=>$42aaa4fd3d01b4df$export$50fdfeece43146fd(store, stackHead.id.client));
            const offset = localClock - stackHead.id.clock;
            if (offset < 0) {
                // update from the same client is missing
                stack.push(stackHead);
                updateMissingSv(stackHead.id.client, stackHead.id.clock - 1);
                // hid a dead wall, add all items from stack to restSS
                addStackToRestSS();
            } else {
                const missing = stackHead.getMissing(transaction, store);
                if (missing !== null) {
                    stack.push(stackHead);
                    // get the struct reader that has the missing struct
                    /**
           * @type {{ refs: Array<GC|Item>, i: number }}
           */ const structRefs = clientsStructRefs.get(/** @type {number} */ missing) || {
                        refs: [],
                        i: 0
                    };
                    if (structRefs.refs.length === structRefs.i) {
                        // This update message causally depends on another update message that doesn't exist yet
                        updateMissingSv(/** @type {number} */ missing, $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, missing));
                        addStackToRestSS();
                    } else {
                        stackHead = structRefs.refs[structRefs.i++];
                        continue;
                    }
                } else if (offset === 0 || offset < stackHead.length) {
                    // all fine, apply the stackhead
                    stackHead.integrate(transaction, offset);
                    state.set(stackHead.id.client, stackHead.id.clock + stackHead.length);
                }
            }
        }
        // iterate to next stackHead
        if (stack.length > 0) stackHead = /** @type {GC|Item} */ stack.pop();
        else if (curStructsTarget !== null && curStructsTarget.i < curStructsTarget.refs.length) stackHead = /** @type {GC|Item} */ curStructsTarget.refs[curStructsTarget.i++];
        else {
            curStructsTarget = getNextStructTarget();
            if (curStructsTarget === null) break;
            else stackHead = /** @type {GC|Item} */ curStructsTarget.refs[curStructsTarget.i++];
        }
    }
    if (restStructs.clients.size > 0) {
        const encoder = new $42aaa4fd3d01b4df$export$30c99e08943e1c2();
        $42aaa4fd3d01b4df$var$writeClientsStructs(encoder, restStructs, new Map());
        // write empty deleteset
        // writeDeleteSet(encoder, new DeleteSet())
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, 0); // => no need for an extra function call, just write 0 deletes
        return {
            missing: missingSV,
            update: encoder.toUint8Array()
        };
    }
    return null;
};
/**
 * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
 * @param {Transaction} transaction
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$writeStructsFromTransaction = (encoder, transaction)=>$42aaa4fd3d01b4df$var$writeClientsStructs(encoder, transaction.doc.store, transaction.beforeState);
/**
 * Read and apply a document update.
 *
 * This function has the same effect as `applyUpdate` but accepts a decoder.
 *
 * @param {decoding.Decoder} decoder
 * @param {Doc} ydoc
 * @param {any} [transactionOrigin] This will be stored on `transaction.origin` and `.on('update', (update, origin))`
 * @param {UpdateDecoderV1 | UpdateDecoderV2} [structDecoder]
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$7abe492a0b891b4d = (decoder, ydoc, transactionOrigin, structDecoder = new $42aaa4fd3d01b4df$export$1c932452355c5571(decoder))=>$42aaa4fd3d01b4df$export$dac1bad6146b2469(ydoc, (transaction)=>{
        // force that transaction.local is set to non-local
        transaction.local = false;
        let retry = false;
        const doc = transaction.doc;
        const store = doc.store;
        // let start = performance.now()
        const ss = $42aaa4fd3d01b4df$var$readClientsStructRefs(structDecoder, doc);
        // console.log('time to read structs: ', performance.now() - start) // @todo remove
        // start = performance.now()
        // console.log('time to merge: ', performance.now() - start) // @todo remove
        // start = performance.now()
        const restStructs = $42aaa4fd3d01b4df$var$integrateStructs(transaction, store, ss);
        const pending = store.pendingStructs;
        if (pending) {
            // check if we can apply something
            for (const [client, clock] of pending.missing)if (clock < $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, client)) {
                retry = true;
                break;
            }
            if (restStructs) {
                // merge restStructs into store.pending
                for (const [client, clock] of restStructs.missing){
                    const mclock = pending.missing.get(client);
                    if (mclock == null || mclock > clock) pending.missing.set(client, clock);
                }
                pending.update = $42aaa4fd3d01b4df$export$ce273d78de0331d1([
                    pending.update,
                    restStructs.update
                ]);
            }
        } else store.pendingStructs = restStructs;
        // console.log('time to integrate: ', performance.now() - start) // @todo remove
        // start = performance.now()
        const dsRest = $42aaa4fd3d01b4df$var$readAndApplyDeleteSet(structDecoder, transaction, store);
        if (store.pendingDs) {
            // @todo we could make a lower-bound state-vector check as we do above
            const pendingDSUpdate = new $42aaa4fd3d01b4df$export$1c932452355c5571($e15498288f7f96ea$export$f8c898e83b60faaa(store.pendingDs));
            $e15498288f7f96ea$export$5a476e4dbe7923d5(pendingDSUpdate.restDecoder); // read 0 structs, because we only encode deletes in pendingdsupdate
            const dsRest2 = $42aaa4fd3d01b4df$var$readAndApplyDeleteSet(pendingDSUpdate, transaction, store);
            if (dsRest && dsRest2) // case 1: ds1 != null && ds2 != null
            store.pendingDs = $42aaa4fd3d01b4df$export$ce273d78de0331d1([
                dsRest,
                dsRest2
            ]);
            else // case 2: ds1 != null
            // case 3: ds2 != null
            // case 4: ds1 == null && ds2 == null
            store.pendingDs = dsRest || dsRest2;
        } else // Either dsRest == null && pendingDs == null OR dsRest != null
        store.pendingDs = dsRest;
        // console.log('time to cleanup: ', performance.now() - start) // @todo remove
        // start = performance.now()
        // console.log('time to resume delete readers: ', performance.now() - start) // @todo remove
        // start = performance.now()
        if (retry) {
            const update = /** @type {{update: Uint8Array}} */ store.pendingStructs.update;
            store.pendingStructs = null;
            $42aaa4fd3d01b4df$export$acc3b0324aabf1b6(transaction.doc, update);
        }
    }, transactionOrigin, false);
/**
 * Read and apply a document update.
 *
 * This function has the same effect as `applyUpdate` but accepts a decoder.
 *
 * @param {decoding.Decoder} decoder
 * @param {Doc} ydoc
 * @param {any} [transactionOrigin] This will be stored on `transaction.origin` and `.on('update', (update, origin))`
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$d67ac8d73b7d336c = (decoder, ydoc, transactionOrigin)=>$42aaa4fd3d01b4df$export$7abe492a0b891b4d(decoder, ydoc, transactionOrigin, new $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec(decoder));
/**
 * Apply a document update created by, for example, `y.on('update', update => ..)` or `update = encodeStateAsUpdate()`.
 *
 * This function has the same effect as `readUpdate` but accepts an Uint8Array instead of a Decoder.
 *
 * @param {Doc} ydoc
 * @param {Uint8Array} update
 * @param {any} [transactionOrigin] This will be stored on `transaction.origin` and `.on('update', (update, origin))`
 * @param {typeof UpdateDecoderV1 | typeof UpdateDecoderV2} [YDecoder]
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$acc3b0324aabf1b6 = (ydoc, update, transactionOrigin, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571)=>{
    const decoder = $e15498288f7f96ea$export$f8c898e83b60faaa(update);
    $42aaa4fd3d01b4df$export$7abe492a0b891b4d(decoder, ydoc, transactionOrigin, new YDecoder(decoder));
};
/**
 * Apply a document update created by, for example, `y.on('update', update => ..)` or `update = encodeStateAsUpdate()`.
 *
 * This function has the same effect as `readUpdate` but accepts an Uint8Array instead of a Decoder.
 *
 * @param {Doc} ydoc
 * @param {Uint8Array} update
 * @param {any} [transactionOrigin] This will be stored on `transaction.origin` and `.on('update', (update, origin))`
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$c271737a9c02e925 = (ydoc, update, transactionOrigin)=>$42aaa4fd3d01b4df$export$acc3b0324aabf1b6(ydoc, update, transactionOrigin, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec);
/**
 * Write all the document as a single update message. If you specify the state of the remote client (`targetStateVector`) it will
 * only write the operations that are missing.
 *
 * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
 * @param {Doc} doc
 * @param {Map<number,number>} [targetStateVector] The state of the target that receives the update. Leave empty to write all known structs
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$writeStateAsUpdate = (encoder, doc, targetStateVector = new Map())=>{
    $42aaa4fd3d01b4df$var$writeClientsStructs(encoder, doc.store, targetStateVector);
    $42aaa4fd3d01b4df$var$writeDeleteSet(encoder, $42aaa4fd3d01b4df$export$8450d668bec558e2(doc.store));
};
/**
 * Write all the document as a single update message that can be applied on the remote document. If you specify the state of the remote client (`targetState`) it will
 * only write the operations that are missing.
 *
 * Use `writeStateAsUpdate` instead if you are working with lib0/encoding.js#Encoder
 *
 * @param {Doc} doc
 * @param {Uint8Array} [encodedTargetStateVector] The state of the target that receives the update. Leave empty to write all known structs
 * @param {UpdateEncoderV1 | UpdateEncoderV2} [encoder]
 * @return {Uint8Array}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$90338e0798f6f64f = (doc, encodedTargetStateVector = new Uint8Array([
    0
]), encoder = new $42aaa4fd3d01b4df$export$30c99e08943e1c2())=>{
    const targetStateVector = $42aaa4fd3d01b4df$export$324ac6fb20a844e3(encodedTargetStateVector);
    $42aaa4fd3d01b4df$var$writeStateAsUpdate(encoder, doc, targetStateVector);
    const updates = [
        encoder.toUint8Array()
    ];
    // also add the pending updates (if there are any)
    if (doc.store.pendingDs) updates.push(doc.store.pendingDs);
    if (doc.store.pendingStructs) updates.push($42aaa4fd3d01b4df$export$a8143edf39d2ad8e(doc.store.pendingStructs.update, encodedTargetStateVector));
    if (updates.length > 1) {
        if (encoder.constructor === $42aaa4fd3d01b4df$export$99171b804d9c5b54) return $42aaa4fd3d01b4df$export$6319871659fd2460(updates.map((update, i)=>i === 0 ? update : $42aaa4fd3d01b4df$export$afffbdeed14adbd(update)));
        else if (encoder.constructor === $42aaa4fd3d01b4df$export$30c99e08943e1c2) return $42aaa4fd3d01b4df$export$ce273d78de0331d1(updates);
    }
    return updates[0];
};
/**
 * Write all the document as a single update message that can be applied on the remote document. If you specify the state of the remote client (`targetState`) it will
 * only write the operations that are missing.
 *
 * Use `writeStateAsUpdate` instead if you are working with lib0/encoding.js#Encoder
 *
 * @param {Doc} doc
 * @param {Uint8Array} [encodedTargetStateVector] The state of the target that receives the update. Leave empty to write all known structs
 * @return {Uint8Array}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$e5848df80e65bd53 = (doc, encodedTargetStateVector)=>$42aaa4fd3d01b4df$export$90338e0798f6f64f(doc, encodedTargetStateVector, new $42aaa4fd3d01b4df$export$99171b804d9c5b54());
/**
 * Read state vector from Decoder and return as Map
 *
 * @param {DSDecoderV1 | DSDecoderV2} decoder
 * @return {Map<number,number>} Maps `client` to the number next expected `clock` from that client.
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$readStateVector = (decoder)=>{
    const ss = new Map();
    const ssLength = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
    for(let i = 0; i < ssLength; i++){
        const client = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        const clock = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        ss.set(client, clock);
    }
    return ss;
};
/**
 * Read decodedState and return State as Map.
 *
 * @param {Uint8Array} decodedState
 * @return {Map<number,number>} Maps `client` to the number next expected `clock` from that client.
 *
 * @function
 */ // export const decodeStateVectorV2 = decodedState => readStateVector(new DSDecoderV2(decoding.createDecoder(decodedState)))
/**
 * Read decodedState and return State as Map.
 *
 * @param {Uint8Array} decodedState
 * @return {Map<number,number>} Maps `client` to the number next expected `clock` from that client.
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$324ac6fb20a844e3 = (decodedState)=>$42aaa4fd3d01b4df$var$readStateVector(new $42aaa4fd3d01b4df$var$DSDecoderV1($e15498288f7f96ea$export$f8c898e83b60faaa(decodedState)));
/**
 * @param {DSEncoderV1 | DSEncoderV2} encoder
 * @param {Map<number,number>} sv
 * @function
 */ const $42aaa4fd3d01b4df$var$writeStateVector = (encoder, sv)=>{
    $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, sv.size);
    $cfaabc628d0f476d$export$6788812c4e6611e6(sv.entries()).sort((a, b)=>b[0] - a[0]).forEach(([client, clock])=>{
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, client); // @todo use a special client decoder that is based on mapping
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, clock);
    });
    return encoder;
};
/**
 * @param {DSEncoderV1 | DSEncoderV2} encoder
 * @param {Doc} doc
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$writeDocumentStateVector = (encoder, doc)=>$42aaa4fd3d01b4df$var$writeStateVector(encoder, $42aaa4fd3d01b4df$var$getStateVector(doc.store));
/**
 * Encode State as Uint8Array.
 *
 * @param {Doc|Map<number,number>} doc
 * @param {DSEncoderV1 | DSEncoderV2} [encoder]
 * @return {Uint8Array}
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$encodeStateVectorV2 = (doc, encoder = new $42aaa4fd3d01b4df$var$DSEncoderV2())=>{
    if (doc instanceof Map) $42aaa4fd3d01b4df$var$writeStateVector(encoder, doc);
    else $42aaa4fd3d01b4df$var$writeDocumentStateVector(encoder, doc);
    return encoder.toUint8Array();
};
/**
 * Encode State as Uint8Array.
 *
 * @param {Doc|Map<number,number>} doc
 * @return {Uint8Array}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$3e2f5393f32e71f = (doc)=>$42aaa4fd3d01b4df$var$encodeStateVectorV2(doc, new $42aaa4fd3d01b4df$var$DSEncoderV1());
/**
 * General event handler implementation.
 *
 * @template ARG0, ARG1
 *
 * @private
 */ class $42aaa4fd3d01b4df$var$EventHandler {
    constructor(){
        /**
     * @type {Array<function(ARG0, ARG1):void>}
     */ this.l = [];
    }
}
/**
 * @template ARG0,ARG1
 * @returns {EventHandler<ARG0,ARG1>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$createEventHandler = ()=>new $42aaa4fd3d01b4df$var$EventHandler();
/**
 * Adds an event listener that is called when
 * {@link EventHandler#callEventListeners} is called.
 *
 * @template ARG0,ARG1
 * @param {EventHandler<ARG0,ARG1>} eventHandler
 * @param {function(ARG0,ARG1):void} f The event handler.
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$addEventHandlerListener = (eventHandler, f)=>eventHandler.l.push(f);
/**
 * Removes an event listener.
 *
 * @template ARG0,ARG1
 * @param {EventHandler<ARG0,ARG1>} eventHandler
 * @param {function(ARG0,ARG1):void} f The event handler that was added with
 *                     {@link EventHandler#addEventListener}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$removeEventHandlerListener = (eventHandler, f)=>{
    const l = eventHandler.l;
    const len = l.length;
    eventHandler.l = l.filter((g)=>f !== g);
    if (len === eventHandler.l.length) console.error('[yjs] Tried to remove event handler that doesn\'t exist.');
};
/**
 * Call all event listeners that were added via
 * {@link EventHandler#addEventListener}.
 *
 * @template ARG0,ARG1
 * @param {EventHandler<ARG0,ARG1>} eventHandler
 * @param {ARG0} arg0
 * @param {ARG1} arg1
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$callEventHandlerListeners = (eventHandler, arg0, arg1)=>$e2897672a487246a$export$9dd9a52f2dd5b9ce(eventHandler.l, [
        arg0,
        arg1
    ]);
class $42aaa4fd3d01b4df$export$8be180ec26319f9f {
    /**
   * @param {number} client client id
   * @param {number} clock unique per client id, continuous number
   */ constructor(client, clock){
        /**
     * Client id
     * @type {number}
     */ this.client = client;
        /**
     * unique per client id, continuous number
     * @type {number}
     */ this.clock = clock;
    }
}
/**
 * @param {ID | null} a
 * @param {ID | null} b
 * @return {boolean}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$c0af976e7e459c02 = (a, b)=>a === b || a !== null && b !== null && a.client === b.client && a.clock === b.clock;
/**
 * @param {number} client
 * @param {number} clock
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$6c7d4e6171d008d0 = (client, clock)=>new $42aaa4fd3d01b4df$export$8be180ec26319f9f(client, clock);
/**
 * @param {encoding.Encoder} encoder
 * @param {ID} id
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$writeID = (encoder, id)=>{
    $293cd0efd7645786$export$872f48c75febcd2b(encoder, id.client);
    $293cd0efd7645786$export$872f48c75febcd2b(encoder, id.clock);
};
/**
 * Read ID.
 * * If first varUint read is 0xFFFFFF a RootID is returned.
 * * Otherwise an ID is returned
 *
 * @param {decoding.Decoder} decoder
 * @return {ID}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readID = (decoder)=>$42aaa4fd3d01b4df$export$6c7d4e6171d008d0($e15498288f7f96ea$export$5a476e4dbe7923d5(decoder), $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder));
/**
 * The top types are mapped from y.share.get(keyname) => type.
 * `type` does not store any information about the `keyname`.
 * This function finds the correct `keyname` for `type` and throws otherwise.
 *
 * @param {AbstractType<any>} type
 * @return {string}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$e726a40920d54663 = (type)=>{
    // @ts-ignore _y must be defined, otherwise unexpected case
    for (const [key, value] of type.doc.share.entries()){
        if (value === type) return key;
    }
    throw $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
};
/**
 * Check if `parent` is a parent of `child`.
 *
 * @param {AbstractType<any>} parent
 * @param {Item|null} child
 * @return {Boolean} Whether `parent` is a parent of `child`.
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$3c81af374b054d6a = (parent, child)=>{
    while(child !== null){
        if (child.parent === parent) return true;
        child = /** @type {AbstractType<any>} */ child.parent._item;
    }
    return false;
};
/**
 * Convenient helper to log type information.
 *
 * Do not use in productive systems as the output can be immense!
 *
 * @param {AbstractType<any>} type
 */ const $42aaa4fd3d01b4df$export$e9068ad704ba2f79 = (type)=>{
    const res = [];
    let n = type._start;
    while(n){
        res.push(n);
        n = n.right;
    }
    console.log('Children: ', res);
    console.log('Children content: ', res.filter((m)=>!m.deleted).map((m)=>m.content));
};
class $42aaa4fd3d01b4df$export$b9e8b5fa1162ca4e {
    /**
   * @param {Doc} doc
   * @param {YMap<any>} [storeType]
   */ constructor(doc, storeType = doc.getMap('users')){
        /**
     * @type {Map<string,DeleteSet>}
     */ const dss = new Map();
        this.yusers = storeType;
        this.doc = doc;
        /**
     * Maps from clientid to userDescription
     *
     * @type {Map<number,string>}
     */ this.clients = new Map();
        this.dss = dss;
        /**
     * @param {YMap<any>} user
     * @param {string} userDescription
     */ const initUser = (user, userDescription)=>{
            /**
       * @type {YArray<Uint8Array>}
       */ const ds = user.get('ds');
            const ids = user.get('ids');
            const addClientId = /** @param {number} clientid */ (clientid)=>this.clients.set(clientid, userDescription);
            ds.observe(/** @param {YArrayEvent<any>} event */ (event)=>{
                event.changes.added.forEach((item)=>{
                    item.content.getContent().forEach((encodedDs)=>{
                        if (encodedDs instanceof Uint8Array) this.dss.set(userDescription, $42aaa4fd3d01b4df$export$b7826cadad53901e([
                            this.dss.get(userDescription) || $42aaa4fd3d01b4df$export$8cbac0d946238699(),
                            $42aaa4fd3d01b4df$var$readDeleteSet(new $42aaa4fd3d01b4df$var$DSDecoderV1($e15498288f7f96ea$export$f8c898e83b60faaa(encodedDs)))
                        ]));
                    });
                });
            });
            this.dss.set(userDescription, $42aaa4fd3d01b4df$export$b7826cadad53901e(ds.map((encodedDs)=>$42aaa4fd3d01b4df$var$readDeleteSet(new $42aaa4fd3d01b4df$var$DSDecoderV1($e15498288f7f96ea$export$f8c898e83b60faaa(encodedDs))))));
            ids.observe(/** @param {YArrayEvent<any>} event */ (event)=>event.changes.added.forEach((item)=>item.content.getContent().forEach(addClientId)));
            ids.forEach(addClientId);
        };
        // observe users
        storeType.observe((event)=>{
            event.keysChanged.forEach((userDescription)=>initUser(storeType.get(userDescription), userDescription));
        });
        // add intial data
        storeType.forEach(initUser);
    }
    /**
   * @param {Doc} doc
   * @param {number} clientid
   * @param {string} userDescription
   * @param {Object} conf
   * @param {function(Transaction, DeleteSet):boolean} [conf.filter]
   */ setUserMapping(doc, clientid, userDescription, { filter: filter = ()=>true } = {}) {
        const users = this.yusers;
        let user = users.get(userDescription);
        if (!user) {
            user = new $42aaa4fd3d01b4df$export$a5c7b93649eaf8f8();
            user.set('ids', new $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa());
            user.set('ds', new $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa());
            users.set(userDescription, user);
        }
        user.get('ids').push([
            clientid
        ]);
        users.observe((_event)=>{
            setTimeout(()=>{
                const userOverwrite = users.get(userDescription);
                if (userOverwrite !== user) {
                    // user was overwritten, port all data over to the next user object
                    // @todo Experiment with Y.Sets here
                    user = userOverwrite;
                    // @todo iterate over old type
                    this.clients.forEach((_userDescription, clientid)=>{
                        if (userDescription === _userDescription) user.get('ids').push([
                            clientid
                        ]);
                    });
                    const encoder = new $42aaa4fd3d01b4df$var$DSEncoderV1();
                    const ds = this.dss.get(userDescription);
                    if (ds) {
                        $42aaa4fd3d01b4df$var$writeDeleteSet(encoder, ds);
                        user.get('ds').push([
                            encoder.toUint8Array()
                        ]);
                    }
                }
            }, 0);
        });
        doc.on('afterTransaction', /** @param {Transaction} transaction */ (transaction)=>{
            setTimeout(()=>{
                const yds = user.get('ds');
                const ds = transaction.deleteSet;
                if (transaction.local && ds.clients.size > 0 && filter(transaction, ds)) {
                    const encoder = new $42aaa4fd3d01b4df$var$DSEncoderV1();
                    $42aaa4fd3d01b4df$var$writeDeleteSet(encoder, ds);
                    yds.push([
                        encoder.toUint8Array()
                    ]);
                }
            });
        });
    }
    /**
   * @param {number} clientid
   * @return {any}
   */ getUserByClientId(clientid) {
        return this.clients.get(clientid) || null;
    }
    /**
   * @param {ID} id
   * @return {string | null}
   */ getUserByDeletedId(id) {
        for (const [userDescription, ds] of this.dss.entries()){
            if ($42aaa4fd3d01b4df$export$dcb04af092e44fde(ds, id)) return userDescription;
        }
        return null;
    }
}
/**
 * A relative position is based on the Yjs model and is not affected by document changes.
 * E.g. If you place a relative position before a certain character, it will always point to this character.
 * If you place a relative position at the end of a type, it will always point to the end of the type.
 *
 * A numeric position is often unsuited for user selections, because it does not change when content is inserted
 * before or after.
 *
 * ```Insert(0, 'x')('a|bc') = 'xa|bc'``` Where | is the relative position.
 *
 * One of the properties must be defined.
 *
 * @example
 *   // Current cursor position is at position 10
 *   const relativePosition = createRelativePositionFromIndex(yText, 10)
 *   // modify yText
 *   yText.insert(0, 'abc')
 *   yText.delete(3, 10)
 *   // Compute the cursor position
 *   const absolutePosition = createAbsolutePositionFromRelativePosition(y, relativePosition)
 *   absolutePosition.type === yText // => true
 *   console.log('cursor location is ' + absolutePosition.index) // => cursor location is 3
 *
 */ class $42aaa4fd3d01b4df$export$da21a415c5907662 {
    /**
   * @param {ID|null} type
   * @param {string|null} tname
   * @param {ID|null} item
   * @param {number} assoc
   */ constructor(type, tname, item, assoc = 0){
        /**
     * @type {ID|null}
     */ this.type = type;
        /**
     * @type {string|null}
     */ this.tname = tname;
        /**
     * @type {ID | null}
     */ this.item = item;
        /**
     * A relative position is associated to a specific character. By default
     * assoc >= 0, the relative position is associated to the character
     * after the meant position.
     * I.e. position 1 in 'ab' is associated to character 'b'.
     *
     * If assoc < 0, then the relative position is associated to the caharacter
     * before the meant position.
     *
     * @type {number}
     */ this.assoc = assoc;
    }
}
/**
 * @param {RelativePosition} rpos
 * @return {any}
 */ const $42aaa4fd3d01b4df$export$a783b081767a452e = (rpos)=>{
    const json = {};
    if (rpos.type) json.type = rpos.type;
    if (rpos.tname) json.tname = rpos.tname;
    if (rpos.item) json.item = rpos.item;
    if (rpos.assoc != null) json.assoc = rpos.assoc;
    return json;
};
/**
 * @param {any} json
 * @return {RelativePosition}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$ddad8a1b8f7475d8 = (json)=>new $42aaa4fd3d01b4df$export$da21a415c5907662(json.type == null ? null : $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(json.type.client, json.type.clock), json.tname ?? null, json.item == null ? null : $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(json.item.client, json.item.clock), json.assoc == null ? 0 : json.assoc);
class $42aaa4fd3d01b4df$export$64c95a3fb7344864 {
    /**
   * @param {AbstractType<any>} type
   * @param {number} index
   * @param {number} [assoc]
   */ constructor(type, index, assoc = 0){
        /**
     * @type {AbstractType<any>}
     */ this.type = type;
        /**
     * @type {number}
     */ this.index = index;
        this.assoc = assoc;
    }
}
/**
 * @param {AbstractType<any>} type
 * @param {number} index
 * @param {number} [assoc]
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$createAbsolutePosition = (type, index, assoc = 0)=>new $42aaa4fd3d01b4df$export$64c95a3fb7344864(type, index, assoc);
/**
 * @param {AbstractType<any>} type
 * @param {ID|null} item
 * @param {number} [assoc]
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$createRelativePosition = (type, item, assoc)=>{
    let typeid = null;
    let tname = null;
    if (type._item === null) tname = $42aaa4fd3d01b4df$export$e726a40920d54663(type);
    else typeid = $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(type._item.id.client, type._item.id.clock);
    return new $42aaa4fd3d01b4df$export$da21a415c5907662(typeid, tname, item, assoc);
};
/**
 * Create a relativePosition based on a absolute position.
 *
 * @param {AbstractType<any>} type The base type (e.g. YText or YArray).
 * @param {number} index The absolute position.
 * @param {number} [assoc]
 * @return {RelativePosition}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$197e7d99e3857e88 = (type, index, assoc = 0)=>{
    let t = type._start;
    if (assoc < 0) {
        // associated to the left character or the beginning of a type, increment index if possible.
        if (index === 0) return $42aaa4fd3d01b4df$var$createRelativePosition(type, null, assoc);
        index--;
    }
    while(t !== null){
        if (!t.deleted && t.countable) {
            if (t.length > index) // case 1: found position somewhere in the linked list
            return $42aaa4fd3d01b4df$var$createRelativePosition(type, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(t.id.client, t.id.clock + index), assoc);
            index -= t.length;
        }
        if (t.right === null && assoc < 0) // left-associated position, return last available id
        return $42aaa4fd3d01b4df$var$createRelativePosition(type, t.lastId, assoc);
        t = t.right;
    }
    return $42aaa4fd3d01b4df$var$createRelativePosition(type, null, assoc);
};
/**
 * @param {encoding.Encoder} encoder
 * @param {RelativePosition} rpos
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$writeRelativePosition = (encoder, rpos)=>{
    const { type: type, tname: tname, item: item, assoc: assoc } = rpos;
    if (item !== null) {
        $293cd0efd7645786$export$872f48c75febcd2b(encoder, 0);
        $42aaa4fd3d01b4df$var$writeID(encoder, item);
    } else if (tname !== null) {
        // case 2: found position at the end of the list and type is stored in y.share
        $293cd0efd7645786$export$826a1a6619653272(encoder, 1);
        $293cd0efd7645786$export$dde49cb52d5f1650(encoder, tname);
    } else if (type !== null) {
        // case 3: found position at the end of the list and type is attached to an item
        $293cd0efd7645786$export$826a1a6619653272(encoder, 2);
        $42aaa4fd3d01b4df$var$writeID(encoder, type);
    } else throw $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
    $293cd0efd7645786$export$ff90f819e16cc9bb(encoder, assoc);
    return encoder;
};
/**
 * @param {RelativePosition} rpos
 * @return {Uint8Array}
 */ const $42aaa4fd3d01b4df$export$c5c95ef724203575 = (rpos)=>{
    const encoder = $293cd0efd7645786$export$4e76eeb6df88c889();
    $42aaa4fd3d01b4df$var$writeRelativePosition(encoder, rpos);
    return $293cd0efd7645786$export$73470fd2221e6aef(encoder);
};
/**
 * @param {decoding.Decoder} decoder
 * @return {RelativePosition}
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$readRelativePosition = (decoder)=>{
    let type = null;
    let tname = null;
    let itemID = null;
    switch($e15498288f7f96ea$export$5a476e4dbe7923d5(decoder)){
        case 0:
            // case 1: found position somewhere in the linked list
            itemID = $42aaa4fd3d01b4df$var$readID(decoder);
            break;
        case 1:
            // case 2: found position at the end of the list and type is stored in y.share
            tname = $e15498288f7f96ea$export$3b64b4d753b81ec2(decoder);
            break;
        case 2:
            // case 3: found position at the end of the list and type is attached to an item
            type = $42aaa4fd3d01b4df$var$readID(decoder);
    }
    const assoc = $e15498288f7f96ea$export$7ad75c69830b76d7(decoder) ? $e15498288f7f96ea$export$1dd5b9ddf6575ae8(decoder) : 0;
    return new $42aaa4fd3d01b4df$export$da21a415c5907662(type, tname, itemID, assoc);
};
/**
 * @param {Uint8Array} uint8Array
 * @return {RelativePosition}
 */ const $42aaa4fd3d01b4df$export$58a46cebc90e7851 = (uint8Array)=>$42aaa4fd3d01b4df$var$readRelativePosition($e15498288f7f96ea$export$f8c898e83b60faaa(uint8Array));
/**
 * Transform a relative position to an absolute position.
 *
 * If you want to share the relative position with other users, you should set
 * `followUndoneDeletions` to false to get consistent results across all clients.
 *
 * When calculating the absolute position, we try to follow the "undone deletions". This yields
 * better results for the user who performed undo. However, only the user who performed the undo
 * will get the better results, the other users don't know which operations recreated a deleted
 * range of content. There is more information in this ticket: https://github.com/yjs/yjs/issues/638
 *
 * @param {RelativePosition} rpos
 * @param {Doc} doc
 * @param {boolean} followUndoneDeletions - whether to follow undone deletions - see https://github.com/yjs/yjs/issues/638
 * @return {AbsolutePosition|null}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$8fc3152f62fb7ed1 = (rpos, doc, followUndoneDeletions = true)=>{
    const store = doc.store;
    const rightID = rpos.item;
    const typeID = rpos.type;
    const tname = rpos.tname;
    const assoc = rpos.assoc;
    let type = null;
    let index = 0;
    if (rightID !== null) {
        if ($42aaa4fd3d01b4df$export$50fdfeece43146fd(store, rightID.client) <= rightID.clock) return null;
        const res = followUndoneDeletions ? $42aaa4fd3d01b4df$var$followRedone(store, rightID) : {
            item: $42aaa4fd3d01b4df$export$f92dfeb71e9bb569(store, rightID),
            diff: 0
        };
        const right = res.item;
        if (!(right instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2)) return null;
        type = /** @type {AbstractType<any>} */ right.parent;
        if (type._item === null || !type._item.deleted) {
            index = right.deleted || !right.countable ? 0 : res.diff + (assoc >= 0 ? 0 : 1); // adjust position based on left association if necessary
            let n = right.left;
            while(n !== null){
                if (!n.deleted && n.countable) index += n.length;
                n = n.left;
            }
        }
    } else {
        if (tname !== null) type = doc.get(tname);
        else if (typeID !== null) {
            if ($42aaa4fd3d01b4df$export$50fdfeece43146fd(store, typeID.client) <= typeID.clock) // type does not exist yet
            return null;
            const { item: item } = followUndoneDeletions ? $42aaa4fd3d01b4df$var$followRedone(store, typeID) : {
                item: $42aaa4fd3d01b4df$export$f92dfeb71e9bb569(store, typeID)
            };
            if (item instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2 && item.content instanceof $42aaa4fd3d01b4df$export$e2e108cbe2e4f865) type = item.content.type;
            else // struct is garbage collected
            return null;
        } else throw $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
        if (assoc >= 0) index = type._length;
        else index = 0;
    }
    return $42aaa4fd3d01b4df$var$createAbsolutePosition(type, index, rpos.assoc);
};
/**
 * @param {RelativePosition|null} a
 * @param {RelativePosition|null} b
 * @return {boolean}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$fc8bd253c948b475 = (a, b)=>a === b || a !== null && b !== null && a.tname === b.tname && $42aaa4fd3d01b4df$export$c0af976e7e459c02(a.item, b.item) && $42aaa4fd3d01b4df$export$c0af976e7e459c02(a.type, b.type) && a.assoc === b.assoc;
class $42aaa4fd3d01b4df$export$c963130a5525248f {
    /**
   * @param {DeleteSet} ds
   * @param {Map<number,number>} sv state map
   */ constructor(ds, sv){
        /**
     * @type {DeleteSet}
     */ this.ds = ds;
        /**
     * State Map
     * @type {Map<number,number>}
     */ this.sv = sv;
    }
}
/**
 * @param {Snapshot} snap1
 * @param {Snapshot} snap2
 * @return {boolean}
 */ const $42aaa4fd3d01b4df$export$742742a0f55b273d = (snap1, snap2)=>{
    const ds1 = snap1.ds.clients;
    const ds2 = snap2.ds.clients;
    const sv1 = snap1.sv;
    const sv2 = snap2.sv;
    if (sv1.size !== sv2.size || ds1.size !== ds2.size) return false;
    for (const [key, value] of sv1.entries()){
        if (sv2.get(key) !== value) return false;
    }
    for (const [client, dsitems1] of ds1.entries()){
        const dsitems2 = ds2.get(client) || [];
        if (dsitems1.length !== dsitems2.length) return false;
        for(let i = 0; i < dsitems1.length; i++){
            const dsitem1 = dsitems1[i];
            const dsitem2 = dsitems2[i];
            if (dsitem1.clock !== dsitem2.clock || dsitem1.len !== dsitem2.len) return false;
        }
    }
    return true;
};
/**
 * @param {Snapshot} snapshot
 * @param {DSEncoderV1 | DSEncoderV2} [encoder]
 * @return {Uint8Array}
 */ const $42aaa4fd3d01b4df$export$b946cadc55f8e512 = (snapshot, encoder = new $42aaa4fd3d01b4df$var$DSEncoderV2())=>{
    $42aaa4fd3d01b4df$var$writeDeleteSet(encoder, snapshot.ds);
    $42aaa4fd3d01b4df$var$writeStateVector(encoder, snapshot.sv);
    return encoder.toUint8Array();
};
/**
 * @param {Snapshot} snapshot
 * @return {Uint8Array}
 */ const $42aaa4fd3d01b4df$export$a6d29989648e995 = (snapshot)=>$42aaa4fd3d01b4df$export$b946cadc55f8e512(snapshot, new $42aaa4fd3d01b4df$var$DSEncoderV1());
/**
 * @param {Uint8Array} buf
 * @param {DSDecoderV1 | DSDecoderV2} [decoder]
 * @return {Snapshot}
 */ const $42aaa4fd3d01b4df$export$b0049fa299f4f58e = (buf, decoder = new $42aaa4fd3d01b4df$var$DSDecoderV2($e15498288f7f96ea$export$f8c898e83b60faaa(buf)))=>{
    return new $42aaa4fd3d01b4df$export$c963130a5525248f($42aaa4fd3d01b4df$var$readDeleteSet(decoder), $42aaa4fd3d01b4df$var$readStateVector(decoder));
};
/**
 * @param {Uint8Array} buf
 * @return {Snapshot}
 */ const $42aaa4fd3d01b4df$export$5c696daccf32bd2e = (buf)=>$42aaa4fd3d01b4df$export$b0049fa299f4f58e(buf, new $42aaa4fd3d01b4df$var$DSDecoderV1($e15498288f7f96ea$export$f8c898e83b60faaa(buf)));
/**
 * @param {DeleteSet} ds
 * @param {Map<number,number>} sm
 * @return {Snapshot}
 */ const $42aaa4fd3d01b4df$export$548fae0445f878fd = (ds, sm)=>new $42aaa4fd3d01b4df$export$c963130a5525248f(ds, sm);
const $42aaa4fd3d01b4df$export$d4568a81dd107a34 = $42aaa4fd3d01b4df$export$548fae0445f878fd($42aaa4fd3d01b4df$export$8cbac0d946238699(), new Map());
/**
 * @param {Doc} doc
 * @return {Snapshot}
 */ const $42aaa4fd3d01b4df$export$b8801ea43165ed7d = (doc)=>$42aaa4fd3d01b4df$export$548fae0445f878fd($42aaa4fd3d01b4df$export$8450d668bec558e2(doc.store), $42aaa4fd3d01b4df$var$getStateVector(doc.store));
/**
 * @param {Item} item
 * @param {Snapshot|undefined} snapshot
 *
 * @protected
 * @function
 */ const $42aaa4fd3d01b4df$var$isVisible = (item, snapshot)=>snapshot === undefined ? !item.deleted : snapshot.sv.has(item.id.client) && (snapshot.sv.get(item.id.client) || 0) > item.id.clock && !$42aaa4fd3d01b4df$export$dcb04af092e44fde(snapshot.ds, item.id);
/**
 * @param {Transaction} transaction
 * @param {Snapshot} snapshot
 */ const $42aaa4fd3d01b4df$var$splitSnapshotAffectedStructs = (transaction, snapshot)=>{
    const meta = $58ab1e30cc73aec7$export$dccd489362a8619(transaction.meta, $42aaa4fd3d01b4df$var$splitSnapshotAffectedStructs, $ace4f15b64ff1dc0$export$185802fd694ee1f5);
    const store = transaction.doc.store;
    // check if we already split for this snapshot
    if (!meta.has(snapshot)) {
        snapshot.sv.forEach((clock, client)=>{
            if (clock < $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, client)) $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock));
        });
        $42aaa4fd3d01b4df$export$8afefebbaf4e4c78(transaction, snapshot.ds, (_item)=>{});
        meta.add(snapshot);
    }
};
/**
 * @example
 *  const ydoc = new Y.Doc({ gc: false })
 *  ydoc.getText().insert(0, 'world!')
 *  const snapshot = Y.snapshot(ydoc)
 *  ydoc.getText().insert(0, 'hello ')
 *  const restored = Y.createDocFromSnapshot(ydoc, snapshot)
 *  assert(restored.getText().toString() === 'world!')
 *
 * @param {Doc} originDoc
 * @param {Snapshot} snapshot
 * @param {Doc} [newDoc] Optionally, you may define the Yjs document that receives the data from originDoc
 * @return {Doc}
 */ const $42aaa4fd3d01b4df$export$5be4ae1e1e56a014 = (originDoc, snapshot, newDoc = new $42aaa4fd3d01b4df$export$bceacc74c2212615())=>{
    if (originDoc.gc) // we should not try to restore a GC-ed document, because some of the restored items might have their content deleted
    throw new Error('Garbage-collection must be disabled in `originDoc`!');
    const { sv: sv, ds: ds } = snapshot;
    const encoder = new $42aaa4fd3d01b4df$export$30c99e08943e1c2();
    originDoc.transact((transaction)=>{
        let size = 0;
        sv.forEach((clock)=>{
            if (clock > 0) size++;
        });
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, size);
        // splitting the structs before writing them to the encoder
        for (const [client, clock] of sv){
            if (clock === 0) continue;
            if (clock < $42aaa4fd3d01b4df$export$50fdfeece43146fd(originDoc.store, client)) $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock));
            const structs = originDoc.store.clients.get(client) || [];
            const lastStructIndex = $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, clock - 1);
            // write # encoded structs
            $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, lastStructIndex + 1);
            encoder.writeClient(client);
            // first clock written is 0
            $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, 0);
            for(let i = 0; i <= lastStructIndex; i++)structs[i].write(encoder, 0);
        }
        $42aaa4fd3d01b4df$var$writeDeleteSet(encoder, ds);
    });
    $42aaa4fd3d01b4df$export$acc3b0324aabf1b6(newDoc, encoder.toUint8Array(), 'snapshot');
    return newDoc;
};
/**
 * @param {Snapshot} snapshot
 * @param {Uint8Array} update
 * @param {typeof UpdateDecoderV2 | typeof UpdateDecoderV1} [YDecoder]
 */ const $42aaa4fd3d01b4df$var$snapshotContainsUpdateV2 = (snapshot, update, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571)=>{
    const updateDecoder = new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update));
    const lazyDecoder = new $42aaa4fd3d01b4df$var$LazyStructReader(updateDecoder, false);
    for(let curr = lazyDecoder.curr; curr !== null; curr = lazyDecoder.next()){
        if ((snapshot.sv.get(curr.id.client) || 0) < curr.id.clock + curr.length) return false;
    }
    const mergedDS = $42aaa4fd3d01b4df$export$b7826cadad53901e([
        snapshot.ds,
        $42aaa4fd3d01b4df$var$readDeleteSet(updateDecoder)
    ]);
    return $42aaa4fd3d01b4df$export$9697b72c46fd3a5d(snapshot.ds, mergedDS);
};
/**
 * @param {Snapshot} snapshot
 * @param {Uint8Array} update
 */ const $42aaa4fd3d01b4df$export$f938135bed5d8db7 = (snapshot, update)=>$42aaa4fd3d01b4df$var$snapshotContainsUpdateV2(snapshot, update, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec);
class $42aaa4fd3d01b4df$var$StructStore {
    constructor(){
        /**
     * @type {Map<number,Array<GC|Item>>}
     */ this.clients = new Map();
        /**
     * @type {null | { missing: Map<number, number>, update: Uint8Array }}
     */ this.pendingStructs = null;
        /**
     * @type {null | Uint8Array}
     */ this.pendingDs = null;
    }
}
/**
 * Return the states as a Map<client,clock>.
 * Note that clock refers to the next expected clock id.
 *
 * @param {StructStore} store
 * @return {Map<number,number>}
 *
 * @public
 * @function
 */ const $42aaa4fd3d01b4df$var$getStateVector = (store)=>{
    const sm = new Map();
    store.clients.forEach((structs, client)=>{
        const struct = structs[structs.length - 1];
        sm.set(client, struct.id.clock + struct.length);
    });
    return sm;
};
/**
 * @param {StructStore} store
 * @param {number} client
 * @return {number}
 *
 * @public
 * @function
 */ const $42aaa4fd3d01b4df$export$50fdfeece43146fd = (store, client)=>{
    const structs = store.clients.get(client);
    if (structs === undefined) return 0;
    const lastStruct = structs[structs.length - 1];
    return lastStruct.id.clock + lastStruct.length;
};
/**
 * @param {StructStore} store
 * @param {GC|Item} struct
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$addStruct = (store, struct)=>{
    let structs = store.clients.get(struct.id.client);
    if (structs === undefined) {
        structs = [];
        store.clients.set(struct.id.client, structs);
    } else {
        const lastStruct = structs[structs.length - 1];
        if (lastStruct.id.clock + lastStruct.length !== struct.id.clock) throw $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
    }
    structs.push(struct);
};
/**
 * Perform a binary search on a sorted array
 * @param {Array<Item|GC>} structs
 * @param {number} clock
 * @return {number}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$5f8f02523cf47b58 = (structs, clock)=>{
    let left = 0;
    let right = structs.length - 1;
    let mid = structs[right];
    let midclock = mid.id.clock;
    if (midclock === clock) return right;
    // @todo does it even make sense to pivot the search?
    // If a good split misses, it might actually increase the time to find the correct item.
    // Currently, the only advantage is that search with pivoting might find the item on the first try.
    let midindex = $674380a05f97f4f3$export$a3fe094919f356fd(clock / (midclock + mid.length - 1) * right); // pivoting the search
    while(left <= right){
        mid = structs[midindex];
        midclock = mid.id.clock;
        if (midclock <= clock) {
            if (clock < midclock + mid.length) return midindex;
            left = midindex + 1;
        } else right = midindex - 1;
        midindex = $674380a05f97f4f3$export$a3fe094919f356fd((left + right) / 2);
    }
    // Always check state before looking for a struct in StructStore
    // Therefore the case of not finding a struct is unexpected
    throw $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
};
/**
 * Expects that id is actually in store. This function throws or is an infinite loop otherwise.
 *
 * @param {StructStore} store
 * @param {ID} id
 * @return {GC|Item}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$find = (store, id)=>{
    /**
   * @type {Array<GC|Item>}
   */ // @ts-ignore
    const structs = store.clients.get(id.client);
    return structs[$42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, id.clock)];
};
/**
 * Expects that id is actually in store. This function throws or is an infinite loop otherwise.
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$f92dfeb71e9bb569 = /** @type {function(StructStore,ID):Item} */ $42aaa4fd3d01b4df$var$find;
/**
 * @param {Transaction} transaction
 * @param {Array<Item|GC>} structs
 * @param {number} clock
 */ const $42aaa4fd3d01b4df$var$findIndexCleanStart = (transaction, structs, clock)=>{
    const index = $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, clock);
    const struct = structs[index];
    if (struct.id.clock < clock && struct instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2) {
        structs.splice(index + 1, 0, $42aaa4fd3d01b4df$var$splitItem(transaction, struct, clock - struct.id.clock));
        return index + 1;
    }
    return index;
};
/**
 * Expects that id is actually in store. This function throws or is an infinite loop otherwise.
 *
 * @param {Transaction} transaction
 * @param {ID} id
 * @return {Item}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$getItemCleanStart = (transaction, id)=>{
    const structs = /** @type {Array<Item>} */ transaction.doc.store.clients.get(id.client);
    return structs[$42aaa4fd3d01b4df$var$findIndexCleanStart(transaction, structs, id.clock)];
};
/**
 * Expects that id is actually in store. This function throws or is an infinite loop otherwise.
 *
 * @param {Transaction} transaction
 * @param {StructStore} store
 * @param {ID} id
 * @return {Item}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$getItemCleanEnd = (transaction, store, id)=>{
    /**
   * @type {Array<Item>}
   */ // @ts-ignore
    const structs = store.clients.get(id.client);
    const index = $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, id.clock);
    const struct = structs[index];
    if (id.clock !== struct.id.clock + struct.length - 1 && struct.constructor !== $42aaa4fd3d01b4df$export$12d259ff017e6b58) structs.splice(index + 1, 0, $42aaa4fd3d01b4df$var$splitItem(transaction, struct, id.clock - struct.id.clock + 1));
    return struct;
};
/**
 * Replace `item` with `newitem` in store
 * @param {StructStore} store
 * @param {GC|Item} struct
 * @param {GC|Item} newStruct
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$replaceStruct = (store, struct, newStruct)=>{
    const structs = /** @type {Array<GC|Item>} */ store.clients.get(struct.id.client);
    structs[$42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, struct.id.clock)] = newStruct;
};
/**
 * Iterate over a range of structs
 *
 * @param {Transaction} transaction
 * @param {Array<Item|GC>} structs
 * @param {number} clockStart Inclusive start
 * @param {number} len
 * @param {function(GC|Item):void} f
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$iterateStructs = (transaction, structs, clockStart, len, f)=>{
    if (len === 0) return;
    const clockEnd = clockStart + len;
    let index = $42aaa4fd3d01b4df$var$findIndexCleanStart(transaction, structs, clockStart);
    let struct;
    do {
        struct = structs[index++];
        if (clockEnd < struct.id.clock + struct.length) $42aaa4fd3d01b4df$var$findIndexCleanStart(transaction, structs, clockEnd);
        f(struct);
    }while (index < structs.length && structs[index].id.clock < clockEnd);
};
/**
 * A transaction is created for every change on the Yjs model. It is possible
 * to bundle changes on the Yjs model in a single transaction to
 * minimize the number on messages sent and the number of observer calls.
 * If possible the user of this library should bundle as many changes as
 * possible. Here is an example to illustrate the advantages of bundling:
 *
 * @example
 * const ydoc = new Y.Doc()
 * const map = ydoc.getMap('map')
 * // Log content when change is triggered
 * map.observe(() => {
 *   console.log('change triggered')
 * })
 * // Each change on the map type triggers a log message:
 * map.set('a', 0) // => "change triggered"
 * map.set('b', 0) // => "change triggered"
 * // When put in a transaction, it will trigger the log after the transaction:
 * ydoc.transact(() => {
 *   map.set('a', 1)
 *   map.set('b', 1)
 * }) // => "change triggered"
 *
 * @public
 */ class $42aaa4fd3d01b4df$export$febc5573c75cefb0 {
    /**
   * @param {Doc} doc
   * @param {any} origin
   * @param {boolean} local
   */ constructor(doc, origin, local){
        /**
     * The Yjs instance.
     * @type {Doc}
     */ this.doc = doc;
        /**
     * Describes the set of deleted items by ids
     * @type {DeleteSet}
     */ this.deleteSet = new $42aaa4fd3d01b4df$var$DeleteSet();
        /**
     * Holds the state before the transaction started.
     * @type {Map<Number,Number>}
     */ this.beforeState = $42aaa4fd3d01b4df$var$getStateVector(doc.store);
        /**
     * Holds the state after the transaction.
     * @type {Map<Number,Number>}
     */ this.afterState = new Map();
        /**
     * All types that were directly modified (property added or child
     * inserted/deleted). New types are not included in this Set.
     * Maps from type to parentSubs (`item.parentSub = null` for YArray)
     * @type {Map<AbstractType<YEvent<any>>,Set<String|null>>}
     */ this.changed = new Map();
        /**
     * Stores the events for the types that observe also child elements.
     * It is mainly used by `observeDeep`.
     * @type {Map<AbstractType<YEvent<any>>,Array<YEvent<any>>>}
     */ this.changedParentTypes = new Map();
        /**
     * @type {Array<AbstractStruct>}
     */ this._mergeStructs = [];
        /**
     * @type {any}
     */ this.origin = origin;
        /**
     * Stores meta information on the transaction
     * @type {Map<any,any>}
     */ this.meta = new Map();
        /**
     * Whether this change originates from this doc.
     * @type {boolean}
     */ this.local = local;
        /**
     * @type {Set<Doc>}
     */ this.subdocsAdded = new Set();
        /**
     * @type {Set<Doc>}
     */ this.subdocsRemoved = new Set();
        /**
     * @type {Set<Doc>}
     */ this.subdocsLoaded = new Set();
        /**
     * @type {boolean}
     */ this._needFormattingCleanup = false;
    }
}
/**
 * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
 * @param {Transaction} transaction
 * @return {boolean} Whether data was written.
 */ const $42aaa4fd3d01b4df$var$writeUpdateMessageFromTransaction = (encoder, transaction)=>{
    if (transaction.deleteSet.clients.size === 0 && !$58ab1e30cc73aec7$export$4154a199d7d90455(transaction.afterState, (clock, client)=>transaction.beforeState.get(client) !== clock)) return false;
    $42aaa4fd3d01b4df$var$sortAndMergeDeleteSet(transaction.deleteSet);
    $42aaa4fd3d01b4df$var$writeStructsFromTransaction(encoder, transaction);
    $42aaa4fd3d01b4df$var$writeDeleteSet(encoder, transaction.deleteSet);
    return true;
};
/**
 * If `type.parent` was added in current transaction, `type` technically
 * did not change, it was just added and we should not fire events for `type`.
 *
 * @param {Transaction} transaction
 * @param {AbstractType<YEvent<any>>} type
 * @param {string|null} parentSub
 */ const $42aaa4fd3d01b4df$var$addChangedTypeToTransaction = (transaction, type, parentSub)=>{
    const item = type._item;
    if (item === null || item.id.clock < (transaction.beforeState.get(item.id.client) || 0) && !item.deleted) $58ab1e30cc73aec7$export$dccd489362a8619(transaction.changed, type, $ace4f15b64ff1dc0$export$185802fd694ee1f5).add(parentSub);
};
/**
 * @param {Array<AbstractStruct>} structs
 * @param {number} pos
 * @return {number} # of merged structs
 */ const $42aaa4fd3d01b4df$var$tryToMergeWithLefts = (structs, pos)=>{
    let right = structs[pos];
    let left = structs[pos - 1];
    let i = pos;
    for(; i > 0; right = left, left = structs[--i - 1]){
        if (left.deleted === right.deleted && left.constructor === right.constructor) {
            if (left.mergeWith(right)) {
                if (right instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2 && right.parentSub !== null && /** @type {AbstractType<any>} */ right.parent._map.get(right.parentSub) === right) /** @type {AbstractType<any>} */ right.parent._map.set(right.parentSub, /** @type {Item} */ left);
                continue;
            }
        }
        break;
    }
    const merged = pos - i;
    if (merged) // remove all merged structs from the array
    structs.splice(pos + 1 - merged, merged);
    return merged;
};
/**
 * @param {DeleteSet} ds
 * @param {StructStore} store
 * @param {function(Item):boolean} gcFilter
 */ const $42aaa4fd3d01b4df$var$tryGcDeleteSet = (ds, store, gcFilter)=>{
    for (const [client, deleteItems] of ds.clients.entries()){
        const structs = /** @type {Array<GC|Item>} */ store.clients.get(client);
        for(let di = deleteItems.length - 1; di >= 0; di--){
            const deleteItem = deleteItems[di];
            const endDeleteItemClock = deleteItem.clock + deleteItem.len;
            for(let si = $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, deleteItem.clock), struct = structs[si]; si < structs.length && struct.id.clock < endDeleteItemClock; struct = structs[++si]){
                const struct = structs[si];
                if (deleteItem.clock + deleteItem.len <= struct.id.clock) break;
                if (struct instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2 && struct.deleted && !struct.keep && gcFilter(struct)) struct.gc(store, false);
            }
        }
    }
};
/**
 * @param {DeleteSet} ds
 * @param {StructStore} store
 */ const $42aaa4fd3d01b4df$var$tryMergeDeleteSet = (ds, store)=>{
    // try to merge deleted / gc'd items
    // merge from right to left for better efficiency and so we don't miss any merge targets
    ds.clients.forEach((deleteItems, client)=>{
        const structs = /** @type {Array<GC|Item>} */ store.clients.get(client);
        for(let di = deleteItems.length - 1; di >= 0; di--){
            const deleteItem = deleteItems[di];
            // start with merging the item next to the last deleted item
            const mostRightIndexToCheck = $674380a05f97f4f3$export$96ec731ed4dcb222(structs.length - 1, 1 + $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, deleteItem.clock + deleteItem.len - 1));
            for(let si = mostRightIndexToCheck, struct = structs[si]; si > 0 && struct.id.clock >= deleteItem.clock; struct = structs[si])si -= 1 + $42aaa4fd3d01b4df$var$tryToMergeWithLefts(structs, si);
        }
    });
};
/**
 * @param {DeleteSet} ds
 * @param {StructStore} store
 * @param {function(Item):boolean} gcFilter
 */ const $42aaa4fd3d01b4df$export$c2e5de00fc43f658 = (ds, store, gcFilter)=>{
    $42aaa4fd3d01b4df$var$tryGcDeleteSet(ds, store, gcFilter);
    $42aaa4fd3d01b4df$var$tryMergeDeleteSet(ds, store);
};
/**
 * @param {Array<Transaction>} transactionCleanups
 * @param {number} i
 */ const $42aaa4fd3d01b4df$var$cleanupTransactions = (transactionCleanups, i)=>{
    if (i < transactionCleanups.length) {
        const transaction = transactionCleanups[i];
        const doc = transaction.doc;
        const store = doc.store;
        const ds = transaction.deleteSet;
        const mergeStructs = transaction._mergeStructs;
        try {
            $42aaa4fd3d01b4df$var$sortAndMergeDeleteSet(ds);
            transaction.afterState = $42aaa4fd3d01b4df$var$getStateVector(transaction.doc.store);
            doc.emit('beforeObserverCalls', [
                transaction,
                doc
            ]);
            /**
       * An array of event callbacks.
       *
       * Each callback is called even if the other ones throw errors.
       *
       * @type {Array<function():void>}
       */ const fs = [];
            // observe events on changed types
            transaction.changed.forEach((subs, itemtype)=>fs.push(()=>{
                    if (itemtype._item === null || !itemtype._item.deleted) itemtype._callObserver(transaction, subs);
                }));
            fs.push(()=>{
                // deep observe events
                transaction.changedParentTypes.forEach((events, type)=>{
                    // We need to think about the possibility that the user transforms the
                    // Y.Doc in the event.
                    if (type._dEH.l.length > 0 && (type._item === null || !type._item.deleted)) {
                        events = events.filter((event)=>event.target._item === null || !event.target._item.deleted);
                        events.forEach((event)=>{
                            event.currentTarget = type;
                            // path is relative to the current target
                            event._path = null;
                        });
                        // sort events by path length so that top-level events are fired first.
                        events.sort((event1, event2)=>event1.path.length - event2.path.length);
                        // We don't need to check for events.length
                        // because we know it has at least one element
                        $42aaa4fd3d01b4df$var$callEventHandlerListeners(type._dEH, events, transaction);
                    }
                });
            });
            fs.push(()=>doc.emit('afterTransaction', [
                    transaction,
                    doc
                ]));
            (0, $e2897672a487246a$export$9dd9a52f2dd5b9ce)(fs, []);
            if (transaction._needFormattingCleanup) $42aaa4fd3d01b4df$var$cleanupYTextAfterTransaction(transaction);
        } finally{
            // Replace deleted items with ItemDeleted / GC.
            // This is where content is actually remove from the Yjs Doc.
            if (doc.gc) $42aaa4fd3d01b4df$var$tryGcDeleteSet(ds, store, doc.gcFilter);
            $42aaa4fd3d01b4df$var$tryMergeDeleteSet(ds, store);
            // on all affected store.clients props, try to merge
            transaction.afterState.forEach((clock, client)=>{
                const beforeClock = transaction.beforeState.get(client) || 0;
                if (beforeClock !== clock) {
                    const structs = /** @type {Array<GC|Item>} */ store.clients.get(client);
                    // we iterate from right to left so we can safely remove entries
                    const firstChangePos = $674380a05f97f4f3$export$8960430cfd85939f($42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, beforeClock), 1);
                    for(let i = structs.length - 1; i >= firstChangePos;)i -= 1 + $42aaa4fd3d01b4df$var$tryToMergeWithLefts(structs, i);
                }
            });
            // try to merge mergeStructs
            // @todo: it makes more sense to transform mergeStructs to a DS, sort it, and merge from right to left
            //        but at the moment DS does not handle duplicates
            for(let i = mergeStructs.length - 1; i >= 0; i--){
                const { client: client, clock: clock } = mergeStructs[i].id;
                const structs = /** @type {Array<GC|Item>} */ store.clients.get(client);
                const replacedStructPos = $42aaa4fd3d01b4df$export$5f8f02523cf47b58(structs, clock);
                if (replacedStructPos + 1 < structs.length) {
                    if ($42aaa4fd3d01b4df$var$tryToMergeWithLefts(structs, replacedStructPos + 1) > 1) continue; // no need to perform next check, both are already merged
                }
                if (replacedStructPos > 0) $42aaa4fd3d01b4df$var$tryToMergeWithLefts(structs, replacedStructPos);
            }
            if (!transaction.local && transaction.afterState.get(doc.clientID) !== transaction.beforeState.get(doc.clientID)) {
                $0b4450a4ff92533f$export$c2d084dc44961371($3b74996164ee31b1$export$3de5e29ed1757f9b, $3b74996164ee31b1$export$c1286c4c2a7c066, '[yjs] ', $3b74996164ee31b1$export$f0ce1666bb40789b, $3b74996164ee31b1$export$aa201224bb439d47, 'Changed the client-id because another client seems to be using it.');
                doc.clientID = $42aaa4fd3d01b4df$var$generateNewClientId();
            }
            // @todo Merge all the transactions into one and provide send the data as a single update message
            doc.emit('afterTransactionCleanup', [
                transaction,
                doc
            ]);
            if (doc._observers.has('update')) {
                const encoder = new $42aaa4fd3d01b4df$export$99171b804d9c5b54();
                const hasContent = $42aaa4fd3d01b4df$var$writeUpdateMessageFromTransaction(encoder, transaction);
                if (hasContent) doc.emit('update', [
                    encoder.toUint8Array(),
                    transaction.origin,
                    doc,
                    transaction
                ]);
            }
            if (doc._observers.has('updateV2')) {
                const encoder = new $42aaa4fd3d01b4df$export$30c99e08943e1c2();
                const hasContent = $42aaa4fd3d01b4df$var$writeUpdateMessageFromTransaction(encoder, transaction);
                if (hasContent) doc.emit('updateV2', [
                    encoder.toUint8Array(),
                    transaction.origin,
                    doc,
                    transaction
                ]);
            }
            const { subdocsAdded: subdocsAdded, subdocsLoaded: subdocsLoaded, subdocsRemoved: subdocsRemoved } = transaction;
            if (subdocsAdded.size > 0 || subdocsRemoved.size > 0 || subdocsLoaded.size > 0) {
                subdocsAdded.forEach((subdoc)=>{
                    subdoc.clientID = doc.clientID;
                    if (subdoc.collectionid == null) subdoc.collectionid = doc.collectionid;
                    doc.subdocs.add(subdoc);
                });
                subdocsRemoved.forEach((subdoc)=>doc.subdocs.delete(subdoc));
                doc.emit('subdocs', [
                    {
                        loaded: subdocsLoaded,
                        added: subdocsAdded,
                        removed: subdocsRemoved
                    },
                    doc,
                    transaction
                ]);
                subdocsRemoved.forEach((subdoc)=>subdoc.destroy());
            }
            if (transactionCleanups.length <= i + 1) {
                doc._transactionCleanups = [];
                doc.emit('afterAllTransactions', [
                    doc,
                    transactionCleanups
                ]);
            } else $42aaa4fd3d01b4df$var$cleanupTransactions(transactionCleanups, i + 1);
        }
    }
};
/**
 * Implements the functionality of `y.transact(()=>{..})`
 *
 * @template T
 * @param {Doc} doc
 * @param {function(Transaction):T} f
 * @param {any} [origin=true]
 * @return {T}
 *
 * @function
 */ const $42aaa4fd3d01b4df$export$dac1bad6146b2469 = (doc, f, origin = null, local = true)=>{
    const transactionCleanups = doc._transactionCleanups;
    let initialCall = false;
    /**
   * @type {any}
   */ let result = null;
    if (doc._transaction === null) {
        initialCall = true;
        doc._transaction = new $42aaa4fd3d01b4df$export$febc5573c75cefb0(doc, origin, local);
        transactionCleanups.push(doc._transaction);
        if (transactionCleanups.length === 1) doc.emit('beforeAllTransactions', [
            doc
        ]);
        doc.emit('beforeTransaction', [
            doc._transaction,
            doc
        ]);
    }
    try {
        result = f(doc._transaction);
    } finally{
        if (initialCall) {
            const finishCleanup = doc._transaction === transactionCleanups[0];
            doc._transaction = null;
            if (finishCleanup) // The first transaction ended, now process observer calls.
            // Observer call may create new transactions for which we need to call the observers and do cleanup.
            // We don't want to nest these calls, so we execute these calls one after
            // another.
            // Also we need to ensure that all cleanups are called, even if the
            // observes throw errors.
            // This file is full of hacky try {} finally {} blocks to ensure that an
            // event can throw errors and also that the cleanup is called.
            $42aaa4fd3d01b4df$var$cleanupTransactions(transactionCleanups, 0);
        }
    }
    return result;
};
class $42aaa4fd3d01b4df$var$StackItem {
    /**
   * @param {DeleteSet} deletions
   * @param {DeleteSet} insertions
   */ constructor(deletions, insertions){
        this.insertions = insertions;
        this.deletions = deletions;
        /**
     * Use this to save and restore metadata like selection range
     */ this.meta = new Map();
    }
}
/**
 * @param {Transaction} tr
 * @param {UndoManager} um
 * @param {StackItem} stackItem
 */ const $42aaa4fd3d01b4df$var$clearUndoManagerStackItem = (tr, um, stackItem)=>{
    $42aaa4fd3d01b4df$export$8afefebbaf4e4c78(tr, stackItem.deletions, (item)=>{
        if (item instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2 && um.scope.some((type)=>$42aaa4fd3d01b4df$export$3c81af374b054d6a(type, item))) $42aaa4fd3d01b4df$var$keepItem(item, false);
    });
};
/**
 * @param {UndoManager} undoManager
 * @param {Array<StackItem>} stack
 * @param {'undo'|'redo'} eventType
 * @return {StackItem?}
 */ const $42aaa4fd3d01b4df$var$popStackItem = (undoManager, stack, eventType)=>{
    /**
   * Keep a reference to the transaction so we can fire the event with the changedParentTypes
   * @type {any}
   */ let _tr = null;
    const doc = undoManager.doc;
    const scope = undoManager.scope;
    $42aaa4fd3d01b4df$export$dac1bad6146b2469(doc, (transaction)=>{
        while(stack.length > 0 && undoManager.currStackItem === null){
            const store = doc.store;
            const stackItem = /** @type {StackItem} */ stack.pop();
            /**
       * @type {Set<Item>}
       */ const itemsToRedo = new Set();
            /**
       * @type {Array<Item>}
       */ const itemsToDelete = [];
            let performedChange = false;
            $42aaa4fd3d01b4df$export$8afefebbaf4e4c78(transaction, stackItem.insertions, (struct)=>{
                if (struct instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2) {
                    if (struct.redone !== null) {
                        let { item: item, diff: diff } = $42aaa4fd3d01b4df$var$followRedone(store, struct.id);
                        if (diff > 0) item = $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(item.id.client, item.id.clock + diff));
                        struct = item;
                    }
                    if (!struct.deleted && scope.some((type)=>$42aaa4fd3d01b4df$export$3c81af374b054d6a(type, /** @type {Item} */ struct))) itemsToDelete.push(struct);
                }
            });
            $42aaa4fd3d01b4df$export$8afefebbaf4e4c78(transaction, stackItem.deletions, (struct)=>{
                if (struct instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2 && scope.some((type)=>$42aaa4fd3d01b4df$export$3c81af374b054d6a(type, struct)) && // Never redo structs in stackItem.insertions because they were created and deleted in the same capture interval.
                !$42aaa4fd3d01b4df$export$dcb04af092e44fde(stackItem.insertions, struct.id)) itemsToRedo.add(struct);
            });
            itemsToRedo.forEach((struct)=>{
                performedChange = $42aaa4fd3d01b4df$var$redoItem(transaction, struct, itemsToRedo, stackItem.insertions, undoManager.ignoreRemoteMapChanges, undoManager) !== null || performedChange;
            });
            // We want to delete in reverse order so that children are deleted before
            // parents, so we have more information available when items are filtered.
            for(let i = itemsToDelete.length - 1; i >= 0; i--){
                const item = itemsToDelete[i];
                if (undoManager.deleteFilter(item)) {
                    item.delete(transaction);
                    performedChange = true;
                }
            }
            undoManager.currStackItem = performedChange ? stackItem : null;
        }
        transaction.changed.forEach((subProps, type)=>{
            // destroy search marker if necessary
            if (subProps.has(null) && type._searchMarker) type._searchMarker.length = 0;
        });
        _tr = transaction;
    }, undoManager);
    const res = undoManager.currStackItem;
    if (res != null) {
        const changedParentTypes = _tr.changedParentTypes;
        undoManager.emit('stack-item-popped', [
            {
                stackItem: res,
                type: eventType,
                changedParentTypes: changedParentTypes,
                origin: undoManager
            },
            undoManager
        ]);
        undoManager.currStackItem = null;
    }
    return res;
};
/**
 * @typedef {Object} UndoManagerOptions
 * @property {number} [UndoManagerOptions.captureTimeout=500]
 * @property {function(Transaction):boolean} [UndoManagerOptions.captureTransaction] Do not capture changes of a Transaction if result false.
 * @property {function(Item):boolean} [UndoManagerOptions.deleteFilter=()=>true] Sometimes
 * it is necessary to filter what an Undo/Redo operation can delete. If this
 * filter returns false, the type/item won't be deleted even it is in the
 * undo/redo scope.
 * @property {Set<any>} [UndoManagerOptions.trackedOrigins=new Set([null])]
 * @property {boolean} [ignoreRemoteMapChanges] Experimental. By default, the UndoManager will never overwrite remote changes. Enable this property to enable overwriting remote changes on key-value changes (Y.Map, properties on Y.Xml, etc..).
 * @property {Doc} [doc] The document that this UndoManager operates on. Only needed if typeScope is empty.
 */ /**
 * @typedef {Object} StackItemEvent
 * @property {StackItem} StackItemEvent.stackItem
 * @property {any} StackItemEvent.origin
 * @property {'undo'|'redo'} StackItemEvent.type
 * @property {Map<AbstractType<YEvent<any>>,Array<YEvent<any>>>} StackItemEvent.changedParentTypes
 */ /**
 * Fires 'stack-item-added' event when a stack item was added to either the undo- or
 * the redo-stack. You may store additional stack information via the
 * metadata property on `event.stackItem.meta` (it is a `Map` of metadata properties).
 * Fires 'stack-item-popped' event when a stack item was popped from either the
 * undo- or the redo-stack. You may restore the saved stack information from `event.stackItem.meta`.
 *
 * @extends {ObservableV2<{'stack-item-added':function(StackItemEvent, UndoManager):void, 'stack-item-popped': function(StackItemEvent, UndoManager):void, 'stack-cleared': function({ undoStackCleared: boolean, redoStackCleared: boolean }):void, 'stack-item-updated': function(StackItemEvent, UndoManager):void }>}
 */ class $42aaa4fd3d01b4df$export$932a3f9a7e88971c extends (0, $015da90ca04a7f6c$export$e23d3436ce401adc) {
    /**
   * @param {AbstractType<any>|Array<AbstractType<any>>} typeScope Accepts either a single type, or an array of types
   * @param {UndoManagerOptions} options
   */ constructor(typeScope, { captureTimeout: captureTimeout = 500, captureTransaction: captureTransaction = (_tr)=>true, deleteFilter: deleteFilter = ()=>true, trackedOrigins: trackedOrigins = new Set([
        null
    ]), ignoreRemoteMapChanges: ignoreRemoteMapChanges = false, doc: doc = /** @type {Doc} */ $cfaabc628d0f476d$export$43bee75e5e14138e(typeScope) ? typeScope[0].doc : typeScope.doc } = {}){
        super();
        /**
     * @type {Array<AbstractType<any>>}
     */ this.scope = [];
        this.doc = doc;
        this.addToScope(typeScope);
        this.deleteFilter = deleteFilter;
        trackedOrigins.add(this);
        this.trackedOrigins = trackedOrigins;
        this.captureTransaction = captureTransaction;
        /**
     * @type {Array<StackItem>}
     */ this.undoStack = [];
        /**
     * @type {Array<StackItem>}
     */ this.redoStack = [];
        /**
     * Whether the client is currently undoing (calling UndoManager.undo)
     *
     * @type {boolean}
     */ this.undoing = false;
        this.redoing = false;
        /**
     * The currently popped stack item if UndoManager.undoing or UndoManager.redoing
     *
     * @type {StackItem|null}
     */ this.currStackItem = null;
        this.lastChange = 0;
        this.ignoreRemoteMapChanges = ignoreRemoteMapChanges;
        this.captureTimeout = captureTimeout;
        /**
     * @param {Transaction} transaction
     */ this.afterTransactionHandler = (transaction)=>{
            // Only track certain transactions
            if (!this.captureTransaction(transaction) || !this.scope.some((type)=>transaction.changedParentTypes.has(type)) || !this.trackedOrigins.has(transaction.origin) && (!transaction.origin || !this.trackedOrigins.has(transaction.origin.constructor))) return;
            const undoing = this.undoing;
            const redoing = this.redoing;
            const stack = undoing ? this.redoStack : this.undoStack;
            if (undoing) this.stopCapturing(); // next undo should not be appended to last stack item
            else if (!redoing) // neither undoing nor redoing: delete redoStack
            this.clear(false, true);
            const insertions = new $42aaa4fd3d01b4df$var$DeleteSet();
            transaction.afterState.forEach((endClock, client)=>{
                const startClock = transaction.beforeState.get(client) || 0;
                const len = endClock - startClock;
                if (len > 0) $42aaa4fd3d01b4df$var$addToDeleteSet(insertions, client, startClock, len);
            });
            const now = $3500d09fbb2953ce$export$1f77c0008d16313();
            let didAdd = false;
            if (this.lastChange > 0 && now - this.lastChange < this.captureTimeout && stack.length > 0 && !undoing && !redoing) {
                // append change to last stack op
                const lastOp = stack[stack.length - 1];
                lastOp.deletions = $42aaa4fd3d01b4df$export$b7826cadad53901e([
                    lastOp.deletions,
                    transaction.deleteSet
                ]);
                lastOp.insertions = $42aaa4fd3d01b4df$export$b7826cadad53901e([
                    lastOp.insertions,
                    insertions
                ]);
            } else {
                // create a new stack op
                stack.push(new $42aaa4fd3d01b4df$var$StackItem(transaction.deleteSet, insertions));
                didAdd = true;
            }
            if (!undoing && !redoing) this.lastChange = now;
            // make sure that deleted structs are not gc'd
            $42aaa4fd3d01b4df$export$8afefebbaf4e4c78(transaction, transaction.deleteSet, /** @param {Item|GC} item */ (item)=>{
                if (item instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2 && this.scope.some((type)=>$42aaa4fd3d01b4df$export$3c81af374b054d6a(type, item))) $42aaa4fd3d01b4df$var$keepItem(item, true);
            });
            /**
       * @type {[StackItemEvent, UndoManager]}
       */ const changeEvent = [
                {
                    stackItem: stack[stack.length - 1],
                    origin: transaction.origin,
                    type: undoing ? 'redo' : 'undo',
                    changedParentTypes: transaction.changedParentTypes
                },
                this
            ];
            if (didAdd) this.emit('stack-item-added', changeEvent);
            else this.emit('stack-item-updated', changeEvent);
        };
        this.doc.on('afterTransaction', this.afterTransactionHandler);
        this.doc.on('destroy', ()=>{
            this.destroy();
        });
    }
    /**
   * @param {Array<AbstractType<any>> | AbstractType<any>} ytypes
   */ addToScope(ytypes) {
        ytypes = $cfaabc628d0f476d$export$43bee75e5e14138e(ytypes) ? ytypes : [
            ytypes
        ];
        ytypes.forEach((ytype)=>{
            if (this.scope.every((yt)=>yt !== ytype)) {
                if (ytype.doc !== this.doc) $0b4450a4ff92533f$export$c106dd0671a0fc2d('[yjs#509] Not same Y.Doc'); // use MultiDocUndoManager instead. also see https://github.com/yjs/yjs/issues/509
                this.scope.push(ytype);
            }
        });
    }
    /**
   * @param {any} origin
   */ addTrackedOrigin(origin) {
        this.trackedOrigins.add(origin);
    }
    /**
   * @param {any} origin
   */ removeTrackedOrigin(origin) {
        this.trackedOrigins.delete(origin);
    }
    clear(clearUndoStack = true, clearRedoStack = true) {
        if (clearUndoStack && this.canUndo() || clearRedoStack && this.canRedo()) this.doc.transact((tr)=>{
            if (clearUndoStack) {
                this.undoStack.forEach((item)=>$42aaa4fd3d01b4df$var$clearUndoManagerStackItem(tr, this, item));
                this.undoStack = [];
            }
            if (clearRedoStack) {
                this.redoStack.forEach((item)=>$42aaa4fd3d01b4df$var$clearUndoManagerStackItem(tr, this, item));
                this.redoStack = [];
            }
            this.emit('stack-cleared', [
                {
                    undoStackCleared: clearUndoStack,
                    redoStackCleared: clearRedoStack
                }
            ]);
        });
    }
    /**
   * UndoManager merges Undo-StackItem if they are created within time-gap
   * smaller than `options.captureTimeout`. Call `um.stopCapturing()` so that the next
   * StackItem won't be merged.
   *
   *
   * @example
   *     // without stopCapturing
   *     ytext.insert(0, 'a')
   *     ytext.insert(1, 'b')
   *     um.undo()
   *     ytext.toString() // => '' (note that 'ab' was removed)
   *     // with stopCapturing
   *     ytext.insert(0, 'a')
   *     um.stopCapturing()
   *     ytext.insert(0, 'b')
   *     um.undo()
   *     ytext.toString() // => 'a' (note that only 'b' was removed)
   *
   */ stopCapturing() {
        this.lastChange = 0;
    }
    /**
   * Undo last changes on type.
   *
   * @return {StackItem?} Returns StackItem if a change was applied
   */ undo() {
        this.undoing = true;
        let res;
        try {
            res = $42aaa4fd3d01b4df$var$popStackItem(this, this.undoStack, 'undo');
        } finally{
            this.undoing = false;
        }
        return res;
    }
    /**
   * Redo last undo operation.
   *
   * @return {StackItem?} Returns StackItem if a change was applied
   */ redo() {
        this.redoing = true;
        let res;
        try {
            res = $42aaa4fd3d01b4df$var$popStackItem(this, this.redoStack, 'redo');
        } finally{
            this.redoing = false;
        }
        return res;
    }
    /**
   * Are undo steps available?
   *
   * @return {boolean} `true` if undo is possible
   */ canUndo() {
        return this.undoStack.length > 0;
    }
    /**
   * Are redo steps available?
   *
   * @return {boolean} `true` if redo is possible
   */ canRedo() {
        return this.redoStack.length > 0;
    }
    destroy() {
        this.trackedOrigins.delete(this);
        this.doc.off('afterTransaction', this.afterTransactionHandler);
        super.destroy();
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 */ function* $42aaa4fd3d01b4df$var$lazyStructReaderGenerator(decoder) {
    const numOfStateUpdates = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
    for(let i = 0; i < numOfStateUpdates; i++){
        const numberOfStructs = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        const client = decoder.readClient();
        let clock = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
        for(let i = 0; i < numberOfStructs; i++){
            const info = decoder.readInfo();
            // @todo use switch instead of ifs
            if (info === 10) {
                const len = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder.restDecoder);
                yield new $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock), len);
                clock += len;
            } else if (($b27b7daa87337538$export$bc2aba63e4099c09 & info) !== 0) {
                const cantCopyParentInfo = (info & ($b27b7daa87337538$export$eb5a8e0006ab4bb5 | $b27b7daa87337538$export$e25597372303a045)) === 0;
                // If parent = null and neither left nor right are defined, then we know that `parent` is child of `y`
                // and we read the next string as parentYKey.
                // It indicates how we store/retrieve parent from `y.share`
                // @type {string|null}
                const struct = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock), null, (info & $b27b7daa87337538$export$e25597372303a045) === $b27b7daa87337538$export$e25597372303a045 ? decoder.readLeftID() : null, null, (info & $b27b7daa87337538$export$eb5a8e0006ab4bb5) === $b27b7daa87337538$export$eb5a8e0006ab4bb5 ? decoder.readRightID() : null, // @ts-ignore Force writing a string here.
                cantCopyParentInfo ? decoder.readParentInfo() ? decoder.readString() : decoder.readLeftID() : null, cantCopyParentInfo && (info & $b27b7daa87337538$export$daf23f774967089) === $b27b7daa87337538$export$daf23f774967089 ? decoder.readString() : null, $42aaa4fd3d01b4df$var$readItemContent(decoder, info) // item content
                );
                yield struct;
                clock += struct.length;
            } else {
                const len = decoder.readLen();
                yield new $42aaa4fd3d01b4df$export$12d259ff017e6b58($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock), len);
                clock += len;
            }
        }
    }
}
class $42aaa4fd3d01b4df$var$LazyStructReader {
    /**
   * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
   * @param {boolean} filterSkips
   */ constructor(decoder, filterSkips){
        this.gen = $42aaa4fd3d01b4df$var$lazyStructReaderGenerator(decoder);
        /**
     * @type {null | Item | Skip | GC}
     */ this.curr = null;
        this.done = false;
        this.filterSkips = filterSkips;
        this.next();
    }
    /**
   * @return {Item | GC | Skip |null}
   */ next() {
        // ignore "Skip" structs
        do this.curr = this.gen.next().value || null;
        while (this.filterSkips && this.curr !== null && this.curr.constructor === $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0);
        return this.curr;
    }
}
/**
 * @param {Uint8Array} update
 *
 */ const $42aaa4fd3d01b4df$export$d6235ced6e55ace9 = (update)=>$42aaa4fd3d01b4df$export$624b3f0248c2dc40(update, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec);
/**
 * @param {Uint8Array} update
 * @param {typeof UpdateDecoderV2 | typeof UpdateDecoderV1} [YDecoder]
 *
 */ const $42aaa4fd3d01b4df$export$624b3f0248c2dc40 = (update, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571)=>{
    const structs = [];
    const updateDecoder = new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update));
    const lazyDecoder = new $42aaa4fd3d01b4df$var$LazyStructReader(updateDecoder, false);
    for(let curr = lazyDecoder.curr; curr !== null; curr = lazyDecoder.next())structs.push(curr);
    $0b4450a4ff92533f$export$c2d084dc44961371('Structs: ', structs);
    const ds = $42aaa4fd3d01b4df$var$readDeleteSet(updateDecoder);
    $0b4450a4ff92533f$export$c2d084dc44961371('DeleteSet: ', ds);
};
/**
 * @param {Uint8Array} update
 *
 */ const $42aaa4fd3d01b4df$export$aa45cba8121663dc = (update)=>$42aaa4fd3d01b4df$export$2fed33908eb23d71(update, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec);
/**
 * @param {Uint8Array} update
 * @param {typeof UpdateDecoderV2 | typeof UpdateDecoderV1} [YDecoder]
 *
 */ const $42aaa4fd3d01b4df$export$2fed33908eb23d71 = (update, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571)=>{
    const structs = [];
    const updateDecoder = new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update));
    const lazyDecoder = new $42aaa4fd3d01b4df$var$LazyStructReader(updateDecoder, false);
    for(let curr = lazyDecoder.curr; curr !== null; curr = lazyDecoder.next())structs.push(curr);
    return {
        structs: structs,
        ds: $42aaa4fd3d01b4df$var$readDeleteSet(updateDecoder)
    };
};
class $42aaa4fd3d01b4df$var$LazyStructWriter {
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   */ constructor(encoder){
        this.currClient = 0;
        this.startClock = 0;
        this.written = 0;
        this.encoder = encoder;
        /**
     * We want to write operations lazily, but also we need to know beforehand how many operations we want to write for each client.
     *
     * This kind of meta-information (#clients, #structs-per-client-written) is written to the restEncoder.
     *
     * We fragment the restEncoder and store a slice of it per-client until we know how many clients there are.
     * When we flush (toUint8Array) we write the restEncoder using the fragments and the meta-information.
     *
     * @type {Array<{ written: number, restEncoder: Uint8Array }>}
     */ this.clientStructs = [];
    }
}
/**
 * @param {Array<Uint8Array>} updates
 * @return {Uint8Array}
 */ const $42aaa4fd3d01b4df$export$6319871659fd2460 = (updates)=>$42aaa4fd3d01b4df$export$ce273d78de0331d1(updates, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec, $42aaa4fd3d01b4df$export$99171b804d9c5b54);
/**
 * @param {Uint8Array} update
 * @param {typeof DSEncoderV1 | typeof DSEncoderV2} YEncoder
 * @param {typeof UpdateDecoderV1 | typeof UpdateDecoderV2} YDecoder
 * @return {Uint8Array}
 */ const $42aaa4fd3d01b4df$export$ed51750cf3ab2381 = (update, YEncoder = $42aaa4fd3d01b4df$var$DSEncoderV2, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571)=>{
    const encoder = new YEncoder();
    const updateDecoder = new $42aaa4fd3d01b4df$var$LazyStructReader(new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update)), false);
    let curr = updateDecoder.curr;
    if (curr !== null) {
        let size = 0;
        let currClient = curr.id.client;
        let stopCounting = curr.id.clock !== 0; // must start at 0
        let currClock = stopCounting ? 0 : curr.id.clock + curr.length;
        for(; curr !== null; curr = updateDecoder.next()){
            if (currClient !== curr.id.client) {
                if (currClock !== 0) {
                    size++;
                    // We found a new client
                    // write what we have to the encoder
                    $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, currClient);
                    $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, currClock);
                }
                currClient = curr.id.client;
                currClock = 0;
                stopCounting = curr.id.clock !== 0;
            }
            // we ignore skips
            if (curr.constructor === $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0) stopCounting = true;
            if (!stopCounting) currClock = curr.id.clock + curr.length;
        }
        // write what we have
        if (currClock !== 0) {
            size++;
            $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, currClient);
            $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, currClock);
        }
        // prepend the size of the state vector
        const enc = $293cd0efd7645786$export$4e76eeb6df88c889();
        $293cd0efd7645786$export$872f48c75febcd2b(enc, size);
        $293cd0efd7645786$export$c029b62321ea3da(enc, encoder.restEncoder);
        encoder.restEncoder = enc;
        return encoder.toUint8Array();
    } else {
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, 0);
        return encoder.toUint8Array();
    }
};
/**
 * @param {Uint8Array} update
 * @return {Uint8Array}
 */ const $42aaa4fd3d01b4df$export$5c451fd8502b011f = (update)=>$42aaa4fd3d01b4df$export$ed51750cf3ab2381(update, $42aaa4fd3d01b4df$var$DSEncoderV1, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec);
/**
 * @param {Uint8Array} update
 * @param {typeof UpdateDecoderV1 | typeof UpdateDecoderV2} YDecoder
 * @return {{ from: Map<number,number>, to: Map<number,number> }}
 */ const $42aaa4fd3d01b4df$export$8212a58b2178fdcf = (update, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571)=>{
    /**
   * @type {Map<number, number>}
   */ const from = new Map();
    /**
   * @type {Map<number, number>}
   */ const to = new Map();
    const updateDecoder = new $42aaa4fd3d01b4df$var$LazyStructReader(new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update)), false);
    let curr = updateDecoder.curr;
    if (curr !== null) {
        let currClient = curr.id.client;
        let currClock = curr.id.clock;
        // write the beginning to `from`
        from.set(currClient, currClock);
        for(; curr !== null; curr = updateDecoder.next()){
            if (currClient !== curr.id.client) {
                // We found a new client
                // write the end to `to`
                to.set(currClient, currClock);
                // write the beginning to `from`
                from.set(curr.id.client, curr.id.clock);
                // update currClient
                currClient = curr.id.client;
            }
            currClock = curr.id.clock + curr.length;
        }
        // write the end to `to`
        to.set(currClient, currClock);
    }
    return {
        from: from,
        to: to
    };
};
/**
 * @param {Uint8Array} update
 * @return {{ from: Map<number,number>, to: Map<number,number> }}
 */ const $42aaa4fd3d01b4df$export$e212b06fd4bf78fd = (update)=>$42aaa4fd3d01b4df$export$8212a58b2178fdcf(update, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec);
/**
 * This method is intended to slice any kind of struct and retrieve the right part.
 * It does not handle side-effects, so it should only be used by the lazy-encoder.
 *
 * @param {Item | GC | Skip} left
 * @param {number} diff
 * @return {Item | GC}
 */ const $42aaa4fd3d01b4df$var$sliceStruct = (left, diff)=>{
    if (left.constructor === $42aaa4fd3d01b4df$export$12d259ff017e6b58) {
        const { client: client, clock: clock } = left.id;
        return new $42aaa4fd3d01b4df$export$12d259ff017e6b58($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock + diff), left.length - diff);
    } else if (left.constructor === $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0) {
        const { client: client, clock: clock } = left.id;
        return new $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock + diff), left.length - diff);
    } else {
        const leftItem = /** @type {Item} */ left;
        const { client: client, clock: clock } = leftItem.id;
        return new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock + diff), null, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock + diff - 1), null, leftItem.rightOrigin, leftItem.parent, leftItem.parentSub, leftItem.content.splice(diff));
    }
};
/**
 *
 * This function works similarly to `readUpdateV2`.
 *
 * @param {Array<Uint8Array>} updates
 * @param {typeof UpdateDecoderV1 | typeof UpdateDecoderV2} [YDecoder]
 * @param {typeof UpdateEncoderV1 | typeof UpdateEncoderV2} [YEncoder]
 * @return {Uint8Array}
 */ const $42aaa4fd3d01b4df$export$ce273d78de0331d1 = (updates, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571, YEncoder = $42aaa4fd3d01b4df$export$30c99e08943e1c2)=>{
    if (updates.length === 1) return updates[0];
    const updateDecoders = updates.map((update)=>new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update)));
    let lazyStructDecoders = updateDecoders.map((decoder)=>new $42aaa4fd3d01b4df$var$LazyStructReader(decoder, true));
    /**
   * @todo we don't need offset because we always slice before
   * @type {null | { struct: Item | GC | Skip, offset: number }}
   */ let currWrite = null;
    const updateEncoder = new YEncoder();
    // write structs lazily
    const lazyStructEncoder = new $42aaa4fd3d01b4df$var$LazyStructWriter(updateEncoder);
    // Note: We need to ensure that all lazyStructDecoders are fully consumed
    // Note: Should merge document updates whenever possible - even from different updates
    // Note: Should handle that some operations cannot be applied yet ()
    while(true){
        // Write higher clients first ⇒ sort by clientID & clock and remove decoders without content
        lazyStructDecoders = lazyStructDecoders.filter((dec)=>dec.curr !== null);
        lazyStructDecoders.sort(/** @type {function(any,any):number} */ (dec1, dec2)=>{
            if (dec1.curr.id.client === dec2.curr.id.client) {
                const clockDiff = dec1.curr.id.clock - dec2.curr.id.clock;
                if (clockDiff === 0) // @todo remove references to skip since the structDecoders must filter Skips.
                return dec1.curr.constructor === dec2.curr.constructor ? 0 : dec1.curr.constructor === $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0 ? 1 : -1 // we are filtering skips anyway.
                ;
                else return clockDiff;
            } else return dec2.curr.id.client - dec1.curr.id.client;
        });
        if (lazyStructDecoders.length === 0) break;
        const currDecoder = lazyStructDecoders[0];
        // write from currDecoder until the next operation is from another client or if filler-struct
        // then we need to reorder the decoders and find the next operation to write
        const firstClient = /** @type {Item | GC} */ currDecoder.curr.id.client;
        if (currWrite !== null) {
            let curr = /** @type {Item | GC | null} */ currDecoder.curr;
            let iterated = false;
            // iterate until we find something that we haven't written already
            // remember: first the high client-ids are written
            while(curr !== null && curr.id.clock + curr.length <= currWrite.struct.id.clock + currWrite.struct.length && curr.id.client >= currWrite.struct.id.client){
                curr = currDecoder.next();
                iterated = true;
            }
            if (curr === null || // current decoder is empty
            curr.id.client !== firstClient || // check whether there is another decoder that has has updates from `firstClient`
            iterated && curr.id.clock > currWrite.struct.id.clock + currWrite.struct.length // the above while loop was used and we are potentially missing updates
            ) continue;
            if (firstClient !== currWrite.struct.id.client) {
                $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyStructEncoder, currWrite.struct, currWrite.offset);
                currWrite = {
                    struct: curr,
                    offset: 0
                };
                currDecoder.next();
            } else if (currWrite.struct.id.clock + currWrite.struct.length < curr.id.clock) {
                // @todo write currStruct & set currStruct = Skip(clock = currStruct.id.clock + currStruct.length, length = curr.id.clock - self.clock)
                if (currWrite.struct.constructor === $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0) // extend existing skip
                currWrite.struct.length = curr.id.clock + curr.length - currWrite.struct.id.clock;
                else {
                    $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyStructEncoder, currWrite.struct, currWrite.offset);
                    const diff = curr.id.clock - currWrite.struct.id.clock - currWrite.struct.length;
                    /**
             * @type {Skip}
             */ const struct = new $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(firstClient, currWrite.struct.id.clock + currWrite.struct.length), diff);
                    currWrite = {
                        struct: struct,
                        offset: 0
                    };
                }
            } else {
                const diff = currWrite.struct.id.clock + currWrite.struct.length - curr.id.clock;
                if (diff > 0) {
                    if (currWrite.struct.constructor === $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0) // prefer to slice Skip because the other struct might contain more information
                    currWrite.struct.length -= diff;
                    else curr = $42aaa4fd3d01b4df$var$sliceStruct(curr, diff);
                }
                if (!currWrite.struct.mergeWith(/** @type {any} */ curr)) {
                    $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyStructEncoder, currWrite.struct, currWrite.offset);
                    currWrite = {
                        struct: curr,
                        offset: 0
                    };
                    currDecoder.next();
                }
            }
        } else {
            currWrite = {
                struct: /** @type {Item | GC} */ currDecoder.curr,
                offset: 0
            };
            currDecoder.next();
        }
        for(let next = currDecoder.curr; next !== null && next.id.client === firstClient && next.id.clock === currWrite.struct.id.clock + currWrite.struct.length && next.constructor !== $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0; next = currDecoder.next()){
            $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyStructEncoder, currWrite.struct, currWrite.offset);
            currWrite = {
                struct: next,
                offset: 0
            };
        }
    }
    if (currWrite !== null) {
        $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyStructEncoder, currWrite.struct, currWrite.offset);
        currWrite = null;
    }
    $42aaa4fd3d01b4df$var$finishLazyStructWriting(lazyStructEncoder);
    const dss = updateDecoders.map((decoder)=>$42aaa4fd3d01b4df$var$readDeleteSet(decoder));
    const ds = $42aaa4fd3d01b4df$export$b7826cadad53901e(dss);
    $42aaa4fd3d01b4df$var$writeDeleteSet(updateEncoder, ds);
    return updateEncoder.toUint8Array();
};
/**
 * @param {Uint8Array} update
 * @param {Uint8Array} sv
 * @param {typeof UpdateDecoderV1 | typeof UpdateDecoderV2} [YDecoder]
 * @param {typeof UpdateEncoderV1 | typeof UpdateEncoderV2} [YEncoder]
 */ const $42aaa4fd3d01b4df$export$a8143edf39d2ad8e = (update, sv, YDecoder = $42aaa4fd3d01b4df$export$1c932452355c5571, YEncoder = $42aaa4fd3d01b4df$export$30c99e08943e1c2)=>{
    const state = $42aaa4fd3d01b4df$export$324ac6fb20a844e3(sv);
    const encoder = new YEncoder();
    const lazyStructWriter = new $42aaa4fd3d01b4df$var$LazyStructWriter(encoder);
    const decoder = new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update));
    const reader = new $42aaa4fd3d01b4df$var$LazyStructReader(decoder, false);
    while(reader.curr){
        const curr = reader.curr;
        const currClient = curr.id.client;
        const svClock = state.get(currClient) || 0;
        if (reader.curr.constructor === $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0) {
            // the first written struct shouldn't be a skip
            reader.next();
            continue;
        }
        if (curr.id.clock + curr.length > svClock) {
            $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyStructWriter, curr, $674380a05f97f4f3$export$8960430cfd85939f(svClock - curr.id.clock, 0));
            reader.next();
            while(reader.curr && reader.curr.id.client === currClient){
                $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyStructWriter, reader.curr, 0);
                reader.next();
            }
        } else // read until something new comes up
        while(reader.curr && reader.curr.id.client === currClient && reader.curr.id.clock + reader.curr.length <= svClock)reader.next();
    }
    $42aaa4fd3d01b4df$var$finishLazyStructWriting(lazyStructWriter);
    // write ds
    const ds = $42aaa4fd3d01b4df$var$readDeleteSet(decoder);
    $42aaa4fd3d01b4df$var$writeDeleteSet(encoder, ds);
    return encoder.toUint8Array();
};
/**
 * @param {Uint8Array} update
 * @param {Uint8Array} sv
 */ const $42aaa4fd3d01b4df$export$bf60b51d6c283426 = (update, sv)=>$42aaa4fd3d01b4df$export$a8143edf39d2ad8e(update, sv, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec, $42aaa4fd3d01b4df$export$99171b804d9c5b54);
/**
 * @param {LazyStructWriter} lazyWriter
 */ const $42aaa4fd3d01b4df$var$flushLazyStructWriter = (lazyWriter)=>{
    if (lazyWriter.written > 0) {
        lazyWriter.clientStructs.push({
            written: lazyWriter.written,
            restEncoder: $293cd0efd7645786$export$73470fd2221e6aef(lazyWriter.encoder.restEncoder)
        });
        lazyWriter.encoder.restEncoder = $293cd0efd7645786$export$4e76eeb6df88c889();
        lazyWriter.written = 0;
    }
};
/**
 * @param {LazyStructWriter} lazyWriter
 * @param {Item | GC} struct
 * @param {number} offset
 */ const $42aaa4fd3d01b4df$var$writeStructToLazyStructWriter = (lazyWriter, struct, offset)=>{
    // flush curr if we start another client
    if (lazyWriter.written > 0 && lazyWriter.currClient !== struct.id.client) $42aaa4fd3d01b4df$var$flushLazyStructWriter(lazyWriter);
    if (lazyWriter.written === 0) {
        lazyWriter.currClient = struct.id.client;
        // write next client
        lazyWriter.encoder.writeClient(struct.id.client);
        // write startClock
        $293cd0efd7645786$export$872f48c75febcd2b(lazyWriter.encoder.restEncoder, struct.id.clock + offset);
    }
    struct.write(lazyWriter.encoder, offset);
    lazyWriter.written++;
};
/**
 * Call this function when we collected all parts and want to
 * put all the parts together. After calling this method,
 * you can continue using the UpdateEncoder.
 *
 * @param {LazyStructWriter} lazyWriter
 */ const $42aaa4fd3d01b4df$var$finishLazyStructWriting = (lazyWriter)=>{
    $42aaa4fd3d01b4df$var$flushLazyStructWriter(lazyWriter);
    // this is a fresh encoder because we called flushCurr
    const restEncoder = lazyWriter.encoder.restEncoder;
    /**
   * Now we put all the fragments together.
   * This works similarly to `writeClientsStructs`
   */ // write # states that were updated - i.e. the clients
    $293cd0efd7645786$export$872f48c75febcd2b(restEncoder, lazyWriter.clientStructs.length);
    for(let i = 0; i < lazyWriter.clientStructs.length; i++){
        const partStructs = lazyWriter.clientStructs[i];
        /**
     * Works similarly to `writeStructs`
     */ // write # encoded structs
        $293cd0efd7645786$export$872f48c75febcd2b(restEncoder, partStructs.written);
        // write the rest of the fragment
        $293cd0efd7645786$export$73b5e63e27d2b4c7(restEncoder, partStructs.restEncoder);
    }
};
/**
 * @param {Uint8Array} update
 * @param {function(Item|GC|Skip):Item|GC|Skip} blockTransformer
 * @param {typeof UpdateDecoderV2 | typeof UpdateDecoderV1} YDecoder
 * @param {typeof UpdateEncoderV2 | typeof UpdateEncoderV1 } YEncoder
 */ const $42aaa4fd3d01b4df$var$convertUpdateFormat = (update, blockTransformer, YDecoder, YEncoder)=>{
    const updateDecoder = new YDecoder($e15498288f7f96ea$export$f8c898e83b60faaa(update));
    const lazyDecoder = new $42aaa4fd3d01b4df$var$LazyStructReader(updateDecoder, false);
    const updateEncoder = new YEncoder();
    const lazyWriter = new $42aaa4fd3d01b4df$var$LazyStructWriter(updateEncoder);
    for(let curr = lazyDecoder.curr; curr !== null; curr = lazyDecoder.next())$42aaa4fd3d01b4df$var$writeStructToLazyStructWriter(lazyWriter, blockTransformer(curr), 0);
    $42aaa4fd3d01b4df$var$finishLazyStructWriting(lazyWriter);
    const ds = $42aaa4fd3d01b4df$var$readDeleteSet(updateDecoder);
    $42aaa4fd3d01b4df$var$writeDeleteSet(updateEncoder, ds);
    return updateEncoder.toUint8Array();
};
/**
 * @typedef {Object} ObfuscatorOptions
 * @property {boolean} [ObfuscatorOptions.formatting=true]
 * @property {boolean} [ObfuscatorOptions.subdocs=true]
 * @property {boolean} [ObfuscatorOptions.yxml=true] Whether to obfuscate nodeName / hookName
 */ /**
 * @param {ObfuscatorOptions} obfuscator
 */ const $42aaa4fd3d01b4df$var$createObfuscator = ({ formatting: formatting = true, subdocs: subdocs = true, yxml: yxml = true } = {})=>{
    let i = 0;
    const mapKeyCache = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    const nodeNameCache = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    const formattingKeyCache = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    const formattingValueCache = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    formattingValueCache.set(null, null); // end of a formatting range should always be the end of a formatting range
    /**
   * @param {Item|GC|Skip} block
   * @return {Item|GC|Skip}
   */ return (block)=>{
        switch(block.constructor){
            case $42aaa4fd3d01b4df$export$12d259ff017e6b58:
            case $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0:
                return block;
            case $42aaa4fd3d01b4df$export$6d08773d2e66f8f2:
                {
                    const item = /** @type {Item} */ block;
                    const content = item.content;
                    switch(content.constructor){
                        case $42aaa4fd3d01b4df$export$3b06e0b3a2ece602:
                            break;
                        case $42aaa4fd3d01b4df$export$e2e108cbe2e4f865:
                            if (yxml) {
                                const type = /** @type {ContentType} */ content.type;
                                if (type instanceof $42aaa4fd3d01b4df$export$4db87581d3ca170d) type.nodeName = $58ab1e30cc73aec7$export$dccd489362a8619(nodeNameCache, type.nodeName, ()=>'node-' + i);
                                if (type instanceof $42aaa4fd3d01b4df$export$ec64c1dd5e7a264) type.hookName = $58ab1e30cc73aec7$export$dccd489362a8619(nodeNameCache, type.hookName, ()=>'hook-' + i);
                            }
                            break;
                        case $42aaa4fd3d01b4df$export$1d788b93bbb631a0:
                            {
                                const c = /** @type {ContentAny} */ content;
                                c.arr = c.arr.map(()=>i);
                                break;
                            }
                        case $42aaa4fd3d01b4df$export$e8d530cdf62d1cbd:
                            {
                                const c = /** @type {ContentBinary} */ content;
                                c.content = new Uint8Array([
                                    i
                                ]);
                                break;
                            }
                        case $42aaa4fd3d01b4df$export$b564c0e69572c0e:
                            {
                                const c = /** @type {ContentDoc} */ content;
                                if (subdocs) {
                                    c.opts = {};
                                    c.doc.guid = i + '';
                                }
                                break;
                            }
                        case $42aaa4fd3d01b4df$export$c3787ba7f6086664:
                            {
                                const c = /** @type {ContentEmbed} */ content;
                                c.embed = {};
                                break;
                            }
                        case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                            {
                                const c = /** @type {ContentFormat} */ content;
                                if (formatting) {
                                    c.key = $58ab1e30cc73aec7$export$dccd489362a8619(formattingKeyCache, c.key, ()=>i + '');
                                    c.value = $58ab1e30cc73aec7$export$dccd489362a8619(formattingValueCache, c.value, ()=>({
                                            i: i
                                        }));
                                }
                                break;
                            }
                        case $42aaa4fd3d01b4df$export$6a907ea8f733ecf3:
                            {
                                const c = /** @type {ContentJSON} */ content;
                                c.arr = c.arr.map(()=>i);
                                break;
                            }
                        case $42aaa4fd3d01b4df$export$ee670b2cf091bbb6:
                            {
                                const c = /** @type {ContentString} */ content;
                                c.str = $83a4db9bed1df563$export$76d90c956114f2c2(i % 10 + '', c.str.length);
                                break;
                            }
                        default:
                            // unknown content type
                            $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
                    }
                    if (item.parentSub) item.parentSub = $58ab1e30cc73aec7$export$dccd489362a8619(mapKeyCache, item.parentSub, ()=>i + '');
                    i++;
                    return block;
                }
            default:
                // unknown block-type
                $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
        }
    };
};
/**
 * This function obfuscates the content of a Yjs update. This is useful to share
 * buggy Yjs documents while significantly limiting the possibility that a
 * developer can on the user. Note that it might still be possible to deduce
 * some information by analyzing the "structure" of the document or by analyzing
 * the typing behavior using the CRDT-related metadata that is still kept fully
 * intact.
 *
 * @param {Uint8Array} update
 * @param {ObfuscatorOptions} [opts]
 */ const $42aaa4fd3d01b4df$export$2dc24d59ec48a24e = (update, opts)=>$42aaa4fd3d01b4df$var$convertUpdateFormat(update, $42aaa4fd3d01b4df$var$createObfuscator(opts), $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec, $42aaa4fd3d01b4df$export$99171b804d9c5b54);
/**
 * @param {Uint8Array} update
 * @param {ObfuscatorOptions} [opts]
 */ const $42aaa4fd3d01b4df$export$90648fb14f8c31aa = (update, opts)=>$42aaa4fd3d01b4df$var$convertUpdateFormat(update, $42aaa4fd3d01b4df$var$createObfuscator(opts), $42aaa4fd3d01b4df$export$1c932452355c5571, $42aaa4fd3d01b4df$export$30c99e08943e1c2);
/**
 * @param {Uint8Array} update
 */ const $42aaa4fd3d01b4df$export$162408325d5832c = (update)=>$42aaa4fd3d01b4df$var$convertUpdateFormat(update, $e2897672a487246a$export$d560c7e4a29451c2, $42aaa4fd3d01b4df$export$1aa46d9818b5d1ec, $42aaa4fd3d01b4df$export$30c99e08943e1c2);
/**
 * @param {Uint8Array} update
 */ const $42aaa4fd3d01b4df$export$afffbdeed14adbd = (update)=>$42aaa4fd3d01b4df$var$convertUpdateFormat(update, $e2897672a487246a$export$d560c7e4a29451c2, $42aaa4fd3d01b4df$export$1c932452355c5571, $42aaa4fd3d01b4df$export$99171b804d9c5b54);
const $42aaa4fd3d01b4df$var$errorComputeChanges = 'You must not compute changes after the event-handler fired.';
/**
 * @template {AbstractType<any>} T
 * YEvent describes the changes on a YType.
 */ class $42aaa4fd3d01b4df$export$80fac438977fb51c {
    /**
   * @param {T} target The changed type.
   * @param {Transaction} transaction
   */ constructor(target, transaction){
        /**
     * The type on which this event was created on.
     * @type {T}
     */ this.target = target;
        /**
     * The current target on which the observe callback is called.
     * @type {AbstractType<any>}
     */ this.currentTarget = target;
        /**
     * The transaction that triggered this event.
     * @type {Transaction}
     */ this.transaction = transaction;
        /**
     * @type {Object|null}
     */ this._changes = null;
        /**
     * @type {null | Map<string, { action: 'add' | 'update' | 'delete', oldValue: any, newValue: any }>}
     */ this._keys = null;
        /**
     * @type {null | Array<{ insert?: string | Array<any> | object | AbstractType<any>, retain?: number, delete?: number, attributes?: Object<string, any> }>}
     */ this._delta = null;
        /**
     * @type {Array<string|number>|null}
     */ this._path = null;
    }
    /**
   * Computes the path from `y` to the changed type.
   *
   * @todo v14 should standardize on path: Array<{parent, index}> because that is easier to work with.
   *
   * The following property holds:
   * @example
   *   let type = y
   *   event.path.forEach(dir => {
   *     type = type.get(dir)
   *   })
   *   type === event.target // => true
   */ get path() {
        return this._path || (this._path = $42aaa4fd3d01b4df$var$getPathTo(this.currentTarget, this.target));
    }
    /**
   * Check if a struct is deleted by this event.
   *
   * In contrast to change.deleted, this method also returns true if the struct was added and then deleted.
   *
   * @param {AbstractStruct} struct
   * @return {boolean}
   */ deletes(struct) {
        return $42aaa4fd3d01b4df$export$dcb04af092e44fde(this.transaction.deleteSet, struct.id);
    }
    /**
   * @type {Map<string, { action: 'add' | 'update' | 'delete', oldValue: any, newValue: any }>}
   */ get keys() {
        if (this._keys === null) {
            if (this.transaction.doc._transactionCleanups.length === 0) throw $20dad2a1f8b7bbe7$export$185802fd694ee1f5($42aaa4fd3d01b4df$var$errorComputeChanges);
            const keys = new Map();
            const target = this.target;
            const changed = /** @type Set<string|null> */ this.transaction.changed.get(target);
            changed.forEach((key)=>{
                if (key !== null) {
                    const item = /** @type {Item} */ target._map.get(key);
                    /**
           * @type {'delete' | 'add' | 'update'}
           */ let action;
                    let oldValue;
                    if (this.adds(item)) {
                        let prev = item.left;
                        while(prev !== null && this.adds(prev))prev = prev.left;
                        if (this.deletes(item)) {
                            if (prev !== null && this.deletes(prev)) {
                                action = 'delete';
                                oldValue = $cfaabc628d0f476d$export$4c7897fafd92b108(prev.content.getContent());
                            } else return;
                        } else if (prev !== null && this.deletes(prev)) {
                            action = 'update';
                            oldValue = $cfaabc628d0f476d$export$4c7897fafd92b108(prev.content.getContent());
                        } else {
                            action = 'add';
                            oldValue = undefined;
                        }
                    } else {
                        if (this.deletes(item)) {
                            action = 'delete';
                            oldValue = $cfaabc628d0f476d$export$4c7897fafd92b108(/** @type {Item} */ item.content.getContent());
                        } else return; // nop
                    }
                    keys.set(key, {
                        action: action,
                        oldValue: oldValue
                    });
                }
            });
            this._keys = keys;
        }
        return this._keys;
    }
    /**
   * This is a computed property. Note that this can only be safely computed during the
   * event call. Computing this property after other changes happened might result in
   * unexpected behavior (incorrect computation of deltas). A safe way to collect changes
   * is to store the `changes` or the `delta` object. Avoid storing the `transaction` object.
   *
   * @type {Array<{insert?: string | Array<any> | object | AbstractType<any>, retain?: number, delete?: number, attributes?: Object<string, any>}>}
   */ get delta() {
        return this.changes.delta;
    }
    /**
   * Check if a struct is added by this event.
   *
   * In contrast to change.deleted, this method also returns true if the struct was added and then deleted.
   *
   * @param {AbstractStruct} struct
   * @return {boolean}
   */ adds(struct) {
        return struct.id.clock >= (this.transaction.beforeState.get(struct.id.client) || 0);
    }
    /**
   * This is a computed property. Note that this can only be safely computed during the
   * event call. Computing this property after other changes happened might result in
   * unexpected behavior (incorrect computation of deltas). A safe way to collect changes
   * is to store the `changes` or the `delta` object. Avoid storing the `transaction` object.
   *
   * @type {{added:Set<Item>,deleted:Set<Item>,keys:Map<string,{action:'add'|'update'|'delete',oldValue:any}>,delta:Array<{insert?:Array<any>|string, delete?:number, retain?:number}>}}
   */ get changes() {
        let changes = this._changes;
        if (changes === null) {
            if (this.transaction.doc._transactionCleanups.length === 0) throw $20dad2a1f8b7bbe7$export$185802fd694ee1f5($42aaa4fd3d01b4df$var$errorComputeChanges);
            const target = this.target;
            const added = $ace4f15b64ff1dc0$export$185802fd694ee1f5();
            const deleted = $ace4f15b64ff1dc0$export$185802fd694ee1f5();
            /**
       * @type {Array<{insert:Array<any>}|{delete:number}|{retain:number}>}
       */ const delta = [];
            changes = {
                added: added,
                deleted: deleted,
                delta: delta,
                keys: this.keys
            };
            const changed = /** @type Set<string|null> */ this.transaction.changed.get(target);
            if (changed.has(null)) {
                /**
         * @type {any}
         */ let lastOp = null;
                const packOp = ()=>{
                    if (lastOp) delta.push(lastOp);
                };
                for(let item = target._start; item !== null; item = item.right){
                    if (item.deleted) {
                        if (this.deletes(item) && !this.adds(item)) {
                            if (lastOp === null || lastOp.delete === undefined) {
                                packOp();
                                lastOp = {
                                    delete: 0
                                };
                            }
                            lastOp.delete += item.length;
                            deleted.add(item);
                        } // else nop
                    } else if (this.adds(item)) {
                        if (lastOp === null || lastOp.insert === undefined) {
                            packOp();
                            lastOp = {
                                insert: []
                            };
                        }
                        lastOp.insert = lastOp.insert.concat(item.content.getContent());
                        added.add(item);
                    } else {
                        if (lastOp === null || lastOp.retain === undefined) {
                            packOp();
                            lastOp = {
                                retain: 0
                            };
                        }
                        lastOp.retain += item.length;
                    }
                }
                if (lastOp !== null && lastOp.retain === undefined) packOp();
            }
            this._changes = changes;
        }
        return /** @type {any} */ changes;
    }
}
/**
 * Compute the path from this type to the specified target.
 *
 * @example
 *   // `child` should be accessible via `type.get(path[0]).get(path[1])..`
 *   const path = type.getPathTo(child)
 *   // assuming `type instanceof YArray`
 *   console.log(path) // might look like => [2, 'key1']
 *   child === type.get(path[0]).get(path[1])
 *
 * @param {AbstractType<any>} parent
 * @param {AbstractType<any>} child target
 * @return {Array<string|number>} Path to the target
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$getPathTo = (parent, child)=>{
    const path = [];
    while(child._item !== null && child !== parent){
        if (child._item.parentSub !== null) // parent is map-ish
        path.unshift(child._item.parentSub);
        else {
            // parent is array-ish
            let i = 0;
            let c = /** @type {AbstractType<any>} */ child._item.parent._start;
            while(c !== child._item && c !== null){
                if (!c.deleted && c.countable) i += c.length;
                c = c.right;
            }
            path.unshift(i);
        }
        child = /** @type {AbstractType<any>} */ child._item.parent;
    }
    return path;
};
/**
 * https://docs.yjs.dev/getting-started/working-with-shared-types#caveats
 */ const $42aaa4fd3d01b4df$var$warnPrematureAccess = ()=>{
    $0b4450a4ff92533f$export$c106dd0671a0fc2d('Invalid access: Add Yjs type to a document before reading data.');
};
const $42aaa4fd3d01b4df$var$maxSearchMarker = 80;
/**
 * A unique timestamp that identifies each marker.
 *
 * Time is relative,.. this is more like an ever-increasing clock.
 *
 * @type {number}
 */ let $42aaa4fd3d01b4df$var$globalSearchMarkerTimestamp = 0;
class $42aaa4fd3d01b4df$var$ArraySearchMarker {
    /**
   * @param {Item} p
   * @param {number} index
   */ constructor(p, index){
        p.marker = true;
        this.p = p;
        this.index = index;
        this.timestamp = $42aaa4fd3d01b4df$var$globalSearchMarkerTimestamp++;
    }
}
/**
 * @param {ArraySearchMarker} marker
 */ const $42aaa4fd3d01b4df$var$refreshMarkerTimestamp = (marker)=>{
    marker.timestamp = $42aaa4fd3d01b4df$var$globalSearchMarkerTimestamp++;
};
/**
 * This is rather complex so this function is the only thing that should overwrite a marker
 *
 * @param {ArraySearchMarker} marker
 * @param {Item} p
 * @param {number} index
 */ const $42aaa4fd3d01b4df$var$overwriteMarker = (marker, p, index)=>{
    marker.p.marker = false;
    marker.p = p;
    p.marker = true;
    marker.index = index;
    marker.timestamp = $42aaa4fd3d01b4df$var$globalSearchMarkerTimestamp++;
};
/**
 * @param {Array<ArraySearchMarker>} searchMarker
 * @param {Item} p
 * @param {number} index
 */ const $42aaa4fd3d01b4df$var$markPosition = (searchMarker, p, index)=>{
    if (searchMarker.length >= $42aaa4fd3d01b4df$var$maxSearchMarker) {
        // override oldest marker (we don't want to create more objects)
        const marker = searchMarker.reduce((a, b)=>a.timestamp < b.timestamp ? a : b);
        $42aaa4fd3d01b4df$var$overwriteMarker(marker, p, index);
        return marker;
    } else {
        // create new marker
        const pm = new $42aaa4fd3d01b4df$var$ArraySearchMarker(p, index);
        searchMarker.push(pm);
        return pm;
    }
};
/**
 * Search marker help us to find positions in the associative array faster.
 *
 * They speed up the process of finding a position without much bookkeeping.
 *
 * A maximum of `maxSearchMarker` objects are created.
 *
 * This function always returns a refreshed marker (updated timestamp)
 *
 * @param {AbstractType<any>} yarray
 * @param {number} index
 */ const $42aaa4fd3d01b4df$var$findMarker = (yarray, index)=>{
    if (yarray._start === null || index === 0 || yarray._searchMarker === null) return null;
    const marker = yarray._searchMarker.length === 0 ? null : yarray._searchMarker.reduce((a, b)=>$674380a05f97f4f3$export$2335f513bbd82c6d(index - a.index) < $674380a05f97f4f3$export$2335f513bbd82c6d(index - b.index) ? a : b);
    let p = yarray._start;
    let pindex = 0;
    if (marker !== null) {
        p = marker.p;
        pindex = marker.index;
        $42aaa4fd3d01b4df$var$refreshMarkerTimestamp(marker); // we used it, we might need to use it again
    }
    // iterate to right if possible
    while(p.right !== null && pindex < index){
        if (!p.deleted && p.countable) {
            if (index < pindex + p.length) break;
            pindex += p.length;
        }
        p = p.right;
    }
    // iterate to left if necessary (might be that pindex > index)
    while(p.left !== null && pindex > index){
        p = p.left;
        if (!p.deleted && p.countable) pindex -= p.length;
    }
    // we want to make sure that p can't be merged with left, because that would screw up everything
    // in that cas just return what we have (it is most likely the best marker anyway)
    // iterate to left until p can't be merged with left
    while(p.left !== null && p.left.id.client === p.id.client && p.left.id.clock + p.left.length === p.id.clock){
        p = p.left;
        if (!p.deleted && p.countable) pindex -= p.length;
    }
    // @todo remove!
    // assure position
    // {
    //   let start = yarray._start
    //   let pos = 0
    //   while (start !== p) {
    //     if (!start.deleted && start.countable) {
    //       pos += start.length
    //     }
    //     start = /** @type {Item} */ (start.right)
    //   }
    //   if (pos !== pindex) {
    //     debugger
    //     throw new Error('Gotcha position fail!')
    //   }
    // }
    // if (marker) {
    //   if (window.lengthes == null) {
    //     window.lengthes = []
    //     window.getLengthes = () => window.lengthes.sort((a, b) => a - b)
    //   }
    //   window.lengthes.push(marker.index - pindex)
    //   console.log('distance', marker.index - pindex, 'len', p && p.parent.length)
    // }
    if (marker !== null && $674380a05f97f4f3$export$2335f513bbd82c6d(marker.index - pindex) < /** @type {YText|YArray<any>} */ p.parent.length / $42aaa4fd3d01b4df$var$maxSearchMarker) {
        // adjust existing marker
        $42aaa4fd3d01b4df$var$overwriteMarker(marker, p, pindex);
        return marker;
    } else // create new marker
    return $42aaa4fd3d01b4df$var$markPosition(yarray._searchMarker, p, pindex);
};
/**
 * Update markers when a change happened.
 *
 * This should be called before doing a deletion!
 *
 * @param {Array<ArraySearchMarker>} searchMarker
 * @param {number} index
 * @param {number} len If insertion, len is positive. If deletion, len is negative.
 */ const $42aaa4fd3d01b4df$var$updateMarkerChanges = (searchMarker, index, len)=>{
    for(let i = searchMarker.length - 1; i >= 0; i--){
        const m = searchMarker[i];
        if (len > 0) {
            /**
       * @type {Item|null}
       */ let p = m.p;
            p.marker = false;
            // Ideally we just want to do a simple position comparison, but this will only work if
            // search markers don't point to deleted items for formats.
            // Iterate marker to prev undeleted countable position so we know what to do when updating a position
            while(p && (p.deleted || !p.countable)){
                p = p.left;
                if (p && !p.deleted && p.countable) // adjust position. the loop should break now
                m.index -= p.length;
            }
            if (p === null || p.marker === true) {
                // remove search marker if updated position is null or if position is already marked
                searchMarker.splice(i, 1);
                continue;
            }
            m.p = p;
            p.marker = true;
        }
        if (index < m.index || len > 0 && index === m.index) m.index = $674380a05f97f4f3$export$8960430cfd85939f(index, m.index + len);
    }
};
/**
 * Accumulate all (list) children of a type and return them as an Array.
 *
 * @param {AbstractType<any>} t
 * @return {Array<Item>}
 */ const $42aaa4fd3d01b4df$export$5418d693f13991b3 = (t)=>{
    t.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    let s = t._start;
    const arr = [];
    while(s){
        arr.push(s);
        s = s.right;
    }
    return arr;
};
/**
 * Call event listeners with an event. This will also add an event to all
 * parents (for `.observeDeep` handlers).
 *
 * @template EventType
 * @param {AbstractType<EventType>} type
 * @param {Transaction} transaction
 * @param {EventType} event
 */ const $42aaa4fd3d01b4df$var$callTypeObservers = (type, transaction, event)=>{
    const changedType = type;
    const changedParentTypes = transaction.changedParentTypes;
    while(true){
        // @ts-ignore
        $58ab1e30cc73aec7$export$dccd489362a8619(changedParentTypes, type, ()=>[]).push(event);
        if (type._item === null) break;
        type = /** @type {AbstractType<any>} */ type._item.parent;
    }
    $42aaa4fd3d01b4df$var$callEventHandlerListeners(changedType._eH, event, transaction);
};
/**
 * @template EventType
 * Abstract Yjs Type class
 */ class $42aaa4fd3d01b4df$export$c265dc8338484497 {
    constructor(){
        /**
     * @type {Item|null}
     */ this._item = null;
        /**
     * @type {Map<string,Item>}
     */ this._map = new Map();
        /**
     * @type {Item|null}
     */ this._start = null;
        /**
     * @type {Doc|null}
     */ this.doc = null;
        this._length = 0;
        /**
     * Event handlers
     * @type {EventHandler<EventType,Transaction>}
     */ this._eH = $42aaa4fd3d01b4df$var$createEventHandler();
        /**
     * Deep event handlers
     * @type {EventHandler<Array<YEvent<any>>,Transaction>}
     */ this._dEH = $42aaa4fd3d01b4df$var$createEventHandler();
        /**
     * @type {null | Array<ArraySearchMarker>}
     */ this._searchMarker = null;
    }
    /**
   * @return {AbstractType<any>|null}
   */ get parent() {
        return this._item ? /** @type {AbstractType<any>} */ this._item.parent : null;
    }
    /**
   * Integrate this type into the Yjs instance.
   *
   * * Save this struct in the os
   * * This type is sent to other client
   * * Observer functions are fired
   *
   * @param {Doc} y The Yjs instance
   * @param {Item|null} item
   */ _integrate(y, item) {
        this.doc = y;
        this._item = item;
    }
    /**
   * @return {AbstractType<EventType>}
   */ _copy() {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {AbstractType<EventType>}
   */ clone() {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} _encoder
   */ _write(_encoder) {}
    /**
   * The first non-deleted item
   */ get _first() {
        let n = this._start;
        while(n !== null && n.deleted)n = n.right;
        return n;
    }
    /**
   * Creates YEvent and calls all type observers.
   * Must be implemented by each type.
   *
   * @param {Transaction} transaction
   * @param {Set<null|string>} _parentSubs Keys changed on this type. `null` if list was modified.
   */ _callObserver(transaction, _parentSubs) {
        if (!transaction.local && this._searchMarker) this._searchMarker.length = 0;
    }
    /**
   * Observe all events that are created on this type.
   *
   * @param {function(EventType, Transaction):void} f Observer function
   */ observe(f) {
        $42aaa4fd3d01b4df$var$addEventHandlerListener(this._eH, f);
    }
    /**
   * Observe all events that are created by this type and its children.
   *
   * @param {function(Array<YEvent<any>>,Transaction):void} f Observer function
   */ observeDeep(f) {
        $42aaa4fd3d01b4df$var$addEventHandlerListener(this._dEH, f);
    }
    /**
   * Unregister an observer function.
   *
   * @param {function(EventType,Transaction):void} f Observer function
   */ unobserve(f) {
        $42aaa4fd3d01b4df$var$removeEventHandlerListener(this._eH, f);
    }
    /**
   * Unregister an observer function.
   *
   * @param {function(Array<YEvent<any>>,Transaction):void} f Observer function
   */ unobserveDeep(f) {
        $42aaa4fd3d01b4df$var$removeEventHandlerListener(this._dEH, f);
    }
    /**
   * @abstract
   * @return {any}
   */ toJSON() {}
}
/**
 * @param {AbstractType<any>} type
 * @param {number} start
 * @param {number} end
 * @return {Array<any>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListSlice = (type, start, end)=>{
    type.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    if (start < 0) start = type._length + start;
    if (end < 0) end = type._length + end;
    let len = end - start;
    const cs = [];
    let n = type._start;
    while(n !== null && len > 0){
        if (n.countable && !n.deleted) {
            const c = n.content.getContent();
            if (c.length <= start) start -= c.length;
            else {
                for(let i = start; i < c.length && len > 0; i++){
                    cs.push(c[i]);
                    len--;
                }
                start = 0;
            }
        }
        n = n.right;
    }
    return cs;
};
/**
 * @param {AbstractType<any>} type
 * @return {Array<any>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListToArray = (type)=>{
    type.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    const cs = [];
    let n = type._start;
    while(n !== null){
        if (n.countable && !n.deleted) {
            const c = n.content.getContent();
            for(let i = 0; i < c.length; i++)cs.push(c[i]);
        }
        n = n.right;
    }
    return cs;
};
/**
 * @param {AbstractType<any>} type
 * @param {Snapshot} snapshot
 * @return {Array<any>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$9de42b6dda4c7e48 = (type, snapshot)=>{
    const cs = [];
    let n = type._start;
    while(n !== null){
        if (n.countable && $42aaa4fd3d01b4df$var$isVisible(n, snapshot)) {
            const c = n.content.getContent();
            for(let i = 0; i < c.length; i++)cs.push(c[i]);
        }
        n = n.right;
    }
    return cs;
};
/**
 * Executes a provided function on once on every element of this YArray.
 *
 * @param {AbstractType<any>} type
 * @param {function(any,number,any):void} f A function to execute on every element of this YArray.
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListForEach = (type, f)=>{
    let index = 0;
    let n = type._start;
    type.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    while(n !== null){
        if (n.countable && !n.deleted) {
            const c = n.content.getContent();
            for(let i = 0; i < c.length; i++)f(c[i], index++, type);
        }
        n = n.right;
    }
};
/**
 * @template C,R
 * @param {AbstractType<any>} type
 * @param {function(C,number,AbstractType<any>):R} f
 * @return {Array<R>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListMap = (type, f)=>{
    /**
   * @type {Array<any>}
   */ const result = [];
    $42aaa4fd3d01b4df$var$typeListForEach(type, (c, i)=>{
        result.push(f(c, i, type));
    });
    return result;
};
/**
 * @param {AbstractType<any>} type
 * @return {IterableIterator<any>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListCreateIterator = (type)=>{
    let n = type._start;
    /**
   * @type {Array<any>|null}
   */ let currentContent = null;
    let currentContentIndex = 0;
    return {
        [Symbol.iterator] () {
            return this;
        },
        next: ()=>{
            // find some content
            if (currentContent === null) {
                while(n !== null && n.deleted)n = n.right;
                // check if we reached the end, no need to check currentContent, because it does not exist
                if (n === null) return {
                    done: true,
                    value: undefined
                };
                // we found n, so we can set currentContent
                currentContent = n.content.getContent();
                currentContentIndex = 0;
                n = n.right; // we used the content of n, now iterate to next
            }
            const value = currentContent[currentContentIndex++];
            // check if we need to empty currentContent
            if (currentContent.length <= currentContentIndex) currentContent = null;
            return {
                done: false,
                value: value
            };
        }
    };
};
/**
 * @param {AbstractType<any>} type
 * @param {number} index
 * @return {any}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListGet = (type, index)=>{
    type.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    const marker = $42aaa4fd3d01b4df$var$findMarker(type, index);
    let n = type._start;
    if (marker !== null) {
        n = marker.p;
        index -= marker.index;
    }
    for(; n !== null; n = n.right)if (!n.deleted && n.countable) {
        if (index < n.length) return n.content.getContent()[index];
        index -= n.length;
    }
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {Item?} referenceItem
 * @param {Array<Object<string,any>|Array<any>|boolean|number|null|string|Uint8Array>} content
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListInsertGenericsAfter = (transaction, parent, referenceItem, content)=>{
    let left = referenceItem;
    const doc = transaction.doc;
    const ownClientId = doc.clientID;
    const store = doc.store;
    const right = referenceItem === null ? parent._start : referenceItem.right;
    /**
   * @type {Array<Object|Array<any>|number|null>}
   */ let jsonContent = [];
    const packJsonContent = ()=>{
        if (jsonContent.length > 0) {
            left = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, ownClientId)), left, left && left.lastId, right, right && right.id, parent, null, new $42aaa4fd3d01b4df$export$1d788b93bbb631a0(jsonContent));
            left.integrate(transaction, 0);
            jsonContent = [];
        }
    };
    content.forEach((c)=>{
        if (c === null) jsonContent.push(c);
        else switch(c.constructor){
            case Number:
            case Object:
            case Boolean:
            case Array:
            case String:
                jsonContent.push(c);
                break;
            default:
                packJsonContent();
                switch(c.constructor){
                    case Uint8Array:
                    case ArrayBuffer:
                        left = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, ownClientId)), left, left && left.lastId, right, right && right.id, parent, null, new $42aaa4fd3d01b4df$export$e8d530cdf62d1cbd(new Uint8Array(/** @type {Uint8Array} */ c)));
                        left.integrate(transaction, 0);
                        break;
                    case $42aaa4fd3d01b4df$export$bceacc74c2212615:
                        left = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, ownClientId)), left, left && left.lastId, right, right && right.id, parent, null, new $42aaa4fd3d01b4df$export$b564c0e69572c0e(/** @type {Doc} */ c));
                        left.integrate(transaction, 0);
                        break;
                    default:
                        if (c instanceof $42aaa4fd3d01b4df$export$c265dc8338484497) {
                            left = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, ownClientId)), left, left && left.lastId, right, right && right.id, parent, null, new $42aaa4fd3d01b4df$export$e2e108cbe2e4f865(c));
                            left.integrate(transaction, 0);
                        } else throw new Error('Unexpected content type in insert operation');
                }
        }
    });
    packJsonContent();
};
const $42aaa4fd3d01b4df$var$lengthExceeded = ()=>$20dad2a1f8b7bbe7$export$185802fd694ee1f5('Length exceeded!');
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {number} index
 * @param {Array<Object<string,any>|Array<any>|number|null|string|Uint8Array>} content
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListInsertGenerics = (transaction, parent, index, content)=>{
    if (index > parent._length) throw $42aaa4fd3d01b4df$var$lengthExceeded();
    if (index === 0) {
        if (parent._searchMarker) $42aaa4fd3d01b4df$var$updateMarkerChanges(parent._searchMarker, index, content.length);
        return $42aaa4fd3d01b4df$var$typeListInsertGenericsAfter(transaction, parent, null, content);
    }
    const startIndex = index;
    const marker = $42aaa4fd3d01b4df$var$findMarker(parent, index);
    let n = parent._start;
    if (marker !== null) {
        n = marker.p;
        index -= marker.index;
        // we need to iterate one to the left so that the algorithm works
        if (index === 0) {
            // @todo refactor this as it actually doesn't consider formats
            n = n.prev; // important! get the left undeleted item so that we can actually decrease index
            index += n && n.countable && !n.deleted ? n.length : 0;
        }
    }
    for(; n !== null; n = n.right)if (!n.deleted && n.countable) {
        if (index <= n.length) {
            if (index < n.length) // insert in-between
            $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(n.id.client, n.id.clock + index));
            break;
        }
        index -= n.length;
    }
    if (parent._searchMarker) $42aaa4fd3d01b4df$var$updateMarkerChanges(parent._searchMarker, startIndex, content.length);
    return $42aaa4fd3d01b4df$var$typeListInsertGenericsAfter(transaction, parent, n, content);
};
/**
 * Pushing content is special as we generally want to push after the last item. So we don't have to update
 * the serach marker.
 *
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {Array<Object<string,any>|Array<any>|number|null|string|Uint8Array>} content
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListPushGenerics = (transaction, parent, content)=>{
    // Use the marker with the highest index and iterate to the right.
    const marker = (parent._searchMarker || []).reduce((maxMarker, currMarker)=>currMarker.index > maxMarker.index ? currMarker : maxMarker, {
        index: 0,
        p: parent._start
    });
    let n = marker.p;
    if (n) while(n.right)n = n.right;
    return $42aaa4fd3d01b4df$var$typeListInsertGenericsAfter(transaction, parent, n, content);
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {number} index
 * @param {number} length
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeListDelete = (transaction, parent, index, length)=>{
    if (length === 0) return;
    const startIndex = index;
    const startLength = length;
    const marker = $42aaa4fd3d01b4df$var$findMarker(parent, index);
    let n = parent._start;
    if (marker !== null) {
        n = marker.p;
        index -= marker.index;
    }
    // compute the first item to be deleted
    for(; n !== null && index > 0; n = n.right)if (!n.deleted && n.countable) {
        if (index < n.length) $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(n.id.client, n.id.clock + index));
        index -= n.length;
    }
    // delete all items until done
    while(length > 0 && n !== null){
        if (!n.deleted) {
            if (length < n.length) $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(n.id.client, n.id.clock + length));
            n.delete(transaction);
            length -= n.length;
        }
        n = n.right;
    }
    if (length > 0) throw $42aaa4fd3d01b4df$var$lengthExceeded();
    if (parent._searchMarker) $42aaa4fd3d01b4df$var$updateMarkerChanges(parent._searchMarker, startIndex, -startLength + length /* in case we remove the above exception */ );
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {string} key
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeMapDelete = (transaction, parent, key)=>{
    const c = parent._map.get(key);
    if (c !== undefined) c.delete(transaction);
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {string} key
 * @param {Object|number|null|Array<any>|string|Uint8Array|AbstractType<any>} value
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeMapSet = (transaction, parent, key, value)=>{
    const left = parent._map.get(key) || null;
    const doc = transaction.doc;
    const ownClientId = doc.clientID;
    let content;
    if (value == null) content = new $42aaa4fd3d01b4df$export$1d788b93bbb631a0([
        value
    ]);
    else switch(value.constructor){
        case Number:
        case Object:
        case Boolean:
        case Array:
        case String:
            content = new $42aaa4fd3d01b4df$export$1d788b93bbb631a0([
                value
            ]);
            break;
        case Uint8Array:
            content = new $42aaa4fd3d01b4df$export$e8d530cdf62d1cbd(/** @type {Uint8Array} */ value);
            break;
        case $42aaa4fd3d01b4df$export$bceacc74c2212615:
            content = new $42aaa4fd3d01b4df$export$b564c0e69572c0e(/** @type {Doc} */ value);
            break;
        default:
            if (value instanceof $42aaa4fd3d01b4df$export$c265dc8338484497) content = new $42aaa4fd3d01b4df$export$e2e108cbe2e4f865(value);
            else throw new Error('Unexpected content type');
    }
    new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(doc.store, ownClientId)), left, left && left.lastId, null, null, parent, key, content).integrate(transaction, 0);
};
/**
 * @param {AbstractType<any>} parent
 * @param {string} key
 * @return {Object<string,any>|number|null|Array<any>|string|Uint8Array|AbstractType<any>|undefined}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeMapGet = (parent, key)=>{
    parent.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    const val = parent._map.get(key);
    return val !== undefined && !val.deleted ? val.content.getContent()[val.length - 1] : undefined;
};
/**
 * @param {AbstractType<any>} parent
 * @return {Object<string,Object<string,any>|number|null|Array<any>|string|Uint8Array|AbstractType<any>|undefined>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeMapGetAll = (parent)=>{
    /**
   * @type {Object<string,any>}
   */ const res = {};
    parent.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    parent._map.forEach((value, key)=>{
        if (!value.deleted) res[key] = value.content.getContent()[value.length - 1];
    });
    return res;
};
/**
 * @param {AbstractType<any>} parent
 * @param {string} key
 * @return {boolean}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$typeMapHas = (parent, key)=>{
    parent.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    const val = parent._map.get(key);
    return val !== undefined && !val.deleted;
};
/**
 * @param {AbstractType<any>} parent
 * @param {string} key
 * @param {Snapshot} snapshot
 * @return {Object<string,any>|number|null|Array<any>|string|Uint8Array|AbstractType<any>|undefined}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$a7c089bf6c22a1db = (parent, key, snapshot)=>{
    let v = parent._map.get(key) || null;
    while(v !== null && (!snapshot.sv.has(v.id.client) || v.id.clock >= (snapshot.sv.get(v.id.client) || 0)))v = v.left;
    return v !== null && $42aaa4fd3d01b4df$var$isVisible(v, snapshot) ? v.content.getContent()[v.length - 1] : undefined;
};
/**
 * @param {AbstractType<any>} parent
 * @param {Snapshot} snapshot
 * @return {Object<string,Object<string,any>|number|null|Array<any>|string|Uint8Array|AbstractType<any>|undefined>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$export$7769bdedaef2c91b = (parent, snapshot)=>{
    /**
   * @type {Object<string,any>}
   */ const res = {};
    parent._map.forEach((value, key)=>{
        /**
     * @type {Item|null}
     */ let v = value;
        while(v !== null && (!snapshot.sv.has(v.id.client) || v.id.clock >= (snapshot.sv.get(v.id.client) || 0)))v = v.left;
        if (v !== null && $42aaa4fd3d01b4df$var$isVisible(v, snapshot)) res[key] = v.content.getContent()[v.length - 1];
    });
    return res;
};
/**
 * @param {AbstractType<any> & { _map: Map<string, Item> }} type
 * @return {IterableIterator<Array<any>>}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$createMapIterator = (type)=>{
    type.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    return $0b9eaeb04b9479fe$export$88f0b2eef157f31a(type._map.entries(), /** @param {any} entry */ (entry)=>!entry[1].deleted);
};
/**
 * @module YArray
 */ /**
 * Event that describes the changes on a YArray
 * @template T
 * @extends YEvent<YArray<T>>
 */ class $42aaa4fd3d01b4df$export$a095f7fee639264a extends $42aaa4fd3d01b4df$export$80fac438977fb51c {
}
/**
 * A shared Array implementation.
 * @template T
 * @extends AbstractType<YArrayEvent<T>>
 * @implements {Iterable<T>}
 */ class $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa extends $42aaa4fd3d01b4df$export$c265dc8338484497 {
    constructor(){
        super();
        /**
     * @type {Array<any>?}
     * @private
     */ this._prelimContent = [];
        /**
     * @type {Array<ArraySearchMarker>}
     */ this._searchMarker = [];
    }
    /**
   * Construct a new YArray containing the specified items.
   * @template {Object<string,any>|Array<any>|number|null|string|Uint8Array} T
   * @param {Array<T>} items
   * @return {YArray<T>}
   */ static from(items) {
        /**
     * @type {YArray<T>}
     */ const a = new $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa();
        a.push(items);
        return a;
    }
    /**
   * Integrate this type into the Yjs instance.
   *
   * * Save this struct in the os
   * * This type is sent to other client
   * * Observer functions are fired
   *
   * @param {Doc} y The Yjs instance
   * @param {Item} item
   */ _integrate(y, item) {
        super._integrate(y, item);
        this.insert(0, /** @type {Array<any>} */ this._prelimContent);
        this._prelimContent = null;
    }
    /**
   * @return {YArray<T>}
   */ _copy() {
        return new $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa();
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {YArray<T>}
   */ clone() {
        /**
     * @type {YArray<T>}
     */ const arr = new $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa();
        arr.insert(0, this.toArray().map((el)=>el instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? /** @type {typeof el} */ el.clone() : el));
        return arr;
    }
    get length() {
        this.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
        return this._length;
    }
    /**
   * Creates YArrayEvent and calls observers.
   *
   * @param {Transaction} transaction
   * @param {Set<null|string>} parentSubs Keys changed on this type. `null` if list was modified.
   */ _callObserver(transaction, parentSubs) {
        super._callObserver(transaction, parentSubs);
        $42aaa4fd3d01b4df$var$callTypeObservers(this, transaction, new $42aaa4fd3d01b4df$export$a095f7fee639264a(this, transaction));
    }
    /**
   * Inserts new content at an index.
   *
   * Important: This function expects an array of content. Not just a content
   * object. The reason for this "weirdness" is that inserting several elements
   * is very efficient when it is done as a single operation.
   *
   * @example
   *  // Insert character 'a' at position 0
   *  yarray.insert(0, ['a'])
   *  // Insert numbers 1, 2 at position 1
   *  yarray.insert(1, [1, 2])
   *
   * @param {number} index The index to insert content at.
   * @param {Array<T>} content The array of content
   */ insert(index, content) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeListInsertGenerics(transaction, this, index, /** @type {any} */ content);
        });
        else /** @type {Array<any>} */ this._prelimContent.splice(index, 0, ...content);
    }
    /**
   * Appends content to this YArray.
   *
   * @param {Array<T>} content Array of content to append.
   *
   * @todo Use the following implementation in all types.
   */ push(content) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeListPushGenerics(transaction, this, /** @type {any} */ content);
        });
        else /** @type {Array<any>} */ this._prelimContent.push(...content);
    }
    /**
   * Prepends content to this YArray.
   *
   * @param {Array<T>} content Array of content to prepend.
   */ unshift(content) {
        this.insert(0, content);
    }
    /**
   * Deletes elements starting from an index.
   *
   * @param {number} index Index at which to start deleting elements
   * @param {number} length The number of elements to remove. Defaults to 1.
   */ delete(index, length = 1) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeListDelete(transaction, this, index, length);
        });
        else /** @type {Array<any>} */ this._prelimContent.splice(index, length);
    }
    /**
   * Returns the i-th element from a YArray.
   *
   * @param {number} index The index of the element to return from the YArray
   * @return {T}
   */ get(index) {
        return $42aaa4fd3d01b4df$var$typeListGet(this, index);
    }
    /**
   * Transforms this YArray to a JavaScript Array.
   *
   * @return {Array<T>}
   */ toArray() {
        return $42aaa4fd3d01b4df$var$typeListToArray(this);
    }
    /**
   * Returns a portion of this YArray into a JavaScript Array selected
   * from start to end (end not included).
   *
   * @param {number} [start]
   * @param {number} [end]
   * @return {Array<T>}
   */ slice(start = 0, end = this.length) {
        return $42aaa4fd3d01b4df$var$typeListSlice(this, start, end);
    }
    /**
   * Transforms this Shared Type to a JSON object.
   *
   * @return {Array<any>}
   */ toJSON() {
        return this.map((c)=>c instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? c.toJSON() : c);
    }
    /**
   * Returns an Array with the result of calling a provided function on every
   * element of this YArray.
   *
   * @template M
   * @param {function(T,number,YArray<T>):M} f Function that produces an element of the new Array
   * @return {Array<M>} A new array with each element being the result of the
   *                 callback function
   */ map(f) {
        return $42aaa4fd3d01b4df$var$typeListMap(this, /** @type {any} */ f);
    }
    /**
   * Executes a provided function once on every element of this YArray.
   *
   * @param {function(T,number,YArray<T>):void} f A function to execute on every element of this YArray.
   */ forEach(f) {
        $42aaa4fd3d01b4df$var$typeListForEach(this, f);
    }
    /**
   * @return {IterableIterator<T>}
   */ [Symbol.iterator]() {
        return $42aaa4fd3d01b4df$var$typeListCreateIterator(this);
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   */ _write(encoder) {
        encoder.writeTypeRef($42aaa4fd3d01b4df$var$YArrayRefID);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} _decoder
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readYArray = (_decoder)=>new $42aaa4fd3d01b4df$export$c4be6576ca6fe4aa();
/**
 * @module YMap
 */ /**
 * @template T
 * @extends YEvent<YMap<T>>
 * Event that describes the changes on a YMap.
 */ class $42aaa4fd3d01b4df$export$33aab1b1a47c1cc3 extends $42aaa4fd3d01b4df$export$80fac438977fb51c {
    /**
   * @param {YMap<T>} ymap The YArray that changed.
   * @param {Transaction} transaction
   * @param {Set<any>} subs The keys that changed.
   */ constructor(ymap, transaction, subs){
        super(ymap, transaction);
        this.keysChanged = subs;
    }
}
/**
 * @template MapType
 * A shared Map implementation.
 *
 * @extends AbstractType<YMapEvent<MapType>>
 * @implements {Iterable<[string, MapType]>}
 */ class $42aaa4fd3d01b4df$export$a5c7b93649eaf8f8 extends $42aaa4fd3d01b4df$export$c265dc8338484497 {
    /**
   *
   * @param {Iterable<readonly [string, any]>=} entries - an optional iterable to initialize the YMap
   */ constructor(entries){
        super();
        /**
     * @type {Map<string,any>?}
     * @private
     */ this._prelimContent = null;
        if (entries === undefined) this._prelimContent = new Map();
        else this._prelimContent = new Map(entries);
    }
    /**
   * Integrate this type into the Yjs instance.
   *
   * * Save this struct in the os
   * * This type is sent to other client
   * * Observer functions are fired
   *
   * @param {Doc} y The Yjs instance
   * @param {Item} item
   */ _integrate(y, item) {
        super._integrate(y, item); /** @type {Map<string, any>} */ 
        this._prelimContent.forEach((value, key)=>{
            this.set(key, value);
        });
        this._prelimContent = null;
    }
    /**
   * @return {YMap<MapType>}
   */ _copy() {
        return new $42aaa4fd3d01b4df$export$a5c7b93649eaf8f8();
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {YMap<MapType>}
   */ clone() {
        /**
     * @type {YMap<MapType>}
     */ const map = new $42aaa4fd3d01b4df$export$a5c7b93649eaf8f8();
        this.forEach((value, key)=>{
            map.set(key, value instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? /** @type {typeof value} */ value.clone() : value);
        });
        return map;
    }
    /**
   * Creates YMapEvent and calls observers.
   *
   * @param {Transaction} transaction
   * @param {Set<null|string>} parentSubs Keys changed on this type. `null` if list was modified.
   */ _callObserver(transaction, parentSubs) {
        $42aaa4fd3d01b4df$var$callTypeObservers(this, transaction, new $42aaa4fd3d01b4df$export$33aab1b1a47c1cc3(this, transaction, parentSubs));
    }
    /**
   * Transforms this Shared Type to a JSON object.
   *
   * @return {Object<string,any>}
   */ toJSON() {
        this.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
        /**
     * @type {Object<string,MapType>}
     */ const map = {};
        this._map.forEach((item, key)=>{
            if (!item.deleted) {
                const v = item.content.getContent()[item.length - 1];
                map[key] = v instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? v.toJSON() : v;
            }
        });
        return map;
    }
    /**
   * Returns the size of the YMap (count of key/value pairs)
   *
   * @return {number}
   */ get size() {
        return [
            ...$42aaa4fd3d01b4df$var$createMapIterator(this)
        ].length;
    }
    /**
   * Returns the keys for each element in the YMap Type.
   *
   * @return {IterableIterator<string>}
   */ keys() {
        return $0b9eaeb04b9479fe$export$1570d514f543056a($42aaa4fd3d01b4df$var$createMapIterator(this), /** @param {any} v */ (v)=>v[0]);
    }
    /**
   * Returns the values for each element in the YMap Type.
   *
   * @return {IterableIterator<MapType>}
   */ values() {
        return $0b9eaeb04b9479fe$export$1570d514f543056a($42aaa4fd3d01b4df$var$createMapIterator(this), /** @param {any} v */ (v)=>v[1].content.getContent()[v[1].length - 1]);
    }
    /**
   * Returns an Iterator of [key, value] pairs
   *
   * @return {IterableIterator<[string, MapType]>}
   */ entries() {
        return $0b9eaeb04b9479fe$export$1570d514f543056a($42aaa4fd3d01b4df$var$createMapIterator(this), /** @param {any} v */ (v)=>/** @type {any} */ [
                v[0],
                v[1].content.getContent()[v[1].length - 1]
            ]);
    }
    /**
   * Executes a provided function on once on every key-value pair.
   *
   * @param {function(MapType,string,YMap<MapType>):void} f A function to execute on every element of this YArray.
   */ forEach(f) {
        this.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
        this._map.forEach((item, key)=>{
            if (!item.deleted) f(item.content.getContent()[item.length - 1], key, this);
        });
    }
    /**
   * Returns an Iterator of [key, value] pairs
   *
   * @return {IterableIterator<[string, MapType]>}
   */ [Symbol.iterator]() {
        return this.entries();
    }
    /**
   * Remove a specified element from this YMap.
   *
   * @param {string} key The key of the element to remove.
   */ delete(key) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeMapDelete(transaction, this, key);
        });
        else /** @type {Map<string, any>} */ this._prelimContent.delete(key);
    }
    /**
   * Adds or updates an element with a specified key and value.
   * @template {MapType} VAL
   *
   * @param {string} key The key of the element to add to this YMap
   * @param {VAL} value The value of the element to add
   * @return {VAL}
   */ set(key, value) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeMapSet(transaction, this, key, /** @type {any} */ value);
        });
        else /** @type {Map<string, any>} */ this._prelimContent.set(key, value);
        return value;
    }
    /**
   * Returns a specified element from this YMap.
   *
   * @param {string} key
   * @return {MapType|undefined}
   */ get(key) {
        return /** @type {any} */ $42aaa4fd3d01b4df$var$typeMapGet(this, key);
    }
    /**
   * Returns a boolean indicating whether the specified key exists or not.
   *
   * @param {string} key The key to test.
   * @return {boolean}
   */ has(key) {
        return $42aaa4fd3d01b4df$var$typeMapHas(this, key);
    }
    /**
   * Removes all elements from this YMap.
   */ clear() {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            this.forEach(function(_value, key, map) {
                $42aaa4fd3d01b4df$var$typeMapDelete(transaction, map, key);
            });
        });
        else /** @type {Map<string, any>} */ this._prelimContent.clear();
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   */ _write(encoder) {
        encoder.writeTypeRef($42aaa4fd3d01b4df$var$YMapRefID);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} _decoder
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readYMap = (_decoder)=>new $42aaa4fd3d01b4df$export$a5c7b93649eaf8f8();
/**
 * @module YText
 */ /**
 * @param {any} a
 * @param {any} b
 * @return {boolean}
 */ const $42aaa4fd3d01b4df$var$equalAttrs = (a, b)=>a === b || typeof a === 'object' && typeof b === 'object' && a && b && $a87a3720cf570984$export$4f1c34abb2bb4c8(a, b);
class $42aaa4fd3d01b4df$var$ItemTextListPosition {
    /**
   * @param {Item|null} left
   * @param {Item|null} right
   * @param {number} index
   * @param {Map<string,any>} currentAttributes
   */ constructor(left, right, index, currentAttributes){
        this.left = left;
        this.right = right;
        this.index = index;
        this.currentAttributes = currentAttributes;
    }
    /**
   * Only call this if you know that this.right is defined
   */ forward() {
        if (this.right === null) $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
        switch(this.right.content.constructor){
            case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                if (!this.right.deleted) $42aaa4fd3d01b4df$var$updateCurrentAttributes(this.currentAttributes, /** @type {ContentFormat} */ this.right.content);
                break;
            default:
                if (!this.right.deleted) this.index += this.right.length;
                break;
        }
        this.left = this.right;
        this.right = this.right.right;
    }
}
/**
 * @param {Transaction} transaction
 * @param {ItemTextListPosition} pos
 * @param {number} count steps to move forward
 * @return {ItemTextListPosition}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$findNextPosition = (transaction, pos, count)=>{
    while(pos.right !== null && count > 0){
        switch(pos.right.content.constructor){
            case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                if (!pos.right.deleted) $42aaa4fd3d01b4df$var$updateCurrentAttributes(pos.currentAttributes, /** @type {ContentFormat} */ pos.right.content);
                break;
            default:
                if (!pos.right.deleted) {
                    if (count < pos.right.length) // split right
                    $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(pos.right.id.client, pos.right.id.clock + count));
                    pos.index += pos.right.length;
                    count -= pos.right.length;
                }
                break;
        }
        pos.left = pos.right;
        pos.right = pos.right.right;
    // pos.forward() - we don't forward because that would halve the performance because we already do the checks above
    }
    return pos;
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {number} index
 * @param {boolean} useSearchMarker
 * @return {ItemTextListPosition}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$findPosition = (transaction, parent, index, useSearchMarker)=>{
    const currentAttributes = new Map();
    const marker = useSearchMarker ? $42aaa4fd3d01b4df$var$findMarker(parent, index) : null;
    if (marker) {
        const pos = new $42aaa4fd3d01b4df$var$ItemTextListPosition(marker.p.left, marker.p, marker.index, currentAttributes);
        return $42aaa4fd3d01b4df$var$findNextPosition(transaction, pos, index - marker.index);
    } else {
        const pos = new $42aaa4fd3d01b4df$var$ItemTextListPosition(null, parent._start, 0, currentAttributes);
        return $42aaa4fd3d01b4df$var$findNextPosition(transaction, pos, index);
    }
};
/**
 * Negate applied formats
 *
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {ItemTextListPosition} currPos
 * @param {Map<string,any>} negatedAttributes
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$insertNegatedAttributes = (transaction, parent, currPos, negatedAttributes)=>{
    // check if we really need to remove attributes
    while(currPos.right !== null && (currPos.right.deleted === true || currPos.right.content.constructor === $42aaa4fd3d01b4df$export$3194899188fb5a88 && $42aaa4fd3d01b4df$var$equalAttrs(negatedAttributes.get(/** @type {ContentFormat} */ currPos.right.content.key), /** @type {ContentFormat} */ currPos.right.content.value))){
        if (!currPos.right.deleted) negatedAttributes.delete(/** @type {ContentFormat} */ currPos.right.content.key);
        currPos.forward();
    }
    const doc = transaction.doc;
    const ownClientId = doc.clientID;
    negatedAttributes.forEach((val, key)=>{
        const left = currPos.left;
        const right = currPos.right;
        const nextFormat = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(doc.store, ownClientId)), left, left && left.lastId, right, right && right.id, parent, null, new $42aaa4fd3d01b4df$export$3194899188fb5a88(key, val));
        nextFormat.integrate(transaction, 0);
        currPos.right = nextFormat;
        currPos.forward();
    });
};
/**
 * @param {Map<string,any>} currentAttributes
 * @param {ContentFormat} format
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$updateCurrentAttributes = (currentAttributes, format)=>{
    const { key: key, value: value } = format;
    if (value === null) currentAttributes.delete(key);
    else currentAttributes.set(key, value);
};
/**
 * @param {ItemTextListPosition} currPos
 * @param {Object<string,any>} attributes
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$minimizeAttributeChanges = (currPos, attributes)=>{
    // go right while attributes[right.key] === right.value (or right is deleted)
    while(true){
        if (currPos.right === null) break;
        else if (currPos.right.deleted || currPos.right.content.constructor === $42aaa4fd3d01b4df$export$3194899188fb5a88 && $42aaa4fd3d01b4df$var$equalAttrs(attributes[/** @type {ContentFormat} */ currPos.right.content.key] ?? null, /** @type {ContentFormat} */ currPos.right.content.value)) ;
        else break;
        currPos.forward();
    }
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {ItemTextListPosition} currPos
 * @param {Object<string,any>} attributes
 * @return {Map<string,any>}
 *
 * @private
 * @function
 **/ const $42aaa4fd3d01b4df$var$insertAttributes = (transaction, parent, currPos, attributes)=>{
    const doc = transaction.doc;
    const ownClientId = doc.clientID;
    const negatedAttributes = new Map();
    // insert format-start items
    for(const key in attributes){
        const val = attributes[key];
        const currentVal = currPos.currentAttributes.get(key) ?? null;
        if (!$42aaa4fd3d01b4df$var$equalAttrs(currentVal, val)) {
            // save negated attribute (set null if currentVal undefined)
            negatedAttributes.set(key, currentVal);
            const { left: left, right: right } = currPos;
            currPos.right = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(doc.store, ownClientId)), left, left && left.lastId, right, right && right.id, parent, null, new $42aaa4fd3d01b4df$export$3194899188fb5a88(key, val));
            currPos.right.integrate(transaction, 0);
            currPos.forward();
        }
    }
    return negatedAttributes;
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {ItemTextListPosition} currPos
 * @param {string|object|AbstractType<any>} text
 * @param {Object<string,any>} attributes
 *
 * @private
 * @function
 **/ const $42aaa4fd3d01b4df$var$insertText = (transaction, parent, currPos, text, attributes)=>{
    currPos.currentAttributes.forEach((_val, key)=>{
        if (attributes[key] === undefined) attributes[key] = null;
    });
    const doc = transaction.doc;
    const ownClientId = doc.clientID;
    $42aaa4fd3d01b4df$var$minimizeAttributeChanges(currPos, attributes);
    const negatedAttributes = $42aaa4fd3d01b4df$var$insertAttributes(transaction, parent, currPos, attributes);
    // insert content
    const content = text.constructor === String ? new $42aaa4fd3d01b4df$export$ee670b2cf091bbb6(/** @type {string} */ text) : text instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? new $42aaa4fd3d01b4df$export$e2e108cbe2e4f865(text) : new $42aaa4fd3d01b4df$export$c3787ba7f6086664(text);
    let { left: left, right: right, index: index } = currPos;
    if (parent._searchMarker) $42aaa4fd3d01b4df$var$updateMarkerChanges(parent._searchMarker, currPos.index, content.getLength());
    right = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(doc.store, ownClientId)), left, left && left.lastId, right, right && right.id, parent, null, content);
    right.integrate(transaction, 0);
    currPos.right = right;
    currPos.index = index;
    currPos.forward();
    $42aaa4fd3d01b4df$var$insertNegatedAttributes(transaction, parent, currPos, negatedAttributes);
};
/**
 * @param {Transaction} transaction
 * @param {AbstractType<any>} parent
 * @param {ItemTextListPosition} currPos
 * @param {number} length
 * @param {Object<string,any>} attributes
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$formatText = (transaction, parent, currPos, length, attributes)=>{
    const doc = transaction.doc;
    const ownClientId = doc.clientID;
    $42aaa4fd3d01b4df$var$minimizeAttributeChanges(currPos, attributes);
    const negatedAttributes = $42aaa4fd3d01b4df$var$insertAttributes(transaction, parent, currPos, attributes);
    // iterate until first non-format or null is found
    // delete all formats with attributes[format.key] != null
    // also check the attributes after the first non-format as we do not want to insert redundant negated attributes there
    // eslint-disable-next-line no-labels
    iterationLoop: while(currPos.right !== null && (length > 0 || negatedAttributes.size > 0 && (currPos.right.deleted || currPos.right.content.constructor === $42aaa4fd3d01b4df$export$3194899188fb5a88))){
        if (!currPos.right.deleted) switch(currPos.right.content.constructor){
            case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                {
                    const { key: key, value: value } = /** @type {ContentFormat} */ currPos.right.content;
                    const attr = attributes[key];
                    if (attr !== undefined) {
                        if ($42aaa4fd3d01b4df$var$equalAttrs(attr, value)) negatedAttributes.delete(key);
                        else {
                            if (length === 0) break iterationLoop;
                            negatedAttributes.set(key, value);
                        }
                        currPos.right.delete(transaction);
                    } else currPos.currentAttributes.set(key, value);
                    break;
                }
            default:
                if (length < currPos.right.length) $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(currPos.right.id.client, currPos.right.id.clock + length));
                length -= currPos.right.length;
                break;
        }
        currPos.forward();
    }
    // Quill just assumes that the editor starts with a newline and that it always
    // ends with a newline. We only insert that newline when a new newline is
    // inserted - i.e when length is bigger than type.length
    if (length > 0) {
        let newlines = '';
        for(; length > 0; length--)newlines += '\n';
        currPos.right = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientId, $42aaa4fd3d01b4df$export$50fdfeece43146fd(doc.store, ownClientId)), currPos.left, currPos.left && currPos.left.lastId, currPos.right, currPos.right && currPos.right.id, parent, null, new $42aaa4fd3d01b4df$export$ee670b2cf091bbb6(newlines));
        currPos.right.integrate(transaction, 0);
        currPos.forward();
    }
    $42aaa4fd3d01b4df$var$insertNegatedAttributes(transaction, parent, currPos, negatedAttributes);
};
/**
 * Call this function after string content has been deleted in order to
 * clean up formatting Items.
 *
 * @param {Transaction} transaction
 * @param {Item} start
 * @param {Item|null} curr exclusive end, automatically iterates to the next Content Item
 * @param {Map<string,any>} startAttributes
 * @param {Map<string,any>} currAttributes
 * @return {number} The amount of formatting Items deleted.
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$cleanupFormattingGap = (transaction, start, curr, startAttributes, currAttributes)=>{
    /**
   * @type {Item|null}
   */ let end = start;
    /**
   * @type {Map<string,ContentFormat>}
   */ const endFormats = $58ab1e30cc73aec7$export$185802fd694ee1f5();
    while(end && (!end.countable || end.deleted)){
        if (!end.deleted && end.content.constructor === $42aaa4fd3d01b4df$export$3194899188fb5a88) {
            const cf = /** @type {ContentFormat} */ end.content;
            endFormats.set(cf.key, cf);
        }
        end = end.right;
    }
    let cleanups = 0;
    let reachedCurr = false;
    while(start !== end){
        if (curr === start) reachedCurr = true;
        if (!start.deleted) {
            const content = start.content;
            switch(content.constructor){
                case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                    {
                        const { key: key, value: value } = /** @type {ContentFormat} */ content;
                        const startAttrValue = startAttributes.get(key) ?? null;
                        if (endFormats.get(key) !== content || startAttrValue === value) {
                            // Either this format is overwritten or it is not necessary because the attribute already existed.
                            start.delete(transaction);
                            cleanups++;
                            if (!reachedCurr && (currAttributes.get(key) ?? null) === value && startAttrValue !== value) {
                                if (startAttrValue === null) currAttributes.delete(key);
                                else currAttributes.set(key, startAttrValue);
                            }
                        }
                        if (!reachedCurr && !start.deleted) $42aaa4fd3d01b4df$var$updateCurrentAttributes(currAttributes, /** @type {ContentFormat} */ content);
                        break;
                    }
            }
        }
        start = /** @type {Item} */ start.right;
    }
    return cleanups;
};
/**
 * @param {Transaction} transaction
 * @param {Item | null} item
 */ const $42aaa4fd3d01b4df$var$cleanupContextlessFormattingGap = (transaction, item)=>{
    // iterate until item.right is null or content
    while(item && item.right && (item.right.deleted || !item.right.countable))item = item.right;
    const attrs = new Set();
    // iterate back until a content item is found
    while(item && (item.deleted || !item.countable)){
        if (!item.deleted && item.content.constructor === $42aaa4fd3d01b4df$export$3194899188fb5a88) {
            const key = /** @type {ContentFormat} */ item.content.key;
            if (attrs.has(key)) item.delete(transaction);
            else attrs.add(key);
        }
        item = item.left;
    }
};
/**
 * This function is experimental and subject to change / be removed.
 *
 * Ideally, we don't need this function at all. Formatting attributes should be cleaned up
 * automatically after each change. This function iterates twice over the complete YText type
 * and removes unnecessary formatting attributes. This is also helpful for testing.
 *
 * This function won't be exported anymore as soon as there is confidence that the YText type works as intended.
 *
 * @param {YText} type
 * @return {number} How many formatting attributes have been cleaned up.
 */ const $42aaa4fd3d01b4df$export$5d9f53c13ebffb65 = (type)=>{
    let res = 0;
    $42aaa4fd3d01b4df$export$dac1bad6146b2469(/** @type {Doc} */ type.doc, (transaction)=>{
        let start = /** @type {Item} */ type._start;
        let end = type._start;
        let startAttributes = $58ab1e30cc73aec7$export$185802fd694ee1f5();
        const currentAttributes = $58ab1e30cc73aec7$export$784d13d8ee351f07(startAttributes);
        while(end){
            if (end.deleted === false) switch(end.content.constructor){
                case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                    $42aaa4fd3d01b4df$var$updateCurrentAttributes(currentAttributes, /** @type {ContentFormat} */ end.content);
                    break;
                default:
                    res += $42aaa4fd3d01b4df$var$cleanupFormattingGap(transaction, start, end, startAttributes, currentAttributes);
                    startAttributes = $58ab1e30cc73aec7$export$784d13d8ee351f07(currentAttributes);
                    start = end;
                    break;
            }
            end = end.right;
        }
    });
    return res;
};
/**
 * This will be called by the transction once the event handlers are called to potentially cleanup
 * formatting attributes.
 *
 * @param {Transaction} transaction
 */ const $42aaa4fd3d01b4df$var$cleanupYTextAfterTransaction = (transaction)=>{
    /**
   * @type {Set<YText>}
   */ const needFullCleanup = new Set();
    // check if another formatting item was inserted
    const doc = transaction.doc;
    for (const [client, afterClock] of transaction.afterState.entries()){
        const clock = transaction.beforeState.get(client) || 0;
        if (afterClock === clock) continue;
        $42aaa4fd3d01b4df$var$iterateStructs(transaction, /** @type {Array<Item|GC>} */ doc.store.clients.get(client), clock, afterClock, (item)=>{
            if (!item.deleted && /** @type {Item} */ item.content.constructor === $42aaa4fd3d01b4df$export$3194899188fb5a88 && item.constructor !== $42aaa4fd3d01b4df$export$12d259ff017e6b58) needFullCleanup.add(/** @type {any} */ item.parent);
        });
    }
    // cleanup in a new transaction
    $42aaa4fd3d01b4df$export$dac1bad6146b2469(doc, (t)=>{
        $42aaa4fd3d01b4df$export$8afefebbaf4e4c78(transaction, transaction.deleteSet, (item)=>{
            if (item instanceof $42aaa4fd3d01b4df$export$12d259ff017e6b58 || !/** @type {YText} */ item.parent._hasFormatting || needFullCleanup.has(/** @type {YText} */ item.parent)) return;
            const parent = /** @type {YText} */ item.parent;
            if (item.content.constructor === $42aaa4fd3d01b4df$export$3194899188fb5a88) needFullCleanup.add(parent);
            else // If no formatting attribute was inserted or deleted, we can make due with contextless
            // formatting cleanups.
            // Contextless: it is not necessary to compute currentAttributes for the affected position.
            $42aaa4fd3d01b4df$var$cleanupContextlessFormattingGap(t, item);
        });
        // If a formatting item was inserted, we simply clean the whole type.
        // We need to compute currentAttributes for the current position anyway.
        for (const yText of needFullCleanup)$42aaa4fd3d01b4df$export$5d9f53c13ebffb65(yText);
    });
};
/**
 * @param {Transaction} transaction
 * @param {ItemTextListPosition} currPos
 * @param {number} length
 * @return {ItemTextListPosition}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$deleteText = (transaction, currPos, length)=>{
    const startLength = length;
    const startAttrs = $58ab1e30cc73aec7$export$784d13d8ee351f07(currPos.currentAttributes);
    const start = currPos.right;
    while(length > 0 && currPos.right !== null){
        if (currPos.right.deleted === false) switch(currPos.right.content.constructor){
            case $42aaa4fd3d01b4df$export$e2e108cbe2e4f865:
            case $42aaa4fd3d01b4df$export$c3787ba7f6086664:
            case $42aaa4fd3d01b4df$export$ee670b2cf091bbb6:
                if (length < currPos.right.length) $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(currPos.right.id.client, currPos.right.id.clock + length));
                length -= currPos.right.length;
                currPos.right.delete(transaction);
                break;
        }
        currPos.forward();
    }
    if (start) $42aaa4fd3d01b4df$var$cleanupFormattingGap(transaction, start, currPos.right, startAttrs, currPos.currentAttributes);
    const parent = /** @type {AbstractType<any>} */ /** @type {Item} */ (currPos.left || currPos.right).parent;
    if (parent._searchMarker) $42aaa4fd3d01b4df$var$updateMarkerChanges(parent._searchMarker, currPos.index, -startLength + length);
    return currPos;
};
/**
 * The Quill Delta format represents changes on a text document with
 * formatting information. For mor information visit {@link https://quilljs.com/docs/delta/|Quill Delta}
 *
 * @example
 *   {
 *     ops: [
 *       { insert: 'Gandalf', attributes: { bold: true } },
 *       { insert: ' the ' },
 *       { insert: 'Grey', attributes: { color: '#cccccc' } }
 *     ]
 *   }
 *
 */ /**
  * Attributes that can be assigned to a selection of text.
  *
  * @example
  *   {
  *     bold: true,
  *     font-size: '40px'
  *   }
  *
  * @typedef {Object} TextAttributes
  */ /**
 * @extends YEvent<YText>
 * Event that describes the changes on a YText type.
 */ class $42aaa4fd3d01b4df$export$51155b8ebb74188a extends $42aaa4fd3d01b4df$export$80fac438977fb51c {
    /**
   * @param {YText} ytext
   * @param {Transaction} transaction
   * @param {Set<any>} subs The keys that changed
   */ constructor(ytext, transaction, subs){
        super(ytext, transaction);
        /**
     * Whether the children changed.
     * @type {Boolean}
     * @private
     */ this.childListChanged = false;
        /**
     * Set of all changed attributes.
     * @type {Set<string>}
     */ this.keysChanged = new Set();
        subs.forEach((sub)=>{
            if (sub === null) this.childListChanged = true;
            else this.keysChanged.add(sub);
        });
    }
    /**
   * @type {{added:Set<Item>,deleted:Set<Item>,keys:Map<string,{action:'add'|'update'|'delete',oldValue:any}>,delta:Array<{insert?:Array<any>|string, delete?:number, retain?:number}>}}
   */ get changes() {
        if (this._changes === null) {
            /**
       * @type {{added:Set<Item>,deleted:Set<Item>,keys:Map<string,{action:'add'|'update'|'delete',oldValue:any}>,delta:Array<{insert?:Array<any>|string|AbstractType<any>|object, delete?:number, retain?:number}>}}
       */ const changes = {
                keys: this.keys,
                delta: this.delta,
                added: new Set(),
                deleted: new Set()
            };
            this._changes = changes;
        }
        return /** @type {any} */ this._changes;
    }
    /**
   * Compute the changes in the delta format.
   * A {@link https://quilljs.com/docs/delta/|Quill Delta}) that represents the changes on the document.
   *
   * @type {Array<{insert?:string|object|AbstractType<any>, delete?:number, retain?:number, attributes?: Object<string,any>}>}
   *
   * @public
   */ get delta() {
        if (this._delta === null) {
            const y = /** @type {Doc} */ this.target.doc;
            /**
       * @type {Array<{insert?:string|object|AbstractType<any>, delete?:number, retain?:number, attributes?: Object<string,any>}>}
       */ const delta = [];
            $42aaa4fd3d01b4df$export$dac1bad6146b2469(y, (transaction)=>{
                const currentAttributes = new Map(); // saves all current attributes for insert
                const oldAttributes = new Map();
                let item = this.target._start;
                /**
         * @type {string?}
         */ let action = null;
                /**
         * @type {Object<string,any>}
         */ const attributes = {}; // counts added or removed new attributes for retain
                /**
         * @type {string|object}
         */ let insert = '';
                let retain = 0;
                let deleteLen = 0;
                const addOp = ()=>{
                    if (action !== null) {
                        /**
             * @type {any}
             */ let op = null;
                        switch(action){
                            case 'delete':
                                if (deleteLen > 0) op = {
                                    delete: deleteLen
                                };
                                deleteLen = 0;
                                break;
                            case 'insert':
                                if (typeof insert === 'object' || insert.length > 0) {
                                    op = {
                                        insert: insert
                                    };
                                    if (currentAttributes.size > 0) {
                                        op.attributes = {};
                                        currentAttributes.forEach((value, key)=>{
                                            if (value !== null) op.attributes[key] = value;
                                        });
                                    }
                                }
                                insert = '';
                                break;
                            case 'retain':
                                if (retain > 0) {
                                    op = {
                                        retain: retain
                                    };
                                    if (!$a87a3720cf570984$export$dd1bc94b04021eeb(attributes)) op.attributes = $a87a3720cf570984$export$e6e34fd1f2686227({}, attributes);
                                }
                                retain = 0;
                                break;
                        }
                        if (op) delta.push(op);
                        action = null;
                    }
                };
                while(item !== null){
                    switch(item.content.constructor){
                        case $42aaa4fd3d01b4df$export$e2e108cbe2e4f865:
                        case $42aaa4fd3d01b4df$export$c3787ba7f6086664:
                            if (this.adds(item)) {
                                if (!this.deletes(item)) {
                                    addOp();
                                    action = 'insert';
                                    insert = item.content.getContent()[0];
                                    addOp();
                                }
                            } else if (this.deletes(item)) {
                                if (action !== 'delete') {
                                    addOp();
                                    action = 'delete';
                                }
                                deleteLen += 1;
                            } else if (!item.deleted) {
                                if (action !== 'retain') {
                                    addOp();
                                    action = 'retain';
                                }
                                retain += 1;
                            }
                            break;
                        case $42aaa4fd3d01b4df$export$ee670b2cf091bbb6:
                            if (this.adds(item)) {
                                if (!this.deletes(item)) {
                                    if (action !== 'insert') {
                                        addOp();
                                        action = 'insert';
                                    }
                                    insert += /** @type {ContentString} */ item.content.str;
                                }
                            } else if (this.deletes(item)) {
                                if (action !== 'delete') {
                                    addOp();
                                    action = 'delete';
                                }
                                deleteLen += item.length;
                            } else if (!item.deleted) {
                                if (action !== 'retain') {
                                    addOp();
                                    action = 'retain';
                                }
                                retain += item.length;
                            }
                            break;
                        case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                            {
                                const { key: key, value: value } = /** @type {ContentFormat} */ item.content;
                                if (this.adds(item)) {
                                    if (!this.deletes(item)) {
                                        const curVal = currentAttributes.get(key) ?? null;
                                        if (!$42aaa4fd3d01b4df$var$equalAttrs(curVal, value)) {
                                            if (action === 'retain') addOp();
                                            if ($42aaa4fd3d01b4df$var$equalAttrs(value, oldAttributes.get(key) ?? null)) delete attributes[key];
                                            else attributes[key] = value;
                                        } else if (value !== null) item.delete(transaction);
                                    }
                                } else if (this.deletes(item)) {
                                    oldAttributes.set(key, value);
                                    const curVal = currentAttributes.get(key) ?? null;
                                    if (!$42aaa4fd3d01b4df$var$equalAttrs(curVal, value)) {
                                        if (action === 'retain') addOp();
                                        attributes[key] = curVal;
                                    }
                                } else if (!item.deleted) {
                                    oldAttributes.set(key, value);
                                    const attr = attributes[key];
                                    if (attr !== undefined) {
                                        if (!$42aaa4fd3d01b4df$var$equalAttrs(attr, value)) {
                                            if (action === 'retain') addOp();
                                            if (value === null) delete attributes[key];
                                            else attributes[key] = value;
                                        } else if (attr !== null) item.delete(transaction);
                                    }
                                }
                                if (!item.deleted) {
                                    if (action === 'insert') addOp();
                                    $42aaa4fd3d01b4df$var$updateCurrentAttributes(currentAttributes, /** @type {ContentFormat} */ item.content);
                                }
                                break;
                            }
                    }
                    item = item.right;
                }
                addOp();
                while(delta.length > 0){
                    const lastOp = delta[delta.length - 1];
                    if (lastOp.retain !== undefined && lastOp.attributes === undefined) // retain delta's if they don't assign attributes
                    delta.pop();
                    else break;
                }
            });
            this._delta = delta;
        }
        return /** @type {any} */ this._delta;
    }
}
/**
 * Type that represents text with formatting information.
 *
 * This type replaces y-richtext as this implementation is able to handle
 * block formats (format information on a paragraph), embeds (complex elements
 * like pictures and videos), and text formats (**bold**, *italic*).
 *
 * @extends AbstractType<YTextEvent>
 */ class $42aaa4fd3d01b4df$export$5f1af8db9871e1d6 extends $42aaa4fd3d01b4df$export$c265dc8338484497 {
    /**
   * @param {String} [string] The initial value of the YText.
   */ constructor(string){
        super();
        /**
     * Array of pending operations on this type
     * @type {Array<function():void>?}
     */ this._pending = string !== undefined ? [
            ()=>this.insert(0, string)
        ] : [];
        /**
     * @type {Array<ArraySearchMarker>|null}
     */ this._searchMarker = [];
        /**
     * Whether this YText contains formatting attributes.
     * This flag is updated when a formatting item is integrated (see ContentFormat.integrate)
     */ this._hasFormatting = false;
    }
    /**
   * Number of characters of this text type.
   *
   * @type {number}
   */ get length() {
        this.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
        return this._length;
    }
    /**
   * @param {Doc} y
   * @param {Item} item
   */ _integrate(y, item) {
        super._integrate(y, item);
        try {
            /** @type {Array<function>} */ this._pending.forEach((f)=>f());
        } catch (e) {
            console.error(e);
        }
        this._pending = null;
    }
    _copy() {
        return new $42aaa4fd3d01b4df$export$5f1af8db9871e1d6();
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {YText}
   */ clone() {
        const text = new $42aaa4fd3d01b4df$export$5f1af8db9871e1d6();
        text.applyDelta(this.toDelta());
        return text;
    }
    /**
   * Creates YTextEvent and calls observers.
   *
   * @param {Transaction} transaction
   * @param {Set<null|string>} parentSubs Keys changed on this type. `null` if list was modified.
   */ _callObserver(transaction, parentSubs) {
        super._callObserver(transaction, parentSubs);
        const event = new $42aaa4fd3d01b4df$export$51155b8ebb74188a(this, transaction, parentSubs);
        $42aaa4fd3d01b4df$var$callTypeObservers(this, transaction, event);
        // If a remote change happened, we try to cleanup potential formatting duplicates.
        if (!transaction.local && this._hasFormatting) transaction._needFormattingCleanup = true;
    }
    /**
   * Returns the unformatted string representation of this YText type.
   *
   * @public
   */ toString() {
        this.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
        let str = '';
        /**
     * @type {Item|null}
     */ let n = this._start;
        while(n !== null){
            if (!n.deleted && n.countable && n.content.constructor === $42aaa4fd3d01b4df$export$ee670b2cf091bbb6) str += /** @type {ContentString} */ n.content.str;
            n = n.right;
        }
        return str;
    }
    /**
   * Returns the unformatted string representation of this YText type.
   *
   * @return {string}
   * @public
   */ toJSON() {
        return this.toString();
    }
    /**
   * Apply a {@link Delta} on this shared YText type.
   *
   * @param {any} delta The changes to apply on this element.
   * @param {object}  opts
   * @param {boolean} [opts.sanitize] Sanitize input delta. Removes ending newlines if set to true.
   *
   *
   * @public
   */ applyDelta(delta, { sanitize: sanitize = true } = {}) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            const currPos = new $42aaa4fd3d01b4df$var$ItemTextListPosition(null, this._start, 0, new Map());
            for(let i = 0; i < delta.length; i++){
                const op = delta[i];
                if (op.insert !== undefined) {
                    // Quill assumes that the content starts with an empty paragraph.
                    // Yjs/Y.Text assumes that it starts empty. We always hide that
                    // there is a newline at the end of the content.
                    // If we omit this step, clients will see a different number of
                    // paragraphs, but nothing bad will happen.
                    const ins = !sanitize && typeof op.insert === 'string' && i === delta.length - 1 && currPos.right === null && op.insert.slice(-1) === '\n' ? op.insert.slice(0, -1) : op.insert;
                    if (typeof ins !== 'string' || ins.length > 0) $42aaa4fd3d01b4df$var$insertText(transaction, this, currPos, ins, op.attributes || {});
                } else if (op.retain !== undefined) $42aaa4fd3d01b4df$var$formatText(transaction, this, currPos, op.retain, op.attributes || {});
                else if (op.delete !== undefined) $42aaa4fd3d01b4df$var$deleteText(transaction, currPos, op.delete);
            }
        });
        else /** @type {Array<function>} */ this._pending.push(()=>this.applyDelta(delta));
    }
    /**
   * Returns the Delta representation of this YText type.
   *
   * @param {Snapshot} [snapshot]
   * @param {Snapshot} [prevSnapshot]
   * @param {function('removed' | 'added', ID):any} [computeYChange]
   * @return {any} The Delta representation of this type.
   *
   * @public
   */ toDelta(snapshot, prevSnapshot, computeYChange) {
        this.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
        /**
     * @type{Array<any>}
     */ const ops = [];
        const currentAttributes = new Map();
        const doc = /** @type {Doc} */ this.doc;
        let str = '';
        let n = this._start;
        function packStr() {
            if (str.length > 0) {
                // pack str with attributes to ops
                /**
         * @type {Object<string,any>}
         */ const attributes = {};
                let addAttributes = false;
                currentAttributes.forEach((value, key)=>{
                    addAttributes = true;
                    attributes[key] = value;
                });
                /**
         * @type {Object<string,any>}
         */ const op = {
                    insert: str
                };
                if (addAttributes) op.attributes = attributes;
                ops.push(op);
                str = '';
            }
        }
        const computeDelta = ()=>{
            while(n !== null){
                if ($42aaa4fd3d01b4df$var$isVisible(n, snapshot) || prevSnapshot !== undefined && $42aaa4fd3d01b4df$var$isVisible(n, prevSnapshot)) switch(n.content.constructor){
                    case $42aaa4fd3d01b4df$export$ee670b2cf091bbb6:
                        {
                            const cur = currentAttributes.get('ychange');
                            if (snapshot !== undefined && !$42aaa4fd3d01b4df$var$isVisible(n, snapshot)) {
                                if (cur === undefined || cur.user !== n.id.client || cur.type !== 'removed') {
                                    packStr();
                                    currentAttributes.set('ychange', computeYChange ? computeYChange('removed', n.id) : {
                                        type: 'removed'
                                    });
                                }
                            } else if (prevSnapshot !== undefined && !$42aaa4fd3d01b4df$var$isVisible(n, prevSnapshot)) {
                                if (cur === undefined || cur.user !== n.id.client || cur.type !== 'added') {
                                    packStr();
                                    currentAttributes.set('ychange', computeYChange ? computeYChange('added', n.id) : {
                                        type: 'added'
                                    });
                                }
                            } else if (cur !== undefined) {
                                packStr();
                                currentAttributes.delete('ychange');
                            }
                            str += /** @type {ContentString} */ n.content.str;
                            break;
                        }
                    case $42aaa4fd3d01b4df$export$e2e108cbe2e4f865:
                    case $42aaa4fd3d01b4df$export$c3787ba7f6086664:
                        {
                            packStr();
                            /**
               * @type {Object<string,any>}
               */ const op = {
                                insert: n.content.getContent()[0]
                            };
                            if (currentAttributes.size > 0) {
                                const attrs = /** @type {Object<string,any>} */ {};
                                op.attributes = attrs;
                                currentAttributes.forEach((value, key)=>{
                                    attrs[key] = value;
                                });
                            }
                            ops.push(op);
                            break;
                        }
                    case $42aaa4fd3d01b4df$export$3194899188fb5a88:
                        if ($42aaa4fd3d01b4df$var$isVisible(n, snapshot)) {
                            packStr();
                            $42aaa4fd3d01b4df$var$updateCurrentAttributes(currentAttributes, /** @type {ContentFormat} */ n.content);
                        }
                        break;
                }
                n = n.right;
            }
            packStr();
        };
        if (snapshot || prevSnapshot) // snapshots are merged again after the transaction, so we need to keep the
        // transaction alive until we are done
        $42aaa4fd3d01b4df$export$dac1bad6146b2469(doc, (transaction)=>{
            if (snapshot) $42aaa4fd3d01b4df$var$splitSnapshotAffectedStructs(transaction, snapshot);
            if (prevSnapshot) $42aaa4fd3d01b4df$var$splitSnapshotAffectedStructs(transaction, prevSnapshot);
            computeDelta();
        }, 'cleanup');
        else computeDelta();
        return ops;
    }
    /**
   * Insert text at a given index.
   *
   * @param {number} index The index at which to start inserting.
   * @param {String} text The text to insert at the specified position.
   * @param {TextAttributes} [attributes] Optionally define some formatting
   *                                    information to apply on the inserted
   *                                    Text.
   * @public
   */ insert(index, text, attributes) {
        if (text.length <= 0) return;
        const y = this.doc;
        if (y !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(y, (transaction)=>{
            const pos = $42aaa4fd3d01b4df$var$findPosition(transaction, this, index, !attributes);
            if (!attributes) {
                attributes = {};
                // @ts-ignore
                pos.currentAttributes.forEach((v, k)=>{
                    attributes[k] = v;
                });
            }
            $42aaa4fd3d01b4df$var$insertText(transaction, this, pos, text, attributes);
        });
        else /** @type {Array<function>} */ this._pending.push(()=>this.insert(index, text, attributes));
    }
    /**
   * Inserts an embed at a index.
   *
   * @param {number} index The index to insert the embed at.
   * @param {Object | AbstractType<any>} embed The Object that represents the embed.
   * @param {TextAttributes} [attributes] Attribute information to apply on the
   *                                    embed
   *
   * @public
   */ insertEmbed(index, embed, attributes) {
        const y = this.doc;
        if (y !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(y, (transaction)=>{
            const pos = $42aaa4fd3d01b4df$var$findPosition(transaction, this, index, !attributes);
            $42aaa4fd3d01b4df$var$insertText(transaction, this, pos, embed, attributes || {});
        });
        else /** @type {Array<function>} */ this._pending.push(()=>this.insertEmbed(index, embed, attributes || {}));
    }
    /**
   * Deletes text starting from an index.
   *
   * @param {number} index Index at which to start deleting.
   * @param {number} length The number of characters to remove. Defaults to 1.
   *
   * @public
   */ delete(index, length) {
        if (length === 0) return;
        const y = this.doc;
        if (y !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(y, (transaction)=>{
            $42aaa4fd3d01b4df$var$deleteText(transaction, $42aaa4fd3d01b4df$var$findPosition(transaction, this, index, true), length);
        });
        else /** @type {Array<function>} */ this._pending.push(()=>this.delete(index, length));
    }
    /**
   * Assigns properties to a range of text.
   *
   * @param {number} index The position where to start formatting.
   * @param {number} length The amount of characters to assign properties to.
   * @param {TextAttributes} attributes Attribute information to apply on the
   *                                    text.
   *
   * @public
   */ format(index, length, attributes) {
        if (length === 0) return;
        const y = this.doc;
        if (y !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(y, (transaction)=>{
            const pos = $42aaa4fd3d01b4df$var$findPosition(transaction, this, index, false);
            if (pos.right === null) return;
            $42aaa4fd3d01b4df$var$formatText(transaction, this, pos, length, attributes);
        });
        else /** @type {Array<function>} */ this._pending.push(()=>this.format(index, length, attributes));
    }
    /**
   * Removes an attribute.
   *
   * @note Xml-Text nodes don't have attributes. You can use this feature to assign properties to complete text-blocks.
   *
   * @param {String} attributeName The attribute name that is to be removed.
   *
   * @public
   */ removeAttribute(attributeName) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeMapDelete(transaction, this, attributeName);
        });
        else /** @type {Array<function>} */ this._pending.push(()=>this.removeAttribute(attributeName));
    }
    /**
   * Sets or updates an attribute.
   *
   * @note Xml-Text nodes don't have attributes. You can use this feature to assign properties to complete text-blocks.
   *
   * @param {String} attributeName The attribute name that is to be set.
   * @param {any} attributeValue The attribute value that is to be set.
   *
   * @public
   */ setAttribute(attributeName, attributeValue) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeMapSet(transaction, this, attributeName, attributeValue);
        });
        else /** @type {Array<function>} */ this._pending.push(()=>this.setAttribute(attributeName, attributeValue));
    }
    /**
   * Returns an attribute value that belongs to the attribute name.
   *
   * @note Xml-Text nodes don't have attributes. You can use this feature to assign properties to complete text-blocks.
   *
   * @param {String} attributeName The attribute name that identifies the
   *                               queried value.
   * @return {any} The queried attribute value.
   *
   * @public
   */ getAttribute(attributeName) {
        return /** @type {any} */ $42aaa4fd3d01b4df$var$typeMapGet(this, attributeName);
    }
    /**
   * Returns all attribute name/value pairs in a JSON Object.
   *
   * @note Xml-Text nodes don't have attributes. You can use this feature to assign properties to complete text-blocks.
   *
   * @return {Object<string, any>} A JSON Object that describes the attributes.
   *
   * @public
   */ getAttributes() {
        return $42aaa4fd3d01b4df$var$typeMapGetAll(this);
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   */ _write(encoder) {
        encoder.writeTypeRef($42aaa4fd3d01b4df$var$YTextRefID);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} _decoder
 * @return {YText}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readYText = (_decoder)=>new $42aaa4fd3d01b4df$export$5f1af8db9871e1d6();
/**
 * @module YXml
 */ /**
 * Define the elements to which a set of CSS queries apply.
 * {@link https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors|CSS_Selectors}
 *
 * @example
 *   query = '.classSelector'
 *   query = 'nodeSelector'
 *   query = '#idSelector'
 *
 * @typedef {string} CSS_Selector
 */ /**
 * Dom filter function.
 *
 * @callback domFilter
 * @param {string} nodeName The nodeName of the element
 * @param {Map} attributes The map of attributes.
 * @return {boolean} Whether to include the Dom node in the YXmlElement.
 */ /**
 * Represents a subset of the nodes of a YXmlElement / YXmlFragment and a
 * position within them.
 *
 * Can be created with {@link YXmlFragment#createTreeWalker}
 *
 * @public
 * @implements {Iterable<YXmlElement|YXmlText|YXmlElement|YXmlHook>}
 */ class $42aaa4fd3d01b4df$var$YXmlTreeWalker {
    /**
   * @param {YXmlFragment | YXmlElement} root
   * @param {function(AbstractType<any>):boolean} [f]
   */ constructor(root, f = ()=>true){
        this._filter = f;
        this._root = root;
        /**
     * @type {Item}
     */ this._currentNode = /** @type {Item} */ root._start;
        this._firstCall = true;
        root.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
    }
    [Symbol.iterator]() {
        return this;
    }
    /**
   * Get the next node.
   *
   * @return {IteratorResult<YXmlElement|YXmlText|YXmlHook>} The next node.
   *
   * @public
   */ next() {
        /**
     * @type {Item|null}
     */ let n = this._currentNode;
        let type = n && n.content && /** @type {any} */ n.content.type;
        if (n !== null && (!this._firstCall || n.deleted || !this._filter(type))) do {
            type = /** @type {any} */ n.content.type;
            if (!n.deleted && (type.constructor === $42aaa4fd3d01b4df$export$4db87581d3ca170d || type.constructor === $42aaa4fd3d01b4df$export$d5ce8c3e1731f1a7) && type._start !== null) // walk down in the tree
            n = type._start;
            else // walk right or up in the tree
            while(n !== null){
                if (n.right !== null) {
                    n = n.right;
                    break;
                } else if (n.parent === this._root) n = null;
                else n = /** @type {AbstractType<any>} */ n.parent._item;
            }
        }while (n !== null && (n.deleted || !this._filter(/** @type {ContentType} */ n.content.type)));
        this._firstCall = false;
        if (n === null) // @ts-ignore
        return {
            value: undefined,
            done: true
        };
        this._currentNode = n;
        return {
            value: /** @type {any} */ n.content.type,
            done: false
        };
    }
}
/**
 * Represents a list of {@link YXmlElement}.and {@link YXmlText} types.
 * A YxmlFragment is similar to a {@link YXmlElement}, but it does not have a
 * nodeName and it does not have attributes. Though it can be bound to a DOM
 * element - in this case the attributes and the nodeName are not shared.
 *
 * @public
 * @extends AbstractType<YXmlEvent>
 */ class $42aaa4fd3d01b4df$export$d5ce8c3e1731f1a7 extends $42aaa4fd3d01b4df$export$c265dc8338484497 {
    constructor(){
        super();
        /**
     * @type {Array<any>|null}
     */ this._prelimContent = [];
    }
    /**
   * @type {YXmlElement|YXmlText|null}
   */ get firstChild() {
        const first = this._first;
        return first ? first.content.getContent()[0] : null;
    }
    /**
   * Integrate this type into the Yjs instance.
   *
   * * Save this struct in the os
   * * This type is sent to other client
   * * Observer functions are fired
   *
   * @param {Doc} y The Yjs instance
   * @param {Item} item
   */ _integrate(y, item) {
        super._integrate(y, item);
        this.insert(0, /** @type {Array<any>} */ this._prelimContent);
        this._prelimContent = null;
    }
    _copy() {
        return new $42aaa4fd3d01b4df$export$d5ce8c3e1731f1a7();
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {YXmlFragment}
   */ clone() {
        const el = new $42aaa4fd3d01b4df$export$d5ce8c3e1731f1a7();
        // @ts-ignore
        el.insert(0, this.toArray().map((item)=>item instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? item.clone() : item));
        return el;
    }
    get length() {
        this.doc ?? $42aaa4fd3d01b4df$var$warnPrematureAccess();
        return this._prelimContent === null ? this._length : this._prelimContent.length;
    }
    /**
   * Create a subtree of childNodes.
   *
   * @example
   * const walker = elem.createTreeWalker(dom => dom.nodeName === 'div')
   * for (let node in walker) {
   *   // `node` is a div node
   *   nop(node)
   * }
   *
   * @param {function(AbstractType<any>):boolean} filter Function that is called on each child element and
   *                          returns a Boolean indicating whether the child
   *                          is to be included in the subtree.
   * @return {YXmlTreeWalker} A subtree and a position within it.
   *
   * @public
   */ createTreeWalker(filter) {
        return new $42aaa4fd3d01b4df$var$YXmlTreeWalker(this, filter);
    }
    /**
   * Returns the first YXmlElement that matches the query.
   * Similar to DOM's {@link querySelector}.
   *
   * Query support:
   *   - tagname
   * TODO:
   *   - id
   *   - attribute
   *
   * @param {CSS_Selector} query The query on the children.
   * @return {YXmlElement|YXmlText|YXmlHook|null} The first element that matches the query or null.
   *
   * @public
   */ querySelector(query) {
        query = query.toUpperCase();
        // @ts-ignore
        const iterator = new $42aaa4fd3d01b4df$var$YXmlTreeWalker(this, (element)=>element.nodeName && element.nodeName.toUpperCase() === query);
        const next = iterator.next();
        if (next.done) return null;
        else return next.value;
    }
    /**
   * Returns all YXmlElements that match the query.
   * Similar to Dom's {@link querySelectorAll}.
   *
   * @todo Does not yet support all queries. Currently only query by tagName.
   *
   * @param {CSS_Selector} query The query on the children
   * @return {Array<YXmlElement|YXmlText|YXmlHook|null>} The elements that match this query.
   *
   * @public
   */ querySelectorAll(query) {
        query = query.toUpperCase();
        // @ts-ignore
        return $cfaabc628d0f476d$export$6788812c4e6611e6(new $42aaa4fd3d01b4df$var$YXmlTreeWalker(this, (element)=>element.nodeName && element.nodeName.toUpperCase() === query));
    }
    /**
   * Creates YXmlEvent and calls observers.
   *
   * @param {Transaction} transaction
   * @param {Set<null|string>} parentSubs Keys changed on this type. `null` if list was modified.
   */ _callObserver(transaction, parentSubs) {
        $42aaa4fd3d01b4df$var$callTypeObservers(this, transaction, new $42aaa4fd3d01b4df$export$88c9145a0c3b556c(this, parentSubs, transaction));
    }
    /**
   * Get the string representation of all the children of this YXmlFragment.
   *
   * @return {string} The string representation of all children.
   */ toString() {
        return $42aaa4fd3d01b4df$var$typeListMap(this, (xml)=>xml.toString()).join('');
    }
    /**
   * @return {string}
   */ toJSON() {
        return this.toString();
    }
    /**
   * Creates a Dom Element that mirrors this YXmlElement.
   *
   * @param {Document} [_document=document] The document object (you must define
   *                                        this when calling this method in
   *                                        nodejs)
   * @param {Object<string, any>} [hooks={}] Optional property to customize how hooks
   *                                             are presented in the DOM
   * @param {any} [binding] You should not set this property. This is
   *                               used if DomBinding wants to create a
   *                               association to the created DOM type.
   * @return {Node} The {@link https://developer.mozilla.org/en-US/docs/Web/API/Element|Dom Element}
   *
   * @public
   */ toDOM(_document = document, hooks = {}, binding) {
        const fragment = _document.createDocumentFragment();
        if (binding !== undefined) binding._createAssociation(fragment, this);
        $42aaa4fd3d01b4df$var$typeListForEach(this, (xmlType)=>{
            fragment.insertBefore(xmlType.toDOM(_document, hooks, binding), null);
        });
        return fragment;
    }
    /**
   * Inserts new content at an index.
   *
   * @example
   *  // Insert character 'a' at position 0
   *  xml.insert(0, [new Y.XmlText('text')])
   *
   * @param {number} index The index to insert content at
   * @param {Array<YXmlElement|YXmlText>} content The array of content
   */ insert(index, content) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeListInsertGenerics(transaction, this, index, content);
        });
        else // @ts-ignore _prelimContent is defined because this is not yet integrated
        this._prelimContent.splice(index, 0, ...content);
    }
    /**
   * Inserts new content at an index.
   *
   * @example
   *  // Insert character 'a' at position 0
   *  xml.insert(0, [new Y.XmlText('text')])
   *
   * @param {null|Item|YXmlElement|YXmlText} ref The index to insert content at
   * @param {Array<YXmlElement|YXmlText>} content The array of content
   */ insertAfter(ref, content) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            const refItem = ref && ref instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? ref._item : ref;
            $42aaa4fd3d01b4df$var$typeListInsertGenericsAfter(transaction, this, refItem, content);
        });
        else {
            const pc = /** @type {Array<any>} */ this._prelimContent;
            const index = ref === null ? 0 : pc.findIndex((el)=>el === ref) + 1;
            if (index === 0 && ref !== null) throw $20dad2a1f8b7bbe7$export$185802fd694ee1f5('Reference item not found');
            pc.splice(index, 0, ...content);
        }
    }
    /**
   * Deletes elements starting from an index.
   *
   * @param {number} index Index at which to start deleting elements
   * @param {number} [length=1] The number of elements to remove. Defaults to 1.
   */ delete(index, length = 1) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeListDelete(transaction, this, index, length);
        });
        else // @ts-ignore _prelimContent is defined because this is not yet integrated
        this._prelimContent.splice(index, length);
    }
    /**
   * Transforms this YArray to a JavaScript Array.
   *
   * @return {Array<YXmlElement|YXmlText|YXmlHook>}
   */ toArray() {
        return $42aaa4fd3d01b4df$var$typeListToArray(this);
    }
    /**
   * Appends content to this YArray.
   *
   * @param {Array<YXmlElement|YXmlText>} content Array of content to append.
   */ push(content) {
        this.insert(this.length, content);
    }
    /**
   * Prepends content to this YArray.
   *
   * @param {Array<YXmlElement|YXmlText>} content Array of content to prepend.
   */ unshift(content) {
        this.insert(0, content);
    }
    /**
   * Returns the i-th element from a YArray.
   *
   * @param {number} index The index of the element to return from the YArray
   * @return {YXmlElement|YXmlText}
   */ get(index) {
        return $42aaa4fd3d01b4df$var$typeListGet(this, index);
    }
    /**
   * Returns a portion of this YXmlFragment into a JavaScript Array selected
   * from start to end (end not included).
   *
   * @param {number} [start]
   * @param {number} [end]
   * @return {Array<YXmlElement|YXmlText>}
   */ slice(start = 0, end = this.length) {
        return $42aaa4fd3d01b4df$var$typeListSlice(this, start, end);
    }
    /**
   * Executes a provided function on once on every child element.
   *
   * @param {function(YXmlElement|YXmlText,number, typeof self):void} f A function to execute on every element of this YArray.
   */ forEach(f) {
        $42aaa4fd3d01b4df$var$typeListForEach(this, f);
    }
    /**
   * Transform the properties of this type to binary and write it to an
   * BinaryEncoder.
   *
   * This is called when this Item is sent to a remote peer.
   *
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder The encoder to write data to.
   */ _write(encoder) {
        encoder.writeTypeRef($42aaa4fd3d01b4df$var$YXmlFragmentRefID);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} _decoder
 * @return {YXmlFragment}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readYXmlFragment = (_decoder)=>new $42aaa4fd3d01b4df$export$d5ce8c3e1731f1a7();
/**
 * @typedef {Object|number|null|Array<any>|string|Uint8Array|AbstractType<any>} ValueTypes
 */ /**
 * An YXmlElement imitates the behavior of a
 * https://developer.mozilla.org/en-US/docs/Web/API/Element|Dom Element
 *
 * * An YXmlElement has attributes (key value pairs)
 * * An YXmlElement has childElements that must inherit from YXmlElement
 *
 * @template {{ [key: string]: ValueTypes }} [KV={ [key: string]: string }]
 */ class $42aaa4fd3d01b4df$export$4db87581d3ca170d extends $42aaa4fd3d01b4df$export$d5ce8c3e1731f1a7 {
    constructor(nodeName = 'UNDEFINED'){
        super();
        this.nodeName = nodeName;
        /**
     * @type {Map<string, any>|null}
     */ this._prelimAttrs = new Map();
    }
    /**
   * @type {YXmlElement|YXmlText|null}
   */ get nextSibling() {
        const n = this._item ? this._item.next : null;
        return n ? /** @type {YXmlElement|YXmlText} */ /** @type {ContentType} */ n.content.type : null;
    }
    /**
   * @type {YXmlElement|YXmlText|null}
   */ get prevSibling() {
        const n = this._item ? this._item.prev : null;
        return n ? /** @type {YXmlElement|YXmlText} */ /** @type {ContentType} */ n.content.type : null;
    }
    /**
   * Integrate this type into the Yjs instance.
   *
   * * Save this struct in the os
   * * This type is sent to other client
   * * Observer functions are fired
   *
   * @param {Doc} y The Yjs instance
   * @param {Item} item
   */ _integrate(y, item) {
        super._integrate(y, item);
        /** @type {Map<string, any>} */ this._prelimAttrs.forEach((value, key)=>{
            this.setAttribute(key, value);
        });
        this._prelimAttrs = null;
    }
    /**
   * Creates an Item with the same effect as this Item (without position effect)
   *
   * @return {YXmlElement}
   */ _copy() {
        return new $42aaa4fd3d01b4df$export$4db87581d3ca170d(this.nodeName);
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {YXmlElement<KV>}
   */ clone() {
        /**
     * @type {YXmlElement<KV>}
     */ const el = new $42aaa4fd3d01b4df$export$4db87581d3ca170d(this.nodeName);
        const attrs = this.getAttributes();
        $a87a3720cf570984$export$4b80e395e36b5a56(attrs, (value, key)=>{
            if (typeof value === 'string') el.setAttribute(key, value);
        });
        // @ts-ignore
        el.insert(0, this.toArray().map((item)=>item instanceof $42aaa4fd3d01b4df$export$c265dc8338484497 ? item.clone() : item));
        return el;
    }
    /**
   * Returns the XML serialization of this YXmlElement.
   * The attributes are ordered by attribute-name, so you can easily use this
   * method to compare YXmlElements
   *
   * @return {string} The string representation of this type.
   *
   * @public
   */ toString() {
        const attrs = this.getAttributes();
        const stringBuilder = [];
        const keys = [];
        for(const key in attrs)keys.push(key);
        keys.sort();
        const keysLen = keys.length;
        for(let i = 0; i < keysLen; i++){
            const key = keys[i];
            stringBuilder.push(key + '="' + attrs[key] + '"');
        }
        const nodeName = this.nodeName.toLocaleLowerCase();
        const attrsString = stringBuilder.length > 0 ? ' ' + stringBuilder.join(' ') : '';
        return `<${nodeName}${attrsString}>${super.toString()}</${nodeName}>`;
    }
    /**
   * Removes an attribute from this YXmlElement.
   *
   * @param {string} attributeName The attribute name that is to be removed.
   *
   * @public
   */ removeAttribute(attributeName) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeMapDelete(transaction, this, attributeName);
        });
        else /** @type {Map<string,any>} */ this._prelimAttrs.delete(attributeName);
    }
    /**
   * Sets or updates an attribute.
   *
   * @template {keyof KV & string} KEY
   *
   * @param {KEY} attributeName The attribute name that is to be set.
   * @param {KV[KEY]} attributeValue The attribute value that is to be set.
   *
   * @public
   */ setAttribute(attributeName, attributeValue) {
        if (this.doc !== null) $42aaa4fd3d01b4df$export$dac1bad6146b2469(this.doc, (transaction)=>{
            $42aaa4fd3d01b4df$var$typeMapSet(transaction, this, attributeName, attributeValue);
        });
        else /** @type {Map<string, any>} */ this._prelimAttrs.set(attributeName, attributeValue);
    }
    /**
   * Returns an attribute value that belongs to the attribute name.
   *
   * @template {keyof KV & string} KEY
   *
   * @param {KEY} attributeName The attribute name that identifies the
   *                               queried value.
   * @return {KV[KEY]|undefined} The queried attribute value.
   *
   * @public
   */ getAttribute(attributeName) {
        return /** @type {any} */ $42aaa4fd3d01b4df$var$typeMapGet(this, attributeName);
    }
    /**
   * Returns whether an attribute exists
   *
   * @param {string} attributeName The attribute name to check for existence.
   * @return {boolean} whether the attribute exists.
   *
   * @public
   */ hasAttribute(attributeName) {
        return /** @type {any} */ $42aaa4fd3d01b4df$var$typeMapHas(this, attributeName);
    }
    /**
   * Returns all attribute name/value pairs in a JSON Object.
   *
   * @param {Snapshot} [snapshot]
   * @return {{ [Key in Extract<keyof KV,string>]?: KV[Key]}} A JSON Object that describes the attributes.
   *
   * @public
   */ getAttributes(snapshot) {
        return /** @type {any} */ snapshot ? $42aaa4fd3d01b4df$export$7769bdedaef2c91b(this, snapshot) : $42aaa4fd3d01b4df$var$typeMapGetAll(this);
    }
    /**
   * Creates a Dom Element that mirrors this YXmlElement.
   *
   * @param {Document} [_document=document] The document object (you must define
   *                                        this when calling this method in
   *                                        nodejs)
   * @param {Object<string, any>} [hooks={}] Optional property to customize how hooks
   *                                             are presented in the DOM
   * @param {any} [binding] You should not set this property. This is
   *                               used if DomBinding wants to create a
   *                               association to the created DOM type.
   * @return {Node} The {@link https://developer.mozilla.org/en-US/docs/Web/API/Element|Dom Element}
   *
   * @public
   */ toDOM(_document = document, hooks = {}, binding) {
        const dom = _document.createElement(this.nodeName);
        const attrs = this.getAttributes();
        for(const key in attrs){
            const value = attrs[key];
            if (typeof value === 'string') dom.setAttribute(key, value);
        }
        $42aaa4fd3d01b4df$var$typeListForEach(this, (yxml)=>{
            dom.appendChild(yxml.toDOM(_document, hooks, binding));
        });
        if (binding !== undefined) binding._createAssociation(dom, this);
        return dom;
    }
    /**
   * Transform the properties of this type to binary and write it to an
   * BinaryEncoder.
   *
   * This is called when this Item is sent to a remote peer.
   *
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder The encoder to write data to.
   */ _write(encoder) {
        encoder.writeTypeRef($42aaa4fd3d01b4df$var$YXmlElementRefID);
        encoder.writeKey(this.nodeName);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {YXmlElement}
 *
 * @function
 */ const $42aaa4fd3d01b4df$var$readYXmlElement = (decoder)=>new $42aaa4fd3d01b4df$export$4db87581d3ca170d(decoder.readKey());
/**
 * @extends YEvent<YXmlElement|YXmlText|YXmlFragment>
 * An Event that describes changes on a YXml Element or Yxml Fragment
 */ class $42aaa4fd3d01b4df$export$88c9145a0c3b556c extends $42aaa4fd3d01b4df$export$80fac438977fb51c {
    /**
   * @param {YXmlElement|YXmlText|YXmlFragment} target The target on which the event is created.
   * @param {Set<string|null>} subs The set of changed attributes. `null` is included if the
   *                   child list changed.
   * @param {Transaction} transaction The transaction instance with wich the
   *                                  change was created.
   */ constructor(target, subs, transaction){
        super(target, transaction);
        /**
     * Whether the children changed.
     * @type {Boolean}
     * @private
     */ this.childListChanged = false;
        /**
     * Set of all changed attributes.
     * @type {Set<string>}
     */ this.attributesChanged = new Set();
        subs.forEach((sub)=>{
            if (sub === null) this.childListChanged = true;
            else this.attributesChanged.add(sub);
        });
    }
}
/**
 * You can manage binding to a custom type with YXmlHook.
 *
 * @extends {YMap<any>}
 */ class $42aaa4fd3d01b4df$export$ec64c1dd5e7a264 extends $42aaa4fd3d01b4df$export$a5c7b93649eaf8f8 {
    /**
   * @param {string} hookName nodeName of the Dom Node.
   */ constructor(hookName){
        super();
        /**
     * @type {string}
     */ this.hookName = hookName;
    }
    /**
   * Creates an Item with the same effect as this Item (without position effect)
   */ _copy() {
        return new $42aaa4fd3d01b4df$export$ec64c1dd5e7a264(this.hookName);
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {YXmlHook}
   */ clone() {
        const el = new $42aaa4fd3d01b4df$export$ec64c1dd5e7a264(this.hookName);
        this.forEach((value, key)=>{
            el.set(key, value);
        });
        return el;
    }
    /**
   * Creates a Dom Element that mirrors this YXmlElement.
   *
   * @param {Document} [_document=document] The document object (you must define
   *                                        this when calling this method in
   *                                        nodejs)
   * @param {Object.<string, any>} [hooks] Optional property to customize how hooks
   *                                             are presented in the DOM
   * @param {any} [binding] You should not set this property. This is
   *                               used if DomBinding wants to create a
   *                               association to the created DOM type
   * @return {Element} The {@link https://developer.mozilla.org/en-US/docs/Web/API/Element|Dom Element}
   *
   * @public
   */ toDOM(_document = document, hooks = {}, binding) {
        const hook = hooks[this.hookName];
        let dom;
        if (hook !== undefined) dom = hook.createDom(this);
        else dom = document.createElement(this.hookName);
        dom.setAttribute('data-yjs-hook', this.hookName);
        if (binding !== undefined) binding._createAssociation(dom, this);
        return dom;
    }
    /**
   * Transform the properties of this type to binary and write it to an
   * BinaryEncoder.
   *
   * This is called when this Item is sent to a remote peer.
   *
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder The encoder to write data to.
   */ _write(encoder) {
        encoder.writeTypeRef($42aaa4fd3d01b4df$var$YXmlHookRefID);
        encoder.writeKey(this.hookName);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {YXmlHook}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readYXmlHook = (decoder)=>new $42aaa4fd3d01b4df$export$ec64c1dd5e7a264(decoder.readKey());
/**
 * Represents text in a Dom Element. In the future this type will also handle
 * simple formatting information like bold and italic.
 */ class $42aaa4fd3d01b4df$export$b35b8f45887823df extends $42aaa4fd3d01b4df$export$5f1af8db9871e1d6 {
    /**
   * @type {YXmlElement|YXmlText|null}
   */ get nextSibling() {
        const n = this._item ? this._item.next : null;
        return n ? /** @type {YXmlElement|YXmlText} */ /** @type {ContentType} */ n.content.type : null;
    }
    /**
   * @type {YXmlElement|YXmlText|null}
   */ get prevSibling() {
        const n = this._item ? this._item.prev : null;
        return n ? /** @type {YXmlElement|YXmlText} */ /** @type {ContentType} */ n.content.type : null;
    }
    _copy() {
        return new $42aaa4fd3d01b4df$export$b35b8f45887823df();
    }
    /**
   * Makes a copy of this data type that can be included somewhere else.
   *
   * Note that the content is only readable _after_ it has been included somewhere in the Ydoc.
   *
   * @return {YXmlText}
   */ clone() {
        const text = new $42aaa4fd3d01b4df$export$b35b8f45887823df();
        text.applyDelta(this.toDelta());
        return text;
    }
    /**
   * Creates a Dom Element that mirrors this YXmlText.
   *
   * @param {Document} [_document=document] The document object (you must define
   *                                        this when calling this method in
   *                                        nodejs)
   * @param {Object<string, any>} [hooks] Optional property to customize how hooks
   *                                             are presented in the DOM
   * @param {any} [binding] You should not set this property. This is
   *                               used if DomBinding wants to create a
   *                               association to the created DOM type.
   * @return {Text} The {@link https://developer.mozilla.org/en-US/docs/Web/API/Element|Dom Element}
   *
   * @public
   */ toDOM(_document = document, hooks, binding) {
        const dom = _document.createTextNode(this.toString());
        if (binding !== undefined) binding._createAssociation(dom, this);
        return dom;
    }
    toString() {
        // @ts-ignore
        return this.toDelta().map((delta)=>{
            const nestedNodes = [];
            for(const nodeName in delta.attributes){
                const attrs = [];
                for(const key in delta.attributes[nodeName])attrs.push({
                    key: key,
                    value: delta.attributes[nodeName][key]
                });
                // sort attributes to get a unique order
                attrs.sort((a, b)=>a.key < b.key ? -1 : 1);
                nestedNodes.push({
                    nodeName: nodeName,
                    attrs: attrs
                });
            }
            // sort node order to get a unique order
            nestedNodes.sort((a, b)=>a.nodeName < b.nodeName ? -1 : 1);
            // now convert to dom string
            let str = '';
            for(let i = 0; i < nestedNodes.length; i++){
                const node = nestedNodes[i];
                str += `<${node.nodeName}`;
                for(let j = 0; j < node.attrs.length; j++){
                    const attr = node.attrs[j];
                    str += ` ${attr.key}="${attr.value}"`;
                }
                str += '>';
            }
            str += delta.insert;
            for(let i = nestedNodes.length - 1; i >= 0; i--)str += `</${nestedNodes[i].nodeName}>`;
            return str;
        }).join('');
    }
    /**
   * @return {string}
   */ toJSON() {
        return this.toString();
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   */ _write(encoder) {
        encoder.writeTypeRef($42aaa4fd3d01b4df$var$YXmlTextRefID);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {YXmlText}
 *
 * @private
 * @function
 */ const $42aaa4fd3d01b4df$var$readYXmlText = (decoder)=>new $42aaa4fd3d01b4df$export$b35b8f45887823df();
class $42aaa4fd3d01b4df$export$3cf6f9765c5c3196 {
    /**
   * @param {ID} id
   * @param {number} length
   */ constructor(id, length){
        this.id = id;
        this.length = length;
    }
    /**
   * @type {boolean}
   */ get deleted() {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * Merge this struct with the item to the right.
   * This method is already assuming that `this.id.clock + this.length === this.id.clock`.
   * Also this method does *not* remove right from StructStore!
   * @param {AbstractStruct} right
   * @return {boolean} wether this merged with right
   */ mergeWith(right) {
        return false;
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder The encoder to write data to.
   * @param {number} offset
   * @param {number} encodingRef
   */ write(encoder, offset, encodingRef) {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * @param {Transaction} transaction
   * @param {number} offset
   */ integrate(transaction, offset) {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
}
const $42aaa4fd3d01b4df$var$structGCRefNumber = 0;
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$12d259ff017e6b58 extends $42aaa4fd3d01b4df$export$3cf6f9765c5c3196 {
    get deleted() {
        return true;
    }
    delete() {}
    /**
   * @param {GC} right
   * @return {boolean}
   */ mergeWith(right) {
        if (this.constructor !== right.constructor) return false;
        this.length += right.length;
        return true;
    }
    /**
   * @param {Transaction} transaction
   * @param {number} offset
   */ integrate(transaction, offset) {
        if (offset > 0) {
            this.id.clock += offset;
            this.length -= offset;
        }
        $42aaa4fd3d01b4df$var$addStruct(transaction.doc.store, this);
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeInfo($42aaa4fd3d01b4df$var$structGCRefNumber);
        encoder.writeLen(this.length - offset);
    }
    /**
   * @param {Transaction} transaction
   * @param {StructStore} store
   * @return {null | number}
   */ getMissing(transaction, store) {
        return null;
    }
}
class $42aaa4fd3d01b4df$export$e8d530cdf62d1cbd {
    /**
   * @param {Uint8Array} content
   */ constructor(content){
        this.content = content;
    }
    /**
   * @return {number}
   */ getLength() {
        return 1;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return [
            this.content
        ];
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return true;
    }
    /**
   * @return {ContentBinary}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$e8d530cdf62d1cbd(this.content);
    }
    /**
   * @param {number} offset
   * @return {ContentBinary}
   */ splice(offset) {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * @param {ContentBinary} right
   * @return {boolean}
   */ mergeWith(right) {
        return false;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {}
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {}
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeBuf(this.content);
    }
    /**
   * @return {number}
   */ getRef() {
        return 3;
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2 } decoder
 * @return {ContentBinary}
 */ const $42aaa4fd3d01b4df$var$readContentBinary = (decoder)=>new $42aaa4fd3d01b4df$export$e8d530cdf62d1cbd(decoder.readBuf());
class $42aaa4fd3d01b4df$export$3b06e0b3a2ece602 {
    /**
   * @param {number} len
   */ constructor(len){
        this.len = len;
    }
    /**
   * @return {number}
   */ getLength() {
        return this.len;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return [];
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return false;
    }
    /**
   * @return {ContentDeleted}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$3b06e0b3a2ece602(this.len);
    }
    /**
   * @param {number} offset
   * @return {ContentDeleted}
   */ splice(offset) {
        const right = new $42aaa4fd3d01b4df$export$3b06e0b3a2ece602(this.len - offset);
        this.len = offset;
        return right;
    }
    /**
   * @param {ContentDeleted} right
   * @return {boolean}
   */ mergeWith(right) {
        this.len += right.len;
        return true;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {
        $42aaa4fd3d01b4df$var$addToDeleteSet(transaction.deleteSet, item.id.client, item.id.clock, this.len);
        item.markDeleted();
    }
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {}
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeLen(this.len - offset);
    }
    /**
   * @return {number}
   */ getRef() {
        return 1;
    }
}
/**
 * @private
 *
 * @param {UpdateDecoderV1 | UpdateDecoderV2 } decoder
 * @return {ContentDeleted}
 */ const $42aaa4fd3d01b4df$var$readContentDeleted = (decoder)=>new $42aaa4fd3d01b4df$export$3b06e0b3a2ece602(decoder.readLen());
/**
 * @param {string} guid
 * @param {Object<string, any>} opts
 */ const $42aaa4fd3d01b4df$var$createDocFromOpts = (guid, opts)=>new $42aaa4fd3d01b4df$export$bceacc74c2212615({
        guid: guid,
        ...opts,
        shouldLoad: opts.shouldLoad || opts.autoLoad || false
    });
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$b564c0e69572c0e {
    /**
   * @param {Doc} doc
   */ constructor(doc){
        if (doc._item) console.error('This document was already integrated as a sub-document. You should create a second instance instead with the same guid.');
        /**
     * @type {Doc}
     */ this.doc = doc;
        /**
     * @type {any}
     */ const opts = {};
        this.opts = opts;
        if (!doc.gc) opts.gc = false;
        if (doc.autoLoad) opts.autoLoad = true;
        if (doc.meta !== null) opts.meta = doc.meta;
    }
    /**
   * @return {number}
   */ getLength() {
        return 1;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return [
            this.doc
        ];
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return true;
    }
    /**
   * @return {ContentDoc}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$b564c0e69572c0e($42aaa4fd3d01b4df$var$createDocFromOpts(this.doc.guid, this.opts));
    }
    /**
   * @param {number} offset
   * @return {ContentDoc}
   */ splice(offset) {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * @param {ContentDoc} right
   * @return {boolean}
   */ mergeWith(right) {
        return false;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {
        // this needs to be reflected in doc.destroy as well
        this.doc._item = item;
        transaction.subdocsAdded.add(this.doc);
        if (this.doc.shouldLoad) transaction.subdocsLoaded.add(this.doc);
    }
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {
        if (transaction.subdocsAdded.has(this.doc)) transaction.subdocsAdded.delete(this.doc);
        else transaction.subdocsRemoved.add(this.doc);
    }
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeString(this.doc.guid);
        encoder.writeAny(this.opts);
    }
    /**
   * @return {number}
   */ getRef() {
        return 9;
    }
}
/**
 * @private
 *
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {ContentDoc}
 */ const $42aaa4fd3d01b4df$var$readContentDoc = (decoder)=>new $42aaa4fd3d01b4df$export$b564c0e69572c0e($42aaa4fd3d01b4df$var$createDocFromOpts(decoder.readString(), decoder.readAny()));
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$c3787ba7f6086664 {
    /**
   * @param {Object} embed
   */ constructor(embed){
        this.embed = embed;
    }
    /**
   * @return {number}
   */ getLength() {
        return 1;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return [
            this.embed
        ];
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return true;
    }
    /**
   * @return {ContentEmbed}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$c3787ba7f6086664(this.embed);
    }
    /**
   * @param {number} offset
   * @return {ContentEmbed}
   */ splice(offset) {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * @param {ContentEmbed} right
   * @return {boolean}
   */ mergeWith(right) {
        return false;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {}
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {}
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeJSON(this.embed);
    }
    /**
   * @return {number}
   */ getRef() {
        return 5;
    }
}
/**
 * @private
 *
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {ContentEmbed}
 */ const $42aaa4fd3d01b4df$var$readContentEmbed = (decoder)=>new $42aaa4fd3d01b4df$export$c3787ba7f6086664(decoder.readJSON());
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$3194899188fb5a88 {
    /**
   * @param {string} key
   * @param {Object} value
   */ constructor(key, value){
        this.key = key;
        this.value = value;
    }
    /**
   * @return {number}
   */ getLength() {
        return 1;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return [];
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return false;
    }
    /**
   * @return {ContentFormat}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$3194899188fb5a88(this.key, this.value);
    }
    /**
   * @param {number} _offset
   * @return {ContentFormat}
   */ splice(_offset) {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * @param {ContentFormat} _right
   * @return {boolean}
   */ mergeWith(_right) {
        return false;
    }
    /**
   * @param {Transaction} _transaction
   * @param {Item} item
   */ integrate(_transaction, item) {
        // @todo searchmarker are currently unsupported for rich text documents
        const p = /** @type {YText} */ item.parent;
        p._searchMarker = null;
        p._hasFormatting = true;
    }
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {}
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeKey(this.key);
        encoder.writeJSON(this.value);
    }
    /**
   * @return {number}
   */ getRef() {
        return 6;
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {ContentFormat}
 */ const $42aaa4fd3d01b4df$var$readContentFormat = (decoder)=>new $42aaa4fd3d01b4df$export$3194899188fb5a88(decoder.readKey(), decoder.readJSON());
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$6a907ea8f733ecf3 {
    /**
   * @param {Array<any>} arr
   */ constructor(arr){
        /**
     * @type {Array<any>}
     */ this.arr = arr;
    }
    /**
   * @return {number}
   */ getLength() {
        return this.arr.length;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return this.arr;
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return true;
    }
    /**
   * @return {ContentJSON}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$6a907ea8f733ecf3(this.arr);
    }
    /**
   * @param {number} offset
   * @return {ContentJSON}
   */ splice(offset) {
        const right = new $42aaa4fd3d01b4df$export$6a907ea8f733ecf3(this.arr.slice(offset));
        this.arr = this.arr.slice(0, offset);
        return right;
    }
    /**
   * @param {ContentJSON} right
   * @return {boolean}
   */ mergeWith(right) {
        this.arr = this.arr.concat(right.arr);
        return true;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {}
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {}
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        const len = this.arr.length;
        encoder.writeLen(len - offset);
        for(let i = offset; i < len; i++){
            const c = this.arr[i];
            encoder.writeString(c === undefined ? 'undefined' : JSON.stringify(c));
        }
    }
    /**
   * @return {number}
   */ getRef() {
        return 2;
    }
}
/**
 * @private
 *
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {ContentJSON}
 */ const $42aaa4fd3d01b4df$var$readContentJSON = (decoder)=>{
    const len = decoder.readLen();
    const cs = [];
    for(let i = 0; i < len; i++){
        const c = decoder.readString();
        if (c === 'undefined') cs.push(undefined);
        else cs.push(JSON.parse(c));
    }
    return new $42aaa4fd3d01b4df$export$6a907ea8f733ecf3(cs);
};
const $42aaa4fd3d01b4df$var$isDevMode = $63eb5f96ace248ce$export$39fb32ac18db3f88('node_env') === 'development';
class $42aaa4fd3d01b4df$export$1d788b93bbb631a0 {
    /**
   * @param {Array<any>} arr
   */ constructor(arr){
        /**
     * @type {Array<any>}
     */ this.arr = arr;
        $42aaa4fd3d01b4df$var$isDevMode && $a87a3720cf570984$export$7e32b29e1cb162e1(arr);
    }
    /**
   * @return {number}
   */ getLength() {
        return this.arr.length;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return this.arr;
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return true;
    }
    /**
   * @return {ContentAny}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$1d788b93bbb631a0(this.arr);
    }
    /**
   * @param {number} offset
   * @return {ContentAny}
   */ splice(offset) {
        const right = new $42aaa4fd3d01b4df$export$1d788b93bbb631a0(this.arr.slice(offset));
        this.arr = this.arr.slice(0, offset);
        return right;
    }
    /**
   * @param {ContentAny} right
   * @return {boolean}
   */ mergeWith(right) {
        this.arr = this.arr.concat(right.arr);
        return true;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {}
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {}
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        const len = this.arr.length;
        encoder.writeLen(len - offset);
        for(let i = offset; i < len; i++){
            const c = this.arr[i];
            encoder.writeAny(c);
        }
    }
    /**
   * @return {number}
   */ getRef() {
        return 8;
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {ContentAny}
 */ const $42aaa4fd3d01b4df$var$readContentAny = (decoder)=>{
    const len = decoder.readLen();
    const cs = [];
    for(let i = 0; i < len; i++)cs.push(decoder.readAny());
    return new $42aaa4fd3d01b4df$export$1d788b93bbb631a0(cs);
};
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$ee670b2cf091bbb6 {
    /**
   * @param {string} str
   */ constructor(str){
        /**
     * @type {string}
     */ this.str = str;
    }
    /**
   * @return {number}
   */ getLength() {
        return this.str.length;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return this.str.split('');
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return true;
    }
    /**
   * @return {ContentString}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$ee670b2cf091bbb6(this.str);
    }
    /**
   * @param {number} offset
   * @return {ContentString}
   */ splice(offset) {
        const right = new $42aaa4fd3d01b4df$export$ee670b2cf091bbb6(this.str.slice(offset));
        this.str = this.str.slice(0, offset);
        // Prevent encoding invalid documents because of splitting of surrogate pairs: https://github.com/yjs/yjs/issues/248
        const firstCharCode = this.str.charCodeAt(offset - 1);
        if (firstCharCode >= 0xD800 && firstCharCode <= 0xDBFF) {
            // Last character of the left split is the start of a surrogate utf16/ucs2 pair.
            // We don't support splitting of surrogate pairs because this may lead to invalid documents.
            // Replace the invalid character with a unicode replacement character (� / U+FFFD)
            this.str = this.str.slice(0, offset - 1) + "\uFFFD";
            // replace right as well
            right.str = "\uFFFD" + right.str.slice(1);
        }
        return right;
    }
    /**
   * @param {ContentString} right
   * @return {boolean}
   */ mergeWith(right) {
        this.str += right.str;
        return true;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {}
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {}
    /**
   * @param {StructStore} store
   */ gc(store) {}
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeString(offset === 0 ? this.str : this.str.slice(offset));
    }
    /**
   * @return {number}
   */ getRef() {
        return 4;
    }
}
/**
 * @private
 *
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {ContentString}
 */ const $42aaa4fd3d01b4df$var$readContentString = (decoder)=>new $42aaa4fd3d01b4df$export$ee670b2cf091bbb6(decoder.readString());
/**
 * @type {Array<function(UpdateDecoderV1 | UpdateDecoderV2):AbstractType<any>>}
 * @private
 */ const $42aaa4fd3d01b4df$var$typeRefs = [
    $42aaa4fd3d01b4df$var$readYArray,
    $42aaa4fd3d01b4df$var$readYMap,
    $42aaa4fd3d01b4df$var$readYText,
    $42aaa4fd3d01b4df$var$readYXmlElement,
    $42aaa4fd3d01b4df$var$readYXmlFragment,
    $42aaa4fd3d01b4df$var$readYXmlHook,
    $42aaa4fd3d01b4df$var$readYXmlText
];
const $42aaa4fd3d01b4df$var$YArrayRefID = 0;
const $42aaa4fd3d01b4df$var$YMapRefID = 1;
const $42aaa4fd3d01b4df$var$YTextRefID = 2;
const $42aaa4fd3d01b4df$var$YXmlElementRefID = 3;
const $42aaa4fd3d01b4df$var$YXmlFragmentRefID = 4;
const $42aaa4fd3d01b4df$var$YXmlHookRefID = 5;
const $42aaa4fd3d01b4df$var$YXmlTextRefID = 6;
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$e2e108cbe2e4f865 {
    /**
   * @param {AbstractType<any>} type
   */ constructor(type){
        /**
     * @type {AbstractType<any>}
     */ this.type = type;
    }
    /**
   * @return {number}
   */ getLength() {
        return 1;
    }
    /**
   * @return {Array<any>}
   */ getContent() {
        return [
            this.type
        ];
    }
    /**
   * @return {boolean}
   */ isCountable() {
        return true;
    }
    /**
   * @return {ContentType}
   */ copy() {
        return new $42aaa4fd3d01b4df$export$e2e108cbe2e4f865(this.type._copy());
    }
    /**
   * @param {number} offset
   * @return {ContentType}
   */ splice(offset) {
        throw $20dad2a1f8b7bbe7$export$73ced5c7e10d6d0f();
    }
    /**
   * @param {ContentType} right
   * @return {boolean}
   */ mergeWith(right) {
        return false;
    }
    /**
   * @param {Transaction} transaction
   * @param {Item} item
   */ integrate(transaction, item) {
        this.type._integrate(transaction.doc, item);
    }
    /**
   * @param {Transaction} transaction
   */ delete(transaction) {
        let item = this.type._start;
        while(item !== null){
            if (!item.deleted) item.delete(transaction);
            else if (item.id.clock < (transaction.beforeState.get(item.id.client) || 0)) // This will be gc'd later and we want to merge it if possible
            // We try to merge all deleted items after each transaction,
            // but we have no knowledge about that this needs to be merged
            // since it is not in transaction.ds. Hence we add it to transaction._mergeStructs
            transaction._mergeStructs.push(item);
            item = item.right;
        }
        this.type._map.forEach((item)=>{
            if (!item.deleted) item.delete(transaction);
            else if (item.id.clock < (transaction.beforeState.get(item.id.client) || 0)) // same as above
            transaction._mergeStructs.push(item);
        });
        transaction.changed.delete(this.type);
    }
    /**
   * @param {StructStore} store
   */ gc(store) {
        let item = this.type._start;
        while(item !== null){
            item.gc(store, true);
            item = item.right;
        }
        this.type._start = null;
        this.type._map.forEach(/** @param {Item | null} item */ (item)=>{
            while(item !== null){
                item.gc(store, true);
                item = item.left;
            }
        });
        this.type._map = new Map();
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        this.type._write(encoder);
    }
    /**
   * @return {number}
   */ getRef() {
        return 7;
    }
}
/**
 * @private
 *
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @return {ContentType}
 */ const $42aaa4fd3d01b4df$var$readContentType = (decoder)=>new $42aaa4fd3d01b4df$export$e2e108cbe2e4f865($42aaa4fd3d01b4df$var$typeRefs[decoder.readTypeRef()](decoder));
/**
 * @todo This should return several items
 *
 * @param {StructStore} store
 * @param {ID} id
 * @return {{item:Item, diff:number}}
 */ const $42aaa4fd3d01b4df$var$followRedone = (store, id)=>{
    /**
   * @type {ID|null}
   */ let nextID = id;
    let diff = 0;
    let item;
    do {
        if (diff > 0) nextID = $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(nextID.client, nextID.clock + diff);
        item = $42aaa4fd3d01b4df$export$f92dfeb71e9bb569(store, nextID);
        diff = nextID.clock - item.id.clock;
        nextID = item.redone;
    }while (nextID !== null && item instanceof $42aaa4fd3d01b4df$export$6d08773d2e66f8f2);
    return {
        item: item,
        diff: diff
    };
};
/**
 * Make sure that neither item nor any of its parents is ever deleted.
 *
 * This property does not persist when storing it into a database or when
 * sending it to other peers
 *
 * @param {Item|null} item
 * @param {boolean} keep
 */ const $42aaa4fd3d01b4df$var$keepItem = (item, keep)=>{
    while(item !== null && item.keep !== keep){
        item.keep = keep;
        item = /** @type {AbstractType<any>} */ item.parent._item;
    }
};
/**
 * Split leftItem into two items
 * @param {Transaction} transaction
 * @param {Item} leftItem
 * @param {number} diff
 * @return {Item}
 *
 * @function
 * @private
 */ const $42aaa4fd3d01b4df$var$splitItem = (transaction, leftItem, diff)=>{
    // create rightItem
    const { client: client, clock: clock } = leftItem.id;
    const rightItem = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2($42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock + diff), leftItem, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(client, clock + diff - 1), leftItem.right, leftItem.rightOrigin, leftItem.parent, leftItem.parentSub, leftItem.content.splice(diff));
    if (leftItem.deleted) rightItem.markDeleted();
    if (leftItem.keep) rightItem.keep = true;
    if (leftItem.redone !== null) rightItem.redone = $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(leftItem.redone.client, leftItem.redone.clock + diff);
    // update left (do not set leftItem.rightOrigin as it will lead to problems when syncing)
    leftItem.right = rightItem;
    // update right
    if (rightItem.right !== null) rightItem.right.left = rightItem;
    // right is more specific.
    transaction._mergeStructs.push(rightItem);
    // update parent._map
    if (rightItem.parentSub !== null && rightItem.right === null) /** @type {AbstractType<any>} */ rightItem.parent._map.set(rightItem.parentSub, rightItem);
    leftItem.length = diff;
    return rightItem;
};
/**
 * @param {Array<StackItem>} stack
 * @param {ID} id
 */ const $42aaa4fd3d01b4df$var$isDeletedByUndoStack = (stack, id)=>$cfaabc628d0f476d$export$ad14ef4001db2bcd(stack, /** @param {StackItem} s */ (s)=>$42aaa4fd3d01b4df$export$dcb04af092e44fde(s.deletions, id));
/**
 * Redoes the effect of this operation.
 *
 * @param {Transaction} transaction The Yjs instance.
 * @param {Item} item
 * @param {Set<Item>} redoitems
 * @param {DeleteSet} itemsToDelete
 * @param {boolean} ignoreRemoteMapChanges
 * @param {import('../utils/UndoManager.js').UndoManager} um
 *
 * @return {Item|null}
 *
 * @private
 */ const $42aaa4fd3d01b4df$var$redoItem = (transaction, item, redoitems, itemsToDelete, ignoreRemoteMapChanges, um)=>{
    const doc = transaction.doc;
    const store = doc.store;
    const ownClientID = doc.clientID;
    const redone = item.redone;
    if (redone !== null) return $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, redone);
    let parentItem = /** @type {AbstractType<any>} */ item.parent._item;
    /**
   * @type {Item|null}
   */ let left = null;
    /**
   * @type {Item|null}
   */ let right;
    // make sure that parent is redone
    if (parentItem !== null && parentItem.deleted === true) {
        // try to undo parent if it will be undone anyway
        if (parentItem.redone === null && (!redoitems.has(parentItem) || $42aaa4fd3d01b4df$var$redoItem(transaction, parentItem, redoitems, itemsToDelete, ignoreRemoteMapChanges, um) === null)) return null;
        while(parentItem.redone !== null)parentItem = $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, parentItem.redone);
    }
    const parentType = parentItem === null ? /** @type {AbstractType<any>} */ item.parent : /** @type {ContentType} */ parentItem.content.type;
    if (item.parentSub === null) {
        // Is an array item. Insert at the old position
        left = item.left;
        right = item;
        // find next cloned_redo items
        while(left !== null){
            /**
       * @type {Item|null}
       */ let leftTrace = left;
            // trace redone until parent matches
            while(leftTrace !== null && /** @type {AbstractType<any>} */ leftTrace.parent._item !== parentItem)leftTrace = leftTrace.redone === null ? null : $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, leftTrace.redone);
            if (leftTrace !== null && /** @type {AbstractType<any>} */ leftTrace.parent._item === parentItem) {
                left = leftTrace;
                break;
            }
            left = left.left;
        }
        while(right !== null){
            /**
       * @type {Item|null}
       */ let rightTrace = right;
            // trace redone until parent matches
            while(rightTrace !== null && /** @type {AbstractType<any>} */ rightTrace.parent._item !== parentItem)rightTrace = rightTrace.redone === null ? null : $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, rightTrace.redone);
            if (rightTrace !== null && /** @type {AbstractType<any>} */ rightTrace.parent._item === parentItem) {
                right = rightTrace;
                break;
            }
            right = right.right;
        }
    } else {
        right = null;
        if (item.right && !ignoreRemoteMapChanges) {
            left = item;
            // Iterate right while right is in itemsToDelete
            // If it is intended to delete right while item is redone, we can expect that item should replace right.
            while(left !== null && left.right !== null && (left.right.redone || $42aaa4fd3d01b4df$export$dcb04af092e44fde(itemsToDelete, left.right.id) || $42aaa4fd3d01b4df$var$isDeletedByUndoStack(um.undoStack, left.right.id) || $42aaa4fd3d01b4df$var$isDeletedByUndoStack(um.redoStack, left.right.id))){
                left = left.right;
                // follow redone
                while(left.redone)left = $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, left.redone);
            }
            if (left && left.right !== null) // It is not possible to redo this item because it conflicts with a
            // change from another client
            return null;
        } else left = parentType._map.get(item.parentSub) || null;
    }
    const nextClock = $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, ownClientID);
    const nextId = $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(ownClientID, nextClock);
    const redoneItem = new $42aaa4fd3d01b4df$export$6d08773d2e66f8f2(nextId, left, left && left.lastId, right, right && right.id, parentType, item.parentSub, item.content.copy());
    item.redone = nextId;
    $42aaa4fd3d01b4df$var$keepItem(redoneItem, true);
    redoneItem.integrate(transaction, 0);
    return redoneItem;
};
/**
 * Abstract class that represents any content.
 */ class $42aaa4fd3d01b4df$export$6d08773d2e66f8f2 extends $42aaa4fd3d01b4df$export$3cf6f9765c5c3196 {
    /**
   * @param {ID} id
   * @param {Item | null} left
   * @param {ID | null} origin
   * @param {Item | null} right
   * @param {ID | null} rightOrigin
   * @param {AbstractType<any>|ID|null} parent Is a type if integrated, is null if it is possible to copy parent from left or right, is ID before integration to search for it.
   * @param {string | null} parentSub
   * @param {AbstractContent} content
   */ constructor(id, left, origin, right, rightOrigin, parent, parentSub, content){
        super(id, content.getLength());
        /**
     * The item that was originally to the left of this item.
     * @type {ID | null}
     */ this.origin = origin;
        /**
     * The item that is currently to the left of this item.
     * @type {Item | null}
     */ this.left = left;
        /**
     * The item that is currently to the right of this item.
     * @type {Item | null}
     */ this.right = right;
        /**
     * The item that was originally to the right of this item.
     * @type {ID | null}
     */ this.rightOrigin = rightOrigin;
        /**
     * @type {AbstractType<any>|ID|null}
     */ this.parent = parent;
        /**
     * If the parent refers to this item with some kind of key (e.g. YMap, the
     * key is specified here. The key is then used to refer to the list in which
     * to insert this item. If `parentSub = null` type._start is the list in
     * which to insert to. Otherwise it is `parent._map`.
     * @type {String | null}
     */ this.parentSub = parentSub;
        /**
     * If this type's effect is redone this type refers to the type that undid
     * this operation.
     * @type {ID | null}
     */ this.redone = null;
        /**
     * @type {AbstractContent}
     */ this.content = content;
        /**
     * bit1: keep
     * bit2: countable
     * bit3: deleted
     * bit4: mark - mark node as fast-search-marker
     * @type {number} byte
     */ this.info = this.content.isCountable() ? $b27b7daa87337538$export$1f117f3b0edc2676 : 0;
    }
    /**
   * This is used to mark the item as an indexed fast-search marker
   *
   * @type {boolean}
   */ set marker(isMarked) {
        if ((this.info & $b27b7daa87337538$export$873ae8db4cef5125) > 0 !== isMarked) this.info ^= $b27b7daa87337538$export$873ae8db4cef5125;
    }
    get marker() {
        return (this.info & $b27b7daa87337538$export$873ae8db4cef5125) > 0;
    }
    /**
   * If true, do not garbage collect this Item.
   */ get keep() {
        return (this.info & $b27b7daa87337538$export$ee2c6657cb286da4) > 0;
    }
    set keep(doKeep) {
        if (this.keep !== doKeep) this.info ^= $b27b7daa87337538$export$ee2c6657cb286da4;
    }
    get countable() {
        return (this.info & $b27b7daa87337538$export$1f117f3b0edc2676) > 0;
    }
    /**
   * Whether this item was deleted or not.
   * @type {Boolean}
   */ get deleted() {
        return (this.info & $b27b7daa87337538$export$e5294f8c78cf7711) > 0;
    }
    set deleted(doDelete) {
        if (this.deleted !== doDelete) this.info ^= $b27b7daa87337538$export$e5294f8c78cf7711;
    }
    markDeleted() {
        this.info |= $b27b7daa87337538$export$e5294f8c78cf7711;
    }
    /**
   * Return the creator clientID of the missing op or define missing items and return null.
   *
   * @param {Transaction} transaction
   * @param {StructStore} store
   * @return {null | number}
   */ getMissing(transaction, store) {
        if (this.origin && this.origin.client !== this.id.client && this.origin.clock >= $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, this.origin.client)) return this.origin.client;
        if (this.rightOrigin && this.rightOrigin.client !== this.id.client && this.rightOrigin.clock >= $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, this.rightOrigin.client)) return this.rightOrigin.client;
        if (this.parent && this.parent.constructor === $42aaa4fd3d01b4df$export$8be180ec26319f9f && this.id.client !== this.parent.client && this.parent.clock >= $42aaa4fd3d01b4df$export$50fdfeece43146fd(store, this.parent.client)) return this.parent.client;
        // We have all missing ids, now find the items
        if (this.origin) {
            this.left = $42aaa4fd3d01b4df$var$getItemCleanEnd(transaction, store, this.origin);
            this.origin = this.left.lastId;
        }
        if (this.rightOrigin) {
            this.right = $42aaa4fd3d01b4df$var$getItemCleanStart(transaction, this.rightOrigin);
            this.rightOrigin = this.right.id;
        }
        if (this.left && this.left.constructor === $42aaa4fd3d01b4df$export$12d259ff017e6b58 || this.right && this.right.constructor === $42aaa4fd3d01b4df$export$12d259ff017e6b58) this.parent = null;
        else if (!this.parent) {
            // only set parent if this shouldn't be garbage collected
            if (this.left && this.left.constructor === $42aaa4fd3d01b4df$export$6d08773d2e66f8f2) {
                this.parent = this.left.parent;
                this.parentSub = this.left.parentSub;
            }
            if (this.right && this.right.constructor === $42aaa4fd3d01b4df$export$6d08773d2e66f8f2) {
                this.parent = this.right.parent;
                this.parentSub = this.right.parentSub;
            }
        } else if (this.parent.constructor === $42aaa4fd3d01b4df$export$8be180ec26319f9f) {
            const parentItem = $42aaa4fd3d01b4df$export$f92dfeb71e9bb569(store, this.parent);
            if (parentItem.constructor === $42aaa4fd3d01b4df$export$12d259ff017e6b58) this.parent = null;
            else this.parent = /** @type {ContentType} */ parentItem.content.type;
        }
        return null;
    }
    /**
   * @param {Transaction} transaction
   * @param {number} offset
   */ integrate(transaction, offset) {
        if (offset > 0) {
            this.id.clock += offset;
            this.left = $42aaa4fd3d01b4df$var$getItemCleanEnd(transaction, transaction.doc.store, $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(this.id.client, this.id.clock - 1));
            this.origin = this.left.lastId;
            this.content = this.content.splice(offset);
            this.length -= offset;
        }
        if (this.parent) {
            if (!this.left && (!this.right || this.right.left !== null) || this.left && this.left.right !== this.right) {
                /**
         * @type {Item|null}
         */ let left = this.left;
                /**
         * @type {Item|null}
         */ let o;
                // set o to the first conflicting item
                if (left !== null) o = left.right;
                else if (this.parentSub !== null) {
                    o = /** @type {AbstractType<any>} */ this.parent._map.get(this.parentSub) || null;
                    while(o !== null && o.left !== null)o = o.left;
                } else o = /** @type {AbstractType<any>} */ this.parent._start;
                // TODO: use something like DeleteSet here (a tree implementation would be best)
                // @todo use global set definitions
                /**
         * @type {Set<Item>}
         */ const conflictingItems = new Set();
                /**
         * @type {Set<Item>}
         */ const itemsBeforeOrigin = new Set();
                // Let c in conflictingItems, b in itemsBeforeOrigin
                // ***{origin}bbbb{this}{c,b}{c,b}{o}***
                // Note that conflictingItems is a subset of itemsBeforeOrigin
                while(o !== null && o !== this.right){
                    itemsBeforeOrigin.add(o);
                    conflictingItems.add(o);
                    if ($42aaa4fd3d01b4df$export$c0af976e7e459c02(this.origin, o.origin)) {
                        // case 1
                        if (o.id.client < this.id.client) {
                            left = o;
                            conflictingItems.clear();
                        } else if ($42aaa4fd3d01b4df$export$c0af976e7e459c02(this.rightOrigin, o.rightOrigin)) break;
                         // else, o might be integrated before an item that this conflicts with. If so, we will find it in the next iterations
                    } else if (o.origin !== null && itemsBeforeOrigin.has($42aaa4fd3d01b4df$export$f92dfeb71e9bb569(transaction.doc.store, o.origin))) // case 2
                    {
                        if (!conflictingItems.has($42aaa4fd3d01b4df$export$f92dfeb71e9bb569(transaction.doc.store, o.origin))) {
                            left = o;
                            conflictingItems.clear();
                        }
                    } else break;
                    o = o.right;
                }
                this.left = left;
            }
            // reconnect left/right + update parent map/start if necessary
            if (this.left !== null) {
                const right = this.left.right;
                this.right = right;
                this.left.right = this;
            } else {
                let r;
                if (this.parentSub !== null) {
                    r = /** @type {AbstractType<any>} */ this.parent._map.get(this.parentSub) || null;
                    while(r !== null && r.left !== null)r = r.left;
                } else {
                    r = /** @type {AbstractType<any>} */ this.parent._start; /** @type {AbstractType<any>} */ 
                    this.parent._start = this;
                }
                this.right = r;
            }
            if (this.right !== null) this.right.left = this;
            else if (this.parentSub !== null) {
                // set as current parent value if right === null and this is parentSub
                /** @type {AbstractType<any>} */ this.parent._map.set(this.parentSub, this);
                if (this.left !== null) // this is the current attribute value of parent. delete right
                this.left.delete(transaction);
            }
            // adjust length of parent
            if (this.parentSub === null && this.countable && !this.deleted) /** @type {AbstractType<any>} */ this.parent._length += this.length;
            $42aaa4fd3d01b4df$var$addStruct(transaction.doc.store, this);
            this.content.integrate(transaction, this);
            // add parent to transaction.changed
            $42aaa4fd3d01b4df$var$addChangedTypeToTransaction(transaction, /** @type {AbstractType<any>} */ this.parent, this.parentSub);
            if (/** @type {AbstractType<any>} */ this.parent._item !== null && /** @type {AbstractType<any>} */ this.parent._item.deleted || this.parentSub !== null && this.right !== null) // delete if parent is deleted or if this is not the current attribute value of parent
            this.delete(transaction);
        } else // parent is not defined. Integrate GC struct instead
        new $42aaa4fd3d01b4df$export$12d259ff017e6b58(this.id, this.length).integrate(transaction, 0);
    }
    /**
   * Returns the next non-deleted item
   */ get next() {
        let n = this.right;
        while(n !== null && n.deleted)n = n.right;
        return n;
    }
    /**
   * Returns the previous non-deleted item
   */ get prev() {
        let n = this.left;
        while(n !== null && n.deleted)n = n.left;
        return n;
    }
    /**
   * Computes the last content address of this Item.
   */ get lastId() {
        // allocating ids is pretty costly because of the amount of ids created, so we try to reuse whenever possible
        return this.length === 1 ? this.id : $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(this.id.client, this.id.clock + this.length - 1);
    }
    /**
   * Try to merge two items
   *
   * @param {Item} right
   * @return {boolean}
   */ mergeWith(right) {
        if (this.constructor === right.constructor && $42aaa4fd3d01b4df$export$c0af976e7e459c02(right.origin, this.lastId) && this.right === right && $42aaa4fd3d01b4df$export$c0af976e7e459c02(this.rightOrigin, right.rightOrigin) && this.id.client === right.id.client && this.id.clock + this.length === right.id.clock && this.deleted === right.deleted && this.redone === null && right.redone === null && this.content.constructor === right.content.constructor && this.content.mergeWith(right.content)) {
            const searchMarker = /** @type {AbstractType<any>} */ this.parent._searchMarker;
            if (searchMarker) searchMarker.forEach((marker)=>{
                if (marker.p === right) {
                    // right is going to be "forgotten" so we need to update the marker
                    marker.p = this;
                    // adjust marker index
                    if (!this.deleted && this.countable) marker.index -= this.length;
                }
            });
            if (right.keep) this.keep = true;
            this.right = right.right;
            if (this.right !== null) this.right.left = this;
            this.length += right.length;
            return true;
        }
        return false;
    }
    /**
   * Mark this Item as deleted.
   *
   * @param {Transaction} transaction
   */ delete(transaction) {
        if (!this.deleted) {
            const parent = /** @type {AbstractType<any>} */ this.parent;
            // adjust the length of parent
            if (this.countable && this.parentSub === null) parent._length -= this.length;
            this.markDeleted();
            $42aaa4fd3d01b4df$var$addToDeleteSet(transaction.deleteSet, this.id.client, this.id.clock, this.length);
            $42aaa4fd3d01b4df$var$addChangedTypeToTransaction(transaction, parent, this.parentSub);
            this.content.delete(transaction);
        }
    }
    /**
   * @param {StructStore} store
   * @param {boolean} parentGCd
   */ gc(store, parentGCd) {
        if (!this.deleted) throw $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
        this.content.gc(store);
        if (parentGCd) $42aaa4fd3d01b4df$var$replaceStruct(store, this, new $42aaa4fd3d01b4df$export$12d259ff017e6b58(this.id, this.length));
        else this.content = new $42aaa4fd3d01b4df$export$3b06e0b3a2ece602(this.length);
    }
    /**
   * Transform the properties of this type to binary and write it to an
   * BinaryEncoder.
   *
   * This is called when this Item is sent to a remote peer.
   *
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder The encoder to write data to.
   * @param {number} offset
   */ write(encoder, offset) {
        const origin = offset > 0 ? $42aaa4fd3d01b4df$export$6c7d4e6171d008d0(this.id.client, this.id.clock + offset - 1) : this.origin;
        const rightOrigin = this.rightOrigin;
        const parentSub = this.parentSub;
        const info = this.content.getRef() & $b27b7daa87337538$export$bc2aba63e4099c09 | (origin === null ? 0 : $b27b7daa87337538$export$e25597372303a045) | // origin is defined
        (rightOrigin === null ? 0 : $b27b7daa87337538$export$eb5a8e0006ab4bb5) | // right origin is defined
        (parentSub === null ? 0 : $b27b7daa87337538$export$daf23f774967089); // parentSub is non-null
        encoder.writeInfo(info);
        if (origin !== null) encoder.writeLeftID(origin);
        if (rightOrigin !== null) encoder.writeRightID(rightOrigin);
        if (origin === null && rightOrigin === null) {
            const parent = /** @type {AbstractType<any>} */ this.parent;
            if (parent._item !== undefined) {
                const parentItem = parent._item;
                if (parentItem === null) {
                    // parent type on y._map
                    // find the correct key
                    const ykey = $42aaa4fd3d01b4df$export$e726a40920d54663(parent);
                    encoder.writeParentInfo(true); // write parentYKey
                    encoder.writeString(ykey);
                } else {
                    encoder.writeParentInfo(false); // write parent id
                    encoder.writeLeftID(parentItem.id);
                }
            } else if (parent.constructor === String) {
                encoder.writeParentInfo(true); // write parentYKey
                encoder.writeString(parent);
            } else if (parent.constructor === $42aaa4fd3d01b4df$export$8be180ec26319f9f) {
                encoder.writeParentInfo(false); // write parent id
                encoder.writeLeftID(parent);
            } else $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
            if (parentSub !== null) encoder.writeString(parentSub);
        }
        this.content.write(encoder, offset);
    }
}
/**
 * @param {UpdateDecoderV1 | UpdateDecoderV2} decoder
 * @param {number} info
 */ const $42aaa4fd3d01b4df$var$readItemContent = (decoder, info)=>$42aaa4fd3d01b4df$var$contentRefs[info & $b27b7daa87337538$export$bc2aba63e4099c09](decoder);
/**
 * A lookup map for reading Item content.
 *
 * @type {Array<function(UpdateDecoderV1 | UpdateDecoderV2):AbstractContent>}
 */ const $42aaa4fd3d01b4df$var$contentRefs = [
    ()=>{
        $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
    },
    $42aaa4fd3d01b4df$var$readContentDeleted,
    $42aaa4fd3d01b4df$var$readContentJSON,
    $42aaa4fd3d01b4df$var$readContentBinary,
    $42aaa4fd3d01b4df$var$readContentString,
    $42aaa4fd3d01b4df$var$readContentEmbed,
    $42aaa4fd3d01b4df$var$readContentFormat,
    $42aaa4fd3d01b4df$var$readContentType,
    $42aaa4fd3d01b4df$var$readContentAny,
    $42aaa4fd3d01b4df$var$readContentDoc,
    ()=>{
        $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
    } // 10 - Skip is not ItemContent
];
const $42aaa4fd3d01b4df$var$structSkipRefNumber = 10;
/**
 * @private
 */ class $42aaa4fd3d01b4df$export$38d24f5c1eb0e4c0 extends $42aaa4fd3d01b4df$export$3cf6f9765c5c3196 {
    get deleted() {
        return true;
    }
    delete() {}
    /**
   * @param {Skip} right
   * @return {boolean}
   */ mergeWith(right) {
        if (this.constructor !== right.constructor) return false;
        this.length += right.length;
        return true;
    }
    /**
   * @param {Transaction} transaction
   * @param {number} offset
   */ integrate(transaction, offset) {
        // skip structs cannot be integrated
        $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
    }
    /**
   * @param {UpdateEncoderV1 | UpdateEncoderV2} encoder
   * @param {number} offset
   */ write(encoder, offset) {
        encoder.writeInfo($42aaa4fd3d01b4df$var$structSkipRefNumber);
        // write as VarUint because Skips can't make use of predictable length-encoding
        $293cd0efd7645786$export$872f48c75febcd2b(encoder.restEncoder, this.length - offset);
    }
    /**
   * @param {Transaction} transaction
   * @param {StructStore} store
   * @return {null | number}
   */ getMissing(transaction, store) {
        return null;
    }
}
/** eslint-env browser */ const $42aaa4fd3d01b4df$var$glo = /** @type {any} */ typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof $parcel$global !== 'undefined' ? $parcel$global : {};
const $42aaa4fd3d01b4df$var$importIdentifier = '__ $YJS$ __';
if ($42aaa4fd3d01b4df$var$glo[$42aaa4fd3d01b4df$var$importIdentifier] === true) /**
   * Dear reader of this message. Please take this seriously.
   *
   * If you see this message, make sure that you only import one version of Yjs. In many cases,
   * your package manager installs two versions of Yjs that are used by different packages within your project.
   * Another reason for this message is that some parts of your project use the commonjs version of Yjs
   * and others use the EcmaScript version of Yjs.
   *
   * This often leads to issues that are hard to debug. We often need to perform constructor checks,
   * e.g. `struct instanceof GC`. If you imported different versions of Yjs, it is impossible for us to
   * do the constructor checks anymore - which might break the CRDT algorithm.
   *
   * https://github.com/yjs/yjs/issues/438
   */ console.error('Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438');
$42aaa4fd3d01b4df$var$glo[$42aaa4fd3d01b4df$var$importIdentifier] = true;



var $leKFq = parcelRequire("leKFq");

/**
 * Mutual exclude for JavaScript.
 *
 * @module mutex
 */ /**
 * @callback mutex
 * @param {function():void} cb Only executed when this mutex is not in the current stack
 * @param {function():void} [elseCb] Executed when this mutex is in the current stack
 */ /**
 * Creates a mutual exclude function with the following property:
 *
 * ```js
 * const mutex = createMutex()
 * mutex(() => {
 *   // This function is immediately executed
 *   mutex(() => {
 *     // This function is not executed, as the mutex is already active.
 *   })
 * })
 * ```
 *
 * @return {mutex} A mutual exclude function
 * @public
 */ const $56701e1431a97545$export$6cca8a222d1193d7 = ()=>{
    let token = true;
    return (f, g)=>{
        if (token) {
            token = false;
            try {
                f();
            } finally{
                token = true;
            }
        } else if (g !== undefined) g();
    };
};


/**
 * @module awareness-protocol
 */ 






const $b77bf6112613d614$export$47b58b45939fff5e = 30000;
class $b77bf6112613d614$export$5bb40478b91fee65 extends (0, $015da90ca04a7f6c$export$77cea355fa80b5f4) {
    /**
   * @param {Y.Doc} doc
   */ constructor(doc){
        super();
        this.doc = doc;
        /**
     * @type {number}
     */ this.clientID = doc.clientID;
        /**
     * Maps from client id to client state
     * @type {Map<number, Object<string, any>>}
     */ this.states = new Map();
        /**
     * @type {Map<number, MetaClientState>}
     */ this.meta = new Map();
        this._checkInterval = /** @type {any} */ setInterval(()=>{
            const now = $3500d09fbb2953ce$export$1f77c0008d16313();
            if (this.getLocalState() !== null && $b77bf6112613d614$export$47b58b45939fff5e / 2 <= now - /** @type {{lastUpdated:number}} */ this.meta.get(this.clientID).lastUpdated) // renew local clock
            this.setLocalState(this.getLocalState());
            /**
       * @type {Array<number>}
       */ const remove = [];
            this.meta.forEach((meta, clientid)=>{
                if (clientid !== this.clientID && $b77bf6112613d614$export$47b58b45939fff5e <= now - meta.lastUpdated && this.states.has(clientid)) remove.push(clientid);
            });
            if (remove.length > 0) $b77bf6112613d614$export$3edbfe2f45ae9ff8(this, remove, 'timeout');
        }, $674380a05f97f4f3$export$a3fe094919f356fd($b77bf6112613d614$export$47b58b45939fff5e / 10));
        doc.on('destroy', ()=>{
            this.destroy();
        });
        this.setLocalState({});
    }
    destroy() {
        this.emit('destroy', [
            this
        ]);
        this.setLocalState(null);
        super.destroy();
        clearInterval(this._checkInterval);
    }
    /**
   * @return {Object<string,any>|null}
   */ getLocalState() {
        return this.states.get(this.clientID) || null;
    }
    /**
   * @param {Object<string,any>|null} state
   */ setLocalState(state) {
        const clientID = this.clientID;
        const currLocalMeta = this.meta.get(clientID);
        const clock = currLocalMeta === undefined ? 0 : currLocalMeta.clock + 1;
        const prevState = this.states.get(clientID);
        if (state === null) this.states.delete(clientID);
        else this.states.set(clientID, state);
        this.meta.set(clientID, {
            clock: clock,
            lastUpdated: $3500d09fbb2953ce$export$1f77c0008d16313()
        });
        const added = [];
        const updated = [];
        const filteredUpdated = [];
        const removed = [];
        if (state === null) removed.push(clientID);
        else if (prevState == null) {
            if (state != null) added.push(clientID);
        } else {
            updated.push(clientID);
            if (!$e2897672a487246a$export$2ca9a723affd5d11(prevState, state)) filteredUpdated.push(clientID);
        }
        if (added.length > 0 || filteredUpdated.length > 0 || removed.length > 0) this.emit('change', [
            {
                added: added,
                updated: filteredUpdated,
                removed: removed
            },
            'local'
        ]);
        this.emit('update', [
            {
                added: added,
                updated: updated,
                removed: removed
            },
            'local'
        ]);
    }
    /**
   * @param {string} field
   * @param {any} value
   */ setLocalStateField(field, value) {
        const state = this.getLocalState();
        if (state !== null) this.setLocalState({
            ...state,
            [field]: value
        });
    }
    /**
   * @return {Map<number,Object<string,any>>}
   */ getStates() {
        return this.states;
    }
}
const $b77bf6112613d614$export$3edbfe2f45ae9ff8 = (awareness, clients, origin)=>{
    const removed = [];
    for(let i = 0; i < clients.length; i++){
        const clientID = clients[i];
        if (awareness.states.has(clientID)) {
            awareness.states.delete(clientID);
            if (clientID === awareness.clientID) {
                const curMeta = /** @type {MetaClientState} */ awareness.meta.get(clientID);
                awareness.meta.set(clientID, {
                    clock: curMeta.clock + 1,
                    lastUpdated: $3500d09fbb2953ce$export$1f77c0008d16313()
                });
            }
            removed.push(clientID);
        }
    }
    if (removed.length > 0) {
        awareness.emit('change', [
            {
                added: [],
                updated: [],
                removed: removed
            },
            origin
        ]);
        awareness.emit('update', [
            {
                added: [],
                updated: [],
                removed: removed
            },
            origin
        ]);
    }
};
const $b77bf6112613d614$export$e194fa93ebd743e9 = (awareness, clients, states = awareness.states)=>{
    const len = clients.length;
    const encoder = $293cd0efd7645786$export$4e76eeb6df88c889();
    $293cd0efd7645786$export$872f48c75febcd2b(encoder, len);
    for(let i = 0; i < len; i++){
        const clientID = clients[i];
        const state = states.get(clientID) || null;
        const clock = /** @type {MetaClientState} */ awareness.meta.get(clientID).clock;
        $293cd0efd7645786$export$872f48c75febcd2b(encoder, clientID);
        $293cd0efd7645786$export$872f48c75febcd2b(encoder, clock);
        $293cd0efd7645786$export$dde49cb52d5f1650(encoder, JSON.stringify(state));
    }
    return $293cd0efd7645786$export$73470fd2221e6aef(encoder);
};
const $b77bf6112613d614$export$17dfc8fb4d274726 = (update, modify)=>{
    const decoder = $e15498288f7f96ea$export$f8c898e83b60faaa(update);
    const encoder = $293cd0efd7645786$export$4e76eeb6df88c889();
    const len = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
    $293cd0efd7645786$export$872f48c75febcd2b(encoder, len);
    for(let i = 0; i < len; i++){
        const clientID = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
        const clock = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
        const state = JSON.parse($e15498288f7f96ea$export$3b64b4d753b81ec2(decoder));
        const modifiedState = modify(state);
        $293cd0efd7645786$export$872f48c75febcd2b(encoder, clientID);
        $293cd0efd7645786$export$872f48c75febcd2b(encoder, clock);
        $293cd0efd7645786$export$dde49cb52d5f1650(encoder, JSON.stringify(modifiedState));
    }
    return $293cd0efd7645786$export$73470fd2221e6aef(encoder);
};
const $b77bf6112613d614$export$2f92845406d72d1a = (awareness, update, origin)=>{
    const decoder = $e15498288f7f96ea$export$f8c898e83b60faaa(update);
    const timestamp = $3500d09fbb2953ce$export$1f77c0008d16313();
    const added = [];
    const updated = [];
    const filteredUpdated = [];
    const removed = [];
    const len = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
    for(let i = 0; i < len; i++){
        const clientID = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
        let clock = $e15498288f7f96ea$export$5a476e4dbe7923d5(decoder);
        const state = JSON.parse($e15498288f7f96ea$export$3b64b4d753b81ec2(decoder));
        const clientMeta = awareness.meta.get(clientID);
        const prevState = awareness.states.get(clientID);
        const currClock = clientMeta === undefined ? 0 : clientMeta.clock;
        if (currClock < clock || currClock === clock && state === null && awareness.states.has(clientID)) {
            if (state === null) {
                // never let a remote client remove this local state
                if (clientID === awareness.clientID && awareness.getLocalState() != null) // remote client removed the local state. Do not remote state. Broadcast a message indicating
                // that this client still exists by increasing the clock
                clock++;
                else awareness.states.delete(clientID);
            } else awareness.states.set(clientID, state);
            awareness.meta.set(clientID, {
                clock: clock,
                lastUpdated: timestamp
            });
            if (clientMeta === undefined && state !== null) added.push(clientID);
            else if (clientMeta !== undefined && state === null) removed.push(clientID);
            else if (state !== null) {
                if (!$e2897672a487246a$export$2ca9a723affd5d11(state, prevState)) filteredUpdated.push(clientID);
                updated.push(clientID);
            }
        }
    }
    if (added.length > 0 || filteredUpdated.length > 0 || removed.length > 0) awareness.emit('change', [
        {
            added: added,
            updated: filteredUpdated,
            removed: removed
        },
        origin
    ]);
    if (added.length > 0 || updated.length > 0 || removed.length > 0) awareness.emit('update', [
        {
            added: added,
            updated: updated,
            removed: removed
        },
        origin
    ]);
};


class $ee6dc27f83f28fb1$var$RelativeSelection {
    /**
   * @param {Y.RelativePosition} start
   * @param {Y.RelativePosition} end
   * @param {monaco.SelectionDirection} direction
   */ constructor(start, end, direction){
        this.start = start;
        this.end = end;
        this.direction = direction;
    }
}
/**
 * @param {monaco.editor.IStandaloneCodeEditor} editor
 * @param {monaco.editor.ITextModel} monacoModel
 * @param {Y.Text} type
 */ const $ee6dc27f83f28fb1$var$createRelativeSelection = (editor, monacoModel, type)=>{
    const sel = editor.getSelection();
    if (sel !== null) {
        const startPos = sel.getStartPosition();
        const endPos = sel.getEndPosition();
        const start = $42aaa4fd3d01b4df$export$197e7d99e3857e88(type, monacoModel.getOffsetAt(startPos));
        const end = $42aaa4fd3d01b4df$export$197e7d99e3857e88(type, monacoModel.getOffsetAt(endPos));
        return new $ee6dc27f83f28fb1$var$RelativeSelection(start, end, sel.getDirection());
    }
    return null;
};
/**
 * @param {monaco.editor.IEditor} editor
 * @param {Y.Text} type
 * @param {RelativeSelection} relSel
 * @param {Y.Doc} doc
 * @return {null|monaco.Selection}
 */ const $ee6dc27f83f28fb1$var$createMonacoSelectionFromRelativeSelection = (editor, type, relSel, doc)=>{
    const start = $42aaa4fd3d01b4df$export$8fc3152f62fb7ed1(relSel.start, doc);
    const end = $42aaa4fd3d01b4df$export$8fc3152f62fb7ed1(relSel.end, doc);
    if (start !== null && end !== null && start.type === type && end.type === type) {
        const model = /** @type {monaco.editor.ITextModel} */ editor.getModel();
        const startPos = model.getPositionAt(start.index);
        const endPos = model.getPositionAt(end.index);
        return $leKFq.Selection.createWithDirection(startPos.lineNumber, startPos.column, endPos.lineNumber, endPos.column, relSel.direction);
    }
    return null;
};
class $ee6dc27f83f28fb1$export$f76a9ce8743d808f {
    /**
   * @param {Y.Text} ytext
   * @param {monaco.editor.ITextModel} monacoModel
   * @param {Set<monaco.editor.IStandaloneCodeEditor>} [editors]
   * @param {Awareness?} [awareness]
   */ constructor(ytext, monacoModel, editors = new Set(), awareness = null){
        this.doc = /** @type {Y.Doc} */ ytext.doc;
        this.ytext = ytext;
        this.monacoModel = monacoModel;
        this.editors = editors;
        this.mux = (0, $56701e1431a97545$export$6cca8a222d1193d7)();
        /**
     * @type {Map<monaco.editor.IStandaloneCodeEditor, RelativeSelection>}
     */ this._savedSelections = new Map();
        this._beforeTransaction = ()=>{
            this.mux(()=>{
                this._savedSelections = new Map();
                editors.forEach((editor)=>{
                    if (editor.getModel() === monacoModel) {
                        const rsel = $ee6dc27f83f28fb1$var$createRelativeSelection(editor, monacoModel, ytext);
                        if (rsel !== null) this._savedSelections.set(editor, rsel);
                    }
                });
            });
        };
        this.doc.on('beforeAllTransactions', this._beforeTransaction);
        this._decorations = new Map();
        this._rerenderDecorations = ()=>{
            editors.forEach((editor)=>{
                if (awareness && editor.getModel() === monacoModel) {
                    // render decorations
                    const currentDecorations = this._decorations.get(editor) || [];
                    /**
           * @type {Array<monaco.editor.IModelDeltaDecoration>}
           */ const newDecorations = [];
                    awareness.getStates().forEach((state, clientID)=>{
                        if (clientID !== this.doc.clientID && state.selection != null && state.selection.anchor != null && state.selection.head != null) {
                            const anchorAbs = $42aaa4fd3d01b4df$export$8fc3152f62fb7ed1(state.selection.anchor, this.doc);
                            const headAbs = $42aaa4fd3d01b4df$export$8fc3152f62fb7ed1(state.selection.head, this.doc);
                            if (anchorAbs !== null && headAbs !== null && anchorAbs.type === ytext && headAbs.type === ytext) {
                                let start, end, afterContentClassName, beforeContentClassName;
                                if (anchorAbs.index < headAbs.index) {
                                    start = monacoModel.getPositionAt(anchorAbs.index);
                                    end = monacoModel.getPositionAt(headAbs.index);
                                    afterContentClassName = 'yRemoteSelectionHead yRemoteSelectionHead-' + clientID;
                                    beforeContentClassName = null;
                                } else {
                                    start = monacoModel.getPositionAt(headAbs.index);
                                    end = monacoModel.getPositionAt(anchorAbs.index);
                                    afterContentClassName = null;
                                    beforeContentClassName = 'yRemoteSelectionHead yRemoteSelectionHead-' + clientID;
                                }
                                newDecorations.push({
                                    range: new $leKFq.Range(start.lineNumber, start.column, end.lineNumber, end.column),
                                    options: {
                                        className: 'yRemoteSelection yRemoteSelection-' + clientID,
                                        afterContentClassName: afterContentClassName,
                                        beforeContentClassName: beforeContentClassName
                                    }
                                });
                            }
                        }
                    });
                    this._decorations.set(editor, editor.deltaDecorations(currentDecorations, newDecorations));
                } else // ignore decorations
                this._decorations.delete(editor);
            });
        };
        /**
     * @param {Y.YTextEvent} event
     */ this._ytextObserver = (event)=>{
            this.mux(()=>{
                let index = 0;
                event.delta.forEach((op)=>{
                    if (op.retain !== undefined) index += op.retain;
                    else if (op.insert !== undefined) {
                        const pos = monacoModel.getPositionAt(index);
                        const range = new $leKFq.Selection(pos.lineNumber, pos.column, pos.lineNumber, pos.column);
                        const insert = /** @type {string} */ op.insert;
                        monacoModel.applyEdits([
                            {
                                range: range,
                                text: insert
                            }
                        ]);
                        index += insert.length;
                    } else if (op.delete !== undefined) {
                        const pos = monacoModel.getPositionAt(index);
                        const endPos = monacoModel.getPositionAt(index + op.delete);
                        const range = new $leKFq.Selection(pos.lineNumber, pos.column, endPos.lineNumber, endPos.column);
                        monacoModel.applyEdits([
                            {
                                range: range,
                                text: ''
                            }
                        ]);
                    } else throw $20dad2a1f8b7bbe7$export$965b6bccecbd9673();
                });
                this._savedSelections.forEach((rsel, editor)=>{
                    const sel = $ee6dc27f83f28fb1$var$createMonacoSelectionFromRelativeSelection(editor, ytext, rsel, this.doc);
                    if (sel !== null) editor.setSelection(sel);
                });
            });
            this._rerenderDecorations();
        };
        ytext.observe(this._ytextObserver);
        {
            const ytextValue = ytext.toString();
            if (monacoModel.getValue() !== ytextValue) monacoModel.setValue(ytextValue);
        }
        this._monacoChangeHandler = monacoModel.onDidChangeContent((event)=>{
            // apply changes from right to left
            this.mux(()=>{
                this.doc.transact(()=>{
                    event.changes.sort((change1, change2)=>change2.rangeOffset - change1.rangeOffset).forEach((change)=>{
                        ytext.delete(change.rangeOffset, change.rangeLength);
                        ytext.insert(change.rangeOffset, change.text);
                    });
                }, this);
            });
        });
        this._monacoDisposeHandler = monacoModel.onWillDispose(()=>{
            this.destroy();
        });
        if (awareness) {
            editors.forEach((editor)=>{
                editor.onDidChangeCursorSelection(()=>{
                    if (editor.getModel() === monacoModel) {
                        const sel = editor.getSelection();
                        if (sel === null) return;
                        let anchor = monacoModel.getOffsetAt(sel.getStartPosition());
                        let head = monacoModel.getOffsetAt(sel.getEndPosition());
                        if (sel.getDirection() === $leKFq.SelectionDirection.RTL) {
                            const tmp = anchor;
                            anchor = head;
                            head = tmp;
                        }
                        awareness.setLocalStateField('selection', {
                            anchor: $42aaa4fd3d01b4df$export$197e7d99e3857e88(ytext, anchor),
                            head: $42aaa4fd3d01b4df$export$197e7d99e3857e88(ytext, head)
                        });
                    }
                });
                awareness.on('change', this._rerenderDecorations);
            });
            this.awareness = awareness;
        }
    }
    destroy() {
        this._monacoChangeHandler.dispose();
        this._monacoDisposeHandler.dispose();
        this.ytext.unobserve(this._ytextObserver);
        this.doc.off('beforeAllTransactions', this._beforeTransaction);
        if (this.awareness) this.awareness.off('change', this._rerenderDecorations);
    }
}


/*  import JSONWorker from 'url:monaco-editor/esm/vs/language/json/json.worker.js'
      import CSSWorker from 'url:monaco-editor/esm/vs/language/css/css.worker.js'
      import HTMLWorker from 'url:monaco-editor/esm/vs/language/html/html.worker.js'
      import TSWorker from 'url:monaco-editor/esm/vs/language/typescript/ts.worker.js'
      import EditorWorker from 'url:monaco-editor/esm/vs/editor/editor.worker.js'

      // @ts-ignore
      window.MonacoEnvironment = {
        getWorkerUrl: function (moduleId, label) {
          if (label === 'json') {
            return JSONWorker
          }
          if (label === 'css' || label === 'scss' || label === 'less') {
            return CSSWorker
          }
          if (label === 'html' || label === 'handlebars' || label === 'razor') {
            return HTMLWorker
          }
          if (label === 'typescript' || label === 'javascript') {
            return TSWorker
          }

          return EditorWorker
        },
      }  */ var $3ac94de3140d39da$var$editor;
window.execute = function() {
    // Get the current selection or full content
    const selection = $3ac94de3140d39da$var$editor.getSelection();
    const code = selection && !selection.isEmpty() ? $3ac94de3140d39da$var$editor.getModel().getValueInRange(selection) : $3ac94de3140d39da$var$editor.getValue();
    // Send the selected code or full content
    Edrys.sendMessage(Edrys.module.config.runCommand || 'execute', code);
};
window.reset = function() {
    if (Edrys.module.config.synchronize ?? true) Edrys.updateState(()=>{
        const yText = Edrys.getState('monaco-code', 'Text');
        yText.delete(0, $3ac94de3140d39da$var$editor.getValue().length);
        yText.insert(0, Edrys.module.config.value || '');
    });
    else $3ac94de3140d39da$var$editor.setValue(Edrys.module.config.value || '');
};
Edrys.onReady(()=>{
    if (Edrys.module?.config?.value) document.getElementById('reset').style.display = 'inline';
    $3ac94de3140d39da$var$editor = $leKFq.editor.create(document.getElementById('editor'), {
        value: '',
        language: Edrys.module.config.language || 'cpp',
        theme: Edrys.module.config.theme || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'vs-dark' : 'vs-light'),
        automaticLayout: true,
        scrollbar: {
            vertical: 'visible',
            horizontal: 'auto',
            useShadows: false,
            verticalHasArrows: false,
            horizontalHasArrows: false,
            alwaysConsumeMouseWheel: false
        }
    });
    if (Edrys.module.config.synchronize ?? true) {
        const yText = Edrys.getState('monaco-code', 'Text');
        // const awareness = Edrys.getState('monaco-awareness', 'Awareness')
        const monacoBinding = new (0, $ee6dc27f83f28fb1$export$f76a9ce8743d808f)(yText, $3ac94de3140d39da$var$editor.getModel(), new Set([
            $3ac94de3140d39da$var$editor
        ]));
        if (yText.toString() === '') yText.insert(0, Edrys.module.config.value || '');
    } else $3ac94de3140d39da$var$editor.setValue(Edrys.module.config.value || '');
});


</script>
  </body>
</html>
